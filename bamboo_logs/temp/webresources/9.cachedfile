;
/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-plugin:data', location = 'js/data/data.js' */
(function(){if(!window.WRM){window.WRM={}}function a(c){if(!c){return c}return JSON.parse(c)}function b(d,c){return Object.prototype.hasOwnProperty.call(d,c)}WRM.data={claim:function(c){if(WRM._unparsedData&&b(WRM._unparsedData,c)){var g=WRM._unparsedData[c];try{var d=a(g);delete WRM._unparsedData[c];return d}catch(f){console&&console.log&&console.log("JSON Error parsing data with key "+c+": "+f)}}}};WRM.onData=function(d,c){if(!c){c=d;d=false}};if(typeof define==="function"){define("wrm/data",[],function(){return WRM.data})}}());;
;
/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path', location = 'js/data/context-path.js' */
(function(){var a=null;(window.AJS||(window.AJS={}));AJS.contextPath=function(){if(a===null){a=WRM.data.claim("com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path")}return a};AJS.contextPath._reset=function(){a=null};if(typeof define==="function"){define("wrm/context-path",[],function(){return AJS.contextPath})}}());;
;
/* module-key = 'com.atlassian.plugins.jquery:jquery', location = '/jquery.js' */
(function(q){function Pa(a){var b=a.length,d=c.type(a);return c.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===d||"function"!==d&&(0===b||"number"===typeof b&&0<b&&b-1 in a)}function wb(a,b,d,e){if(c.acceptData(a)){var f=c.expando,g=a.nodeType,h=g?c.cache:a,i=g?a[f]:a[f]&&f;if(i&&h[i]&&(e||h[i].data)||!(void 0===d&&"string"===typeof b)){i||(i=g?a[f]=ga.pop()||c.guid++:f);h[i]||(h[i]=g?{}:{toJSON:c.noop});if("object"===typeof b||"function"===typeof b)e?h[i]=c.extend(h[i],b):h[i].data=c.extend(h[i].data,
b);a=h[i];e||(a.data||(a.data={}),a=a.data);void 0!==d&&(a[c.camelCase(b)]=d);"string"===typeof b?(d=a[b],null==d&&(d=a[c.camelCase(b)])):d=a;return d}}}function xb(a,b,d){if(c.acceptData(a)){var e,f,g=a.nodeType,h=g?c.cache:a,i=g?a[c.expando]:c.expando;if(h[i]){if(b&&(e=d?h[i]:h[i].data)){c.isArray(b)?b=b.concat(c.map(b,c.camelCase)):b in e?b=[b]:(b=c.camelCase(b),b=b in e?[b]:b.split(" "));for(f=b.length;f--;)delete e[b[f]];if(d?!Qa(e):!c.isEmptyObject(e))return}if(!d&&(delete h[i].data,!Qa(h[i])))return;
g?c.cleanData([a],!0):c.support.deleteExpando||h!=h.window?delete h[i]:h[i]=null}}}function yb(a,b,d){if(void 0===d&&1===a.nodeType)if(d="data-"+b.replace(Ic,"-$1").toLowerCase(),d=a.getAttribute(d),"string"===typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:Jc.test(d)?c.parseJSON(d):d}catch(e){}c.data(a,b,d)}else d=void 0;return d}function Qa(a){for(var b in a)if(!("data"===b&&c.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function ua(){return!0}function ha(){return!1}
function zb(){try{return p.activeElement}catch(a){}}function Ab(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function Ra(a,b,d){if(c.isFunction(b))return c.grep(a,function(a,c){return!!b.call(a,c,a)!==d});if(b.nodeType)return c.grep(a,function(a){return a===b!==d});if("string"===typeof b){if(Kc.test(b))return c.filter(b,a,d);b=c.filter(b,a)}return c.grep(a,function(a){return 0<=c.inArray(a,b)!==d})}function Bb(a){var b=Cb.split("|"),a=a.createDocumentFragment();if(a.createElement)for(;b.length;)a.createElement(b.pop());
return a}function Db(a,b){return c.nodeName(a,"table")&&c.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Eb(a){a.type=(null!==c.find.attr(a,"type"))+"/"+a.type;return a}function Fb(a){var b=Lc.exec(a.type);b?a.type=b[1]:a.removeAttribute("type");return a}function Sa(a,b){for(var d,e=0;null!=(d=a[e]);e++)c._data(d,"globalEval",!b||c._data(b[e],"globalEval"))}function Gb(a,b){if(1===b.nodeType&&c.hasData(a)){var d,
e,f;e=c._data(a);var g=c._data(b,e),h=e.events;if(h)for(d in delete g.handle,g.events={},h){e=0;for(f=h[d].length;e<f;e++)c.event.add(b,d,h[d][e])}g.data&&(g.data=c.extend({},g.data))}}function x(a,b){var d,e,f=0,g=typeof a.getElementsByTagName!==M?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==M?a.querySelectorAll(b||"*"):void 0;if(!g){g=[];for(d=a.childNodes||a;null!=(e=d[f]);f++)!b||c.nodeName(e,b)?g.push(e):c.merge(g,x(e,b))}return void 0===b||b&&c.nodeName(a,b)?c.merge([a],g):g}function Mc(a){Ta.test(a.type)&&
(a.defaultChecked=a.checked)}function Hb(a,b){if(b in a)return b;for(var d=b.charAt(0).toUpperCase()+b.slice(1),c=b,f=Ib.length;f--;)if(b=Ib[f]+d,b in a)return b;return c}function oa(a,b){a=b||a;return"none"===c.css(a,"display")||!c.contains(a.ownerDocument,a)}function Jb(a,b){for(var d,e,f,g=[],h=0,i=a.length;h<i;h++)if(e=a[h],e.style)if(g[h]=c._data(e,"olddisplay"),d=e.style.display,b)!g[h]&&"none"===d&&(e.style.display=""),""===e.style.display&&oa(e)&&(g[h]=c._data(e,"olddisplay",Kb(e.nodeName)));
else if(!g[h]&&(f=oa(e),d&&"none"!==d||!f))c._data(e,"olddisplay",f?d:c.css(e,"display"));for(h=0;h<i;h++)if(e=a[h],e.style&&(!b||"none"===e.style.display||""===e.style.display))e.style.display=b?g[h]||"":"none";return a}function Lb(a,b,d){return(a=Nc.exec(b))?Math.max(0,a[1]-(d||0))+(a[2]||"px"):b}function Mb(a,b,d,e,f){for(var b=d===(e?"border":"content")?4:"width"===b?1:0,g=0;4>b;b+=2)"margin"===d&&(g+=c.css(a,d+W[b],!0,f)),e?("content"===d&&(g-=c.css(a,"padding"+W[b],!0,f)),"margin"!==d&&(g-=
c.css(a,"border"+W[b]+"Width",!0,f))):(g+=c.css(a,"padding"+W[b],!0,f),"padding"!==d&&(g+=c.css(a,"border"+W[b]+"Width",!0,f)));return g}function Nb(a,b,d){var e=!0,f="width"===b?a.offsetWidth:a.offsetHeight,g=X(a),h=c.support.boxSizing&&"border-box"===c.css(a,"boxSizing",!1,g);if(0>=f||null==f){f=Y(a,b,g);if(0>f||null==f)f=a.style[b];if(va.test(f))return f;e=h&&(c.support.boxSizingReliable||f===a.style[b]);f=parseFloat(f)||0}return f+Mb(a,b,d||(h?"border":"content"),e,g)+"px"}function Kb(a){var b=
p,d=Ob[a];if(!d){d=Pb(a,b);if("none"===d||!d)pa=(pa||c("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(pa[0].contentWindow||pa[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),d=Pb(a,b),pa.detach();Ob[a]=d}return d}function Pb(a,b){var d=c(b.createElement(a)).appendTo(b.body),e=c.css(d[0],"display");d.remove();return e}function Ua(a,b,d,e){var f;if(c.isArray(b))c.each(b,function(b,c){d||Oc.test(a)?
e(a,c):Ua(a+"["+("object"===typeof c?b:"")+"]",c,d,e)});else if(!d&&"object"===c.type(b))for(f in b)Ua(a+"["+f+"]",b[f],d,e);else e(a,b)}function Qb(a){return function(b,d){"string"!==typeof b&&(d=b,b="*");var e,f=0,g=b.toLowerCase().match(N)||[];if(c.isFunction(d))for(;e=g[f++];)"+"===e[0]?(e=e.slice(1)||"*",(a[e]=a[e]||[]).unshift(d)):(a[e]=a[e]||[]).push(d)}}function Rb(a,b,d,e){function f(i){var j;g[i]=!0;c.each(a[i]||[],function(a,c){var i=c(b,d,e);if("string"===typeof i&&!h&&!g[i])return b.dataTypes.unshift(i),
f(i),!1;if(h)return!(j=i)});return j}var g={},h=a===Va;return f(b.dataTypes[0])||!g["*"]&&f("*")}function Wa(a,b){var d,e,f=c.ajaxSettings.flatOptions||{};for(e in b)void 0!==b[e]&&((f[e]?a:d||(d={}))[e]=b[e]);d&&c.extend(!0,a,d);return a}function Sb(){try{return new q.XMLHttpRequest}catch(a){}}function Tb(){setTimeout(function(){ia=void 0});return ia=c.now()}function Ub(a,b,d){for(var c,f=(qa[b]||[]).concat(qa["*"]),g=0,h=f.length;g<h;g++)if(c=f[g].call(d,b,a))return c}function Vb(a,b,d){var e,f,
g=0,h=wa.length,i=c.Deferred().always(function(){delete j.elem}),j=function(){if(f)return!1;for(var b=ia||Tb(),b=Math.max(0,l.startTime+l.duration-b),d=1-(b/l.duration||0),c=0,e=l.tweens.length;c<e;c++)l.tweens[c].run(d);i.notifyWith(a,[l,d,b]);if(1>d&&e)return b;i.resolveWith(a,[l]);return!1},l=i.promise({elem:a,props:c.extend({},b),opts:c.extend(!0,{specialEasing:{}},d),originalProperties:b,originalOptions:d,startTime:ia||Tb(),duration:d.duration,tweens:[],createTween:function(b,d){var e=c.Tween(a,
l.opts,b,d,l.opts.specialEasing[b]||l.opts.easing);l.tweens.push(e);return e},stop:function(b){var d=0,c=b?l.tweens.length:0;if(f)return this;for(f=!0;d<c;d++)l.tweens[d].run(1);b?i.resolveWith(a,[l,b]):i.rejectWith(a,[l,b]);return this}}),b=l.props,d=l.opts.specialEasing,m,k,n,E;for(e in b)if(m=c.camelCase(e),k=d[m],n=b[e],c.isArray(n)&&(k=n[1],n=b[e]=n[0]),e!==m&&(b[m]=n,delete b[e]),(E=c.cssHooks[m])&&"expand"in E)for(e in n=E.expand(n),delete b[m],n)e in b||(b[e]=n[e],d[e]=k);else d[m]=k;for(;g<
h;g++)if(e=wa[g].call(l,a,b,l.opts))return e;c.map(b,Ub,l);c.isFunction(l.opts.start)&&l.opts.start.call(a,l);c.fx.timer(c.extend(j,{elem:a,anim:l,queue:l.opts.queue}));return l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function A(a,b,d,c,f){return new A.prototype.init(a,b,d,c,f)}function xa(a,b){for(var d,c={height:a},f=0,b=b?1:0;4>f;f+=2-b)d=W[f],c["margin"+d]=c["padding"+d]=a;b&&(c.opacity=c.width=a);return c}function Wb(a){return c.isWindow(a)?
a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var ya,Xb,M="undefined",Qc=q.location,p=q.document,Yb=p.documentElement,Rc=q.jQuery,Sc=q.$,za={},ga=[],Zb=ga.concat,Xa=ga.push,Z=ga.slice,$b=ga.indexOf,Tc=za.toString,ja=za.hasOwnProperty,Ya="1.10.2".trim,c=function(a,b){return new c.fn.init(a,b,Xb)},Aa=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,N=/\S+/g,Uc=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,Vc=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ac=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Wc=/^[\],:{}\s]*$/,Xc=/(?:^|:|,)(?:\s*\[)+/g,
Yc=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,Zc=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,$c=/^-ms-/,ad=/-([\da-z])/gi,bd=function(a,b){return b.toUpperCase()},P=function(a){if(p.addEventListener||"load"===a.type||"complete"===p.readyState)bc(),c.ready()},bc=function(){p.addEventListener?(p.removeEventListener("DOMContentLoaded",P,!1),q.removeEventListener("load",P,!1)):(p.detachEvent("onreadystatechange",P),q.detachEvent("onload",P))};c.fn=c.prototype={jquery:"1.10.2",constructor:c,
init:function(a,b,d){var e;if(!a)return this;if("string"===typeof a){if((e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&3<=a.length?[null,a,null]:Vc.exec(a))&&(e[1]||!b)){if(e[1]){if(b=b instanceof c?b[0]:b,c.merge(this,c.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:p,!0)),ac.test(e[1])&&c.isPlainObject(b))for(e in b)if(c.isFunction(this[e]))this[e](b[e]);else this.attr(e,b[e])}else{if((b=p.getElementById(e[2]))&&b.parentNode){if(b.id!==e[2])return d.find(a);this.length=1;this[0]=b}this.context=
p;this.selector=a}return this}return!b||b.jquery?(b||d).find(a):this.constructor(b).find(a)}if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(c.isFunction(a))return d.ready(a);void 0!==a.selector&&(this.selector=a.selector,this.context=a.context);return c.makeArray(a,this)},selector:"",length:0,toArray:function(){return Z.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){a=c.merge(this.constructor(),a);a.prevObject=this;
a.context=this.context;return a},each:function(a,b){return c.each(this,a,b)},ready:function(a){c.ready.promise().done(a);return this},slice:function(){return this.pushStack(Z.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,a=+a+(0>a?b:0);return this.pushStack(0<=a&&a<b?[this[a]]:[])},map:function(a){return this.pushStack(c.map(this,function(b,d){return a.call(b,d,b)}))},end:function(){return this.prevObject||this.constructor(null)},
push:Xa,sort:[].sort,splice:[].splice};c.fn.init.prototype=c.fn;c.extend=c.fn.extend=function(){var a,b,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;"boolean"===typeof g&&(j=g,g=arguments[1]||{},h=2);"object"!==typeof g&&!c.isFunction(g)&&(g={});i===h&&(g=this,--h);for(;h<i;h++)if(null!=(f=arguments[h]))for(e in f)a=g[e],d=f[e],g!==d&&(j&&d&&(c.isPlainObject(d)||(b=c.isArray(d)))?(b?(b=!1,a=a&&c.isArray(a)?a:[]):a=a&&c.isPlainObject(a)?a:{},g[e]=c.extend(j,a,d)):void 0!==d&&(g[e]=d));return g};
c.extend({expando:"jQuery"+("1.10.2"+Math.random()).replace(/\D/g,""),noConflict:function(a){q.$===c&&(q.$=Sc);a&&q.jQuery===c&&(q.jQuery=Rc);return c},isReady:!1,readyWait:1,holdReady:function(a){a?c.readyWait++:c.ready(!0)},ready:function(a){if(!(!0===a?--c.readyWait:c.isReady)){if(!p.body)return setTimeout(c.ready);c.isReady=!0;!0!==a&&0<--c.readyWait||(ya.resolveWith(p,[c]),c.fn.trigger&&c(p).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===c.type(a)},isArray:Array.isArray||
function(a){return"array"===c.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):"object"===typeof a||"function"===typeof a?za[Tc.call(a)]||"object":typeof a},isPlainObject:function(a){var b;if(!a||"object"!==c.type(a)||a.nodeType||c.isWindow(a))return!1;try{if(a.constructor&&!ja.call(a,"constructor")&&!ja.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}if(c.support.ownLast)for(b in a)return ja.call(a,
b);for(b in a);return void 0===b||ja.call(a,b)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw Error(a);},parseHTML:function(a,b,d){if(!a||"string"!==typeof a)return null;"boolean"===typeof b&&(d=b,b=!1);var b=b||p,e=ac.exec(a),d=!d&&[];if(e)return[b.createElement(e[1])];e=c.buildFragment([a],b,d);d&&c(d).remove();return c.merge([],e.childNodes)},parseJSON:function(a){if(q.JSON&&q.JSON.parse)return q.JSON.parse(a);if(null===a)return a;if("string"===typeof a&&(a=
c.trim(a))&&Wc.test(a.replace(Yc,"@").replace(Zc,"]").replace(Xc,"")))return(new Function("return "+a))();c.error("Invalid JSON: "+a)},parseXML:function(a){var b,d;if(!a||"string"!==typeof a)return null;try{q.DOMParser?(d=new DOMParser,b=d.parseFromString(a,"text/xml")):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a))}catch(e){b=void 0}(!b||!b.documentElement||b.getElementsByTagName("parsererror").length)&&c.error("Invalid XML: "+a);return b},noop:function(){},globalEval:function(a){a&&
c.trim(a)&&(q.execScript||function(a){q.eval.call(q,a)})(a)},camelCase:function(a){return a.replace($c,"ms-").replace(ad,bd)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var c,f=0,g=a.length;c=Pa(a);if(d)if(c)for(;f<g&&!(c=b.apply(a[f],d),!1===c);f++);else for(f in a){if(c=b.apply(a[f],d),!1===c)break}else if(c)for(;f<g&&!(c=b.call(a[f],f,a[f]),!1===c);f++);else for(f in a)if(c=b.call(a[f],f,a[f]),!1===c)break;return a},trim:Ya&&!Ya.call("\ufeff\u00a0")?
function(a){return null==a?"":Ya.call(a)}:function(a){return null==a?"":(a+"").replace(Uc,"")},makeArray:function(a,b){var d=b||[];null!=a&&(Pa(Object(a))?c.merge(d,"string"===typeof a?[a]:a):Xa.call(d,a));return d},inArray:function(a,b,d){var c;if(b){if($b)return $b.call(b,a,d);c=b.length;for(d=d?0>d?Math.max(0,c+d):d:0;d<c;d++)if(d in b&&b[d]===a)return d}return-1},merge:function(a,b){var d=b.length,c=a.length,f=0;if("number"===typeof d)for(;f<d;f++)a[c++]=b[f];else for(;void 0!==b[f];)a[c++]=b[f++];
a.length=c;return a},grep:function(a,b,d){for(var c,f=[],g=0,h=a.length,d=!!d;g<h;g++)c=!!b(a[g],g),d!==c&&f.push(a[g]);return f},map:function(a,b,d){var c,f=0,g=a.length,h=[];if(Pa(a))for(;f<g;f++)c=b(a[f],f,d),null!=c&&(h[h.length]=c);else for(f in a)c=b(a[f],f,d),null!=c&&(h[h.length]=c);return Zb.apply([],h)},guid:1,proxy:function(a,b){var d,e;"string"===typeof b&&(e=a[b],b=a,a=e);if(c.isFunction(a))return d=Z.call(arguments,2),e=function(){return a.apply(b||this,d.concat(Z.call(arguments)))},
e.guid=a.guid=a.guid||c.guid++,e},access:function(a,b,d,e,f,g,h){var i=0,j=a.length,l=null==d;if("object"===c.type(d))for(i in f=!0,d)c.access(a,b,i,d[i],!0,g,h);else if(void 0!==e&&(f=!0,c.isFunction(e)||(h=!0),l&&(h?(b.call(a,e),b=null):(l=b,b=function(a,b,d){return l.call(c(a),d)})),b))for(;i<j;i++)b(a[i],d,h?e:e.call(a[i],i,b(a[i],d)));return f?a:l?b.call(a):j?b(a[0],d):g},now:function(){return(new Date).getTime()},swap:function(a,b,d,c){var f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];d=
d.apply(a,c||[]);for(f in b)a.style[f]=g[f];return d}});c.ready.promise=function(a){if(!ya)if(ya=c.Deferred(),"complete"===p.readyState)setTimeout(c.ready);else if(p.addEventListener)p.addEventListener("DOMContentLoaded",P,!1),q.addEventListener("load",P,!1);else{p.attachEvent("onreadystatechange",P);q.attachEvent("onload",P);var b=!1;try{b=null==q.frameElement&&p.documentElement}catch(d){}b&&b.doScroll&&function f(){if(!c.isReady){try{b.doScroll("left")}catch(a){return setTimeout(f,50)}bc();c.ready()}}()}return ya.promise(a)};
c.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){za["[object "+b+"]"]=b.toLowerCase()});Xb=c(p);var Za=q,u=function(a,b,d,c){var f,g,h,i,j;(b?b.ownerDocument||b:O)!==C&&$(b);b=b||C;d=d||[];if(!a||"string"!==typeof a)return d;if(1!==(i=b.nodeType)&&9!==i)return[];if(J&&!c){if(f=cd.exec(a))if(h=f[1])if(9===i)if((g=b.getElementById(h))&&g.parentNode){if(g.id===h)return d.push(g),d}else return d;else{if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&
ra(b,g)&&g.id===h)return d.push(g),d}else{if(f[2])return Q.apply(d,b.getElementsByTagName(a)),d;if((h=f[3])&&t.getElementsByClassName&&b.getElementsByClassName)return Q.apply(d,b.getElementsByClassName(h)),d}if(t.qsa&&(!B||!B.test(a))){g=f=v;h=b;j=9===i&&a;if(1===i&&"object"!==b.nodeName.toLowerCase()){i=Ba(a);(f=b.getAttribute("id"))?g=f.replace(dd,"\\$&"):b.setAttribute("id",g);g="[id='"+g+"'] ";for(h=i.length;h--;)i[h]=g+Ca(i[h]);h=$a.test(a)&&b.parentNode||b;j=i.join(",")}if(j)try{return Q.apply(d,
h.querySelectorAll(j)),d}catch(l){}finally{f||b.removeAttribute("id")}}}var m;a:{a=a.replace(Da,"$1");g=Ba(a);if(!c&&1===g.length){f=g[0]=g[0].slice(0);if(2<f.length&&"ID"===(m=f[0]).type&&t.getById&&9===b.nodeType&&J&&s.relative[f[1].type]){b=(s.find.ID(m.matches[0].replace(R,S),b)||[])[0];if(!b){m=d;break a}a=a.slice(f.shift().value.length)}for(i=Ea.needsContext.test(a)?0:f.length;i--;){m=f[i];if(s.relative[h=m.type])break;if(h=s.find[h])if(c=h(m.matches[0].replace(R,S),$a.test(f[0].type)&&b.parentNode||
b)){f.splice(i,1);a=c.length&&Ca(f);if(!a){Q.apply(d,c);m=d;break a}break}}}ab(a,g)(c,b,!J,d,$a.test(a));m=d}return m},bb=function(){function a(d,c){b.push(d+=" ")>s.cacheLength&&delete a[b.shift()];return a[d]=c}var b=[];return a},F=function(a){a[v]=!0;return a},H=function(a){var b=C.createElement("div");try{return!!a(b)}catch(d){return!1}finally{b.parentNode&&b.parentNode.removeChild(b)}},cb=function(a,b){for(var d=a.split("|"),c=a.length;c--;)s.attrHandle[d[c]]=b},dc=function(a,b){var d=b&&a,c=
d&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||cc)-(~a.sourceIndex||cc);if(c)return c;if(d)for(;d=d.nextSibling;)if(d===b)return-1;return a?1:-1},ed=function(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}},fd=function(a){return function(b){var d=b.nodeName.toLowerCase();return("input"===d||"button"===d)&&b.type===a}},aa=function(a){return F(function(b){b=+b;return F(function(d,c){for(var f,g=a([],d.length,b),h=g.length;h--;)if(d[f=g[h]])d[f]=!(c[f]=d[f])})})},ec=
function(){},Ba=function(a,b){var d,c,f,g,h,i,j;if(h=fc[a+" "])return b?0:h.slice(0);h=a;i=[];for(j=s.preFilter;h;){if(!d||(c=gd.exec(h)))c&&(h=h.slice(c[0].length)||h),i.push(f=[]);d=!1;if(c=hd.exec(h))d=c.shift(),f.push({value:d,type:c[0].replace(Da," ")}),h=h.slice(d.length);for(g in s.filter)if((c=Ea[g].exec(h))&&(!j[g]||(c=j[g](c))))d=c.shift(),f.push({value:d,type:g,matches:c}),h=h.slice(d.length);if(!d)break}return b?h.length:h?u.error(a):fc(a,i).slice(0)},Ca=function(a){for(var b=0,d=a.length,
c="";b<d;b++)c+=a[b].value;return c},db=function(a,b,d){var c=b.dir,f=d&&"parentNode"===c,g=id++;return b.first?function(b,d,g){for(;b=b[c];)if(1===b.nodeType||f)return a(b,d,g)}:function(b,d,j){var l,m,k,n=K+" "+g;if(j)for(;b=b[c];){if((1===b.nodeType||f)&&a(b,d,j))return!0}else for(;b=b[c];)if(1===b.nodeType||f)if(k=b[v]||(b[v]={}),(m=k[c])&&m[0]===n){if(!0===(l=m[1])||l===Fa)return!0===l}else if(m=k[c]=[n],m[1]=a(b,d,j)||Fa,!0===m[1])return!0}},eb=function(a){return 1<a.length?function(b,d,c){for(var f=
a.length;f--;)if(!a[f](b,d,c))return!1;return!0}:a[0]},Ga=function(a,b,d,c,f){for(var g,h=[],i=0,j=a.length,l=null!=b;i<j;i++)if(g=a[i])if(!d||d(g,c,f))h.push(g),l&&b.push(i);return h},fb=function(a,b,d,c,f,g){c&&!c[v]&&(c=fb(c));f&&!f[v]&&(f=fb(f,g));return F(function(g,i,j,l){var m,k,n=[],E=[],p=i.length,o;if(!(o=g)){o=b||"*";for(var y=j.nodeType?[j]:j,q=[],r=0,s=y.length;r<s;r++)u(o,y[r],q);o=q}o=a&&(g||!b)?Ga(o,n,a,j,l):o;y=d?f||(g?a:p||c)?[]:i:o;d&&d(o,y,j,l);if(c){m=Ga(y,E);c(m,[],j,l);for(j=
m.length;j--;)if(k=m[j])y[E[j]]=!(o[E[j]]=k)}if(g){if(f||a){if(f){m=[];for(j=y.length;j--;)if(k=y[j])m.push(o[j]=k);f(null,y=[],m,l)}for(j=y.length;j--;)if((k=y[j])&&-1<(m=f?ba.call(g,k):n[j]))g[m]=!(i[m]=k)}}else y=Ga(y===i?y.splice(p,y.length):y),f?f(null,i,y,l):Q.apply(i,y)})},gb=function(a){var b,d,c,f=a.length,g=s.relative[a[0].type];d=g||s.relative[" "];for(var h=g?1:0,i=db(function(a){return a===b},d,!0),j=db(function(a){return-1<ba.call(b,a)},d,!0),l=[function(a,d,c){return!g&&(c||d!==Ha)||
((b=d).nodeType?i(a,d,c):j(a,d,c))}];h<f;h++)if(d=s.relative[a[h].type])l=[db(eb(l),d)];else{d=s.filter[a[h].type].apply(null,a[h].matches);if(d[v]){for(c=++h;c<f&&!s.relative[a[c].type];c++);return fb(1<h&&eb(l),1<h&&Ca(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(Da,"$1"),d,h<c&&gb(a.slice(h,c)),c<f&&gb(a=a.slice(c)),c<f&&Ca(a))}l.push(d)}return eb(l)},ka,t,Fa,s,Ia,gc,ab,Ha,ca,$,C,L,J,B,da,Ja,ra,v="sizzle"+-new Date,O=Za.document,K=0,id=0,hc=bb(),fc=bb(),ic=bb(),la=!1,hb=function(a,
b){a===b&&(la=!0);return 0},cc=-2147483648,jd={}.hasOwnProperty,T=[],kd=T.pop,ld=T.push,Q=T.push,jc=T.slice,ba=T.indexOf||function(a){for(var b=0,d=this.length;b<d;b++)if(this[b]===a)return b;return-1},kc="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w#"),lc="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+kc+")|)|)[\\x20\\t\\r\\n\\f]*\\]",ib=":((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+
lc.replace(3,8)+")*)|.*)\\)|)",Da=RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),gd=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,hd=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,$a=/[\x20\t\r\n\f]*[+~]/,md=RegExp("=[\\x20\\t\\r\\n\\f]*([^\\]'\"]*)[\\x20\\t\\r\\n\\f]*\\]","g"),nd=RegExp(ib),od=RegExp("^"+kc+"$"),Ea={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,TAG:RegExp("^("+"(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w*")+")"),
ATTR:RegExp("^"+lc),PSEUDO:RegExp("^"+ib),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)",
"i")},jb=/^[^{]+\{\s*\[native \w/,cd=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,pd=/^(?:input|select|textarea|button)$/i,qd=/^h\d$/i,dd=/'|\\/g,R=RegExp("\\\\([\\da-f]{1,6}[\\x20\\t\\r\\n\\f]?|([\\x20\\t\\r\\n\\f])|.)","ig"),S=function(a,b,d){a="0x"+b-65536;return a!==a||d?b:0>a?String.fromCharCode(a+65536):String.fromCharCode(a>>10|55296,a&1023|56320)};try{Q.apply(T=jc.call(O.childNodes),O.childNodes),T[O.childNodes.length].nodeType}catch(Td){Q={apply:T.length?function(a,b){ld.apply(a,jc.call(b))}:function(a,
b){for(var d=a.length,c=0;a[d++]=b[c++];);a.length=d-1}}}gc=u.isXML=function(a){return(a=a&&(a.ownerDocument||a).documentElement)?"HTML"!==a.nodeName:!1};t=u.support={};$=u.setDocument=function(a){var b=a?a.ownerDocument||a:O,a=b.defaultView;if(b===C||9!==b.nodeType||!b.documentElement)return C;C=b;L=b.documentElement;J=!gc(b);a&&(a.attachEvent&&a!==a.top)&&a.attachEvent("onbeforeunload",function(){$()});t.attributes=H(function(a){a.className="i";return!a.getAttribute("className")});t.getElementsByTagName=
H(function(a){a.appendChild(b.createComment(""));return!a.getElementsByTagName("*").length});t.getElementsByClassName=H(function(a){a.innerHTML="<div class='a'></div><div class='a i'></div>";a.firstChild.className="i";return 2===a.getElementsByClassName("i").length});t.getById=H(function(a){L.appendChild(a).id=v;return!b.getElementsByName||!b.getElementsByName(v).length});t.getById?(s.find.ID=function(a,b){if("undefined"!==typeof b.getElementById&&J){var c=b.getElementById(a);return c&&c.parentNode?
[c]:[]}},s.filter.ID=function(a){var b=a.replace(R,S);return function(a){return a.getAttribute("id")===b}}):(delete s.find.ID,s.filter.ID=function(a){var b=a.replace(R,S);return function(a){return(a="undefined"!==typeof a.getAttributeNode&&a.getAttributeNode("id"))&&a.value===b}});s.find.TAG=t.getElementsByTagName?function(a,b){if(typeof b.getElementsByTagName!=="undefined")return b.getElementsByTagName(a)}:function(a,b){var c,g=[],h=0,i=b.getElementsByTagName(a);if(a==="*"){for(;c=i[h++];)c.nodeType===
1&&g.push(c);return g}return i};s.find.CLASS=t.getElementsByClassName&&function(a,b){if(typeof b.getElementsByClassName!=="undefined"&&J)return b.getElementsByClassName(a)};da=[];B=[];if(t.qsa=jb.test(b.querySelectorAll))H(function(a){a.innerHTML="<select><option selected=''></option></select>";a.querySelectorAll("[selected]").length||B.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)");
a.querySelectorAll(":checked").length||B.push(":checked")}),H(function(a){var c=b.createElement("input");c.setAttribute("type","hidden");a.appendChild(c).setAttribute("t","");a.querySelectorAll("[t^='']").length&&B.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")");a.querySelectorAll(":enabled").length||B.push(":enabled",":disabled");a.querySelectorAll("*,:x");B.push(",.*:")});(t.matchesSelector=jb.test(Ja=L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&H(function(a){t.disconnectedMatch=
Ja.call(a,"div");Ja.call(a,"[s!='']:x");da.push("!=",ib)});B=B.length&&RegExp(B.join("|"));da=da.length&&RegExp(da.join("|"));ra=jb.test(L.contains)||L.compareDocumentPosition?function(a,b){var c=a.nodeType===9?a.documentElement:a,g=b&&b.parentNode;return a===g||!(!g||!(g.nodeType===1&&(c.contains?c.contains(g):a.compareDocumentPosition&&a.compareDocumentPosition(g)&16)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return true;return false};hb=L.compareDocumentPosition?function(a,c){if(a===
c){la=true;return 0}var f=c.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(c);return f?f&1||!t.sortDetached&&c.compareDocumentPosition(a)===f?a===b||ra(O,a)?-1:c===b||ra(O,c)?1:ca?ba.call(ca,a)-ba.call(ca,c):0:f&4?-1:1:a.compareDocumentPosition?-1:1}:function(a,c){var f,g=0;f=a.parentNode;var h=c.parentNode,i=[a],j=[c];if(a===c){la=true;return 0}if(!f||!h)return a===b?-1:c===b?1:f?-1:h?1:ca?ba.call(ca,a)-ba.call(ca,c):0;if(f===h)return dc(a,c);for(f=a;f=f.parentNode;)i.unshift(f);
for(f=c;f=f.parentNode;)j.unshift(f);for(;i[g]===j[g];)g++;return g?dc(i[g],j[g]):i[g]===O?-1:j[g]===O?1:0};return b};u.matches=function(a,b){return u(a,null,null,b)};u.matchesSelector=function(a,b){(a.ownerDocument||a)!==C&&$(a);b=b.replace(md,"='$1']");if(t.matchesSelector&&J&&(!da||!da.test(b))&&(!B||!B.test(b)))try{var d=Ja.call(a,b);if(d||t.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(c){}return 0<u(b,C,null,[a]).length};u.contains=function(a,b){(a.ownerDocument||a)!==
C&&$(a);return ra(a,b)};u.attr=function(a,b){(a.ownerDocument||a)!==C&&$(a);var d=s.attrHandle[b.toLowerCase()],d=d&&jd.call(s.attrHandle,b.toLowerCase())?d(a,b,!J):void 0;return void 0===d?t.attributes||!J?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null:d};u.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};u.uniqueSort=function(a){var b,d=[],c=0,f=0;la=!t.detectDuplicates;ca=!t.sortStable&&a.slice(0);a.sort(hb);if(la){for(;b=a[f++];)b===a[f]&&(c=
d.push(f));for(;c--;)a.splice(d[c],1)}return a};Ia=u.getText=function(a){var b,c="",e=0;if(b=a.nodeType)if(1===b||9===b||11===b){if("string"===typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=Ia(a)}else{if(3===b||4===b)return a.nodeValue}else for(;b=a[e];e++)c+=Ia(b);return c};s=u.selectors={cacheLength:50,createPseudo:F,match:Ea,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},
preFilter:{ATTR:function(a){a[1]=a[1].replace(R,S);a[3]=(a[4]||a[5]||"").replace(R,S);"~="===a[2]&&(a[3]=" "+a[3]+" ");return a.slice(0,4)},CHILD:function(a){a[1]=a[1].toLowerCase();"nth"===a[1].slice(0,3)?(a[3]||u.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&u.error(a[0]);return a},PSEUDO:function(a){var b,c=!a[5]&&a[2];if(Ea.CHILD.test(a[0]))return null;if(a[3]&&void 0!==a[4])a[2]=a[4];else if(c&&nd.test(c)&&(b=Ba(c,!0))&&(b=c.indexOf(")",
c.length-b)-c.length))a[0]=a[0].slice(0,b),a[2]=c.slice(0,b);return a.slice(0,3)}},filter:{TAG:function(a){var b=a.replace(R,S).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=hc[a+" "];return b||(b=RegExp("(^|[\\x20\\t\\r\\n\\f])"+a+"([\\x20\\t\\r\\n\\f]|$)"))&&hc(a,function(a){return b.test("string"===typeof a.className&&a.className||"undefined"!==typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,
b,c){return function(e){e=u.attr(e,a);if(null==e)return"!="===b;if(!b)return!0;e+="";return"="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&-1<e.indexOf(c):"$="===b?c&&e.slice(-c.length)===c:"~="===b?-1<(" "+e+" ").indexOf(c):"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1}},CHILD:function(a,b,c,e,f){var g="nth"!==a.slice(0,3),h="last"!==a.slice(-4),i="of-type"===b;return 1===e&&0===f?function(a){return!!a.parentNode}:function(b,c,d){var k,n,E,o,p,c=g!==h?"nextSibling":"previousSibling",
y=b.parentNode,q=i&&b.nodeName.toLowerCase(),d=!d&&!i;if(y){if(g){for(;c;){for(n=b;n=n[c];)if(i?n.nodeName.toLowerCase()===q:1===n.nodeType)return!1;p=c="only"===a&&!p&&"nextSibling"}return!0}p=[h?y.firstChild:y.lastChild];if(h&&d){d=y[v]||(y[v]={});k=d[a]||[];o=k[0]===K&&k[1];E=k[0]===K&&k[2];for(n=o&&y.childNodes[o];n=++o&&n&&n[c]||(E=o=0)||p.pop();)if(1===n.nodeType&&++E&&n===b){d[a]=[K,o,E];break}}else if(d&&(k=(b[v]||(b[v]={}))[a])&&k[0]===K)E=k[1];else for(;n=++o&&n&&n[c]||(E=o=0)||p.pop();)if((i?
n.nodeName.toLowerCase()===q:1===n.nodeType)&&++E)if(d&&((n[v]||(n[v]={}))[a]=[K,E]),n===b)break;E-=f;return E===e||0===E%e&&0<=E/e}}},PSEUDO:function(a,b){var c,e=s.pseudos[a]||s.setFilters[a.toLowerCase()]||u.error("unsupported pseudo: "+a);return e[v]?e(b):1<e.length?(c=[a,a,"",b],s.setFilters.hasOwnProperty(a.toLowerCase())?F(function(a,c){for(var d,i=e(a,b),j=i.length;j--;)d=ba.call(a,i[j]),a[d]=!(c[d]=i[j])}):function(a){return e(a,0,c)}):e}},pseudos:{not:F(function(a){var b=[],c=[],e=ab(a.replace(Da,
"$1"));return e[v]?F(function(a,b,c,d){for(var d=e(a,null,d,[]),j=a.length;j--;)if(c=d[j])a[j]=!(b[j]=c)}):function(a,g,h){b[0]=a;e(b,null,h,c);return!c.pop()}}),has:F(function(a){return function(b){return 0<u(a,b).length}}),contains:F(function(a){return function(b){return-1<(b.textContent||b.innerText||Ia(b)).indexOf(a)}}),lang:F(function(a){od.test(a||"")||u.error("unsupported lang: "+a);a=a.replace(R,S).toLowerCase();return function(b){var c;do if(c=J?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=
c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(a){var b=Za.location&&Za.location.hash;return b&&b.slice(1)===a.id},root:function(a){return a===L},focus:function(a){return a===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!(!a.type&&!a.href&&!~a.tabIndex)},enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===
b&&!!a.selected},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if("@"<a.nodeName||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!s.pseudos.empty(a)},header:function(a){return qd.test(a.nodeName)},input:function(a){return pd.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===
a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:aa(function(){return[0]}),last:aa(function(a,b){return[b-1]}),eq:aa(function(a,b,c){return[0>c?c+b:c]}),even:aa(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:aa(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:aa(function(a,b,c){for(b=0>c?c+b:c;0<=--b;)a.push(b);return a}),gt:aa(function(a,b,c){for(c=0>c?c+b:c;++c<b;)a.push(c);return a})}};s.pseudos.nth=s.pseudos.eq;
for(ka in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[ka]=ed(ka);for(ka in{submit:!0,reset:!0})s.pseudos[ka]=fd(ka);ec.prototype=s.filters=s.pseudos;s.setFilters=new ec;ab=u.compile=function(a,b){var c,e=[],f=[],g=ic[a+" "];if(!g){b||(b=Ba(a));for(c=b.length;c--;)g=gb(b[c]),g[v]?e.push(g):f.push(g);var h=0,i=0<e.length,j=0<f.length;c=function(a,b,c,d,g){var o,p,y=[],q=0,r="0",t=a&&[],v=null!=g,w=Ha,x=a||j&&s.find.TAG("*",g&&b.parentNode||b),mc=K+=null==w?1:Math.random()||0.1;v&&(Ha=
b!==C&&b,Fa=h);for(;null!=(g=x[r]);r++){if(j&&g){for(o=0;p=f[o++];)if(p(g,b,c)){d.push(g);break}v&&(K=mc,Fa=++h)}i&&((g=!p&&g)&&q--,a&&t.push(g))}q+=r;if(i&&r!==q){for(o=0;p=e[o++];)p(t,y,b,c);if(a){if(0<q)for(;r--;)!t[r]&&!y[r]&&(y[r]=kd.call(d));y=Ga(y)}Q.apply(d,y);v&&(!a&&0<y.length&&1<q+e.length)&&u.uniqueSort(d)}v&&(K=mc,Ha=w);return t};c=i?F(c):c;g=ic(a,c)}return g};t.sortStable=v.split("").sort(hb).join("")===v;t.detectDuplicates=la;$();t.sortDetached=H(function(a){return a.compareDocumentPosition(C.createElement("div"))&
1});H(function(a){a.innerHTML="<a href='#'></a>";return"#"===a.firstChild.getAttribute("href")})||cb("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)});(!t.attributes||!H(function(a){a.innerHTML="<input/>";a.firstChild.setAttribute("value","");return""===a.firstChild.getAttribute("value")}))&&cb("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue});H(function(a){return null==a.getAttribute("disabled")})||cb("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
function(a,b,c){var e;if(!c)return(e=a.getAttributeNode(b))&&e.specified?e.value:!0===a[b]?b.toLowerCase():null});c.find=u;c.expr=u.selectors;c.expr[":"]=c.expr.pseudos;c.unique=u.uniqueSort;c.text=u.getText;c.isXMLDoc=u.isXML;c.contains=u.contains;var nc={};c.Callbacks=function(a){var b;if("string"===typeof a){if(!(b=nc[a])){b=a;var d=nc[b]={};c.each(b.match(N)||[],function(a,b){d[b]=!0});b=d}}else b=c.extend({},a);var a=b,e,f,g,h,i,j,l=[],m=!a.once&&[],k=function(b){f=a.memory&&b;g=!0;i=j||0;j=
0;h=l.length;for(e=!0;l&&i<h;i++)if(!1===l[i].apply(b[0],b[1])&&a.stopOnFalse){f=!1;break}e=!1;l&&(m?m.length&&k(m.shift()):f?l=[]:n.disable())},n={add:function(){if(l){var b=l.length;(function Pc(b){c.each(b,function(b,d){var e=c.type(d);"function"===e?(!a.unique||!n.has(d))&&l.push(d):d&&(d.length&&"string"!==e)&&Pc(d)})})(arguments);e?h=l.length:f&&(j=b,k(f))}return this},remove:function(){l&&c.each(arguments,function(a,b){for(var d;-1<(d=c.inArray(b,l,d));)l.splice(d,1),e&&(d<=h&&h--,d<=i&&i--)});
return this},has:function(a){return a?-1<c.inArray(a,l):!(!l||!l.length)},empty:function(){l=[];h=0;return this},disable:function(){l=m=f=void 0;return this},disabled:function(){return!l},lock:function(){m=void 0;f||n.disable();return this},locked:function(){return!m},fireWith:function(a,b){if(l&&(!g||m))b=b||[],b=[a,b.slice?b.slice():b],e?m.push(b):k(b);return this},fire:function(){n.fireWith(this,arguments);return this},fired:function(){return!!g}};return n};c.extend({Deferred:function(a){var b=
[["resolve","done",c.Callbacks("once memory"),"resolved"],["reject","fail",c.Callbacks("once memory"),"rejected"],["notify","progress",c.Callbacks("memory")]],d="pending",e={state:function(){return d},always:function(){f.done(arguments).fail(arguments);return this},then:function(){var a=arguments;return c.Deferred(function(d){c.each(b,function(b,j){var l=j[0],m=c.isFunction(a[b])&&a[b];f[j[1]](function(){var a=m&&m.apply(this,arguments);if(a&&c.isFunction(a.promise))a.promise().done(d.resolve).fail(d.reject).progress(d.notify);
else d[l+"With"](this===e?d.promise():this,m?[a]:arguments)})});a=null}).promise()},promise:function(a){return null!=a?c.extend(a,e):e}},f={};e.pipe=e.then;c.each(b,function(a,c){var i=c[2],j=c[3];e[c[1]]=i.add;j&&i.add(function(){d=j},b[a^1][2].disable,b[2][2].lock);f[c[0]]=function(){f[c[0]+"With"](this===f?e:this,arguments);return this};f[c[0]+"With"]=i.fireWith});e.promise(f);a&&a.call(f,f);return f},when:function(a){var b=0,d=Z.call(arguments),e=d.length,f=1!==e||a&&c.isFunction(a.promise)?e:
0,g=1===f?a:c.Deferred(),h=function(a,b,c){return function(d){b[a]=this;c[a]=1<arguments.length?Z.call(arguments):d;c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,l;if(1<e){i=Array(e);j=Array(e);for(l=Array(e);b<e;b++)d[b]&&c.isFunction(d[b].promise)?d[b].promise().done(h(b,l,d)).fail(g.reject).progress(h(b,j,i)):--f}f||g.resolveWith(l,d);return g.promise()}});var rd=c;var o={},kb,U,z,Ka,La,Ma,lb,oc,sa,r=p.createElement("div");r.setAttribute("className","t");r.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";
kb=r.getElementsByTagName("*")||[];if((U=r.getElementsByTagName("a")[0])&&U.style&&kb.length){Ka=p.createElement("select");Ma=Ka.appendChild(p.createElement("option"));z=r.getElementsByTagName("input")[0];U.style.cssText="top:1px;float:left;opacity:.5";o.getSetAttribute="t"!==r.className;o.leadingWhitespace=3===r.firstChild.nodeType;o.tbody=!r.getElementsByTagName("tbody").length;o.htmlSerialize=!!r.getElementsByTagName("link").length;o.style=/top/.test(U.getAttribute("style"));o.hrefNormalized="/a"===
U.getAttribute("href");o.opacity=/^0.5/.test(U.style.opacity);o.cssFloat=!!U.style.cssFloat;o.checkOn=!!z.value;o.optSelected=Ma.selected;o.enctype=!!p.createElement("form").enctype;o.html5Clone="<:nav></:nav>"!==p.createElement("nav").cloneNode(!0).outerHTML;o.inlineBlockNeedsLayout=!1;o.shrinkWrapBlocks=!1;o.pixelPosition=!1;o.deleteExpando=!0;o.noCloneEvent=!0;o.reliableMarginRight=!0;o.boxSizingReliable=!0;z.checked=!0;o.noCloneChecked=z.cloneNode(!0).checked;Ka.disabled=!0;o.optDisabled=!Ma.disabled;
try{delete r.test}catch(Ud){o.deleteExpando=!1}z=p.createElement("input");z.setAttribute("value","");o.input=""===z.getAttribute("value");z.value="t";z.setAttribute("type","radio");o.radioValue="t"===z.value;z.setAttribute("checked","t");z.setAttribute("name","t");La=p.createDocumentFragment();La.appendChild(z);o.appendChecked=z.checked;o.checkClone=La.cloneNode(!0).cloneNode(!0).lastChild.checked;r.attachEvent&&(r.attachEvent("onclick",function(){o.noCloneEvent=!1}),r.cloneNode(!0).click());for(sa in{submit:!0,
change:!0,focusin:!0})r.setAttribute(lb="on"+sa,"t"),o[sa+"Bubbles"]=lb in q||!1===r.attributes[lb].expando;r.style.backgroundClip="content-box";r.cloneNode(!0).style.backgroundClip="";o.clearCloneStyle="content-box"===r.style.backgroundClip;for(sa in c(o))break;o.ownLast="0"!==sa;c(function(){var a,b,d=p.getElementsByTagName("body")[0];if(d){a=p.createElement("div");a.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";d.appendChild(a).appendChild(r);r.innerHTML=
"<table><tr><td></td><td>t</td></tr></table>";b=r.getElementsByTagName("td");b[0].style.cssText="padding:0;margin:0;border:0;display:none";oc=b[0].offsetHeight===0;b[0].style.display="";b[1].style.display="none";o.reliableHiddenOffsets=oc&&b[0].offsetHeight===0;r.innerHTML="";r.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";c.swap(d,d.style.zoom!=null?{zoom:1}:{},
function(){o.boxSizing=r.offsetWidth===4});if(q.getComputedStyle){o.pixelPosition=(q.getComputedStyle(r,null)||{}).top!=="1%";o.boxSizingReliable=(q.getComputedStyle(r,null)||{width:"4px"}).width==="4px";b=r.appendChild(p.createElement("div"));b.style.cssText=r.style.cssText="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;";b.style.marginRight=b.style.width="0";r.style.width="1px";o.reliableMarginRight=!parseFloat((q.getComputedStyle(b,
null)||{}).marginRight)}if(typeof r.style.zoom!==M){r.innerHTML="";r.style.cssText="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;width:1px;padding:1px;display:inline;zoom:1";o.inlineBlockNeedsLayout=r.offsetWidth===3;r.style.display="block";r.innerHTML="<div></div>";r.firstChild.style.width="5px";o.shrinkWrapBlocks=r.offsetWidth!==3;if(o.inlineBlockNeedsLayout)d.style.zoom=1}d.removeChild(a);a=r=b=b=null}});kb=Ka=La=Ma=
U=z=null}rd.support=o;var Jc=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Ic=/([A-Z])/g;c.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){a=a.nodeType?c.cache[a[c.expando]]:a[c.expando];return!!a&&!Qa(a)},data:function(a,b,c){return wb(a,b,c)},removeData:function(a,b){return xb(a,b)},_data:function(a,b,c){return wb(a,b,c,!0)},_removeData:function(a,b){return xb(a,b,!0)},acceptData:function(a){if(a.nodeType&&1!==a.nodeType&&9!==a.nodeType)return!1;
var b=a.nodeName&&c.noData[a.nodeName.toLowerCase()];return!b||!0!==b&&a.getAttribute("classid")===b}});c.fn.extend({data:function(a,b){var d,e,f=null,g=0,h=this[0];if(void 0===a){if(this.length&&(f=c.data(h),1===h.nodeType&&!c._data(h,"parsedAttrs"))){for(d=h.attributes;g<d.length;g++)e=d[g].name,0===e.indexOf("data-")&&(e=c.camelCase(e.slice(5)),yb(h,e,f[e]));c._data(h,"parsedAttrs",!0)}return f}return"object"===typeof a?this.each(function(){c.data(this,a)}):1<arguments.length?this.each(function(){c.data(this,
a,b)}):h?yb(h,a,c.data(h,a)):null},removeData:function(a){return this.each(function(){c.removeData(this,a)})}});c.extend({queue:function(a,b,d){var e;if(a)return b=(b||"fx")+"queue",e=c._data(a,b),d&&(!e||c.isArray(d)?e=c._data(a,b,c.makeArray(d)):e.push(d)),e||[]},dequeue:function(a,b){var b=b||"fx",d=c.queue(a,b),e=d.length,f=d.shift(),g=c._queueHooks(a,b),h=function(){c.dequeue(a,b)};"inprogress"===f&&(f=d.shift(),e--);f&&("fx"===b&&d.unshift("inprogress"),delete g.stop,f.call(a,h,g));!e&&g&&g.empty.fire()},
_queueHooks:function(a,b){var d=b+"queueHooks";return c._data(a,d)||c._data(a,d,{empty:c.Callbacks("once memory").add(function(){c._removeData(a,b+"queue");c._removeData(a,d)})})}});c.fn.extend({queue:function(a,b){var d=2;"string"!==typeof a&&(b=a,a="fx",d--);return arguments.length<d?c.queue(this[0],a):void 0===b?this:this.each(function(){var d=c.queue(this,a,b);c._queueHooks(this,a);a==="fx"&&d[0]!=="inprogress"&&c.dequeue(this,a)})},dequeue:function(a){return this.each(function(){c.dequeue(this,
a)})},delay:function(a,b){a=c.fx?c.fx.speeds[a]||a:a;return this.queue(b||"fx",function(b,c){var f=setTimeout(b,a);c.stop=function(){clearTimeout(f)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var d,e=1,f=c.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};"string"!==typeof a&&(b=a,a=void 0);for(a=a||"fx";h--;)if((d=c._data(g[h],a+"queueHooks"))&&d.empty)e++,d.empty.add(i);i();return f.promise(b)}});var ma,pc,mb=/[\t\r\n\f]/g,sd=/\r/g,td=/^(?:input|select|textarea|button|object)$/i,
ud=/^(?:a|area)$/i,nb=/^(?:checked|selected)$/i,ea=c.support.getSetAttribute,Na=c.support.input;c.fn.extend({attr:function(a,b){return c.access(this,c.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){c.removeAttr(this,a)})},prop:function(a,b){return c.access(this,c.prop,a,b,1<arguments.length)},removeProp:function(a){a=c.propFix[a]||a;return this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})},addClass:function(a){var b,d,e,f,g,h=0,i=this.length;b="string"===
typeof a&&a;if(c.isFunction(a))return this.each(function(b){c(this).addClass(a.call(this,b,this.className))});if(b)for(b=(a||"").match(N)||[];h<i;h++)if(d=this[h],e=1===d.nodeType&&(d.className?(" "+d.className+" ").replace(mb," "):" ")){for(g=0;f=b[g++];)0>e.indexOf(" "+f+" ")&&(e+=f+" ");d.className=c.trim(e)}return this},removeClass:function(a){var b,d,e,f,g,h=0,i=this.length;b=0===arguments.length||"string"===typeof a&&a;if(c.isFunction(a))return this.each(function(b){c(this).removeClass(a.call(this,
b,this.className))});if(b)for(b=(a||"").match(N)||[];h<i;h++)if(d=this[h],e=1===d.nodeType&&(d.className?(" "+d.className+" ").replace(mb," "):"")){for(g=0;f=b[g++];)for(;0<=e.indexOf(" "+f+" ");)e=e.replace(" "+f+" "," ");d.className=a?c.trim(e):""}return this},toggleClass:function(a,b){var d=typeof a;return"boolean"===typeof b&&"string"===d?b?this.addClass(a):this.removeClass(a):c.isFunction(a)?this.each(function(d){c(this).toggleClass(a.call(this,d,this.className,b),b)}):this.each(function(){if("string"===
d)for(var b,f=0,g=c(this),h=a.match(N)||[];b=h[f++];)g.hasClass(b)?g.removeClass(b):g.addClass(b);else if(d===M||"boolean"===d)this.className&&c._data(this,"__className__",this.className),this.className=this.className||!1===a?"":c._data(this,"__className__")||""})},hasClass:function(a){for(var a=" "+a+" ",b=0,c=this.length;b<c;b++)if(1===this[b].nodeType&&0<=(" "+this[b].className+" ").replace(mb," ").indexOf(a))return!0;return!1},val:function(a){var b,d,e,f=this[0];if(arguments.length)return e=c.isFunction(a),
this.each(function(b){if(1===this.nodeType&&(b=e?a.call(this,b,c(this).val()):a,null==b?b="":"number"===typeof b?b+="":c.isArray(b)&&(b=c.map(b,function(a){return a==null?"":a+""})),d=c.valHooks[this.type]||c.valHooks[this.nodeName.toLowerCase()],!d||!("set"in d)||void 0===d.set(this,b,"value")))this.value=b});if(f){if((d=c.valHooks[f.type]||c.valHooks[f.nodeName.toLowerCase()])&&"get"in d&&void 0!==(b=d.get(f,"value")))return b;b=f.value;return"string"===typeof b?b.replace(sd,""):null==b?"":b}}});
c.extend({valHooks:{option:{get:function(a){var b=c.find.attr(a,"value");return null!=b?b:a.text}},select:{get:function(a){for(var b,d=a.options,e=a.selectedIndex,f=(a="select-one"===a.type||0>e)?null:[],g=a?e+1:d.length,h=0>e?g:a?e:0;h<g;h++)if(b=d[h],(b.selected||h===e)&&(c.support.optDisabled?!b.disabled:null===b.getAttribute("disabled"))&&(!b.parentNode.disabled||!c.nodeName(b.parentNode,"optgroup"))){b=c(b).val();if(a)return b;f.push(b)}return f},set:function(a,b){for(var d,e,f=a.options,g=c.makeArray(b),
h=f.length;h--;)if(e=f[h],e.selected=0<=c.inArray(c(e).val(),g))d=!0;d||(a.selectedIndex=-1);return g}}},attr:function(a,b,d){var e,f,g=a.nodeType;if(a&&!(3===g||8===g||2===g)){if(typeof a.getAttribute===M)return c.prop(a,b,d);if(1!==g||!c.isXMLDoc(a))b=b.toLowerCase(),e=c.attrHooks[b]||(c.expr.match.bool.test(b)?pc:ma);if(void 0!==d)if(null===d)c.removeAttr(a,b);else{if(e&&"set"in e&&void 0!==(f=e.set(a,d,b)))return f;a.setAttribute(b,d+"");return d}else{if(e&&"get"in e&&null!==(f=e.get(a,b)))return f;
f=c.find.attr(a,b);return null==f?void 0:f}}},removeAttr:function(a,b){var d,e,f=0,g=b&&b.match(N);if(g&&1===a.nodeType)for(;d=g[f++];)e=c.propFix[d]||d,c.expr.match.bool.test(d)?Na&&ea||!nb.test(d)?a[e]=!1:a[c.camelCase("default-"+d)]=a[e]=!1:c.attr(a,d,""),a.removeAttribute(ea?d:e)},attrHooks:{type:{set:function(a,b){if(!c.support.radioValue&&"radio"===b&&c.nodeName(a,"input")){var d=a.value;a.setAttribute("type",b);d&&(a.value=d);return b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,
b,d){var e,f,g;g=a.nodeType;if(a&&!(3===g||8===g||2===g)){if(g=1!==g||!c.isXMLDoc(a))b=c.propFix[b]||b,f=c.propHooks[b];return void 0!==d?f&&"set"in f&&void 0!==(e=f.set(a,d,b))?e:a[b]=d:f&&"get"in f&&null!==(e=f.get(a,b))?e:a[b]}},propHooks:{tabIndex:{get:function(a){var b=c.find.attr(a,"tabindex");return b?parseInt(b,10):td.test(a.nodeName)||ud.test(a.nodeName)&&a.href?0:-1}}}});pc={set:function(a,b,d){!1===b?c.removeAttr(a,d):Na&&ea||!nb.test(d)?a.setAttribute(!ea&&c.propFix[d]||d,d):a[c.camelCase("default-"+
d)]=a[d]=!0;return d}};c.each(c.expr.match.bool.source.match(/\w+/g),function(a,b){var d=c.expr.attrHandle[b]||c.find.attr;c.expr.attrHandle[b]=Na&&ea||!nb.test(b)?function(a,b,g){var h=c.expr.attrHandle[b],a=g?void 0:(c.expr.attrHandle[b]=void 0)!=d(a,b,g)?b.toLowerCase():null;c.expr.attrHandle[b]=h;return a}:function(a,b,d){return d?void 0:a[c.camelCase("default-"+b)]?b.toLowerCase():null}});if(!Na||!ea)c.attrHooks.value={set:function(a,b,d){if(c.nodeName(a,"input"))a.defaultValue=b;else return ma&&
ma.set(a,b,d)}};ea||(ma={set:function(a,b,c){var e=a.getAttributeNode(c);e||a.setAttributeNode(e=a.ownerDocument.createAttribute(c));e.value=b+="";return"value"===c||b===a.getAttribute(c)?b:void 0}},c.expr.attrHandle.id=c.expr.attrHandle.name=c.expr.attrHandle.coords=function(a,b,c){var e;return c?void 0:(e=a.getAttributeNode(b))&&""!==e.value?e.value:null},c.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:ma.set},c.attrHooks.contenteditable=
{set:function(a,b,c){ma.set(a,""===b?!1:b,c)}},c.each(["width","height"],function(a,b){c.attrHooks[b]={set:function(a,c){if(""===c)return a.setAttribute(b,"auto"),c}}}));c.support.hrefNormalized||c.each(["href","src"],function(a,b){c.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}});c.support.style||(c.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});c.support.optSelected||(c.propHooks.selected={get:function(a){if(a=a.parentNode){a.selectedIndex;
a.parentNode&&a.parentNode.selectedIndex}return null}});c.each("tabIndex readOnly maxLength cellSpacing cellPadding rowSpan colSpan useMap frameBorder contentEditable".split(" "),function(){c.propFix[this.toLowerCase()]=this});c.support.enctype||(c.propFix.enctype="encoding");c.each(["radio","checkbox"],function(){c.valHooks[this]={set:function(a,b){if(c.isArray(b))return a.checked=c.inArray(c(a).val(),b)>=0}};if(!c.support.checkOn)c.valHooks[this].get=function(a){return a.getAttribute("value")===
null?"on":a.value}});var ob=/^(?:input|select|textarea)$/i,vd=/^key/,wd=/^(?:mouse|contextmenu)|click/,qc=/^(?:focusinfocus|focusoutblur)$/,rc=/^([^.]*)(?:\.(.+)|)$/;c.event={global:{},add:function(a,b,d,e,f){var g,h,i,j,l,m,k,n,o;if(i=c._data(a)){if(d.handler){j=d;d=j.handler;f=j.selector}if(!d.guid)d.guid=c.guid++;if(!(h=i.events))h=i.events={};if(!(l=i.handle)){l=i.handle=function(a){return typeof c!==M&&(!a||c.event.triggered!==a.type)?c.event.dispatch.apply(l.elem,arguments):void 0};l.elem=a}b=
(b||"").match(N)||[""];for(i=b.length;i--;){g=rc.exec(b[i])||[];n=m=g[1];o=(g[2]||"").split(".").sort();if(n){g=c.event.special[n]||{};n=(f?g.delegateType:g.bindType)||n;g=c.event.special[n]||{};m=c.extend({type:n,origType:m,data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&c.expr.match.needsContext.test(f),namespace:o.join(".")},j);if(!(k=h[n])){k=h[n]=[];k.delegateCount=0;if(!g.setup||g.setup.call(a,e,o,l)===false)a.addEventListener?a.addEventListener(n,l,false):a.attachEvent&&a.attachEvent("on"+
n,l)}if(g.add){g.add.call(a,m);if(!m.handler.guid)m.handler.guid=d.guid}f?k.splice(k.delegateCount++,0,m):k.push(m);c.event.global[n]=true}}a=null}},remove:function(a,b,d,e,f){var g,h,i,j,l,m,k,n,o,p,q,r=c.hasData(a)&&c._data(a);if(r&&(m=r.events)){b=(b||"").match(N)||[""];for(l=b.length;l--;){i=rc.exec(b[l])||[];o=q=i[1];p=(i[2]||"").split(".").sort();if(o){k=c.event.special[o]||{};o=(e?k.delegateType:k.bindType)||o;n=m[o]||[];i=i[2]&&RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)");for(j=g=n.length;g--;){h=
n[g];if((f||q===h.origType)&&(!d||d.guid===h.guid)&&(!i||i.test(h.namespace))&&(!e||e===h.selector||e==="**"&&h.selector)){n.splice(g,1);h.selector&&n.delegateCount--;k.remove&&k.remove.call(a,h)}}if(j&&!n.length){(!k.teardown||k.teardown.call(a,p,r.handle)===false)&&c.removeEvent(a,o,r.handle);delete m[o]}}else for(o in m)c.event.remove(a,o+b[l],d,e,true)}if(c.isEmptyObject(m)){delete r.handle;c._removeData(a,"events")}}},trigger:function(a,b,d,e){var f,g,h,i,j,l,m=[d||p],k=ja.call(a,"type")?a.type:
a;j=ja.call(a,"namespace")?a.namespace.split("."):[];h=f=d=d||p;if(!(d.nodeType===3||d.nodeType===8)&&!qc.test(k+c.event.triggered)){if(k.indexOf(".")>=0){j=k.split(".");k=j.shift();j.sort()}g=k.indexOf(":")<0&&"on"+k;a=a[c.expando]?a:new c.Event(k,typeof a==="object"&&a);a.isTrigger=e?2:3;a.namespace=j.join(".");a.namespace_re=a.namespace?RegExp("(^|\\.)"+j.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;a.result=void 0;if(!a.target)a.target=d;b=b==null?[a]:c.makeArray(b,[a]);j=c.event.special[k]||{};if(e||
!(j.trigger&&j.trigger.apply(d,b)===false)){if(!e&&!j.noBubble&&!c.isWindow(d)){i=j.delegateType||k;if(!qc.test(i+k))h=h.parentNode;for(;h;h=h.parentNode){m.push(h);f=h}if(f===(d.ownerDocument||p))m.push(f.defaultView||f.parentWindow||q)}for(l=0;(h=m[l++])&&!a.isPropagationStopped();){a.type=l>1?i:j.bindType||k;(f=(c._data(h,"events")||{})[a.type]&&c._data(h,"handle"))&&f.apply(h,b);(f=g&&h[g])&&(c.acceptData(h)&&f.apply&&f.apply(h,b)===false)&&a.preventDefault()}a.type=k;if(!e&&!a.isDefaultPrevented()&&
(!j._default||j._default.apply(m.pop(),b)===false)&&c.acceptData(d)&&g&&d[k]&&!c.isWindow(d)){(f=d[g])&&(d[g]=null);c.event.triggered=k;try{d[k]()}catch(n){}c.event.triggered=void 0;f&&(d[g]=f)}return a.result}}},dispatch:function(a){var a=c.event.fix(a),b,d,e,f,g=[],h=Z.call(arguments);b=(c._data(this,"events")||{})[a.type]||[];var i=c.event.special[a.type]||{};h[0]=a;a.delegateTarget=this;if(!(i.preDispatch&&i.preDispatch.call(this,a)===false)){g=c.event.handlers.call(this,a,b);for(b=0;(e=g[b++])&&
!a.isPropagationStopped();){a.currentTarget=e.elem;for(f=0;(d=e.handlers[f++])&&!a.isImmediatePropagationStopped();)if(!a.namespace_re||a.namespace_re.test(d.namespace)){a.handleObj=d;a.data=d.data;d=((c.event.special[d.origType]||{}).handle||d.handler).apply(e.elem,h);if(d!==void 0&&(a.result=d)===false){a.preventDefault();a.stopPropagation()}}}i.postDispatch&&i.postDispatch.call(this,a);return a.result}},handlers:function(a,b){var d,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||
a.type!=="click"))for(;j!=this;j=j.parentNode||this)if(j.nodeType===1&&(j.disabled!==true||a.type!=="click")){f=[];for(g=0;g<i;g++){e=b[g];d=e.selector+" ";f[d]===void 0&&(f[d]=e.needsContext?c(d,this).index(j)>=0:c.find(d,this,null,[j]).length);f[d]&&f.push(e)}f.length&&h.push({elem:j,handlers:f})}i<b.length&&h.push({elem:this,handlers:b.slice(i)});return h},fix:function(a){if(a[c.expando])return a;var b,d,e;b=a.type;var f=a,g=this.fixHooks[b];g||(this.fixHooks[b]=g=wd.test(b)?this.mouseHooks:vd.test(b)?
this.keyHooks:{});e=g.props?this.props.concat(g.props):this.props;a=new c.Event(f);for(b=e.length;b--;){d=e[b];a[d]=f[d]}if(!a.target)a.target=f.srcElement||p;if(a.target.nodeType===3)a.target=a.target.parentNode;a.metaKey=!!a.metaKey;return g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(a,b){if(a.which==
null)a.which=b.charCode!=null?b.charCode:b.keyCode;return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f=b.button,g=b.fromElement;if(a.pageX==null&&b.clientX!=null){c=a.target.ownerDocument||p;e=c.documentElement;c=c.body;a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0);a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||
c&&c.clientTop||0)}if(!a.relatedTarget&&g)a.relatedTarget=g===a.target?b.toElement:g;if(!a.which&&f!==void 0)a.which=f&1?1:f&2?3:f&4?2:0;return a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==zb()&&this.focus)try{this.focus();return false}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){if(this===zb()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(c.nodeName(this,"input")&&this.type==="checkbox"&&this.click){this.click();
return false}},_default:function(a){return c.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){if(a.result!==void 0)a.originalEvent.returnValue=a.result}}},simulate:function(a,b,d,e){a=c.extend(new c.Event,d,{type:a,isSimulated:true,originalEvent:{}});e?c.event.trigger(a,null,b):c.event.dispatch.call(b,a);a.isDefaultPrevented()&&d.preventDefault()}};c.removeEvent=p.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,false)}:function(a,b,c){b="on"+b;if(a.detachEvent){typeof a[b]===
M&&(a[b]=null);a.detachEvent(b,c)}};c.Event=function(a,b){if(!(this instanceof c.Event))return new c.Event(a,b);if(a&&a.type){this.originalEvent=a;this.type=a.type;this.isDefaultPrevented=a.defaultPrevented||a.returnValue===false||a.getPreventDefault&&a.getPreventDefault()?ua:ha}else this.type=a;b&&c.extend(this,b);this.timeStamp=a&&a.timeStamp||c.now();this[c.expando]=true};c.Event.prototype={isDefaultPrevented:ha,isPropagationStopped:ha,isImmediatePropagationStopped:ha,preventDefault:function(){var a=
this.originalEvent;this.isDefaultPrevented=ua;if(a)a.preventDefault?a.preventDefault():a.returnValue=false},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ua;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ua;this.stopPropagation()}};c.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){c.event.special[a]={delegateType:b,bindType:b,handle:function(a){var e,f=a.relatedTarget,
g=a.handleObj;if(!f||f!==this&&!c.contains(this,f)){a.type=g.origType;e=g.handler.apply(this,arguments);a.type=b}return e}}});c.support.submitBubbles||(c.event.special.submit={setup:function(){if(c.nodeName(this,"form"))return false;c.event.add(this,"click._submit keypress._submit",function(a){a=a.target;if((a=c.nodeName(a,"input")||c.nodeName(a,"button")?a.form:void 0)&&!c._data(a,"submitBubbles")){c.event.add(a,"submit._submit",function(a){a._submit_bubble=true});c._data(a,"submitBubbles",true)}})},
postDispatch:function(a){if(a._submit_bubble){delete a._submit_bubble;this.parentNode&&!a.isTrigger&&c.event.simulate("submit",this.parentNode,a,true)}},teardown:function(){if(c.nodeName(this,"form"))return false;c.event.remove(this,"._submit")}});c.support.changeBubbles||(c.event.special.change={setup:function(){if(ob.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){c.event.add(this,"propertychange._change",function(a){if(a.originalEvent.propertyName==="checked")this._just_changed=
true});c.event.add(this,"click._change",function(a){if(this._just_changed&&!a.isTrigger)this._just_changed=false;c.event.simulate("change",this,a,true)})}return false}c.event.add(this,"beforeactivate._change",function(a){a=a.target;if(ob.test(a.nodeName)&&!c._data(a,"changeBubbles")){c.event.add(a,"change._change",function(a){this.parentNode&&(!a.isSimulated&&!a.isTrigger)&&c.event.simulate("change",this.parentNode,a,true)});c._data(a,"changeBubbles",true)}})},handle:function(a){var b=a.target;if(this!==
b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){c.event.remove(this,"._change");return!ob.test(this.nodeName)}});c.support.focusinBubbles||c.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){c.event.simulate(b,a.target,c.event.fix(a),true)};c.event.special[b]={setup:function(){d++===0&&p.addEventListener(a,e,true)},teardown:function(){--d===0&&p.removeEventListener(a,e,true)}}});c.fn.extend({on:function(a,
b,d,e,f){var g,h;if(typeof a==="object"){if(typeof b!=="string"){d=d||b;b=void 0}for(g in a)this.on(g,b,d,a[g],f);return this}if(d==null&&e==null){e=b;d=b=void 0}else if(e==null)if(typeof b==="string"){e=d;d=void 0}else{e=d;d=b;b=void 0}if(e===false)e=ha;else if(!e)return this;if(f===1){h=e;e=function(a){c().off(a);return h.apply(this,arguments)};e.guid=h.guid||(h.guid=c.guid++)}return this.each(function(){c.event.add(this,a,e,d,b)})},one:function(a,b,c,e){return this.on(a,b,c,e,1)},off:function(a,
b,d){var e;if(a&&a.preventDefault&&a.handleObj){e=a.handleObj;c(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof a==="object"){for(e in a)this.off(e,b,a[e]);return this}if(b===false||typeof b==="function"){d=b;b=void 0}d===false&&(d=ha);return this.each(function(){c.event.remove(this,a,d,b)})},trigger:function(a,b){return this.each(function(){c.event.trigger(a,b,this)})},triggerHandler:function(a,b){var d=this[0];if(d)return c.event.trigger(a,
b,d,true)}});var Kc=/^.[^:#\[\.,]*$/,xd=/^(?:parents|prev(?:Until|All))/,sc=c.expr.match.needsContext,yd={children:!0,contents:!0,next:!0,prev:!0};c.fn.extend({find:function(a){var b,d=[],e=this,f=e.length;if(typeof a!=="string")return this.pushStack(c(a).filter(function(){for(b=0;b<f;b++)if(c.contains(e[b],this))return true}));for(b=0;b<f;b++)c.find(a,e[b],d);d=this.pushStack(f>1?c.unique(d):d);d.selector=this.selector?this.selector+" "+a:a;return d},has:function(a){var b,d=c(a,this),e=d.length;
return this.filter(function(){for(b=0;b<e;b++)if(c.contains(this,d[b]))return true})},not:function(a){return this.pushStack(Ra(this,a||[],true))},filter:function(a){return this.pushStack(Ra(this,a||[],false))},is:function(a){return!!Ra(this,typeof a==="string"&&sc.test(a)?c(a):a||[],false).length},closest:function(a,b){for(var d,e=0,f=this.length,g=[],h=sc.test(a)||typeof a!=="string"?c(a,b||this.context):0;e<f;e++)for(d=this[e];d&&d!==b;d=d.parentNode)if(d.nodeType<11&&(h?h.index(d)>-1:d.nodeType===
1&&c.find.matchesSelector(d,a))){g.push(d);break}return this.pushStack(g.length>1?c.unique(g):g)},index:function(a){return!a?this[0]&&this[0].parentNode?this.first().prevAll().length:-1:typeof a==="string"?c.inArray(this[0],c(a)):c.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var d=typeof a==="string"?c(a,b):c.makeArray(a&&a.nodeType?[a]:a),d=c.merge(this.get(),d);return this.pushStack(c.unique(d))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}});c.each({parent:function(a){return(a=
a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return c.dir(a,"parentNode")},parentsUntil:function(a,b,d){return c.dir(a,"parentNode",d)},next:function(a){return Ab(a,"nextSibling")},prev:function(a){return Ab(a,"previousSibling")},nextAll:function(a){return c.dir(a,"nextSibling")},prevAll:function(a){return c.dir(a,"previousSibling")},nextUntil:function(a,b,d){return c.dir(a,"nextSibling",d)},prevUntil:function(a,b,d){return c.dir(a,"previousSibling",d)},siblings:function(a){return c.sibling((a.parentNode||
{}).firstChild,a)},children:function(a){return c.sibling(a.firstChild)},contents:function(a){return c.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:c.merge([],a.childNodes)}},function(a,b){c.fn[a]=function(d,e){var f=c.map(this,b,d);a.slice(-5)!=="Until"&&(e=d);e&&typeof e==="string"&&(f=c.filter(e,f));if(this.length>1){yd[a]||(f=c.unique(f));xd.test(a)&&(f=f.reverse())}return this.pushStack(f)}});c.extend({filter:function(a,b,d){var e=b[0];d&&(a=":not("+a+")");return b.length===
1&&e.nodeType===1?c.find.matchesSelector(e,a)?[e]:[]:c.find.matches(a,c.grep(b,function(a){return a.nodeType===1}))},dir:function(a,b,d){for(var e=[],a=a[b];a&&a.nodeType!==9&&(d===void 0||a.nodeType!==1||!c(a).is(d));){a.nodeType===1&&e.push(a);a=a[b]}return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var Cb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
zd=/ jQuery\d+="(?:null|\d+)"/g,tc=RegExp("<(?:"+Cb+")[\\s/>]","i"),pb=/^\s+/,uc=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vc=/<([\w:]+)/,wc=/<tbody/i,Ad=/<|&#?\w+;/,Bd=/<(?:script|style|link)/i,Ta=/^(?:checkbox|radio)$/i,Cd=/checked\s*(?:[^=]|=\s*.checked.)/i,xc=/^$|\/(?:java|ecma)script/i,Lc=/^true\/(.*)/,Dd=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,G={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],
param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:c.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},qb=Bb(p).appendChild(p.createElement("div"));G.optgroup=G.option;G.tbody=G.tfoot=G.colgroup=G.caption=G.thead;G.th=G.td;c.fn.extend({text:function(a){return c.access(this,function(a){return a===void 0?c.text(this):
this.empty().append((this[0]&&this[0].ownerDocument||p).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&Db(this,a).appendChild(a)})},prepend:function(){return this.domManip(arguments,function(a){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var b=Db(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&
this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var d,e=a?c.filter(a,this):this,f=0;(d=e[f])!=null;f++){!b&&d.nodeType===1&&c.cleanData(x(d));if(d.parentNode){b&&c.contains(d.ownerDocument,d)&&Sa(x(d,"script"));d.parentNode.removeChild(d)}}return this},empty:function(){for(var a,b=0;(a=this[b])!=null;b++){for(a.nodeType===1&&c.cleanData(x(a,false));a.firstChild;)a.removeChild(a.firstChild);
if(a.options&&c.nodeName(a,"select"))a.options.length=0}return this},clone:function(a,b){a=a==null?false:a;b=b==null?a:b;return this.map(function(){return c.clone(this,a,b)})},html:function(a){return c.access(this,function(a){var d=this[0]||{},e=0,f=this.length;if(a===void 0)return d.nodeType===1?d.innerHTML.replace(zd,""):void 0;if(typeof a==="string"&&!Bd.test(a)&&(c.support.htmlSerialize||!tc.test(a))&&(c.support.leadingWhitespace||!pb.test(a))&&!G[(vc.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(uc,
"<$1></$2>");try{for(;e<f;e++){d=this[e]||{};if(d.nodeType===1){c.cleanData(x(d,false));d.innerHTML=a}}d=0}catch(g){}}d&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=c.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;this.domManip(arguments,function(d){var e=a[b++],f=a[b++];if(f){if(e&&e.parentNode!==f)e=this.nextSibling;c(this).remove();f.insertBefore(d,e)}},true);return b?this:this.remove()},detach:function(a){return this.remove(a,true)},domManip:function(a,
b,d){var a=Zb.apply([],a),e,f,g,h,i=0,j=this.length,l=this,m=j-1,k=a[0],n=c.isFunction(k);if(n||!(j<=1||typeof k!=="string"||c.support.checkClone||!Cd.test(k)))return this.each(function(c){var e=l.eq(c);n&&(a[0]=k.call(this,c,e.html()));e.domManip(a,b,d)});if(j){h=c.buildFragment(a,this[0].ownerDocument,false,!d&&this);e=h.firstChild;h.childNodes.length===1&&(h=e);if(e){g=c.map(x(h,"script"),Eb);for(f=g.length;i<j;i++){e=h;if(i!==m){e=c.clone(e,true,true);f&&c.merge(g,x(e,"script"))}b.call(this[i],
e,i)}if(f){h=g[g.length-1].ownerDocument;c.map(g,Fb);for(i=0;i<f;i++){e=g[i];if(xc.test(e.type||"")&&!c._data(e,"globalEval")&&c.contains(h,e))e.src?c._evalUrl(e.src):c.globalEval((e.text||e.textContent||e.innerHTML||"").replace(Dd,""))}}h=e=null}}return this}});c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){c.fn[a]=function(a){for(var e=0,f=[],g=c(a),h=g.length-1;e<=h;e++){a=e===h?this:this.clone(true);c(g[e])[b](a);
Xa.apply(f,a.get())}return this.pushStack(f)}});c.extend({clone:function(a,b,d){var e,f,g,h,i,j=c.contains(a.ownerDocument,a);if(c.support.html5Clone||c.isXMLDoc(a)||!tc.test("<"+a.nodeName+">"))g=a.cloneNode(true);else{qb.innerHTML=a.outerHTML;qb.removeChild(g=qb.firstChild)}if((!c.support.noCloneEvent||!c.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!c.isXMLDoc(a)){e=x(g);i=x(a);for(h=0;(f=i[h])!=null;++h)if(e[h]){var l=e[h],m=void 0,k=void 0,n=void 0;if(l.nodeType===1){m=l.nodeName.toLowerCase();
if(!c.support.noCloneEvent&&l[c.expando]){n=c._data(l);for(k in n.events)c.removeEvent(l,k,n.handle);l.removeAttribute(c.expando)}if(m==="script"&&l.text!==f.text){Eb(l).text=f.text;Fb(l)}else if(m==="object"){if(l.parentNode)l.outerHTML=f.outerHTML;if(c.support.html5Clone&&f.innerHTML&&!c.trim(l.innerHTML))l.innerHTML=f.innerHTML}else if(m==="input"&&Ta.test(f.type)){l.defaultChecked=l.checked=f.checked;if(l.value!==f.value)l.value=f.value}else if(m==="option")l.defaultSelected=l.selected=f.defaultSelected;
else if(m==="input"||m==="textarea")l.defaultValue=f.defaultValue}}}if(b)if(d){i=i||x(a);e=e||x(g);for(h=0;(f=i[h])!=null;h++)Gb(f,e[h])}else Gb(a,g);e=x(g,"script");e.length>0&&Sa(e,!j&&x(a,"script"));return g},buildFragment:function(a,b,d,e){for(var f,g,h,i,j,l,m=a.length,k=Bb(b),n=[],o=0;o<m;o++)if((g=a[o])||g===0)if(c.type(g)==="object")c.merge(n,g.nodeType?[g]:g);else if(Ad.test(g)){h=h||k.appendChild(b.createElement("div"));i=(vc.exec(g)||["",""])[1].toLowerCase();l=G[i]||G._default;h.innerHTML=
l[1]+g.replace(uc,"<$1></$2>")+l[2];for(f=l[0];f--;)h=h.lastChild;!c.support.leadingWhitespace&&pb.test(g)&&n.push(b.createTextNode(pb.exec(g)[0]));if(!c.support.tbody)for(f=(g=i==="table"&&!wc.test(g)?h.firstChild:l[1]==="<table>"&&!wc.test(g)?h:0)&&g.childNodes.length;f--;)c.nodeName(j=g.childNodes[f],"tbody")&&!j.childNodes.length&&g.removeChild(j);c.merge(n,h.childNodes);for(h.textContent="";h.firstChild;)h.removeChild(h.firstChild);h=k.lastChild}else n.push(b.createTextNode(g));h&&k.removeChild(h);
c.support.appendChecked||c.grep(x(n,"input"),Mc);for(o=0;g=n[o++];)if(!(e&&c.inArray(g,e)!==-1)){a=c.contains(g.ownerDocument,g);h=x(k.appendChild(g),"script");a&&Sa(h);if(d)for(f=0;g=h[f++];)xc.test(g.type||"")&&d.push(g)}return k},cleanData:function(a,b){for(var d,e,f,g,h=0,i=c.expando,j=c.cache,l=c.support.deleteExpando,m=c.event.special;(d=a[h])!=null;h++)if(b||c.acceptData(d))if(g=(f=d[i])&&j[f]){if(g.events)for(e in g.events)m[e]?c.event.remove(d,e):c.removeEvent(d,e,g.handle);if(j[f]){delete j[f];
l?delete d[i]:typeof d.removeAttribute!==M?d.removeAttribute(i):d[i]=null;ga.push(f)}}},_evalUrl:function(a){return c.ajax({url:a,type:"GET",dataType:"script",async:false,global:false,"throws":true})}});c.fn.extend({wrapAll:function(a){if(c.isFunction(a))return this.each(function(b){c(this).wrapAll(a.call(this,b))});if(this[0]){var b=c(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var a=this;a.firstChild&&a.firstChild.nodeType===1;)a=a.firstChild;
return a}).append(this)}return this},wrapInner:function(a){return c.isFunction(a)?this.each(function(b){c(this).wrapInner(a.call(this,b))}):this.each(function(){var b=c(this),d=b.contents();d.length?d.wrapAll(a):b.append(a)})},wrap:function(a){var b=c.isFunction(a);return this.each(function(d){c(this).wrapAll(b?a.call(this,d):a)})},unwrap:function(){return this.parent().each(function(){c.nodeName(this,"body")||c(this).replaceWith(this.childNodes)}).end()}});var pa,X,Y,rb=/alpha\([^)]*\)/i,Ed=/opacity\s*=\s*([^)]*)/,
Fd=/^(top|right|bottom|left)$/,Gd=/^(none|table(?!-c[ea]).+)/,yc=/^margin/,Nc=RegExp("^("+Aa+")(.*)$","i"),va=RegExp("^("+Aa+")(?!px)[a-z%]+$","i"),Hd=RegExp("^([+-])=("+Aa+")","i"),Ob={BODY:"block"},Id={position:"absolute",visibility:"hidden",display:"block"},zc={letterSpacing:0,fontWeight:400},W=["Top","Right","Bottom","Left"],Ib=["Webkit","O","Moz","ms"];c.fn.extend({css:function(a,b){return c.access(this,function(a,b,f){var g,h={},i=0;if(c.isArray(b)){g=X(a);for(f=b.length;i<f;i++)h[b[i]]=c.css(a,
b[i],false,g);return h}return f!==void 0?c.style(a,b,f):c.css(a,b)},a,b,arguments.length>1)},show:function(){return Jb(this,true)},hide:function(){return Jb(this)},toggle:function(a){return typeof a==="boolean"?a?this.show():this.hide():this.each(function(){oa(this)?c(this).show():c(this).hide()})}});c.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Y(a,"opacity");return c===""?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,
zIndex:!0,zoom:!0},cssProps:{"float":c.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,d,e){if(a&&!(a.nodeType===3||a.nodeType===8||!a.style)){var f,g,h,i=c.camelCase(b),j=a.style,b=c.cssProps[i]||(c.cssProps[i]=Hb(j,i));h=c.cssHooks[b]||c.cssHooks[i];if(d!==void 0){g=typeof d;if(g==="string"&&(f=Hd.exec(d))){d=(f[1]+1)*f[2]+parseFloat(c.css(a,b));g="number"}if(!(d==null||g==="number"&&isNaN(d))){g==="number"&&!c.cssNumber[i]&&(d=d+"px");!c.support.clearCloneStyle&&(d===""&&b.indexOf("background")===
0)&&(j[b]="inherit");if(!h||!("set"in h)||(d=h.set(a,d,e))!==void 0)try{j[b]=d}catch(l){}}}else return h&&"get"in h&&(f=h.get(a,false,e))!==void 0?f:j[b]}},css:function(a,b,d,e){var f,g;g=c.camelCase(b);b=c.cssProps[g]||(c.cssProps[g]=Hb(a.style,g));(g=c.cssHooks[b]||c.cssHooks[g])&&"get"in g&&(f=g.get(a,true,d));f===void 0&&(f=Y(a,b,e));f==="normal"&&b in zc&&(f=zc[b]);if(d===""||d){a=parseFloat(f);return d===true||c.isNumeric(a)?a||0:f}return f}});q.getComputedStyle?(X=function(a){return q.getComputedStyle(a,
null)},Y=function(a,b,d){var e,f=(d=d||X(a))?d.getPropertyValue(b)||d[b]:void 0,g=a.style;if(d){f===""&&!c.contains(a.ownerDocument,a)&&(f=c.style(a,b));if(va.test(f)&&yc.test(b)){a=g.width;b=g.minWidth;e=g.maxWidth;g.minWidth=g.maxWidth=g.width=f;f=d.width;g.width=a;g.minWidth=b;g.maxWidth=e}}return f}):p.documentElement.currentStyle&&(X=function(a){return a.currentStyle},Y=function(a,b,c){var e,f,g=(c=c||X(a))?c[b]:void 0,h=a.style;g==null&&(h&&h[b])&&(g=h[b]);if(va.test(g)&&!Fd.test(b)){c=h.left;
if(f=(e=a.runtimeStyle)&&e.left)e.left=a.currentStyle.left;h.left=b==="fontSize"?"1em":g;g=h.pixelLeft+"px";h.left=c;if(f)e.left=f}return g===""?"auto":g});c.each(["height","width"],function(a,b){c.cssHooks[b]={get:function(a,e,f){if(e)return a.offsetWidth===0&&Gd.test(c.css(a,"display"))?c.swap(a,Id,function(){return Nb(a,b,f)}):Nb(a,b,f)},set:function(a,e,f){var g=f&&X(a);return Lb(a,e,f?Mb(a,b,f,c.support.boxSizing&&c.css(a,"boxSizing",false,g)==="border-box",g):0)}}});c.support.opacity||(c.cssHooks.opacity=
{get:function(a,b){return Ed.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var d=a.style,e=a.currentStyle,f=c.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=e&&e.filter||d.filter||"";d.zoom=1;if((b>=1||b==="")&&c.trim(g.replace(rb,""))===""&&d.removeAttribute){d.removeAttribute("filter");if(b===""||e&&!e.filter)return}d.filter=rb.test(g)?g.replace(rb,f):g+" "+f}});c(function(){if(!c.support.reliableMarginRight)c.cssHooks.marginRight=
{get:function(a,b){if(b)return c.swap(a,{display:"inline-block"},Y,[a,"marginRight"])}};!c.support.pixelPosition&&c.fn.position&&c.each(["top","left"],function(a,b){c.cssHooks[b]={get:function(a,e){if(e){e=Y(a,b);return va.test(e)?c(a).position()[b]+"px":e}}}})});c.expr&&c.expr.filters&&(c.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!c.support.reliableHiddenOffsets&&(a.style&&a.style.display||c.css(a,"display"))==="none"},c.expr.filters.visible=function(a){return!c.expr.filters.hidden(a)});
c.each({margin:"",padding:"",border:"Width"},function(a,b){c.cssHooks[a+b]={expand:function(c){for(var e=0,f={},c=typeof c==="string"?c.split(" "):[c];e<4;e++)f[a+W[e]+b]=c[e]||c[e-2]||c[0];return f}};if(!yc.test(a))c.cssHooks[a+b].set=Lb});var Jd=/%20/g,Oc=/\[\]$/,Ac=/\r?\n/g,Kd=/^(?:submit|button|image|reset|file)$/i,Ld=/^(?:input|select|textarea|keygen)/i;c.fn.extend({serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=c.prop(this,
"elements");return a?c.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!c(this).is(":disabled")&&Ld.test(this.nodeName)&&!Kd.test(a)&&(this.checked||!Ta.test(a))}).map(function(a,b){var d=c(this).val();return d==null?null:c.isArray(d)?c.map(d,function(a){return{name:b.name,value:a.replace(Ac,"\r\n")}}):{name:b.name,value:d.replace(Ac,"\r\n")}}).get()}});c.param=function(a,b){var d,e=[],f=function(a,b){b=c.isFunction(b)?b():b==null?"":b;e[e.length]=encodeURIComponent(a)+"="+
encodeURIComponent(b)};b===void 0&&(b=c.ajaxSettings&&c.ajaxSettings.traditional);if(c.isArray(a)||a.jquery&&!c.isPlainObject(a))c.each(a,function(){f(this.name,this.value)});else for(d in a)Ua(d,a[d],b,f);return e.join("&").replace(Jd,"+")};c.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){c.fn[b]=function(a,c){return arguments.length>
0?this.on(b,null,a,c):this.trigger(b)}});c.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,e){return this.on(b,a,c,e)},undelegate:function(a,b,c){return arguments.length===1?this.off(a,"**"):this.off(b,a||"**",c)}});var fa,V,sb=c.now(),tb=/\?/,Md=/#.*$/,Bc=/([?&])_=[^&]*/,Nd=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Od=/^(?:GET|HEAD)$/,Pd=/^\/\//,Cc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,
Dc=c.fn.load,Ec={},Va={},Fc="*/".concat("*");try{V=Qc.href}catch(Vd){V=p.createElement("a"),V.href="",V=V.href}fa=Cc.exec(V.toLowerCase())||[];c.fn.load=function(a,b,d){if(typeof a!=="string"&&Dc)return Dc.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");if(i>=0){e=a.slice(i,a.length);a=a.slice(0,i)}if(c.isFunction(b)){d=b;b=void 0}else b&&typeof b==="object"&&(g="POST");h.length>0&&c.ajax({url:a,type:g,dataType:"html",data:b}).done(function(a){f=arguments;h.html(e?c("<div>").append(c.parseHTML(a)).find(e):
a)}).complete(d&&function(a,b){h.each(d,f||[a.responseText,b,a])});return this};c.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){c.fn[b]=function(a){return this.on(b,a)}});c.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:V,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(fa[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Fc,text:"text/plain",
html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":c.parseJSON,"text xml":c.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Wa(Wa(a,c.ajaxSettings),b):Wa(c.ajaxSettings,a)},ajaxPrefilter:Qb(Ec),ajaxTransport:Qb(Va),ajax:function(a,b){function d(a,b,d,e){var f,
m,s,t;t=b;if(u!==2){u=2;i&&clearTimeout(i);l=void 0;h=e||"";w.readyState=a>0?4:0;e=a>=200&&a<300||a===304;if(d){s=k;for(var v=w,x,C,z,D,A=s.contents,B=s.dataTypes;B[0]==="*";){B.shift();C===void 0&&(C=s.mimeType||v.getResponseHeader("Content-Type"))}if(C)for(D in A)if(A[D]&&A[D].test(C)){B.unshift(D);break}if(B[0]in d)z=B[0];else{for(D in d){if(!B[0]||s.converters[D+" "+B[0]]){z=D;break}x||(x=D)}z=z||x}if(z){z!==B[0]&&B.unshift(z);s=d[z]}else s=void 0}a:{d=k;x=s;C=w;z=e;var G,I,F,v={},A=d.dataTypes.slice();
if(A[1])for(I in d.converters)v[I.toLowerCase()]=d.converters[I];for(D=A.shift();D;){d.responseFields[D]&&(C[d.responseFields[D]]=x);!F&&(z&&d.dataFilter)&&(x=d.dataFilter(x,d.dataType));F=D;if(D=A.shift())if(D==="*")D=F;else if(F!=="*"&&F!==D){I=v[F+" "+D]||v["* "+D];if(!I)for(G in v){s=G.split(" ");if(s[1]===D)if(I=v[F+" "+s[0]]||v["* "+s[0]]){if(I===true)I=v[G];else if(v[G]!==true){D=s[0];A.unshift(s[1])}break}}if(I!==true)if(I&&d["throws"])x=I(x);else try{x=I(x)}catch(H){s={state:"parsererror",
error:I?H:"No conversion from "+F+" to "+D};break a}}}s={state:"success",data:x}}if(e){if(k.ifModified){(t=w.getResponseHeader("Last-Modified"))&&(c.lastModified[g]=t);(t=w.getResponseHeader("etag"))&&(c.etag[g]=t)}if(a===204||k.type==="HEAD")t="nocontent";else if(a===304)t="notmodified";else{t=s.state;f=s.data;m=s.error;e=!m}}else{m=t;if(a||!t){t="error";a<0&&(a=0)}}w.status=a;w.statusText=(b||t)+"";e?p.resolveWith(n,[f,t,w]):p.rejectWith(n,[w,t,m]);w.statusCode(q);q=void 0;j&&o.trigger(e?"ajaxSuccess":
"ajaxError",[w,k,e?f:m]);r.fireWith(n,[w,t]);if(j){o.trigger("ajaxComplete",[w,k]);--c.active||c.event.trigger("ajaxStop")}}}if(typeof a==="object"){b=a;a=void 0}var b=b||{},e,f,g,h,i,j,l,m,k=c.ajaxSetup({},b),n=k.context||k,o=k.context&&(n.nodeType||n.jquery)?c(n):c.event,p=c.Deferred(),r=c.Callbacks("once memory"),q=k.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(u===2){if(!m)for(m={};b=Nd.exec(h);)m[b[1].toLowerCase()]=b[2];b=m[a.toLowerCase()]}return b==
null?null:b},getAllResponseHeaders:function(){return u===2?h:null},setRequestHeader:function(a,b){var c=a.toLowerCase();if(!u){a=t[c]=t[c]||a;s[a]=b}return this},overrideMimeType:function(a){if(!u)k.mimeType=a;return this},statusCode:function(a){var b;if(a)if(u<2)for(b in a)q[b]=[q[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){a=a||v;l&&l.abort(a);d(0,a);return this}};p.promise(w).complete=r.add;w.success=w.done;w.error=w.fail;k.url=((a||k.url||V)+"").replace(Md,"").replace(Pd,
fa[1]+"//");k.type=b.method||b.type||k.method||k.type;k.dataTypes=c.trim(k.dataType||"*").toLowerCase().match(N)||[""];if(k.crossDomain==null){e=Cc.exec(k.url.toLowerCase());k.crossDomain=!(!e||!(e[1]!==fa[1]||e[2]!==fa[2]||(e[3]||(e[1]==="http:"?"80":"443"))!==(fa[3]||(fa[1]==="http:"?"80":"443"))))}if(k.data&&k.processData&&typeof k.data!=="string")k.data=c.param(k.data,k.traditional);Rb(Ec,k,b,w);if(u===2)return w;(j=k.global)&&c.active++===0&&c.event.trigger("ajaxStart");k.type=k.type.toUpperCase();
k.hasContent=!Od.test(k.type);g=k.url;if(!k.hasContent){if(k.data){g=k.url=k.url+((tb.test(g)?"&":"?")+k.data);delete k.data}if(k.cache===false)k.url=Bc.test(g)?g.replace(Bc,"$1_="+sb++):g+(tb.test(g)?"&":"?")+"_="+sb++}if(k.ifModified){c.lastModified[g]&&w.setRequestHeader("If-Modified-Since",c.lastModified[g]);c.etag[g]&&w.setRequestHeader("If-None-Match",c.etag[g])}(k.data&&k.hasContent&&k.contentType!==false||b.contentType)&&w.setRequestHeader("Content-Type",k.contentType);w.setRequestHeader("Accept",
k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+(k.dataTypes[0]!=="*"?", "+Fc+"; q=0.01":""):k.accepts["*"]);for(f in k.headers)w.setRequestHeader(f,k.headers[f]);if(k.beforeSend&&(k.beforeSend.call(n,w,k)===false||u===2))return w.abort();v="abort";for(f in{success:1,error:1,complete:1})w[f](k[f]);if(l=Rb(Va,k,b,w)){w.readyState=1;j&&o.trigger("ajaxSend",[w,k]);k.async&&k.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},k.timeout));try{u=1;l.send(s,d)}catch(x){if(u<2)d(-1,
x);else throw x;}}else d(-1,"No Transport");return w},getJSON:function(a,b,d){return c.get(a,b,d,"json")},getScript:function(a,b){return c.get(a,void 0,b,"script")}});c.each(["get","post"],function(a,b){c[b]=function(a,e,f,g){if(c.isFunction(e)){g=g||f;f=e;e=void 0}return c.ajax({url:a,type:b,dataType:g,data:e,success:f})}});c.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){c.globalEval(a);
return a}}});c.ajaxPrefilter("script",function(a){if(a.cache===void 0)a.cache=false;if(a.crossDomain){a.type="GET";a.global=false}});c.ajaxTransport("script",function(a){if(a.crossDomain){var b,d=p.head||c("head")[0]||p.documentElement;return{send:function(c,f){b=p.createElement("script");b.async=true;if(a.scriptCharset)b.charset=a.scriptCharset;b.src=a.url;b.onload=b.onreadystatechange=function(a,c){if(c||!b.readyState||/loaded|complete/.test(b.readyState)){b.onload=b.onreadystatechange=null;b.parentNode&&
b.parentNode.removeChild(b);b=null;c||f(200,"success")}};d.insertBefore(b,d.firstChild)},abort:function(){if(b)b.onload(void 0,true)}}}});var Gc=[],ub=/(=)\?(?=&|$)|\?\?/;c.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||c.expando+"_"+sb++;this[a]=true;return a}});c.ajaxPrefilter("json jsonp",function(a,b,d){var e,f,g,h=a.jsonp!==false&&(ub.test(a.url)?"url":typeof a.data==="string"&&!(a.contentType||"").indexOf("application/x-www-form-urlencoded")&&ub.test(a.data)&&"data");if(h||
a.dataTypes[0]==="jsonp"){e=a.jsonpCallback=c.isFunction(a.jsonpCallback)?a.jsonpCallback():a.jsonpCallback;if(h)a[h]=a[h].replace(ub,"$1"+e);else if(a.jsonp!==false)a.url=a.url+((tb.test(a.url)?"&":"?")+a.jsonp+"="+e);a.converters["script json"]=function(){g||c.error(e+" was not called");return g[0]};a.dataTypes[0]="json";f=q[e];q[e]=function(){g=arguments};d.always(function(){q[e]=f;if(a[e]){a.jsonpCallback=b.jsonpCallback;Gc.push(e)}g&&c.isFunction(f)&&f(g[0]);g=f=void 0});return"script"}});var na,
ta,Qd=0,vb=q.ActiveXObject&&function(){for(var a in na)na[a](void 0,true)};c.ajaxSettings.xhr=q.ActiveXObject?function(){var a;if(!(a=!this.isLocal&&Sb()))a:{try{a=new q.ActiveXObject("Microsoft.XMLHTTP");break a}catch(b){}a=void 0}return a}:Sb;ta=c.ajaxSettings.xhr();c.support.cors=!!ta&&"withCredentials"in ta;(ta=c.support.ajax=!!ta)&&c.ajaxTransport(function(a){if(!a.crossDomain||c.support.cors){var b;return{send:function(d,e){var f,g,h=a.xhr();a.username?h.open(a.type,a.url,a.async,a.username,
a.password):h.open(a.type,a.url,a.async);if(a.xhrFields)for(g in a.xhrFields)h[g]=a.xhrFields[g];a.mimeType&&h.overrideMimeType&&h.overrideMimeType(a.mimeType);!a.crossDomain&&!d["X-Requested-With"]&&(d["X-Requested-With"]="XMLHttpRequest");try{for(g in d)h.setRequestHeader(g,d[g])}catch(i){}h.send(a.hasContent&&a.data||null);b=function(d,g){var i,k,n,o;try{if(b&&(g||h.readyState===4)){b=void 0;if(f){h.onreadystatechange=c.noop;vb&&delete na[f]}if(g)h.readyState!==4&&h.abort();else{o={};i=h.status;
k=h.getAllResponseHeaders();if(typeof h.responseText==="string")o.text=h.responseText;try{n=h.statusText}catch(p){n=""}!i&&a.isLocal&&!a.crossDomain?i=o.text?200:404:i===1223&&(i=204)}}}catch(q){g||e(-1,q)}o&&e(i,n,o,k)};if(a.async)if(h.readyState===4)setTimeout(b);else{f=++Qd;if(vb){if(!na){na={};c(q).unload(vb)}na[f]=b}h.onreadystatechange=b}else b()},abort:function(){b&&b(void 0,true)}}}});var ia,Oa,Rd=/^(?:toggle|show|hide)$/,Hc=RegExp("^(?:([+-])=|)("+Aa+")([a-z%]*)$","i"),Sd=/queueHooks$/,wa=
[function(a,b,d){var e,f,g,h,i,j=this,l={},m=a.style,k=a.nodeType&&oa(a),n=c._data(a,"fxshow");if(!d.queue){h=c._queueHooks(a,"fx");if(h.unqueued==null){h.unqueued=0;i=h.empty.fire;h.empty.fire=function(){h.unqueued||i()}}h.unqueued++;j.always(function(){j.always(function(){h.unqueued--;c.queue(a,"fx").length||h.empty.fire()})})}if(a.nodeType===1&&("height"in b||"width"in b)){d.overflow=[m.overflow,m.overflowX,m.overflowY];if(c.css(a,"display")==="inline"&&c.css(a,"float")==="none")!c.support.inlineBlockNeedsLayout||
Kb(a.nodeName)==="inline"?m.display="inline-block":m.zoom=1}if(d.overflow){m.overflow="hidden";c.support.shrinkWrapBlocks||j.always(function(){m.overflow=d.overflow[0];m.overflowX=d.overflow[1];m.overflowY=d.overflow[2]})}for(e in b){f=b[e];if(Rd.exec(f)){delete b[e];g=g||f==="toggle";if(f!==(k?"hide":"show"))l[e]=n&&n[e]||c.style(a,e)}}if(!c.isEmptyObject(l)){if(n){if("hidden"in n)k=n.hidden}else n=c._data(a,"fxshow",{});if(g)n.hidden=!k;k?c(a).show():j.done(function(){c(a).hide()});j.done(function(){var b;
c._removeData(a,"fxshow");for(b in l)c.style(a,b,l[b])});for(e in l){b=Ub(k?n[e]:0,e,j);if(!(e in n)){n[e]=b.start;if(k){b.end=b.start;b.start=e==="width"||e==="height"?1:0}}}}}],qa={"*":[function(a,b){var d=this.createTween(a,b),e=d.cur(),f=Hc.exec(b),g=f&&f[3]||(c.cssNumber[a]?"":"px"),h=(c.cssNumber[a]||g!=="px"&&+e)&&Hc.exec(c.css(d.elem,a)),i=1,j=20;if(h&&h[3]!==g){g=g||h[3];f=f||[];h=+e||1;do{i=i||".5";h=h/i;c.style(d.elem,a,h+g)}while(i!==(i=d.cur()/e)&&i!==1&&--j)}if(f){h=d.start=+h||+e||
0;d.unit=g;d.end=f[1]?h+(f[1]+1)*f[2]:+f[2]}return d}]};c.Animation=c.extend(Vb,{tweener:function(a,b){if(c.isFunction(a)){b=a;a=["*"]}else a=a.split(" ");for(var d,e=0,f=a.length;e<f;e++){d=a[e];qa[d]=qa[d]||[];qa[d].unshift(b)}},prefilter:function(a,b){b?wa.unshift(a):wa.push(a)}});c.Tween=A;A.prototype={constructor:A,init:function(a,b,d,e,f,g){this.elem=a;this.prop=d;this.easing=f||"swing";this.options=b;this.start=this.now=this.cur();this.end=e;this.unit=g||(c.cssNumber[d]?"":"px")},cur:function(){var a=
A.propHooks[this.prop];return a&&a.get?a.get(this):A.propHooks._default.get(this)},run:function(a){var b,d=A.propHooks[this.prop];this.pos=this.options.duration?b=c.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):b=a;this.now=(this.end-this.start)*b+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);d&&d.set?d.set(this):A.propHooks._default.set(this);return this}};A.prototype.init.prototype=A.prototype;A.propHooks={_default:{get:function(a){if(a.elem[a.prop]!=
null&&(!a.elem.style||a.elem.style[a.prop]==null))return a.elem[a.prop];a=c.css(a.elem,a.prop,"");return!a||a==="auto"?0:a},set:function(a){if(c.fx.step[a.prop])c.fx.step[a.prop](a);else a.elem.style&&(a.elem.style[c.cssProps[a.prop]]!=null||c.cssHooks[a.prop])?c.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}};A.propHooks.scrollTop=A.propHooks.scrollLeft={set:function(a){if(a.elem.nodeType&&a.elem.parentNode)a.elem[a.prop]=a.now}};c.each(["toggle","show","hide"],function(a,b){var d=c.fn[b];
c.fn[b]=function(a,c,g){return a==null||typeof a==="boolean"?d.apply(this,arguments):this.animate(xa(b,true),a,c,g)}});c.fn.extend({fadeTo:function(a,b,c,e){return this.filter(oa).css("opacity",0).show().end().animate({opacity:b},a,c,e)},animate:function(a,b,d,e){var f=c.isEmptyObject(a),g=c.speed(b,d,e),b=function(){var b=Vb(this,c.extend({},a),g);(f||c._data(this,"finish"))&&b.stop(true)};b.finish=b;return f||g.queue===false?this.each(b):this.queue(g.queue,b)},stop:function(a,b,d){var e=function(a){var b=
a.stop;delete a.stop;b(d)};if(typeof a!=="string"){d=b;b=a;a=void 0}b&&a!==false&&this.queue(a||"fx",[]);return this.each(function(){var b=true,g=a!=null&&a+"queueHooks",h=c.timers,i=c._data(this);if(g)i[g]&&i[g].stop&&e(i[g]);else for(g in i)i[g]&&(i[g].stop&&Sd.test(g))&&e(i[g]);for(g=h.length;g--;)if(h[g].elem===this&&(a==null||h[g].queue===a)){h[g].anim.stop(d);b=false;h.splice(g,1)}(b||!d)&&c.dequeue(this,a)})},finish:function(a){a!==false&&(a=a||"fx");return this.each(function(){var b,d=c._data(this),
e=d[a+"queue"];b=d[a+"queueHooks"];var f=c.timers,g=e?e.length:0;d.finish=true;c.queue(this,a,[]);b&&b.stop&&b.stop.call(this,true);for(b=f.length;b--;)if(f[b].elem===this&&f[b].queue===a){f[b].anim.stop(true);f.splice(b,1)}for(b=0;b<g;b++)e[b]&&e[b].finish&&e[b].finish.call(this);delete d.finish})}});c.each({slideDown:xa("show"),slideUp:xa("hide"),slideToggle:xa("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){c.fn[a]=function(a,c,f){return this.animate(b,
a,c,f)}});c.speed=function(a,b,d){var e=a&&typeof a==="object"?c.extend({},a):{complete:d||!d&&b||c.isFunction(a)&&a,duration:a,easing:d&&b||b&&!c.isFunction(b)&&b};e.duration=c.fx.off?0:typeof e.duration==="number"?e.duration:e.duration in c.fx.speeds?c.fx.speeds[e.duration]:c.fx.speeds._default;if(e.queue==null||e.queue===true)e.queue="fx";e.old=e.complete;e.complete=function(){c.isFunction(e.old)&&e.old.call(this);e.queue&&c.dequeue(this,e.queue)};return e};c.easing={linear:function(a){return a},
swing:function(a){return 0.5-Math.cos(a*Math.PI)/2}};c.timers=[];c.fx=A.prototype.init;c.fx.tick=function(){var a,b=c.timers,d=0;for(ia=c.now();d<b.length;d++){a=b[d];!a()&&b[d]===a&&b.splice(d--,1)}b.length||c.fx.stop();ia=void 0};c.fx.timer=function(a){a()&&c.timers.push(a)&&c.fx.start()};c.fx.interval=13;c.fx.start=function(){Oa||(Oa=setInterval(c.fx.tick,c.fx.interval))};c.fx.stop=function(){clearInterval(Oa);Oa=null};c.fx.speeds={slow:600,fast:200,_default:400};c.fx.step={};c.expr&&c.expr.filters&&
(c.expr.filters.animated=function(a){return c.grep(c.timers,function(b){return a===b.elem}).length});c.fn.offset=function(a){if(arguments.length)return a===void 0?this:this.each(function(b){c.offset.setOffset(this,a,b)});var b,d,e={top:0,left:0},f=(d=this[0])&&d.ownerDocument;if(f){b=f.documentElement;if(!c.contains(b,d))return e;typeof d.getBoundingClientRect!==M&&(e=d.getBoundingClientRect());d=Wb(f);return{top:e.top+(d.pageYOffset||b.scrollTop)-(b.clientTop||0),left:e.left+(d.pageXOffset||b.scrollLeft)-
(b.clientLeft||0)}}};c.offset={setOffset:function(a,b,d){var e=c.css(a,"position");if(e==="static")a.style.position="relative";var f=c(a),g=f.offset(),h=c.css(a,"top"),i=c.css(a,"left"),j={},l={};if((e==="absolute"||e==="fixed")&&c.inArray("auto",[h,i])>-1){l=f.position();e=l.top;i=l.left}else{e=parseFloat(h)||0;i=parseFloat(i)||0}c.isFunction(b)&&(b=b.call(a,d,g));if(b.top!=null)j.top=b.top-g.top+e;if(b.left!=null)j.left=b.left-g.left+i;"using"in b?b.using.call(a,j):f.css(j)}};c.fn.extend({position:function(){if(this[0]){var a,
b,d={top:0,left:0},e=this[0];if(c.css(e,"position")==="fixed")b=e.getBoundingClientRect();else{a=this.offsetParent();b=this.offset();c.nodeName(a[0],"html")||(d=a.offset());d.top=d.top+c.css(a[0],"borderTopWidth",true);d.left=d.left+c.css(a[0],"borderLeftWidth",true)}return{top:b.top-d.top-c.css(e,"marginTop",true),left:b.left-d.left-c.css(e,"marginLeft",true)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Yb;a&&!c.nodeName(a,"html")&&c.css(a,"position")==="static";)a=
a.offsetParent;return a||Yb})}});c.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var d=/Y/.test(b);c.fn[a]=function(e){return c.access(this,function(a,e,h){var i=Wb(a);if(h===void 0)return i?b in i?i[b]:i.document.documentElement[e]:a[e];i?i.scrollTo(!d?h:c(i).scrollLeft(),d?h:c(i).scrollTop()):a[e]=h},a,e,arguments.length,null)}});c.each({Height:"height",Width:"width"},function(a,b){c.each({padding:"inner"+a,content:b,"":"outer"+a},function(d,e){c.fn[e]=function(e,g){var h=
arguments.length&&(d||typeof e!=="boolean"),i=d||(e===true||g===true?"margin":"border");return c.access(this,function(b,d,e){if(c.isWindow(b))return b.document.documentElement["client"+a];if(b.nodeType===9){d=b.documentElement;return Math.max(b.body["scroll"+a],d["scroll"+a],b.body["offset"+a],d["offset"+a],d["client"+a])}return e===void 0?c.css(b,d,i):c.style(b,d,e,i)},b,h?e:void 0,h,null)}})});c.fn.size=function(){return this.length};c.fn.andSelf=c.fn.addBack;"object"===typeof module&&module&&"object"===
typeof module.exports?module.exports=c:(q.jQuery=q.$=c,"function"===typeof define&&define.amd&&define("jquery",[],function(){return c}))})(window);;
;
/* module-key = 'com.atlassian.plugins.jquery:jquery', location = '/jquery-migrate.js' */
(function(a,j){function g(b){var c=j.console;l[b]||(l[b]=!0,a.migrateWarnings.push(b),c&&(c.warn&&!a.migrateMute)&&(c.warn("JQMIGRATE: "+b),a.migrateTrace&&c.trace&&c.trace()))}function m(b,c,d,e){if(Object.defineProperty)try{Object.defineProperty(b,c,{configurable:!0,enumerable:!0,get:function(){g(e);return d},set:function(a){g(e);d=a}});return}catch(f){}a._definePropertyBroken=!0;b[c]=d}var l={};a.migrateWarnings=[];!a.migrateMute&&(j.console&&j.console.log)&&j.console.log("JQMIGRATE: Logging is active");
void 0===a.migrateTrace&&(a.migrateTrace=!0);a.migrateReset=function(){l={};a.migrateWarnings.length=0};"BackCompat"===document.compatMode&&g("jQuery is not compatible with Quirks Mode");var n=a("<input/>",{size:1}).attr("size")&&a.attrFn,o=a.attr,v=a.attrHooks.value&&a.attrHooks.value.get||function(){return null},w=a.attrHooks.value&&a.attrHooks.value.set||function(){},x=/^(?:input|button)$/i,y=/^[238]$/,z=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
A=/^(?:checked|selected)$/i;m(a,"attrFn",n||{},"jQuery.attrFn is deprecated");a.attr=function(b,c,d,e){var f=c.toLowerCase(),h=b&&b.nodeType;if(e){o.length<4&&g("jQuery.fn.attr( props, pass ) is deprecated");if(b&&!y.test(h)&&(n?c in n:a.isFunction(a.fn[c])))return a(b)[c](d)}c==="type"&&(d!==void 0&&x.test(b.nodeName)&&b.parentNode)&&g("Can't change the 'type' of an input or button in IE 6/7/8");if(!a.attrHooks[f]&&z.test(f)){a.attrHooks[f]={get:function(b,c){var d,e=a.prop(b,c);return e===true||
typeof e!=="boolean"&&(d=b.getAttributeNode(c))&&d.nodeValue!==false?c.toLowerCase():void 0},set:function(b,c,d){if(c===false)a.removeAttr(b,d);else{c=a.propFix[d]||d;c in b&&(b[c]=true);b.setAttribute(d,d.toLowerCase())}return d}};A.test(f)&&g("jQuery.fn.attr('"+f+"') may use property instead of attribute")}return o.call(a,b,c,d)};a.attrHooks.value={get:function(b,a){var d=(b.nodeName||"").toLowerCase();if(d==="button")return v.apply(this,arguments);d!=="input"&&d!=="option"&&g("jQuery.fn.attr('value') no longer gets properties");
return a in b?b.value:null},set:function(a,c){var d=(a.nodeName||"").toLowerCase();if(d==="button")return w.apply(this,arguments);d!=="input"&&d!=="option"&&g("jQuery.fn.attr('value', val) no longer sets properties");a.value=c}};var k,i,p=a.fn.init,B=a.parseJSON,C=/^([^<]*)(<[\w\W]+>)([^>]*)$/;a.fn.init=function(b,c,d){var e;if(b&&typeof b==="string"&&!a.isPlainObject(c)&&(e=C.exec(a.trim(b)))&&e[0]){b.charAt(0)!=="<"&&g("$(html) HTML strings must start with '<' character");e[3]&&g("$(html) HTML text after last tag is ignored");
if(e[0].charAt(0)==="#"){g("HTML string cannot start with a '#' character");a.error("JQMIGRATE: Invalid selector string (XSS)")}if(c&&c.context)c=c.context;if(a.parseHTML)return p.call(this,a.parseHTML(e[2],c,true),c,d)}return p.apply(this,arguments)};a.fn.init.prototype=a.fn;a.parseJSON=function(a){if(!a&&a!==null){g("jQuery.parseJSON requires a valid JSON string");return null}return B.apply(this,arguments)};a.uaMatch=function(a){a=a.toLowerCase();a=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||
/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}};a.browser||(k=a.uaMatch(navigator.userAgent),i={},k.browser&&(i[k.browser]=!0,i.version=k.version),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),a.browser=i);m(a,"browser",a.browser,"jQuery.browser is deprecated");a.sub=function(){function b(a,c){return new b.fn.init(a,c)}a.extend(true,b,this);b.superclass=this;b.fn=
b.prototype=this();b.fn.constructor=b;b.sub=this.sub;b.fn.init=function(d,e){e&&(e instanceof a&&!(e instanceof b))&&(e=b(e));return a.fn.init.call(this,d,e,c)};b.fn.init.prototype=b.fn;var c=b(document);g("jQuery.sub() is deprecated");return b};a.ajaxSetup({converters:{"text json":a.parseJSON}});var D=a.fn.data;a.fn.data=function(b){var c,d;if((d=this[0])&&b==="events"&&arguments.length===1){c=a.data(d,b);d=a._data(d,b);if((c===void 0||c===d)&&d!==void 0){g("Use of jQuery.fn.data('events') is deprecated");
return d}}return D.apply(this,arguments)};var E=/\/(java|ecma)script/i,F=a.fn.andSelf||a.fn.addBack;a.fn.andSelf=function(){g("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()");return F.apply(this,arguments)};a.clean||(a.clean=function(b,c,d,e){c=c||document;c=!c.nodeType&&c[0]||c;c=c.ownerDocument||c;g("jQuery.clean() is deprecated");var f,h=[];a.merge(h,a.buildFragment(b,c).childNodes);if(d){c=function(a){if(!a.type||E.test(a.type))return e?e.push(a.parentNode?a.parentNode.removeChild(a):a):
d.appendChild(a)};for(b=0;(f=h[b])!=null;b++)if(!a.nodeName(f,"script")||!c(f)){d.appendChild(f);if(typeof f.getElementsByTagName!=="undefined"){f=a.grep(a.merge([],f.getElementsByTagName("script")),c);h.splice.apply(h,[b+1,0].concat(f));b=b+f.length}}}return h});var G=a.event.add,H=a.event.remove,I=a.event.trigger,J=a.fn.toggle,q=a.fn.live,r=a.fn.die,s=/\b(?:ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess)\b/,t=/(?:^|\s)hover(\.\S+|)\b/,u=function(b){if(typeof b!=="string"||a.event.special.hover)return b;
t.test(b)&&g("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'");return b&&b.replace(t,"mouseenter$1 mouseleave$1")};a.event.props&&"attrChange"!==a.event.props[0]&&a.event.props.unshift("attrChange","attrName","relatedNode","srcElement");a.event.dispatch&&m(a.event,"handle",a.event.dispatch,"jQuery.event.handle is undocumented and deprecated");a.event.add=function(a,c,d,e,f){a!==document&&s.test(c)&&g("AJAX events should be attached to document: "+c);G.call(this,a,u(c||""),d,e,f)};
a.event.remove=function(a,c,d,e,f){H.call(this,a,u(c)||"",d,e,f)};a.fn.error=function(){var a=Array.prototype.slice.call(arguments,0);g("jQuery.fn.error() is deprecated");a.splice(0,0,"error");if(arguments.length)return this.bind.apply(this,a);this.triggerHandler.apply(this,a);return this};a.fn.toggle=function(b,c){if(!a.isFunction(b)||!a.isFunction(c))return J.apply(this,arguments);g("jQuery.fn.toggle(handler, handler...) is deprecated");var d=arguments,e=b.guid||a.guid++,f=0,h=function(c){var e=
(a._data(this,"lastToggle"+b.guid)||0)%f;a._data(this,"lastToggle"+b.guid,e+1);c.preventDefault();return d[e].apply(this,arguments)||false};for(h.guid=e;f<d.length;)d[f++].guid=e;return this.click(h)};a.fn.live=function(b,c,d){g("jQuery.fn.live() is deprecated");if(q)return q.apply(this,arguments);a(this.context).on(b,this.selector,c,d);return this};a.fn.die=function(b,c){g("jQuery.fn.die() is deprecated");if(r)return r.apply(this,arguments);a(this.context).off(b,this.selector||"**",c);return this};
a.event.trigger=function(a,c,d,e){!d&&!s.test(a)&&g("Global events are undocumented and deprecated");return I.call(this,a,c,d||document,e)};a.each("ajaxStart ajaxStop ajaxSend ajaxComplete ajaxError ajaxSuccess".split(" "),function(b,c){a.event.special[c]={setup:function(){var b=this;if(b!==document){a.event.add(document,c+"."+a.guid,function(){a.event.trigger(c,null,b,true)});a._data(this,c,a.guid++)}return false},teardown:function(){this!==document&&a.event.remove(document,c+"."+a._data(this,c));
return false}}})})(jQuery,window);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-compatibility', location = 'js-vendor/jquery/jquery-compatibility.js' */
jQuery.noConflict();;
;
/* module-key = 'com.atlassian.auiplugin:aui-deprecation', location = 'js/aui/internal/console.js' */
window.AJS=window.AJS||{};(function(){function b(a){return function(){"undefined"!==typeof console&&console[a]&&Function.prototype.apply.call(console[a],console,arguments)}}"undefined"===typeof window.console?window.console={messages:[],log:function(a){this.messages.push(a)},show:function(){alert(this.messages.join("\n"));this.messages=[]}}:window.console.show=function(){};AJS.log=b("log");AJS.warn=b("warn");AJS.error=b("error")})();;
;
/* module-key = 'com.atlassian.auiplugin:aui-deprecation', location = 'js/aui/internal/deprecation.js' */
(function(h){window.AJS=window.AJS||{};window.AJS.deprecate=h(jQuery||Zepto);"function"===typeof define&&define("aui/internal/deprecation",[],function(){return window.AJS.deprecate})})(function(h){function i(c,a){if("function"===typeof c)return c;var b=!1,a=a||{};return function(d){d=e.__getDeprecatedLocation(d?d:1)||"";if(!b||-1===l.indexOf(d)){l.push(d);b=!0;var f="DEPRECATED "+(a.deprecationType+" "||"")+"- ",g;g=c;g=(g+="")?g.charAt(0).toUpperCase()+g.substring(1):"";f=f+g+" has been deprecated"+
(a.sinceVersion?" since "+a.sinceVersion:"")+" and will be removed in "+(a.removeInVersion||"a future release")+".";a.alternativeName&&(f+=" Use "+a.alternativeName+" instead. ");a.extraInfo&&(f+=" "+a.extraInfo);d=""===d?" \n No stack trace of the deprecated usage is available in your current browser.":" \n "+d;a.extraObject?e.__logger(f+"\n",a.extraObject,d):e.__logger(f,d)}}}function j(c,a,b){b=b||{};b.deprecationType=b.deprecationType||"JS";var d=i(a||c.name||"this function",b);return function(){d();
return c.apply(this,arguments)}}function m(c,a,b){if("function"===typeof c[a])b=b||{},b.deprecationType=b.deprecationType||"JS",c[a]=j(c[a],b.displayName||a,b);else if(k){var d=c[a],b=b||{};b.deprecationType=b.deprecationType||"JS";var e=i(b.displayName||a,b);Object.defineProperty(c,a,{get:function(){e();return d},set:function(a){d=a;e();return a}})}}function p(c){return function(a){var b={selector:a,options:c||{}};n.push(b);for(var a=document.querySelectorAll(a),d=0;d<a.length;d++)o(b,a[d])}}function q(c){return function(a){(c.matches||
c.msMatchesSelector||c.webkitMatchesSelector||c.mozMatchesSelector||c.oMatchesSelector).call(c,a.selector)&&o(a,c)}}function o(c,a){var b=c.options.displayName,b=b?" ("+b+")":"",d=h.extend({deprecationType:"CSS",extraObject:a},c.options);i("'"+c.selector+"' pattern"+b,d)()}var e={},r=Object.prototype.hasOwnProperty,l=[];e.__logger=function(){return AJS.warn.apply(void 0,arguments)};e.__getDeprecatedLocation=function(c){var a=Error();return(a=(a=a.stack||a.stacktrace)&&a.replace(/^Error\n/,"")||"")?
(a=a.split("\n"),a[c+2]):a};var k=!1;try{Object.defineProperty&&(Object.defineProperty({},"blam",{get:function(){},set:function(){}}),k=!0)}catch(s){}if(window.MutationObserver){var n=[];(new MutationObserver(function(c){c.forEach(function(a){for(var a=a.addedNodes,b=0;b<a.length;b++){var c=a[b];1===c.nodeType&&n.forEach(q(c))}})})).observe(document,{childList:!0,subtree:!0})}e.fn=j;e.construct=function(c,a,b){b=b||{};b.deprecationType=b.deprecationType||"JS";a=j(c,a,b);a.prototype=c.prototype;h.extend(a,
c);return a};e.css=function(c,a){window.MutationObserver?("string"===typeof c&&(c=[c]),c.forEach(p(a))):e.__logger("CSS could not be deprecated as Mutation Observer was not found.")};e.prop=m;e.obj=function(c,a,b){var b=b||{},d;for(d in c)r.call(c,d)&&(b.deprecationType=b.deprecationType||"JS",b.displayName=a+d,b.alternativeName=b.alternativeNamePrefix&&b.alternativeNamePrefix+d,m(c,d,h.extend({},b)))};e.propertyDeprecationSupported=k;e.getMessageLogger=i;return e});;
;
/* module-key = 'com.atlassian.auiplugin:aui-core', location = '/js/polyfills/custom-event.js' */
(function(){function a(a,b){var b=b||{bubbles:!1,cancelable:!1,detail:void 0},c=document.createEvent("CustomEvent");c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return c}if(window.CustomEvent)try{new a}catch(d){return}a.prototype=window.Event.prototype;window.CustomEvent=a})();;
;
/* module-key = 'com.atlassian.auiplugin:aui-core', location = 'skatejs/dist/skate.js' */
(function e(l,d,g){function i(b,m){if(!d[b]){if(!l[b]){var o="function"==typeof require&&require;if(!m&&o)return o(b,!0);if(f)return f(b,!0);o=Error("Cannot find module '"+b+"'");throw o.code="MODULE_NOT_FOUND",o;}o=d[b]={exports:{}};l[b][0].call(o.exports,function(f){var g=l[b][1][f];return i(g?g:f)},o,o.exports,e,l,d,g)}return d[b].exports}for(var f="function"==typeof require&&require,b=0;b<g.length;b++)i(g[b]);return i})({1:[function(a,l,d){d.ATTR_IGNORE="data-skate-ignore"},{}],2:[function(a,
l,d){d.default={get:function(g,a){if(g.__SKATE_DATA)return g.__SKATE_DATA[a]},set:function(a,d,f){a.__SKATE_DATA||(a.__SKATE_DATA={});a.__SKATE_DATA[d]=f;return a}}},{}],3:[function(a,l,d){function g(a){for(var g=a.length,k=0;k<g;k++){var c=a[k],j=c.addedNodes,c=c.removedNodes;j&&(j.length&&!m(j[0].parentNode))&&f(j);c&&c.length&&b(c)}}var i=a("./globals").default,f=a("./lifecycle").initElements,b=a("./lifecycle").removeElements,n=a("./mutation-observer").default,m=a("./utils").getClosestIgnoredElement;
d.default={register:function(b){b&&(n.fixIe(),this.unregister());i.observer||(b=new n(g),b.observe(document,{childList:!0,subtree:!0}),i.observer=b);return this},unregister:function(){i.observer&&(i.observer.disconnect(),i.observer=void 0);return this}}},{"./globals":4,"./lifecycle":5,"./mutation-observer":6,"./utils":9}],4:[function(a,l,d){window.__skate||(window.__skate={observer:void 0,registry:{}});d.default=window.__skate},{}],5:[function(a,l,d){function g(b,a,j){if(m.get(b,a.id+":lifecycle:"+
j))return!0;m.set(b,a.id+":lifecycle:"+j,!0);return!1}function i(b,a){if(!g(b,a,"created")){k(b,a.prototype,!0);a.template&&a.template(b);var f=function(a,f){return function(c){if(!f)return a(b,c,b);for(var h=c.target;h&&h!==document&&h!==b.parentNode;){if(j.call(h,f))return a(b,c,h);h=h.parentNode}}};"object"===typeof a.events&&c(a.events,function(a,h){var j,c;c=h.split(" ");j=c.shift();c=c.join(" ");b.addEventListener(j,f(a,c),!!c&&("blur"===j||"focus"===j))});var d=function(c,j,h,f){var g;a.attributes&&
a.attributes[j]&&"function"===typeof a.attributes[j][c]?g=a.attributes[j][c]:a.attributes&&"function"===typeof a.attributes[j]?g=a.attributes[j]:"function"===typeof a.attributes&&(g=a.attributes);g&&g(b,{type:c,name:j,newValue:h,oldValue:f})},h,i=b.attributes,n=[],m=i.length;(new o(function(b){b.forEach(function(b){var a,j=b.attributeName,c=i[j];c&&null===b.oldValue?a="created":c&&null!==b.oldValue?a="updated":c||(a="removed");d(a,j,c?c.value||c.nodeValue:void 0,b.oldValue)})})).observe(b,{attributes:!0,
attributeOldValue:!0});for(h=0;h<m;h++)n.push(i[h]);for(h=0;h<m;h++){var p=n[h];d("created",p.nodeName,p.value||p.nodeValue)}a.created&&a.created(b)}}function f(b){for(var a=b.length,c=0;c<a;c++){var j=b[c];if(!(1!==j.nodeType||j.attributes[n])){for(var d=h.getForElement(j),k=d.length,m=0;m<k;m++){var o=j,p=d[m];i(o,p);g(o,p,"attached")||(o.removeAttribute(p.unresolvedAttribute),o.setAttribute(p.resolvedAttribute,""),p.attached&&p.attached(o))}j=j.childNodes;j.length&&f(j)}}}function b(a){for(var j=
a.length,c=0;c<j;c++){var f=a[c];if(1===f.nodeType){b(f.childNodes);for(var g=h.getForElement(f),d=g.length,k=0;k<d;k++){var i=f,n=g[k];n.detached&&n.detached(i);m.set(i,n.id+":lifecycle:attached",!1)}}}}var n=a("./constants").ATTR_IGNORE,m=a("./data").default,o=a("./mutation-observer").default,h=a("./registry").default,k=a("./utils").inherit,c=a("./utils").objEach,a=window.HTMLElement.prototype,j=a.matches||a.msMatchesSelector||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector;d.triggerCreated=
i;d.initElements=f;d.removeElements=b},{"./constants":1,"./data":2,"./mutation-observer":6,"./registry":7,"./utils":9}],6:[function(a,l,d){function g(b,a){return{addedNodes:null,attributeName:null,attributeNamespace:null,nextSibling:null,oldValue:null,previousSibling:null,removedNodes:null,target:b,type:a||"childList"}}function i(b,a){var c=b.childNodes;if(c)for(var f=c.length,h=0;h<f;h++){var g=c[h];a(g);i(g,a)}}function f(b){if(h&&!k)return new h(b);this.callback=b;this.elements=[]}var b=a("./utils").debounce,
n=a("./utils").objEach,m=window.HTMLElement.prototype,o=window.HTMLElement.prototype.contains,h=window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver,k=!1,c=-1<window.navigator.userAgent.indexOf("Trident");f.fixIe=function(){if(c&&!k){var b=Object.getOwnPropertyDescriptor(m,"innerHTML");Object.defineProperty(m,"innerHTML",{get:function(){return b.get.call(this)},set:function(a){i(this,function(b){var a=document.createEvent("MutationEvent");a.initMutationEvent("DOMNodeRemoved",
!0,!1,null,null,null,null,null);b.dispatchEvent(a)});b.set.call(this,a)}});k=!0}};Object.defineProperty(f,"isFixingIe",{get:function(){return k}});f.prototype={observe:function(a,c){function f(b){n.push(b);l()}var h=this,d,i,n=[],m=[],l=b(function(){for(var b=n.length,f=0;f<b;f++){var l=n[f],p=l.target;if(p){var l=l.type,q=p.parentNode;if(c.childList&&(c.subtree||q===a)){var r=k&&"DOMNodeRemoved"===l,s=d&&(1!==d.nodeType?!1:d.contains?d.contains(p):o.call(d,p));if(r||!s){if(!i||i.target!==q)m.push(i=
g(q));"DOMNodeInserted"===l?(i.addedNodes||(i.addedNodes=[]),i.addedNodes.push(p)):(i.removedNodes||(i.removedNodes=[]),i.removedNodes.push(p));d=p}}}}h.callback(m);n=[];m=[];i=d=void 0}),p={},q=[],t=b(function(){var b=q.length;h.callback(q);q.splice(0,b)}),r={target:a,options:c,insertHandler:f,removeHandler:f,attributeHandler:function(b){var f=b.target;if(c.attributes&&(c.subtree||f===a)){var h=b.attrName,d=b.prevValue,b=b.newValue,f=g(f,"attributes");f.attributeName=h;c.attributeOldValue&&(f.oldValue=
p[h]||d||null);q.push(f);c.attributeOldValue&&(p[h]=b);t()}}};this.elements.push(r);c.childList&&(a.addEventListener("DOMNodeInserted",r.insertHandler),a.addEventListener("DOMNodeRemoved",r.removeHandler));c.attributes&&a.addEventListener("DOMAttrModified",r.attributeHandler);return this},disconnect:function(){n(this.elements,function(b){b.target.removeEventListener("DOMNodeInserted",b.insertHandler);b.target.removeEventListener("DOMNodeRemoved",b.removeHandler);b.target.removeEventListener("DOMAttrModified",
b.attributeHandler)});this.elements=[];return this}};d.default=f},{"./utils":9}],7:[function(a,l,d){function g(b,a){return f(i.registry,b)&&-1<i.registry[b].type.indexOf(a)}var i=a("./globals").default,f=a("./utils").hasOwn;d.default={clear:function(){i.registry={};return this},getForElement:function(b){var a=b.attributes,f=a.length,d=[],h=a.is,k=h&&(h.value||h.nodeValue),h=b.tagName.toLowerCase(),c=k||h,j;g(c,skate.types.TAG)&&(c=i.registry[c],j=c.extends,k?h===j&&d.push(c):j||d.push(c));for(k=0;k<
f;k++)c=a[k].nodeName,g(c,skate.types.ATTR)&&(c=i.registry[c],j=c.extends,(!j||h===j)&&d.push(c));(a=b.classList)?b=a:(b=b.attributes,b=b["class"]&&b["class"].nodeValue.split(/\s+/)||[]);a=b.length;for(f=0;f<a;f++)c=b[f],g(c,skate.types.CLASS)&&(c=i.registry[c],j=c.extends,(!j||h===j)&&d.push(c));return d},has:function(b){return f(i.registry,b)},set:function(b,a){if(this.has(b))throw Error('A definition of type "'+a.type+'" with the ID of "'+b+'" already exists.');i.registry[b]=a;return this},remove:function(b){this.has(b)&&
delete i.registry[b];return this}}},{"./globals":4,"./utils":9}],8:[function(a,l,d){function g(b,a){a=m(a||{},g.defaults);a.id=b;if(n.has(a.id))throw Error('A definition of type "'+a.type+'" with the ID of "'+b+'" already exists.');n.set(a.id,a);o();i.register(a.remove);if(-1<a.type.indexOf(g.types.TAG)){var c=a,d=function(){var a;a=c.extends;var b=c.id;a?(a=document.createElement(a),a.setAttribute("is",b)):a=document.createElement(b);c.prototype=d.prototype;f(a,c);return a};d.prototype=c.prototype;
return d}}var i=a("./document-observer").default,f=a("./lifecycle").triggerCreated,b=a("./lifecycle").initElements,n=a("./registry").default,l=a("./utils").debounce,m=a("./utils").inherit,a=a("./version").default,o=l(function(){b(document.getElementsByTagName("html"))});g.init=function(a){if(a)return"string"===typeof a&&(a=document.querySelectorAll(a)),b("undefined"===typeof a.length?[a]:a),a};g.types={ANY:"act",ATTR:"a",CLASS:"c",NOATTR:"ct",NOCLASS:"at",NOTAG:"ac",TAG:"t"};g.version=a;g.defaults=
{attributes:void 0,events:void 0,"extends":"",id:"",prototype:{},resolvedAttribute:"resolved",template:void 0,type:g.types.ANY,unresolvedAttribute:"unresolved"};window.skate=g;"function"===typeof define&&define("aui/internal/skate",[],function(){return g});"object"===typeof d&&(d.default=g);d.default=g},{"./document-observer":3,"./lifecycle":5,"./registry":7,"./utils":9,"./version":10}],9:[function(a,l,d){function g(a,b){return Object.prototype.hasOwnProperty.call(a,b)}d.hasOwn=g;d.debounce=function(a){var b=
!1;return function(){b||(b=!0,setTimeout(function(){b=!1;a()},1))}};d.getClosestIgnoredElement=function(a){for(;a&&a!==document;){if(a.hasAttribute(i))return a;a=a.parentNode}};d.inherit=function(a,b,d){for(var g=Object.getOwnPropertyNames(b),i=g.length,h=0;h<i;h++){var k=g[h];if(d||void 0===a[k]){var c=Object.getOwnPropertyDescriptor(b,k);c.get||c.set||!c.writable||!c.enumerable||!c.configurable?Object.defineProperty(a,k,c):a[k]=b[k]}}return a};d.objEach=function(a,b){for(var d in a)g(a,d)&&b(a[d],
d)};"use strict";var i=a("./constants").ATTR_IGNORE},{"./constants":1}],10:[function(a,l,d){d.default="0.11.1"},{}]},{},[8]);;
;
/* module-key = 'com.atlassian.auiplugin:aui-core', location = 'skatejs-template-html/dist/template-html.js' */
(function(){function m(b){var a={caption:"table",dd:"dl",dt:"dl",li:"ul",tbody:"table",td:"tr",thead:"table",tr:"tbody"};document.createDocumentFragment();var e=b.match(/\s*<([^\s>]+)/),a=document.createElement(e&&a[e[1]]||"div");a.innerHTML=b;return r(a.childNodes)}function r(b){for(var a=document.createDocumentFragment();b&&b.length;)a.appendChild(b[0]);return a}function o(b,a){for(var e=[],f=b.nextSibling;f!==a;)e.push(f),f=f.nextSibling;return e}function p(b){for(var a=b.defaultNodes,e=a.length,
f=0;f<e;f++)b.container.insertBefore(a[f],b.endNode);b.isDefault=!0}function q(b){for(var a=b.defaultNodes,e=a.length,f=0;f<e;f++){var i=a[f];i.parentNode.removeChild(i)}b.isDefault=!1}function u(b,a){return{get:function(){var e=b[a];return"function"===typeof e?e.bind(b):e},set:function(e){b[a]=e}}}function l(){var b=[].slice.call(arguments).join("");return function(a){var e=r(a.childNodes);a.innerHTML=b;var f=a.getElementsByTagName("content");if(f&&f.length){for(var i=[];f.length;){var h=f[0],g=
h.parentNode,j=document.createComment(""),c=document.createComment("");i.push({container:g,contentNode:h,defaultNodes:[].slice.call(h.childNodes),endNode:c,isDefault:!0,selector:h.getAttribute("select"),startNode:j});g.replaceChild(c,h);g.insertBefore(j,c)}a.__SKATE_TEMPLATE_HTML_DATA||(a.__SKATE_TEMPLATE_HTML_DATA={});a.__SKATE_TEMPLATE_HTML_DATA.content=i}e.childNodes.length&&l.wrap(a).appendChild(e)}}var s=window.DocumentFragment,k=window.HTMLElement.prototype,t=k.matches||k.msMatchesSelector||
k.webkitMatchesSelector||k.mozMatchesSelector||k.oMatchesSelector;l.wrap=function(b){var a,e;e=b.__SKATE_TEMPLATE_HTML_DATA?b.__SKATE_TEMPLATE_HTML_DATA.content:void 0;if(e){var f;f=b.__SKATE_TEMPLATE_HTML_DATA?b.__SKATE_TEMPLATE_HTML_DATA.content:void 0;var i=f.length;e={childNodes:{get:function(){for(var g=[],j=0;j<i;j++){var c=f[j];c.isDefault||(g=g.concat(o(c.startNode,c.endNode)))}return g}},firstChild:{get:function(){var g=this.childNodes;return g.length&&g[0]||null}},innerHTML:{get:function(){for(var g=
"",j=this.childNodes,c=j.length,d=0;d<c;d++)var a=j[d],g=g+(a.outerHTML||a.textContent);return g},set:function(g){for(var g=m(g),j=0;j<i;j++){for(var c=f[j],d=o(c.startNode,c.endNode),a=0;a<d.length;a++){var b=d[a];b.parentNode.removeChild(b)}d=g;if(a=c.selector){for(var a=d.querySelectorAll(a),b=a.length,e=[],h=0;h<b;h++){var n=a[h];n.parentNode===d&&e.push(n)}d=e}else d=[].slice.call(d.childNodes)||[];for(a=0;a<d.length;a++)c.container.insertBefore(d[a],c.endNode);d.length?q(c):p(c)}}},lastChild:{get:function(){for(var g=
i-1;-1<g;g--)if(!f[g].isDefault)return g=this.childNodes,g[g.length-1];return null}},outerHTML:{get:function(){var g=this.tagName.toLowerCase(),a="<"+g,c=this.attributes;if(c)for(var d=c.length,b=0;b<d;b++)var f=c[b],a=a+(" "+f.nodeName+'="'+f.nodeValue+'"');a=a+">"+this.innerHTML;return a+("</"+g+">")}},textContent:{get:function(){for(var a="",b=this.childNodes,c=this.childNodes.length,d=0;d<c;d++)a+=b[d].textContent;return a},set:function(a){var b;this.innerHTML="";for(var c=0;c<i;c++){var d=f[c];
if(!d.selector){b=d;break}}b&&(a?(q(b),b.container.insertBefore(document.createTextNode(a),b.endNode)):p(b))}},appendChild:{value:function(a){if(a instanceof s)return[].slice.call(a.childNodes).forEach(function(a){this.appendChild(a)}.bind(this)),this;for(var b=0;b<i;b++){var c=f[b],d=c.selector;if(!d||a instanceof window.HTMLElement&&t.call(a,d)){q(c);c.endNode.parentNode.insertBefore(a,c.endNode);break}}return this}},insertAdjacentHTML:{value:function(a,f){"afterbegin"===a?this.insertBefore(m(f),
this.childNodes[0]):"beforeend"===a?this.appendChild(m(f)):b.insertAdjacentHTML(a,f);return this}},insertBefore:{value:function(a,b){if(!b)return this.appendChild(a);if(a instanceof s){var c=a.childNodes;if(c)for(var d=c.length,e=0;e<d;e++)this.insertBefore(c[e],b);return this}c=!1;d=0;a:for(;d<i;d++)for(var e=f[d],h=o(e.startNode,e.endNode),l=h.length,k=0;k<l;k++){var n=h[k];n===b&&(c=!0);if(c){var m=e.selector;if(!m||t.call(a,m)){n.parentNode.insertBefore(a,n);break a}}}if(!c)throw Error("DOMException 8: The node before which the new node is to be inserted is not a child of this node.");
return a}},removeChild:{value:function(a){for(var b=!1,c=0;c<i;c++){var d=f[c];if(d.container===a.parentNode){d.container.removeChild(a);b=!0;break}d.startNode.nextSibling===d.endNode&&p(d)}if(!b)throw Error("DOMException 8: The node in which you are trying to remove is not a child of this node.");return a}},replaceChild:{value:function(a,b){for(var c=0;c<i;c++){var d=f[c];if(d.container===b.parentNode){d.container.replaceChild(a,b);break}}return this}}};var h={};for(a in b)a in e?Object.defineProperty(h,
a,e[a]):Object.defineProperty(h,a,u(b,a));a=h}else a=b;return a};window.skateTemplateHtml=l;"function"===typeof define&&define("aui/internal/skate-template-html",[],function(){return l});"object"===typeof module&&(module.exports=l)})();;
;
/* module-key = 'com.atlassian.auiplugin:aui-core', location = 'tether/tether.js' */
(function(R){var S,T,U,J,la,K,L,V,y,wa={}.hasOwnProperty,xa=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},ya=[].slice;null==this.Tether&&(this.Tether={modules:[]});var ma;ma=0;V=function(){return ma++};y={};la=function(a){var b,c,d;d=a._tetherZeroElement;if(d==null){d=a.createElement("div");d.setAttribute("data-tether-id",V());J(d.style,{top:0,left:0,position:"absolute"});a.body.appendChild(d);a._tetherZeroElement=d}b=d.getAttribute("data-tether-id");
if(y[b]==null){y[b]={};d=d.getBoundingClientRect();for(c in d){a=d[c];y[b][c]=a}T(function(){return y[b]=void 0})}return y[b]};J=function(a){var b,c,d,e,h,f;a==null&&(a={});b=[];Array.prototype.push.apply(b,arguments);f=b.slice(1);e=0;for(h=f.length;e<h;e++)if(b=f[e])for(c in b)if(wa.call(b,c)){d=b[c];a[c]=d}return a};L=function(a,b){var c,d,e,h,f;if(a.classList!=null){h=b.split(" ");f=[];d=0;for(e=h.length;d<e;d++){c=h[d];c.trim()&&f.push(a.classList.remove(c))}return f}return a.className=a.className.replace(RegExp("(^| )"+
b.split(" ").join("|")+"( |$)","gi")," ")};S=function(a,b){var c,d,e,h,f;if(a.classList!=null){h=b.split(" ");f=[];d=0;for(e=h.length;d<e;d++){c=h[d];c.trim()&&f.push(a.classList.add(c))}return f}L(a,b);return a.className=a.className+(" "+b)};K=function(a,b){return a.classList!=null?a.classList.contains(b):RegExp("(^| )"+b+"( |$)","gi").test(a.className)};U=[];T=function(a){return U.push(a)};var g=function(){};g.prototype.on=function(a,b,c,d){var e;d==null&&(d=false);if(this.bindings==null)this.bindings=
{};if((e=this.bindings)[a]==null)e[a]=[];return this.bindings[a].push({handler:b,ctx:c,once:d})};g.prototype.once=function(a,b,c){return this.on(a,b,c,true)};g.prototype.off=function(a,b){var c,d;if(((c=this.bindings)!=null?c[a]:void 0)!=null){if(b==null)return delete this.bindings[a];c=0;for(d=[];c<this.bindings[a].length;)this.bindings[a][c].handler===b?d.push(this.bindings[a].splice(c,1)):d.push(c++);return d}};g.prototype.trigger=function(){var a,b,c,d,e,h,f;c=arguments[0];a=2<=arguments.length?
ya.call(arguments,1):[];if((b=this.bindings)!=null&&b[c]){e=0;for(f=[];e<this.bindings[c].length;){h=this.bindings[c][e];d=h.handler;b=h.ctx;h=h.once;d.apply(b!=null?b:this,a);h?f.push(this.bindings[c].splice(e,1)):f.push(e++)}return f}};this.Tether.Utils={getScrollParent:function(a){var b,c,d;b=getComputedStyle(a).position;if(b==="fixed")return a;for(;a=a.parentNode;){try{c=getComputedStyle(a)}catch(e){}if(c==null||/(auto|scroll)/.test(c.overflow+c["overflow-y"]+c["overflow-x"])&&(b!=="absolute"||
(d=c.position)==="relative"||d==="absolute"||d==="fixed"))return a}return document.body},getBounds:function(a){var b,c,d,e,h;if(a===document){c=document;a=document.documentElement}else c=a.ownerDocument;d=c.documentElement;b={};h=a.getBoundingClientRect();for(e in h){a=h[e];b[e]=a}e=la(c);b.top=b.top-e.top;b.left=b.left-e.left;if(b.width==null)b.width=document.body.scrollWidth-b.left-b.right;if(b.height==null)b.height=document.body.scrollHeight-b.top-b.bottom;b.top=b.top-d.clientTop;b.left=b.left-
d.clientLeft;b.right=c.body.clientWidth-b.width-b.left;b.bottom=c.body.clientHeight-b.height-b.top;return b},getOffsetParent:function(a){return a.offsetParent||document.documentElement},extend:J,addClass:S,removeClass:L,hasClass:K,updateClasses:function(a,b,c){var d,e,h;e=0;for(h=c.length;e<h;e++){d=c[e];xa.call(b,d)<0&&K(a,d)&&L(a,d)}h=[];c=0;for(e=b.length;c<e;c++){d=b[c];K(a,d)?h.push(void 0):h.push(S(a,d))}return h},defer:T,flush:function(){var a,b;for(b=[];a=U.pop();)b.push(a());return b},uniqueId:V,
Evented:g,getScrollBarSize:function(){var a,b,c;a=document.createElement("div");a.style.width="100%";a.style.height="200px";b=document.createElement("div");J(b.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"});b.appendChild(a);document.body.appendChild(b);c=a.offsetWidth;b.style.overflow="scroll";a=a.offsetWidth;if(c===a)a=b.clientWidth;document.body.removeChild(b);b=c-a;return{width:b,height:b}}};var na,oa,W,w,D,X,Y,
pa,M,N,Z,z,O,$,qa,P,E,aa,ba,ca,da,p,A,ea,ra,za=[].slice;if(null==this.Tether)throw Error("You must include the utils.js file before tether.js");w=this.Tether;g=w.Utils;qa=g.getScrollParent;z=g.getBounds;O=g.getOffsetParent;N=g.extend;D=g.addClass;da=g.removeClass;ea=g.updateClasses;M=g.defer;Z=g.flush;$=g.getScrollBarSize;ra=function(a,b,c){c==null&&(c=1);return a+c>=b&&b>=a-c};a:{var x,B,F,G,g=document.createElement("div");G=["transform","webkitTransform","OTransform","MozTransform","msTransform"];
B=0;for(F=G.length;B<F;B++)if(x=G[B],void 0!==g.style[x]){A=x;break a}A=void 0}p=[];ca=function(){var a,b,c;b=0;for(c=p.length;b<c;b++){a=p[b];a.position(false)}return Z()};P=function(){var a;return(a=typeof performance!=="undefined"&&performance!==null?typeof performance.now==="function"?performance.now():void 0:void 0)!=null?a:+new Date};var H,C,I,fa;I=C=H=null;fa=function(){if(C!=null&&C>16){C=Math.min(C-16,250);I=setTimeout(fa,250)}else if(!(H!=null&&P()-H<10)){if(I!=null){clearTimeout(I);I=null}H=
P();ca();return C=P()-H}};F=["resize","scroll","touchmove"];G=[];x=0;for(B=F.length;x<B;x++)g=F[x],G.push(window.addEventListener(g,fa));na={center:"center",left:"right",right:"left"};oa={middle:"middle",top:"bottom",bottom:"top"};W={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"};pa=function(a,b){var c,d;c=a.left;d=a.top;c==="auto"&&(c=na[b.left]);d==="auto"&&(d=oa[b.top]);return{left:c,top:d}};Y=function(a){var b,c;return{left:(b=W[a.left])!=null?b:a.left,top:(c=W[a.top])!=null?
c:a.top}};X=function(){var a,b,c,d,e,h;b=1<=arguments.length?za.call(arguments,0):[];c={top:0,left:0};e=0;for(h=b.length;e<h;e++){a=b[e];d=a.top;a=a.left;typeof d==="string"&&(d=parseFloat(d,10));typeof a==="string"&&(a=parseFloat(a,10));c.top=c.top+d;c.left=c.left+a}return c};E=function(a,b){if(typeof a.left==="string"&&a.left.indexOf("%")!==-1)a.left=parseFloat(a.left,10)/100*b.width;if(typeof a.top==="string"&&a.top.indexOf("%")!==-1)a.top=parseFloat(a.top,10)/100*b.height;return a};aa=ba=function(a){a=
a.split(" ");return{top:a[0],left:a[1]}};g=function(a){var b=this.position,c=this;this.position=function(){return b.apply(c,arguments)};var d,e,h,f;p.push(this);this.history=[];this.setOptions(a,false);h=w.modules;d=0;for(e=h.length;d<e;d++){a=h[d];(f=a.initialize)!=null&&f.call(this)}this.position()};g.modules=[];g.prototype.getClass=function(a){var b,c;return(b=this.options.classes)!=null&&b[a]?this.options.classes[a]:((c=this.options.classes)!=null?c[a]:void 0)!==false?this.options.classPrefix?
""+this.options.classPrefix+"-"+a:a:""};g.prototype.setOptions=function(a,b){var c,d,e,h;this.options=a;b==null&&(b=true);c=this.options=N({offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"},this.options);this.element=c.element;this.target=c.target;this.targetModifier=c.targetModifier;if(this.target==="viewport"){this.target=document.body;this.targetModifier="visible"}else if(this.target==="scroll-handle"){this.target=document.body;this.targetModifier="scroll-handle"}h=
["element","target"];d=0;for(e=h.length;d<e;d++){c=h[d];if(this[c]==null)throw Error("Tether Error: Both element and target must be defined");this[c].jquery!=null?this[c]=this[c][0]:typeof this[c]==="string"&&(this[c]=document.querySelector(this[c]))}D(this.element,this.getClass("element"));D(this.target,this.getClass("target"));if(!this.options.attachment)throw Error("Tether Error: You must provide an attachment");this.targetAttachment=aa(this.options.targetAttachment);this.attachment=aa(this.options.attachment);
this.offset=ba(this.options.offset);this.targetOffset=ba(this.options.targetOffset);this.scrollParent!=null&&this.disable();this.scrollParent=this.targetModifier==="scroll-handle"?this.target:qa(this.target);if(this.options.enabled!==false)return this.enable(b)};g.prototype.getTargetBounds=function(){var a,b,c,d,e,h;if(this.targetModifier!=null)switch(this.targetModifier){case "visible":if(this.target===document.body)return{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth};a=z(this.target);
d={height:a.height,width:a.width,top:a.top,left:a.left};d.height=Math.min(d.height,a.height-(pageYOffset-a.top));d.height=Math.min(d.height,a.height-(a.top+a.height-(pageYOffset+innerHeight)));d.height=Math.min(innerHeight,d.height);d.height=d.height-2;d.width=Math.min(d.width,a.width-(pageXOffset-a.left));d.width=Math.min(d.width,a.width-(a.left+a.width-(pageXOffset+innerWidth)));d.width=Math.min(innerWidth,d.width);d.width=d.width-2;if(d.top<pageYOffset)d.top=pageYOffset;if(d.left<pageXOffset)d.left=
pageXOffset;return d;case "scroll-handle":e=this.target;if(e===document.body){e=document.documentElement;a={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}}else a=z(e);h=getComputedStyle(e);b=e.scrollWidth>e.clientWidth||"scroll"===[h.overflow,h.overflowX]||this.target!==document.body;c=0;b&&(c=15);c=a.height-parseFloat(h.borderTopWidth)-parseFloat(h.borderBottomWidth)-c;d={width:15,height:c*0.975*(c/e.scrollHeight),left:a.left+a.width-parseFloat(h.borderLeftWidth)-15};b=0;c<
408&&this.target===document.body&&(b=-1.1E-4*Math.pow(c,2)-0.00727*c+22.58);if(this.target!==document.body)d.height=Math.max(d.height,24);e=this.target.scrollTop/(e.scrollHeight-c);d.top=e*(c-d.height-b)+a.top+parseFloat(h.borderTopWidth);if(this.target===document.body)d.height=Math.max(d.height,24);return d}else return z(this.target)};g.prototype.clearCache=function(){return this._cache={}};g.prototype.cache=function(a,b){if(this._cache==null)this._cache={};this._cache[a]==null&&(this._cache[a]=
b.call(this));return this._cache[a]};g.prototype.enable=function(a){a==null&&(a=true);D(this.target,this.getClass("enabled"));D(this.element,this.getClass("enabled"));this.enabled=true;this.scrollParent!==document&&this.scrollParent.addEventListener("scroll",this.position);if(a)return this.position()};g.prototype.disable=function(){da(this.target,this.getClass("enabled"));da(this.element,this.getClass("enabled"));this.enabled=false;if(this.scrollParent!=null)return this.scrollParent.removeEventListener("scroll",
this.position)};g.prototype.destroy=function(){var a,b,c,d,e;this.disable();e=[];a=c=0;for(d=p.length;c<d;a=++c){b=p[a];if(b===this){p.splice(a,1);break}else e.push(void 0)}return e};g.prototype.updateAttachClasses=function(a,b){var c,d,e,h,f,t=this;if(a==null)a=this.attachment;if(b==null)b=this.targetAttachment;e=["left","top","bottom","right","middle","center"];(c=this._addAttachClasses)!=null&&c.length&&this._addAttachClasses.splice(0,this._addAttachClasses.length);c=this._addAttachClasses!=null?
this._addAttachClasses:this._addAttachClasses=[];a.top&&c.push(""+this.getClass("element-attached")+"-"+a.top);a.left&&c.push(""+this.getClass("element-attached")+"-"+a.left);b.top&&c.push(""+this.getClass("target-attached")+"-"+b.top);b.left&&c.push(""+this.getClass("target-attached")+"-"+b.left);d=[];h=0;for(f=e.length;h<f;h++){c=e[h];d.push(""+this.getClass("element-attached")+"-"+c)}h=0;for(f=e.length;h<f;h++){c=e[h];d.push(""+this.getClass("target-attached")+"-"+c)}return M(function(){if(t._addAttachClasses!=
null){ea(t.element,t._addAttachClasses,d);ea(t.target,t._addAttachClasses,d);return t._addAttachClasses=void 0}})};g.prototype.position=function(a){var b,c,d,e,h,f,t,l,j,k,g,n,i,m,q,v,Q,r,s,u,p=this;a==null&&(a=true);if(this.enabled){this.clearCache();i=pa(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,i);b=this.cache("element-bounds",function(){return z(p.element)});g=b.width;c=b.height;if(g===0&&c===0&&this.lastSize!=null){c=this.lastSize;g=c.width;c=c.height}else this.lastSize=
{width:g,height:c};d=q=this.cache("target-bounds",function(){return p.getTargetBounds()});t=E(Y(this.attachment),{width:g,height:c});m=E(Y(i),d);e=E(this.offset,{width:g,height:c});h=E(this.targetOffset,d);t=X(t,e);m=X(m,h);d=q.left+m.left-t.left;v=q.top+m.top-t.top;u=w.modules;Q=0;for(s=u.length;Q<s;Q++){f=u[Q];f=f.position.call(this,{left:d,top:v,targetAttachment:i,targetPos:q,attachment:this.attachment,elementPos:b,offset:t,targetOffset:m,manualOffset:e,manualTargetOffset:h,scrollbarSize:l});if(!(f==
null||typeof f!=="object")){if(f===false)return false;v=f.top;d=f.left}}b={page:{top:v,left:d},viewport:{top:v-pageYOffset,bottom:pageYOffset-v-c+innerHeight,left:d-pageXOffset,right:pageXOffset-d-g+innerWidth}};if(document.body.scrollWidth>window.innerWidth){l=this.cache("scrollbar-size",$);b.viewport.bottom=b.viewport.bottom-l.height}if(document.body.scrollHeight>window.innerHeight){l=this.cache("scrollbar-size",$);b.viewport.right=b.viewport.right-l.width}if((k=document.body.style.position)!==
""&&k!=="static"||(n=document.body.parentElement.style.position)!==""&&n!=="static"){b.page.bottom=document.body.scrollHeight-v-c;b.page.right=document.body.scrollWidth-d-g}if(((r=this.options.optimizations)!=null?r.moveElement:void 0)!==false&&this.targetModifier==null){j=this.cache("target-offsetparent",function(){return O(p.target)});g=this.cache("target-offsetparent-bounds",function(){return z(j)});k=getComputedStyle(j);getComputedStyle(this.element);l={};i=["Top","Left","Bottom","Right"];r=0;
for(c=i.length;r<c;r++){n=i[r];l[n.toLowerCase()]=parseFloat(k["border"+n+"Width"])}g.right=document.body.scrollWidth-g.left-g.width+l.right;g.bottom=document.body.scrollHeight-g.top-g.height+l.bottom;if(b.page.top>=g.top+l.top&&b.page.bottom>=g.bottom&&b.page.left>=g.left+l.left&&b.page.right>=g.right){n=j.scrollTop;k=j.scrollLeft;b.offset={top:b.page.top-g.top+n-l.top,left:b.page.left-g.left+k-l.left}}}this.move(b);this.history.unshift(b);this.history.length>3&&this.history.pop();a&&Z();return true}};
g.prototype.move=function(a){var b,c,d,e,h,f,g,l,j,k,o,n,i=this;if(this.element.parentNode!=null){f={};for(g in a){f[g]={};for(d in a[g]){c=false;o=this.history;j=0;for(k=o.length;j<k;j++){h=o[j];if(!ra((n=h[g])!=null?n[d]:void 0,a[g][d])){c=true;break}}c||(f[g][d]=true)}}b={top:"",left:"",right:"",bottom:""};h=function(a,c){var d,e;if(((d=i.options.optimizations)!=null?d.gpu:void 0)!==false){if(a.top){b.top=0;e=c.top}else{b.bottom=0;e=-c.bottom}if(a.left){b.left=0;d=c.left}else{b.right=0;d=-c.right}b[A]=
"translateX("+Math.round(d)+"px) translateY("+Math.round(e)+"px)";if(A!=="msTransform")return b[A]=b[A]+" translateZ(0)"}else{a.top?b.top=""+c.top+"px":b.bottom=""+c.bottom+"px";return a.left?b.left=""+c.left+"px":b.right=""+c.right+"px"}};c=false;if((f.page.top||f.page.bottom)&&(f.page.left||f.page.right)){b.position="absolute";h(f.page,a.page)}else if((f.viewport.top||f.viewport.bottom)&&(f.viewport.left||f.viewport.right)){b.position="fixed";h(f.viewport,a.viewport)}else if(f.offset!=null&&f.offset.top&&
f.offset.left){b.position="absolute";e=this.cache("target-offsetparent",function(){return O(i.target)});O(this.element)!==e&&M(function(){i.element.parentNode.removeChild(i.element);return e.appendChild(i.element)});h(f.offset,a.offset);c=true}else{b.position="absolute";h({top:true,left:true},a.page)}if(!c&&this.element.parentNode.tagName!=="BODY"){this.element.parentNode.removeChild(this.element);document.body.appendChild(this.element)}l={};c=false;for(d in b){f=b[d];a=this.element.style[d];if(a!==
""&&f!==""&&(d==="top"||d==="left"||d==="bottom"||d==="right")){a=parseFloat(a);f=parseFloat(f)}if(a!==f){c=true;l[d]=b[d]}}if(c)return M(function(){return N(i.element.style,l)})}};w.position=ca;this.Tether=N(g,w);var ga,sa,ha,ta,ia,ja,u=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},g=this.Tether.Utils;ia=g.getBounds;ha=g.extend;ja=g.updateClasses;sa=g.defer;ga=["left","top","right","bottom"];ta=function(a,b){var c,d,e,h,f;b==="scrollParent"?
b=a.scrollParent:b==="window"&&(b=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]);if(b===document)b=b.documentElement;if(b.nodeType!=null){c=d=ia(b);e=getComputedStyle(b);b=[c.left,c.top,d.width+c.left,d.height+c.top];c=h=0;for(f=ga.length;h<f;c=++h){d=ga[c];d=d[0].toUpperCase()+d.substr(1);b[c]=d==="Top"||d==="Left"?b[c]+parseFloat(e["border"+d+"Width"]):b[c]-parseFloat(e["border"+d+"Width"])}}return b};this.Tether.modules.push({position:function(a){var b,c,d,e,h,f,g,l,
j,k,o,n,i,m,q,v,p,r,s,x,y,w=this;i=a.top;j=a.left;a=a.targetAttachment;if(!this.options.constraints)return true;m=this.cache("element-bounds",function(){return ia(w.element)});l=m.height;m=m.width;if(m===0&&l===0&&this.lastSize!=null){l=this.lastSize;m=l.width;l=l.height}n=this.cache("target-bounds",function(){return w.getTargetBounds()});o=n.height;n=n.width;k={};f={};c=[this.getClass("pinned"),this.getClass("out-of-bounds")];q=this.options.constraints;f=0;for(k=q.length;f<k;f++){g=q[f];g.outOfBoundsClass&&
c.push(g.outOfBoundsClass);g.pinnedClass&&c.push(g.pinnedClass)}k=0;for(v=c.length;k<v;k++){f=c[k];e=["left","top","right","bottom"];q=0;for(p=e.length;q<p;q++){g=e[q];c.push(""+f+"-"+g)}}b=[];k=ha({},a);f=ha({},this.attachment);p=this.options.constraints;q=0;for(v=p.length;q<v;q++){g=p[q];e=g.to;d=g.attachment;g=g.pin;d==null&&(d="");if(u.call(d," ")>=0){h=d.split(" ");d=h[0];h=h[1]}else h=d;e=ta(this,e);if(d==="target"||d==="both"){if(i<e[1]&&k.top==="top"){i=i+o;k.top="bottom"}if(i+l>e[3]&&k.top===
"bottom"){i=i-o;k.top="top"}}if(d==="together"){if(i<e[1]&&k.top==="top")if(f.top==="bottom"){i=i+o;k.top="bottom";i=i+l;f.top="top"}else if(f.top==="top"){i=i+o;k.top="bottom";i=i-l;f.top="bottom"}if(i+l>e[3]&&k.top==="bottom")if(f.top==="top"){i=i-o;k.top="top";i=i-l;f.top="bottom"}else if(f.top==="bottom"){i=i-o;k.top="top";i=i+l;f.top="top"}if(k.top==="middle")if(i+l>e[3]&&f.top==="top"){i=i-l;f.top="bottom"}else if(i<e[1]&&f.top==="bottom"){i=i+l;f.top="top"}}if(h==="target"||h==="both"){if(j<
e[0]&&k.left==="left"){j=j+n;k.left="right"}if(j+m>e[2]&&k.left==="right"){j=j-n;k.left="left"}}if(h==="together")if(j<e[0]&&k.left==="left")if(f.left==="right"){j=j+n;k.left="right";j=j+m;f.left="left"}else{if(f.left==="left"){j=j+n;k.left="right";j=j-m;f.left="right"}}else if(j+m>e[2]&&k.left==="right")if(f.left==="left"){j=j-n;k.left="left";j=j-m;f.left="right"}else{if(f.left==="right"){j=j-n;k.left="left";j=j+m;f.left="left"}}else if(k.left==="center")if(j+m>e[2]&&f.left==="left"){j=j-m;f.left=
"right"}else if(j<e[0]&&f.left==="right"){j=j+m;f.left="left"}if(d==="element"||d==="both"){if(i<e[1]&&f.top==="bottom"){i=i+l;f.top="top"}if(i+l>e[3]&&f.top==="top"){i=i-l;f.top="bottom"}}if(h==="element"||h==="both"){if(j<e[0]&&f.left==="right"){j=j+m;f.left="left"}if(j+m>e[2]&&f.left==="left"){j=j-m;f.left="right"}}if(typeof g==="string"){s=r=h=d=void 0;r=g.split(",");s=[];h=0;for(d=r.length;h<d;h++){g=r[h];s.push(g.trim())}g=s}else g===true&&(g=["top","left","right","bottom"]);g||(g=[]);h=[];
d=[];if(i<e[1])if(u.call(g,"top")>=0){i=e[1];h.push("top")}else d.push("top");if(i+l>e[3])if(u.call(g,"bottom")>=0){i=e[3]-l;h.push("bottom")}else d.push("bottom");if(j<e[0])if(u.call(g,"left")>=0){j=e[0];h.push("left")}else d.push("left");if(j+m>e[2])if(u.call(g,"right")>=0){j=e[2]-m;h.push("right")}else d.push("right");if(h.length){e=(x=this.options.pinnedClass)!=null?x:this.getClass("pinned");b.push(e);s=0;for(r=h.length;s<r;s++){g=h[s];b.push(""+e+"-"+g)}}if(d.length){e=(y=this.options.outOfBoundsClass)!=
null?y:this.getClass("out-of-bounds");b.push(e);s=0;for(r=d.length;s<r;s++){g=d[s];b.push(""+e+"-"+g)}}if(u.call(h,"left")>=0||u.call(h,"right")>=0)f.left=k.left=false;if(u.call(h,"top")>=0||u.call(h,"bottom")>=0)f.top=k.top=false;(k.top!==a.top||k.left!==a.left||f.top!==this.attachment.top||f.left!==this.attachment.left)&&this.updateAttachClasses(f,k)}sa(function(){ja(w.target,b,c);return ja(w.element,b,c)});return{top:i,left:j}}});var ua,va,ka,g=this.Tether.Utils;va=g.getBounds;ka=g.updateClasses;
ua=g.defer;this.Tether.modules.push({position:function(a){var b,c,d,e,h,f,g,l,j,k,o,n,i,m=this;g=a.top;e=a.left;f=this.cache("element-bounds",function(){return va(m.element)});a=f.height;f=f.width;l=this.getTargetBounds();d=g+a;h=e+f;a=[];if(g<=l.bottom&&d>=l.top){i=["left","right"];j=0;for(n=i.length;j<n;j++){f=i[j];((k=l[f])===e||k===h)&&a.push(f)}}if(e<=l.right&&h>=l.left){h=["top","bottom"];k=0;for(e=h.length;k<e;k++){f=h[k];((o=l[f])===g||o===d)&&a.push(f)}}c=[];b=[];g=["left","top","right",
"bottom"];c.push(this.getClass("abutted"));o=0;for(l=g.length;o<l;o++){f=g[o];c.push(""+this.getClass("abutted")+"-"+f)}a.length&&b.push(this.getClass("abutted"));g=0;for(o=a.length;g<o;g++){f=a[g];b.push(""+this.getClass("abutted")+"-"+f)}ua(function(){ka(m.target,b,c);return ka(m.element,b,c)});return true}});this.Tether.modules.push({position:function(a){var b,c,d;d=a.top;b=a.left;if(this.options.shift){a=function(a){return typeof a==="function"?a.call(this,{top:d,left:b}):a};c=a(this.options.shift);
if(typeof c==="string"){c=c.split(" ");c[1]||(c[1]=c[0]);a=c[0];c=c[1];a=parseFloat(a,10);c=parseFloat(c,10)}else{c=[c.top,c.left];a=c[0];c=c[1]}d=d+a;b=b+c;return{top:d,left:b}}}});R.Tether=this.Tether;"function"===typeof define?define("aui/internal/tether",[],function(){return R.Tether}):"object"===typeof exports&&(module.exports=R.Tether)})(this);;
;
/* module-key = 'com.atlassian.auiplugin:aui-core', location = 'js/aui.js' */
(function(){if(!window.jQuery&&!window.Zepto)throw Error("either jQuery or Zepto is required for AJS to function.");var o=window,p=function(a){var b={"<":"&lt;",">":"&gt;","&":"&amp;","'":"&#39;","`":"&#96;"};return"string"===typeof b[a]?b[a]:"&quot;"},m=[],k,i,q=0,r=/[&"'<>`]/g,l={version:"5.8.13",params:{},$:window.jQuery||window.Zepto,preventDefault:function(a){a.preventDefault()},stopEvent:function(a){a.stopPropagation();return!1},include:function(a){if(!this.contains(m,a)){m.push(a);var b=document.createElement("script");
b.src=a;this.$("body").append(b)}},toggleClassName:function(a,b){(a=this.$(a))&&a.toggleClass(b)},setVisible:function(a,b){if(a=this.$(a)){var c=this.$;c(a).each(function(){var a=c(this).hasClass("hidden");a&&b?c(this).removeClass("hidden"):!a&&!b&&c(this).addClass("hidden")})}},setCurrent:function(a,b){if(a=this.$(a))b?a.addClass("current"):a.removeClass("current")},isVisible:function(a){return!this.$(a).hasClass("hidden")},isClipped:function(a){a=AJS.$(a);return a.prop("scrollWidth")>a.prop("clientWidth")},
populateParameters:function(a){a||(a=this.params);var b=this;this.$(".parameters input").each(function(){var c=this.value,d=this.title||this.id;b.$(this).hasClass("list")?a[d]?a[d].push(c):a[d]=[c]:a[d]=c.match(/^(tru|fals)e$/i)?c.toLowerCase()==="true":c})},toInit:function(a){var b=this;this.$(function(){try{a.apply(this,arguments)}catch(c){b.log("Failed to run init function: "+c+"\n"+a.toString())}});return this},indexOf:function(a,b,c){var d=a.length;for(c?0>c&&(c=Math.max(0,d+c)):c=0;c<d;c++)if(a[c]===
b)return c;return-1},contains:function(a,b){return-1<this.indexOf(a,b)},firebug:function(){var a=this.$(document.createElement("script"));a.attr("src","https://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js");this.$("head").append(a);window.firebug?firebug.init():setTimeout(AJS.firebug,0)},clone:function(a){return AJS.$(a).clone().removeAttr("id")},alphanum:function(a,b){for(var a=(a+"").toLowerCase(),b=(b+"").toLowerCase(),c=/(\d+|\D+)/g,d=a.match(c),c=b.match(c),f=Math.max(d.length,
c.length),e=0;e<f;e++){if(e===d.length)return-1;if(e===c.length)return 1;var g=parseInt(d[e],10)+"",h=parseInt(c[e],10)+"";if(g===d[e]&&h===c[e]&&g!==h)return(g-h)/Math.abs(g-h);if((g!==d[e]||h!==c[e])&&d[e]!==c[e])return d[e]<c[e]?-1:1}return 0},onTextResize:function(a){if("function"===typeof a)if(AJS.onTextResize["on-text-resize"])AJS.onTextResize["on-text-resize"].push(function(c){a(c)});else{var b=AJS("div");b.css({width:"1em",height:"1em",position:"absolute",top:"-9999em",left:"-9999em"});this.$("body").append(b);
b.size=b.width();setInterval(function(){if(b.size!==b.width()){b.size=b.width();for(var a=0,d=AJS.onTextResize["on-text-resize"].length;a<d;a++)AJS.onTextResize["on-text-resize"][a](b.size)}},0);AJS.onTextResize.em=b;AJS.onTextResize["on-text-resize"]=[function(b){a(b)}]}},unbindTextResize:function(a){for(var b=0,c=AJS.onTextResize["on-text-resize"].length;b<c;b++)if(AJS.onTextResize["on-text-resize"][b]===a)return AJS.onTextResize["on-text-resize"].splice(b,1)},escape:function(a){return escape(a).replace(/%u\w{4}/gi,
function(a){return unescape(a)})},escapeHtml:function(a){return a.replace(r,p)},filterBySearch:function(a,b,c){if(!b)return[];var d=c&&c.keywordsField||"keywords",f=c&&c.ignoreForCamelCase?"i":"",e=c&&c.matchBoundary?"\\b":"",g=[];b.split(c&&c.splitRegex||/\s+/).forEach(function(a){a=[RegExp(e+a,"i")];if(/^([A-Z][a-z]*) {2,}$/.test(this)){var b=this.replace(/([A-Z][a-z]*)/g,"\\b$1[^,]*");a.push(RegExp(b,f))}g.push(a)});var h=[];a.forEach(function(a){for(var b=0;b<g.length;b++){for(var c=!1,e=0;e<
g[b].length;e++)if(g[b][e].test(a[d])){c=!0;break}if(!c)return}h.push(a)});return h},drawLogo:function(a){var b=a.scaleFactor||1,c=a.fill||"#fff",d=a.stroke||"#000",f=400*b,e=40*b,g=a.strokeWidth||1,a=a.containerID||".aui-logo";AJS.$(".aui-logo").length||AJS.$("body").append('<div id="aui-logo" class="aui-logo"><div>');f=Raphael(a,f+50*b,e+100*b).path("M 0,0 c 3.5433333,-4.7243333 7.0866667,-9.4486667 10.63,-14.173 -14.173,0 -28.346,0 -42.519,0 C -35.432667,-9.4486667 -38.976333,-4.7243333 -42.52,0 -28.346667,0 -14.173333,0 0,0 z m 277.031,28.346 c -14.17367,0 -28.34733,0 -42.521,0 C 245.14,14.173 255.77,0 266.4,-14.173 c -14.17267,0 -28.34533,0 -42.518,0 C 213.25167,0 202.62133,14.173 191.991,28.346 c -14.17333,0 -28.34667,0 -42.52,0 14.17333,-18.8976667 28.34667,-37.7953333 42.52,-56.693 -7.08667,-9.448667 -14.17333,-18.897333 -21.26,-28.346 -14.173,0 -28.346,0 -42.519,0 7.08667,9.448667 14.17333,18.897333 21.26,28.346 -14.17333,18.8976667 -28.34667,37.7953333 -42.52,56.693 -14.173333,0 -28.346667,0 -42.52,0 10.63,-14.173 21.26,-28.346 31.89,-42.519 -14.390333,0 -28.780667,0 -43.171,0 C 42.520733,1.330715e-4 31.889933,14.174867 21.26,28.347 c -42.520624,6.24e-4 -85.039187,-8.13e-4 -127.559,-0.001 11.220667,-14.961 22.441333,-29.922 33.662,-44.883 -6.496,-8.661 -12.992,-17.322 -19.488,-25.983 5.905333,0 11.810667,0 17.716,0 -10.63,-14.173333 -21.26,-28.346667 -31.89,-42.52 14.173333,0 28.346667,0 42.52,0 10.63,14.173333 21.26,28.346667 31.89,42.52 14.173333,0 28.3466667,0 42.52,0 -10.63,-14.173333 -21.26,-28.346667 -31.89,-42.52 14.1733333,0 28.3466667,0 42.52,0 10.63,14.173333 21.26,28.346667 31.89,42.52 14.390333,0 28.780667,0 43.171,0 -10.63,-14.173333 -21.26,-28.346667 -31.89,-42.52 42.51967,0 85.03933,0 127.559,0 10.63033,14.173333 21.26067,28.346667 31.891,42.52 14.17267,0 28.34533,0 42.518,0 -10.63,-14.173333 -21.26,-28.346667 -31.89,-42.52 14.17367,0 28.34733,0 42.521,0 14.17333,18.897667 28.34667,37.795333 42.52,56.693 -14.17333,18.8976667 -28.34667,37.7953333 -42.52,56.693 z");
f.scale(b,-b,0,0);f.translate(120*b,e);f.attr("fill",c);f.attr("stroke",d);f.attr("stroke-width",g)},debounce:function(a,b){var c,d;return function(){var f=arguments,e=this;clearTimeout(c);c=setTimeout(function(){d=a.apply(e,f);e=f=null},b);return d}},debounceImmediate:function(a,b){var c=null,d;return function(){var f=this,e=arguments;null===c&&(d=a.apply(f,e));clearTimeout(c);c=setTimeout(function(){c=f=e=null},b);return d}},id:function(a){k=q++ +"";i=a?a+k:"aui-uid-"+k;if(document.getElementById(i)&&
(i=i+"-"+(new Date).getTime(),document.getElementById(i)))throw Error("ERROR: timestamped fallback ID "+i+" exists. AJS.id stopped.");return i},_addID:function(a,b){var c=AJS.$(a),d=b||!1;c.each(function(){var a=AJS.$(this);a.attr("id")||a.attr("id",AJS.id(d))})},enable:function(a,b){var c=AJS.$(a);"undefined"===typeof b&&(b=!0);return c.each(function(){this.disabled=!b})}};if("undefined"!==typeof AJS)for(var j in AJS)l[j]=AJS[j];j=function(){var a=null;arguments.length&&"string"===typeof arguments[0]&&
(a=AJS.$(document.createElement(arguments[0])),2===arguments.length&&a.html(arguments[1]));return a};for(var n in l)j[n]=l[n];o.AJS=j;AJS.$(function(){var a=AJS.$("body");a.data("auiVersion")||a.attr("data-aui-version",AJS.version);AJS.populateParameters()});AJS.$.ajaxSettings.traditional=!0;AJS.deprecate.prop(AJS,"firebug");AJS.deprecate.prop(AJS,"stopEvent",{alternativeName:"AJS.preventDefault()"});AJS.deprecate.prop(AJS,"drawLogo");AJS.deprecate.prop(AJS,"toggleClassName")})();;
;
/* module-key = 'com.atlassian.auiplugin:aui-core', location = 'js/format.js' */
AJS.format=function(h){var j=/'(?!')/g,n=/^\d+$/,o=/^(\d+),number$/,p=/^(\d+)\,choice\,(.+)/,q=/^(\d+)([#<])(.+)/,l=function(d){for(var f=!1,g=-1,a=0,b=0;b<d.length;b++){var c=d.charAt(b);"'"==c&&(f=!f);if(!f)if("{"===c)0===a&&(g=b),a++;else if("}"===c&&0<a&&(a--,0===a))return f=[],f.push(d.substring(0,b+1)),f.push(d.substring(0,g)),f.push(d.substring(g+1,b)),f}return null};return function(d){for(var f=arguments,g="",a=l(d);a;){var d=d.substring(a[0].length),g=g+a[1].replace(j,""),b=a[2],a=f,c="",
e=void 0;if(b.match(n))c=a.length>++b?a[b]:"";else if(e=b.match(o))c=a.length>++e[1]?a[e[1]]:"";else if(e=b.match(p))if(b=a.length>++e[1]?a[e[1]]:null,null!==b){for(var e=e[2].split("|"),h=null,k=0;k<e.length;k++){var i=e[k].match(q),m=parseInt(i[1],10);if(b<m){c=h?h:i[3];break}if(b==m&&"#"==i[2]){c=i[3];break}k==e.length-1&&(c=i[3]);h=i[3]}a=[c].concat(Array.prototype.slice.call(a,1));c=AJS.format.apply(AJS,a)}g+=c;a=l(d)}return g+=d.replace(j,"")}.apply(AJS,arguments)};
AJS.I18n={getText:function(h){var j=Array.prototype.slice.call(arguments,1);return AJS.I18n.keys&&Object.prototype.hasOwnProperty.call(AJS.I18n.keys,h)?AJS.format.apply(null,[AJS.I18n.keys[h]].concat(j)):h}};;
;
/* module-key = 'com.atlassian.auiplugin:aui-core', location = 'js/blanket.js' */
(function(c){var a;AJS.dim=function(d,b){a||(a=c(document.body));!0===d&&e();var f=!!AJS.dim.$dim&&"false"===AJS.dim.$dim.attr("aria-hidden");AJS.dim.$dim&&(AJS.dim.$dim.remove(),AJS.dim.$dim=null);AJS.dim.$dim=AJS("div").addClass("aui-blanket");AJS.dim.$dim.attr("tabindex","0");AJS.dim.$dim.appendTo(document.body);f||(AJS._internal.animation.recomputeStyle(AJS.dim.$dim),AJS.dim.cachedOverflow=a.css("overflow"),a.css("overflow","hidden"));AJS.dim.$dim.attr("aria-hidden","false");b&&AJS.dim.$dim.css({zIndex:b});
return AJS.dim.$dim};AJS.undim=function(){AJS.dim.$dim&&(AJS.dim.$dim.attr("aria-hidden","true"),a&&a.css("overflow",AJS.dim.cachedOverflow))};var e=AJS.deprecate.getMessageLogger("useShim",{extraInfo:"useShim has no alternative as it is now calculated by dim()."})})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:ajs-gadgets-base', location = 'js-vendor/jquery/plugins/jquery.aop.js' */
(function(){for(var g=!0,h,i=Object.prototype.toString,j={},q={1:"element",3:"textnode",9:"document",11:"fragment"},k="Arguments Array Boolean Date Document Element Error Fragment Function NodeList Null Number Object RegExp String TextNode Undefined Window".split(" "),l=k.length;l--;){var m=k[l],n=window[m];if(n)try{j[i.call(new n)]=m.toLowerCase()}catch(r){}}h=function(a){return null==a&&(void 0===a?"undefined":"null")||a.nodeType&&q[a.nodeType]||"number"==typeof a.length&&(a.callee&&"arguments"||
a.alert&&"window"||a.item&&"nodelist")||j[i.call(a)]};var o=function(a,b,d){var e=a[b];6!=d.type&&"function"!=h(e)&&(e=function(){for(var a=0<arguments.length?"arguments[0]":"",b=1;b<arguments.length;b++)a+=",arguments["+b+"]";return eval("oldObject("+a+");")});var c;1==d.type||2==d.type||3==d.type?c=function(){var a,c=null;try{a=e.apply(this,arguments)}catch(f){c=f}if(1==d.type)if(null==c)a=d.value.apply(this,[a,b]);else throw c;else 2==d.type&&null!=c?a=d.value.apply(this,[c,b]):3==d.type&&(a=d.value.apply(this,
[a,c,b]));return a}:4==d.type?c=function(){d.value.apply(this,[arguments,b]);return e.apply(this,arguments)}:6==d.type?c=function(){return d.value.apply(this,arguments)}:5==d.type&&(c=function(){var a=this,c=Array.prototype.slice.call(arguments);return d.value.apply(a,[{arguments:c,method:b,proceed:function(){return e.apply(a,c)}}])});c.unweave=function(){a[b]=e;pointcut=a=c=e=null};return a[b]=c},p=function(a,b,d){var e=[],c;for(c in a){var f=null;try{f=a[c]}catch(g){}null!=f&&(c.match(b.method)&&
"function"==h(f))&&(e[e.length]={source:a,method:c,advice:d})}return e},f=function(a,b){var d="undefined"!=typeof a.target.prototype?a.target.prototype:a.target,e=[];if(6!=b.type&&"undefined"==typeof d[a.method]){var c=p(a.target,a,b);0==c.length&&(c=p(d,a,b));for(var f in c)e[e.length]=o(c[f].source,c[f].method,c[f].advice)}else e[0]=o(d,a.method,b);return g?e:e[0]};jQuery.aop={after:function(a,b){return f(a,{type:1,value:b})},afterThrow:function(a,b){return f(a,{type:2,value:b})},afterFinally:function(a,
b){return f(a,{type:3,value:b})},before:function(a,b){return f(a,{type:4,value:b})},around:function(a,b){return f(a,{type:5,value:b})},introduction:function(a,b){return f(a,{type:6,value:b})},setup:function(a){g=a.regexMatch}}})();;
;
/* module-key = 'com.atlassian.auiplugin:ajs-gadgets-base', location = 'js/dropdown.js' */
AJS.dropDown=function(b,f){var a=null,m=[],j=!1,l=AJS.$(document),d={item:"li:has(a)",activeClass:"active",alignment:"right",displayHandler:function(a){return a.name},escapeHandler:function(){this.hide("escape");return!1},hideHandler:function(){},moveHandler:function(){},useDisabled:!1};AJS.$.extend(d,f);d.alignment={left:"left",right:"right"}[d.alignment.toLowerCase()]||"left";if(b&&b.jquery)a=b;else if("string"==typeof b)a=AJS.$(b);else if(b&&b.constructor==Array){for(var a=AJS("div").addClass("aui-dropdown").toggleClass("hidden",
!!d.isHiddenByDefault),n=0,r=b.length;n<r;n++){for(var g=AJS("ol"),c=0,k=b[n].length;c<k;c++){var h=AJS("li"),i=b[n][c];i.href?(h.append(AJS("a").html("<span>"+d.displayHandler(i)+"</span>").attr({href:i.href}).addClass(i.className)),AJS.$.data(AJS.$("a > span",h)[0],"properties",i)):h.html(i.html).addClass(i.className);i.icon&&h.prepend(AJS("img").attr("src",i.icon));i.insideSpanIcon&&h.children("a").prepend(AJS("span").attr("class","icon"));i.iconFontClass&&h.children("a").prepend(AJS("span").addClass("aui-icon aui-icon-small aui-iconfont-"+
i.iconFontClass));AJS.$.data(h[0],"properties",i);g.append(h)}n==r-1&&g.addClass("last");a.append(g)}AJS.$("body").append(a)}else throw Error("AJS.dropDown function was called with illegal parameter. Should be AJS.$ object, AJS.$ selector or array.");var t=function(){s(1)},u=function(){s(-1)},s=function(a){var b=!j,e=AJS.dropDown.current.$[0],c=AJS.dropDown.current.links,f=e.focused;j=!0;if(0!==c.length){e.focused="number"===typeof f?f:-1;if(!AJS.dropDown.current)return AJS.log("move - not current, aborting"),
!0;e.focused+=a;0>e.focused?e.focused=c.length-1:e.focused>=c.length&&(e.focused=0);d.moveHandler(AJS.$(c[e.focused]),0>a?"up":"down");b&&c.length?(AJS.$(c[e.focused]).addClass(d.activeClass),j=!1):c.length||(j=!1)}},o=function(a){if(!AJS.dropDown.current)return!0;var c=a.which,e=AJS.dropDown.current.$[0],b=AJS.dropDown.current.links;AJS.dropDown.current.cleanActive();switch(c){case 40:t();break;case 38:u();break;case 27:return d.escapeHandler.call(AJS.dropDown.current,a);case 13:return 0<=e.focused?
d.selectionHandler?d.selectionHandler.call(AJS.dropDown.current,a,AJS.$(b[e.focused])):"a"!=AJS.$(b[e.focused]).attr("nodeName")?AJS.$("a",b[e.focused]).trigger("focus"):AJS.$(b[e.focused]).trigger("focus"):!0;default:return b.length&&AJS.$(b[e.focused]).addClass(d.activeClass),!0}a.stopPropagation();a.preventDefault();return!1},p=function(a){a&&a.which&&3==a.which||a&&a.button&&2==a.button||AJS.dropDown.current&&AJS.dropDown.current.hide("click")},q=function(a){return function(){AJS.dropDown.current&&
(AJS.dropDown.current.cleanFocus(),this.originalClass=this.className,AJS.$(this).addClass(d.activeClass),AJS.dropDown.current.$[0].focused=a)}},v=function(a){if(a.button||a.metaKey||a.ctrlKey||a.shiftKey)return!0;AJS.dropDown.current&&d.selectionHandler&&d.selectionHandler.call(AJS.dropDown.current,a,AJS.$(this))};a.each(function(){var a=this,b=AJS.$(this),e={},c={reset:function(){e=AJS.$.extend(e,{$:b,links:AJS.$(d.item||"li:has(a)",a),cleanActive:function(){a.focused+1&&e.links.length&&AJS.$(e.links[a.focused]).removeClass(d.activeClass)},
cleanFocus:function(){e.cleanActive();a.focused=-1},moveDown:t,moveUp:u,moveFocus:o,getFocusIndex:function(){return"number"==typeof a.focused?a.focused:-1}});e.links.each(function(a){var b=AJS.$(this),c=!1;b.data("events")&&AJS.$.each(b.data("events"),function(a,b){AJS.$.each(b,function(a,b){if(v===b)return c=!0,!1})});c||(b.hover(q(a),e.cleanFocus),b.click(v))})},appear:function(a){a?(b.removeClass("hidden"),b.addClass("aui-dropdown-"+d.alignment)):b.addClass("hidden")},fade:function(a){a?b.fadeIn("fast"):
b.fadeOut("fast")},scroll:function(a){a?b.slideDown("fast"):b.slideUp("fast")}};e.reset=c.reset;e.reset();e.addControlProcess=function(a,b){AJS.$.aop.around({target:this,method:a},b)};e.addCallback=function(a,b){return AJS.$.aop.after({target:this,method:a},b)};e.show=function(b){if(!d.useDisabled||!this.$.closest(".aui-dd-parent").hasClass("disabled"))this.alignment=d.alignment,p(),AJS.dropDown.current=this,this.method=b||this.method||"appear",this.timer=setTimeout(function(){l.click(p)},0),l.keydown(o),
d.firstSelected&&this.links[0]&&q(0).call(this.links[0]),AJS.$(a.offsetParent).css({zIndex:2E3}),c[this.method](!0),AJS.$(document).trigger("showLayer",["dropdown",AJS.dropDown.current])};e.hide=function(a){this.method=this.method||"appear";AJS.$(b.get(0).offsetParent).css({zIndex:""});this.cleanFocus();c[this.method](!1);l.unbind("click",p).unbind("keydown",o);AJS.$(document).trigger("hideLayer",["dropdown",AJS.dropDown.current]);AJS.dropDown.current=null;return a};e.addCallback("reset",function(){d.firstSelected&&
this.links[0]&&q(0).call(this.links[0])});AJS.dropDown.iframes||(AJS.dropDown.iframes=[]);AJS.dropDown.createShims=function w(){AJS.$("iframe").each(function(){if(!this.shim){this.shim=AJS.$("<div />").addClass("shim hidden").appendTo("body");AJS.dropDown.iframes.push(this)}});return w}();e.addCallback("show",function(){AJS.$(AJS.dropDown.iframes).each(function(){var a=AJS.$(this);if(a.is(":visible")){var b=a.offset();b.height=a.height();b.width=a.width();this.shim.css({left:b.left+"px",top:b.top+
"px",height:b.height+"px",width:b.width+"px"}).removeClass("hidden")}})});e.addCallback("hide",function(){AJS.$(AJS.dropDown.iframes).each(function(){this.shim.addClass("hidden")});d.hideHandler()});m.push(e)});return m};
AJS.dropDown.getAdditionalPropertyValue=function(b,f){var a=b[0];(!a||"string"!=typeof a.tagName||"li"!=a.tagName.toLowerCase())&&AJS.log("AJS.dropDown.getAdditionalPropertyValue : item passed in should be an LI element wrapped by jQuery");return(a=AJS.$.data(a,"properties"))?a[f]:null};AJS.dropDown.removeAllAdditionalProperties=function(){};
AJS.dropDown.Standard=function(b){var f=[],a={selector:".aui-dd-parent",dropDown:".aui-dropdown",trigger:".aui-dd-trigger"};AJS.$.extend(a,b);var m=function(b,d,f,c){AJS.$.extend(c,{trigger:b});d.addClass("dd-allocated");f.addClass("hidden");!1==a.isHiddenByDefault&&c.show();c.addCallback("show",function(){d.addClass("active")});c.addCallback("hide",function(){d.removeClass("active")})},j=function(a,b,d,c){c!=AJS.dropDown.current&&(d.css({top:b.outerHeight()}),c.show(),a.stopImmediatePropagation());
a.preventDefault()};if(a.useLiveEvents){var l=[],d=[];AJS.$(a.trigger).live("click",function(b){var f=AJS.$(this),g,c,k;if(0<=(g=AJS.$.inArray(this,l))){var h=d[g];c=h.dropdown;k=h.ddcontrol}else{g=f.closest(a.selector);c=g.find(a.dropDown);if(0===c.length)return;k=AJS.dropDown(c,a)[0];if(!k)return;l.push(this);h={parent:g,dropdown:c,ddcontrol:k};m(f,g,c,k);d.push(h)}j(b,f,c,k)})}else b=this instanceof AJS.$?this:AJS.$(a.selector),b=b.not(".dd-allocated").filter(":has("+a.dropDown+")").filter(":has("+
a.trigger+")"),b.each(function(){var b=AJS.$(this),d=AJS.$(a.dropDown,this),g=AJS.$(a.trigger,this),c=AJS.dropDown(d,a)[0];AJS.$.extend(c,{trigger:g});m(g,b,d,c);g.click(function(a){j(a,g,d,c)});f.push(c)});return f};
AJS.dropDown.Ajax=function(b){var f={cache:!0};AJS.$.extend(f,b||{});b=AJS.dropDown.Standard.call(this,f);AJS.$(b).each(function(){var a=this;AJS.$.extend(a,{getAjaxOptions:function(b){var j=function(b){f.formatResults&&(b=f.formatResults(b));f.cache&&a.cache.set(a.getAjaxOptions(),b);a.refreshSuccess(b)};return f.ajaxOptions?AJS.$.isFunction(f.ajaxOptions)?AJS.$.extend(f.ajaxOptions.call(a),{success:j}):AJS.$.extend(f.ajaxOptions,{success:j}):AJS.$.extend(b,{success:j})},refreshSuccess:function(a){this.$.html(a)},
cache:function(){var a={};return{get:function(b){return a[(b.url+(b.data||"")).replace(/[\?\&]/gi,"")]},set:function(b,f){a[(b.url+(b.data||"")).replace(/[\?\&]/gi,"")]=f},reset:function(){a={}}}}(),show:function(b){return function(){f.cache&&a.cache.get(a.getAjaxOptions())?(a.refreshSuccess(a.cache.get(a.getAjaxOptions())),b.call(a)):(AJS.$(AJS.$.ajax(a.getAjaxOptions())).throbber({target:a.$,end:function(){a.reset()}}),b.call(a),a.iframeShim&&a.iframeShim.hide())}}(a.show),resetCache:function(){a.cache.reset()}});
a.addCallback("refreshSuccess",function(){a.reset()})});return b};AJS.$.fn.dropDown=function(b,f){b=(b||"Standard").replace(/^([a-z])/,function(a){return a.toUpperCase()});return AJS.dropDown[b].call(this,f)};AJS.$.fn.dropDown=AJS.deprecate.construct(AJS.$.fn.dropDown,"Dropdown constructor",{alternativeName:"Dropdown2"});;
;
/* module-key = 'com.atlassian.auiplugin:ajs-evejs', location = 'js-vendor/eve/eve.js' */
(function(q){var m=/[\.\/]/,r=function(){},s=function(l,f){return l-f},o,i,p={n:{}},d=function(l,f){var h=i,a=Array.prototype.slice.call(arguments,2),b=d.listeners(l),g=0,c,n=[],e={},j=[],t=o;o=l;for(var k=i=0,m=b.length;k<m;k++)"zIndex"in b[k]&&(n.push(b[k].zIndex),0>b[k].zIndex&&(e[b[k].zIndex]=b[k]));for(n.sort(s);0>n[g];)if(c=e[n[g++]],j.push(c.apply(f,a)),i)return i=h,j;for(k=0;k<m;k++)if(c=b[k],"zIndex"in c)if(c.zIndex==n[g]){j.push(c.apply(f,a));if(i)break;do if(g++,(c=e[n[g]])&&j.push(c.apply(f,
a)),i)break;while(c)}else e[c.zIndex]=c;else if(j.push(c.apply(f,a)),i)break;i=h;o=t;return j.length?j:null};d.listeners=function(l){var l=l.split(m),f=p,h,a,b,g,c,d,e,j=[f],i=[];b=0;for(g=l.length;b<g;b++){e=[];c=0;for(d=j.length;c<d;c++){f=j[c].n;h=[f[l[b]],f["*"]];for(a=2;a--;)if(f=h[a])e.push(f),i=i.concat(f.f||[])}j=e}return i};d.on=function(d,f){for(var h=d.split(m),a=p,b=0,g=h.length;b<g;b++)a=a.n,!a[h[b]]&&(a[h[b]]={n:{}}),a=a[h[b]];a.f=a.f||[];b=0;for(g=a.f.length;b<g;b++)if(a.f[b]==f)return r;
a.f.push(f);return function(a){+a==+a&&(f.zIndex=+a)}};d.stop=function(){i=1};d.nt=function(d){return d?RegExp("(?:\\.|\\/|^)"+d+"(?:\\.|\\/|$)").test(o):o};d.unbind=function(d,f){var h=d.split(m),a,b,g,c,i,e,j=[p];c=0;for(i=h.length;c<i;c++)for(e=0;e<j.length;e+=g.length-2){g=[e,1];a=j[e].n;if("*"!=h[c])a[h[c]]&&g.push(a[h[c]]);else for(b in a)a.hasOwnProperty(b)&&g.push(a[b]);j.splice.apply(j,g)}c=0;for(i=j.length;c<i;c++)for(a=j[c];a.n;){if(f){if(a.f){e=0;for(h=a.f.length;e<h;e++)if(a.f[e]==f){a.f.splice(e,
1);break}!a.f.length&&delete a.f}for(b in a.n)if(a.n.hasOwnProperty(b)&&a.n[b].f){g=a.n[b].f;e=0;for(h=g.length;e<h;e++)if(g[e]==f){g.splice(e,1);break}!g.length&&delete a.n[b].f}}else for(b in delete a.f,a.n)a.n.hasOwnProperty(b)&&a.n[b].f&&delete a.n[b].f;a=a.n}};d.once=function(i,f){var h=function(){var a=f.apply(this,arguments);d.unbind(i,h);return a};return d.on(i,h)};d.version="0.3.4";d.toString=function(){return"You are running Eve 0.3.4"};d.off=d.unbind;q.eve=d;"function"===typeof define&&
(define("eve",function(){console&&console.warn&&console.warn("DEPRECATED - requiring 'eve' has been deprecated since AUI 5.7 and will be removed in AUI 6.0.");return d}),define("aui/internal/eve",function(){return d}))})(this);;
;
/* module-key = 'com.atlassian.auiplugin:ajs-raphael', location = 'js-vendor/raphael/raphael.js' */
(function(){function e(a){if(e.is(a,"function"))return ga?a():eve.on("raphael.DOMload",a);if(e.is(a,U))return e._engine.create[B](e,a.splice(0,3+e.is(a[0],v))).add(a);var f=Array.prototype.slice.call(arguments,0);if(e.is(f[f.length-1],"function")){var l=f.pop();return ga?l.call(e._engine.create[B](e,f)):eve.on("raphael.DOMload",function(){l.call(e._engine.create[B](e,f))})}return e._engine.create[B](e,arguments)}function G(a){if(Object(a)!==a)return a;var f=new a.constructor,l;for(l in a)a[I](l)&&
(f[l]=G(a[l]));return f}function C(a,f,l){function D(){var b=Array.prototype.slice.call(arguments,0),E=b.join("\u2400"),d=D.cache=D.cache||{},e=D.count=D.count||[];if(d[I](E)){a:for(var b=e,e=E,c=0,h=b.length;c<h;c++)if(b[c]===e){b.push(b.splice(c,1)[0]);break a}return l?l(d[E]):d[E]}1E3<=e.length&&delete d[e.shift()];e.push(E);d[E]=a[B](f,b);return l?l(d[E]):d[E]}return D}function V(){return this.hex}function K(a,f){for(var l=[],D=0,b=a.length;b-2*!f>D;D+=2){var E=[{x:+a[D-2],y:+a[D-1]},{x:+a[D],
y:+a[D+1]},{x:+a[D+2],y:+a[D+3]},{x:+a[D+4],y:+a[D+5]}];f?D?b-4==D?E[3]={x:+a[0],y:+a[1]}:b-2==D&&(E[2]={x:+a[0],y:+a[1]},E[3]={x:+a[2],y:+a[3]}):E[0]={x:+a[b-2],y:+a[b-1]}:b-4==D?E[3]=E[2]:D||(E[0]={x:+a[D],y:+a[D+1]});l.push(["C",(-E[0].x+6*E[1].x+E[2].x)/6,(-E[0].y+6*E[1].y+E[2].y)/6,(E[1].x+6*E[2].x-E[3].x)/6,(E[1].y+6*E[2].y-E[3].y)/6,E[2].x,E[2].y])}return l}function X(a,f,l,D,b,E,d,e,c){null==c&&(c=1);for(var c=(1<c?1:0>c?0:c)/2,h=[-0.1252,0.1252,-0.3678,0.3678,-0.5873,0.5873,-0.7699,0.7699,
-0.9041,0.9041,-0.9816,0.9816],g=[0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],i=0,j=0;12>j;j++)var m=c*h[j]+c,n=m*(m*(-3*a+9*l-9*b+3*d)+6*a-12*l+6*b)-3*a+3*l,m=m*(m*(-3*f+9*D-9*E+3*e)+6*f-12*D+6*E)-3*f+3*D,i=i+g[j]*k.sqrt(n*n+m*m);return c*i}function ea(a,f,l,D,b,d,e,c,h){if(!(0>h||X(a,f,l,D,b,d,e,c)<h)){var g=0.5,i=1-g,o;for(o=X(a,f,l,D,b,d,e,c,i);0.01<S(o-h);)g/=2,i+=(o<h?1:-1)*g,o=X(a,f,l,D,b,d,e,c,i);return i}}function Y(a,f,l){for(var a=e._path2curve(a),
f=e._path2curve(f),D,b,d,c,h,g,i,j,o,m,k=l?0:[],v=0,t=a.length;v<t;v++)if(o=a[v],"M"==o[0])D=h=o[1],b=g=o[2];else{"C"==o[0]?(o=[D,b].concat(o.slice(1)),D=o[6],b=o[7]):(o=[D,b,D,b,h,g,h,g],D=h,b=g);for(var L=0,x=f.length;L<x;L++)if(m=f[L],"M"==m[0])d=i=m[1],c=j=m[2];else{"C"==m[0]?(m=[d,c].concat(m.slice(1)),d=m[6],c=m[7]):(m=[d,c,d,c,i,j,i,j],d=i,c=j);var u;var q=o,s=m;u=l;var w=e.bezierBBox(q),A=e.bezierBBox(s);if(e.isBBoxIntersect(w,A)){for(var w=X.apply(0,q),A=X.apply(0,s),w=~~(w/5),A=~~(A/5),
z=[],C=[],G={},F=u?0:[],y=0;y<w+1;y++){var H=e.findDotsAtSegment.apply(e,q.concat(y/w));z.push({x:H.x,y:H.y,t:y/w})}for(y=0;y<A+1;y++)H=e.findDotsAtSegment.apply(e,s.concat(y/A)),C.push({x:H.x,y:H.y,t:y/A});for(y=0;y<w;y++)for(q=0;q<A;q++){var B=z[y],I=z[y+1],s=C[q],H=C[q+1],J=0.001>S(I.x-B.x)?"y":"x",U=0.001>S(H.x-s.x)?"y":"x",R;R=B.x;var K=B.y,M=I.x,N=I.y,O=s.x,da=s.y,P=H.x,Q=H.y;if(n(R,M)<p(O,P)||p(R,M)>n(O,P)||n(K,N)<p(da,Q)||p(K,N)>n(da,Q))R=void 0;else{var T=(R*N-K*M)*(O-P)-(R-M)*(O*Q-da*P),
V=(R*N-K*M)*(da-Q)-(K-N)*(O*Q-da*P),$=(R-M)*(da-Q)-(K-N)*(O-P);if($){var T=T/$,V=V/$,$=+T.toFixed(2),W=+V.toFixed(2);R=$<+p(R,M).toFixed(2)||$>+n(R,M).toFixed(2)||$<+p(O,P).toFixed(2)||$>+n(O,P).toFixed(2)||W<+p(K,N).toFixed(2)||W>+n(K,N).toFixed(2)||W<+p(da,Q).toFixed(2)||W>+n(da,Q).toFixed(2)?void 0:{x:T,y:V}}else R=void 0}R&&G[R.x.toFixed(4)]!=R.y.toFixed(4)&&(G[R.x.toFixed(4)]=R.y.toFixed(4),B=B.t+S((R[J]-B[J])/(I[J]-B[J]))*(I.t-B.t),s=s.t+S((R[U]-s[U])/(H[U]-s[U]))*(H.t-s.t),0<=B&&(1>=B&&0<=
s&&1>=s)&&(u?F++:F.push({x:R.x,y:R.y,t1:B,t2:s})))}u=F}else u=u?0:[];if(l)k+=u;else{w=0;for(A=u.length;w<A;w++)u[w].segment1=v,u[w].segment2=L,u[w].bez1=o,u[w].bez2=m;k=k.concat(u)}}}return k}function M(a,f,l,D,b,d){null!=a?(this.a=+a,this.b=+f,this.c=+l,this.d=+D,this.e=+b,this.f=+d):(this.a=1,this.c=this.b=0,this.d=1,this.f=this.e=0)}function fa(){return this.x+d+this.y+d+this.width+" \u00d7 "+this.height}function P(a,f){var l=[],D={};this.ms=f;this.times=1;if(a){for(var b in a)a[I](b)&&(D[H(b)]=
a[b],l.push(H(b)));l.sort(fb)}this.anim=D;this.top=l[l.length-1];this.percents=l}function N(a,f,l,b,d,E){var l=H(l),g,la,j,m,k,o,n=a.ms,r={},p={},t={};if(b){o=0;for(x=y.length;o<x;o++){var L=y[o];if(L.el.id==f.id&&L.anim==a){L.percent!=l?(y.splice(o,1),j=1):la=L;f.attr(L.totalOrigin);break}}}else b=+p;o=0;for(var x=a.percents.length;o<x;o++)if(a.percents[o]==l||a.percents[o]>b*a.top){l=a.percents[o];k=a.percents[o-1]||0;n=n/a.top*(l-k);m=a.percents[o+1];g=a.anim[l];break}else b&&f.attr(a.anim[a.percents[o]]);
if(g){if(la)la.initstatus=b,la.start=new Date-la.ms*b;else{for(var u in g)if(g[I](u)&&(xa[I](u)||f.paper.customAttributes[I](u)))switch(r[u]=f.attr(u),null==r[u]&&(r[u]=gb[u]),p[u]=g[u],xa[u]){case v:t[u]=(p[u]-r[u])/n;break;case "colour":r[u]=e.getRGB(r[u]);o=e.getRGB(p[u]);t[u]={r:(o.r-r[u].r)/n,g:(o.g-r[u].g)/n,b:(o.b-r[u].b)/n};break;case "path":o=pa(r[u],p[u]);L=o[1];r[u]=o[0];t[u]=[];o=0;for(x=r[u].length;o<x;o++){t[u][o]=[0];for(var q=1,s=r[u][o].length;q<s;q++)t[u][o][q]=(L[o][q]-r[u][o][q])/
n}break;case "transform":o=f._;if(x=hb(o[u],p[u])){r[u]=x.from;p[u]=x.to;t[u]=[];t[u].real=!0;o=0;for(x=r[u].length;o<x;o++){t[u][o]=[r[u][o][0]];q=1;for(s=r[u][o].length;q<s;q++)t[u][o][q]=(p[u][o][q]-r[u][o][q])/n}}else x=f.matrix||new M,o={_:{transform:o.transform},getBBox:function(){return f.getBBox(1)}},r[u]=[x.a,x.b,x.c,x.d,x.e,x.f],Ma(o,p[u]),p[u]=o._.transform,t[u]=[(o.matrix.a-x.a)/n,(o.matrix.b-x.b)/n,(o.matrix.c-x.c)/n,(o.matrix.d-x.d)/n,(o.matrix.e-x.e)/n,(o.matrix.f-x.f)/n];break;case "csv":x=
h(g[u])[i](ca);L=h(r[u])[i](ca);if("clip-rect"==u){r[u]=L;t[u]=[];for(o=L.length;o--;)t[u][o]=(x[o]-r[u][o])/n}p[u]=x;break;default:x=[][c](g[u]);L=[][c](r[u]);t[u]=[];for(o=f.paper.customAttributes[u].length;o--;)t[u][o]=((x[o]||0)-(L[o]||0))/n}o=g.easing;u=e.easing_formulas[o];if(!u)if((u=h(o).match(ib))&&5==u.length){var w=u;u=function(a){var f=+w[1],l=+w[2],b=3*f,D=3*(+w[3]-f)-b,d=1-b-D,f=3*l,l=3*(+w[4]-l)-f,E=1-f-l,a=function(a,f){var l,E,c,e;c=a;for(E=0;8>E;E++){e=((d*c+D)*c+b)*c-a;if(S(e)<
f)return c;l=(3*d*c+2*D)*c+b;if(1E-6>S(l))break;c-=e/l}l=0;E=1;c=a;if(c<l)return l;if(c>E)return E;for(;l<E;){e=((d*c+D)*c+b)*c;if(S(e-a)<f)break;a>e?l=c:E=c;c=(E-l)/2+l}return c}(a,1/(200*n));return((E*a+l)*a+f)*a}}else u=jb;o=g.start||a.start||+new Date;L={anim:a,percent:l,timestamp:o,start:o+(a.del||0),status:0,initstatus:b||0,stop:!1,ms:n,easing:u,from:r,diff:t,to:p,el:f,callback:g.callback,prev:k,next:m,repeat:E||a.times,origin:f.attr(),totalOrigin:d};y.push(L);if(b&&(!la&&!j)&&(L.stop=!0,L.start=
new Date-n*b,1==y.length))return ya();j&&(L.start=new Date-L.ms*b);1==y.length&&Na(ya)}eve("raphael.anim.start."+f.id,f,a)}}function q(a){for(var f=0;f<y.length;f++)y[f].el.paper==a&&y.splice(f--,1)}e.version="2.1.0";e.eve=eve;var ga,ca=/[, ]+/,Z={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},ma=/\{(\d+)\}/g,I="hasOwnProperty",s={doc:document,win:window},aa=Object.prototype[I].call(s.win,"Raphael"),O=s.win.Raphael,z=function(){this.ca=this.customAttributes={}},F,B="apply",c="concat",b="createTouch"in
s.doc,d=" ",h=String,i="split",g="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[i](d),j={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},m=h.prototype.toLowerCase,k=Math,n=k.max,p=k.min,S=k.abs,w=k.pow,A=k.PI,v="number",U="array",da=Object.prototype.toString;e._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i;var kb=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,
lb={NaN:1,Infinity:1,"-Infinity":1},ib=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,$=k.round,H=parseFloat,ha=parseInt,Oa=h.prototype.toUpperCase,gb=e._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,
rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},xa=e._availableAnimAttrs={blur:v,"clip-rect":"csv",cx:v,cy:v,fill:"colour","fill-opacity":v,"font-size":v,height:v,opacity:v,path:"path",r:v,rx:v,ry:v,stroke:"colour","stroke-opacity":v,"stroke-width":v,transform:"transform",width:v,x:v,y:v},za=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,
mb={hs:1,rg:1},nb=/,?([achlmqrstvxz]),?/gi,ob=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,
pb=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,Pa=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig;
e._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/;var qa={},fb=function(a,f){return H(a)-H(f)},qb=function(){},jb=function(a){return a},Aa=e._rectPath=function(a,f,l,b,d){return d?[["M",a+d,f],["l",l-2*d,0],["a",d,d,0,0,1,
d,d],["l",0,b-2*d],["a",d,d,0,0,1,-d,d],["l",2*d-l,0],["a",d,d,0,0,1,-d,-d],["l",0,2*d-b],["a",d,d,0,0,1,d,-d],["z"]]:[["M",a,f],["l",l,0],["l",0,b],["l",-l,0],["z"]]},Qa=function(a,f,l,b){null==b&&(b=l);return[["M",a,f],["m",0,-b],["a",l,b,0,1,1,0,2*b],["a",l,b,0,1,1,0,-2*b],["z"]]},ra=e._getPath={path:function(a){return a.attr("path")},circle:function(a){a=a.attrs;return Qa(a.cx,a.cy,a.r)},ellipse:function(a){a=a.attrs;return Qa(a.cx,a.cy,a.rx,a.ry)},rect:function(a){a=a.attrs;return Aa(a.x,a.y,
a.width,a.height,a.r)},image:function(a){a=a.attrs;return Aa(a.x,a.y,a.width,a.height)},text:function(a){a=a._getBBox();return Aa(a.x,a.y,a.width,a.height)}},Ba=e.mapPath=function(a,f){if(!f)return a;var l,b,d,c,e,h,g,a=pa(a);d=0;for(e=a.length;d<e;d++){g=a[d];c=1;for(h=g.length;c<h;c+=2)l=f.x(g[c],g[c+1]),b=f.y(g[c],g[c+1]),g[c]=l,g[c+1]=b}return a};e._g=s;e.type=s.win.SVGAngle||s.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if("VML"==e.type){var Ca=
s.doc.createElement("div"),sa;Ca.innerHTML='<v:shape adj="1"/>';sa=Ca.firstChild;sa.style.behavior="url(#default#VML)";if(!(sa&&"object"==typeof sa.adj))return e.type="";Ca=null}e.svg=!(e.vml="VML"==e.type);e._Paper=z;e.fn=F=z.prototype=e.prototype;e._id=0;e._oid=0;e.is=function(a,f){f=m.call(f);return"finite"==f?!lb[I](+a):"array"==f?a instanceof Array:"null"==f&&null===a||f==typeof a&&null!==a||"object"==f&&a===Object(a)||"array"==f&&Array.isArray&&Array.isArray(a)||da.call(a).slice(8,-1).toLowerCase()==
f};e.angle=function(a,f,l,b,d,c){return null==d?(a-=l,f-=b,!a&&!f?0:(180*k.atan2(-f,-a)/A+540)%360):e.angle(a,f,d,c)-e.angle(l,b,d,c)};e.rad=function(a){return a%360*A/180};e.deg=function(a){return 180*a/A%360};e.snapTo=function(a,f,l){l=e.is(l,"finite")?l:10;if(e.is(a,U))for(var b=a.length;b--;){if(S(a[b]-f)<=l)return a[b]}else{a=+a;b=f%a;if(b<l)return f-b;if(b>a-l)return f-b+a}return f};var rb=/[xy]/g,sb=function(a){var f=16*k.random()|0;return("x"==a?f:f&3|8).toString(16)};e.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(rb,
sb).toUpperCase()};e.setWindow=function(a){eve("raphael.setWindow",e,s.win,a);s.win=a;s.doc=s.win.document;e._engine.initWin&&e._engine.initWin(s.win)};var ta=function(a){if(e.vml){var f=/^\s+|\s+$/g,l;try{var b=new ActiveXObject("htmlfile");b.write("<body>");b.close();l=b.body}catch(d){l=createPopup().document.body}var c=l.createTextRange();ta=C(function(a){try{l.style.color=h(a).replace(f,"");var b=c.queryCommandValue("ForeColor");return"#"+("000000"+((b&255)<<16|b&65280|(b&16711680)>>>16).toString(16)).slice(-6)}catch(d){return"none"}})}else{var g=
s.doc.createElement("i");g.title="Rapha\u00ebl Colour Picker";g.style.display="none";s.doc.body.appendChild(g);ta=C(function(a){g.style.color=a;return s.doc.defaultView.getComputedStyle(g,"").getPropertyValue("color")})}return ta(a)},tb=function(){return"hsb("+[this.h,this.s,this.b]+")"},ub=function(){return"hsl("+[this.h,this.s,this.l]+")"},Ra=function(){return this.hex},Sa=function(a,f,l){null==f&&(e.is(a,"object")&&"r"in a&&"g"in a&&"b"in a)&&(l=a.b,f=a.g,a=a.r);null==f&&e.is(a,"string")&&(l=e.getRGB(a),
a=l.r,f=l.g,l=l.b);if(1<a||1<f||1<l)a/=255,f/=255,l/=255;return[a,f,l]},Ta=function(a,f,l,b){a*=255;f*=255;l*=255;a={r:a,g:f,b:l,hex:e.rgb(a,f,l),toString:Ra};e.is(b,"finite")&&(a.opacity=b);return a};e.color=function(a){var f;e.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(f=e.hsb2rgb(a),a.r=f.r,a.g=f.g,a.b=f.b,a.hex=f.hex):e.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(f=e.hsl2rgb(a),a.r=f.r,a.g=f.g,a.b=f.b,a.hex=f.hex):(e.is(a,"string")&&(a=e.getRGB(a)),e.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(f=
e.rgb2hsl(a),a.h=f.h,a.s=f.s,a.l=f.l,f=e.rgb2hsb(a),a.v=f.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1));a.toString=Ra;return a};e.hsb2rgb=function(a,f,l,b){this.is(a,"object")&&("h"in a&&"s"in a&&"b"in a)&&(l=a.b,f=a.s,a=a.h,b=a.o);var d,c,e,a=360*a%360/60;e=l*f;f=e*(1-S(a%2-1));l=d=c=l-e;a=~~a;l+=[e,f,0,0,f,e][a];d+=[f,e,e,f,0,0][a];c+=[0,0,f,e,e,f][a];return Ta(l,d,c,b)};e.hsl2rgb=function(a,f,l,b){this.is(a,"object")&&("h"in a&&"s"in a&&"l"in a)&&(l=a.l,f=a.s,a=a.h);if(1<a||1<f||1<l)a/=360,
f/=100,l/=100;var d,c,e,a=360*a%360/60;e=2*f*(0.5>l?l:1-l);f=e*(1-S(a%2-1));l=d=c=l-e/2;a=~~a;l+=[e,f,0,0,f,e][a];d+=[f,e,e,f,0,0][a];c+=[0,0,f,e,e,f][a];return Ta(l,d,c,b)};e.rgb2hsb=function(a,f,l){var l=Sa(a,f,l),a=l[0],f=l[1],l=l[2],b,d;b=n(a,f,l);d=b-p(a,f,l);return{h:60*(((0==d?0:b==a?(f-l)/d:b==f?(l-a)/d+2:(a-f)/d+4)+360)%6)/360,s:0==d?0:d/b,b:b,toString:tb}};e.rgb2hsl=function(a,f,l){var l=Sa(a,f,l),a=l[0],f=l[1],l=l[2],b,d,c;d=n(a,f,l);b=p(a,f,l);c=d-b;b=(d+b)/2;return{h:60*(((0==c?0:d==
a?(f-l)/c:d==f?(l-a)/c+2:(a-f)/c+4)+360)%6)/360,s:0==c?0:0.5>b?c/(2*b):c/(2-2*b),l:b,toString:ub}};e._path2string=function(){return this.join(",").replace(nb,"$1")};e._preload=function(a,f){var l=s.doc.createElement("img");l.style.cssText="position:absolute;left:-9999em;top:-9999em";l.onload=function(){f.call(this);this.onload=null;s.doc.body.removeChild(this)};l.onerror=function(){s.doc.body.removeChild(this)};s.doc.body.appendChild(l);l.src=a};e.getRGB=C(function(a){if(!a||(a=h(a)).indexOf("-")+
1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:V};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:V};!(mb[I](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=ta(a));var f,l,b,d,c;if(a=a.match(kb)){a[2]&&(b=ha(a[2].substring(5),16),l=ha(a[2].substring(3,5),16),f=ha(a[2].substring(1,3),16));a[3]&&(b=ha((c=a[3].charAt(3))+c,16),l=ha((c=a[3].charAt(2))+c,16),f=ha((c=a[3].charAt(1))+c,16));a[4]&&(c=a[4][i](za),f=H(c[0]),"%"==c[0].slice(-1)&&(f*=2.55),l=H(c[1]),"%"==c[1].slice(-1)&&(l*=
2.55),b=H(c[2]),"%"==c[2].slice(-1)&&(b*=2.55),"rgba"==a[1].toLowerCase().slice(0,4)&&(d=H(c[3])),c[3]&&"%"==c[3].slice(-1)&&(d/=100));if(a[5])return c=a[5][i](za),f=H(c[0]),"%"==c[0].slice(-1)&&(f*=2.55),l=H(c[1]),"%"==c[1].slice(-1)&&(l*=2.55),b=H(c[2]),"%"==c[2].slice(-1)&&(b*=2.55),("deg"==c[0].slice(-3)||"\u00b0"==c[0].slice(-1))&&(f/=360),"hsba"==a[1].toLowerCase().slice(0,4)&&(d=H(c[3])),c[3]&&"%"==c[3].slice(-1)&&(d/=100),e.hsb2rgb(f,l,b,d);if(a[6])return c=a[6][i](za),f=H(c[0]),"%"==c[0].slice(-1)&&
(f*=2.55),l=H(c[1]),"%"==c[1].slice(-1)&&(l*=2.55),b=H(c[2]),"%"==c[2].slice(-1)&&(b*=2.55),("deg"==c[0].slice(-3)||"\u00b0"==c[0].slice(-1))&&(f/=360),"hsla"==a[1].toLowerCase().slice(0,4)&&(d=H(c[3])),c[3]&&"%"==c[3].slice(-1)&&(d/=100),e.hsl2rgb(f,l,b,d);a={r:f,g:l,b:b,toString:V};a.hex="#"+(16777216|b|l<<8|f<<16).toString(16).slice(1);e.is(d,"finite")&&(a.opacity=d);return a}return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:V}},e);e.hsb=C(function(a,f,l){return e.hsb2rgb(a,f,l).hex});e.hsl=C(function(a,
f,l){return e.hsl2rgb(a,f,l).hex});e.rgb=C(function(a,f,l){return"#"+(16777216|l|f<<8|a<<16).toString(16).slice(1)});e.getColor=function(a){var a=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||0.75},f=this.hsb2rgb(a.h,a.s,a.b);a.h+=0.075;1<a.h&&(a.h=0,a.s-=0.2,0>=a.s&&(this.getColor.start={h:0,s:1,b:a.b}));return f.hex};e.getColor.reset=function(){delete this.start};e.parsePathString=function(a){if(!a)return null;var f=ia(a);if(f.arr)return ba(f.arr);var l={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,
t:2,v:1,z:0},b=[];e.is(a,U)&&e.is(a[0],U)&&(b=ba(a));b.length||h(a).replace(ob,function(a,f,d){var e=[],a=f.toLowerCase();d.replace(Pa,function(a,f){f&&e.push(+f)});"m"==a&&2<e.length&&(b.push([f][c](e.splice(0,2))),a="l",f="m"==f?"l":"L");if("r"==a)b.push([f][c](e));else for(;e.length>=l[a]&&!(b.push([f][c](e.splice(0,l[a]))),!l[a]););});b.toString=e._path2string;f.arr=ba(b);return b};e.parseTransformString=C(function(a){if(!a)return null;var f=[];e.is(a,U)&&e.is(a[0],U)&&(f=ba(a));f.length||h(a).replace(pb,
function(a,b,d){var e=[];m.call(b);d.replace(Pa,function(a,f){f&&e.push(+f)});f.push([b][c](e))});f.toString=e._path2string;return f});var ia=function(a){var f=ia.ps=ia.ps||{};f[a]?f[a].sleep=100:f[a]={sleep:100};setTimeout(function(){for(var l in f)f[I](l)&&l!=a&&(f[l].sleep--,!f[l].sleep&&delete f[l])});return f[a]};e.findDotsAtSegment=function(a,f,l,b,d,c,e,h,g){var i=1-g,j=w(i,3),o=w(i,2),m=g*g,r=m*g,n=j*a+3*o*g*l+3*i*g*g*d+r*e,j=j*f+3*o*g*b+3*i*g*g*c+r*h,o=a+2*g*(l-a)+m*(d-2*l+a),r=f+2*g*(b-
f)+m*(c-2*b+f),p=l+2*g*(d-l)+m*(e-2*d+l),m=b+2*g*(c-b)+m*(h-2*c+b),a=i*a+g*l,f=i*f+g*b,d=i*d+g*e,c=i*c+g*h,h=90-180*k.atan2(o-p,r-m)/A;(o>p||r<m)&&(h+=180);return{x:n,y:j,m:{x:o,y:r},n:{x:p,y:m},start:{x:a,y:f},end:{x:d,y:c},alpha:h}};e.bezierBBox=function(a,f,l,b,d,c,h,g){e.is(a,"array")||(a=[a,f,l,b,d,c,h,g]);a=Ua.apply(null,a);return{x:a.min.x,y:a.min.y,x2:a.max.x,y2:a.max.y,width:a.max.x-a.min.x,height:a.max.y-a.min.y}};e.isPointInsideBBox=function(a,f,l){return f>=a.x&&f<=a.x2&&l>=a.y&&l<=a.y2};
e.isBBoxIntersect=function(a,f){var l=e.isPointInsideBBox;return l(f,a.x,a.y)||l(f,a.x2,a.y)||l(f,a.x,a.y2)||l(f,a.x2,a.y2)||l(a,f.x,f.y)||l(a,f.x2,f.y)||l(a,f.x,f.y2)||l(a,f.x2,f.y2)||(a.x<f.x2&&a.x>f.x||f.x<a.x2&&f.x>a.x)&&(a.y<f.y2&&a.y>f.y||f.y<a.y2&&f.y>a.y)};e.pathIntersection=function(a,f){return Y(a,f)};e.pathIntersectionNumber=function(a,f){return Y(a,f,1)};e.isPointInsidePath=function(a,f,l){var b=e.pathBBox(a);return e.isPointInsideBBox(b,f,l)&&1==Y(a,[["M",f,l],["H",b.x2+10]],1)%2};e._removedFactory=
function(a){return function(){eve("raphael.log",null,"Rapha\u00ebl: you are calling to method \u201c"+a+"\u201d of removed object",a)}};var Da=e.pathBBox=function(a){var f=ia(a);if(f.bbox)return f.bbox;if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var a=pa(a),l=0,b=0,d=[],e=[],h,g=0,i=a.length;g<i;g++)h=a[g],"M"==h[0]?(l=h[1],b=h[2],d.push(l),e.push(b)):(l=Ua(l,b,h[1],h[2],h[3],h[4],h[5],h[6]),d=d[c](l.min.x,l.max.x),e=e[c](l.min.y,l.max.y),l=h[5],b=h[6]);a=p[B](0,d);h=p[B](0,e);d=n[B](0,d);
e=n[B](0,e);e={x:a,y:h,x2:d,y2:e,width:d-a,height:e-h};f.bbox=G(e);return e},ba=function(a){a=G(a);a.toString=e._path2string;return a},vb=e._pathToRelative=function(a){var f=ia(a);if(f.rel)return ba(f.rel);if(!e.is(a,U)||!e.is(a&&a[0],U))a=e.parsePathString(a);var l=[],b=0,d=0,c=0,h=0,g=0;"M"==a[0][0]&&(b=a[0][1],d=a[0][2],c=b,h=d,g++,l.push(["M",b,d]));for(var i=a.length;g<i;g++){var j=l[g]=[],k=a[g];if(k[0]!=m.call(k[0]))switch(j[0]=m.call(k[0]),j[0]){case "a":j[1]=k[1];j[2]=k[2];j[3]=k[3];j[4]=
k[4];j[5]=k[5];j[6]=+(k[6]-b).toFixed(3);j[7]=+(k[7]-d).toFixed(3);break;case "v":j[1]=+(k[1]-d).toFixed(3);break;case "m":c=k[1],h=k[2];default:for(var o=1,n=k.length;o<n;o++)j[o]=+(k[o]-(o%2?b:d)).toFixed(3)}else{l[g]=[];"m"==k[0]&&(c=k[1]+b,h=k[2]+d);j=0;for(o=k.length;j<o;j++)l[g][j]=k[j]}k=l[g].length;switch(l[g][0]){case "z":b=c;d=h;break;case "h":b+=+l[g][k-1];break;case "v":d+=+l[g][k-1];break;default:b+=+l[g][k-2],d+=+l[g][k-1]}}l.toString=e._path2string;f.rel=ba(l);return l},Va=e._pathToAbsolute=
function(a){var f=ia(a);if(f.abs)return ba(f.abs);if(!e.is(a,U)||!e.is(a&&a[0],U))a=e.parsePathString(a);if(!a||!a.length)return[["M",0,0]];var l=[],b=0,d=0,h=0,g=0,i=0;"M"==a[0][0]&&(b=+a[0][1],d=+a[0][2],h=b,g=d,i++,l[0]=["M",b,d]);for(var j=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),k,m=i,o=a.length;m<o;m++){l.push(i=[]);k=a[m];if(k[0]!=Oa.call(k[0]))switch(i[0]=Oa.call(k[0]),i[0]){case "A":i[1]=k[1];i[2]=k[2];i[3]=k[3];i[4]=k[4];i[5]=k[5];i[6]=+(k[6]+b);
i[7]=+(k[7]+d);break;case "V":i[1]=+k[1]+d;break;case "H":i[1]=+k[1]+b;break;case "R":for(var n=[b,d][c](k.slice(1)),r=2,p=n.length;r<p;r++)n[r]=+n[r]+b,n[++r]=+n[r]+d;l.pop();l=l[c](K(n,j));break;case "M":h=+k[1]+b,g=+k[2]+d;default:r=1;for(p=k.length;r<p;r++)i[r]=+k[r]+(r%2?b:d)}else if("R"==k[0])n=[b,d][c](k.slice(1)),l.pop(),l=l[c](K(n,j)),i=["R"][c](k.slice(-2));else{n=0;for(r=k.length;n<r;n++)i[n]=k[n]}switch(i[0]){case "Z":b=h;d=g;break;case "H":b=i[1];break;case "V":d=i[1];break;case "M":h=
i[i.length-2],g=i[i.length-1];default:b=i[i.length-2],d=i[i.length-1]}}l.toString=e._path2string;f.abs=ba(l);return l},Wa=function(a,f,l,b,d,c){var e=1/3,h=2/3;return[e*a+h*l,e*f+h*b,e*d+h*l,e*c+h*b,d,c]},Xa=function(a,f,l,b,d,e,h,g,j,m){var n=120*A/180,o=A/180*(+d||0),p=[],r,q=C(function(a,f,b){var l=a*k.cos(b)-f*k.sin(b),a=a*k.sin(b)+f*k.cos(b);return{x:l,y:a}});if(m)x=m[0],r=m[1],e=m[2],t=m[3];else{r=q(a,f,-o);a=r.x;f=r.y;r=q(g,j,-o);g=r.x;j=r.y;k.cos(A/180*d);k.sin(A/180*d);r=(a-g)/2;x=(f-j)/
2;t=r*r/(l*l)+x*x/(b*b);1<t&&(t=k.sqrt(t),l*=t,b*=t);var t=l*l,L=b*b,t=(e==h?-1:1)*k.sqrt(S((t*L-t*x*x-L*r*r)/(t*x*x+L*r*r))),e=t*l*x/b+(a+g)/2,t=t*-b*r/l+(f+j)/2,x=k.asin(((f-t)/b).toFixed(9));r=k.asin(((j-t)/b).toFixed(9));x=a<e?A-x:x;r=g<e?A-r:r;0>x&&(x=2*A+x);0>r&&(r=2*A+r);h&&x>r&&(x-=2*A);!h&&r>x&&(r-=2*A)}if(S(r-x)>n){var p=r,L=g,u=j;r=x+n*(h&&r>x?1:-1);g=e+l*k.cos(r);j=t+b*k.sin(r);p=Xa(g,j,l,b,d,0,h,L,u,[r,p,e,t])}e=r-x;d=k.cos(x);n=k.sin(x);h=k.cos(r);r=k.sin(r);e=k.tan(e/4);l=4/3*l*e;e*=
4/3*b;b=[a,f];a=[a+l*n,f-e*d];f=[g+l*r,j-e*h];g=[g,j];a[0]=2*b[0]-a[0];a[1]=2*b[1]-a[1];if(m)return[a,f,g][c](p);p=[a,f,g][c](p).join()[i](",");m=[];g=0;for(j=p.length;g<j;g++)m[g]=g%2?q(p[g-1],p[g],o).y:q(p[g],p[g+1],o).x;return m},ua=function(a,f,b,d,c,e,h,g,i){var j=1-i;return{x:w(j,3)*a+3*w(j,2)*i*b+3*j*i*i*c+w(i,3)*h,y:w(j,3)*f+3*w(j,2)*i*d+3*j*i*i*e+w(i,3)*g}},Ua=C(function(a,f,b,d,c,e,h,g){var i=c-2*b+a-(h-2*c+b),j=2*(b-a)-2*(c-b),m=a-b,o=(-j+k.sqrt(j*j-4*i*m))/2/i,i=(-j-k.sqrt(j*j-4*i*m))/
2/i,q=[f,g],r=[a,h];"1e12"<S(o)&&(o=0.5);"1e12"<S(i)&&(i=0.5);0<o&&1>o&&(o=ua(a,f,b,d,c,e,h,g,o),r.push(o.x),q.push(o.y));0<i&&1>i&&(o=ua(a,f,b,d,c,e,h,g,i),r.push(o.x),q.push(o.y));i=e-2*d+f-(g-2*e+d);j=2*(d-f)-2*(e-d);m=f-d;o=(-j+k.sqrt(j*j-4*i*m))/2/i;i=(-j-k.sqrt(j*j-4*i*m))/2/i;"1e12"<S(o)&&(o=0.5);"1e12"<S(i)&&(i=0.5);0<o&&1>o&&(o=ua(a,f,b,d,c,e,h,g,o),r.push(o.x),q.push(o.y));0<i&&1>i&&(o=ua(a,f,b,d,c,e,h,g,i),r.push(o.x),q.push(o.y));return{min:{x:p[B](0,r),y:p[B](0,q)},max:{x:n[B](0,r),y:n[B](0,
q)}}}),pa=e._path2curve=C(function(a,f){var b=!f&&ia(a);if(!f&&b.curve)return ba(b.curve);var d=Va(a),e=f&&Va(f),h={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i=function(a,f){var b,d;if(!a)return["C",f.x,f.y,f.x,f.y,f.x,f.y];!(a[0]in{T:1,Q:1})&&(f.qx=f.qy=null);switch(a[0]){case "M":f.X=a[1];f.Y=a[2];break;case "A":a=["C"][c](Xa[B](0,[f.x,f.y][c](a.slice(1))));break;case "S":b=f.x+(f.x-(f.bx||f.x));d=f.y+(f.y-(f.by||f.y));a=["C",b,d][c](a.slice(1));break;
case "T":f.qx=f.x+(f.x-(f.qx||f.x));f.qy=f.y+(f.y-(f.qy||f.y));a=["C"][c](Wa(f.x,f.y,f.qx,f.qy,a[1],a[2]));break;case "Q":f.qx=a[1];f.qy=a[2];a=["C"][c](Wa(f.x,f.y,a[1],a[2],a[3],a[4]));break;case "L":a=["C"][c]([f.x,f.y,a[1],a[2],a[1],a[2]]);break;case "H":a=["C"][c]([f.x,f.y,a[1],f.y,a[1],f.y]);break;case "V":a=["C"][c]([f.x,f.y,f.x,a[1],f.x,a[1]]);break;case "Z":a=["C"][c]([f.x,f.y,f.X,f.Y,f.X,f.Y])}return a},j=function(a,f){if(7<a[f].length){a[f].shift();for(var b=a[f];b.length;)a.splice(f++,
0,["C"][c](b.splice(0,6)));a.splice(f,1);o=n(d.length,e&&e.length||0)}},k=function(a,f,b,l,c){a&&(f&&"M"==a[c][0]&&"M"!=f[c][0])&&(f.splice(c,0,["M",l.x,l.y]),b.bx=0,b.by=0,b.x=a[c][1],b.y=a[c][2],o=n(d.length,e&&e.length||0))},m=0,o=n(d.length,e&&e.length||0);for(;m<o;m++){d[m]=i(d[m],h);j(d,m);e&&(e[m]=i(e[m],g));e&&j(e,m);k(d,e,h,g,m);k(e,d,g,h,m);var p=d[m],r=e&&e[m],q=p.length,t=e&&r.length;h.x=p[q-2];h.y=p[q-1];h.bx=H(p[q-4])||h.x;h.by=H(p[q-3])||h.y;g.bx=e&&(H(r[t-4])||g.x);g.by=e&&(H(r[t-
3])||g.y);g.x=e&&r[t-2];g.y=e&&r[t-1]}e||(b.curve=ba(d));return e?[d,e]:d},null,ba);e._parseDots=C(function(a){for(var f=[],b=0,d=a.length;b<d;b++){var c={},h=a[b].match(/^([^:]*):?([\d\.]*)/);c.color=e.getRGB(h[1]);if(c.color.error)return null;c.color=c.color.hex;h[2]&&(c.offset=h[2]+"%");f.push(c)}b=1;for(d=f.length-1;b<d;b++)if(!f[b].offset){a=H(f[b-1].offset||0);h=0;for(c=b+1;c<d;c++)if(f[c].offset){h=f[c].offset;break}h||(h=100,c=d);h=H(h);for(h=(h-a)/(c-b+1);b<c;b++)a+=h,f[b].offset=a+"%"}return f});
var va=e._tear=function(a,f){a==f.top&&(f.top=a.prev);a==f.bottom&&(f.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)};e._tofront=function(a,f){f.top!==a&&(va(a,f),a.next=null,a.prev=f.top,f.top.next=a,f.top=a)};e._toback=function(a,f){f.bottom!==a&&(va(a,f),a.next=f.bottom,a.prev=null,f.bottom.prev=a,f.bottom=a)};e._insertafter=function(a,f,b){va(a,b);f==b.top&&(b.top=a);f.next&&(f.next.prev=a);a.next=f.next;a.prev=f;f.next=a};e._insertbefore=function(a,f,b){va(a,b);f==b.bottom&&
(b.bottom=a);f.prev&&(f.prev.next=a);a.prev=f.prev;f.prev=a;a.next=f};var wb=e.toMatrix=function(a,f){var b=Da(a),d={_:{transform:""},getBBox:function(){return b}};Ma(d,f);return d.matrix};e.transformPath=function(a,f){return Ba(a,wb(a,f))};var Ma=e._extractTransform=function(a,f){if(null==f)return a._.transform;var f=h(f).replace(/\.{3}|\u2026/g,a._.transform||""),b=e.parseTransformString(f),d=0,c=0,g=0,i=1,j=1,k=a._,g=new M;k.transform=b||[];if(b)for(var c=0,m=b.length;c<m;c++){var n=b[c],o=n.length,
p=h(n[0]).toLowerCase(),r=n[0]!=p,q=r?g.invert():0,t;"t"==p&&3==o?r?(o=q.x(0,0),p=q.y(0,0),r=q.x(n[1],n[2]),q=q.y(n[1],n[2]),g.translate(r-o,q-p)):g.translate(n[1],n[2]):"r"==p?2==o?(t=t||a.getBBox(1),g.rotate(n[1],t.x+t.width/2,t.y+t.height/2),d+=n[1]):4==o&&(r?(r=q.x(n[2],n[3]),q=q.y(n[2],n[3]),g.rotate(n[1],r,q)):g.rotate(n[1],n[2],n[3]),d+=n[1]):"s"==p?2==o||3==o?(t=t||a.getBBox(1),g.scale(n[1],n[o-1],t.x+t.width/2,t.y+t.height/2),i*=n[1],j*=n[o-1]):5==o&&(r?(r=q.x(n[3],n[4]),q=q.y(n[3],n[4]),
g.scale(n[1],n[2],r,q)):g.scale(n[1],n[2],n[3],n[4]),i*=n[1],j*=n[2]):"m"==p&&7==o&&g.add(n[1],n[2],n[3],n[4],n[5],n[6]);k.dirtyT=1;a.matrix=g}a.matrix=g;k.sx=i;k.sy=j;k.deg=d;k.dx=c=g.e;k.dy=g=g.f;1==i&&1==j&&!d&&k.bbox?(k.bbox.x+=+c,k.bbox.y+=+g):k.dirtyT=1},Ya=function(a){var f=a[0];switch(f.toLowerCase()){case "t":return[f,0,0];case "m":return[f,1,0,0,1,0,0];case "r":return 4==a.length?[f,0,a[2],a[3]]:[f,0];case "s":return 5==a.length?[f,1,1,a[3],a[4]]:3==a.length?[f,1,1]:[f,1]}},hb=e._equaliseTransform=
function(a,f){for(var f=h(f).replace(/\.{3}|\u2026/g,a),a=e.parseTransformString(a)||[],f=e.parseTransformString(f)||[],b=n(a.length,f.length),d=[],c=[],g=0,i,j,k,m;g<b;g++){k=a[g]||Ya(f[g]);m=f[g]||Ya(k);if(k[0]!=m[0]||"r"==k[0].toLowerCase()&&(k[2]!=m[2]||k[3]!=m[3])||"s"==k[0].toLowerCase()&&(k[3]!=m[3]||k[4]!=m[4]))return;d[g]=[];c[g]=[];i=0;for(j=n(k.length,m.length);i<j;i++)i in k&&(d[g][i]=k[i]),i in m&&(c[g][i]=m[i])}return{from:d,to:c}};e._getContainer=function(a,f,b,d){var c;c=null==d&&
!e.is(a,"object")?s.doc.getElementById(a):a;if(null!=c)return c.tagName?null==f?{container:c,width:c.style.pixelWidth||c.offsetWidth,height:c.style.pixelHeight||c.offsetHeight}:{container:c,width:f,height:b}:{container:1,x:a,y:f,width:b,height:d}};e.pathToRelative=vb;e._engine={};e.path2curve=pa;e.matrix=function(a,f,b,d,c,e){return new M(a,f,b,d,c,e)};var Q=M.prototype,Ea=function(a){return a[0]*a[0]+a[1]*a[1]},Za=function(a){var f=k.sqrt(Ea(a));a[0]&&(a[0]/=f);a[1]&&(a[1]/=f)};Q.add=function(a,
f,b,d,c,e){var g=[[],[],[]],h=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],f=[[a,b,c],[f,d,e],[0,0,1]];a&&a instanceof M&&(f=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]);for(a=0;3>a;a++)for(b=0;3>b;b++){for(d=c=0;3>d;d++)c+=h[a][d]*f[d][b];g[a][b]=c}this.a=g[0][0];this.b=g[1][0];this.c=g[0][1];this.d=g[1][1];this.e=g[0][2];this.f=g[1][2]};Q.invert=function(){var a=this.a*this.d-this.b*this.c;return new M(this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.f-this.d*this.e)/a,(this.b*this.e-this.a*
this.f)/a)};Q.clone=function(){return new M(this.a,this.b,this.c,this.d,this.e,this.f)};Q.translate=function(a,f){this.add(1,0,0,1,a,f)};Q.scale=function(a,f,b,d){null==f&&(f=a);(b||d)&&this.add(1,0,0,1,b,d);this.add(a,0,0,f,0,0);(b||d)&&this.add(1,0,0,1,-b,-d)};Q.rotate=function(a,f,b){var a=e.rad(a),f=f||0,b=b||0,d=+k.cos(a).toFixed(9),a=+k.sin(a).toFixed(9);this.add(d,a,-a,d,f,b);this.add(1,0,0,1,-f,-b)};Q.x=function(a,f){return a*this.a+f*this.c+this.e};Q.y=function(a,f){return a*this.b+f*this.d+
this.f};Q.get=function(a){return+this[h.fromCharCode(97+a)].toFixed(4)};Q.toString=function(){return e.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};Q.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};Q.offset=function(){return[this.e.toFixed(4),
this.f.toFixed(4)]};Q.split=function(){var a={};a.dx=this.e;a.dy=this.f;var f=[[this.a,this.c],[this.b,this.d]];a.scalex=k.sqrt(Ea(f[0]));Za(f[0]);a.shear=f[0][0]*f[1][0]+f[0][1]*f[1][1];f[1]=[f[1][0]-f[0][0]*a.shear,f[1][1]-f[0][1]*a.shear];a.scaley=k.sqrt(Ea(f[1]));Za(f[1]);a.shear/=a.scaley;var b=-f[0][1],f=f[1][1];0>f?(a.rotate=e.deg(k.acos(f)),0>b&&(a.rotate=360-a.rotate)):a.rotate=e.deg(k.asin(b));a.isSimple=!+a.shear.toFixed(9)&&(a.scalex.toFixed(9)==a.scaley.toFixed(9)||!a.rotate);a.isSuperSimple=
!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate;a.noRotation=!+a.shear.toFixed(9)&&!a.rotate;return a};Q.toTransformString=function(a){a=a||this[i]();return a.isSimple?(a.scalex=+a.scalex.toFixed(4),a.scaley=+a.scaley.toFixed(4),a.rotate=+a.rotate.toFixed(4),(a.dx||a.dy?"t"+[a.dx,a.dy]:"")+(1!=a.scalex||1!=a.scaley?"s"+[a.scalex,a.scaley,0,0]:"")+(a.rotate?"r"+[a.rotate,0,0]:"")):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]};var wa=navigator.userAgent.match(/Version\/(.*?)\s/)||
navigator.userAgent.match(/Chrome\/(\d+)/);F.safari="Apple Computer, Inc."==navigator.vendor&&(wa&&4>wa[1]||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&wa&&8>wa[1]?function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:qb;var xb=function(){this.returnValue=!1},yb=function(){return this.originalEvent.preventDefault()},zb=function(){this.cancelBubble=!0},Ab=function(){return this.originalEvent.stopPropagation()},
$a;$a=s.doc.addEventListener?function(a,f,d,c){var e=b&&j[f]?j[f]:f,g=function(e){var g=e.clientX+(s.doc.documentElement.scrollLeft||s.doc.body.scrollLeft),h=e.clientY+(s.doc.documentElement.scrollTop||s.doc.body.scrollTop);if(b&&j[I](f))for(var i=0,k=e.targetTouches&&e.targetTouches.length;i<k;i++)if(e.targetTouches[i].target==a){k=e;e=e.targetTouches[i];e.originalEvent=k;e.preventDefault=yb;e.stopPropagation=Ab;break}return d.call(c,e,g,h)};a.addEventListener(e,g,!1);return function(){a.removeEventListener(e,
g,!1);return!0}}:s.doc.attachEvent?function(a,f,b,d){var c=function(a){var a=a||s.win.event,f=a.clientX+(s.doc.documentElement.scrollLeft||s.doc.body.scrollLeft),c=a.clientY+(s.doc.documentElement.scrollTop||s.doc.body.scrollTop);a.preventDefault=a.preventDefault||xb;a.stopPropagation=a.stopPropagation||zb;return b.call(d,a,f,c)};a.attachEvent("on"+f,c);return function(){a.detachEvent("on"+f,c);return!0}}:void 0;for(var ja=[],Fa=function(a){for(var f=a.clientX,d=a.clientY,c=s.doc.documentElement.scrollTop||
s.doc.body.scrollTop,e=s.doc.documentElement.scrollLeft||s.doc.body.scrollLeft,g,h=ja.length;h--;){g=ja[h];if(b)for(var i=a.touches.length,j;i--;){if(j=a.touches[i],j.identifier==g.el._drag.id){f=j.clientX;d=j.clientY;(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var i=g.el.node,k=i.nextSibling,m=i.parentNode,o=i.style.display;s.win.opera&&m.removeChild(i);i.style.display="none";j=g.el.paper.getElementByPoint(f,d);i.style.display=o;s.win.opera&&(k?m.insertBefore(i,
k):m.appendChild(i));j&&eve("raphael.drag.over."+g.el.id,g.el,j);f+=e;d+=c;eve("raphael.drag.move."+g.el.id,g.move_scope||g.el,f-g.el._drag.x,d-g.el._drag.y,f,d,a)}},Ga=function(a){e.unmousemove(Fa).unmouseup(Ga);for(var f=ja.length,b;f--;)b=ja[f],b.el._drag={},eve("raphael.drag.end."+b.el.id,b.end_scope||b.start_scope||b.move_scope||b.el,a);ja=[]},J=e.el={},ab=g.length;ab--;)(function(a){e[a]=J[a]=function(f,b){e.is(f,"function")&&(this.events=this.events||[],this.events.push({name:a,f:f,unbind:$a(this.shape||
this.node||s.doc,a,f,b||this)}));return this};e["un"+a]=J["un"+a]=function(f){for(var b=this.events||[],d=b.length;d--;)if(b[d].name==a&&b[d].f==f){b[d].unbind();b.splice(d,1);!b.length&&delete this.events;break}return this}})(g[ab]);J.data=function(a,f){var b=qa[this.id]=qa[this.id]||{};if(1==arguments.length){if(e.is(a,"object")){for(var d in a)a[I](d)&&this.data(d,a[d]);return this}eve("raphael.data.get."+this.id,this,b[a],a);return b[a]}b[a]=f;eve("raphael.data.set."+this.id,this,f,a);return this};
J.removeData=function(a){null==a?qa[this.id]={}:qa[this.id]&&delete qa[this.id][a];return this};J.hover=function(a,f,b,d){return this.mouseover(a,b).mouseout(f,d||b)};J.unhover=function(a,f){return this.unmouseover(a).unmouseout(f)};var na=[];J.drag=function(a,f,b,d,c,g){function h(i){(i.originalEvent||i).preventDefault();var j=s.doc.documentElement.scrollTop||s.doc.body.scrollTop,k=s.doc.documentElement.scrollLeft||s.doc.body.scrollLeft;this._drag.x=i.clientX+k;this._drag.y=i.clientY+j;this._drag.id=
i.identifier;!ja.length&&e.mousemove(Fa).mouseup(Ga);ja.push({el:this,move_scope:d,start_scope:c,end_scope:g});f&&eve.on("raphael.drag.start."+this.id,f);a&&eve.on("raphael.drag.move."+this.id,a);b&&eve.on("raphael.drag.end."+this.id,b);eve("raphael.drag.start."+this.id,c||d||this,i.clientX+k,i.clientY+j,i)}this._drag={};na.push({el:this,start:h});this.mousedown(h);return this};J.onDragOver=function(a){a?eve.on("raphael.drag.over."+this.id,a):eve.unbind("raphael.drag.over."+this.id)};J.undrag=function(){for(var a=
na.length;a--;)na[a].el==this&&(this.unmousedown(na[a].start),na.splice(a,1),eve.unbind("raphael.drag.*."+this.id));!na.length&&e.unmousemove(Fa).unmouseup(Ga)};F.circle=function(a,f,b){a=e._engine.circle(this,a||0,f||0,b||0);this.__set__&&this.__set__.push(a);return a};F.rect=function(a,f,b,d,c){a=e._engine.rect(this,a||0,f||0,b||0,d||0,c||0);this.__set__&&this.__set__.push(a);return a};F.ellipse=function(a,f,b,d){a=e._engine.ellipse(this,a||0,f||0,b||0,d||0);this.__set__&&this.__set__.push(a);return a};
F.path=function(a){a&&!e.is(a,"string")&&!e.is(a[0],U)&&(a+="");var f=e._engine.path(e.format[B](e,arguments),this);this.__set__&&this.__set__.push(f);return f};F.image=function(a,f,b,d,c){a=e._engine.image(this,a||"about:blank",f||0,b||0,d||0,c||0);this.__set__&&this.__set__.push(a);return a};F.text=function(a,f,b){a=e._engine.text(this,a||0,f||0,h(b));this.__set__&&this.__set__.push(a);return a};F.set=function(a){!e.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var f=
new oa(a);this.__set__&&this.__set__.push(f);return f};F.setStart=function(a){this.__set__=a||this.set()};F.setFinish=function(){var a=this.__set__;delete this.__set__;return a};F.setSize=function(a,f){return e._engine.setSize.call(this,a,f)};F.setViewBox=function(a,f,b,d,c){return e._engine.setViewBox.call(this,a,f,b,d,c)};F.top=F.bottom=null;F.raphael=e;F.getElementByPoint=function(a,f){var b,d,c=this.canvas,e=s.doc.elementFromPoint(a,f);if(s.win.opera&&"svg"==e.tagName){d=c.getBoundingClientRect();
b=c.ownerDocument;var g=b.body,h=b.documentElement;b=d.top+(s.win.pageYOffset||h.scrollTop||g.scrollTop)-(h.clientTop||g.clientTop||0);d=d.left+(s.win.pageXOffset||h.scrollLeft||g.scrollLeft)-(h.clientLeft||g.clientLeft||0);g=c.createSVGRect();g.x=a-d;g.y=f-b;g.width=g.height=1;b=c.getIntersectionList(g,null);b.length&&(e=b[b.length-1])}if(!e)return null;for(;e.parentNode&&e!=c.parentNode&&!e.raphael;)e=e.parentNode;e==this.canvas.parentNode&&(e=c);return e=e&&e.raphael?this.getById(e.raphaelid):
null};F.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null};F.forEach=function(a,b){for(var d=this.bottom;d&&!1!==a.call(b,d);)d=d.next;return this};F.getElementsByPoint=function(a,b){var d=this.set();this.forEach(function(c){c.isPointInside(a,b)&&d.push(c)});return d};J.isPointInside=function(a,b){var d=this.realPath=this.realPath||ra[this.type](this);return e.isPointInsidePath(d,a,b)};J.getBBox=function(a){if(this.removed)return{};var b=this._;if(a){if(b.dirty||
!b.bboxwt)this.realPath=ra[this.type](this),b.bboxwt=Da(this.realPath),b.bboxwt.toString=fa,b.dirty=0;return b.bboxwt}if(b.dirty||b.dirtyT||!b.bbox){if(b.dirty||!this.realPath)b.bboxwt=0,this.realPath=ra[this.type](this);b.bbox=Da(Ba(this.realPath,this.matrix));b.bbox.toString=fa;b.dirty=b.dirtyT=0}return b.bbox};J.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(a);return a};J.glow=function(a){if("text"==this.type)return null;
for(var a=a||{},b=(a.width||10)+(+this.attr("stroke-width")||1),d=a.fill||!1,c=a.opacity||0.5,e=a.offsetx||0,g=a.offsety||0,a=a.color||"#000",h=b/2,i=this.paper,j=i.set(),k=this.realPath||ra[this.type](this),k=this.matrix?Ba(k,this.matrix):k,m=1;m<h+1;m++)j.push(i.path(k).attr({stroke:a,fill:d?a:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b/h*m).toFixed(3),opacity:+(c/h).toFixed(3)}));return j.insertBefore(this).translate(e,g)};var Ha=function(a,b,d,c,g,h,i,j,k){return null==
k?X(a,b,d,c,g,h,i,j):e.findDotsAtSegment(a,b,d,c,g,h,i,j,ea(a,b,d,c,g,h,i,j,k))},Ia=function(a,b){return function(d,c,g){for(var d=pa(d),h,i,j,k,m="",n={},o=0,p=0,q=d.length;p<q;p++){j=d[p];if("M"==j[0])h=+j[1],i=+j[2];else{k=Ha(h,i,j[1],j[2],j[3],j[4],j[5],j[6]);if(o+k>c){if(b&&!n.start){h=Ha(h,i,j[1],j[2],j[3],j[4],j[5],j[6],c-o);m+=["C"+h.start.x,h.start.y,h.m.x,h.m.y,h.x,h.y];if(g)return m;n.start=m;m=["M"+h.x,h.y+"C"+h.n.x,h.n.y,h.end.x,h.end.y,j[5],j[6]].join();o+=k;h=+j[5];i=+j[6];continue}if(!a&&
!b)return h=Ha(h,i,j[1],j[2],j[3],j[4],j[5],j[6],c-o),{x:h.x,y:h.y,alpha:h.alpha}}o+=k;h=+j[5];i=+j[6]}m+=j.shift()+j}n.end=m;h=a?o:b?n:e.findDotsAtSegment(h,i,j[0],j[1],j[2],j[3],j[4],j[5],1);h.alpha&&(h={x:h.x,y:h.y,alpha:h.alpha});return h}},bb=Ia(1),cb=Ia(),Ja=Ia(0,1);e.getTotalLength=bb;e.getPointAtLength=cb;e.getSubpath=function(a,b,d){if(1E-6>this.getTotalLength(a)-d)return Ja(a,b).end;a=Ja(a,d,1);return b?Ja(a,b).end:a};J.getTotalLength=function(){if("path"==this.type)return this.node.getTotalLength?
this.node.getTotalLength():bb(this.attrs.path)};J.getPointAtLength=function(a){if("path"==this.type)return cb(this.attrs.path,a)};J.getSubpath=function(a,b){if("path"==this.type)return e.getSubpath(this.attrs.path,a,b)};var W=e.easing_formulas={linear:function(a){return a},"<":function(a){return w(a,1.7)},">":function(a){return w(a,0.48)},"<>":function(a){var b=0.48-a/1.04,d=k.sqrt(0.1734+b*b),a=d-b,a=w(S(a),1/3)*(0>a?-1:1),b=-d-b,b=w(S(b),1/3)*(0>b?-1:1),a=a+b+0.5;return 3*(1-a)*a*a+a*a*a},backIn:function(a){return a*
a*(2.70158*a-1.70158)},backOut:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},elastic:function(a){return a==!!a?a:w(2,-10*a)*k.sin((a-0.075)*2*A/0.3)+1},bounce:function(a){a<1/2.75?a*=7.5625*a:a<2/2.75?(a-=1.5/2.75,a=7.5625*a*a+0.75):a<2.5/2.75?(a-=2.25/2.75,a=7.5625*a*a+0.9375):(a-=2.625/2.75,a=7.5625*a*a+0.984375);return a}};W.easeIn=W["ease-in"]=W["<"];W.easeOut=W["ease-out"]=W[">"];W.easeInOut=W["ease-in-out"]=W["<>"];W["back-in"]=W.backIn;W["back-out"]=W.backOut;var y=[],Na=window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,16)},ya=function(){for(var a=+new Date,b=0;b<y.length;b++){var g=y[b];if(!g.el.removed&&!g.paused){var h=a-g.start,i=g.ms,j=g.easing,k=g.from,m=g.diff,n=g.to,p=g.el,q={},o,s={},r;g.initstatus?(h=(g.initstatus*g.anim.top-g.prev)/(g.percent-g.prev)*i,g.status=g.initstatus,delete g.initstatus,g.stop&&y.splice(b--,1)):g.status=(g.prev+(g.percent-
g.prev)*(h/i))/g.anim.top;if(!(0>h))if(h<i){var w=j(h/i),t;for(t in k)if(k[I](t)){switch(xa[t]){case v:o=+k[t]+w*i*m[t];break;case "colour":o="rgb("+[Ka($(k[t].r+w*i*m[t].r)),Ka($(k[t].g+w*i*m[t].g)),Ka($(k[t].b+w*i*m[t].b))].join()+")";break;case "path":o=[];h=0;for(j=k[t].length;h<j;h++){o[h]=[k[t][h][0]];n=1;for(s=k[t][h].length;n<s;n++)o[h][n]=+k[t][h][n]+w*i*m[t][h][n];o[h]=o[h].join(d)}o=o.join(d);break;case "transform":if(m[t].real){o=[];h=0;for(j=k[t].length;h<j;h++){o[h]=[k[t][h][0]];n=1;
for(s=k[t][h].length;n<s;n++)o[h][n]=k[t][h][n]+w*i*m[t][h][n]}}else o=function(a){return+k[t][a]+w*i*m[t][a]},o=[["m",o(0),o(1),o(2),o(3),o(4),o(5)]];break;case "csv":if("clip-rect"==t){o=[];for(h=4;h--;)o[h]=+k[t][h]+w*i*m[t][h]}break;default:j=[][c](k[t]);o=[];for(h=p.paper.customAttributes[t].length;h--;)o[h]=+j[h]+w*i*m[t][h]}q[t]=o}p.attr(q);(function(a,b,d){setTimeout(function(){eve("raphael.anim.frame."+a,b,d)})})(p.id,p,g.anim)}else{(function(a,b,d){setTimeout(function(){eve("raphael.anim.frame."+
b.id,b,d);eve("raphael.anim.finish."+b.id,b,d);e.is(a,"function")&&a.call(b)})})(g.callback,p,g.anim);p.attr(n);y.splice(b--,1);if(1<g.repeat&&!g.next){for(r in n)n[I](r)&&(s[r]=g.totalOrigin[r]);g.el.attr(s);N(g.anim,g.el,g.anim.percents[0],null,g.totalOrigin,g.repeat-1)}g.next&&!g.stop&&N(g.anim,g.el,g.next,null,g.totalOrigin,g.repeat)}}}e.svg&&p&&p.paper&&p.paper.safari();y.length&&Na(ya)},Ka=function(a){return 255<a?255:0>a?0:a};J.animateWith=function(a,b,d,c,g,h){if(this.removed)return h&&h.call(this),
this;d=d instanceof P?d:e.animation(d,c,g,h);N(d,this,d.percents[0],null,this.attr());d=0;for(c=y.length;d<c;d++)if(y[d].anim==b&&y[d].el==a){y[c-1].start=y[d].start;break}return this};J.onAnimation=function(a){a?eve.on("raphael.anim.frame."+this.id,a):eve.unbind("raphael.anim.frame."+this.id);return this};P.prototype.delay=function(a){var b=new P(this.anim,this.ms);b.times=this.times;b.del=+a||0;return b};P.prototype.repeat=function(a){var b=new P(this.anim,this.ms);b.del=this.del;b.times=k.floor(n(a,
0))||1;return b};e.animation=function(a,b,d,c){if(a instanceof P)return a;if(e.is(d,"function")||!d)c=c||d||null,d=null;var a=Object(a),b=+b||0,g={},h,i;for(i in a)a[I](i)&&(H(i)!=i&&H(i)+"%"!=i)&&(h=!0,g[i]=a[i]);return h?(d&&(g.easing=d),c&&(g.callback=c),new P({100:g},b)):new P(a,b)};J.animate=function(a,b,d,c){if(this.removed)return c&&c.call(this),this;a=a instanceof P?a:e.animation(a,b,d,c);N(a,this,a.percents[0],null,this.attr());return this};J.setTime=function(a,b){a&&null!=b&&this.status(a,
p(b,a.ms)/a.ms);return this};J.status=function(a,b){var d=[],c=0,e,g;if(null!=b)return N(a,this,-1,p(b,1)),this;for(e=y.length;c<e;c++)if(g=y[c],g.el.id==this.id&&(!a||g.anim==a)){if(a)return g.status;d.push({anim:g.anim,status:g.status})}return a?0:d};J.pause=function(a){for(var b=0;b<y.length;b++)if(y[b].el.id==this.id&&(!a||y[b].anim==a)&&!1!==eve("raphael.anim.pause."+this.id,this,y[b].anim))y[b].paused=!0;return this};J.resume=function(a){for(var b=0;b<y.length;b++)if(y[b].el.id==this.id&&(!a||
y[b].anim==a)){var d=y[b];!1!==eve("raphael.anim.resume."+this.id,this,d.anim)&&(delete d.paused,this.status(d.anim,d.status))}return this};J.stop=function(a){for(var b=0;b<y.length;b++)y[b].el.id==this.id&&(!a||y[b].anim==a)&&!1!==eve("raphael.anim.stop."+this.id,this,y[b].anim)&&y.splice(b--,1);return this};eve.on("raphael.remove",q);eve.on("raphael.clear",q);J.toString=function(){return"Rapha\u00ebl\u2019s object"};var oa=function(a){this.items=[];this.length=0;this.type="set";if(a)for(var b=0,
d=a.length;b<d;b++)if(a[b]&&(a[b].constructor==J.constructor||a[b].constructor==oa))this[this.items.length]=this.items[this.items.length]=a[b],this.length++},T=oa.prototype;T.push=function(){for(var a,b,d=0,c=arguments.length;d<c;d++)if((a=arguments[d])&&(a.constructor==J.constructor||a.constructor==oa))b=this.items.length,this[b]=this.items[b]=a,this.length++;return this};T.pop=function(){this.length&&delete this[this.length--];return this.items.pop()};T.forEach=function(a,b){for(var d=0,c=this.items.length;d<
c&&!1!==a.call(b,this.items[d],d);d++);return this};for(var La in J)J[I](La)&&(T[La]=function(a){return function(){var b=arguments;return this.forEach(function(d){d[a][B](d,b)})}}(La));T.attr=function(a,b){if(a&&e.is(a,U)&&e.is(a[0],"object"))for(var d=0,c=a.length;d<c;d++)this.items[d].attr(a[d]);else{d=0;for(c=this.items.length;d<c;d++)this.items[d].attr(a,b)}return this};T.clear=function(){for(;this.length;)this.pop()};T.splice=function(a,b,d){var a=0>a?n(this.length+a,0):a,b=n(0,p(this.length-
a,b)),c=[],e=[],g=[],h;for(h=2;h<arguments.length;h++)g.push(arguments[h]);for(h=0;h<b;h++)e.push(this[a+h]);for(;h<this.length-a;h++)c.push(this[a+h]);var i=g.length;for(h=0;h<i+c.length;h++)this.items[a+h]=this[a+h]=h<i?g[h]:c[h-i];for(h=this.items.length=this.length-=b-i;this[h];)delete this[h++];return new oa(e)};T.exclude=function(a){for(var b=0,d=this.length;b<d;b++)if(this[b]==a)return this.splice(b,1),!0};T.animate=function(a,b,d,c){(e.is(d,"function")||!d)&&(c=d||null);var g=this.items.length,
h=g,i=this,j;if(!g)return this;c&&(j=function(){!--g&&c.call(i)});d=e.is(d,"string")?d:j;b=e.animation(a,b,d,j);for(a=this.items[--h].animate(b);h--;)this.items[h]&&!this.items[h].removed&&this.items[h].animateWith(a,b,b);return this};T.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this};T.getBBox=function(){for(var a=[],b=[],d=[],c=[],e=this.items.length;e--;)if(!this.items[e].removed){var h=this.items[e].getBBox();a.push(h.x);b.push(h.y);d.push(h.x+
h.width);c.push(h.y+h.height)}a=p[B](0,a);b=p[B](0,b);d=n[B](0,d);c=n[B](0,c);return{x:a,y:b,x2:d,y2:c,width:d-a,height:c-b}};T.clone=function(a){for(var a=new oa,b=0,d=this.items.length;b<d;b++)a.push(this.items[b].clone());return a};T.toString=function(){return"Rapha\u00ebl\u2018s set"};e.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},d=a.face["font-family"],c;for(c in a.face)a.face[I](c)&&(b.face[c]=a.face[c]);this.fonts[d]?this.fonts[d].push(b):
this.fonts[d]=[b];if(!a.svg){b.face["units-per-em"]=ha(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[I](e)&&(d=a.glyphs[e],b.glyphs[e]={w:d.w,k:{},d:d.d&&"M"+d.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},d.k))for(var h in d.k)d[I](h)&&(b.glyphs[e].k[h]=d.k[h])}return a};F.getFont=function(a,b,d,c){c=c||"normal";d=d||"normal";b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400;if(e.fonts){var h=e.fonts[a];if(!h){var a=RegExp("(^|\\s)"+
a.replace(/[^\w\d\s+!~.:_-]/g,"")+"(\\s|$)","i"),g;for(g in e.fonts)if(e.fonts[I](g)&&a.test(g)){h=e.fonts[g];break}}var i;if(h){g=0;for(a=h.length;g<a&&!(i=h[g],i.face["font-weight"]==b&&(i.face["font-style"]==d||!i.face["font-style"])&&i.face["font-stretch"]==c);g++);}return i}};F.print=function(a,b,d,c,g,j,k){var j=j||"middle",k=n(p(k||0,1),-1),m=h(d)[i](""),q=0,s=0,v="";e.is(c,d)&&(c=this.getFont(c));if(c)for(var d=(g||16)/c.face["units-per-em"],o=c.face.bbox[i](ca),g=+o[0],w=o[3]-o[1],r=0,j=
+o[1]+("baseline"==j?w+ +c.face.descent:w/2),o=0,A=m.length;o<A;o++){if("\n"==m[o])s=y=q=0,r+=w;else var t=s&&c.glyphs[m[o-1]]||{},y=c.glyphs[m[o]],q=q+(s?(t.w||c.w)+(t.k&&t.k[m[o]]||0)+c.w*k:0),s=1;y&&y.d&&(v+=e.transformPath(y.d,["t",q*d,r*d,"s",d,d,g,j,"t",(a-g)/d,(b-j)/d]))}return this.path(v).attr({fill:"#000",stroke:"none"})};F.add=function(a){if(e.is(a,"array"))for(var b=this.set(),d=0,c=a.length,h;d<c;d++)h=a[d]||{},Z[I](h.type)&&b.push(this[h.type]().attr(h));return b};e.format=function(a,
b){var d=e.is(b,U)?[0][c](b):arguments;a&&e.is(a,"string")&&d.length-1&&(a=a.replace(ma,function(a,b){return null==d[++b]?"":d[b]}));return a||""};var Bb=/\{([^\}]+)\}/g,Cb=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g;e.fullfill=function(a,b){return String(a).replace(Bb,function(a,d){var c=b;d.replace(Cb,function(a,b,d,f,h){b=b||f;c&&(b in c&&(c=c[b]),"function"==typeof c&&h&&(c=c()))});return c=(null==c||c==b?a:c)+""})};e.ninja=function(){aa?s.win.Raphael=O:delete Raphael;return e};
e.st=T;var ka=document,db=void 0,eb=function(){/in/.test(ka.readyState)?setTimeout(eb,9):e.eve("raphael.DOMload")};null==ka.readyState&&ka.addEventListener&&(ka.addEventListener("DOMContentLoaded",db=function(){ka.removeEventListener("DOMContentLoaded",db,!1);ka.readyState="complete"},!1),ka.readyState="loading");eb();aa?s.win.Raphael=e:Raphael=e;eve.on("raphael.DOMload",function(){ga=true})})();
window.Raphael&&window.Raphael.svg&&function(e){var G=String,C=parseFloat,V=parseInt,K=Math,X=K.max,ea=K.abs,Y=K.pow,M=/[, ]+/,fa=e.eve,P={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},N={};e.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\u00ebl "+this.version};var q=function(c,b){if(b){"string"==typeof c&&(c=q(c));for(var d in b)b.hasOwnProperty(d)&&
("xlink:"==d.substring(0,6)?c.setAttributeNS("http://www.w3.org/1999/xlink",d.substring(6),G(b[d])):c.setAttribute(d,G(b[d])))}else c=e._g.doc.createElementNS("http://www.w3.org/2000/svg",c),c.style&&(c.style.webkitTapHighlightColor="rgba(0,0,0,0)");return c},ga=function(c,b){var d="linear",h=c.id+b,i=0.5,g=0.5,j=c.node,m=c.paper,k=j.style,n=e._g.doc.getElementById(h);if(!n){b=G(b).replace(e._radial_gradient,function(b,c,h){d="radial";c&&h&&(i=C(c),g=C(h),b=2*(0.5<g)-1,0.25<Y(i-0.5,2)+Y(g-0.5,2)&&
(g=K.sqrt(0.25-Y(i-0.5,2))*b+0.5)&&0.5!=g&&(g=g.toFixed(5)-1E-5*b));return""});b=b.split(/\s*\-\s*/);if("linear"==d){n=b.shift();n=-C(n);if(isNaN(n))return null;var p=[0,0,K.cos(e.rad(n)),K.sin(e.rad(n))],n=1/(X(ea(p[2]),ea(p[3]))||1);p[2]*=n;p[3]*=n;0>p[2]&&(p[0]=-p[2],p[2]=0);0>p[3]&&(p[1]=-p[3],p[3]=0)}var s=e._parseDots(b);if(!s)return null;h=h.replace(/[\(\)\s,\xb0#]/g,"_");c.gradient&&h!=c.gradient.id&&(m.defs.removeChild(c.gradient),delete c.gradient);if(!c.gradient){n=q(d+"Gradient",{id:h});
c.gradient=n;q(n,"radial"==d?{fx:i,fy:g}:{x1:p[0],y1:p[1],x2:p[2],y2:p[3],gradientTransform:c.matrix.invert()});m.defs.appendChild(n);m=0;for(p=s.length;m<p;m++)n.appendChild(q("stop",{offset:s[m].offset?s[m].offset:m?"100%":"0%","stop-color":s[m].color||"#fff"}))}}q(j,{fill:"url(#"+h+")",opacity:1,"fill-opacity":1});k.fill="";k.opacity=1;return k.fillOpacity=1},ca=function(c){var b=c.getBBox(1);q(c.pattern,{patternTransform:c.matrix.invert()+" translate("+b.x+","+b.y+")"})},Z=function(c,b,d){if("path"==
c.type){for(var h=G(b).toLowerCase().split("-"),i=c.paper,g=d?"end":"start",j=c.node,m=c.attrs,k=m["stroke-width"],n=h.length,p="classic",s,w,A=3,v=3,z=5;n--;)switch(h[n]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":p=h[n];break;case "wide":v=5;break;case "narrow":v=2;break;case "long":A=5;break;case "short":A=2}"open"==p?(A+=2,v+=2,z+=2,s=1,w=d?4:1,h={fill:"none",stroke:m.stroke}):(w=s=A/2,h={fill:m.stroke,stroke:"none"});c._.arrows?d?(c._.arrows.endPath&&N[c._.arrows.endPath]--,
c._.arrows.endMarker&&N[c._.arrows.endMarker]--):(c._.arrows.startPath&&N[c._.arrows.startPath]--,c._.arrows.startMarker&&N[c._.arrows.startMarker]--):c._.arrows={};if("none"!=p){var n="raphael-marker-"+p,C="raphael-marker-"+g+p+A+v;e._g.doc.getElementById(n)?N[n]++:(i.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:P[p],id:n})),N[n]=1);var B=e._g.doc.getElementById(C);B?(N[C]++,A=B.getElementsByTagName("use")[0]):(B=q(q("marker"),{id:C,markerHeight:v,markerWidth:A,orient:"auto",refX:w,refY:v/
2}),A=q(q("use"),{"xlink:href":"#"+n,transform:(d?"rotate(180 "+A/2+" "+v/2+") ":"")+"scale("+A/z+","+v/z+")","stroke-width":(1/((A/z+v/z)/2)).toFixed(4)}),B.appendChild(A),i.defs.appendChild(B),N[C]=1);q(A,h);i=s*("diamond"!=p&&"oval"!=p);d?(d=c._.arrows.startdx*k||0,k=e.getTotalLength(m.path)-i*k):(d=i*k,k=e.getTotalLength(m.path)-(c._.arrows.enddx*k||0));h={};h["marker-"+g]="url(#"+C+")";if(k||d)h.d=Raphael.getSubpath(m.path,d,k);q(j,h);c._.arrows[g+"Path"]=n;c._.arrows[g+"Marker"]=C;c._.arrows[g+
"dx"]=i;c._.arrows[g+"Type"]=p;c._.arrows[g+"String"]=b}else d?(d=c._.arrows.startdx*k||0,k=e.getTotalLength(m.path)-d):(d=0,k=e.getTotalLength(m.path)-(c._.arrows.enddx*k||0)),c._.arrows[g+"Path"]&&q(j,{d:Raphael.getSubpath(m.path,d,k)}),delete c._.arrows[g+"Path"],delete c._.arrows[g+"Marker"],delete c._.arrows[g+"dx"],delete c._.arrows[g+"Type"],delete c._.arrows[g+"String"];for(h in N)N.hasOwnProperty(h)&&!N[h]&&(c=e._g.doc.getElementById(h))&&c.parentNode.removeChild(c)}},ma={"":[0],none:[0],
"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},I=function(c,b,d){if(b=ma[G(b).toLowerCase()]){for(var h=c.attrs["stroke-width"]||"1",d={round:h,square:h,butt:0}[c.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,e=[],g=b.length;g--;)e[g]=b[g]*h+(g%2?1:-1)*d;q(c.node,{"stroke-dasharray":e.join(",")})}},s=function(c,b){var d=c.node,h=c.attrs,i=d.style.visibility;d.style.visibility="hidden";for(var g in b)if(b.hasOwnProperty(g)&&
e._availableAttrs.hasOwnProperty(g)){var j=b[g];h[g]=j;switch(g){case "blur":c.blur(j);break;case "href":case "title":case "target":var m=d.parentNode;if("a"!=m.tagName.toLowerCase()){var k=q("a");m.insertBefore(k,d);k.appendChild(d);m=k}"target"==g?m.setAttributeNS("http://www.w3.org/1999/xlink","show","blank"==j?"new":j):m.setAttributeNS("http://www.w3.org/1999/xlink",g,j);break;case "cursor":d.style.cursor=j;break;case "transform":c.transform(j);break;case "arrow-start":Z(c,j);break;case "arrow-end":Z(c,
j,1);break;case "clip-rect":m=G(j).split(M);if(4==m.length){c.clip&&c.clip.parentNode.parentNode.removeChild(c.clip.parentNode);var k=q("clipPath"),n=q("rect");k.id=e.createUUID();q(n,{x:m[0],y:m[1],width:m[2],height:m[3]});k.appendChild(n);c.paper.defs.appendChild(k);q(d,{"clip-path":"url(#"+k.id+")"});c.clip=n}if(!j&&(j=d.getAttribute("clip-path")))(j=e._g.doc.getElementById(j.replace(/(^url\(#|\)$)/g,"")))&&j.parentNode.removeChild(j),q(d,{"clip-path":""}),delete c.clip;break;case "path":"path"==
c.type&&(q(d,{d:j?h.path=e._pathToAbsolute(j):"M0,0"}),c._.dirty=1,c._.arrows&&("startString"in c._.arrows&&Z(c,c._.arrows.startString),"endString"in c._.arrows&&Z(c,c._.arrows.endString,1)));break;case "width":if(d.setAttribute(g,j),c._.dirty=1,h.fx)g="x",j=h.x;else break;case "x":h.fx&&(j=-h.x-(h.width||0));case "rx":if("rx"==g&&"rect"==c.type)break;case "cx":d.setAttribute(g,j);c.pattern&&ca(c);c._.dirty=1;break;case "height":if(d.setAttribute(g,j),c._.dirty=1,h.fy)g="y",j=h.y;else break;case "y":h.fy&&
(j=-h.y-(h.height||0));case "ry":if("ry"==g&&"rect"==c.type)break;case "cy":d.setAttribute(g,j);c.pattern&&ca(c);c._.dirty=1;break;case "r":"rect"==c.type?q(d,{rx:j,ry:j}):d.setAttribute(g,j);c._.dirty=1;break;case "src":"image"==c.type&&d.setAttributeNS("http://www.w3.org/1999/xlink","href",j);break;case "stroke-width":if(1!=c._.sx||1!=c._.sy)j/=X(ea(c._.sx),ea(c._.sy))||1;c.paper._vbSize&&(j*=c.paper._vbSize);d.setAttribute(g,j);h["stroke-dasharray"]&&I(c,h["stroke-dasharray"],b);c._.arrows&&("startString"in
c._.arrows&&Z(c,c._.arrows.startString),"endString"in c._.arrows&&Z(c,c._.arrows.endString,1));break;case "stroke-dasharray":I(c,j,b);break;case "fill":var p=G(j).match(e._ISURL);if(p){var k=q("pattern"),s=q("image");k.id=e.createUUID();q(k,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});q(s,{x:0,y:0,"xlink:href":p[1]});k.appendChild(s);(function(b){e._preload(p[1],function(){var d=this.offsetWidth,h=this.offsetHeight;q(b,{width:d,height:h});q(s,{width:d,height:h});c.paper.safari()})})(k);
c.paper.defs.appendChild(k);q(d,{fill:"url(#"+k.id+")"});c.pattern=k;c.pattern&&ca(c);break}m=e.getRGB(j);if(m.error){if(("circle"==c.type||"ellipse"==c.type||"r"!=G(j).charAt())&&ga(c,j)){if("opacity"in h||"fill-opacity"in h)if(m=e._g.doc.getElementById(d.getAttribute("fill").replace(/^url\(#|\)$/g,"")))m=m.getElementsByTagName("stop"),q(m[m.length-1],{"stop-opacity":("opacity"in h?h.opacity:1)*("fill-opacity"in h?h["fill-opacity"]:1)});h.gradient=j;h.fill="none";break}}else delete b.gradient,delete h.gradient,
!e.is(h.opacity,"undefined")&&e.is(b.opacity,"undefined")&&q(d,{opacity:h.opacity}),!e.is(h["fill-opacity"],"undefined")&&e.is(b["fill-opacity"],"undefined")&&q(d,{"fill-opacity":h["fill-opacity"]});m.hasOwnProperty("opacity")&&q(d,{"fill-opacity":1<m.opacity?m.opacity/100:m.opacity});case "stroke":m=e.getRGB(j);d.setAttribute(g,m.hex);"stroke"==g&&m.hasOwnProperty("opacity")&&q(d,{"stroke-opacity":1<m.opacity?m.opacity/100:m.opacity});"stroke"==g&&c._.arrows&&("startString"in c._.arrows&&Z(c,c._.arrows.startString),
"endString"in c._.arrows&&Z(c,c._.arrows.endString,1));break;case "gradient":("circle"==c.type||"ellipse"==c.type||"r"!=G(j).charAt())&&ga(c,j);break;case "opacity":h.gradient&&!h.hasOwnProperty("stroke-opacity")&&q(d,{"stroke-opacity":1<j?j/100:j});case "fill-opacity":if(h.gradient){if(m=e._g.doc.getElementById(d.getAttribute("fill").replace(/^url\(#|\)$/g,"")))m=m.getElementsByTagName("stop"),q(m[m.length-1],{"stop-opacity":j});break}default:"font-size"==g&&(j=V(j,10)+"px"),m=g.replace(/(\-.)/g,
function(b){return b.substring(1).toUpperCase()}),d.style[m]=j,c._.dirty=1,d.setAttribute(g,j)}}if(!("text"!=c.type||!b.hasOwnProperty("text")&&!b.hasOwnProperty("font")&&!b.hasOwnProperty("font-size")&&!b.hasOwnProperty("x")&&!b.hasOwnProperty("y"))){g=c.attrs;j=c.node;m=j.firstChild?V(e._g.doc.defaultView.getComputedStyle(j.firstChild,"").getPropertyValue("font-size"),10):10;if(b.hasOwnProperty("text")){for(g.text=b.text;j.firstChild;)j.removeChild(j.firstChild);for(var k=G(b.text).split("\n"),
h=[],w=0,A=k.length;w<A;w++)n=q("tspan"),w&&q(n,{dy:m*aa,x:g.x}),n.appendChild(e._g.doc.createTextNode(k[w])),j.appendChild(n),h[w]=n}else{h=j.getElementsByTagName("tspan");w=0;for(A=h.length;w<A;w++)w?q(h[w],{dy:m*aa,x:g.x}):q(h[0],{dy:0})}q(j,{x:g.x,y:g.y});c._.dirty=1;j=c._getBBox();(g=g.y-(j.y+j.height/2))&&e.is(g,"finite")&&q(h[0],{dy:g})}d.style.visibility=i},aa=1.2,O=function(c,b){this[0]=this.node=c;c.raphael=!0;this.id=e._oid++;c.raphaelid=this.id;this.matrix=e.matrix();this.realPath=null;
this.paper=b;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!b.bottom&&(b.bottom=this);(this.prev=b.top)&&(b.top.next=this);b.top=this;this.next=null},z=e.el;O.prototype=z;z.constructor=O;e._engine.path=function(c,b){var d=q("path");b.canvas&&b.canvas.appendChild(d);d=new O(d,b);d.type="path";s(d,{fill:"none",stroke:"#000",path:c});return d};z.rotate=function(c,b,d){if(this.removed)return this;c=G(c).split(M);c.length-1&&(b=C(c[1]),d=C(c[2]));c=C(c[0]);null==d&&
(b=d);if(null==b||null==d)d=this.getBBox(1),b=d.x+d.width/2,d=d.y+d.height/2;this.transform(this._.transform.concat([["r",c,b,d]]));return this};z.scale=function(c,b,d,h){if(this.removed)return this;c=G(c).split(M);c.length-1&&(b=C(c[1]),d=C(c[2]),h=C(c[3]));c=C(c[0]);null==b&&(b=c);null==h&&(d=h);if(null==d||null==h)var e=this.getBBox(1);d=null==d?e.x+e.width/2:d;h=null==h?e.y+e.height/2:h;this.transform(this._.transform.concat([["s",c,b,d,h]]));return this};z.translate=function(c,b){if(this.removed)return this;
c=G(c).split(M);c.length-1&&(b=C(c[1]));c=C(c[0])||0;this.transform(this._.transform.concat([["t",c,+b||0]]));return this};z.transform=function(c){var b=this._;if(null==c)return b.transform;e._extractTransform(this,c);this.clip&&q(this.clip,{transform:this.matrix.invert()});this.pattern&&ca(this);this.node&&q(this.node,{transform:this.matrix});if(1!=b.sx||1!=b.sy)c=this.attrs.hasOwnProperty("stroke-width")?this.attrs["stroke-width"]:1,this.attr({"stroke-width":c});return this};z.hide=function(){!this.removed&&
this.paper.safari(this.node.style.display="none");return this};z.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this};z.remove=function(){if(!this.removed&&this.node.parentNode){var c=this.paper;c.__set__&&c.__set__.exclude(this);fa.unbind("raphael.*.*."+this.id);this.gradient&&c.defs.removeChild(this.gradient);e._tear(this,c);"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);
for(var b in this)this[b]="function"==typeof this[b]?e._removedFactory(b):null;this.removed=!0}};z._getBBox=function(){if("none"==this.node.style.display){this.show();var c=!0}var b={};try{b=this.node.getBBox()}catch(d){}finally{b=b||{}}c&&this.hide();return b};z.attr=function(c,b){if(this.removed)return this;if(null==c){var d={},h;for(h in this.attrs)this.attrs.hasOwnProperty(h)&&(d[h]=this.attrs[h]);d.gradient&&"none"==d.fill&&(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;
return d}if(null==b&&e.is(c,"string")){if("fill"==c&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==c)return this._.transform;h=c.split(M);for(var d={},i=0,g=h.length;i<g;i++)c=h[i],d[c]=c in this.attrs?this.attrs[c]:e.is(this.paper.customAttributes[c],"function")?this.paper.customAttributes[c].def:e._availableAttrs[c];return g-1?d:d[h[0]]}if(null==b&&e.is(c,"array")){d={};i=0;for(g=c.length;i<g;i++)d[c[i]]=this.attr(c[i]);return d}null!=b?(d={},d[c]=b):null!=
c&&e.is(c,"object")&&(d=c);for(i in d)fa("raphael.attr."+i+"."+this.id,this,d[i]);for(i in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(i)&&d.hasOwnProperty(i)&&e.is(this.paper.customAttributes[i],"function"))for(g in h=this.paper.customAttributes[i].apply(this,[].concat(d[i])),this.attrs[i]=d[i],h)h.hasOwnProperty(g)&&(d[g]=h[g]);s(this,d);return this};z.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):
this.node.parentNode.appendChild(this.node);var c=this.paper;c.top!=this&&e._tofront(this,c);return this};z.toBack=function(){if(this.removed)return this;var c=this.node.parentNode;"a"==c.tagName.toLowerCase()?c.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):c.firstChild!=this.node&&c.insertBefore(this.node,this.node.parentNode.firstChild);e._toback(this,this.paper);return this};z.insertAfter=function(c){if(this.removed)return this;var b=c.node||c[c.length-
1].node;b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node);e._insertafter(this,c,this.paper);return this};z.insertBefore=function(c){if(this.removed)return this;var b=c.node||c[0].node;b.parentNode.insertBefore(this.node,b);e._insertbefore(this,c,this.paper);return this};z.blur=function(c){if(0!==+c){var b=q("filter"),d=q("feGaussianBlur");this.attrs.blur=c;b.id=e.createUUID();q(d,{stdDeviation:+c||1.5});b.appendChild(d);this.paper.defs.appendChild(b);
this._blur=b;q(this.node,{filter:"url(#"+b.id+")"})}else this._blur&&(this._blur.parentNode.removeChild(this._blur),delete this._blur,delete this.attrs.blur),this.node.removeAttribute("filter")};e._engine.circle=function(c,b,d,h){var e=q("circle");c.canvas&&c.canvas.appendChild(e);c=new O(e,c);c.attrs={cx:b,cy:d,r:h,fill:"none",stroke:"#000"};c.type="circle";q(e,c.attrs);return c};e._engine.rect=function(c,b,d,e,i,g){var j=q("rect");c.canvas&&c.canvas.appendChild(j);c=new O(j,c);c.attrs={x:b,y:d,
width:e,height:i,r:g||0,rx:g||0,ry:g||0,fill:"none",stroke:"#000"};c.type="rect";q(j,c.attrs);return c};e._engine.ellipse=function(c,b,d,e,i){var g=q("ellipse");c.canvas&&c.canvas.appendChild(g);c=new O(g,c);c.attrs={cx:b,cy:d,rx:e,ry:i,fill:"none",stroke:"#000"};c.type="ellipse";q(g,c.attrs);return c};e._engine.image=function(c,b,d,e,i,g){var j=q("image");q(j,{x:d,y:e,width:i,height:g,preserveAspectRatio:"none"});j.setAttributeNS("http://www.w3.org/1999/xlink","href",b);c.canvas&&c.canvas.appendChild(j);
c=new O(j,c);c.attrs={x:d,y:e,width:i,height:g,src:b};c.type="image";return c};e._engine.text=function(c,b,d,h){var i=q("text");c.canvas&&c.canvas.appendChild(i);c=new O(i,c);c.attrs={x:b,y:d,"text-anchor":"middle",text:h,font:e._availableAttrs.font,stroke:"none",fill:"#000"};c.type="text";s(c,c.attrs);return c};e._engine.setSize=function(c,b){this.width=c||this.width;this.height=b||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);this._viewBox&&
this.setViewBox.apply(this,this._viewBox);return this};e._engine.create=function(){var c=e._getContainer.apply(0,arguments),b=c&&c.container,d=c.x,h=c.y,i=c.width,c=c.height;if(!b)throw Error("SVG container not found.");var g=q("svg"),j,d=d||0,h=h||0,i=i||512,c=c||342;q(g,{height:c,version:1.1,width:i,xmlns:"http://www.w3.org/2000/svg"});1==b?(g.style.cssText="overflow:hidden;position:absolute;left:"+d+"px;top:"+h+"px",e._g.doc.body.appendChild(g),j=1):(g.style.cssText="overflow:hidden;position:relative",
b.firstChild?b.insertBefore(g,b.firstChild):b.appendChild(g));b=new e._Paper;b.width=i;b.height=c;b.canvas=g;b.clear();b._left=b._top=0;j&&(b.renderfix=function(){});b.renderfix();return b};e._engine.setViewBox=function(c,b,d,e,i){fa("raphael.setViewBox",this,this._viewBox,[c,b,d,e,i]);var g=X(d/this.width,e/this.height),j=this.top,m=i?"meet":"xMinYMin",k;null==c?(this._vbSize&&(g=1),delete this._vbSize,k="0 0 "+this.width+" "+this.height):(this._vbSize=g,k=c+" "+b+" "+d+" "+e);for(q(this.canvas,
{viewBox:k,preserveAspectRatio:m});g&&j;)m="stroke-width"in j.attrs?j.attrs["stroke-width"]:1,j.attr({"stroke-width":m}),j._.dirty=1,j._.dirtyT=1,j=j.prev;this._viewBox=[c,b,d,e,!!i];return this};e.prototype.renderfix=function(){var c=this.canvas,b=c.style,d;try{d=c.getScreenCTM()||c.createSVGMatrix()}catch(e){d=c.createSVGMatrix()}c=-d.e%1;d=-d.f%1;if(c||d)if(c&&(this._left=(this._left+c)%1,b.left=this._left+"px"),d)this._top=(this._top+d)%1,b.top=this._top+"px"};e.prototype.clear=function(){e.eve("raphael.clear",
this);for(var c=this.canvas;c.firstChild;)c.removeChild(c.firstChild);this.bottom=this.top=null;(this.desc=q("desc")).appendChild(e._g.doc.createTextNode("Created with Rapha\u00ebl "+e.version));c.appendChild(this.desc);c.appendChild(this.defs=q("defs"))};e.prototype.remove=function(){fa("raphael.remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var c in this)this[c]="function"==typeof this[c]?e._removedFactory(c):null};var F=e.st,B;for(B in z)z.hasOwnProperty(B)&&
!F.hasOwnProperty(B)&&(F[B]=function(c){return function(){var b=arguments;return this.forEach(function(d){d[c].apply(d,b)})}}(B))}(window.Raphael);
window.Raphael&&window.Raphael.vml&&function(e){var G=String,C=parseFloat,V=Math,K=V.round,X=V.max,ea=V.min,Y=V.abs,M=/[, ]+/,fa=e.eve,P={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},N=/([clmz]),?([^clmz]*)/gi,q=/ progid:\S+Blur\([^\)]+\)/g,ga=/-?[^,\s-]+/g,ca={path:1,rect:1,image:1},Z={circle:1,ellipse:1},ma=function(b,d,c){var i=e.matrix();i.rotate(-b,0.5,0.5);return{dx:i.x(d,c),dy:i.y(d,c)}},I=function(b,d,c,e,g,j){var m=b._,k=b.matrix,n=m.fillpos,b=b.node,p=b.style,q=1,s="",A=21600/d,v=21600/
c;p.visibility="hidden";if(d&&c){b.coordsize=Y(A)+" "+Y(v);p.rotation=j*(0>d*c?-1:1);j&&(g=ma(j,e,g),e=g.dx,g=g.dy);0>d&&(s+="x");0>c&&(s+=" y")&&(q=-1);p.flip=s;b.coordorigin=e*-A+" "+g*-v;if(n||m.fillsize)e=(e=b.getElementsByTagName("fill"))&&e[0],b.removeChild(e),n&&(g=ma(j,k.x(n[0],n[1]),k.y(n[0],n[1])),e.position=g.dx*q+" "+g.dy*q),m.fillsize&&(e.size=m.fillsize[0]*Y(d)+" "+m.fillsize[1]*Y(c)),b.appendChild(e);p.visibility="visible"}};e.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\u00ebl "+
this.version};var s=function(b,d,c){for(var d=G(d).toLowerCase().split("-"),c=c?"end":"start",e=d.length,g="classic",j="medium",m="medium";e--;)switch(d[e]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":g=d[e];break;case "wide":case "narrow":m=d[e];break;case "long":case "short":j=d[e]}b=b.node.getElementsByTagName("stroke")[0];b[c+"arrow"]=g;b[c+"arrowlength"]=j;b[c+"arrowwidth"]=m},aa=function(b,d){b.attrs=b.attrs||{};var c=b.node,i=b.attrs,g=c.style,j=ca[b.type]&&
(d.x!=i.x||d.y!=i.y||d.width!=i.width||d.height!=i.height||d.cx!=i.cx||d.cy!=i.cy||d.rx!=i.rx||d.ry!=i.ry||d.r!=i.r),m=Z[b.type]&&(i.cx!=d.cx||i.cy!=d.cy||i.r!=d.r||i.rx!=d.rx||i.ry!=d.ry),k;for(k in d)d.hasOwnProperty(k)&&(i[k]=d[k]);j&&(i.path=e._getPath[b.type](b),b._.dirty=1);d.href&&(c.href=d.href);d.title&&(c.title=d.title);d.target&&(c.target=d.target);d.cursor&&(g.cursor=d.cursor);"blur"in d&&b.blur(d.blur);if(d.path&&"path"==b.type||j){g=~G(i.path).toLowerCase().indexOf("r")?e._pathToAbsolute(i.path):
i.path;j=/[ahqstv]/ig;k=e._pathToAbsolute;G(g).match(j)&&(k=e._path2curve);j=/[clmz]/g;if(k==e._pathToAbsolute&&!G(g).match(j))g=G(g).replace(N,function(b,d,c){var e=[],g=d.toLowerCase()=="m",h=P[d];c.replace(ga,function(b){if(g&&e.length==2){h=h+(e+P[d=="m"?"l":"L"]);e=[]}e.push(K(b*21600))});return h+e});else{for(var j=k(g),n,g=[],p=0,q=j.length;p<q;p++){k=j[p];n=j[p][0].toLowerCase();"z"==n&&(n="x");for(var w=1,A=k.length;w<A;w++)n+=K(21600*k[w])+(w!=A-1?",":"");g.push(n)}g=g.join(" ")}c.path=
g;"image"==b.type&&(b._.fillpos=[i.x,i.y],b._.fillsize=[i.width,i.height],I(b,1,1,0,0,0))}"transform"in d&&b.transform(d.transform);m&&(m=+i.cx,g=+i.cy,j=+i.rx||+i.r||0,k=+i.ry||+i.r||0,c.path=e.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",K(21600*(m-j)),K(21600*(g-k)),K(21600*(m+j)),K(21600*(g+k)),K(21600*m)));if("clip-rect"in d&&(m=G(d["clip-rect"]).split(M),4==m.length&&(m[2]=+m[2]+ +m[0],m[3]=+m[3]+ +m[1],g=c.clipRect||e._g.doc.createElement("div"),j=g.style,j.clip=e.format("rect({1}px {2}px {3}px {0}px)",
m),c.clipRect||(j.position="absolute",j.top=0,j.left=0,j.width=b.paper.width+"px",j.height=b.paper.height+"px",c.parentNode.insertBefore(g,c),g.appendChild(c),c.clipRect=g)),!d["clip-rect"]))c.clipRect&&(c.clipRect.style.clip="auto");b.textpath&&(m=b.textpath.style,d.font&&(m.font=d.font),d["font-family"]&&(m.fontFamily='"'+d["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"'),d["font-size"]&&(m.fontSize=d["font-size"]),d["font-weight"]&&(m.fontWeight=d["font-weight"]),d["font-style"]&&
(m.fontStyle=d["font-style"]));"arrow-start"in d&&s(b,d["arrow-start"]);"arrow-end"in d&&s(b,d["arrow-end"],1);if(null!=d.opacity||null!=d["stroke-width"]||null!=d.fill||null!=d.src||null!=d.stroke||null!=d["stroke-width"]||null!=d["stroke-opacity"]||null!=d["fill-opacity"]||null!=d["stroke-dasharray"]||null!=d["stroke-miterlimit"]||null!=d["stroke-linejoin"]||null!=d["stroke-linecap"]){m=(m=c.getElementsByTagName("fill"))&&m[0];!m&&(m=F("fill"));"image"==b.type&&d.src&&(m.src=d.src);d.fill&&(m.on=
!0);if(null==m.on||"none"==d.fill||null===d.fill)m.on=!1;if(m.on&&d.fill)if(g=G(d.fill).match(e._ISURL)){m.parentNode==c&&c.removeChild(m);m.rotate=!0;m.src=g[1];m.type="tile";var v=b.getBBox(1);m.position=v.x+" "+v.y;b._.fillpos=[v.x,v.y];e._preload(g[1],function(){b._.fillsize=[this.offsetWidth,this.offsetHeight]})}else{m.color=e.getRGB(d.fill).hex;m.src="";m.type="solid";if(g=e.getRGB(d.fill).error)if(g=b.type in{circle:1,ellipse:1}||"r"!=G(d.fill).charAt())a:{g=b;k=d.fill;j=m;g.attrs=g.attrs||
{};var z=Math.pow,B="linear",O=".5 .5";g.attrs.gradient=k;k=G(k).replace(e._radial_gradient,function(b,d,c){B="radial";if(d&&c){d=C(d);c=C(c);z(d-0.5,2)+z(c-0.5,2)>0.25&&(c=V.sqrt(0.25-z(d-0.5,2))*((c>0.5)*2-1)+0.5);O=d+" "+c}return""});k=k.split(/\s*\-\s*/);if("linear"==B&&(v=k.shift(),v=-C(v),isNaN(v))){g=null;break a}if(k=e._parseDots(k)){g=g.shape||g.node;if(k.length){g.removeChild(j);j.on=!0;j.method="none";j.color=k[0].color;j.color2=k[k.length-1].color;n=[];p=0;for(q=k.length;p<q;p++)k[p].offset&&
n.push(k[p].offset+" "+k[p].color);j.colors=n.length?n.join():"0% "+j.color;"radial"==B?(j.type="gradientTitle",j.focus="100%",j.focussize="0 0",j.focusposition=O,j.angle=0):(j.type="gradient",j.angle=(270-v)%360);g.appendChild(j)}g=1}else g=null}g&&(i.fill="none",i.gradient=d.fill,m.rotate=!1)}if("fill-opacity"in d||"opacity"in d)g=((+i["fill-opacity"]+1||2)-1)*((+i.opacity+1||2)-1)*((+e.getRGB(d.fill).o+1||2)-1),g=ea(X(g,0),1),m.opacity=g,m.src&&(m.color="none");c.appendChild(m);v=c.getElementsByTagName("stroke")&&
c.getElementsByTagName("stroke")[0];m=!1;!v&&(m=v=F("stroke"));if(d.stroke&&"none"!=d.stroke||d["stroke-width"]||null!=d["stroke-opacity"]||d["stroke-dasharray"]||d["stroke-miterlimit"]||d["stroke-linejoin"]||d["stroke-linecap"])v.on=!0;("none"==d.stroke||null===d.stroke||null==v.on||0==d.stroke||0==d["stroke-width"])&&(v.on=!1);g=e.getRGB(d.stroke);v.on&&d.stroke&&(v.color=g.hex);g=((+i["stroke-opacity"]+1||2)-1)*((+i.opacity+1||2)-1)*((+g.o+1||2)-1);j=0.75*(C(d["stroke-width"])||1);g=ea(X(g,0),
1);null==d["stroke-width"]&&(j=i["stroke-width"]);d["stroke-width"]&&(v.weight=j);j&&1>j&&(g*=j)&&(v.weight=1);v.opacity=g;d["stroke-linejoin"]&&(v.joinstyle=d["stroke-linejoin"]||"miter");v.miterlimit=d["stroke-miterlimit"]||8;d["stroke-linecap"]&&(v.endcap="butt"==d["stroke-linecap"]?"flat":"square"==d["stroke-linecap"]?"square":"round");d["stroke-dasharray"]&&(g={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot",
"--..":"longdashdotdot"},v.dashstyle=g.hasOwnProperty(d["stroke-dasharray"])?g[d["stroke-dasharray"]]:"");m&&c.appendChild(v)}if("text"==b.type){b.paper.canvas.style.display="";c=b.paper.span;v=i.font&&i.font.match(/\d+(?:\.\d*)?(?=px)/);g=c.style;i.font&&(g.font=i.font);i["font-family"]&&(g.fontFamily=i["font-family"]);i["font-weight"]&&(g.fontWeight=i["font-weight"]);i["font-style"]&&(g.fontStyle=i["font-style"]);v=C(i["font-size"]||v&&v[0])||10;g.fontSize=100*v+"px";b.textpath.string&&(c.innerHTML=
G(b.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));c=c.getBoundingClientRect();b.W=i.w=(c.right-c.left)/100;b.H=i.h=(c.bottom-c.top)/100;b.X=i.x;b.Y=i.y+b.H/2;("x"in d||"y"in d)&&(b.path.v=e.format("m{0},{1}l{2},{1}",K(21600*i.x),K(21600*i.y),K(21600*i.x)+1));c="x y text font font-family font-weight font-style font-size".split(" ");v=0;for(m=c.length;v<m;v++)if(c[v]in d){b._.dirty=1;break}switch(i["text-anchor"]){case "start":b.textpath.style["v-text-align"]="left";
b.bbx=b.W/2;break;case "end":b.textpath.style["v-text-align"]="right";b.bbx=-b.W/2;break;default:b.textpath.style["v-text-align"]="center",b.bbx=0}b.textpath.style["v-text-kern"]=!0}},O=function(b,d){this[0]=this.node=b;b.raphael=!0;this.id=e._oid++;b.raphaelid=this.id;this.Y=this.X=0;this.attrs={};this.paper=d;this.matrix=e.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!d.bottom&&(d.bottom=this);(this.prev=d.top)&&(d.top.next=this);d.top=this;this.next=null},z=e.el;O.prototype=
z;z.constructor=O;z.transform=function(b){if(null==b)return this._.transform;var d=this.paper._viewBoxShift,c=d?"s"+[d.scale,d.scale]+"-1-1t"+[d.dx,d.dy]:"",i;d&&(i=b=G(b).replace(/\.{3}|\u2026/g,this._.transform||""));e._extractTransform(this,c+b);var d=this.matrix.clone(),g=this.skew,b=this.node,c=~G(this.attrs.fill).indexOf("-"),j=!G(this.attrs.fill).indexOf("url(");d.translate(-0.5,-0.5);j||c||"image"==this.type?(g.matrix="1 0 0 1",g.offset="0 0",g=d.split(),c&&g.noRotation||!g.isSimple?(b.style.filter=
d.toFilter(),c=this.getBBox(),g=this.getBBox(1),d=c.x-g.x,c=c.y-g.y,b.coordorigin=-21600*d+" "+-21600*c,I(this,1,1,d,c,0)):(b.style.filter="",I(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate))):(b.style.filter="",g.matrix=G(d),g.offset=d.offset());i&&(this._.transform=i);return this};z.rotate=function(b,d,c){if(this.removed)return this;if(null!=b){b=G(b).split(M);b.length-1&&(d=C(b[1]),c=C(b[2]));b=C(b[0]);null==c&&(d=c);if(null==d||null==c)c=this.getBBox(1),d=c.x+c.width/2,c=c.y+c.height/2;this._.dirtyT=
1;this.transform(this._.transform.concat([["r",b,d,c]]));return this}};z.translate=function(b,d){if(this.removed)return this;b=G(b).split(M);b.length-1&&(d=C(b[1]));b=C(b[0])||0;d=+d||0;this._.bbox&&(this._.bbox.x+=b,this._.bbox.y+=d);this.transform(this._.transform.concat([["t",b,d]]));return this};z.scale=function(b,d,c,e){if(this.removed)return this;b=G(b).split(M);b.length-1&&(d=C(b[1]),c=C(b[2]),e=C(b[3]),isNaN(c)&&(c=null),isNaN(e)&&(e=null));b=C(b[0]);null==d&&(d=b);null==e&&(c=e);if(null==
c||null==e)var g=this.getBBox(1);c=null==c?g.x+g.width/2:c;e=null==e?g.y+g.height/2:e;this.transform(this._.transform.concat([["s",b,d,c,e]]));this._.dirtyT=1;return this};z.hide=function(){!this.removed&&(this.node.style.display="none");return this};z.show=function(){!this.removed&&(this.node.style.display="");return this};z._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}};z.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&
this.paper.__set__.exclude(this);e.eve.unbind("raphael.*.*."+this.id);e._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var b in this)this[b]="function"==typeof this[b]?e._removedFactory(b):null;this.removed=!0}};z.attr=function(b,d){if(this.removed)return this;if(null==b){var c={},i;for(i in this.attrs)this.attrs.hasOwnProperty(i)&&(c[i]=this.attrs[i]);c.gradient&&"none"==c.fill&&(c.fill=c.gradient)&&delete c.gradient;
c.transform=this._.transform;return c}if(null==d&&e.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;i=b.split(M);for(var c={},g=0,j=i.length;g<j;g++)b=i[g],c[b]=b in this.attrs?this.attrs[b]:e.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:e._availableAttrs[b];return j-1?c:c[i[0]]}if(this.attrs&&null==d&&e.is(b,"array")){c={};g=0;for(j=b.length;g<j;g++)c[b[g]]=this.attr(b[g]);return c}null!=d&&(c={},c[b]=d);null==
d&&e.is(b,"object")&&(c=b);for(g in c)fa("raphael.attr."+g+"."+this.id,this,c[g]);if(c){for(g in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(g)&&c.hasOwnProperty(g)&&e.is(this.paper.customAttributes[g],"function"))for(j in i=this.paper.customAttributes[g].apply(this,[].concat(c[g])),this.attrs[g]=c[g],i)i.hasOwnProperty(j)&&(c[j]=i[j]);c.text&&"text"==this.type&&(this.textpath.string=c.text);aa(this,c)}return this};z.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);
this.paper&&this.paper.top!=this&&e._tofront(this,this.paper);return this};z.toBack=function(){if(this.removed)return this;this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),e._toback(this,this.paper));return this};z.insertAfter=function(b){if(this.removed)return this;b.constructor==e.st.constructor&&(b=b[b.length-1]);b.node.nextSibling?b.node.parentNode.insertBefore(this.node,b.node.nextSibling):b.node.parentNode.appendChild(this.node);
e._insertafter(this,b,this.paper);return this};z.insertBefore=function(b){if(this.removed)return this;b.constructor==e.st.constructor&&(b=b[0]);b.node.parentNode.insertBefore(this.node,b.node);e._insertbefore(this,b,this.paper);return this};z.blur=function(b){var d=this.node.runtimeStyle,c=d.filter,c=c.replace(q,"");0!==+b?(this.attrs.blur=b,d.filter=c+"  progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+b||1.5)+")",d.margin=e.format("-{0}px 0 0 -{0}px",K(+b||1.5))):(d.filter=c,d.margin=0,delete this.attrs.blur)};
e._engine.path=function(b,d){var c=F("shape");c.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";c.coordsize="21600 21600";c.coordorigin=d.coordorigin;var e=new O(c,d),g={fill:"none",stroke:"#000"};b&&(g.path=b);e.type="path";e.path=[];e.Path="";aa(e,g);d.canvas.appendChild(c);g=F("skew");g.on=!0;c.appendChild(g);e.skew=g;e.transform("");return e};e._engine.rect=function(b,d,c,i,g,j){var m=e._rectPath(d,c,i,g,j),b=b.path(m),k=b.attrs;b.X=k.x=d;b.Y=k.y=c;b.W=k.width=i;b.H=k.height=
g;k.r=j;k.path=m;b.type="rect";return b};e._engine.ellipse=function(b,d,c,e,g){b=b.path();b.X=d-e;b.Y=c-g;b.W=2*e;b.H=2*g;b.type="ellipse";aa(b,{cx:d,cy:c,rx:e,ry:g});return b};e._engine.circle=function(b,d,c,e){b=b.path();b.X=d-e;b.Y=c-e;b.W=b.H=2*e;b.type="circle";aa(b,{cx:d,cy:c,r:e});return b};e._engine.image=function(b,d,c,i,g,j){var m=e._rectPath(c,i,g,j),b=b.path(m).attr({stroke:"none"}),k=b.attrs,n=b.node,p=n.getElementsByTagName("fill")[0];k.src=d;b.X=k.x=c;b.Y=k.y=i;b.W=k.width=g;b.H=k.height=
j;k.path=m;b.type="image";p.parentNode==n&&n.removeChild(p);p.rotate=!0;p.src=d;p.type="tile";b._.fillpos=[c,i];b._.fillsize=[g,j];n.appendChild(p);I(b,1,1,0,0,0);return b};e._engine.text=function(b,c,h,i){var g=F("shape"),j=F("path"),m=F("textpath"),c=c||0,h=h||0,i=i||"";j.v=e.format("m{0},{1}l{2},{1}",K(21600*c),K(21600*h),K(21600*c)+1);j.textpathok=!0;m.string=G(i);m.on=!0;g.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";g.coordsize="21600 21600";g.coordorigin="0 0";var k=
new O(g,b),n={fill:"#000",stroke:"none",font:e._availableAttrs.font,text:i};k.shape=g;k.path=j;k.textpath=m;k.type="text";k.attrs.text=G(i);k.attrs.x=c;k.attrs.y=h;k.attrs.w=1;k.attrs.h=1;aa(k,n);g.appendChild(m);g.appendChild(j);b.canvas.appendChild(g);b=F("skew");b.on=!0;g.appendChild(b);k.skew=b;k.transform("");return k};e._engine.setSize=function(b,c){var h=this.canvas.style;this.width=b;this.height=c;b==+b&&(b+="px");c==+c&&(c+="px");h.width=b;h.height=c;h.clip="rect(0 "+b+" "+c+" 0)";this._viewBox&&
e._engine.setViewBox.apply(this,this._viewBox);return this};e._engine.setViewBox=function(b,c,h,i,g){e.eve("raphael.setViewBox",this,this._viewBox,[b,c,h,i,g]);var j=this.width,m=this.height,k=1/X(h/j,i/m),n,p;g&&(n=m/i,p=j/h,h*n<j&&(b-=(j-h*n)/2/n),i*p<m&&(c-=(m-i*p)/2/p));this._viewBox=[b,c,h,i,!!g];this._viewBoxShift={dx:-b,dy:-c,scale:k};this.forEach(function(b){b.transform("...")});return this};var F;e._engine.initWin=function(b){var c=b.document;c.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");
try{!c.namespaces.rvml&&c.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),F=function(b){return c.createElement("<rvml:"+b+' class="rvml">')}}catch(e){F=function(b){return c.createElement("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}};e._engine.initWin(e._g.win);e._engine.create=function(){var b=e._getContainer.apply(0,arguments),c=b.container,h=b.height,i=b.width,g=b.x,b=b.y;if(!c)throw Error("VML container not found.");var j=new e._Paper,m=j.canvas=e._g.doc.createElement("div"),
k=m.style,g=g||0,b=b||0,i=i||512,h=h||342;j.width=i;j.height=h;i==+i&&(i+="px");h==+h&&(h+="px");j.coordsize="21600000 21600000";j.coordorigin="0 0";j.span=e._g.doc.createElement("span");j.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";m.appendChild(j.span);k.cssText=e.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",i,h);1==c?(e._g.doc.body.appendChild(m),k.left=g+"px",k.top=
b+"px",k.position="absolute"):c.firstChild?c.insertBefore(m,c.firstChild):c.appendChild(m);j.renderfix=function(){};return j};e.prototype.clear=function(){e.eve("raphael.clear",this);this.canvas.innerHTML="";this.span=e._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};e.prototype.remove=function(){e.eve("raphael.remove",this);this.canvas.parentNode.removeChild(this.canvas);
for(var b in this)this[b]="function"==typeof this[b]?e._removedFactory(b):null;return!0};var B=e.st,c;for(c in z)z.hasOwnProperty(c)&&!B.hasOwnProperty(c)&&(B[c]=function(b){return function(){var c=arguments;return this.forEach(function(e){e[b].apply(e,c)})}}(c))}(window.Raphael);;
;
/* module-key = 'com.atlassian.auiplugin:ajs-raphael', location = 'js/raphael/raphael.shadow.js' */
window.Raphael&&window.Raphael.version&&(Raphael.shadow=function(b,c,d,e,a){var a=a||{},g=jQuery(a.target),f=jQuery("<div/>",{"class":"aui-shadow"}),h=a.shadow||a.color||"#000",i=10*a.size||0,j=a.offsetSize||3,m=a.zindex||0,k=a.radius||0,l="0.4",a=a.blur||3,d=d+(i+2*a),e=e+(i+2*a);if(Raphael.shadow.BOX_SHADOW_SUPPORT)return g.addClass("aui-box-shadow"),f.addClass("hidden");0===b&&(0===c&&0<g.length)&&(c=g.offset(),b=j-a+c.left,c=j-a+c.top);jQuery.browser.msie&&"9">jQuery.browser.version&&(h="#f0f0f0",
l="0.2");f.css({position:"absolute",left:b,top:c,width:d,height:e,zIndex:m});0<g.length?(f.appendTo(document.body),b=Raphael(f[0],d,e,k)):b=Raphael(b,c,d,e,k);b.canvas.style.position="absolute";b.rect(a,a,d-2*a,e-2*a).attr({fill:h,stroke:h,blur:""+a,opacity:l});return f},Raphael.shadow.BOX_SHADOW_SUPPORT=function(){for(var b=document.documentElement.style,c=["boxShadow","MozBoxShadow","WebkitBoxShadow","msBoxShadow"],d=0;d<c.length;d++)if(c[d]in b)return!0;return!1}());;
;
/* module-key = 'com.atlassian.soy.soy-template-plugin:soy-deps', location = 'js/soyutils.js' */
/*!
 * Copyright 2008 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var goog=goog||{};goog.global=this;COMPILED=true;goog.global.CLOSURE_UNCOMPILED_DEFINES;goog.global.CLOSURE_DEFINES;goog.isDef=function(a){return a!==void 0};goog.exportPath_=function(c,a,f){var d=c.split(".");var e=f||goog.global;if(!(d[0] in e)&&e.execScript){e.execScript("var "+d[0])}for(var b;d.length&&(b=d.shift());){if(!d.length&&goog.isDef(a)){e[b]=a}else{if(e[b]){e=e[b]}else{e=e[b]={}}}}};goog.define=function(b,a){var c=a;if(!COMPILED){if(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,b)){c=goog.global.CLOSURE_UNCOMPILED_DEFINES[b]}else{if(goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,b)){c=goog.global.CLOSURE_DEFINES[b]}}}goog.exportPath_(b,c)};goog.DEBUG=true;goog.define("goog.LOCALE","en");goog.define("goog.TRUSTED_SITE",true);goog.define("goog.STRICT_MODE_COMPATIBLE",false);goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG);goog.provide=function(a){if(!COMPILED){if(goog.isProvided_(a)){throw Error('Namespace "'+a+'" already declared.')}}goog.constructNamespace_(a)};goog.constructNamespace_=function(a,c){if(!COMPILED){delete goog.implicitNamespaces_[a];var b=a;while((b=b.substring(0,b.lastIndexOf(".")))){if(goog.getObjectByName(b)){break}goog.implicitNamespaces_[b]=true}}goog.exportPath_(a,c)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;goog.module=function(a){if(!goog.isString(a)||!a||a.search(goog.VALID_MODULE_RE_)==-1){throw Error("Invalid module identifier")}if(!goog.isInModuleLoader_()){throw Error("Module "+a+" has been loaded incorrectly.")}if(goog.moduleLoaderState_.moduleName){throw Error("goog.module may only be called once per module.")}goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a)){throw Error('Namespace "'+a+'" already declared.')}delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};goog.module.getInternal_=function(a){if(!COMPILED){if(goog.isProvided_(a)){return a in goog.loadedModules_?goog.loadedModules_[a]:goog.getObjectByName(a)}else{return null}}};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return goog.moduleLoaderState_!=null};goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_()){throw new Error("goog.module.declareTestMethods must be called from within a goog.module")}goog.moduleLoaderState_.declareTestMethods=true};goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_()){throw new Error("goog.module.declareLegacyNamespace must be called from within a goog.module")}if(!COMPILED&&!goog.moduleLoaderState_.moduleName){throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.")}goog.moduleLoaderState_.declareLegacyNamespace=true};goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE){a=a||"";throw Error("Importing test-only code into non-debug environment"+(a?": "+a:"."))}};goog.forwardDeclare=function(a){};if(!COMPILED){goog.isProvided_=function(a){return(a in goog.loadedModules_)||(!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a)))};goog.implicitNamespaces_={"goog.module":true}}goog.getObjectByName=function(b,c){var d=b.split(".");var e=c||goog.global;for(var a;a=d.shift();){if(goog.isDefAndNotNull(e[a])){e=e[a]}else{return null}}return e};goog.globalize=function(d,b){var c=b||goog.global;for(var a in d){c[a]=d[a]}};goog.addDependency=function(f,e,l,d){if(goog.DEPENDENCIES_ENABLED){var g,a;var k=f.replace(/\\/g,"/");var h=goog.dependencies_;for(var c=0;g=e[c];c++){h.nameToPath[g]=k;h.pathIsModule[k]=!!d}for(var b=0;a=l[b];b++){if(!(k in h.requires)){h.requires[k]={}}h.requires[k][a]=true}}};goog.define("goog.ENABLE_DEBUG_LOADER",true);goog.logToConsole_=function(a){if(goog.global.console){goog.global.console.error(a)}};goog.require=function(b){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_){goog.maybeProcessDeferredDep_(b)}if(goog.isProvided_(b)){if(goog.isInModuleLoader_()){return goog.module.getInternal_(b)}else{return null}}if(goog.ENABLE_DEBUG_LOADER){var c=goog.getPathFromDeps_(b);if(c){goog.included_[c]=true;goog.writeScripts_();return null}}var a="goog.require could not find: "+b;goog.logToConsole_(a);throw Error(a)}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};goog.identityFunction=function(b,a){return b};goog.abstractMethod=function(){throw Error("unimplemented abstract method")};goog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_){return a.instance_}if(goog.DEBUG){goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a}return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.define("goog.LOAD_MODULE_USING_EVAL",true);goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG);goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;if(goog.DEPENDENCIES_ENABLED){goog.included_={};goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}};goog.inHtmlDocument_=function(){var a=goog.global.document;return typeof a!="undefined"&&"write" in a};goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else{if(!goog.inHtmlDocument_()){return}}var f=goog.global.document;var a=f.getElementsByTagName("script");for(var d=a.length-1;d>=0;--d){var c=(a[d]);var g=c.src;var e=g.lastIndexOf("?");var b=e==-1?g.length:e;if(g.substr(b-7,7)=="base.js"){goog.basePath=g.substr(0,b-7);return}}};goog.importScript_=function(c,a){var b=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;if(b(c,a)){goog.dependencies_.written[c]=true}};goog.IS_OLD_IE_=goog.global.document&&goog.global.document.all&&!goog.global.atob;goog.importModule_=function(b){var a='goog.retrieveAndExecModule_("'+b+'");';if(goog.importScript_("",a)){goog.dependencies_.written[b]=true}};goog.queuedModules_=[];goog.wrapModule_=function(b,a){if(!goog.LOAD_MODULE_USING_EVAL||!goog.isDef(goog.global.JSON)){return'goog.loadModule(function(exports) {"use strict";'+a+"\n;return exports});\n//# sourceURL="+b+"\n"}else{return"goog.loadModule("+goog.global.JSON.stringify(a+"\n//# sourceURL="+b+"\n")+");"}};goog.loadQueuedModules_=function(){var c=goog.queuedModules_.length;if(c>0){var a=goog.queuedModules_;goog.queuedModules_=[];for(var b=0;b<c;b++){var d=a[b];goog.maybeProcessDeferredPath_(d)}}};goog.maybeProcessDeferredDep_=function(a){if(goog.isDeferredModule_(a)&&goog.allDepsAreAvailable_(a)){var b=goog.getPathFromDeps_(a);goog.maybeProcessDeferredPath_(goog.basePath+b)}};goog.isDeferredModule_=function(a){var c=goog.getPathFromDeps_(a);if(c&&goog.dependencies_.pathIsModule[c]){var b=goog.basePath+c;return(b) in goog.dependencies_.deferred}return false};goog.allDepsAreAvailable_=function(a){var b=goog.getPathFromDeps_(a);if(b&&(b in goog.dependencies_.requires)){for(var c in goog.dependencies_.requires[b]){if(!goog.isProvided_(c)&&!goog.isDeferredModule_(c)){return false}}}return true};goog.maybeProcessDeferredPath_=function(a){if(a in goog.dependencies_.deferred){var b=goog.dependencies_.deferred[a];delete goog.dependencies_.deferred[a];goog.globalEval(b)}};goog.loadModule=function(d){var a=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:undefined,declareTestMethods:false};var b;if(goog.isFunction(d)){b=d.call(goog.global,{})}else{if(goog.isString(d)){b=goog.loadModuleFromSource_.call(goog.global,d)}else{throw Error("Invalid module definition")}}var c=goog.moduleLoaderState_.moduleName;if(!goog.isString(c)||!c){throw Error('Invalid module name "'+c+'"')}if(goog.moduleLoaderState_.declareLegacyNamespace){goog.constructNamespace_(c,b)}else{if(goog.SEAL_MODULE_EXPORTS&&Object.seal){Object.seal(b)}}goog.loadedModules_[c]=b;if(goog.moduleLoaderState_.declareTestMethods){for(var e in b){if(e.indexOf("test",0)===0||e=="tearDown"||e=="setUp"||e=="setUpPage"||e=="tearDownPage"){goog.global[e]=b[e]}}}}finally{goog.moduleLoaderState_=a}};goog.loadModuleFromSource_=function(source){var exports={};eval(arguments[0]);return exports};goog.writeScriptTag_=function(e,b){if(goog.inHtmlDocument_()){var c=goog.global.document;if(c.readyState=="complete"){var f=/\bdeps.js$/.test(e);if(f){return false}else{throw Error('Cannot write "'+e+'" after document load')}}var d=goog.IS_OLD_IE_;if(b===undefined){if(!d){c.write('<script type="text/javascript" src="'+e+'"><\/script>')}else{var a=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";c.write('<script type="text/javascript" src="'+e+'"'+a+"><\/script>")}}else{c.write('<script type="text/javascript">'+b+"<\/script>")}return true}else{return false}};goog.lastNonModuleScriptIndex_=0;goog.onScriptLoad_=function(a,b){if(a.readyState=="complete"&&goog.lastNonModuleScriptIndex_==b){goog.loadQueuedModules_()}return true};goog.writeScripts_=function(){var a=[];var b={};var g=goog.dependencies_;function e(i){if(i in g.written){return}if(i in g.visited){if(!(i in b)){b[i]=true;a.push(i)}return}g.visited[i]=true;if(i in g.requires){for(var j in g.requires[i]){if(!goog.isProvided_(j)){if(j in g.nameToPath){e(g.nameToPath[j])}else{throw Error("Undefined nameToPath for "+j)}}}}if(!(i in b)){b[i]=true;a.push(i)}}for(var d in goog.included_){if(!g.written[d]){e(d)}}for(var c=0;c<a.length;c++){var d=a[c];goog.dependencies_.written[d]=true}var h=goog.moduleLoaderState_;goog.moduleLoaderState_=null;var f=false;for(var c=0;c<a.length;c++){var d=a[c];if(d){if(!g.pathIsModule[d]){goog.importScript_(goog.basePath+d)}else{f=true;goog.importModule_(goog.basePath+d)}}else{goog.moduleLoaderState_=h;throw Error("Undefined script input")}}goog.moduleLoaderState_=h};goog.getPathFromDeps_=function(a){if(a in goog.dependencies_.nameToPath){return goog.dependencies_.nameToPath[a]}else{return null}};goog.findBasePath_();if(!goog.global.CLOSURE_NO_DEPS){goog.importScript_(goog.basePath+"deps.js")}}goog.normalizePath_=function(c){var b=c.split("/");var a=0;while(a<b.length){if(b[a]=="."){b.splice(a,1)}else{if(a&&b[a]==".."&&b[a-1]&&b[a-1]!=".."){b.splice(--a,2)}else{a++}}}return b.join("/")};goog.retrieveAndExecModule_=function(g){if(!COMPILED){var d=g;g=goog.normalizePath_(g);var c=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;var b=null;var f=new goog.global.XMLHttpRequest();f.onload=function(){b=this.responseText};f.open("get",g,false);f.send();b=f.responseText;if(b!=null){var a=goog.wrapModule_(g,b);var e=goog.IS_OLD_IE_;if(e){goog.dependencies_.deferred[d]=a;goog.queuedModules_.push(d)}else{c(g,a)}}else{throw new Error("load of "+g+"failed")}}};goog.typeOf=function(c){var b=typeof c;if(b=="object"){if(c){if(c instanceof Array){return"array"}else{if(c instanceof Object){return b}}var a=Object.prototype.toString.call((c));if(a=="[object Window]"){return"object"}if((a=="[object Array]"||typeof c.length=="number"&&typeof c.splice!="undefined"&&typeof c.propertyIsEnumerable!="undefined"&&!c.propertyIsEnumerable("splice"))){return"array"}if((a=="[object Function]"||typeof c.call!="undefined"&&typeof c.propertyIsEnumerable!="undefined"&&!c.propertyIsEnumerable("call"))){return"function"}}else{return"null"}}else{if(b=="function"&&typeof c.call=="undefined"){return"object"}}return b};goog.isNull=function(a){return a===null};goog.isDefAndNotNull=function(a){return a!=null};goog.isArray=function(a){return goog.typeOf(a)=="array"};goog.isArrayLike=function(b){var a=goog.typeOf(b);return a=="array"||a=="object"&&typeof b.length=="number"};goog.isDateLike=function(a){return goog.isObject(a)&&typeof a.getFullYear=="function"};goog.isString=function(a){return typeof a=="string"};goog.isBoolean=function(a){return typeof a=="boolean"};goog.isNumber=function(a){return typeof a=="number"};goog.isFunction=function(a){return goog.typeOf(a)=="function"};goog.isObject=function(b){var a=typeof b;return a=="object"&&b!=null||a=="function"};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return !!a[goog.UID_PROPERTY_]};goog.removeUid=function(b){if("removeAttribute" in b){b.removeAttribute(goog.UID_PROPERTY_)}try{delete b[goog.UID_PROPERTY_]}catch(a){}};goog.UID_PROPERTY_="closure_uid_"+((Math.random()*1000000000)>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(c){var b=goog.typeOf(c);if(b=="object"||b=="array"){if(c.clone){return c.clone()}var d=b=="array"?[]:{};for(var a in c){d[a]=goog.cloneObject(c[a])}return d}return c};goog.bindNative_=function(a,c,b){return(a.call.apply(a.bind,arguments))};goog.bindJs_=function(a,d,b){if(!a){throw new Error()}if(arguments.length>2){var c=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,c);return a.apply(d,e)}}else{return function(){return a.apply(d,arguments)}}};goog.bind=function(a,c,b){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1){goog.bind=goog.bindNative_}else{goog.bind=goog.bindJs_}return goog.bind.apply(null,arguments)};goog.partial=function(b,c){var a=Array.prototype.slice.call(arguments,1);return function(){var d=a.slice();d.push.apply(d,arguments);return b.apply(this,d)}};goog.mixin=function(c,b){for(var a in b){c[a]=b[a]}};goog.now=(goog.TRUSTED_SITE&&Date.now)||(function(){return +new Date()});goog.globalEval=function(script){if(goog.global.execScript){goog.global.execScript(script,"JavaScript")}else{if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval("var _et_ = 1;");if(typeof goog.global._et_!="undefined"){delete goog.global._et_;goog.evalWorksForGlobals_=true}else{goog.evalWorksForGlobals_=false}}if(goog.evalWorksForGlobals_){goog.global.eval(script)}else{var doc=goog.global.document;var scriptElt=doc.createElement("script");scriptElt.type="text/javascript";scriptElt.defer=false;scriptElt.appendChild(doc.createTextNode(script));doc.body.appendChild(scriptElt);doc.body.removeChild(scriptElt)}}else{throw Error("goog.globalEval not available")}}};goog.evalWorksForGlobals_=null;goog.cssNameMapping_;goog.cssNameMappingStyle_;goog.getCssName=function(e,c){var d=function(f){return goog.cssNameMapping_[f]||f};var b=function(j){var h=j.split("-");var f=[];for(var g=0;g<h.length;g++){f.push(d(h[g]))}return f.join("-")};var a;if(goog.cssNameMapping_){a=goog.cssNameMappingStyle_=="BY_WHOLE"?d:b}else{a=function(f){return f}}if(c){return e+"-"+a(c)}else{return a(e)}};goog.setCssNameMapping=function(b,a){goog.cssNameMapping_=b;goog.cssNameMappingStyle_=a};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING){goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING}goog.getMsg=function(a,b){if(b){a=a.replace(/\{\$([^}]+)}/g,function(c,d){return d in b?b[d]:c})}return a};goog.getMsgWithFallback=function(d,c){return d};goog.exportSymbol=function(b,a,c){goog.exportPath_(b,a,c)};goog.exportProperty=function(b,a,c){b[a]=c};goog.inherits=function(b,a){function c(){}c.prototype=a.prototype;b.superClass_=a.prototype;b.prototype=new c();b.prototype.constructor=b;b.base=function(g,d,h){var e=new Array(arguments.length-2);for(var f=2;f<arguments.length;f++){e[f-2]=arguments[f]}return a.prototype[d].apply(g,e)}};goog.base=function(g,c,j){var a=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||(goog.DEBUG&&!a)){throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C")}if(a.superClass_){var b=new Array(arguments.length-1);for(var e=1;e<arguments.length;e++){b[e-1]=arguments[e]}return a.superClass_.constructor.apply(g,b)}var f=new Array(arguments.length-2);for(var e=2;e<arguments.length;e++){f[e-2]=arguments[e]}var d=false;for(var h=g.constructor;h;h=h.superClass_&&h.superClass_.constructor){if(h.prototype[c]===a){d=true}else{if(d){return h.prototype[c].apply(g,f)}}}if(g[c]===a){return g.constructor.prototype[c].apply(g,f)}else{throw Error("goog.base called from a method of one name to a method of a different name")}};goog.scope=function(a){a.call(goog.global)};if(!COMPILED){goog.global.COMPILED=COMPILED}goog.defineClass=function(c,d){var b=d.constructor;var e=d.statics;if(!b||b==Object.prototype.constructor){b=function(){throw Error("cannot instantiate an interface (no constructor defined).")}}var a=goog.defineClass.createSealingConstructor_(b,c);if(c){goog.inherits(a,c)}delete d.constructor;delete d.statics;goog.defineClass.applyProperties_(a.prototype,d);if(e!=null){if(e instanceof Function){e(a)}else{goog.defineClass.applyProperties_(a,e)}}return a};goog.defineClass.ClassDescriptor;goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG);goog.defineClass.createSealingConstructor_=function(c,b){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(b&&b.prototype&&b.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]){return c}var a=function(){var d=c.apply(this,arguments)||this;d[goog.UID_PROPERTY_]=d[goog.UID_PROPERTY_];if(this.constructor===a){Object.seal(d)}return d};return a}return c};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.defineClass.applyProperties_=function(d,c){var b;for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){d[b]=c[b]}}for(var a=0;a<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;a++){b=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[a];if(Object.prototype.hasOwnProperty.call(c,b)){d[b]=c[b]}}};goog.tagUnsealableClass=function(a){if(!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES){a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=true}};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";goog.DEBUG=false;goog.inherits=function(b,a){function c(){}c.prototype=a.prototype;b.superClass_=a.prototype;b.prototype=new c();b.prototype.constructor=b;b.base=function(f,d,g){var e=Array.prototype.slice.call(arguments,2);return a.prototype[d].apply(f,e)}};if(!goog.userAgent){goog.userAgent=(function(){var b="";if("undefined"!==typeof navigator&&navigator&&"string"==typeof navigator.userAgent){b=navigator.userAgent}var a=b.indexOf("Opera")==0;return{jscript:{HAS_JSCRIPT:"ScriptEngine" in this},OPERA:a,IE:!a&&b.indexOf("MSIE")!=-1,WEBKIT:!a&&b.indexOf("WebKit")!=-1}})()}if(!goog.asserts){goog.asserts={assert:function(a){if(!a){throw Error("Assertion error")}},fail:function(a){}}}if(!goog.dom){goog.dom={};goog.dom.DomHelper=function(a){this.document_=a||document};goog.dom.DomHelper.prototype.getDocument=function(){return this.document_};goog.dom.DomHelper.prototype.createElement=function(a){return this.document_.createElement(a)};goog.dom.DomHelper.prototype.createDocumentFragment=function(){return this.document_.createDocumentFragment()}}if(!goog.format){goog.format={insertWordBreaks:function(j,a){j=String(j);var f=[];var h=0;var b=false;var k=false;var g=0;var d=0;for(var e=0,c=j.length;e<c;++e){var l=j.charCodeAt(e);if(g>=a&&l!=32){f[h++]=j.substring(d,e);d=e;f[h++]=goog.format.WORD_BREAK;g=0}if(b){if(l==62){b=false}}else{if(k){switch(l){case 59:k=false;++g;break;case 60:k=false;b=true;break;case 32:k=false;g=0;break}}else{switch(l){case 60:b=true;break;case 38:k=true;break;case 32:g=0;break;default:++g;break}}}}f[h++]=j.substring(d);return f.join("")},WORD_BREAK:goog.userAgent.WEBKIT?"<wbr></wbr>":goog.userAgent.OPERA?"&shy;":goog.userAgent.IE?"&#8203;":"<wbr>"}}if(!goog.i18n){goog.i18n={bidi:{}}}goog.i18n.bidi.IS_RTL=false;goog.i18n.bidi.Dir={LTR:1,RTL:-1,NEUTRAL:0,UNKNOWN:0};goog.i18n.bidi.toDir=function(b,a){if(typeof b=="number"){return b>0?goog.i18n.bidi.Dir.LTR:b<0?goog.i18n.bidi.Dir.RTL:a?null:goog.i18n.bidi.Dir.NEUTRAL}else{if(b==null){return null}else{return b?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR}}};goog.i18n.bidi.estimateDirection=function(h,c){var d=0;var a=0;var b=false;var g=soyshim.$$bidiStripHtmlIfNecessary_(h,c).split(soyshim.$$bidiWordSeparatorRe_);for(var f=0;f<g.length;f++){var e=g[f];if(soyshim.$$bidiRtlDirCheckRe_.test(e)){d++;a++}else{if(soyshim.$$bidiIsRequiredLtrRe_.test(e)){b=true}else{if(soyshim.$$bidiLtrCharRe_.test(e)){a++}else{if(soyshim.$$bidiHasNumeralsRe_.test(e)){b=true}}}}}return a==0?(b?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.NEUTRAL):(d/a>soyshim.$$bidiRtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR)};goog.i18n.BidiFormatter=function(a){this.dir_=goog.i18n.bidi.toDir(a,true)};goog.i18n.BidiFormatter.prototype.getContextDir=function(){return this.dir_};goog.i18n.BidiFormatter.prototype.knownDirAttr=function(a){return !a||a==this.dir_?"":a<0?'dir="rtl"':'dir="ltr"'};goog.i18n.BidiFormatter.prototype.endEdge=function(){return this.dir_<0?"left":"right"};goog.i18n.BidiFormatter.prototype.mark=function(){return((this.dir_>0)?"\u200E":(this.dir_<0)?"\u200F":"")};goog.i18n.BidiFormatter.prototype.markAfterKnownDir=function(b,c,a){if(b==null){b=goog.i18n.bidi.estimateDirection(c,a)}return(this.dir_>0&&(b<0||soyshim.$$bidiIsRtlExitText_(c,a))?"\u200E":this.dir_<0&&(b>0||soyshim.$$bidiIsLtrExitText_(c,a))?"\u200F":"")};goog.i18n.BidiFormatter.prototype.spanWrapWithKnownDir=function(b,d,c){if(b==null){b=goog.i18n.bidi.estimateDirection(d,true)}var a=this.markAfterKnownDir(b,d,true);if(b>0&&this.dir_<=0){d='<span dir="ltr">'+d+"</span>"}else{if(b<0&&this.dir_>=0){d='<span dir="rtl">'+d+"</span>"}}return d+a};goog.i18n.BidiFormatter.prototype.startEdge=function(){return this.dir_<0?"right":"left"};goog.i18n.BidiFormatter.prototype.unicodeWrapWithKnownDir=function(c,d,a){if(c==null){c=goog.i18n.bidi.estimateDirection(d,a)}var b=this.markAfterKnownDir(c,d,a);if(c>0&&this.dir_<=0){d="\u202A"+d+"\u202C"}else{if(c<0&&this.dir_>=0){d="\u202B"+d+"\u202C"}}return d+b};if(!goog.string){goog.string={newLineToBr:function(b,a){b=String(b);if(!goog.string.NEWLINE_TO_BR_RE_.test(b)){return b}return b.replace(/(\r\n|\r|\n)/g,a?"<br />":"<br>")},urlEncode:encodeURIComponent,NEWLINE_TO_BR_RE_:/[\r\n]/}}goog.string.StringBuffer=function(a,b){this.buffer_=goog.userAgent.jscript.HAS_JSCRIPT?[]:"";if(a!=null){this.append.apply(this,arguments)}};goog.string.StringBuffer.prototype.bufferLength_=0;goog.string.StringBuffer.prototype.append=function(c,b,e){if(goog.userAgent.jscript.HAS_JSCRIPT){if(b==null){this.buffer_[this.bufferLength_++]=c}else{var a=(this.buffer_);a.push.apply(a,arguments);this.bufferLength_=this.buffer_.length}}else{this.buffer_+=c;if(b!=null){for(var d=1;d<arguments.length;d++){this.buffer_+=arguments[d]}}}return this};goog.string.StringBuffer.prototype.clear=function(){if(goog.userAgent.jscript.HAS_JSCRIPT){this.buffer_.length=0;this.bufferLength_=0}else{this.buffer_=""}};goog.string.StringBuffer.prototype.toString=function(){if(goog.userAgent.jscript.HAS_JSCRIPT){var a=this.buffer_.join("");this.clear();if(a){this.append(a)}return a}else{return(this.buffer_)}};if(!goog.soy){goog.soy={renderAsElement:function(c,a,b,d){return(soyshim.$$renderWithWrapper_(c,a,d,true,b))},renderAsFragment:function(c,a,b,d){return soyshim.$$renderWithWrapper_(c,a,d,false,b)},renderElement:function(c,d,a,b){c.innerHTML=d(a,null,b)},data:{}}}goog.soy.data.SanitizedContentKind={HTML:goog.DEBUG?{sanitizedContentKindHtml:true}:{},JS:goog.DEBUG?{sanitizedContentJsChars:true}:{},JS_STR_CHARS:goog.DEBUG?{sanitizedContentJsStrChars:true}:{},URI:goog.DEBUG?{sanitizedContentUri:true}:{},ATTRIBUTES:goog.DEBUG?{sanitizedContentHtmlAttribute:true}:{},CSS:goog.DEBUG?{sanitizedContentCss:true}:{},TEXT:goog.DEBUG?{sanitizedContentKindText:true}:{}};goog.soy.data.SanitizedContent=function(){throw Error("Do not instantiate directly")};goog.soy.data.SanitizedContent.prototype.contentKind;goog.soy.data.SanitizedContent.prototype.contentDir=null;goog.soy.data.SanitizedContent.prototype.content;goog.soy.data.SanitizedContent.prototype.toString=function(){return this.content};var soy={esc:{}};var soydata={};soydata.VERY_UNSAFE={};var soyshim={$$DEFAULT_TEMPLATE_DATA_:{}};soyshim.$$renderWithWrapper_=function(h,f,b,c,i){var d=b||document;var a=d.createElement("div");a.innerHTML=h(f||soyshim.$$DEFAULT_TEMPLATE_DATA_,undefined,i);if(a.childNodes.length==1){var g=a.firstChild;if(!c||g.nodeType==1){return(g)}}if(c){return a}var e=d.createDocumentFragment();while(a.firstChild){e.appendChild(a.firstChild)}return e};soyshim.$$bidiStripHtmlIfNecessary_=function(b,a){return a?b.replace(soyshim.$$BIDI_HTML_SKIP_RE_,""):b};soyshim.$$BIDI_HTML_SKIP_RE_=/<[^>]*>|&[^;]+;/g;soyshim.$$bidiLtrChars_="A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02B8\u0300-\u0590\u0800-\u1FFF\u200E\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF";soyshim.$$bidiRtlChars_="\u0591-\u07FF\u200F\uFB1D-\uFDFF\uFE70-\uFEFC";soyshim.$$bidiRtlDirCheckRe_=new RegExp("^[^"+soyshim.$$bidiLtrChars_+"]*["+soyshim.$$bidiRtlChars_+"]");soyshim.$$bidiLtrCharRe_=new RegExp("["+soyshim.$$bidiLtrChars_+"]");soyshim.$$bidiIsRequiredLtrRe_=/^http:\/\/.*/;soyshim.$$bidiHasNumeralsRe_=/\d/;soyshim.$$bidiWordSeparatorRe_=/\s+/;soyshim.$$bidiRtlDetectionThreshold_=0.4;soyshim.$$bidiLtrExitDirCheckRe_=new RegExp("["+soyshim.$$bidiLtrChars_+"][^"+soyshim.$$bidiRtlChars_+"]*$");soyshim.$$bidiRtlExitDirCheckRe_=new RegExp("["+soyshim.$$bidiRtlChars_+"][^"+soyshim.$$bidiLtrChars_+"]*$");soyshim.$$bidiIsLtrExitText_=function(b,a){b=soyshim.$$bidiStripHtmlIfNecessary_(b,a);return soyshim.$$bidiLtrExitDirCheckRe_.test(b)};soyshim.$$bidiIsRtlExitText_=function(b,a){b=soyshim.$$bidiStripHtmlIfNecessary_(b,a);return soyshim.$$bidiRtlExitDirCheckRe_.test(b)};soy.StringBuilder=goog.string.StringBuffer;soydata.SanitizedContentKind=goog.soy.data.SanitizedContentKind;soydata.isContentKind=function(a,b){return a!=null&&a.contentKind===b};soydata.getContentDir=function(a){if(a!=null){switch(a.contentDir){case goog.i18n.bidi.Dir.LTR:return goog.i18n.bidi.Dir.LTR;case goog.i18n.bidi.Dir.RTL:return goog.i18n.bidi.Dir.RTL;case goog.i18n.bidi.Dir.NEUTRAL:return goog.i18n.bidi.Dir.NEUTRAL}}return null};soydata.SanitizedHtml=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedHtml,goog.soy.data.SanitizedContent);soydata.SanitizedHtml.prototype.contentKind=soydata.SanitizedContentKind.HTML;soydata.SanitizedHtml.from=function(a){if(a!=null&&a.contentKind===soydata.SanitizedContentKind.HTML){goog.asserts.assert(a.constructor===soydata.SanitizedHtml);return(a)}return soydata.VERY_UNSAFE.ordainSanitizedHtml(soy.esc.$$escapeHtmlHelper(String(a)),soydata.getContentDir(a))};soydata.SanitizedJs=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedJs,goog.soy.data.SanitizedContent);soydata.SanitizedJs.prototype.contentKind=soydata.SanitizedContentKind.JS;soydata.SanitizedJs.prototype.contentDir=goog.i18n.bidi.Dir.LTR;soydata.SanitizedJsStrChars=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedJsStrChars,goog.soy.data.SanitizedContent);soydata.SanitizedJsStrChars.prototype.contentKind=soydata.SanitizedContentKind.JS_STR_CHARS;soydata.SanitizedUri=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedUri,goog.soy.data.SanitizedContent);soydata.SanitizedUri.prototype.contentKind=soydata.SanitizedContentKind.URI;soydata.SanitizedUri.prototype.contentDir=goog.i18n.bidi.Dir.LTR;soydata.SanitizedHtmlAttribute=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedHtmlAttribute,goog.soy.data.SanitizedContent);soydata.SanitizedHtmlAttribute.prototype.contentKind=soydata.SanitizedContentKind.ATTRIBUTES;soydata.SanitizedHtmlAttribute.prototype.contentDir=goog.i18n.bidi.Dir.LTR;soydata.SanitizedCss=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedCss,goog.soy.data.SanitizedContent);soydata.SanitizedCss.prototype.contentKind=soydata.SanitizedContentKind.CSS;soydata.SanitizedCss.prototype.contentDir=goog.i18n.bidi.Dir.LTR;soydata.UnsanitizedText=function(a,b){this.content=String(a);this.contentDir=b!=null?b:null};goog.inherits(soydata.UnsanitizedText,goog.soy.data.SanitizedContent);soydata.UnsanitizedText.prototype.contentKind=soydata.SanitizedContentKind.TEXT;soydata.$$EMPTY_STRING_={VALUE:""};soydata.$$makeSanitizedContentFactory_=function(b){function a(){}a.prototype=b.prototype;function c(e,f){var d=new a();d.content=String(e);if(f!==undefined){d.contentDir=f}return d}return c};soydata.$$makeSanitizedContentFactoryWithDefaultDirOnly_=function(b){function a(){}a.prototype=b.prototype;function c(e){var d=new a();d.content=String(e);return d}return c};soydata.markUnsanitizedText=function(a,b){return new soydata.UnsanitizedText(a,b)};soydata.VERY_UNSAFE.ordainSanitizedHtml=soydata.$$makeSanitizedContentFactory_(soydata.SanitizedHtml);soydata.VERY_UNSAFE.ordainSanitizedJs=soydata.$$makeSanitizedContentFactoryWithDefaultDirOnly_(soydata.SanitizedJs);soydata.VERY_UNSAFE.ordainSanitizedJsStrChars=soydata.$$makeSanitizedContentFactory_(soydata.SanitizedJsStrChars);soydata.VERY_UNSAFE.ordainSanitizedUri=soydata.$$makeSanitizedContentFactoryWithDefaultDirOnly_(soydata.SanitizedUri);soydata.VERY_UNSAFE.ordainSanitizedHtmlAttribute=soydata.$$makeSanitizedContentFactoryWithDefaultDirOnly_(soydata.SanitizedHtmlAttribute);soydata.VERY_UNSAFE.ordainSanitizedCss=soydata.$$makeSanitizedContentFactoryWithDefaultDirOnly_(soydata.SanitizedCss);soy.renderElement=goog.soy.renderElement;soy.renderAsFragment=function(d,b,a,c){return goog.soy.renderAsFragment(d,b,c,new goog.dom.DomHelper(a))};soy.renderAsElement=function(d,b,a,c){return goog.soy.renderAsElement(d,b,c,new goog.dom.DomHelper(a))};soy.$$IS_LOCALE_RTL=goog.i18n.bidi.IS_RTL;soy.$$augmentMap=function(a,d){function e(){}e.prototype=a;var b=new e();for(var c in d){b[c]=d[c]}return b};soy.$$checkMapKey=function(a){if((typeof a)!="string"){throw Error("Map literal's key expression must evaluate to string (encountered type \""+(typeof a)+'").')}return a};soy.$$getMapKeys=function(c){var b=[];for(var a in c){b.push(a)}return b};soy.$$getDelTemplateId=function(a){return a};soy.$$DELEGATE_REGISTRY_PRIORITIES_={};soy.$$DELEGATE_REGISTRY_FUNCTIONS_={};soy.$$registerDelegateFn=function(f,c,d,b){var e="key_"+f+":"+c;var a=soy.$$DELEGATE_REGISTRY_PRIORITIES_[e];if(a===undefined||d>a){soy.$$DELEGATE_REGISTRY_PRIORITIES_[e]=d;soy.$$DELEGATE_REGISTRY_FUNCTIONS_[e]=b}else{if(d==a){throw Error('Encountered two active delegates with the same priority ("'+f+":"+c+'").')}else{}}};soy.$$getDelegateFn=function(c,b,d){var a=soy.$$DELEGATE_REGISTRY_FUNCTIONS_["key_"+c+":"+b];if(!a&&b!=""){a=soy.$$DELEGATE_REGISTRY_FUNCTIONS_["key_"+c+":"]}if(a){return a}else{if(d){return soy.$$EMPTY_TEMPLATE_FN_}else{throw Error('Found no active impl for delegate call to "'+c+":"+b+'" (and not allowemptydefault="true").')}}};soy.$$EMPTY_TEMPLATE_FN_=function(a,c,b){return""};soydata.$$makeSanitizedContentFactoryForInternalBlocks_=function(b){function a(){}a.prototype=b.prototype;function c(e,f){var g=String(e);if(!g){return soydata.$$EMPTY_STRING_.VALUE}var d=new a();d.content=String(e);if(f!==undefined){d.contentDir=f}return d}return c};soydata.$$makeSanitizedContentFactoryWithDefaultDirOnlyForInternalBlocks_=function(b){function a(){}a.prototype=b.prototype;function c(e){var f=String(e);if(!f){return soydata.$$EMPTY_STRING_.VALUE}var d=new a();d.content=String(e);return d}return c};soydata.$$markUnsanitizedTextForInternalBlocks=function(a,b){var c=String(a);if(!c){return soydata.$$EMPTY_STRING_.VALUE}return new soydata.UnsanitizedText(c,b)};soydata.VERY_UNSAFE.$$ordainSanitizedHtmlForInternalBlocks=soydata.$$makeSanitizedContentFactoryForInternalBlocks_(soydata.SanitizedHtml);soydata.VERY_UNSAFE.$$ordainSanitizedJsForInternalBlocks=soydata.$$makeSanitizedContentFactoryWithDefaultDirOnlyForInternalBlocks_(soydata.SanitizedJs);soydata.VERY_UNSAFE.$$ordainSanitizedUriForInternalBlocks=soydata.$$makeSanitizedContentFactoryWithDefaultDirOnlyForInternalBlocks_(soydata.SanitizedUri);soydata.VERY_UNSAFE.$$ordainSanitizedAttributesForInternalBlocks=soydata.$$makeSanitizedContentFactoryWithDefaultDirOnlyForInternalBlocks_(soydata.SanitizedHtmlAttribute);soydata.VERY_UNSAFE.$$ordainSanitizedCssForInternalBlocks=soydata.$$makeSanitizedContentFactoryWithDefaultDirOnlyForInternalBlocks_(soydata.SanitizedCss);soy.$$escapeHtml=function(a){return soydata.SanitizedHtml.from(a)};soy.$$cleanHtml=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.HTML)){goog.asserts.assert(a.constructor===soydata.SanitizedHtml);return(a)}return soydata.VERY_UNSAFE.ordainSanitizedHtml(soy.$$stripHtmlTags(a,soy.esc.$$SAFE_TAG_WHITELIST_),soydata.getContentDir(a))};soy.$$escapeHtmlRcdata=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.HTML)){goog.asserts.assert(a.constructor===soydata.SanitizedHtml);return soy.esc.$$normalizeHtmlHelper(a.content)}return soy.esc.$$escapeHtmlHelper(a)};soy.$$HTML5_VOID_ELEMENTS_=new RegExp("^<(?:area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)\\b");soy.$$stripHtmlTags=function(d,c){if(!c){return String(d).replace(soy.esc.$$HTML_TAG_REGEX_,"").replace(soy.esc.$$LT_REGEX_,"&lt;")}var b=String(d).replace(/\[/g,"&#91;");var a=[];b=b.replace(soy.esc.$$HTML_TAG_REGEX_,function(f,h){if(h){h=h.toLowerCase();if(c.hasOwnProperty(h)&&c[h]){var i=f.charAt(1)==="/"?"</":"<";var g=a.length;a[g]=i+h+">";return"["+g+"]"}}return""});b=soy.esc.$$normalizeHtmlHelper(b);var e=soy.$$balanceTags_(a);b=b.replace(/\[(\d+)\]/g,function(g,f){return a[f]});return b+e};soy.$$balanceTags_=function(c){var b=[];for(var d=0,f=c.length;d<f;++d){var a=c[d];if(a.charAt(1)==="/"){var e=b.length-1;while(e>=0&&b[e]!=a){e--}if(e<0){c[d]=""}else{c[d]=b.slice(e).reverse().join("");b.length=e}}else{if(!soy.$$HTML5_VOID_ELEMENTS_.test(a)){b.push("</"+a.substring(1))}}}return b.reverse().join("")};soy.$$escapeHtmlAttribute=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.HTML)){goog.asserts.assert(a.constructor===soydata.SanitizedHtml);return soy.esc.$$normalizeHtmlHelper(soy.$$stripHtmlTags(a.content))}return soy.esc.$$escapeHtmlHelper(a)};soy.$$escapeHtmlAttributeNospace=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.HTML)){goog.asserts.assert(a.constructor===soydata.SanitizedHtml);return soy.esc.$$normalizeHtmlNospaceHelper(soy.$$stripHtmlTags(a.content))}return soy.esc.$$escapeHtmlNospaceHelper(a)};soy.$$filterHtmlAttributes=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.ATTRIBUTES)){goog.asserts.assert(a.constructor===soydata.SanitizedHtmlAttribute);return a.content.replace(/([^"'\s])$/,"$1 ")}return soy.esc.$$filterHtmlAttributesHelper(a)};soy.$$filterHtmlElementName=function(a){return soy.esc.$$filterHtmlElementNameHelper(a)};soy.$$escapeJs=function(a){return soy.$$escapeJsString(a)};soy.$$escapeJsString=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.JS_STR_CHARS)){goog.asserts.assert(a.constructor===soydata.SanitizedJsStrChars);return a.content}return soy.esc.$$escapeJsStringHelper(a)};soy.$$escapeJsValue=function(a){if(a==null){return" null "}if(soydata.isContentKind(a,soydata.SanitizedContentKind.JS)){goog.asserts.assert(a.constructor===soydata.SanitizedJs);return a.content}switch(typeof a){case"boolean":case"number":return" "+a+" ";default:return"'"+soy.esc.$$escapeJsStringHelper(String(a))+"'"}};soy.$$escapeJsRegex=function(a){return soy.esc.$$escapeJsRegexHelper(a)};soy.$$problematicUriMarks_=/['()]/g;soy.$$pctEncode_=function(a){return"%"+a.charCodeAt(0).toString(16)};soy.$$escapeUri=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.URI)){goog.asserts.assert(a.constructor===soydata.SanitizedUri);return soy.$$normalizeUri(a)}var b=soy.esc.$$escapeUriHelper(a);soy.$$problematicUriMarks_.lastIndex=0;if(soy.$$problematicUriMarks_.test(b)){return b.replace(soy.$$problematicUriMarks_,soy.$$pctEncode_)}return b};soy.$$normalizeUri=function(a){return soy.esc.$$normalizeUriHelper(a)};soy.$$filterNormalizeUri=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.URI)){goog.asserts.assert(a.constructor===soydata.SanitizedUri);return soy.$$normalizeUri(a)}return soy.esc.$$filterNormalizeUriHelper(a)};soy.$$filterImageDataUri=function(a){return soydata.VERY_UNSAFE.ordainSanitizedUri(soy.esc.$$filterImageDataUriHelper(a))};soy.$$escapeCssString=function(a){return soy.esc.$$escapeCssStringHelper(a)};soy.$$filterCssValue=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.CSS)){goog.asserts.assert(a.constructor===soydata.SanitizedCss);return a.content}if(a==null){return""}return soy.esc.$$filterCssValueHelper(a)};soy.$$filterNoAutoescape=function(a){if(soydata.isContentKind(a,soydata.SanitizedContentKind.TEXT)){goog.asserts.fail("Tainted SanitizedContentKind.TEXT for |noAutoescape: `%s`",[a.content]);return"zSoyz"}return a};soy.$$changeNewlineToBr=function(b){var a=goog.string.newLineToBr(String(b),false);if(soydata.isContentKind(b,soydata.SanitizedContentKind.HTML)){return soydata.VERY_UNSAFE.ordainSanitizedHtml(a,soydata.getContentDir(b))}return a};soy.$$insertWordBreaks=function(c,b){var a=goog.format.insertWordBreaks(String(c),b);if(soydata.isContentKind(c,soydata.SanitizedContentKind.HTML)){return soydata.VERY_UNSAFE.ordainSanitizedHtml(a,soydata.getContentDir(c))}return a};soy.$$truncate=function(c,a,b){c=String(c);if(c.length<=a){return c}if(b){if(a>3){a-=3}else{b=false}}if(soy.$$isHighSurrogate_(c.charAt(a-1))&&soy.$$isLowSurrogate_(c.charAt(a))){a-=1}c=c.substring(0,a);if(b){c+="..."}return c};soy.$$isHighSurrogate_=function(a){return 55296<=a&&a<=56319};soy.$$isLowSurrogate_=function(a){return 56320<=a&&a<=57343};soy.$$bidiFormatterCache_={};soy.$$getBidiFormatterInstance_=function(a){return soy.$$bidiFormatterCache_[a]||(soy.$$bidiFormatterCache_[a]=new goog.i18n.BidiFormatter(a))};soy.$$bidiTextDir=function(d,a){var c=soydata.getContentDir(d);if(c!=null){return c}var b=a||soydata.isContentKind(d,soydata.SanitizedContentKind.HTML);return goog.i18n.bidi.estimateDirection(d+"",b)};soy.$$bidiDirAttr=function(b,f,a){var c=soy.$$getBidiFormatterInstance_(b);var e=soydata.getContentDir(f);if(e==null){var d=a||soydata.isContentKind(f,soydata.SanitizedContentKind.HTML);e=goog.i18n.bidi.estimateDirection(f+"",d)}return soydata.VERY_UNSAFE.ordainSanitizedHtmlAttribute(c.knownDirAttr(e))};soy.$$bidiMarkAfter=function(b,e,a){var c=soy.$$getBidiFormatterInstance_(b);var d=a||soydata.isContentKind(e,soydata.SanitizedContentKind.HTML);return c.markAfterKnownDir(soydata.getContentDir(e),e+"",d)};soy.$$bidiSpanWrap=function(a,d){var c=soy.$$getBidiFormatterInstance_(a);var b=c.spanWrapWithKnownDir(soydata.getContentDir(d),d+"",true);return b};soy.$$bidiUnicodeWrap=function(a,f){var c=soy.$$getBidiFormatterInstance_(a);var d=soydata.isContentKind(f,soydata.SanitizedContentKind.HTML);var b=c.unicodeWrapWithKnownDir(soydata.getContentDir(f),f+"",d);var e=c.getContextDir();if(soydata.isContentKind(f,soydata.SanitizedContentKind.TEXT)){return new soydata.UnsanitizedText(b,e)}if(d){return soydata.VERY_UNSAFE.ordainSanitizedHtml(b,e)}if(soydata.isContentKind(f,soydata.SanitizedContentKind.JS_STR_CHARS)){return soydata.VERY_UNSAFE.ordainSanitizedJsStrChars(b,e)}return b};soy.esc.$$escapeUriHelper=function(a){return encodeURIComponent(String(a))};soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_={"\x00":"\x26#0;","\x22":"\x26quot;","\x26":"\x26amp;","\x27":"\x26#39;","\x3c":"\x26lt;","\x3e":"\x26gt;","\x09":"\x26#9;","\x0a":"\x26#10;","\x0b":"\x26#11;","\x0c":"\x26#12;","\x0d":"\x26#13;"," ":"\x26#32;","-":"\x26#45;","/":"\x26#47;","\x3d":"\x26#61;","`":"\x26#96;","\x85":"\x26#133;","\xa0":"\x26#160;","\u2028":"\x26#8232;","\u2029":"\x26#8233;"};soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_[a]};soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_={"\x00":"\\x00","\x08":"\\x08","\x09":"\\t","\x0a":"\\n","\x0b":"\\x0b","\x0c":"\\f","\x0d":"\\r","\x22":"\\x22","\x26":"\\x26","\x27":"\\x27","/":"\\/","\x3c":"\\x3c","\x3d":"\\x3d","\x3e":"\\x3e","\\":"\\\\","\x85":"\\x85","\u2028":"\\u2028","\u2029":"\\u2029","$":"\\x24","(":"\\x28",")":"\\x29","*":"\\x2a","+":"\\x2b",",":"\\x2c","-":"\\x2d",".":"\\x2e",":":"\\x3a","?":"\\x3f","[":"\\x5b","]":"\\x5d","^":"\\x5e","{":"\\x7b","|":"\\x7c","}":"\\x7d"};soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_[a]};soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_CSS_STRING_={"\x00":"\\0 ","\x08":"\\8 ","\x09":"\\9 ","\x0a":"\\a ","\x0b":"\\b ","\x0c":"\\c ","\x0d":"\\d ","\x22":"\\22 ","\x26":"\\26 ","\x27":"\\27 ","(":"\\28 ",")":"\\29 ","*":"\\2a ","/":"\\2f ",":":"\\3a ",";":"\\3b ","\x3c":"\\3c ","\x3d":"\\3d ","\x3e":"\\3e ","@":"\\40 ","\\":"\\5c ","{":"\\7b ","}":"\\7d ","\x85":"\\85 ","\xa0":"\\a0 ","\u2028":"\\2028 ","\u2029":"\\2029 "};soy.esc.$$REPLACER_FOR_ESCAPE_CSS_STRING_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_CSS_STRING_[a]};soy.esc.$$ESCAPE_MAP_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_={"\x00":"%00","\x01":"%01","\x02":"%02","\x03":"%03","\x04":"%04","\x05":"%05","\x06":"%06","\x07":"%07","\x08":"%08","\x09":"%09","\x0a":"%0A","\x0b":"%0B","\x0c":"%0C","\x0d":"%0D","\x0e":"%0E","\x0f":"%0F","\x10":"%10","\x11":"%11","\x12":"%12","\x13":"%13","\x14":"%14","\x15":"%15","\x16":"%16","\x17":"%17","\x18":"%18","\x19":"%19","\x1a":"%1A","\x1b":"%1B","\x1c":"%1C","\x1d":"%1D","\x1e":"%1E","\x1f":"%1F"," ":"%20","\x22":"%22","\x27":"%27","(":"%28",")":"%29","\x3c":"%3C","\x3e":"%3E","\\":"%5C","{":"%7B","}":"%7D","\x7f":"%7F","\x85":"%C2%85","\xa0":"%C2%A0","\u2028":"%E2%80%A8","\u2029":"%E2%80%A9","\uff01":"%EF%BC%81","\uff03":"%EF%BC%83","\uff04":"%EF%BC%84","\uff06":"%EF%BC%86","\uff07":"%EF%BC%87","\uff08":"%EF%BC%88","\uff09":"%EF%BC%89","\uff0a":"%EF%BC%8A","\uff0b":"%EF%BC%8B","\uff0c":"%EF%BC%8C","\uff0f":"%EF%BC%8F","\uff1a":"%EF%BC%9A","\uff1b":"%EF%BC%9B","\uff1d":"%EF%BC%9D","\uff1f":"%EF%BC%9F","\uff20":"%EF%BC%A0","\uff3b":"%EF%BC%BB","\uff3d":"%EF%BC%BD"};soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_[a]};soy.esc.$$MATCHER_FOR_ESCAPE_HTML_=/[\x00\x22\x26\x27\x3c\x3e]/g;soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_=/[\x00\x22\x27\x3c\x3e]/g;soy.esc.$$MATCHER_FOR_ESCAPE_HTML_NOSPACE_=/[\x00\x09-\x0d \x22\x26\x27\x2d\/\x3c-\x3e`\x85\xa0\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_NOSPACE_=/[\x00\x09-\x0d \x22\x27\x2d\/\x3c-\x3e`\x85\xa0\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_JS_STRING_=/[\x00\x08-\x0d\x22\x26\x27\/\x3c-\x3e\\\x85\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_JS_REGEX_=/[\x00\x08-\x0d\x22\x24\x26-\/\x3a\x3c-\x3f\x5b-\x5e\x7b-\x7d\x85\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_CSS_STRING_=/[\x00\x08-\x0d\x22\x26-\x2a\/\x3a-\x3e@\\\x7b\x7d\x85\xa0\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_=/[\x00- \x22\x27-\x29\x3c\x3e\\\x7b\x7d\x7f\x85\xa0\u2028\u2029\uff01\uff03\uff04\uff06-\uff0c\uff0f\uff1a\uff1b\uff1d\uff1f\uff20\uff3b\uff3d]/g;soy.esc.$$FILTER_FOR_FILTER_CSS_VALUE_=/^(?!-*(?:expression|(?:moz-)?binding))(?:[.#]?-?(?:[_a-z0-9-]+)(?:-[_a-z0-9-]+)*-?|-?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[a-z]{1,2}|%)?|!important|)$/i;soy.esc.$$FILTER_FOR_FILTER_NORMALIZE_URI_=/^(?:(?:https?|mailto):|[^&:\/?#]*(?:[\/?#]|$))/i;soy.esc.$$FILTER_FOR_FILTER_IMAGE_DATA_URI_=/^data:image\/(?:bmp|gif|jpe?g|png|tiff|webp);base64,[a-z0-9+\/]+=*$/i;soy.esc.$$FILTER_FOR_FILTER_HTML_ATTRIBUTES_=/^(?!style|on|action|archive|background|cite|classid|codebase|data|dsync|href|longdesc|src|usemap)(?:[a-z0-9_$:-]*)$/i;soy.esc.$$FILTER_FOR_FILTER_HTML_ELEMENT_NAME_=/^(?!script|style|title|textarea|xmp|no)[a-z0-9_$:-]*$/i;soy.esc.$$escapeHtmlHelper=function(a){var b=String(a);return b.replace(soy.esc.$$MATCHER_FOR_ESCAPE_HTML_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$normalizeHtmlHelper=function(a){var b=String(a);return b.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$escapeHtmlNospaceHelper=function(a){var b=String(a);return b.replace(soy.esc.$$MATCHER_FOR_ESCAPE_HTML_NOSPACE_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$normalizeHtmlNospaceHelper=function(a){var b=String(a);return b.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_NOSPACE_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$escapeJsStringHelper=function(a){var b=String(a);return b.replace(soy.esc.$$MATCHER_FOR_ESCAPE_JS_STRING_,soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_)};soy.esc.$$escapeJsRegexHelper=function(a){var b=String(a);return b.replace(soy.esc.$$MATCHER_FOR_ESCAPE_JS_REGEX_,soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_)};soy.esc.$$escapeCssStringHelper=function(a){var b=String(a);return b.replace(soy.esc.$$MATCHER_FOR_ESCAPE_CSS_STRING_,soy.esc.$$REPLACER_FOR_ESCAPE_CSS_STRING_)};soy.esc.$$filterCssValueHelper=function(a){var b=String(a);if(!soy.esc.$$FILTER_FOR_FILTER_CSS_VALUE_.test(b)){return"zSoyz"}return b};soy.esc.$$normalizeUriHelper=function(a){var b=String(a);return b.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_,soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_)};soy.esc.$$filterNormalizeUriHelper=function(a){var b=String(a);if(!soy.esc.$$FILTER_FOR_FILTER_NORMALIZE_URI_.test(b)){return"#zSoyz"}return b.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_,soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_)};soy.esc.$$filterImageDataUriHelper=function(a){var b=String(a);if(!soy.esc.$$FILTER_FOR_FILTER_IMAGE_DATA_URI_.test(b)){return"data:image/gif;base64,zSoyz"}return b};soy.esc.$$filterHtmlAttributesHelper=function(a){var b=String(a);if(!soy.esc.$$FILTER_FOR_FILTER_HTML_ATTRIBUTES_.test(b)){return"zSoyz"}return b};soy.esc.$$filterHtmlElementNameHelper=function(a){var b=String(a);if(!soy.esc.$$FILTER_FOR_FILTER_HTML_ELEMENT_NAME_.test(b)){return"zSoyz"}return b};soy.esc.$$HTML_TAG_REGEX_=/<(?:!|\/?([a-zA-Z][a-zA-Z0-9:\-]*))(?:[^>'"]|"[^"]*"|'[^']*')*>/g;soy.esc.$$LT_REGEX_=/</g;soy.esc.$$SAFE_TAG_WHITELIST_={b:1,br:1,em:1,i:1,s:1,sub:1,sup:1,u:1};;
;
/* module-key = 'com.atlassian.soy.soy-template-plugin:soy-deps', location = 'js/atlassian-deps.js' */
window.atl_soy=window.atl_soy||{};atl_soy.concat=function(d,c){if(d.concat){return d.concat(c)}var e={};for(var f in d){if(d.hasOwnProperty(f)){e[f]=d[f]}}for(var f in c){if(c.hasOwnProperty(f)){e[f]=c[f]}}return e};;
;
/* module-key = 'com.atlassian.auiplugin:internal-aui-widget', location = 'js/aui/internal/widget.js' */
(function(c){AJS._internal=AJS._internal||{};AJS._internal.widget=c(AJS.$)})(function(c){return function(d,g){var e="_aui-widget-"+d;return function(f,d){var a,b;c.isPlainObject(f)?b=f:(a=f,b=d);a=a&&c(a);!a||!a.data(e)?(b=new g(a,b||{}),a=b.$el,a.data(e,b)):b=a.data(e);return b}}});;
;
/* module-key = 'com.atlassian.auiplugin:aui-navigation', location = 'js/aui-navigation.js' */
(function(b){AJS.navigation=b(AJS.$,window.skate,AJS._internal.widget)})(function(b,e,f){function a(d){this.$el=b(d).closest(".aui-nav");if(1<this.$el.length)return this.$el.map(function(b,d){return new a(d)})[0];if(this.$el.data("aui-navigation"))return this.$el.data("aui-navigation");this.$el.data("aui-navigation",this);this.$treeParent=this.$el.parent("li[aria-expanded]");this.$subtreeToggleIcon=this.$treeParent.children(".aui-nav-subtree-toggle").children("span.aui-icon");this.hideMoreItems();
this.$el.children("li:has(.aui-nav-selected)").addClass("aui-nav-child-selected");d=this.$el.children(".aui-nav-selected");d.parents(".aui-nav > [aria-expanded=false]").add(d.filter("[aria-expanded=false]")).each(function(){c(b(this).children(".aui-nav")).expand()});this.$el.find("> li[aria-expanded] > .aui-nav-subtree-toggle").on("click",function(){c(b(this).siblings(".aui-nav")).toggle()});return this}a.prototype.isNested=function(){return 1===this.$treeParent.length};a.prototype.isCollapsed=function(){return"false"===
this.$treeParent.attr("aria-expanded")};a.prototype.expand=function(){this.$treeParent.attr("aria-expanded","true");this.$subtreeToggleIcon.removeClass("aui-iconfont-collapsed").addClass("aui-iconfont-expanded");this.hideMoreItems();return this};a.prototype.collapse=function(){this.$treeParent.attr("aria-expanded","false");this.$subtreeToggleIcon.removeClass("aui-iconfont-expanded").addClass("aui-iconfont-collapsed");return this};a.prototype.toggle=function(){this.isCollapsed()?this.expand():this.collapse();
return this};a.prototype.hideMoreItems=function(){if(this.$el.is(".aui-nav:not([aria-expanded=false]) [data-more]")){var d=this.$el.attr("data-more")||"More\u2026",a=Math.abs(parseInt(this.$el.attr("data-more-limit")))||5,c=this.$el.children("li"),e=c.length<=a+1,f=c.filter(".aui-nav-selected").length,g=c.filter(".aui-nav-more").length;if(e||f||g)return this;b("<li>",{"class":"aui-nav-more","aria-hidden":"true"}).append(b("<a>",{href:"#","class":"aui-nav-item",text:d,click:function(a){a.preventDefault();
b(this).parent().remove()}})).insertAfter(c.eq(a-1))}return this};var c=f("navigation",a);e("aui-nav",{attached:function(a){c(a)}});return c});;
;
/* module-key = 'com.atlassian.auiplugin:aui-navigation', location = 'soy/navigation.soy' */
// This file was automatically generated from navigation.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.navigation.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.navigation == 'undefined') { aui.navigation = {}; }


aui.navigation.item = function(opt_data, opt_ignored) {
  return '<li class="' + ((opt_data.isSelected || opt_data.key && opt_data.selectedItemKey == opt_data.key) ? 'aui-nav-selected' : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.isCollapsible && opt_data.children && opt_data.children.length > 0) ? 'aria-expanded="' + ((opt_data.isCollapsed) ? 'false' : 'true') + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.children && opt_data.children.length > 0 && opt_data.isCollapsible) ? '<a href="#" class="aui-nav-subtree-toggle">' + aui.icons.icon({icon: opt_data.isCollapsed ? 'collapsed' : 'expanded', size: 'small', useIconFont: true}) + '</a>' : '') + '<a class="aui-nav-item" href="' + soy.$$escapeHtml(opt_data.href) + '">' + ((opt_data.iconClass && ! opt_data.isChild) ? aui.icons.icon({icon: opt_data.iconClass, size: 'small', useIconFont: true}) : '') + ((opt_data.count == 0 || opt_data.count) ? '<span class="aui-badge">' + soy.$$escapeHtml(opt_data.count) + '</span>' : '') + '<span class="aui-nav-item-label">' + soy.$$escapeHtml(opt_data.label) + '</span></a>' + ((opt_data.children && opt_data.children.length > 0) ? aui.navigation.nav({items: opt_data.children, selectedItemKey: opt_data.selectedItemKey, isChild: true}) : '') + '</li>';
};
if (goog.DEBUG) {
  aui.navigation.item.soyTemplateName = 'aui.navigation.item';
}


aui.navigation.nav = function(opt_data, opt_ignored) {
  var output = '<ul class="aui-nav' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>';
  var itemList58 = opt_data.items;
  var itemListLen58 = itemList58.length;
  for (var itemIndex58 = 0; itemIndex58 < itemListLen58; itemIndex58++) {
    var itemData58 = itemList58[itemIndex58];
    output += aui.navigation.item(soy.$$augmentMap(itemData58, {isChild: opt_data.isChild, selectedItemKey: opt_data.selectedItemKey}));
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  aui.navigation.nav.soyTemplateName = 'aui.navigation.nav';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-header', location = 'js/aui-header-responsive.js' */
(function(c,h,i,n){function j(a){this.element=a;this.$element=c(a);this.index=c("aui-header, .aui-header").index(a);this.$secondaryNav=this.$element.find(".aui-header-secondary .aui-nav").first();this.menuItems=[];this.totalWidth=0;this.rightMostNavItemIndex=this.$moreMenu=void 0;this.$applicationLogo=this.$element.find("#logo");this.primaryButtonsWidth=this.moreMenuWidth=0;var b=c(this.$element[0].querySelector(".aui-header-primary"));this.$headerFind=function(a){return b.find(a)}}function k(a){a=
new j(a);a.init();return a}function l(){c(".aui-header").each(function(){k(this)})}var m=c(window);j.prototype={init:function(){var a=this;this.element.setAttribute("data-aui-responsive","true");this.$headerFind(".aui-button").parent("li").each(function(){a.primaryButtonsWidth+=c(this).outerWidth(!0)});this.$headerFind(".aui-nav > li > a:not(.aui-button)").each(function(){var b=c(this).parent(),d=b.outerWidth(!0);a.totalWidth+=d;a.menuItems.push({$element:b,outerWidth:d})});this.rightMostNavItemIndex=
this.menuItems.length-1;m.on("resize",this._resizeHandler=n(function(){a.constructResponsiveDropdown()},100));var b=this.$applicationLogo.find("img");0!==b.length&&(b.attr("data-aui-responsive-header-index",this.index),b.load(function(){a.constructResponsiveDropdown()}));this.constructResponsiveDropdown();this.$headerFind(".aui-nav").css("width","auto")},destroy:function(){m.off("resize",this._resizeHandler)},calculateAvailableWidth:function(){var a=this.$secondaryNav.is(":visible")?this.$secondaryNav.offset().left:
this.$element.outerWidth(),b=this.$applicationLogo.offset().left+this.$applicationLogo.outerWidth(!0)+this.primaryButtonsWidth;return a-b},showResponsiveDropdown:function(){void 0===this.$moreMenu&&(this.$moreMenu=this.createResponsiveDropdownTrigger());this.$moreMenu.css("display","")},hideResponsiveDropdown:function(){void 0!==this.$moreMenu&&this.$moreMenu.css("display","none")},constructResponsiveDropdown:function(){if(this.menuItems.length){var a;a=this.calculateAvailableWidth(this.$element,
this.primaryButtonsWidth);if(a>this.totalWidth)this.showAll();else{this.showResponsiveDropdown();a-=this.moreMenuWidth;for(var b=-1;0<=a-this.menuItems[b+1].outerWidth;)a-=this.menuItems[b+1].outerWidth,b++;b<this.rightMostNavItemIndex?this.moveToResponsiveDropdown(this.rightMostNavItemIndex-b):this.rightMostNavItemIndex<b&&this.moveOutOfResponsiveDropdown(b-this.rightMostNavItemIndex)}}},createResponsiveDropdownTrigger:function(){var a=document.createElement("li"),b=document.createElement("aui-dropdown");
b.id="aui-responsive-header-dropdown-"+this.index;b.setAttribute("label","More");i.wrap(b).innerHTML='<ul id="aui-responsive-header-dropdown-list-'+this.index+'" role="presentation"></ul>';a.appendChild(b);0===this.primaryButtonsWidth?this.$headerFind(".aui-nav").append(a):this.$headerFind(".aui-nav > li > .aui-button").first().parent().before(a);this.moreMenuWidth=c(a).outerWidth(!0);return c(a)},moveOutOfResponsiveDropdown:function(a){if(!(0>=a)){var b=this.$moreMenu.find("> aui-dropdown > a");
b.hasClass("active")&&b.trigger("aui-button-invoke");for(var b=this.rightMostNavItemIndex+a,f=this.rightMostNavItemIndex+1;f<=b;f++){var d=this.menuItems[f].$element,e=d.children("a"),g=c("#"+e.attr("aria-controls"));d.removeAttr("role");e.attr("aria-controls")&&(e.removeClass("aui-dropdown2-sub-trigger"),g.removeClass("aui-dropdown2-sub-menu"));d.insertBefore(this.$moreMenu)}this.rightMostNavItemIndex+=a}},moveToResponsiveDropdown:function(a){if(!(0>=a)){for(var b=document.querySelector("#aui-responsive-header-dropdown-list-"+
this.index),f=this.rightMostNavItemIndex-a+1,d=this.rightMostNavItemIndex;d>=f;d--){var e=this.menuItems[d].$element,g=e.children("a"),h=c("#"+g.attr("aria-controls"));e.attr("role","presentation");g.attr("aria-controls")&&(g.addClass("aui-dropdown2-sub-trigger"),h.addClass("aui-dropdown2-sub-menu"));b.insertBefore(e[0],b.firstChild)}this.rightMostNavItemIndex-=a}},showAll:function(){this.moveOutOfResponsiveDropdown(this.menuItems.length-1-this.rightMostNavItemIndex);this.hideResponsiveDropdown()}};
c(l);AJS.responsiveheader={};AJS.responsiveheader.setup=AJS.deprecate.fn(l,"AJS.responsiveheader.setup",{removeInVersion:"6.0.0",sinceVersion:"5.8.0",extraInfo:"No need to manually initialise anymore as this is now a web component."});h("aui-header",{type:h.types.TAG,created:function(a){c(a).find(".aui-banner").addClass("aui-banner-error")},attached:function(a){a._instance=k(a)},detached:function(a){a._instance.destroy()},attributes:{link:function(a,b){a.querySelector("#logo > a").setAttribute("href",
b.newValue)},responsive:function(a,b){a.querySelector(".aui-header").setAttribute("data-aui-responsive",b.newValue)}},template:i('<content select="aui-banner"></content>','<nav class="aui-header aui-dropdown2-trigger-group" role="navigation">','<content select=".aui-header-before"></content>','<div class="aui-header-primary">','<h1 id="logo" class="aui-header-logo">','<a href="/">','<content select=".aui-header-logo, .aui-header-logo-device, .aui-header-logo-text"></content>',"</a>","</h1>",'<content select=".aui-header-content"></content>',
"</div>",'<content select=".aui-header-secondary"></content>','<content select=".aui-header-after"></content>',"</nav>")})})(AJS.$,window.skate,window.skateTemplateHtml,AJS.debounce);;
;
/* module-key = 'com.atlassian.auiplugin:aui-focus-manager', location = 'js/focus-manager.js' */
AJS.FocusManager=function(d){function c(){this._focusTrapStack=[];d(document).on("focusout",{focusTrapStack:this._focusTrapStack},h)}function h(a){var b=a.data.focusTrapStack;if(a.relatedTarget&&0!==b.length){var b=b[b.length-1],e=a.target,a=a.relatedTarget,d=b.find(":aui-tabbable"),c=AJS.$(d.first()),d=AJS.$(d.last());0===b.has(a).length&&a&&(c.is(e)?d.focus():d.is(e)&&c.focus())}}var g=function(a,b){var e=a.nodeName.toLowerCase();if("aui-select"===e)return!0;if("area"===e){var e=a.parentNode,c=
e.name,f=d("img[usemap=#"+c+"]").get();return!a.href||!c||"map"!==e.nodeName.toLowerCase()?!1:f&&"visible"===d.css(f,"visibility")}c=/input|select|textarea|button|object/.test(e);f=a.href||b;return(c?!a.disabled:"a"===e?f:b)&&"visible"===d.css(a,"visibility")};d.extend(d.expr[":"],{"aui-focusable":function(a){return g(a,!isNaN(d.attr(a,"tabindex")))},"aui-tabbable":function(a){var b=d.attr(a,"tabindex"),c=isNaN(b);return(c||0<=b)&&g(a,!c)}});c.defaultFocusSelector=":aui-tabbable";c.prototype.enter=
function(a){a.data("_aui-focus-restore",d(document.activeElement));if("false"!==a.attr("data-aui-focus")){var b=a.attr("data-aui-focus-selector")||c.defaultFocusSelector;(a.is(b)?a:a.find(b)).first().focus()}a.is(".aui-dialog2")&&this._focusTrapStack.push(a)};c.prototype.exit=function(a){a.is(".aui-dialog2")&&this._focusTrapStack.pop();var b=document.activeElement;(a[0]===b||a.has(b).length)&&d(b).blur();if((b=a.data("_aui-focus-restore"))&&b.length)a.removeData("_aui-focus-restore"),b.focus()};c.global=
new c;return c}(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:aui-layer-manager', location = 'js/layer-manager.js' */
(function(d){function i(a,c){for(var b=a.length;b--;)if(c(a[b]))return b;return-1}function e(a,c){return i(a,function(a){return a[0]===c[0]})}function g(a){return i(a,function(a){return AJS.layer(a).isBlanketed()})}function h(a,c){var b=g(a);c!==b&&(-1<b?AJS.dim(!1,a[b].css("z-index")-20):AJS.undim())}function f(a,c,b){if(!(0>c))for(var d=a.length-1;d>=c;d--){var e=AJS.layer(a[d]);if(b||!e.isPersistent())e._hideLayer(!0),a.splice(d,1)}}function j(a){return d('[aria-controls="'+a.attr("id")+'"]')}
function k(){this._stack=[]}k.prototype={push:function(a){a=a instanceof d?a:d(a);if(0<=e(this._stack,a))throw Error("The given element is already an active layer.");this.popLayersBeside(a);var c=AJS.layer(a),b;b=this._stack;b.length?(b=parseInt(b[b.length-1].css("z-index"),10),b=(isNaN(b)?0:b)+100):b=0;b=Math.max(3E3,b);c._showLayer(b);c.isBlanketed()&&AJS.dim(!1,b-20);this._stack.push(a);return this},popLayersBeside:function(a){a=a instanceof d?a:d(a);0<j(a).length?(a=j(a),a=0<a.length?a.closest(".aui-layer"):
void 0,a?(a=this.indexOf(a),f(this._stack,++a,!1)):f(this._stack,0,!1)):(a=g(this._stack),f(this._stack,++a,!1))},indexOf:function(a){return e(this._stack,d(a))},item:function(a){return this._stack[a]},hideAll:function(){this._stack.reverse().forEach(function(a){a=AJS.layer(a);!a.isBlanketed()&&!a.isPersistent()&&a.hide()});return this},getNextLowerNonPersistentOrBlanketedLayer:function(a){a=a instanceof d?a:d(a);a=e(this._stack,a);if(0>a)return null;var c;for(a--;0<=a;){c=this._stack[a];var b=AJS.layer(c);
if(!b.isPersistent()||b.isBlanketed())return c;a--}return null},getNextHigherNonPeristentAndNonBlanketedLayer:function(a){a=a instanceof d?a:d(a);a=e(this._stack,a);if(0>a)return null;var c;for(a++;a<this._stack.length;){c=this._stack[a];var b=AJS.layer(c);if(!b.isPersistent()&&!b.isBlanketed())return c;a++}return null},popUntil:function(a){var a=a instanceof d?a:d(a),c=e(this._stack,a);if(-1===c)return null;var b=g(this._stack);f(this._stack,c+1,AJS.layer(a).isBlanketed());AJS.layer(a)._hideLayer();
this._stack.splice(c,1);h(this._stack,b);return a},getTopLayer:function(){return!this._stack.length?null:this._stack[this._stack.length-1]},popTopIfNonPersistent:function(){var a=this.getTopLayer(),c=AJS.layer(a);return!a||c.isPersistent()?null:this.popUntil(a)},popUntilTopBlanketed:function(){var a=g(this._stack);if(0>a)return null;var c=this._stack[a];if(AJS.layer(c).isPersistent())return(a=this.getNextHigherNonPeristentAndNonBlanketedLayer(c))?(c=e(this._stack,a),f(this._stack,c,!0),a):null;f(this._stack,
a,!0);h(this._stack,a);return c},popUntilTopPersistent:function(){var a=AJS.LayerManager.global.getTopLayer();if(a){var c=g(this._stack),b=AJS.layer(a);b.isPersistent()?b.isBlanketed()||(a=AJS.LayerManager.global.getNextLowerNonPersistentOrBlanketedLayer(a),b=AJS.layer(a),a&&!b.isPersistent()&&(a=e(this._stack,a),f(this._stack,a,!0),h(this._stack,c))):(a=e(this._stack,a),f(this._stack,a,!0),h(this._stack,c))}}};AJS.LayerManager=k})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:aui-layer-manager', location = 'js/layer-manager-global.js' */
(function(d){function e(a){if(!a.length)return!1;a=document.getElementById(a.attr("aria-controls"));return-1<AJS.LayerManager.global.indexOf(a)}var c=d(document);c.on("keydown",function(a){a.keyCode===AJS.keyCode.ESCAPE&&(AJS.LayerManager.global.popUntilTopPersistent(),a.preventDefault())});c.on("click",".aui-blanket",function(a){AJS.LayerManager.global.popUntilTopBlanketed()&&a.preventDefault()});c.on("click",function(a){var b=d(a.target);b.closest(".aui-blanket").length||(a=b.closest("[aria-controls]"),
b=b.closest(".aui-layer"),!b.length&&!e(a)?AJS.LayerManager.global.hideAll():!e(a)&&b.length&&(a=AJS.LayerManager.global.getNextHigherNonPeristentAndNonBlanketedLayer(b))&&AJS.layer(a).hide())});AJS.LayerManager.global=new AJS.LayerManager})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:layer', location = 'js/layer.js' */
(function(d){AJS.layer=d(AJS.$,AJS._internal.widget);"function"===typeof define&&define("layer",[],function(){return AJS.layer})})(function(d,k){function e(a,b,c){var e=d.Event(f+b),b=d.Event(g+b),c=new CustomEvent(l+c,{bubbles:!0,cancelable:!0});a.trigger(e);a.trigger(b,[a]);a[0].dispatchEvent(c);return!e.isDefaultPrevented()&&!b.isDefaultPrevented()&&!c.defaultPrevented}function i(a){this.$el=d(a||'<div class="aui-layer" aria-hidden="true"></div>');this.$el.addClass("aui-layer")}var f="_aui-internal-layer-",
g="_aui-internal-layer-global-",l="aui-layer-",j=d(document);i.prototype={below:function(){return AJS.LayerManager.global.item(AJS.LayerManager.global.indexOf(this.$el)-1)},above:function(){return AJS.LayerManager.global.item(AJS.LayerManager.global.indexOf(this.$el)+1)},changeSize:function(a,b){this.$el.css("width",a);this.$el.css("height","content"===b?"":b);return this},on:function(a,b){this.$el.on(f+a,b);return this},off:function(a,b){this.$el.off(f+a,b);return this},show:function(){if(this.isVisible())return this.$el.attr("aria-hidden",
"false"),this;e(this.$el,"beforeShow","show")&&AJS.LayerManager.global.push(this.$el);return this},hide:function(){if(!this.isVisible())return this.$el.attr("aria-hidden","true"),this;e(this.$el,"beforeHide","hide")&&AJS.LayerManager.global.popUntil(this.$el);return this},isVisible:function(){return"false"===this.$el.attr("aria-hidden")},remove:function(){this.hide();this.$el.remove();this.$el=null},isBlanketed:function(){return"true"===this.$el.attr("data-aui-blanketed")},isPersistent:function(){var a=
this.$el.attr("modal")||this.$el.attr("data-aui-modal"),b=this.$el.attr("persistent")||this.$el.attr("data-aui-persistent");return"true"===a||"true"===b},_hideLayer:function(a){(this.isPersistent()||this.isBlanketed())&&AJS.FocusManager.global.exit(this.$el);a&&e(this.$el,"beforeHide","hide");this.$el.attr("aria-hidden","true");this.$el.css("z-index",this.$el.data("_aui-layer-cached-z-index")||"");this.$el.data("_aui-layer-cached-z-index","");this.$el.trigger(f+"hide");this.$el.trigger(g+"hide",[this.$el])},
_showLayer:function(a){this.$el.parent().is("body")||this.$el.appendTo(document.body);this.$el.data("_aui-layer-cached-z-index",this.$el.css("z-index"));this.$el.css("z-index",a);this.$el.attr("aria-hidden","false");(this.isPersistent()||this.isBlanketed())&&AJS.FocusManager.global.enter(this.$el);this.$el.trigger(f+"show");this.$el.trigger(g+"show",[this.$el])}};var h=k("layer",i);h.on=function(a,b,c){j.on(g+a,b,c);return this};h.off=function(a,b,c){j.off(g+a,b,c);return this};return h});;
;
/* module-key = 'com.atlassian.auiplugin:aui-alignment', location = 'js/aui/internal/alignment.js' */
(function(h){AJS.Alignment=h(window.Tether);"function"===typeof define&&define("aui/internal/alignment",["aui/internal/tether"],function(){return AJS.Alignment})})(function(h){function f(c,f){var d,b,e;d=c.getAttribute(i)||c.getAttribute("data-aui-"+i)||window;"string"===typeof d&&(d=document.querySelector(d));e=d;b=(c.getAttribute(j)||c.getAttribute("data-aui-"+j)||k).split(" ");d=b[0];b=b[1];if(!b||"auto"===b){var a=e;b="left";var g;if(!a||a===window||a===document)a=document.documentElement;a&&
(a.nodeType&&1===a.nodeType)&&(a=a.getBoundingClientRect(),g=f.getBoundingClientRect(),g.left>a.right/2&&(b="right"))}a=l[d+" "+b]||l[k];g=c.hasAttribute(m)||c.hasAttribute("data-aui-"+m);e=new h({enabled:!1,element:c,target:f,attachment:a.el,targetAttachment:a.target,classPrefix:n,constraints:[{to:e===window?"window":e,attachment:!0===g?"none":"together"}]});c.className+=" "+(o+d)+" "+(p+b);this._auiTether=e}var j="alignment",m="alignment-static",i="alignment-container",n="aui-alignment",o="aui-alignment-side-",
p="aui-alignment-snap-",k="right middle",l={"top left":{el:"bottom left",target:"top left"},"top center":{el:"bottom center",target:"top center"},"top right":{el:"bottom right",target:"top right"},"right top":{el:"top left",target:"top right"},"right middle":{el:"middle left",target:"middle right"},"right bottom":{el:"bottom left",target:"bottom right"},"bottom left":{el:"top left",target:"bottom left"},"bottom center":{el:"top center",target:"bottom center"},"bottom right":{el:"top right",target:"bottom right"},
"left top":{el:"top right",target:"top left"},"left middle":{el:"middle right",target:"middle left"},"left bottom":{el:"bottom right",target:"bottom left"},"submenu left":{el:"top left",target:"top right"},"submenu right":{el:"top right",target:"top left"}};f.prototype={destroy:function(){this._auiTether.destroy();return this},disable:function(){this._auiTether.disable();return this},enable:function(){this._auiTether.enable();return this}};return f});;
;
/* module-key = 'com.atlassian.auiplugin:internal-aui-browser', location = 'js/aui/internal/browser.js' */
(function(b){AJS._internal=AJS._internal||{};AJS._internal.browser=b(AJS.$)})(function(b){var a={},c=null,d=/Mac OS X/.test(navigator.userAgent);a.supportsCalc=function(){if(null===c){var a=b('<div style="height: 10px; height: -webkit-calc(20px + 0); height: calc(20px);"></div>');c=20===a.appendTo(document.documentElement).height();a.remove()}return c};a.supportsRequestAnimationFrame=function(){return!!window.requestAnimationFrame};a.supportsVoiceOver=function(){return d};return a});;
;
/* module-key = 'com.atlassian.auiplugin:aui-dropdown2', location = 'js/dropdown2.js' */
(function(d,p,e,q,j){function m(a){return d(a).is('.checked, .aui-dropdown2-checked, [aria-checked="true"]')}function k(a,c){var b=d('[aria-controls="'+a.id+'"]')[0];b&&c(b)}function l(a,c){var b=d(a);c?(b.attr("aria-expanded","true"),b.addClass("active aui-dropdown2-active")):(b.attr("aria-expanded","false"),b.removeClass("active aui-dropdown2-active"))}function n(a,c){return d(a).find('> ul > li,> .aui-dropdown2-section > ul > li,> div[role] > .aui-dropdown2-section > div[role="group"] > ul[role] > li[role]').filter(c).children('a, button, [role="checkbox"], [role="menuitemcheckbox"], [role="radio"], [role="menuitemradio"]')}
function h(a){return n(a,function(){return-1===this.className.indexOf("hidden")})}function o(a){var c=d(a);c.addClass("aui-dropdown2");j.supportsVoiceOver()&&c.find('> div[role="application"]').attr("role","presentation");a.hasAttribute("data-container")&&(c.attr("data-aui-alignment-container",c.attr("data-container")),c.removeAttr("data-container"));AJS.layer(a);a.addEventListener("aui-layer-show",function(){d(a).trigger("aui-dropdown2-show");var b=d(a),c=b.find(".hidden").addClass("aui-dropdown2-hidden"),
e=b.find(".disabled").addClass("aui-dropdown2-disabled"),g=b.find(".interactive").addClass("aui-dropdown2-interactive");a._syncClasses=function(){c.removeClass("aui-dropdown2-hidden");e.removeClass("aui-dropdown2-disabled");g.removeClass("aui-dropdown2-interactive")};n(this,function(){return true}).each(function(){var a=d(this);a.attr("tabindex","-1");(a.hasClass("aui-dropdown2-disabled")||a.parent().hasClass("aui-dropdown2-hidden"))&&a.attr("aria-disabled",true)});k(a,function(b){l(b,true);b=b.getAttribute("data-dropdown2-hide-location");
b=document.getElementById(b)||a.parentNode;a._returnTo=b})});a.addEventListener("aui-layer-hide",function(){d(a).trigger("aui-dropdown2-hide");if(a._syncClasses){a._syncClasses();delete a._syncClasses}if(a._auiAlignment){a._auiAlignment.disable();a._auiAlignment.destroy()}if(a._returnTo){a.parentNode&&a.parentNode!==a._returnTo&&a.parentNode.removeChild(a);a._returnTo.appendChild(a)}h(a).removeClass("active aui-dropdown2-active");k(a,function(a){var c=f===true;f=false;if(c){a.focus();l(a,a.hasSubmenu&&
a.hasSubmenu())}else l(a,false)});delete a.isSubmenu});c=d(a);c.on("keydown",function(b){if(b.keyCode===AJS.keyCode.DOWN){a.focusNext();b.preventDefault()}else if(b.keyCode===AJS.keyCode.UP){a.focusPrevious();b.preventDefault()}else if(b.keyCode===AJS.keyCode.LEFT){if(a.isSubmenu){f=true;a.hide();b.preventDefault()}}else if(b.keyCode===AJS.keyCode.ESCAPE)f=true;else if(b.keyCode===AJS.keyCode.TAB){f=true;a.hide()}});c.on("click",'a, button, [role="menuitem"], [role="menuitemcheckbox"], [role="checkbox"], [role="menuitemradio"], [role="radio"]',
function(b){var c=d(b.target);c.attr("aria-disabled")==="true"&&b.preventDefault();if(!b.isDefaultPrevented()&&!c.is(".aui-dropdown2-interactive")){b=a;do{c=AJS.layer(b);b=AJS.layer(b).below();c.$el.is(".aui-dropdown2")&&c.hide()}while(b)}});c.on("mouseenter",'a, button, [role="menuitem"], [role="menuitemcheckbox"], [role="checkbox"], [role="menuitemradio"], [role="radio"]',function(b){var c=b.target,c=c.hasSubmenu&&c.hasSubmenu();if(!b.isDefaultPrevented()&&!c)(b=AJS.layer(a).above())&&AJS.layer(b).hide()});
a.hide()}e("aui-dropdown2-trigger",{type:e.types.CLASS,created:function(a){function c(c){c.preventDefault();if(a.isEnabled())return c=document.getElementById(b),c.toggle(),c.isSubmenu=a.hasSubmenu(),c}var b=a.getAttribute("aria-controls");b||((b=a.getAttribute("aria-owns"))?(a.removeAttribute("aria-owns"),a.setAttribute("aria-controls",b)):AJS.error('Dropdown triggers need either a "aria-owns" or "aria-controls" attribute'));a.setAttribute("aria-haspopup",!0);a.setAttribute("aria-expanded",!1);a.setAttribute("href",
"#");d(a).on("aui-button-invoke",c).on("click",c).on("keydown",function(b){var d=b.keyCode===AJS.keyCode.ENTER||b.keyCode===AJS.keyCode.SPACE,e=b.keyCode===AJS.keyCode.RIGHT&&a.hasSubmenu(),f=(b.keyCode===AJS.keyCode.UP||b.keyCode===AJS.keyCode.DOWN)&&!a.hasSubmenu();if(d||e||f)(b=c(b))&&b.focusItem(0)}).on("mouseenter",function(c){c.preventDefault();if(a.isEnabled()&&a.hasSubmenu()){c=document.getElementById(b);c.show();c.isSubmenu=a.hasSubmenu();return c}})},prototype:{disable:function(){this.setAttribute("aria-disabled",
"true")},enable:function(){this.setAttribute("aria-disabled","false")},isEnabled:function(){return"true"!==this.getAttribute("aria-disabled")},hasSubmenu:function(){return-1!==(this.className||"").split(/\s+/).indexOf("aui-dropdown2-sub-trigger")}}});d(document).on("mousedown",".aui-dropdown2-trigger",function(){this.hasAttribute("resolved")||(e.init(this),AJS.deprecate.getMessageLogger("Dropdown2 lazy initialisation",{removeInVersion:"6.0.0",alternativeName:"initialisation on DOM insertion",sinceVersion:"5.8.0",
extraInfo:"Dropdown2 triggers should have all necessary attributes on DOM insertion",deprecationType:"JS"})())});e("aui-dropdown2-sub-trigger",{type:e.types.CLASS,created:function(a){a.className+=" aui-dropdown2-trigger";e.init(a)}});d(document).on("mouseenter",".aui-dropdown2-trigger-group a, .aui-dropdown2-trigger-group button",function(a){var c=d(a.target),b;if(!c.is(".aui-dropdown2-active")&&!c.closest(".aui-dropdown2").size()&&(b=c.closest(".aui-dropdown2-trigger-group").find(".aui-dropdown2-active").size())&&
c.is(".aui-dropdown2-trigger"))c.trigger("aui-button-invoke"),a.preventDefault()});var f=!1,i={toggle:function(){this.isVisible()?this.hide():this.show()},show:function(){AJS.layer(this).show();var a=this;k(a,function(c){var b=c&&c.hasSubmenu&&c.hasSubmenu(),e="submenu auto"===a.getAttribute("data-aui-alignment"),f=a.hasAttribute("data-aui-alignment");if(!b&&e){var g=d(a);if(g.data("previous-data-aui-alignment")||g.data("had-data-aui-alignment-static")){var h=g.data("previous-data-aui-alignment");
h?a.setAttribute("data-aui-alignment",h):a.removeAttribute("data-aui-alignment");g.removeData("previous-data-aui-alignment");g.data("had-data-aui-alignment-static")||a.removeAttribute("data-aui-alignment-static");g.removeData("had-data-aui-alignment-static")}}b&&!e?(b=d(a),a.hasAttribute("data-aui-alignment")&&b.data("previous-data-aui-alignment",a.getAttribute("data-aui-alignment")),b.data("had-data-aui-alignment-static",a.hasAttribute("data-aui-alignment-static")),a.setAttribute("data-aui-alignment",
"submenu auto"),a.setAttribute("data-aui-alignment-static",!0)):f||(a.setAttribute("data-aui-alignment","bottom auto"),a.setAttribute("data-aui-alignment-static",!0));a._auiAlignment&&a._auiAlignment.destroy();a._auiAlignment=new p(a,c);a._auiAlignment.enable()});return this},hide:function(){AJS.layer(this).hide();return this},focusNext:function(){var a=h(this),c=document.activeElement;a.last()[0]!==c&&(c=a.toArray().indexOf(c),this.focusItem(a.get(c+1)))},focusPrevious:function(){var a=h(this),c=
document.activeElement;a.first()[0]!==c&&(c=a.toArray().indexOf(c),this.focusItem(a.get(c-1)))},focusItem:function(a){var c=h(this);"number"===typeof a&&(a=c.get(a));a=d(a);a.focus();c.removeClass("active aui-dropdown2-active");a.addClass("active aui-dropdown2-active")},isVisible:function(){return AJS.layer(this).isVisible()}};e("aui-dropdown",{attributes:{label:function(a,c){a.children[0].textContent=c.newValue}},created:function(a){var c=a.children[1],b=a.children[0];c.id=a.id+"-dropdown";b.id=
a.id+"-trigger";b.setAttribute("aria-controls",c.id);Object.keys(i).forEach(function(b){a[b]=a[b].bind(c)});a.hide()},prototype:i,template:window.skateTemplateHtml('<a class="aui-dropdown2-trigger" href="#"></a>','<div aria-hidden="true" class="aui-dropdown2 aui-style-default" role="menu">','<div role="application">','<div role="presentation" class="aui-dropdown2-section">','<div role="group">','<content select="ul"></content>',"</div>","</div>","</div>","</div>"),type:e.types.TAG});e("aui-dropdown2",
{type:e.types.CLASS,created:o,prototype:i});e("data-aui-dropdown2",{type:e.types.ATTR,created:o,prototype:i});e("aui-dropdown2-checkbox",{type:e.types.CLASS,created:function(a){var c=m(a);a.setAttribute("aria-checked",c);a.setAttribute("tabindex","0");j.supportsVoiceOver()&&a.setAttribute("role","checkbox");d(a).on("click keydown",function(b){if("click"===b.type||b.keyCode===AJS.keyCode.ENTER||b.keyCode===AJS.keyCode.SPACE)a.isInteractive()&&b.preventDefault(),a.isEnabled()&&(a.isChecked()?a.uncheck():
a.check())})},prototype:{isEnabled:function(){return!(null!==this.getAttribute("aria-disabled")&&"true"===this.getAttribute("aria-disabled"))},isChecked:function(){return null!==this.getAttribute("aria-checked")&&"true"===this.getAttribute("aria-checked")},isInteractive:function(){return d(this).hasClass("aui-dropdown2-interactive")},uncheck:function(){this.setAttribute("aria-checked","false");d(this).removeClass("checked aui-dropdown2-checked");d(this).trigger("aui-dropdown2-item-uncheck")},check:function(){this.setAttribute("aria-checked",
"true");d(this).addClass("checked aui-dropdown2-checked");d(this).trigger("aui-dropdown2-item-check")}}});e("aui-dropdown2-radio",{type:e.types.CLASS,created:function(a){var c=m(a);a.setAttribute("aria-checked",c);a.setAttribute("tabindex","0");j.supportsVoiceOver()&&a.setAttribute("role","radio");d(a).on("click keydown",function(b){if("click"===b.type||b.keyCode===AJS.keyCode.ENTER||b.keyCode===AJS.keyCode.SPACE)a.isInteractive()&&b.preventDefault(),b=d(this),this.isEnabled()&&!1===this.isChecked()&&
(b.closest("ul").find(".aui-dropdown2-checked").not(this).each(function(){this.uncheck()}),a.check())})},prototype:{isEnabled:function(){return!(null!==this.getAttribute("aria-disabled")&&"true"===this.getAttribute("aria-disabled"))},isChecked:function(){return null!==this.getAttribute("aria-checked")&&"true"===this.getAttribute("aria-checked")},isInteractive:function(){return d(this).hasClass("aui-dropdown2-interactive")},uncheck:function(){this.setAttribute("aria-checked","false");d(this).removeClass("checked aui-dropdown2-checked");
d(this).trigger("aui-dropdown2-item-uncheck")},check:function(){this.setAttribute("aria-checked","true");d(this).addClass("checked aui-dropdown2-checked");d(this).trigger("aui-dropdown2-item-check")}}})})(AJS.$,AJS.Alignment,window.skate,window.skateTemplateHtml,AJS._internal.browser);;
;
/* module-key = 'com.atlassian.auiplugin:fancy-file-input', location = 'fancy-file-input/dist/fancy-file-input.js' */
(function(b,a){b.FancyFileInput=a(jQuery);"function"===typeof define&&define("aui/internal/fancy-file-input",[],function(){return b.FancyFileInput})})(this,function(b){function a(c,d){var e=b(c).data("FancyFileInput");if(e)return e;d=b.extend({},a.defaults,d);this.el=c;this.$el=b(c);this.$label=this.createLabel(d.buttonText);this._addLabelText();this.$clearButton=b("<button>",{text:this.$label.attr("data-ffi-clearButtonText")||d.clearButtonText,"class":"ffi-clear",type:"button",tabindex:"-1"});this.multipleFileTextPattern=
this.$label.attr("data-ffi-multipleFileTextPattern")||d.multipleFileTextPattern;this._eventNamespace=".ffi";this.CLASSES={disabled:"is-disabled",focused:"is-focused",active:"is-active",valid:"is-valid",invalid:"is-invalid"};this[this.isDisabled()?"disable":"enable"]();this.isFocused=!1}var h=/^.*[\\\/]/,i=/\{0\}/gi,e,f=3,g=document.createElement("div"),j=g.getElementsByTagName("i");do g.innerHTML="<\!--[if gt IE "+ ++f+"]><i></i><![endif]--\>";while(j[0]);e=4<f?f:document.documentMode;b.fn.fancyFileInput=
function(c){return this.each(function(){var d=new a(this,c);b(this).data("FancyFileInput",d)})};a.defaults={buttonText:"Browse\u2026",clearButtonText:"Clear",multipleFileTextPattern:"{0} files"};a.prototype._addLabelText=function(){var c=b('label[for="'+this.el.id+'"]');c.length&&this.$el.attr("aria-label",c.text())};a.prototype.createLabel=function(c){var a=this.$el.parent(".ffi[data-ffi-button-text]");a.length||(a=this.$el.wrap(b("<label>",{"class":"ffi","data-ffi-button-text":c})).parent());return a};
a.prototype.isDisabled=function(){return this.$el.is(":disabled")};a.prototype.formatMultipleFileText=function(c){return this.multipleFileTextPattern.replace(i,c)};a.prototype.bindEvents=function(){this.$el.on("invalid"+this._eventNamespace,b.proxy(this.checkValidity,this)).on("change"+this._eventNamespace,b.proxy(this.change,this)).on("keydown"+this._eventNamespace,b.proxy(this.keydown,this)).on("mousedown"+this._eventNamespace,b.proxy(this.mousedown,this)).on("mouseup"+this._eventNamespace,b.proxy(this.mouseup,
this)).on("focus"+this._eventNamespace,b.proxy(this.focus,this)).on("blur"+this._eventNamespace,b.proxy(this.blur,this));this.$clearButton.on("click"+this._eventNamespace,b.proxy(this.clear,this))};a.prototype.unbindEvents=function(){this.$el.off(this._eventNamespace);this.$clearButton.off(this._eventNamespace)};a.prototype.fireEvent=function(c){this.$el.trigger(c+this._eventNamespace)};a.prototype.enable=function(){this.bindEvents();this.$el.prop("disabled",!1);this.$label.removeClass(this.CLASSES.disabled)};
a.prototype.disable=function(){this.unbindEvents();this.$el.prop("disabled",!0);this.$label.addClass(this.CLASSES.disabled)};a.prototype.clear=function(){this.$el.wrap("<form>").closest("form").get(0).reset();this.$el.unwrap();this.el.value="";this.change();return!1};a.prototype.focus=function(){var c=this;this.$label.addClass(this.CLASSES.focused);e&&!this.isFocused&&(this.isFocused=!0,setTimeout(function(){c.$el.blur();c.$el.focus()},0))};a.prototype.blur=function(){if(!e||!this.isFocused)this.$label.removeClass(this.CLASSES.focused),
this.isFocused=!1};a.prototype.mousedown=function(){this.$label.addClass(this.CLASSES.active)};a.prototype.mouseup=function(){this.$label.removeClass(this.CLASSES.active)};a.prototype.keydown=function(c){var a=c.which;if(8===a||46===a)this.clear(),c.preventDefault();if(e&&9===a){var b=this;this.isFocused=!1;this.$el.prop("disabled",!0);setTimeout(function(){b.$el.prop("disabled",!1).blur()},0)}};a.prototype.checkValidity=function(){if(this.el.required){var a=this.$el.is(":invalid");this.$label.toggleClass(this.CLASSES.invalid,
a).toggleClass(this.CLASSES.valid,!a)}};a.prototype.change=function(){var a,b="";this.checkValidity();a=this.el.multiple&&1<this.el.files.length?this.formatMultipleFileText(this.el.files.length):this.el.value;a.length?(b=a.replace(h,""),this.$clearButton.appendTo(this.$label)):this.$clearButton.detach();this.$el.focus();this.setFieldText(b);this.fireEvent("value-changed")};a.prototype.setFieldText=function(a){a.length?(this.$label.attr("data-ffi-value",a),this.fireEvent("value-added")):(this.$label.removeAttr("data-ffi-value"),
this.fireEvent("value-cleared"))};return a});;
;
/* module-key = 'com.atlassian.auiplugin:hotkeys', location = 'js/jquery/jquery.hotkeys.js' */
(function(a){function c(a){this.num=0;this.timer=0<a?a:!1}function k(h){if(a.isPlainObject(h.data)||a.isArray(h.data)||"string"===typeof h.data){var i=h.handler,g={timer:700},b=h.data;"string"===typeof b?g.combo=[b]:a.isArray(b)?g.combo=b:a.extend(g,b);g.combo=a.map(g.combo,function(a){return a.toLowerCase()});h.index=new c(g.timer);h.handler=function(e){if(!(this!==e.target&&/textarea|select|input/i.test(e.target.nodeName))){var d="keypress"!==e.type?a.hotkeys.specialKeys[e.which]:null,b=String.fromCharCode(e.which).toLowerCase(),
f="",c={};e.altKey&&"alt"!==d&&(f+="alt+");e.ctrlKey&&"ctrl"!==d&&(f+="ctrl+");e.metaKey&&(!e.ctrlKey&&"meta"!==d)&&(f+="meta+");e.shiftKey&&"shift"!==d&&(f+="shift+");e.metaKey&&"["===b&&(b=null);d&&(c[f+d]=!0);b&&(c[f+b]=!0);/shift+/.test(f)&&(c[f.replace("shift+","")+a.hotkeys.shiftNums[d||b]]=!0);d=h.index;b=g.combo;if(j(b[d.val()],c)){if(d.val()===b.length-1)return d.reset(),i.apply(this,arguments);d.inc()}else d.reset(),j(b[0],c)&&d.inc()}}}}function j(a,c){for(var g=a.split(" "),b=0,e=g.length;b<
e;b++)if(c[g[b]])return!0;return!1}a.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"meta",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",
122:"f11",123:"f12",144:"numlock",145:"scroll",188:",",190:".",191:"/",224:"meta",219:"[",221:"]"},keypressKeys:["<",">","?"],shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"}};a.each(a.hotkeys.keypressKeys,function(c,i){a.hotkeys.shiftNums[i]=i});c.prototype.val=function(){return this.num};c.prototype.inc=function(){this.timer&&(clearTimeout(this.timeout),this.timeout=setTimeout(a.proxy(c.prototype.reset,
this),this.timer));this.num++};c.prototype.reset=function(){this.timer&&clearTimeout(this.timeout);this.num=0};a.each(["keydown","keyup","keypress"],function(){a.event.special[this]={add:k}})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:dialog', location = 'js/dialog.js' */
AJS.popup=function(c,m,k,l){"object"!=typeof c&&(c={width:c,height:m,id:k},c=AJS.$.extend({},c,l));var c=AJS.$.extend({},{width:800,height:600,closeOnOutsideClick:!1,keypressListener:function(a){a.keyCode===27&&e.is(":visible")&&g.hide()}},c),e=AJS("div").addClass("aui-popup");c.id&&e.attr("id",c.id);var f=3E3;AJS.$(".aui-dialog").each(function(){var a=AJS.$(this);f=a.css("z-index")>f?a.css("z-index"):f});var a=function j(a,b){c.width=a=a||c.width;c.height=b=b||c.height;e.css({marginTop:-Math.round(b/
2)+"px",marginLeft:-Math.round(a/2)+"px",width:a,height:b,"z-index":parseInt(f,10)+2});return j}(c.width,c.height);AJS.$("body").append(e);e.hide();AJS.enable(e);var b=AJS.$(".aui-blanket"),d=function(a,b){var d=AJS.$(a,b);if(d.length){d.focus();return true}return false},g={changeSize:function(b,d){(b&&b!=c.width||d&&d!=c.height)&&a(b,d);this.show()},show:function(){var a=function(){AJS.$(document).off("keydown",c.keypressListener).on("keydown",c.keypressListener);AJS.dim();b=AJS.$(".aui-blanket");
b.size()!=0&&c.closeOnOutsideClick&&b.click(function(){e.is(":visible")&&g.hide()});e.show();AJS.popup.current=this;var a=e;AJS.$(".dialog-page-body",a).find(":focus").length===0&&(c.focusSelector?d(c.focusSelector,a):d(":input:visible:enabled:first",AJS.$(".dialog-page-body",a))||d(":input:visible:enabled:first",AJS.$(".dialog-button-panel",a))||d(":input:visible:enabled:first",AJS.$(".dialog-page-menu",a)));AJS.$(document).trigger("showLayer",["popup",this])};a.call(this);this.show=a},hide:function(){AJS.$(document).unbind("keydown",
c.keypressListener);b.unbind();this.element.hide();AJS.$(".aui-dialog:visible").size()==0&&AJS.undim();var a=document.activeElement;this.element.has(a).length&&a.blur();AJS.$(document).trigger("hideLayer",["popup",this]);AJS.popup.current=null;this.enable()},element:e,remove:function(){e.remove();this.element=null},disable:function(){if(!this.disabled){this.popupBlanket=AJS.$("<div class='dialog-blanket'> </div>").css({height:e.height(),width:e.width()});e.append(this.popupBlanket);this.disabled=
true}},enable:function(){if(this.disabled){this.disabled=false;this.popupBlanket.remove();this.popupBlanket=null}}};return g};
(function(){function c(a,b,d,g){a.buttonpanel||a.addButtonPanel();this.page=a;this.onclick=d;this._onclick=function(b){return!0===d.call(this,a.dialog,a,b)};this.item=AJS("button",b).addClass("button-panel-button");g&&this.item.addClass(g);"function"==typeof d&&this.item.click(this._onclick);a.buttonpanel.append(this.item);this.id=a.button.length;a.button[this.id]=this}function m(a,b,d,g,c){a.buttonpanel||a.addButtonPanel();c||(c="#");this.page=a;this.onclick=d;this._onclick=function(b){return!0===
d.call(this,a.dialog,a,b)};this.item=AJS("a",b).attr("href",c).addClass("button-panel-link");g&&this.item.addClass(g);"function"==typeof d&&this.item.click(this._onclick);a.buttonpanel.append(this.item);this.id=a.button.length;a.button[this.id]=this}function k(a,b){var d="left"==a?-1:1;return function(a){var c=this.page[b];if(this.id!=(1==d?c.length-1:0)){d*=a||1;c[this.id+d].item[0>d?"before":"after"](this.item);c.splice(this.id,1);c.splice(this.id+d,0,this);for(var a=0,j=c.length;a<j;a++)"panel"==
b&&this.page.curtab==c[a].id&&(this.page.curtab=a),c[a].id=a}return this}}function l(a){return function(){this.page[a].splice(this.id,1);for(var b=0,d=this.page[a].length;b<d;b++)this.page[a][b].id=b;this.item.remove()}}c.prototype.moveUp=c.prototype.moveLeft=k("left","button");c.prototype.moveDown=c.prototype.moveRight=k("right","button");c.prototype.remove=l("button");c.prototype.html=function(a){return this.item.html(a)};c.prototype.onclick=function(a){if("undefined"==typeof a)return this.onclick;
this.item.unbind("click",this._onclick);this._onclick=function(b){return!0===a.call(this,page.dialog,page,b)};"function"==typeof a&&this.item.click(this._onclick)};var e=function(a,b,d,c,e){d instanceof AJS.$||(d=AJS.$(d));this.dialog=a.dialog;this.page=a;this.id=a.panel.length;this.button=AJS("button").html(b).addClass("item-button");e&&(this.button[0].id=e);this.item=AJS("li").append(this.button).addClass("page-menu-item");this.body=AJS("div").append(d).addClass("dialog-panel-body").css("height",
a.dialog.height+"px");this.padding=20;c&&this.body.addClass(c);var b=a.panel.length,j=this;a.menu.append(this.item);a.body.append(this.body);a.panel[b]=this;d=function(){var b;if(a.curtab+1){b=a.panel[a.curtab];b.body.hide();b.item.removeClass("selected");typeof b.onblur=="function"&&b.onblur()}a.curtab=j.id;j.body.show();j.item.addClass("selected");typeof j.onselect=="function"&&j.onselect();typeof a.ontabchange=="function"&&a.ontabchange(j,b)};this.button.click?this.button.click(d):(AJS.log("atlassian-dialog:Panel:constructor - this.button.click false"),
this.button.onclick=d);d();0==b?a.menu.css("display","none"):a.menu.show()};e.prototype.select=function(){this.button.click()};e.prototype.moveUp=e.prototype.moveLeft=k("left","panel");e.prototype.moveDown=e.prototype.moveRight=k("right","panel");e.prototype.remove=l("panel");e.prototype.html=function(a){return a?(this.body.html(a),this):this.body.html()};e.prototype.setPadding=function(a){isNaN(+a)||(this.body.css("padding",+a),this.padding=+a,this.page.recalcSize());return this};var f=function(a,
b){this.dialog=a;this.id=a.page.length;this.element=AJS("div").addClass("dialog-components");this.body=AJS("div").addClass("dialog-page-body");this.menu=AJS("ul").addClass("dialog-page-menu").css("height",a.height+"px");this.body.append(this.menu);this.curtab;this.panel=[];this.button=[];b&&this.body.addClass(b);a.popup.element.append(this.element.append(this.menu).append(this.body));a.page[a.page.length]=this};f.prototype.recalcSize=function(){for(var a=this.header?56:0,b=this.buttonpanel?51:0,d=
this.panel.length;d--;){var c=this.dialog.height-a-b;this.panel[d].body.css("height",c);this.menu.css("height",c)}};f.prototype.addButtonPanel=function(){this.buttonpanel=AJS("div").addClass("dialog-button-panel");this.element.append(this.buttonpanel)};f.prototype.addPanel=function(a,b,d,c){new e(this,a,b,d,c);this.recalcSize();return this};f.prototype.addHeader=function(a,b){this.header&&this.header.remove();this.header=AJS("h2").text(a||"").addClass("dialog-title");b&&this.header.addClass(b);this.element.prepend(this.header);
this.recalcSize();return this};f.prototype.addButton=function(a,b,d){new c(this,a,b,d);this.recalcSize();return this};f.prototype.addLink=function(a,b,d,c){new m(this,a,b,d,c);this.recalcSize();return this};f.prototype.gotoPanel=function(a){this.panel[a.id||a].select()};f.prototype.getCurrentPanel=function(){return this.panel[this.curtab]};f.prototype.hide=function(){this.element.hide()};f.prototype.show=function(){this.element.show()};f.prototype.remove=function(){this.element.remove()};AJS.Dialog=
function(a,b,d){var c={};+a||(c=Object(a),a=c.width,b=c.height,d=c.id);this.height=b||480;this.width=a||640;this.id=d;c=AJS.$.extend({},c,{width:this.width,height:this.height,id:this.id});this.popup=AJS.popup(c);this.popup.element.addClass("aui-dialog");this.page=[];this.curpage=0;new f(this)};AJS.Dialog.prototype.addHeader=function(a,b){this.page[this.curpage].addHeader(a,b);return this};AJS.Dialog.prototype.addButton=function(a,b,d){this.page[this.curpage].addButton(a,b,d);return this};AJS.Dialog.prototype.addLink=
function(a,b,d,c){this.page[this.curpage].addLink(a,b,d,c);return this};AJS.Dialog.prototype.addSubmit=function(a,b){this.page[this.curpage].addButton(a,b,"button-panel-submit-button");return this};AJS.Dialog.prototype.addCancel=function(a,b){this.page[this.curpage].addLink(a,b,"button-panel-cancel-link");return this};AJS.Dialog.prototype.addButtonPanel=function(){this.page[this.curpage].addButtonPanel();return this};AJS.Dialog.prototype.addPanel=function(a,b,d,c){this.page[this.curpage].addPanel(a,
b,d,c);return this};AJS.Dialog.prototype.addPage=function(a){new f(this,a);this.page[this.curpage].hide();this.curpage=this.page.length-1;return this};AJS.Dialog.prototype.nextPage=function(){this.page[this.curpage++].hide();this.curpage>=this.page.length&&(this.curpage=0);this.page[this.curpage].show();return this};AJS.Dialog.prototype.prevPage=function(){this.page[this.curpage--].hide();0>this.curpage&&(this.curpage=this.page.length-1);this.page[this.curpage].show();return this};AJS.Dialog.prototype.gotoPage=
function(a){this.page[this.curpage].hide();this.curpage=a;0>this.curpage?this.curpage=this.page.length-1:this.curpage>=this.page.length&&(this.curpage=0);this.page[this.curpage].show();return this};AJS.Dialog.prototype.getPanel=function(a,b){var d=null==b?this.curpage:a;null==b&&(b=a);return this.page[d].panel[b]};AJS.Dialog.prototype.getPage=function(a){return this.page[a]};AJS.Dialog.prototype.getCurrentPanel=function(){return this.page[this.curpage].getCurrentPanel()};AJS.Dialog.prototype.gotoPanel=
function(a,b){null!=b&&this.gotoPage(a.id||a);this.page[this.curpage].gotoPanel("undefined"==typeof b?a:b)};AJS.Dialog.prototype.show=function(){this.popup.show();AJS.trigger("show.dialog",{dialog:this});return this};AJS.Dialog.prototype.hide=function(){this.popup.hide();AJS.trigger("hide.dialog",{dialog:this});return this};AJS.Dialog.prototype.remove=function(){this.popup.hide();this.popup.remove();AJS.trigger("remove.dialog",{dialog:this})};AJS.Dialog.prototype.disable=function(){this.popup.disable();
return this};AJS.Dialog.prototype.enable=function(){this.popup.enable();return this};AJS.Dialog.prototype.get=function(a){var b=[],d=this;(a+"").replace(RegExp('(?:^|,)\\s*(?:(page|panel|button|header)(?:#([^"][^ ]*|"[^"]*")|:(\\d+))?|#([^"][^ ]*|"[^"]*"))(?:\\s+(?:(page|panel|button|header)(?:#([^"][^ ]*|"[^"]*")|:(\\d+))?|#([^"][^ ]*|"[^"]*")))?\\s*(?=,|$)',"ig"),function(a,c,e,f,g,h,i,k,l){c=c&&c.toLowerCase();a=[];"page"==c&&d.page[f]?(a.push(d.page[f]),c=(c=h)&&c.toLowerCase(),e=i,f=k,g=l):a=
d.page;e=e&&(e+"").replace(/"/g,"");i&&(i+"").replace(/"/g,"");g=g&&(g+"").replace(/"/g,"");l&&(l+"").replace(/"/g,"");if(c||g)for(h=a.length;h--;){if(g||"panel"==c&&(e||!e&&null==f))for(i=a[h].panel.length;i--;)(a[h].panel[i].button.html()==g||a[h].panel[i].button.html()==e||"panel"==c&&!e&&null==f)&&b.push(a[h].panel[i]);if(g||"button"==c&&(e||!e&&null==f))for(i=a[h].button.length;i--;)(a[h].button[i].item.html()==g||a[h].button[i].item.html()==e||"button"==c&&!e&&null==f)&&b.push(a[h].button[i]);
a[h][c]&&a[h][c][f]&&b.push(a[h][c][f]);"header"==c&&a[h].header&&b.push(a[h].header)}else b=b.concat(a)});for(var c={length:b.length},a=b.length;a--;){c[a]=b[a];for(var e in b[a])e in c||function(a){c[a]=function(){for(var b=this.length;b--;)"function"==typeof this[b][a]&&this[b][a].apply(this[b],arguments)}}(e)}return c};AJS.Dialog.prototype.updateHeight=function(){for(var a=0,b=AJS.$(window).height()-56-51-100,c=0;this.getPanel(c);c++)this.getPanel(c).body.css({height:"auto",display:"block"}).outerHeight()>
a&&(a=Math.min(b,this.getPanel(c).body.outerHeight())),c!==this.page[this.curpage].curtab&&this.getPanel(c).body.css({display:"none"});for(c=0;this.getPanel(c);c++)this.getPanel(c).body.css({height:a||this.height});this.page[0].menu.height(a);this.height=a+56+51+1;this.popup.changeSize(void 0,this.height)};AJS.Dialog.prototype.isMaximised=function(){return this.popup.element.outerHeight()>=AJS.$(window).height()-100};AJS.Dialog.prototype.getCurPanel=function(){return this.getPanel(this.page[this.curpage].curtab)};
AJS.Dialog.prototype.getCurPanelButton=function(){return this.getCurPanel().button};AJS.Dialog=AJS.deprecate.construct(AJS.Dialog,"Dialog constructor",{alternativeName:"Dialog2"});AJS.popup=AJS.deprecate.construct(AJS.popup,"Dialog popup constructor",{alternatveName:"Dialog2"})})();;
;
/* module-key = 'com.atlassian.auiplugin:internal-aui-animation', location = 'js/aui/internal/animation.js' */
window.AJS=window.AJS||{};(function(b){b._internal=b._internal||{};b._internal.animation={};b._internal.animation.recomputeStyle=function(a){a=a.length?a[0]:a;window.getComputedStyle(a,null).getPropertyValue("left")}})(AJS);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/jquery/jquery.os.js' */
jQuery.os={};var jQueryOSplatform=navigator.platform.toLowerCase();jQuery.os.windows=-1!=jQueryOSplatform.indexOf("win");jQuery.os.mac=-1!=jQueryOSplatform.indexOf("mac");jQuery.os.linux=-1!=jQueryOSplatform.indexOf("linux");;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js-vendor/jquery/jquery-ui/jquery.ui.core.js' */
(function(b){function h(a,c){var d=a.nodeName.toLowerCase();if("area"===d){var d=a.parentNode,e=d.name;if(!a.href||!e||"map"!==d.nodeName.toLowerCase())return!1;d=b("img[usemap=#"+e+"]")[0];return!!d&&i(d)}return(/input|select|textarea|button|object/.test(d)?!a.disabled:"a"==d?a.href||c:c)&&i(a)}function i(a){return!b(a).parents().andSelf().filter(function(){return"hidden"===b.curCSS(this,"visibility")||b.expr.filters.hidden(this)}).length}b.ui=b.ui||{};b.ui.version||(b.extend(b.ui,{version:"1.8.24",
keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),b.fn.extend({propAttr:b.fn.prop||b.fn.attr,_focus:b.fn.focus,focus:function(a,c){return"number"===typeof a?this.each(function(){var d=
this;setTimeout(function(){b(d).focus();c&&c.call(d)},a)}):this._focus.apply(this,arguments)},scrollParent:function(){var a;a=b.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(b.curCSS(this,"position",1))&&/(auto|scroll)/.test(b.curCSS(this,"overflow",1)+b.curCSS(this,"overflow-y",1)+b.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(b.curCSS(this,
"overflow",1)+b.curCSS(this,"overflow-y",1)+b.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!a.length?b(document):a},zIndex:function(a){if(void 0!==a)return this.css("zIndex",a);if(this.length)for(var a=b(this[0]),c;a.length&&a[0]!==document;){c=a.css("position");if("absolute"===c||"relative"===c||"fixed"===c)if(c=parseInt(a.css("zIndex"),10),!isNaN(c)&&0!==c)return c;a=a.parent()}return 0},disableSelection:function(){return this.bind((b.support.selectstart?"selectstart":
"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),"1.7"===b.fn.jquery.substring(0,3)&&b.each(["Width","Height"],function(a,c){function d(a,c,d,f){b.each(e,function(){c-=parseFloat(b.curCSS(a,"padding"+this,!0))||0;d&&(c-=parseFloat(b.curCSS(a,"border"+this+"Width",!0))||0);f&&(c-=parseFloat(b.curCSS(a,"margin"+this,!0))||0)});return c}var e="Width"===c?["Left","Right"]:["Top","Bottom"],f=c.toLowerCase(),g=
{innerWidth:b.fn.innerWidth,innerHeight:b.fn.innerHeight,outerWidth:b.fn.outerWidth,outerHeight:b.fn.outerHeight};b.fn["inner"+c]=function(a){return void 0===a?g["inner"+c].call(this):this.each(function(){b(this).css(f,d(this,a)+"px")})};b.fn["outer"+c]=function(a,e){return"number"!==typeof a?g["outer"+c].call(this,a):this.each(function(){b(this).css(f,d(this,a,!0,e)+"px")})}}),b.extend(b.expr[":"],{data:b.expr.createPseudo?b.expr.createPseudo(function(a){return function(c){return!!b.data(c,a)}}):
function(a,c,d){return!!b.data(a,d[3])},focusable:function(a){return h(a,!isNaN(b.attr(a,"tabindex")))},tabbable:function(a){var c=b.attr(a,"tabindex"),d=isNaN(c);return(d||0<=c)&&h(a,!d)}}),b(function(){var a=document.body,c=a.appendChild(c=document.createElement("div"));c.offsetHeight;b.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});b.support.minHeight=100===c.offsetHeight;b.support.selectstart="onselectstart"in c;a.removeChild(c).style.display="none"}),b.curCSS||(b.curCSS=
b.css),b.extend(b.ui,{plugin:{add:function(a,c,d){var a=b.ui[a].prototype,e;for(e in d){a.plugins[e]=a.plugins[e]||[];a.plugins[e].push([c,d[e]])}},call:function(a,c,b){if((c=a.plugins[c])&&a.element[0].parentNode)for(var e=0;e<c.length;e++)a.options[c[e][0]]&&c[e][1].apply(a.element,b)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(a,c){if(b(a).css("overflow")==="hidden")return false;var d=c&&c==="left"?"scrollLeft":
"scrollTop",e=false;if(a[d]>0)return true;a[d]=1;e=a[d]>0;a[d]=0;return e},isOverAxis:function(a,b,d){return a>b&&a<b+d},isOver:function(a,c,d,e,f,g){return b.ui.isOverAxis(a,d,f)&&b.ui.isOverAxis(c,e,g)}}))})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js-vendor/jquery/jquery-ui/jquery.ui.widget.js' */
(function(c){if(c.cleanData){var h=c.cleanData;c.cleanData=function(a){for(var b=0,d;null!=(d=a[b]);b++)try{c(d).triggerHandler("remove")}catch(e){}h(a)}}else{var i=c.fn.remove;c.fn.remove=function(a,b){return this.each(function(){b||(!a||c.filter(a,[this]).length)&&c("*",this).add([this]).each(function(){try{c(this).triggerHandler("remove")}catch(a){}});return i.call(c(this),a,b)})}}c.widget=function(a,b,d){var e=a.split(".")[0],f,a=a.split(".")[1];f=e+"-"+a;d||(d=b,b=c.Widget);c.expr[":"][f]=function(b){return!!c.data(b,
a)};c[e]=c[e]||{};c[e][a]=function(a,b){arguments.length&&this._createWidget(a,b)};b=new b;b.options=c.extend(!0,{},b.options);c[e][a].prototype=c.extend(!0,b,{namespace:e,widgetName:a,widgetEventPrefix:c[e][a].prototype.widgetEventPrefix||a,widgetBaseClass:f},d);c.widget.bridge(a,c[e][a])};c.widget.bridge=function(a,b){c.fn[a]=function(d){var e="string"===typeof d,f=Array.prototype.slice.call(arguments,1),g=this,d=!e&&f.length?c.extend.apply(null,[!0,d].concat(f)):d;if(e&&"_"===d.charAt(0))return g;
e?this.each(function(){var b=c.data(this,a),e=b&&c.isFunction(b[d])?b[d].apply(b,f):b;if(e!==b&&void 0!==e)return g=e,!1}):this.each(function(){var e=c.data(this,a);e?e.option(d||{})._init():c.data(this,a,new b(d,this))});return g}};c.Widget=function(a,b){arguments.length&&this._createWidget(a,b)};c.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(a,b){c.data(b,this.widgetName,this);this.element=c(b);this.options=c.extend(!0,{},this.options,this._getCreateOptions(),
a);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return c.metadata&&c.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},
option:function(a,b){var d=a;if(0===arguments.length)return c.extend({},this.options);if("string"===typeof a){if(void 0===b)return this.options[a];d={};d[a]=b}this._setOptions(d);return this},_setOptions:function(a){var b=this;c.each(a,function(a,c){b._setOption(a,c)});return this},_setOption:function(a,b){this.options[a]=b;"disabled"===a&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",b);return this},enable:function(){return this._setOption("disabled",
!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(a,b,d){var e,f=this.options[a],d=d||{},b=c.Event(b);b.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();b.target=this.element[0];if(a=b.originalEvent)for(e in a)e in b||(b[e]=a[e]);this.element.trigger(b,d);return!(c.isFunction(f)&&!1===f.call(this.element[0],b,d)||b.isDefaultPrevented())}}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js-vendor/jquery/jquery-ui/jquery.ui.mouse.js' */
(function(b){var d=!1;b(document).mouseup(function(){d=!1});b.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.bind("mousedown."+this.widgetName,function(b){return a._mouseDown(b)}).bind("click."+this.widgetName,function(c){if(!0===b.data(c.target,a.widgetName+".preventClickEvent"))return b.removeData(c.target,a.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1});this.started=!1},_mouseDestroy:function(){this.element.unbind("."+
this.widgetName);this._mouseMoveDelegate&&b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(a){if(!d){this._mouseStarted&&this._mouseUp(a);this._mouseDownEvent=a;var c=this,e=1==a.which,f="string"==typeof this.options.cancel&&a.target.nodeName?b(a.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(a))return!0;this.mouseDelayMet=!this.options.delay;this.mouseDelayMet||(this._mouseDelayTimer=
setTimeout(function(){c.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=!1!==this._mouseStart(a),!this._mouseStarted))return a.preventDefault(),!0;!0===b.data(a.target,this.widgetName+".preventClickEvent")&&b.removeData(a.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(a){return c._mouseMove(a)};this._mouseUpDelegate=function(a){return c._mouseUp(a)};b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+
this.widgetName,this._mouseUpDelegate);a.preventDefault();return d=!0}},_mouseMove:function(a){if(b.browser.msie&&!(9<=document.documentMode)&&!a.button)return this._mouseUp(a);if(this._mouseStarted)return this._mouseDrag(a),a.preventDefault();this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&((this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,a))?this._mouseDrag(a):this._mouseUp(a));return!this._mouseStarted},_mouseUp:function(a){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+
this.widgetName,this._mouseUpDelegate);this._mouseStarted&&(this._mouseStarted=!1,a.target==this._mouseDownEvent.target&&b.data(a.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(a));return!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js-vendor/jquery/jquery-ui/jquery.ui.draggable.js' */
(function(d){d.widget("ui.draggable",d.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"==this.options.helper&&!/^(?:r|a|f)/.test(this.element.css("position"))&&
(this.element[0].style.position="relative");this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable"))return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(a){var c=this.options;if(this.helper||c.disabled||d(a.target).is(".ui-resizable-handle"))return!1;
this.handle=this._getHandle(a);if(!this.handle)return!1;c.iframeFix&&d(!0===c.iframeFix?"iframe":c.iframeFix).each(function(){d('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(d(this).offset()).appendTo("body")});return!0},_mouseStart:function(a){var c=this.options;this.helper=this._createHelper(a);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();
d.ui.ddmanager&&(d.ui.ddmanager.current=this);this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};d.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(a);
this.originalPageX=a.pageX;this.originalPageY=a.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);c.containment&&this._setContainment();if(!1===this._trigger("start",a))return this._clear(),!1;this._cacheHelperProportions();d.ui.ddmanager&&!c.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a);this._mouseDrag(a,!0);d.ui.ddmanager&&d.ui.ddmanager.dragStart(this,a);return!0},_mouseDrag:function(a,c){this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");
if(!c){var b=this._uiHash();if(!1===this._trigger("drag",a,b))return this._mouseUp({}),!1;this.position=b.position}if(!this.options.axis||"y"!=this.options.axis)this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||"x"!=this.options.axis)this.helper[0].style.top=this.position.top+"px";d.ui.ddmanager&&d.ui.ddmanager.drag(this,a);return!1},_mouseStop:function(a){var c=!1;d.ui.ddmanager&&!this.options.dropBehaviour&&(c=d.ui.ddmanager.drop(this,a));this.dropped&&(c=this.dropped,this.dropped=
!1);for(var b=this.element[0],f=!1;b&&(b=b.parentNode);)b==document&&(f=!0);if(!f&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!c||"valid"==this.options.revert&&c||!0===this.options.revert||d.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)){var e=this;d(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){e._trigger("stop",a)!==false&&e._clear()})}else!1!==this._trigger("stop",a)&&this._clear();return!1},
_mouseUp:function(a){d("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});d.ui.ddmanager&&d.ui.ddmanager.dragStop(this,a);return d.ui.mouse.prototype._mouseUp.call(this,a)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(a){var c=!this.options.handle||!d(this.options.handle,this.element).length?!0:!1;d(this.options.handle,this.element).find("*").andSelf().each(function(){this==a.target&&(c=!0)});
return c},_createHelper:function(a){var c=this.options,a=d.isFunction(c.helper)?d(c.helper.apply(this.element[0],[a])):"clone"==c.helper?this.element.clone().removeAttr("id"):this.element;a.parents("body").length||a.appendTo("parent"==c.appendTo?this.element[0].parentNode:c.appendTo);a[0]!=this.element[0]&&!/(fixed|absolute)/.test(a.css("position"))&&a.css("position","absolute");return a},_adjustOffsetFromHelper:function(a){"string"==typeof a&&(a=a.split(" "));d.isArray(a)&&(a={left:+a[0],top:+a[1]||
0});"left"in a&&(this.offset.click.left=a.left+this.margins.left);"right"in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left);"top"in a&&(this.offset.click.top=a.top+this.margins.top);"bottom"in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();"absolute"==this.cssPosition&&(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],
this.offsetParent[0]))&&(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&d.browser.msie)a={top:0,left:0};return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var a=this.element.position();return{top:a.top-
(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),
height:this.helper.outerHeight()}},_setContainment:function(){var a=this.options;"parent"==a.containment&&(a.containment=this.helper[0].parentNode);if("document"==a.containment||"window"==a.containment)this.containment=["document"==a.containment?0:d(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==a.containment?0:d(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==a.containment?0:d(window).scrollLeft())+d("document"==a.containment?document:
window).width()-this.helperProportions.width-this.margins.left,("document"==a.containment?0:d(window).scrollTop())+(d("document"==a.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(a.containment)&&a.containment.constructor!=Array){var a=d(a.containment),c=a[0];if(c){a.offset();var b="hidden"!=d(c).css("overflow");this.containment=[(parseInt(d(c).css("borderLeftWidth"),10)||0)+(parseInt(d(c).css("paddingLeft"),
10)||0),(parseInt(d(c).css("borderTopWidth"),10)||0)+(parseInt(d(c).css("paddingTop"),10)||0),(b?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(d(c).css("borderLeftWidth"),10)||0)-(parseInt(d(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(d(c).css("borderTopWidth"),10)||0)-(parseInt(d(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];
this.relative_container=a}}else a.containment.constructor==Array&&(this.containment=a.containment)},_convertPositionTo:function(a,c){c||(c=this.position);var b="absolute"==a?1:-1,f="absolute"==this.cssPosition&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*b+this.offset.parent.top*b-(d.browser.safari&&526>d.browser.version&&"fixed"==this.cssPosition?
0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():e?0:f.scrollTop())*b),left:c.left+this.offset.relative.left*b+this.offset.parent.left*b-(d.browser.safari&&526>d.browser.version&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():e?0:f.scrollLeft())*b)}},_generatePosition:function(a){var c=this.options,b="absolute"==this.cssPosition&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,
f=/(html|body)/i.test(b[0].tagName),e=a.pageX,h=a.pageY;if(this.originalPosition){var g;this.containment&&(this.relative_container?(g=this.relative_container.offset(),g=[this.containment[0]+g.left,this.containment[1]+g.top,this.containment[2]+g.left,this.containment[3]+g.top]):g=this.containment,a.pageX-this.offset.click.left<g[0]&&(e=g[0]+this.offset.click.left),a.pageY-this.offset.click.top<g[1]&&(h=g[1]+this.offset.click.top),a.pageX-this.offset.click.left>g[2]&&(e=g[2]+this.offset.click.left),
a.pageY-this.offset.click.top>g[3]&&(h=g[3]+this.offset.click.top));c.grid&&(h=c.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/c.grid[1])*c.grid[1]:this.originalPageY,h=g?!(h-this.offset.click.top<g[1]||h-this.offset.click.top>g[3])?h:!(h-this.offset.click.top<g[1])?h-c.grid[1]:h+c.grid[1]:h,e=c.grid[0]?this.originalPageX+Math.round((e-this.originalPageX)/c.grid[0])*c.grid[0]:this.originalPageX,e=g?!(e-this.offset.click.left<g[0]||e-this.offset.click.left>g[2])?e:!(e-this.offset.click.left<
g[0])?e-c.grid[0]:e+c.grid[0]:e)}return{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(d.browser.safari&&526>d.browser.version&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():f?0:b.scrollTop()),left:e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(d.browser.safari&&526>d.browser.version&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():f?0:b.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");
this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=!1},_trigger:function(a,c,b){b=b||this._uiHash();d.ui.plugin.call(this,a,[c,b]);"drag"==a&&(this.positionAbs=this._convertPositionTo("absolute"));return d.Widget.prototype._trigger.call(this,a,c,b)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});d.extend(d.ui.draggable,{version:"1.8.24"});
d.ui.plugin.add("draggable","connectToSortable",{start:function(a,c){var b=d(this).data("draggable"),f=b.options,e=d.extend({},c,{item:b.element});b.sortables=[];d(f.connectToSortable).each(function(){var c=d.data(this,"sortable");c&&!c.options.disabled&&(b.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",a,e))})},stop:function(a,c){var b=d(this).data("draggable"),f=d.extend({},c,{item:b.element});d.each(b.sortables,function(){this.instance.isOver?
(this.instance.isOver=0,b.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(a),this.instance.options.helper=this.instance.options._helper,"original"==b.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",a,f))})},drag:function(a,c){var b=d(this).data("draggable"),f=this;d.each(b.sortables,function(){this.instance.positionAbs=
b.positionAbs;this.instance.helperProportions=b.helperProportions;this.instance.offset.click=b.offset.click;this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=d(f).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},a.target=this.instance.currentItem[0],this.instance._mouseCapture(a,
!0),this.instance._mouseStart(a,!0,!0),this.instance.offset.click.top=b.offset.click.top,this.instance.offset.click.left=b.offset.click.left,this.instance.offset.parent.left-=b.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=b.offset.parent.top-this.instance.offset.parent.top,b._trigger("toSortable",a),b.dropped=this.instance.element,b.currentItem=b.element,this.instance.fromOutside=b),this.instance.currentItem&&this.instance._mouseDrag(a)):this.instance.isOver&&
(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",a,this.instance._uiHash(this.instance)),this.instance._mouseStop(a,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),b._trigger("fromSortable",a),b.dropped=!1)})}});d.ui.plugin.add("draggable","cursor",{start:function(){var a=d("body"),c=d(this).data("draggable").options;
a.css("cursor")&&(c._cursor=a.css("cursor"));a.css("cursor",c.cursor)},stop:function(){var a=d(this).data("draggable").options;a._cursor&&d("body").css("cursor",a._cursor)}});d.ui.plugin.add("draggable","opacity",{start:function(a,c){var b=d(c.helper),f=d(this).data("draggable").options;b.css("opacity")&&(f._opacity=b.css("opacity"));b.css("opacity",f.opacity)},stop:function(a,c){var b=d(this).data("draggable").options;b._opacity&&d(c.helper).css("opacity",b._opacity)}});d.ui.plugin.add("draggable",
"scroll",{start:function(){var a=d(this).data("draggable");a.scrollParent[0]!=document&&"HTML"!=a.scrollParent[0].tagName&&(a.overflowOffset=a.scrollParent.offset())},drag:function(a){var c=d(this).data("draggable"),b=c.options,f=!1;if(c.scrollParent[0]!=document&&"HTML"!=c.scrollParent[0].tagName){if(!b.axis||"x"!=b.axis)c.overflowOffset.top+c.scrollParent[0].offsetHeight-a.pageY<b.scrollSensitivity?c.scrollParent[0].scrollTop=f=c.scrollParent[0].scrollTop+b.scrollSpeed:a.pageY-c.overflowOffset.top<
b.scrollSensitivity&&(c.scrollParent[0].scrollTop=f=c.scrollParent[0].scrollTop-b.scrollSpeed);if(!b.axis||"y"!=b.axis)c.overflowOffset.left+c.scrollParent[0].offsetWidth-a.pageX<b.scrollSensitivity?c.scrollParent[0].scrollLeft=f=c.scrollParent[0].scrollLeft+b.scrollSpeed:a.pageX-c.overflowOffset.left<b.scrollSensitivity&&(c.scrollParent[0].scrollLeft=f=c.scrollParent[0].scrollLeft-b.scrollSpeed)}else{if(!b.axis||"x"!=b.axis)a.pageY-d(document).scrollTop()<b.scrollSensitivity?f=d(document).scrollTop(d(document).scrollTop()-
b.scrollSpeed):d(window).height()-(a.pageY-d(document).scrollTop())<b.scrollSensitivity&&(f=d(document).scrollTop(d(document).scrollTop()+b.scrollSpeed));if(!b.axis||"y"!=b.axis)a.pageX-d(document).scrollLeft()<b.scrollSensitivity?f=d(document).scrollLeft(d(document).scrollLeft()-b.scrollSpeed):d(window).width()-(a.pageX-d(document).scrollLeft())<b.scrollSensitivity&&(f=d(document).scrollLeft(d(document).scrollLeft()+b.scrollSpeed))}!1!==f&&(d.ui.ddmanager&&!b.dropBehaviour)&&d.ui.ddmanager.prepareOffsets(c,
a)}});d.ui.plugin.add("draggable","snap",{start:function(){var a=d(this).data("draggable"),c=a.options;a.snapElements=[];d(c.snap.constructor!=String?c.snap.items||":data(draggable)":c.snap).each(function(){var b=d(this),c=b.offset();this!=a.element[0]&&a.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(a,c){for(var b=d(this).data("draggable"),f=b.options,e=f.snapTolerance,h=c.offset.left,g=h+b.helperProportions.width,n=c.offset.top,
o=n+b.helperProportions.height,i=b.snapElements.length-1;0<=i;i--){var j=b.snapElements[i].left,l=j+b.snapElements[i].width,k=b.snapElements[i].top,m=k+b.snapElements[i].height;if(j-e<h&&h<l+e&&k-e<n&&n<m+e||j-e<h&&h<l+e&&k-e<o&&o<m+e||j-e<g&&g<l+e&&k-e<n&&n<m+e||j-e<g&&g<l+e&&k-e<o&&o<m+e){if("inner"!=f.snapMode){var p=Math.abs(k-o)<=e,q=Math.abs(m-n)<=e,r=Math.abs(j-g)<=e,s=Math.abs(l-h)<=e;p&&(c.position.top=b._convertPositionTo("relative",{top:k-b.helperProportions.height,left:0}).top-b.margins.top);
q&&(c.position.top=b._convertPositionTo("relative",{top:m,left:0}).top-b.margins.top);r&&(c.position.left=b._convertPositionTo("relative",{top:0,left:j-b.helperProportions.width}).left-b.margins.left);s&&(c.position.left=b._convertPositionTo("relative",{top:0,left:l}).left-b.margins.left)}var t=p||q||r||s;if("outer"!=f.snapMode&&(p=Math.abs(k-n)<=e,q=Math.abs(m-o)<=e,r=Math.abs(j-h)<=e,s=Math.abs(l-g)<=e,p&&(c.position.top=b._convertPositionTo("relative",{top:k,left:0}).top-b.margins.top),q&&(c.position.top=
b._convertPositionTo("relative",{top:m-b.helperProportions.height,left:0}).top-b.margins.top),r&&(c.position.left=b._convertPositionTo("relative",{top:0,left:j}).left-b.margins.left),s))c.position.left=b._convertPositionTo("relative",{top:0,left:l-b.helperProportions.width}).left-b.margins.left;!b.snapElements[i].snapping&&(p||q||r||s||t)&&b.options.snap.snap&&b.options.snap.snap.call(b.element,a,d.extend(b._uiHash(),{snapItem:b.snapElements[i].item}));b.snapElements[i].snapping=p||q||r||s||t}else b.snapElements[i].snapping&&
b.options.snap.release&&b.options.snap.release.call(b.element,a,d.extend(b._uiHash(),{snapItem:b.snapElements[i].item})),b.snapElements[i].snapping=!1}}});d.ui.plugin.add("draggable","stack",{start:function(){var a=d(this).data("draggable").options,a=d.makeArray(d(a.stack)).sort(function(a,c){return(parseInt(d(a).css("zIndex"),10)||0)-(parseInt(d(c).css("zIndex"),10)||0)});if(a.length){var c=parseInt(a[0].style.zIndex)||0;d(a).each(function(a){this.style.zIndex=c+a});this[0].style.zIndex=c+a.length}}});
d.ui.plugin.add("draggable","zIndex",{start:function(a,c){var b=d(c.helper),f=d(this).data("draggable").options;b.css("zIndex")&&(f._zIndex=b.css("zIndex"));b.css("zIndex",f.zIndex)},stop:function(a,c){var b=d(this).data("draggable").options;b._zIndex&&d(c.helper).css("zIndex",b._zIndex)}})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js-vendor/jquery/jquery-ui/jquery.ui.sortable.js' */
(function(d){d.widget("ui.sortable",d.ui.mouse,{widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3},_create:function(){var a=this.options;this.containerCache={};this.element.addClass("ui-sortable");
this.refresh();this.floating=this.items.length?"x"===a.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1;this.offset=this.element.offset();this._mouseInit();this.ready=!0},destroy:function(){d.Widget.prototype.destroy.call(this);this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var a=this.items.length-1;0<=a;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(a,
b){"disabled"===a?(this.options[a]=b,this.widget()[b?"addClass":"removeClass"]("ui-sortable-disabled")):d.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(a,b){var c=this;if(this.reverting||this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(a);var e=null,f=this;d(a.target).parents().each(function(){if(d.data(this,c.widgetName+"-item")==f)return e=d(this),!1});d.data(a.target,c.widgetName+"-item")==f&&(e=d(a.target));if(!e)return!1;if(this.options.handle&&
!b){var g=!1;d(this.options.handle,e).find("*").andSelf().each(function(){this==a.target&&(g=!0)});if(!g)return!1}this.currentItem=e;this._removeCurrentsFromItems();return!0},_mouseStart:function(a,b,c){b=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(a);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-
this.margins.left};d.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(a);this.originalPageX=a.pageX;this.originalPageY=a.pageY;b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};
this.helper[0]!=this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();b.containment&&this._setContainment();b.cursor&&(d("body").css("cursor")&&(this._storedCursor=d("body").css("cursor")),d("body").css("cursor",b.cursor));b.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",b.opacity));b.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",b.zIndex));this.scrollParent[0]!=
document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset());this._trigger("start",a,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!c)for(c=this.containers.length-1;0<=c;c--)this.containers[c]._trigger("activate",a,this._uiHash(this));d.ui.ddmanager&&(d.ui.ddmanager.current=this);d.ui.ddmanager&&!b.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a);this.dragging=!0;this.helper.addClass("ui-sortable-helper");this._mouseDrag(a);
return!0},_mouseDrag:function(a){this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var b=this.options,c=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-a.pageY<b.scrollSensitivity?this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop+b.scrollSpeed:a.pageY-this.overflowOffset.top<
b.scrollSensitivity&&(this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop-b.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-a.pageX<b.scrollSensitivity)?this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft+b.scrollSpeed:a.pageX-this.overflowOffset.left<b.scrollSensitivity&&(this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft-b.scrollSpeed):(a.pageY-d(document).scrollTop()<b.scrollSensitivity?c=d(document).scrollTop(d(document).scrollTop()-
b.scrollSpeed):d(window).height()-(a.pageY-d(document).scrollTop())<b.scrollSensitivity&&(c=d(document).scrollTop(d(document).scrollTop()+b.scrollSpeed)),a.pageX-d(document).scrollLeft()<b.scrollSensitivity?c=d(document).scrollLeft(d(document).scrollLeft()-b.scrollSpeed):d(window).width()-(a.pageX-d(document).scrollLeft())<b.scrollSensitivity&&(c=d(document).scrollLeft(d(document).scrollLeft()+b.scrollSpeed)));!1!==c&&(d.ui.ddmanager&&!b.dropBehaviour)&&d.ui.ddmanager.prepareOffsets(this,a)}this.positionAbs=
this._convertPositionTo("absolute");if(!this.options.axis||"y"!=this.options.axis)this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||"x"!=this.options.axis)this.helper[0].style.top=this.position.top+"px";for(b=this.items.length-1;0<=b;b--){var c=this.items[b],e=c.item[0],f=this._intersectsWithPointer(c);if(f&&c.instance===this.currentContainer&&e!=this.currentItem[0]&&this.placeholder[1==f?"next":"prev"]()[0]!=e&&!d.ui.contains(this.placeholder[0],e)&&("semi-dynamic"==this.options.type?
!d.ui.contains(this.element[0],e):1)){this.direction=1==f?"down":"up";if("pointer"==this.options.tolerance||this._intersectsWithSides(c))this._rearrange(a,c);else break;this._trigger("change",a,this._uiHash());break}}this._contactContainers(a);d.ui.ddmanager&&d.ui.ddmanager.drag(this,a);this._trigger("sort",a,this._uiHash());this.lastPositionAbs=this.positionAbs;return!1},_mouseStop:function(a,b){if(a){d.ui.ddmanager&&!this.options.dropBehaviour&&d.ui.ddmanager.drop(this,a);if(this.options.revert){var c=
this,e=c.placeholder.offset();c.reverting=!0;d(this.helper).animate({left:e.left-this.offset.parent.left-c.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-c.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){c._clear(a)})}else this._clear(a,b);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null});"original"==this.options.helper?
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var a=this.containers.length-1;0<=a;a--)this.containers[a]._trigger("deactivate",null,this._uiHash(this)),this.containers[a].containerCache.over&&(this.containers[a]._trigger("out",null,this._uiHash(this)),this.containers[a].containerCache.over=0)}this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&(this.helper&&
this.helper[0].parentNode)&&this.helper.remove(),d.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?d(this.domPosition.prev).after(this.currentItem):d(this.domPosition.parent).prepend(this.currentItem));return this},serialize:function(a){var b=this._getItemsAsjQuery(a&&a.connected),c=[],a=a||{};d(b).each(function(){var b=(d(a.item||this).attr(a.attribute||"id")||"").match(a.expression||/(.+)[-=_](.+)/);b&&c.push((a.key||b[1]+"[]")+"="+(a.key&&a.expression?
b[1]:b[2]))});!c.length&&a.key&&c.push(a.key+"=");return c.join("&")},toArray:function(a){var b=this._getItemsAsjQuery(a&&a.connected),c=[],a=a||{};b.each(function(){c.push(d(a.item||this).attr(a.attribute||"id")||"")});return c},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,f=d+this.helperProportions.height,g=a.left,h=g+a.width,i=a.top,j=i+a.height,k=this.offset.click.top,l=this.offset.click.left;return"pointer"==this.options.tolerance||
this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?d+k>i&&d+k<j&&b+l>g&&b+l<h:g<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<h&&i<d+this.helperProportions.height/2&&f-this.helperProportions.height/2<j},_intersectsWithPointer:function(a){var b="x"===this.options.axis||d.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height),a="y"===this.options.axis||
d.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width),b=b&&a,a=this._getDragVerticalDirection(),c=this._getDragHorizontalDirection();return!b?!1:this.floating?c&&"right"==c||"down"==a?2:1:a&&("down"==a?2:1)},_intersectsWithSides:function(a){var b=d.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),a=d.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),c=this._getDragVerticalDirection(),e=this._getDragHorizontalDirection();
return this.floating&&e?"right"==e&&a||"left"==e&&!a:c&&("down"==c&&b||"up"==c&&!b)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!=a&&(0<a?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!=a&&(0<a?"right":"left")},refresh:function(a){this._refreshItems(a);this.refreshPositions();return this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:
a.connectWith},_getItemsAsjQuery:function(a){var b=[],c=[],e=this._connectWith();if(e&&a)for(a=e.length-1;0<=a;a--)for(var f=d(e[a]),g=f.length-1;0<=g;g--){var h=d.data(f[g],this.widgetName);h&&(h!=this&&!h.options.disabled)&&c.push([d.isFunction(h.options.items)?h.options.items.call(h.element):d(h.options.items,h.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),h])}c.push([d.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):
d(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(a=c.length-1;0<=a;a--)c[a][0].each(function(){b.push(this)});return d(b)},_removeCurrentsFromItems:function(){for(var a=this.currentItem.find(":data("+this.widgetName+"-item)"),b=0;b<this.items.length;b++)for(var c=0;c<a.length;c++)a[c]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(a){this.items=[];this.containers=[this];var b=this.items,c=[[d.isFunction(this.options.items)?
this.options.items.call(this.element[0],a,{item:this.currentItem}):d(this.options.items,this.element),this]],e=this._connectWith();if(e&&this.ready)for(var f=e.length-1;0<=f;f--)for(var g=d(e[f]),h=g.length-1;0<=h;h--){var i=d.data(g[h],this.widgetName);i&&(i!=this&&!i.options.disabled)&&(c.push([d.isFunction(i.options.items)?i.options.items.call(i.element[0],a,{item:this.currentItem}):d(i.options.items,i.element),i]),this.containers.push(i))}for(f=c.length-1;0<=f;f--){a=c[f][1];e=c[f][0];h=0;for(g=
e.length;h<g;h++)i=d(e[h]),i.data(this.widgetName+"-item",a),b.push({item:i,instance:a,width:0,height:0,left:0,top:0})}},refreshPositions:function(a){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var b=this.items.length-1;0<=b;b--){var c=this.items[b];if(!(c.instance!=this.currentContainer&&this.currentContainer&&c.item[0]!=this.currentItem[0])){var e=this.options.toleranceElement?d(this.options.toleranceElement,c.item):c.item;a||(c.width=e.outerWidth(),c.height=
e.outerHeight());e=e.offset();c.left=e.left;c.top=e.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(b=this.containers.length-1;0<=b;b--)e=this.containers[b].element.offset(),this.containers[b].containerCache.left=e.left,this.containers[b].containerCache.top=e.top,this.containers[b].containerCache.width=this.containers[b].element.outerWidth(),this.containers[b].containerCache.height=this.containers[b].element.outerHeight();
return this},_createPlaceholder:function(a){var b=a||this,c=b.options;if(!c.placeholder||c.placeholder.constructor==String){var e=c.placeholder;c.placeholder={element:function(){var a=d(document.createElement(b.currentItem[0].nodeName)).addClass(e||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];e||(a.style.visibility="hidden");return a},update:function(a,d){if(!e||c.forcePlaceholderSize)d.height()||d.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||
0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),d.width()||d.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10))}}}b.placeholder=d(c.placeholder.element.call(b.element,b.currentItem));b.currentItem.after(b.placeholder);c.placeholder.update(b,b.placeholder)},_contactContainers:function(a){for(var b=null,c=null,e=this.containers.length-1;0<=e;e--)if(!d.ui.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(!b||
!d.ui.contains(this.containers[e].element[0],b.element[0]))b=this.containers[e],c=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",a,this._uiHash(this)),this.containers[e].containerCache.over=0);if(b)if(1===this.containers.length)this.containers[c]._trigger("over",a,this._uiHash(this)),this.containers[c].containerCache.over=1;else if(this.currentContainer!=this.containers[c]){for(var b=1E4,e=null,f=this.positionAbs[this.containers[c].floating?"left":"top"],g=this.items.length-
1;0<=g;g--)if(d.ui.contains(this.containers[c].element[0],this.items[g].item[0])){var h=this.containers[c].floating?this.items[g].item.offset().left:this.items[g].item.offset().top;Math.abs(h-f)<b&&(b=Math.abs(h-f),e=this.items[g],this.direction=0<h-f?"down":"up")}if(e||this.options.dropOnEmpty)this.currentContainer=this.containers[c],e?this._rearrange(a,e,null,!0):this._rearrange(a,null,this.containers[c].element,!0),this._trigger("change",a,this._uiHash()),this.containers[c]._trigger("change",a,
this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[c]._trigger("over",a,this._uiHash(this)),this.containers[c].containerCache.over=1}},_createHelper:function(a){var b=this.options,a=d.isFunction(b.helper)?d(b.helper.apply(this.element[0],[a,this.currentItem])):"clone"==b.helper?this.currentItem.clone():this.currentItem;a.parents("body").length||d("parent"!=b.appendTo?b.appendTo:this.currentItem[0].parentNode)[0].appendChild(a[0]);a[0]==this.currentItem[0]&&
(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")});(""==a[0].style.width||b.forceHelperSize)&&a.width(this.currentItem.width());(""==a[0].style.height||b.forceHelperSize)&&a.height(this.currentItem.height());return a},_adjustOffsetFromHelper:function(a){"string"==typeof a&&(a=a.split(" "));d.isArray(a)&&(a={left:+a[0],top:+a[1]||0});"left"in a&&
(this.offset.click.left=a.left+this.margins.left);"right"in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left);"top"in a&&(this.offset.click.top=a.top+this.margins.top);"bottom"in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();"absolute"==this.cssPosition&&(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))&&
(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&d.browser.msie)a={top:0,left:0};return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),
10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a=this.options;"parent"==a.containment&&(a.containment=
this.helper[0].parentNode);if("document"==a.containment||"window"==a.containment)this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,d("document"==a.containment?document:window).width()-this.helperProportions.width-this.margins.left,(d("document"==a.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(a.containment)){var b=
d(a.containment)[0],a=d(a.containment).offset(),c="hidden"!=d(b).css("overflow");this.containment=[a.left+(parseInt(d(b).css("borderLeftWidth"),10)||0)+(parseInt(d(b).css("paddingLeft"),10)||0)-this.margins.left,a.top+(parseInt(d(b).css("borderTopWidth"),10)||0)+(parseInt(d(b).css("paddingTop"),10)||0)-this.margins.top,a.left+(c?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(d(b).css("borderLeftWidth"),10)||0)-(parseInt(d(b).css("paddingRight"),10)||0)-this.helperProportions.width-
this.margins.left,a.top+(c?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(d(b).css("borderTopWidth"),10)||0)-(parseInt(d(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"==a?1:-1,e="absolute"==this.cssPosition&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(e[0].tagName);return{top:b.top+
this.offset.relative.top*c+this.offset.parent.top*c-(d.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*c),left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-(d.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*c)}},_generatePosition:function(a){var b=this.options,c="absolute"==this.cssPosition&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],
this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(c[0].tagName);"relative"==this.cssPosition&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var f=a.pageX,g=a.pageY;if(this.originalPosition&&(this.containment&&(a.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),a.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),
a.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),a.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),b.grid))g=this.originalPageY+Math.round((g-this.originalPageY)/b.grid[1])*b.grid[1],g=this.containment?!(g-this.offset.click.top<this.containment[1]||g-this.offset.click.top>this.containment[3])?g:!(g-this.offset.click.top<this.containment[1])?g-b.grid[1]:g+b.grid[1]:g,f=this.originalPageX+Math.round((f-
this.originalPageX)/b.grid[0])*b.grid[0],f=this.containment?!(f-this.offset.click.left<this.containment[0]||f-this.offset.click.left>this.containment[2])?f:!(f-this.offset.click.left<this.containment[0])?f-b.grid[0]:f+b.grid[0]:f;return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(d.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():e?0:c.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+
(d.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():e?0:c.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?b.item[0]:b.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var f=this,g=this.counter;window.setTimeout(function(){g==f.counter&&f.refreshPositions(!d)},0)},_clear:function(a,b){this.reverting=!1;var c=[];!this._noFinalSort&&
this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var e in this._storedCSS)if("auto"==this._storedCSS[e]||"static"==this._storedCSS[e])this._storedCSS[e]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!b&&c.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))});(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||
this.domPosition.parent!=this.currentItem.parent()[0])&&!b&&c.push(function(a){this._trigger("update",a,this._uiHash())});this!==this.currentContainer&&!b&&(c.push(function(a){this._trigger("remove",a,this._uiHash())}),c.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),c.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)));for(e=this.containers.length-1;0<=e;e--)b||c.push(function(a){return function(b){a._trigger("deactivate",
b,this._uiHash(this))}}.call(this,this.containers[e])),this.containers[e].containerCache.over&&(c.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[e])),this.containers[e].containerCache.over=0);this._storedCursor&&d("body").css("cursor",this._storedCursor);this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex);this.dragging=!1;if(this.cancelHelperRemoval){if(!b){this._trigger("beforeStop",
a,this._uiHash());for(e=0;e<c.length;e++)c[e].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1}b||this._trigger("beforeStop",a,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!=this.currentItem[0]&&this.helper.remove();this.helper=null;if(!b){for(e=0;e<c.length;e++)c[e].call(this,a);this._trigger("stop",a,this._uiHash())}this.fromOutside=!1;return!0},_trigger:function(){!1===d.Widget.prototype._trigger.apply(this,arguments)&&
this.cancel()},_uiHash:function(a){var b=a||this;return{helper:b.helper,placeholder:b.placeholder||d([]),position:b.position,originalPosition:b.originalPosition,offset:b.positionAbs,item:b.currentItem,sender:a?a.element:null}}});d.extend(d.ui.sortable,{version:"1.8.24"})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js-vendor/jquery/plugins/jquery.form.js' */
(function(b){function m(){if(b.fn.ajaxSubmit.debug){var a="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(a):window.opera&&window.opera.postError&&window.opera.postError(a)}}b.fn.ajaxSubmit=function(a){function f(){function d(){var a=j.attr("target"),k=j.attr("action");c.setAttribute("target",f);"POST"!=c.getAttribute("method")&&c.setAttribute("method","POST");c.getAttribute("action")!=e.url&&c.setAttribute("action",e.url);e.skipEncodingOverride||
j.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});e.timeout&&setTimeout(function(){s=!0;g()},e.timeout);var l=[];try{if(e.extraData)for(var m in e.extraData)l.push(b('<input type="hidden" name="'+m+'" value="'+e.extraData[m]+'" />').appendTo(c)[0]);i.appendTo("body");h.attachEvent?h.attachEvent("onload",g):h.addEventListener("load",g,!1);c.submit()}finally{c.setAttribute("action",k),a?c.setAttribute("target",a):j.removeAttr("target"),b(l).remove()}}function g(){if(!k.aborted){var a=
h.contentWindow?h.contentWindow.document:h.contentDocument?h.contentDocument:h.document;if(a&&a.location.href!=e.iframeSrc){h.detachEvent?h.detachEvent("onload",g):h.removeEventListener("load",g,!1);var d=!0;try{if(s)throw"timeout";var c="xml"==e.dataType||a.XMLDocument||b.isXMLDoc(a);m("isXml="+c);if(!c&&(window.opera&&(null==a.body||""==a.body.innerHTML))&&--w){m("requeing onLoad callback, DOM not available");setTimeout(g,250);return}k.responseText=a.body?a.body.innerHTML:a.documentElement?a.documentElement.innerHTML:
null;k.responseXML=a.XMLDocument?a.XMLDocument:a;k.getResponseHeader=function(a){return{"content-type":e.dataType}[a]};var f=/(json|script)/.test(e.dataType);if(f||e.textarea){var j=a.getElementsByTagName("textarea")[0];if(j)k.responseText=j.value;else if(f){var o=a.getElementsByTagName("pre")[0],q=a.getElementsByTagName("body")[0];o?k.responseText=o.textContent:q&&(k.responseText=q.innerHTML)}}else"xml"==e.dataType&&(!k.responseXML&&null!=k.responseText)&&(k.responseXML=x(k.responseText));var a=
k,p=e.dataType,c=e,t=a.getResponseHeader("content-type")||"",u="xml"===p||!p&&0<=t.indexOf("xml"),n=u?a.responseXML:a.responseText;u&&"parsererror"===n.documentElement.nodeName&&b.error&&b.error("parsererror");c&&c.dataFilter&&(n=c.dataFilter(n,p));"string"===typeof n&&("json"===p||!p&&0<=t.indexOf("json")?n=y(n):("script"===p||!p&&0<=t.indexOf("javascript"))&&b.globalEval(n));v=n}catch(r){m("error caught:",r),d=!1,k.error=r,e.error&&e.error.call(e.context,k,"error",r),l&&b.event.trigger("ajaxError",
[k,e,r])}k.aborted&&(m("upload aborted"),d=!1);d&&(e.success&&e.success.call(e.context,v,"success",k),l&&b.event.trigger("ajaxSuccess",[k,e]));l&&b.event.trigger("ajaxComplete",[k,e]);l&&!--b.active&&b.event.trigger("ajaxStop");e.complete&&e.complete.call(e.context,k,d?"success":"error");setTimeout(function(){i.removeData("form-plugin-onload");i.remove();k.responseXML=null},100)}}}var c=j[0];if(b(":input[name=submit],:input[id=submit]",c).length)alert('Error: Form elements must not have name or id of "submit".');
else{var e=b.extend(!0,{},b.ajaxSettings,a);e.context=e.context||e;var f="jqFormIO"+(new Date).getTime(),i=b('<iframe id="'+f+'" name="'+f+'" src="'+e.iframeSrc+'" />'),h=i[0];i.css({position:"absolute",top:"-1000px",left:"-1000px"});var k={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){m("aborting upload...");this.aborted=1;i.attr("src",e.iframeSrc);k.error="aborted";
e.error&&e.error.call(e.context,k,"error","aborted");l&&b.event.trigger("ajaxError",[k,e,"aborted"]);e.complete&&e.complete.call(e.context,k,"error")}},l=e.global;l&&!b.active++&&b.event.trigger("ajaxStart");l&&b.event.trigger("ajaxSend",[k,e]);if(e.beforeSend&&!1===e.beforeSend.call(e.context,k,e))e.global&&b.active--;else if(!k.aborted){var s=0,o=c.clk;if(o){var q=o.name;q&&!o.disabled&&(e.extraData=e.extraData||{},e.extraData[q]=o.value,"image"==o.type&&(e.extraData[q+".x"]=c.clk_x,e.extraData[q+
".y"]=c.clk_y))}e.forceSync?d():setTimeout(d,10);var v,w=50,x=b.parseXML||function(a,b){window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml");return b&&b.documentElement&&"parsererror"!=b.documentElement.nodeName?b:null},y=b.parseJSON||function(a){return window.eval("("+a+")")}}}}if(!this.length)return m("ajaxSubmit: skipping submit process - no element selected"),this;"function"==typeof a&&(a={success:a});var c=
this.attr("action");(c="string"===typeof c?b.trim(c):"")&&(c=(c.match(/^([^#]+)/)||[])[1]);c=c||window.location.href||"";a=b.extend(!0,{url:c,type:this[0].getAttribute("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},a);c={};this.trigger("form-pre-serialize",[this,a,c]);if(c.veto)return m("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(a.beforeSerialize&&!1===a.beforeSerialize(this,a))return m("ajaxSubmit: submit aborted via beforeSerialize callback"),
this;var d,g,i=this.formToArray(a.semantic);if(a.data)for(d in a.extraData=a.data,a.data)if(a.data[d]instanceof Array)for(var h in a.data[d])i.push({name:d,value:a.data[d][h]});else g=a.data[d],g=b.isFunction(g)?g():g,i.push({name:d,value:g});if(a.beforeSubmit&&!1===a.beforeSubmit(i,this,a))return m("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[i,this,a,c]);if(c.veto)return m("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;d=b.param(i);
"GET"==a.type.toUpperCase()?(a.url+=(0<=a.url.indexOf("?")?"&":"?")+d,a.data=null):a.data=d;var j=this,l=[];a.resetForm&&l.push(function(){j.resetForm()});a.clearForm&&l.push(function(){j.clearForm()});if(!a.dataType&&a.target){var s=a.success||function(){};l.push(function(d){var c=a.replaceTarget?"replaceWith":"html";b(a.target)[c](d).each(s,arguments)})}else a.success&&l.push(a.success);a.success=function(b,d,c){for(var e=a.context||a,g=0,f=l.length;g<f;g++)l[g].apply(e,[b,d,c||j,j])};d=0<b("input:file",
this).length;h="multipart/form-data"==j.attr("enctype")||"multipart/form-data"==j.attr("encoding");!1!==a.iframe&&(d||a.iframe||h)?a.closeKeepAlive?b.get(a.closeKeepAlive,f):f():b.ajax(a);this.trigger("form-submit-notify",[this,a]);return this};b.fn.ajaxForm=function(a){if(0===this.length){var f=this.selector,c=this.context;if(!b.isReady&&f)return m("DOM not ready, queuing ajaxForm"),b(function(){b(f,c).ajaxForm(a)}),this;m("terminating; zero elements found by selector"+(b.isReady?"":" (DOM not ready)"));
return this}return this.ajaxFormUnbind().bind("submit.form-plugin",function(d){d.isDefaultPrevented()||(d.preventDefault(),b(this).ajaxSubmit(a))}).bind("click.form-plugin",function(a){var c=a.target,f=b(c);if(!f.is(":submit,input:image")){c=f.closest(":submit");if(0==c.length)return;c=c[0]}var h=this;h.clk=c;"image"==c.type&&(void 0!=a.offsetX?(h.clk_x=a.offsetX,h.clk_y=a.offsetY):"function"==typeof b.fn.offset?(f=f.offset(),h.clk_x=a.pageX-f.left,h.clk_y=a.pageY-f.top):(h.clk_x=a.pageX-c.offsetLeft,
h.clk_y=a.pageY-c.offsetTop));setTimeout(function(){h.clk=h.clk_x=h.clk_y=null},100)})};b.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};b.fn.formToArray=function(a){var f=[];if(0===this.length)return f;var c=this[0],d=a?c.getElementsByTagName("*"):c.elements;if(!d)return f;var g,i,h,j,l,m;g=0;for(l=d.length;g<l;g++)if(i=d[g],h=i.name)if(a&&c.clk&&"image"==i.type)!i.disabled&&c.clk==i&&(f.push({name:h,value:b(i).val()}),f.push({name:h+".x",value:c.clk_x},
{name:h+".y",value:c.clk_y}));else if((j=b.fieldValue(i,!0))&&j.constructor==Array){i=0;for(m=j.length;i<m;i++)f.push({name:h,value:j[i]})}else null!==j&&"undefined"!=typeof j&&f.push({name:h,value:j});if(!a&&c.clk&&(a=b(c.clk),d=a[0],(h=d.name)&&!d.disabled&&"image"==d.type))f.push({name:h,value:a.val()}),f.push({name:h+".x",value:c.clk_x},{name:h+".y",value:c.clk_y});return f};b.fn.formSerialize=function(a){return b.param(this.formToArray(a))};b.fn.fieldSerialize=function(a){var f=[];this.each(function(){var c=
this.name;if(c){var d=b.fieldValue(this,a);if(d&&d.constructor==Array)for(var g=0,i=d.length;g<i;g++)f.push({name:c,value:d[g]});else null!==d&&"undefined"!=typeof d&&f.push({name:this.name,value:d})}});return b.param(f)};b.fn.fieldValue=function(a){for(var f=[],c=0,d=this.length;c<d;c++){var g=b.fieldValue(this[c],a);null===g||("undefined"==typeof g||g.constructor==Array&&!g.length)||(g.constructor==Array?b.merge(f,g):f.push(g))}return f};b.fieldValue=function(a,f){var c=a.name,d=a.type,g=a.tagName.toLowerCase();
void 0===f&&(f=!0);if(f&&(!c||a.disabled||"reset"==d||"button"==d||("checkbox"==d||"radio"==d)&&!a.checked||("submit"==d||"image"==d)&&a.form&&a.form.clk!=a||"select"==g&&-1==a.selectedIndex))return null;if("select"==g){var i=a.selectedIndex;if(0>i)return null;for(var c=[],g=a.options,h=(d="select-one"==d)?i+1:g.length,i=d?i:0;i<h;i++){var j=g[i];if(j.selected){var l=j.value;l||(l=j.attributes&&j.attributes.value&&!j.attributes.value.specified?j.text:j.value);if(d)return l;c.push(l)}}return c}return b(a).val()};
b.fn.clearForm=function(){return this.each(function(){b("input,select,textarea",this).clearFields()})};b.fn.clearFields=b.fn.clearInputs=function(){return this.each(function(){var a=this.type,b=this.tagName.toLowerCase();"text"==a||"password"==a||"textarea"==b?this.value="":"checkbox"==a||"radio"==a?this.checked=!1:"select"==b&&(this.selectedIndex=-1)})};b.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})};
b.fn.enable=function(a){void 0===a&&(a=!0);return this.each(function(){this.disabled=!a})};b.fn.selected=function(a){void 0===a&&(a=!0);return this.each(function(){var f=this.type;"checkbox"==f||"radio"==f?this.checked=a:"option"==this.tagName.toLowerCase()&&(f=b(this).parent("select"),a&&(f[0]&&"select-one"==f[0].type)&&f.find("option").selected(!1),this.selected=a)})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/jquery/jquery.moveto.js' */
jQuery.fn.moveTo=function(a){var a=jQuery.extend({transition:!1,scrollOffset:35},a),c=this,b=c.offset().top;if((jQuery(window).scrollTop()+jQuery(window).height()-this.outerHeight()<b||jQuery(window).scrollTop()+a.scrollOffset>b)&&jQuery(window).height()>a.scrollOffset){b=jQuery(window).scrollTop()+a.scrollOffset>b?b-(jQuery(window).height()-this.outerHeight())+a.scrollOffset:b-a.scrollOffset;if(!jQuery.fn.moveTo.animating&&a.transition)return jQuery(document).trigger("moveToStarted",this),jQuery.fn.moveTo.animating=
!0,jQuery("html,body").animate({scrollTop:b},1E3,function(){jQuery(document).trigger("moveToFinished",c);delete jQuery.fn.moveTo.animating}),this;a=jQuery("html, body");a.is(":animated")&&(a.stop(),delete jQuery.fn.moveTo.animating);jQuery(document).trigger("moveToStarted");jQuery(window).scrollTop(b);setTimeout(function(){jQuery(document).trigger("moveToFinished",c)},100);return this}jQuery(document).trigger("moveToFinished",this);return this};;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/event.js' */
AJS.bind=function(a,b,c){try{return"function"===typeof c?AJS.$(window).bind(a,b,c):AJS.$(window).bind(a,b)}catch(d){AJS.log("error while binding: "+d.message)}};AJS.unbind=function(a,b){try{return AJS.$(window).unbind(a,b)}catch(c){AJS.log("error while unbinding: "+c.message)}};AJS.trigger=function(a,b){try{return AJS.$(window).trigger(a,b)}catch(c){AJS.log("error while triggering: "+c.message)}};;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/cookie.js' */
(function(){function g(a){a=RegExp("\\b"+a.replace(e,"\\$&")+"=((?:[^\\\\;]+|\\\\.)*)(?:;|$)");return(a=document.cookie.match(a))&&a[1].replace(f,"")}var f=/(\\|^"|"$)/g,h=/\|\|+/g,i=/"/g,e=/[.*+?|^$()[\]{\\]/g;AJS.Cookie={save:function(a,d,b){var c=g("AJS.conglomerate.cookie"),f=RegExp("(\\s|\\|)*\\b"+a.replace(e,"\\$&")+"=[^|]*[|]*"),c=(c||"").replace(f,"|");""!==d&&(a=a+"="+d,4020>c.length+a.length&&(c+="|"+a));c=c.replace(h,"|");b=b||365;a="";d='"'+c.replace(i,'\\"')+'"';b&&(a=new Date,a.setTime(+a+
864E5*b),a="; expires="+a.toGMTString());document.cookie="AJS.conglomerate.cookie="+d+a+";path=/"},read:function(a,d){var b;b=(b=g("AJS.conglomerate.cookie"))||"";var c=RegExp(a.replace(e,"\\$&")+"=([^|]+)");b=(b=b.match(c))&&b[1];return null!=b?b:d},erase:function(a){this.save(a,"")}};AJS.deprecate.prop(AJS.Cookie,"save",{alternativeName:"AJS.cookie"})})();;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/inline-dialog.js' */
(function(e){function t(c){var c=e(c),b=e.extend({left:0,top:0},c.offset());return{left:b.left,top:b.top,width:c.outerWidth(),height:c.outerHeight()}}function D(c,b,e,a){var d,n,g,i,h,j,m,p,k=AJS.$.isFunction(a.offsetX)?a.offsetX(c,b,e,a):a.offsetX,s=AJS.$.isFunction(a.offsetY)?a.offsetY(c,b,e,a):a.offsetY;AJS.$.isFunction(a.arrowOffsetX)&&a.arrowOffsetX(c,b,e,a);e=AJS.$.isFunction(a.arrowOffsetY)?a.arrowOffsetY(c,b,e,a):a.arrowOffsetY;h="body"!==a.container.toLowerCase();g=AJS.$(a.container);a=h?
AJS.$(a.container).parent():AJS.$(window);i=h?g.offset():{left:0,top:0};h&&a.offset();d=b.target;h=d.offset();n=d[0].getBBox&&d[0].getBBox();b=a.scrollTop();p=a.scrollLeft();a.width();a=a.height();m=g.width();g.height();g=h.top-i.top;i=h.left-i.left;h=n?n.width:d.outerWidth();j=n?n.height:d.outerHeight();d=c.width();n=c.height();var f=10,l=c.find(".arrow").outerHeight(),o=g-b,q=i-p,c=Math.floor(j/2);p=Math.floor(n/2);j=Math.floor(l/2);m=!(m-q-h-k-f>=d)&&q-k-f>=d?"e":"w";q=o+c-j;l=a-q-l;f=Math.min(f,
q-5);f=Math.min(f,l-5);l=o+c;o=Math.max(l-f,0);l=Math.max(a-l-f,0);p-s>o?(k={top:b+f,left:"w"===m?i+h+k:i-d-k},s={top:g+c-(k.top+j)}):p+s>l?(k={top:b+a-n-f,left:"w"===m?i+h+k:i-d-k},s={top:g+c-(k.top+j)}):(k={top:g+c-p+s,left:"w"===m?i+h+k:i-d-k},s={top:p-j+e});return{gravity:m,popupCss:k,arrowCss:s}}function E(c,b,e,a){var d=AJS.$.isFunction(a.offsetX)?a.offsetX(c,b,e,a):a.offsetX,n=AJS.$.isFunction(a.offsetY)?a.offsetY(c,b,e,a):a.offsetY,g=AJS.$.isFunction(a.arrowOffsetX)?a.arrowOffsetX(c,b,e,a):
a.arrowOffsetX;AJS.$.isFunction(a.arrowOffsetY)&&a.arrowOffsetY(c,b,e,a);var i=t(window),h=t(b.target),b=t(c),c=t(c.find(".aui-inline-dialog-arrow")),j=h.left+h.width/2,m=(window.pageYOffset||document.documentElement.scrollTop)+i.height;b.top=h.top+h.height+~~n;b.left=h.left+~~d;d=i.width-(b.left+b.width+10);c.left=j-b.left+~~g;c.top=-(c.height/2);g=h.top>b.height;if(g=!(b.top+b.height<m)&&g||g&&"s"===a.gravity)b.top=h.top-b.height-c.height/2,c.top=b.height;a.isRelativeToMouse?0>d?(b.right=10,b.left=
"auto",c.left=e.x-(i.width-b.width)):(b.left=e.x-20,c.left=e.x-b.left):0>d?(b.right=10,b.left="auto",e=i.width-b.right-b.width,c.right="auto",c.left=j-e-c.width/2):b.width<=h.width/2&&(c.left=b.width/2,b.left=j-b.width/2);return{gravity:g?"s":"n",displayAbove:g,popupCss:{left:b.left,top:b.top,right:b.right},arrowCss:{left:c.left,top:c.top,right:c.right}}}AJS.InlineDialog=function(c,b,z,a){a=a||[];a.hasOwnProperty("getArrowAttributes")&&F();a.hasOwnProperty("getArrowPath")&&(G(),a.hasOwnProperty("gravity")&&
H());a.hasOwnProperty("onTop")&&(I(),a.onTop&&void 0===a.gravity&&(a.gravity="s"));if("undefined"===typeof b&&(b=String(Math.random()).replace(".",""),e("#inline-dialog-"+b+", #arrow-"+b+", #inline-dialog-shim-"+b).length))throw"GENERATED_IDENTIFIER_NOT_UNIQUE";var d=e.extend(!1,AJS.InlineDialog.opts,a);"w"===d.gravity&&(d.offsetX=void 0===a.offsetX?10:a.offsetX,d.offsetY=void 0===a.offsetY?0:a.offsetY);var n=function(){return window.Raphael&&!!window.Raphael.version&&a&&(a.getArrowPath||a.getArrowAttributes)},
g,i,h,j=!1,m=!1,p=!1,k,s,f=e('<div id="inline-dialog-'+b+'" class="aui-inline-dialog"><div class="aui-inline-dialog-contents contents"></div><div id="arrow-'+b+'" class="aui-inline-dialog-arrow arrow"></div></div>'),l=e("#arrow-"+b,f),o=f.find(".contents");n()||f.find(".aui-inline-dialog-arrow").addClass("aui-css-arrow");d.displayShadow||o.addClass("aui-inline-dialog-no-shadow");d.autoWidth?o.addClass("aui-inline-dialog-auto-width"):o.width(d.width);o.on({mouseenter:function(){clearTimeout(i);f.unbind("mouseenter")},
mouseleave:function(){r()}});var q=function(){g||(g={popup:f,hide:function(){r(0)},id:b,show:function(){v()},persistent:d.persistent?true:false,reset:function(){var a=AJS.$(window).height(),a=Math.round(a*0.75);f.children(".aui-inline-dialog-contents").css("max-height",a);a=d.calculatePositions(f,s,k,d);if(a.hasOwnProperty("displayAbove")){J();a.gravity=a.displayAbove?"s":"n"}f.css(a.popupCss);if(n()){if(a.gravity==="s")a.arrowCss.top=a.arrowCss.top-(e.browser.msie?10:9);if(!f.arrowCanvas)f.arrowCanvas=
Raphael("arrow-"+b,16,16);var c=d.getArrowPath,c=e.isFunction(c)?c(a):c;f.arrowCanvas.path(c).attr(d.getArrowAttributes())}else{l.removeClass("aui-bottom-arrow aui-left-arrow aui-right-arrow");a.gravity==="s"&&!l.hasClass("aui-bottom-arrow")?l.addClass("aui-bottom-arrow"):a.gravity!=="n"&&(a.gravity==="w"?l.addClass("aui-left-arrow"):a.gravity==="e"&&l.addClass("aui-right-arrow"))}l.css(a.arrowCss);f.fadeIn(d.fadeTime,function(){});if(e.browser.msie&&~~e.browser.version<10){a=e("#inline-dialog-shim-"+
b);a.length||e(f).prepend(e('<iframe class = "inline-dialog-shim" id="inline-dialog-shim-'+b+'" frameBorder="0" src="javascript:false;"></iframe>'));a.css({width:o.outerWidth(),height:o.outerHeight()})}}});return g},v=function(){f.is(":visible")||(h=setTimeout(function(){if(p&&m){d.addActiveClass&&e(c).addClass("active");j=true;if(!d.persistent){if(!y){e("body").bind("click."+A,function(a){e(a.target).closest("#inline-dialog-"+b+" .contents").length===0&&r(0)});y=true}e(document).on("keydown",B)}AJS.InlineDialog.current=
q();e(document).trigger("showLayer",["inlineDialog",q()]);q().reset()}},d.showDelay))},r=function(a){if(!(typeof a=="undefined"&&d.persistent)&&typeof f.get(0)._datePickerPopup==="undefined"){m=false;if(j&&d.preHideCallback.call(f[0].popup)){a=a==null?d.hideDelay:a;clearTimeout(i);clearTimeout(h);a!=null&&(i=setTimeout(function(){y&&e("body").unbind("click."+A);y=false;e(document).off("keydown",B);d.addActiveClass&&e(c).removeClass("active");f.fadeOut(d.fadeTime,function(){d.hideCallback.call(f[0].popup)});
if(f.arrowCanvas){f.arrowCanvas.remove();f.arrowCanvas=null}m=j=false;e(document).trigger("hideLayer",["inlineDialog",q()]);AJS.InlineDialog.current=null;if(!d.cacheContent)t=p=false},a))}}},w=function(a,c){var g=e(c);d.upfrontCallback.call({popup:f,hide:function(){r(0)},id:b,show:function(){v()}});f.each(function(){typeof this.popup!="undefined"&&this.popup.hide()});d.closeOthers&&e(".aui-inline-dialog").each(function(){!this.popup.persistent&&this.popup.hide()});s={target:g};k=a?{x:a.pageX,y:a.pageY}:
{x:g.offset().left,y:g.offset().top};j||clearTimeout(h);m=true;g=function(){t=false;p=true;d.initCallback.call({popup:f,hide:function(){r(0)},id:b,show:function(){v()}});v()};if(!t){t=true;e.isFunction(z)?z(o,c,g):e.get(z,function(a,c,e){o.html(d.responseHandler(a,c,e));p=true;d.initCallback.call({popup:f,hide:function(){r(0)},id:b,show:function(){v()}});v()})}clearTimeout(i);j||v();return false};f[0].popup=q();var t=!1,C=!1,x=function(){if(!C){e(d.container).append(f);C=true}},u=e(c);if(d.onHover)if(d.useLiveEvents)if(u.selector)e(document).on("mouseenter",
u.selector,function(a){x();w(a,this)}).on("mouseleave",u.selector,function(){r()});else AJS.log("Warning: inline dialog trigger elements must have a jQuery selector when the useLiveEvents option is enabled.");else u.on({mouseenter:function(a){x();w(a,this)},mouseleave:function(){r()}});else if(!d.noBind)if(d.useLiveEvents)if(u.selector)e(document).on("click",u.selector,function(a){x();j&&d.closeOnTriggerClick?f.hide():w(a,this);return false}).on("mouseleave",u.selector,function(){r()});else AJS.log("Warning: inline dialog trigger elements must have a jQuery selector when the useLiveEvents option is enabled.");
else u.on("click",function(a){x();j&&d.closeOnTriggerClick?f.hide():w(a,this);return false}).on("mouseleave",function(){r()});var y=!1,A=b+".inline-dialog-check",B=function(a){a.keyCode===27&&r(0)};f.show=function(a,b){a&&a.stopPropagation();x();d.noBind&&(!c||!c.length)?w(a,b===void 0?a.target:b):w(a,c)};f.hide=function(){r(0)};f.refresh=function(){j&&q().reset()};f.getOptions=function(){return d};return f};AJS.InlineDialog.opts={onTop:!1,responseHandler:function(c){return c},closeOthers:!0,isRelativeToMouse:!1,
addActiveClass:!0,onHover:!1,useLiveEvents:!1,noBind:!1,fadeTime:100,persistent:!1,hideDelay:1E4,showDelay:0,width:300,offsetX:0,offsetY:10,arrowOffsetX:0,arrowOffsetY:0,container:"body",cacheContent:!0,displayShadow:!0,autoWidth:!1,gravity:"n",closeOnTriggerClick:!1,preHideCallback:function(){return!0},hideCallback:function(){},initCallback:function(){},upfrontCallback:function(){},calculatePositions:function(c,b,e,a){a=a||{};return("w"===a.gravity?D:E)(c,b,e,a)},getArrowPath:function(c){return"s"===
c.gravity?"M0,8L8,16,16,8":"M0,8L8,0,16,8"},getArrowAttributes:function(){return{fill:"#fff",stroke:"#ccc"}}};AJS.InlineDialog=AJS.deprecate.construct(AJS.InlineDialog,"Inline dialog constructor",{alternativeName:"inline dialog 2"});var J=AJS.deprecate.getMessageLogger("displayAbove","[remove version]",{alternativeName:"gravity",extraInfo:"See https://ecosystem.atlassian.net/browse/AUI-2197."}),I=AJS.deprecate.getMessageLogger("onTop","[remove version]",{alternativeName:"gravity",extraInfo:"See https://ecosystem.atlassian.net/browse/AUI-2197."}),
F=AJS.deprecate.getMessageLogger("getArrowAttributes","[remove version]",{extraInfo:"See https://ecosystem.atlassian.net/browse/AUI-1362."}),G=AJS.deprecate.getMessageLogger("getArrowPath","[remove version]",{extraInfo:"See https://ecosystem.atlassian.net/browse/AUI-1362."}),H=AJS.deprecate.getMessageLogger("getArrowPath does not support gravity","[remove version]",{extraInfo:"See https://ecosystem.atlassian.net/browse/AUI-2197."})})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/firebug.js' */
AJS.warnAboutFirebug=function(){};AJS.deprecate.prop(AJS,"warnAboutFirebug");;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/forms.js' */
AJS.inlineHelp=function(){AJS.$(".icon-inline-help").click(function(){var a=AJS.$(this).siblings(".field-help");a.hasClass("hidden")?a.removeClass("hidden"):a.addClass("hidden")})};;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/keyCode.js' */
(function(){AJS.keyCode={ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}})();;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/messages.js' */
(function(h,e){function f(b){h.messages[b]=function(d,a){a||(a=d,d="#aui-message-bar");a.closeable=!1!==a.closeable;a.shadowed=!1!==a.shadowed;var c=a,g=e(AJS.template(this.template).fill({type:b,closeable:c.closeable?"closeable":"",shadowed:c.shadowed?"shadowed":"",fadeout:c.fadeout?"fadeout":"",title:c.title||"","body:html":c.body||""}).toString());c.id&&(/[#\'\"\.\s]/g.test(c.id)?AJS.log("AJS.Messages error: ID rejected, must not include spaces, hashes, dots or quotes."):g.attr("id",c.id));c=d;
"prepend"===a.insert?g.prependTo(c):g.appendTo(c);a.closeable&&i(g);a.fadeout&&j(g,a.delay,a.duration);return g}}function i(b){e(b||"div.aui-message.closeable").each(function(){var d=e(this),a=d.find(".aui-icon.icon-close"),a=0<a.length?a.first():e('<span class="aui-icon icon-close" role="button" tabindex="0"></span>');d.addClass("closeable");d.append(a);d.on("click",".aui-icon.icon-close",function(a){e(a.target).closest(".aui-message").closeMessage()}).on("keydown",".aui-icon.icon-close",function(a){if(a.which===
AJS.keyCode.ENTER||a.which===AJS.keyCode.SPACE)e(a.target).closest(".aui-message").closeMessage(),a.preventDefault()})})}function j(b,d,a){d="undefined"!==typeof d?d:l;a="undefined"!==typeof a?a:m;e(b||"div.aui-message.fadeout").each(function(){function c(){g.stop(!0,!1).delay(d).fadeOut(a,function(){g.closeMessage()})}var g=e(this),b=!1,f=!1;g.focusin(function(){b=!0;g.stop(!0,!1).fadeTo(k,1)}).focusout(function(){b=!1;!b&&!f&&c()}).hover(function(){f=!0;g.stop(!0,!1).fadeTo(k,1)},function(){f=!1;
!b&&!f&&c()});c()})}var m=500,l=5E3,k=100;h.messages={setup:function(){f("generic");f("error");f("warning");f("info");f("success");f("hint");i();j()},makeCloseable:i,makeFadeout:j,template:'<div class="aui-message aui-message-{type} {type} {closeable} {shadowed} {fadeout}"><p class="title"><strong>{title}</strong></p>{body}<\!-- .aui-message --\></div>',createMessage:f};e.fn.closeMessage=function(){var b=e(this);b.hasClass("aui-message")&&b.hasClass("closeable")&&(b.stop(!0),b.trigger("messageClose",
[this]).remove(),e(document).trigger("aui-message-close",[this]))};e(function(){h.messages.setup()});AJS.deprecate.prop(h.messages,"makeCloseable",{extraInfo:'Use the "closeable" option in the constructor instead. Docs: https://docs.atlassian.com/aui/latest/docs/messages.html'});AJS.deprecate.prop(h.messages,"createMessage",{extraInfo:"Use the provided convenience methods instead e.g. AJS.messages.generic(). Docs: https://docs.atlassian.com/aui/latest/docs/messages.html"});AJS.deprecate.prop(h.messages,
"makeFadeout",{extraInfo:'Use the "fadeout" option in the constructor instead. Docs: https://docs.atlassian.com/aui/latest/docs/messages.html'})})(AJS,AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/tabs.js' */
(function(g){function r(){var a=g(this);AJS._addID(a);a.attr("role","tab");var b=a.attr("href");g(b).attr("aria-labelledby",a.attr("id"));a.parent().hasClass("active-tab")?a.attr("aria-selected","true"):a.attr("aria-selected","false")}function k(a){if(!a.hasClass("aui-tabs-responsive-trigger")){var b=g(a.attr("href").match(s)[0]);b.addClass("active-pane").attr("aria-hidden","false").siblings(".tabs-pane").removeClass("active-pane").attr("aria-hidden","true");var d=a.parents(".aui-tabs").find(".aui-tabs-responsive-trigger-item a").attr("aria-controls"),
d=g(document).find("#"+d);d.find("li a").attr("aria-checked",!1).removeClass("checked aui-dropdown2-checked");d.find("li").removeClass("active-tab");a.parent("li.menu-item").addClass("active-tab").siblings(".menu-item").removeClass("active-tab");a.hasClass("aui-tabs-responsive-item")&&(d=b.parent(".aui-tabs").find("li.menu-item:not(.aui-tabs-responsive-trigger-item)"),d.removeClass("active-tab"),d.find("a").removeClass("checked").removeAttr("aria-checked"));a.hasClass("aui-tabs-responsive-item")&&
b.parent(".aui-tabs").find("li.menu-item.aui-tabs-responsive-trigger-item").addClass("active-tab");a.closest(".tabs-menu").find("a").attr("aria-selected","false");a.attr("aria-selected","true");a.trigger("tabSelect",{tab:a,pane:b})}}function n(a){return void 0!==a.attr("data-aui-persist")&&"false"!==a.attr("data-aui-persist")}function o(a){var b=a.attr("id"),a=a.attr("data-aui-persist");return t+(b?b:"")+(a&&"true"!==a?"-"+a:"")}function p(a){AJS.tabs.change(g(this),a);a&&a.preventDefault()}function q(a){a.forEach(function(a,
d){var c=g(a),e=c.find(".tabs-menu").first(),f=e.find("li:not(.aui-tabs-responsive-trigger-item)"),h=e.find(".aui-tabs-responsive-trigger").parent(),l=h.find("a"),i=l.attr("aria-controls"),i=g(document).find("#"+i).attr("aria-checked",!1),k=0<i.length,m=j.totalTabsWidth(f,i)>c.outerWidth();!k&&m&&(h=j.createResponsiveDropdownTrigger(e,d),i=j.createResponsiveDropdown(c,d));l.attr("aria-controls","aui-tabs-responsive-dropdown-"+d);l.attr("id","aui-tabs-responsive-trigger-"+d);l.attr("href","aui-tabs-responsive-trigger-"+
d);i.attr("id","aui-tabs-responsive-dropdown-"+d);m&&(e=j.moveVisibleTabs(f.toArray(),c,h),e=j.totalVisibleTabWidth(e),c=c.outerWidth()-e-h.outerWidth(!0),0<c&&(e=i.find("li"),j.moveInvisibleTabs(e.toArray(),c,h)),i.on("click","a",p));k&&!m&&(i.find("li").each(function(){j.moveTabOutOfDropdown(g(this),h)}),j.removeResponsiveDropdown(i,h))})}var s=/#.*/,t="_internal-aui-tabs-",j={totalTabsWidth:function(a,b){var d=this.totalVisibleTabWidth(a),c=0;b.find("li").each(function(a,b){c+=parseInt(b.getAttribute("data-aui-tab-width"))});
return d+c},totalVisibleTabWidth:function(a){var b=0;a.each(function(a,c){b+=g(c).outerWidth()});return b},removeResponsiveDropdown:function(a,b){a.remove();b.remove()},createResponsiveDropdownTrigger:function(a,b){a.append('<li class="menu-item aui-tabs-responsive-trigger-item"><a class="aui-dropdown2-trigger aui-tabs-responsive-trigger aui-dropdown2-trigger-arrowless" id="aui-tabs-responsive-trigger-'+b+'" aria-haspopup="true" aria-controls="aui-tabs-responsive-dropdown-'+b+'" href="aui-tabs-responsive-dropdown-'+
b+'">...</a></li>');return a.find(".aui-tabs-responsive-trigger-item")},createResponsiveDropdown:function(a,b){a.append('<div class="aui-dropdown2 aui-style-default aui-tabs-responsive-dropdown" id="aui-tabs-responsive-dropdown-'+b+'"><ul></ul></div>');return a.find("#aui-tabs-responsive-dropdown-"+b)},findNewVisibleTabs:function(a,b,d){for(var c=0,e=0;c+d<=b&&e<a.length;e++)var f=g(a[e]).outerWidth(!0),c=c+f;return a.slice(0,e-1)},moveVisibleTabs:function(a,b,d){for(var c=d.find("a").attr("aria-controls"),
c=g("#"+c),b=this.findNewVisibleTabs(a,b.outerWidth(),d.parent().outerWidth(!0)),e=b.length-1,f=a.length-1;f>=e;f--){var h=g(a[f]);this.moveTabToResponsiveDropdown(h,c,d)}return g(b)},moveTabToResponsiveDropdown:function(a,b,d){var c=a.find("a");a.attr("data-aui-tab-width",a.outerWidth(!0));c.addClass("aui-dropdown2-radio aui-tabs-responsive-item");a.hasClass("active-tab")&&(c.addClass("aui-dropdown2-checked"),d.addClass("active-tab"));b.find("ul").prepend(a)},moveInvisibleTabs:function(a,b,d){for(var c=
0;0<b&&c<a.length;c++){var e=g(a[c]),f=parseInt(e.attr("data-aui-tab-width"),10);f<b&&this.moveTabOutOfDropdown(e,d);b-=f}},moveTabOutOfDropdown:function(a,b){a.find("a").hasClass("aui-dropdown2-checked")&&(a.addClass("active-tab"),b.removeClass("active-tab"));a.children("a").removeClass("aui-dropdown2-radio aui-tabs-responsive-item aui-dropdown2-checked");b.before(a)}};AJS.tabs={setup:function(){var a=g(".aui-tabs:not(.aui-tabs-disabled)"),b=g('.aui-tabs.horizontal-tabs[data-aui-responsive]:not([data-aui-responsive="false"])').toArray();
q(b);var d=AJS.debounce(q,200);g(window).resize(function(){d(b)});a.attr("role","application");a.find(".tabs-pane").each(function(){var a=g(this);a.attr("role","tabpanel");a.hasClass("active-pane")?a.attr("aria-hidden","false"):a.attr("aria-hidden","true")});for(var c=0,e=a.length;c<e;c++){var f=a.eq(c);if(!f.data("aui-tab-events-bound")){var h=f.children("ul.tabs-menu");h.attr("role","tablist");h.children("li").attr("role","presentation");h.find("> .menu-item a").each(r);h.delegate("a","click",p);
f.data("aui-tab-events-bound",!0)}}c=0;for(e=a.length;c<e;c++)if(f=a.eq(c),n(f)&&window.localStorage)if(f.attr("id")){if(h=window.localStorage.getItem(o(f)))f=f.find("#"+h),f.length&&k(f)}else AJS.warn("A tab group must specify an id attribute if it specifies data-aui-persist");g(".aui-tabs.vertical-tabs").find("a").each(function(){var a=g(this);a.attr("title")||AJS.isClipped(a)&&a.attr("title",a.text())})},change:function(a){k(a);var b=a.closest(".aui-tabs");n(b)&&window.localStorage&&(b=a.closest(".aui-tabs"),
b.attr("id")?(a=a.attr("id"))&&window.localStorage.setItem(o(b),a):AJS.warn("A tab group must specify an id attribute if it specifies data-aui-persist"))}};g(AJS.tabs.setup)})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/template.js' */
AJS.template=function(j){var h=/\{([^\}]+)\}/g,k=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,i=function(c,a,d,f){var b=d;a.replace(k,function(c,a,d,e,g){a=a||e;b&&(a+":html"in b?(b=b[a+":html"],f=!0):a in b&&(b=b[a]),g&&"function"===typeof b&&(b=b()))});if(null==b||b==d)b=c;b=String(b);f||(b=e.escape(b));return b},l=function(c){this.template=this.template.replace(h,function(a,d){return i(a,d,c,!0)});return this},m=function(c){this.template=this.template.replace(h,function(a,d){return i(a,
d,c)});return this},n=function(){return this.template},e=function(c){function a(){return a.template}a.template=String(c);a.toString=a.valueOf=n;a.fill=m;a.fillHtml=l;return a},f={},g=[];e.load=function(c){c=String(c);if(!f.hasOwnProperty(c)){1E3<=g.length&&delete f[g.shift()];g.push(c);var a=c,d,e=c;d=j("script").filter(function(){return this.getAttribute("title")===e});f[a]=d[0].text}return this(f[c])};e.escape=AJS.escapeHtml;return e}(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/whenitype.js' */
(function(n,e){var p=-1!==navigator.platform.indexOf("Mac"),q=/^(backspace|tab|r(ight|eturn)|s(hift|pace|croll)|c(trl|apslock)|alt|pa(use|ge(up|down))|e(sc|nd)|home|left|up|d(el|own)|insert|f\d\d?|numlock|meta)/i;n.whenIType=function(f){function i(b){!AJS.popup.current&&g&&g.fire(b)}function d(b){b.preventDefault()}function o(b){(b&&b.split?e.trim(b).split(" "):[b]).forEach(function(a){if(!(a instanceof Array)){for(var a=a.toString(),c=[],h="";a.length;){var b=a.match(/^(ctrl|meta|shift|alt)\+/i),
k=a.match(q);b?(h+=b[0],a=a.substring(b[0].length)):(k?(c.push(h+k[0]),a=a.substring(k[0].length)):(c.push(h+a[0]),a=a.substring(1)),h="")}a=c}a:{for(c=a.length;c--;)if(1<a[c].length&&"space"!==a[c]){c=!0;break a}c=!1}c=c?"keydown":"keypress";l.push(a);e(document).bind(c,a,i);e(document).bind(c+" keyup",a,d)})}function j(b,a,c){c?a+=" ("+AJS.format("Type \u0027\u0027{0}\u0027\u0027",b.shift()):(a=a.replace(/\)$/,""),a+=AJS.format("OR \u0027\u0027{0}\u0027\u0027",b.shift()));b.forEach(function(c){a=
a+(" "+AJS.format("then \u0027\u0027{0}\u0027\u0027",c))});return a+=")"}var l=[],g=e.Callbacks();o(f);return n.whenIType.makeShortcut({executor:g,bindKeys:o,addShortcutsToTitle:function(b){for(var b=e(b),a=b.attr("title")||"",c=l.slice(),h=b.data("kbShortcutAppended")||"",m=!h,a=m?a:a.substring(0,a.length-h.length);c.length;)h=j(c.shift().slice(),h,m),m=!1;p&&(h=h.replace(/Meta/ig,"\u2318").replace(/Shift/ig,"\u21e7"));b.attr("title",a+h);b.data("kbShortcutAppended",h)},removeShortcutsFromTitle:function(b){var b=
e(b),a=b.data("kbShortcutAppended");if(a){var c=b.attr("title");b.attr("title",c.replace(a,""));b.removeData("kbShortcutAppended")}},keypressHandler:i,defaultPreventionHandler:d})};n.whenIType.makeShortcut=function(f){function i(c){return function(a,b){var b=b||{},k=b.focusedClass||"focused",f=b.hasOwnProperty("wrapAround")?b.wrapAround:!0,g=b.hasOwnProperty("escToCancel")?b.escToCancel:!0;d.add(function(){var b=e(a),d=b.filter("."+k),m=0===d.length?void 0:{transition:!0};if(g)e(document).one("keydown",
function(c){c.keyCode===AJS.keyCode.ESCAPE&&d&&d.removeClass(k)});d.length&&d.removeClass(k);if((d=c(d,b,f))&&0<d.length)d.addClass(k),d.moveTo(m),d.is("a")?d.focus():d.find("a:first").focus()});return this}}var d=f.executor,o=f.bindKeys,j=f.addShortcutsToTitle,l=f.removeShortcutsFromTitle,g=f.keypressHandler,b=f.defaultPreventionHandler,a=[];return{moveToNextItem:i(function(c,a,b){var d;if(b&&0===c.length)return a.eq(0);d=e.inArray(c.get(0),a);return d<a.length-1?a.eq(d+1):b?a.eq(0):c}),moveToPrevItem:i(function(c,
a,b){var d;if(b&&0===c.length)return a.filter(":last");d=e.inArray(c.get(0),a);return 0<d?a.eq(d-1):b?a.filter(":last"):c}),click:function(c){a.push(c);j(c);d.add(function(){var a=e(c);0<a.length&&a.click()});return this},goTo:function(c){d.add(function(){window.location.href=c});return this},followLink:function(c){a.push(c);j(c);d.add(function(){var a=e(c)[0];a&&{a:!0,link:!0}[a.nodeName.toLowerCase()]&&(window.location.href=a.href)});return this},execute:function(c){var a=this;d.add(function(){c.apply(a,
arguments)});return this},evaluate:function(a){a.call(this)},moveToAndClick:function(c){a.push(c);j(c);d.add(function(){var a=e(c);0<a.length&&(a.click(),a.moveTo())});return this},moveToAndFocus:function(c){a.push(c);j(c);d.add(function(a){var b=AJS.$(c);0<b.length&&(b.focus(),b.moveTo&&b.moveTo(),b.is(":input")&&a.preventDefault())});return this},or:function(a){o(a);return this},unbind:function(){e(document).unbind("keydown keypress",g).unbind("keydown keypress keyup",b);for(var c=0,d=a.length;c<
d;c++)l(a[c]);a=[]}}};n.whenIType.fromJSON=function(f,i){var d=[];f&&e.each(f,function(f,j){var l=j.op,g=j.param,b;if("execute"===l||"evaluate"===l)b=[new Function(g)];else if(/^\[[^\]\[]*,[^\]\[]*\]$/.test(g)){try{b=JSON.parse(g)}catch(a){AJS.error("When using a parameter array, array must be in strict JSON format: "+g)}e.isArray(b)||AJS.error("Badly formatted shortcut parameter. String or JSON Array of parameters required: "+g)}else b=[g];e.each(j.keys,function(){var a=this;i&&p&&(a=e.map(a,function(a){return a.replace(/ctrl/i,
"meta")}));a=AJS.whenIType(a);a[l].apply(a,b);d.push(a)})});return d};e(document).bind("iframeAppended",function(f,i){e(i).load(function(){e(i).contents().bind("keyup keydown keypress",function(d){e.browser.safari&&"keypress"===d.type||e(d.target).is(":input")||e.event.trigger(d,arguments,document,!0)})})})})(AJS,AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/jquery/jquery.is-dirty.js' */
jQuery.fn.isDirty=function(){var b,d=[];window.onbeforeunload=function(){var a=window.onbeforeunload;!1!==b&&jQuery.each(d,function(){if(this.initVal!==AJS.$(this).val())return b=!0,!1});if(b)return window.onbeforeunload=null,window.setTimeout(function(){jQuery(document).bind("mousemove",function(){window.onbeforeunload=a;jQuery(document).unbind("mousemove",arguments.callee)})},1E3),b=void 0,AJS.params.dirtyMessage||""};return function(a){function c(b){var a=jQuery(this);jQuery.fn.isDirty.fieldInFocus=
a;-1===jQuery.inArray(this,d)&&(this.initVal=a.val(),d.push(this),a.die(b.type,c))}if(0!==this.length)return jQuery(":not(:input)").live("click",function(){delete jQuery.fn.isDirty.fieldInFocus}),jQuery(":input[type != hidden]",this.selector).bind("keydown",c).bind("keypress",c).bind("click",c),jQuery(a.ignoreUnloadFromElems).live("mousedown",function(){b=!1}),this.each(function(){var a=this.onsubmit;this.onsubmit=function(){b=!1;if(a)return a.apply(this,arguments)};AJS.$(this).submit(function(){b=
!1})}),this}}();;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/jquery/jquery.progressbar.js' */
(function(a){a.fn.progressBar=function(e,h){var f=a.extend({height:"1em",showPercentage:!0},h),b=this.attr("id")+"-incomplete-bar",c=this.attr("id")+"-complete-bar",g=this.attr("id")+"-percent-complete-text";if(0==a("#"+b).length){var d=a(document.createElement("div"));d.attr("id",b);d.css({width:"90%",border:"solid 1px #ccc","float":"left","margin-right":"0.5em"});d.addClass("progress-background-color");b=a(document.createElement("div"));b.attr("id",c);b.addClass("progress-fill-color");b.css({height:f.height,
width:e+"%"});c=a(document.createElement("span"));c.attr("id",g);c.addClass("percent-complete-text");c.html(e+"%");d.append(b);this.append(d);f.showPercentage&&this.append(c)}else a("#"+c).css("width",e+"%"),a("#"+g).html(e+"%")}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/jquery/jquery.selection.js' */
(function(e){document.selection?(e.fn.selection=function(d){var a=this[0];this.focus();if(!a)return!1;if(null==d)return document.selection.createRange().text;var c=a.scrollTop,b=document.selection.createRange();b.text=d;b.select();a.focus();a.scrollTop=c},e.fn.selectionRange=function(d,a){var c=this[0];this.focus();var b=document.selection.createRange();if(null==d){var e=this.val(),g=e.length,f=b.duplicate();f.moveToElementText(c);f.setEndPoint("StartToEnd",b);c=g-f.text.replace(/\u000D/g,"").length;
f.setEndPoint("StartToStart",b);b=g-f.text.replace(/\u000D/g,"").length;c!=b&&"\n"==e.charAt(c+1)&&(c+=1);return{end:c,start:b,text:e.substring(b,c),textBefore:e.substring(0,b),textAfter:e.substring(c)}}b.moveToElementText(c);b.collapse(!0);b.moveStart("character",d);b.moveEnd("character",a-d);b.select()}):(e.fn.selection=function(d){var a=this[0];if(!a)return!1;if(null==d)return a.setSelectionRange?a.value.substring(a.selectionStart,a.selectionEnd):!1;var c=a.scrollTop;if(a.setSelectionRange){var b=
a.selectionStart;a.value=a.value.substring(0,b)+d+a.value.substring(a.selectionEnd);a.selectionStart=b;a.selectionEnd=b+d.length}a.focus();a.scrollTop=c},e.fn.selectionRange=function(d,a){if(null==d){var c={start:this[0].selectionStart,end:this[0].selectionEnd},b=this.val();c.text=b.substring(c.start,c.end);c.textBefore=b.substring(0,c.start);c.textAfter=b.substring(c.end);return c}this[0].selectionStart=d;this[0].selectionEnd=a});e.fn.wrapSelection=function(d,a){this.selection(d+this.selection()+
(a||""))}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:internal-ajs-no-context-path', location = 'js/jquery/jquery.throbber.js' */
jQuery.fn.throbber=function(d){var e=[],g={isLatentThreshold:100,minThrobberDisplay:200,loadingClass:"loading"};d(document).ajaxComplete(function(a,b){d(e).each(function(a){b===this.get(0)&&(this.hideThrobber(),e.splice(a,1))})});return function(a){var b,f,c=function(a,b){c.t=setTimeout(function(){clearTimeout(c.t);c.t=void 0;a()},b)},a=d.extend(g,a||{});if(!a.target)return this;f=jQuery(a.target);e.push(d.extend(this,{showThrobber:function(){c(function(){b||(f.addClass(a.loadingClass),c(function(){b&&
b()},a.minThrobberDisplay))},a.isLatentThreshold)},hideThrobber:function(){b=function(){f.removeClass(a.loadingClass);a.end&&a.end()};c.t||b()}}));this.showThrobber();return this}}(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:ajs-underscorejs', location = 'js-vendor/underscorejs/underscore.js' */
(function(){var r=this,K=r._,n={},k=Array.prototype,o=Object.prototype,s=k.push,i=k.slice,p=k.concat,l=o.toString,L=o.hasOwnProperty,z=k.forEach,A=k.map,B=k.reduce,C=k.reduceRight,D=k.filter,E=k.every,F=k.some,q=k.indexOf,G=k.lastIndexOf,o=Array.isArray,M=Object.keys,t=Function.prototype.bind,b=function(a){if(a instanceof b)return a;if(!(this instanceof b))return new b(a);this._wrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=b),exports._=
b):r._=b;b.VERSION="1.5.2";var j=b.each=b.forEach=function(a,c,d){if(a!=null)if(z&&a.forEach===z)a.forEach(c,d);else if(a.length===+a.length)for(var e=0,f=a.length;e<f;e++){if(c.call(d,a[e],e,a)===n)break}else for(var g=b.keys(a),e=0,f=g.length;e<f;e++)if(c.call(d,a[g[e]],g[e],a)===n)break};b.map=b.collect=function(a,c,b){var e=[];if(a==null)return e;if(A&&a.map===A)return a.map(c,b);j(a,function(a,g,h){e.push(c.call(b,a,g,h))});return e};b.reduce=b.foldl=b.inject=function(a,c,d,e){var f=arguments.length>
2;a==null&&(a=[]);if(B&&a.reduce===B){e&&(c=b.bind(c,e));return f?a.reduce(c,d):a.reduce(c)}j(a,function(a,b,N){if(f)d=c.call(e,d,a,b,N);else{d=a;f=true}});if(!f)throw new TypeError("Reduce of empty array with no initial value");return d};b.reduceRight=b.foldr=function(a,c,d,e){var f=arguments.length>2;a==null&&(a=[]);if(C&&a.reduceRight===C){e&&(c=b.bind(c,e));return f?a.reduceRight(c,d):a.reduceRight(c)}var g=a.length;if(g!==+g)var h=b.keys(a),g=h.length;j(a,function(b,i,j){i=h?h[--g]:--g;if(f)d=
c.call(e,d,a[i],i,j);else{d=a[i];f=true}});if(!f)throw new TypeError("Reduce of empty array with no initial value");return d};b.find=b.detect=function(a,c,b){var e;H(a,function(a,g,h){if(c.call(b,a,g,h)){e=a;return true}});return e};b.filter=b.select=function(a,c,b){var e=[];if(a==null)return e;if(D&&a.filter===D)return a.filter(c,b);j(a,function(a,g,h){c.call(b,a,g,h)&&e.push(a)});return e};b.reject=function(a,c,d){return b.filter(a,function(a,b,g){return!c.call(d,a,b,g)},d)};b.every=b.all=function(a,
c,d){c||(c=b.identity);var e=true;if(a==null)return e;if(E&&a.every===E)return a.every(c,d);j(a,function(a,b,h){if(!(e=e&&c.call(d,a,b,h)))return n});return!!e};var H=b.some=b.any=function(a,c,d){c||(c=b.identity);var e=false;if(a==null)return e;if(F&&a.some===F)return a.some(c,d);j(a,function(a,b,h){if(e||(e=c.call(d,a,b,h)))return n});return!!e};b.contains=b.include=function(a,c){return a==null?false:q&&a.indexOf===q?a.indexOf(c)!=-1:H(a,function(a){return a===c})};b.invoke=function(a,c){var d=
i.call(arguments,2),e=b.isFunction(c);return b.map(a,function(a){return(e?c:a[c]).apply(a,d)})};b.pluck=function(a,c){return b.map(a,function(a){return a[c]})};b.where=function(a,c,d){return b.isEmpty(c)?d?void 0:[]:b[d?"find":"filter"](a,function(a){for(var b in c)if(c[b]!==a[b])return false;return true})};b.findWhere=function(a,c){return b.where(a,c,true)};b.max=function(a,c,d){if(!c&&b.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!c&&b.isEmpty(a))return-Infinity;var e=
{computed:-Infinity,value:-Infinity};j(a,function(a,b,h){b=c?c.call(d,a,b,h):a;b>e.computed&&(e={value:a,computed:b})});return e.value};b.min=function(a,c,d){if(!c&&b.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!c&&b.isEmpty(a))return Infinity;var e={computed:Infinity,value:Infinity};j(a,function(a,b,h){b=c?c.call(d,a,b,h):a;b<e.computed&&(e={value:a,computed:b})});return e.value};b.shuffle=function(a){var c,d=0,e=[];j(a,function(a){c=b.random(d++);e[d-1]=e[c];e[c]=a});
return e};b.sample=function(a,c,d){return arguments.length<2||d?a[b.random(a.length-1)]:b.shuffle(a).slice(0,Math.max(0,c))};var u=function(a){return b.isFunction(a)?a:function(c){return c[a]}};b.sortBy=function(a,c,d){var e=u(c);return b.pluck(b.map(a,function(a,c,b){return{value:a,index:c,criteria:e.call(d,a,c,b)}}).sort(function(a,c){var b=a.criteria,d=c.criteria;if(b!==d){if(b>d||b===void 0)return 1;if(b<d||d===void 0)return-1}return a.index-c.index}),"value")};var v=function(a){return function(c,
d,e){var f={},g=d==null?b.identity:u(d);j(c,function(b,d){var i=g.call(e,b,d,c);a(f,i,b)});return f}};b.groupBy=v(function(a,c,d){(b.has(a,c)?a[c]:a[c]=[]).push(d)});b.indexBy=v(function(a,c,b){a[c]=b});b.countBy=v(function(a,c){b.has(a,c)?a[c]++:a[c]=1});b.sortedIndex=function(a,c,d,e){for(var d=d==null?b.identity:u(d),c=d.call(e,c),f=0,g=a.length;f<g;){var h=f+g>>>1;d.call(e,a[h])<c?f=h+1:g=h}return f};b.toArray=function(a){return!a?[]:b.isArray(a)?i.call(a):a.length===+a.length?b.map(a,b.identity):
b.values(a)};b.size=function(a){return a==null?0:a.length===+a.length?a.length:b.keys(a).length};b.first=b.head=b.take=function(a,c,b){return a==null?void 0:c==null||b?a[0]:i.call(a,0,c)};b.initial=function(a,c,b){return i.call(a,0,a.length-(c==null||b?1:c))};b.last=function(a,c,b){return a==null?void 0:c==null||b?a[a.length-1]:i.call(a,Math.max(a.length-c,0))};b.rest=b.tail=b.drop=function(a,b,d){return i.call(a,b==null||d?1:b)};b.compact=function(a){return b.filter(a,b.identity)};var I=function(a,
c,d){if(c&&b.every(a,b.isArray))return p.apply(d,a);j(a,function(a){b.isArray(a)||b.isArguments(a)?c?s.apply(d,a):I(a,c,d):d.push(a)});return d};b.flatten=function(a,b){return I(a,b,[])};b.without=function(a){return b.difference(a,i.call(arguments,1))};b.uniq=b.unique=function(a,c,d,e){if(b.isFunction(c)){e=d;d=c;c=false}var d=d?b.map(a,d,e):a,f=[],g=[];j(d,function(d,e){if(c?!e||g[g.length-1]!==d:!b.contains(g,d)){g.push(d);f.push(a[e])}});return f};b.union=function(){return b.uniq(b.flatten(arguments,
true))};b.intersection=function(a){var c=i.call(arguments,1);return b.filter(b.uniq(a),function(a){return b.every(c,function(c){return b.indexOf(c,a)>=0})})};b.difference=function(a){var c=p.apply(k,i.call(arguments,1));return b.filter(a,function(a){return!b.contains(c,a)})};b.zip=function(){for(var a=b.max(b.pluck(arguments,"length").concat(0)),c=Array(a),d=0;d<a;d++)c[d]=b.pluck(arguments,""+d);return c};b.object=function(a,b){if(a==null)return{};for(var d={},e=0,f=a.length;e<f;e++)b?d[a[e]]=b[e]:
d[a[e][0]]=a[e][1];return d};b.indexOf=function(a,c,d){if(a==null)return-1;var e=0,f=a.length;if(d)if(typeof d=="number")e=d<0?Math.max(0,f+d):d;else{e=b.sortedIndex(a,c);return a[e]===c?e:-1}if(q&&a.indexOf===q)return a.indexOf(c,d);for(;e<f;e++)if(a[e]===c)return e;return-1};b.lastIndexOf=function(a,b,d){if(a==null)return-1;var e=d!=null;if(G&&a.lastIndexOf===G)return e?a.lastIndexOf(b,d):a.lastIndexOf(b);for(d=e?d:a.length;d--;)if(a[d]===b)return d;return-1};b.range=function(a,b,d){if(arguments.length<=
1){b=a||0;a=0}for(var d=arguments[2]||1,e=Math.max(Math.ceil((b-a)/d),0),f=0,g=Array(e);f<e;){g[f++]=a;a=a+d}return g};var w=function(){};b.bind=function(a,c){var d,e;if(t&&a.bind===t)return t.apply(a,i.call(arguments,1));if(!b.isFunction(a))throw new TypeError;d=i.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(c,d.concat(i.call(arguments)));w.prototype=a.prototype;var b=new w;w.prototype=null;var g=a.apply(b,d.concat(i.call(arguments)));return Object(g)===g?g:b}};b.partial=
function(a){var b=i.call(arguments,1);return function(){return a.apply(this,b.concat(i.call(arguments)))}};b.bindAll=function(a){var c=i.call(arguments,1);if(c.length===0)throw Error("bindAll must be passed function names");j(c,function(c){a[c]=b.bind(a[c],a)});return a};b.memoize=function(a,c){var d={};c||(c=b.identity);return function(){var e=c.apply(this,arguments);return b.has(d,e)?d[e]:d[e]=a.apply(this,arguments)}};b.delay=function(a,b){var d=i.call(arguments,2);return setTimeout(function(){return a.apply(null,
d)},b)};b.defer=function(a){return b.delay.apply(b,[a,1].concat(i.call(arguments,1)))};b.throttle=function(a,b,d){var e,f,g,h=null,i=0;d||(d={});var j=function(){i=d.leading===false?0:new Date;h=null;g=a.apply(e,f)};return function(){var k=new Date;!i&&d.leading===false&&(i=k);var J=b-(k-i);e=this;f=arguments;if(J<=0){clearTimeout(h);h=null;i=k;g=a.apply(e,f)}else!h&&d.trailing!==false&&(h=setTimeout(j,J));return g}};b.debounce=function(a,b,d){var e,f,g,h,i;return function(){g=this;f=arguments;h=
new Date;var j=function(){var k=new Date-h;if(k<b)e=setTimeout(j,b-k);else{e=null;d||(i=a.apply(g,f))}},k=d&&!e;e||(e=setTimeout(j,b));k&&(i=a.apply(g,f));return i}};b.once=function(a){var b=false,d;return function(){if(b)return d;b=true;d=a.apply(this,arguments);a=null;return d}};b.wrap=function(a,b){return function(){var d=[a];s.apply(d,arguments);return b.apply(this,d)}};b.compose=function(){var a=arguments;return function(){for(var b=arguments,d=a.length-1;d>=0;d--)b=[a[d].apply(this,b)];return b[0]}};
b.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}};b.keys=M||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],d;for(d in a)b.has(a,d)&&c.push(d);return c};b.values=function(a){for(var c=b.keys(a),d=c.length,e=Array(d),f=0;f<d;f++)e[f]=a[c[f]];return e};b.pairs=function(a){for(var c=b.keys(a),d=c.length,e=Array(d),f=0;f<d;f++)e[f]=[c[f],a[c[f]]];return e};b.invert=function(a){for(var c={},d=b.keys(a),e=0,f=d.length;e<f;e++)c[a[d[e]]]=d[e];return c};
b.functions=b.methods=function(a){var c=[],d;for(d in a)b.isFunction(a[d])&&c.push(d);return c.sort()};b.extend=function(a){j(i.call(arguments,1),function(b){if(b)for(var d in b)a[d]=b[d]});return a};b.pick=function(a){var b={},d=p.apply(k,i.call(arguments,1));j(d,function(d){d in a&&(b[d]=a[d])});return b};b.omit=function(a){var c={},d=p.apply(k,i.call(arguments,1)),e;for(e in a)b.contains(d,e)||(c[e]=a[e]);return c};b.defaults=function(a){j(i.call(arguments,1),function(b){if(b)for(var d in b)a[d]===
void 0&&(a[d]=b[d])});return a};b.clone=function(a){return!b.isObject(a)?a:b.isArray(a)?a.slice():b.extend({},a)};b.tap=function(a,b){b(a);return a};var x=function(a,c,d,e){if(a===c)return a!==0||1/a==1/c;if(a==null||c==null)return a===c;if(a instanceof b)a=a._wrapped;if(c instanceof b)c=c._wrapped;var f=l.call(a);if(f!=l.call(c))return false;switch(f){case "[object String]":return a==String(c);case "[object Number]":return a!=+a?c!=+c:a==0?1/a==1/c:a==+c;case "[object Date]":case "[object Boolean]":return+a==
+c;case "[object RegExp]":return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if(typeof a!="object"||typeof c!="object")return false;for(var g=d.length;g--;)if(d[g]==a)return e[g]==c;var g=a.constructor,h=c.constructor;if(g!==h&&(!b.isFunction(g)||!(g instanceof g&&b.isFunction(h)&&h instanceof h)))return false;d.push(a);e.push(c);g=0;h=true;if(f=="[object Array]"){g=a.length;if(h=g==c.length)for(;g--;)if(!(h=x(a[g],c[g],d,e)))break}else{for(var i in a)if(b.has(a,
i)){g++;if(!(h=b.has(c,i)&&x(a[i],c[i],d,e)))break}if(h){for(i in c)if(b.has(c,i)&&!g--)break;h=!g}}d.pop();e.pop();return h};b.isEqual=function(a,b){return x(a,b,[],[])};b.isEmpty=function(a){if(a==null)return true;if(b.isArray(a)||b.isString(a))return a.length===0;for(var c in a)if(b.has(a,c))return false;return true};b.isElement=function(a){return!!(a&&a.nodeType===1)};b.isArray=o||function(a){return l.call(a)=="[object Array]"};b.isObject=function(a){return a===Object(a)};j("Arguments Function String Number Date RegExp".split(" "),
function(a){b["is"+a]=function(b){return l.call(b)=="[object "+a+"]"}});b.isArguments(arguments)||(b.isArguments=function(a){return!(!a||!b.has(a,"callee"))});"function"!==typeof/./&&(b.isFunction=function(a){return typeof a==="function"});b.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};b.isNaN=function(a){return b.isNumber(a)&&a!=+a};b.isBoolean=function(a){return a===true||a===false||l.call(a)=="[object Boolean]"};b.isNull=function(a){return a===null};b.isUndefined=function(a){return a===
void 0};b.has=function(a,b){return L.call(a,b)};b.noConflict=function(){r._=K;return this};b.identity=function(a){return a};b.times=function(a,b,d){for(var e=Array(Math.max(0,a)),f=0;f<a;f++)e[f]=b.call(d,f);return e};b.random=function(a,b){if(b==null){b=a;a=0}return a+Math.floor(Math.random()*(b-a+1))};var m={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};m.unescape=b.invert(m.escape);var O={escape:RegExp("["+b.keys(m.escape).join("")+"]","g"),unescape:RegExp("("+b.keys(m.unescape).join("|")+
")","g")};b.each(["escape","unescape"],function(a){b[a]=function(b){return b==null?"":(""+b).replace(O[a],function(b){return m[a][b]})}});b.result=function(a,c){if(a!=null){var d=a[c];return b.isFunction(d)?d.call(a):d}};b.mixin=function(a){j(b.functions(a),function(c){var d=b[c]=a[c];b.prototype[c]=function(){var a=[this._wrapped];s.apply(a,arguments);a=d.apply(b,a);return this._chain?b(a).chain():a}})};var P=0;b.uniqueId=function(a){var b=++P+"";return a?a+b:b};b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,
interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var y=/(.)^/,Q={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\t|\u2028|\u2029/g;b.template=function(a,c,d){var e,d=b.defaults({},d,b.templateSettings),f=RegExp([(d.escape||y).source,(d.interpolate||y).source,(d.evaluate||y).source].join("|")+"|$","g"),g=0,h="__p+='";a.replace(f,function(b,c,d,e,f){h=h+a.slice(g,f).replace(R,function(a){return"\\"+Q[a]});c&&(h=h+("'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"));
d&&(h=h+("'+\n((__t=("+d+"))==null?'':__t)+\n'"));e&&(h=h+("';\n"+e+"\n__p+='"));g=f+b.length;return b});h=h+"';\n";d.variable||(h="with(obj||{}){\n"+h+"}\n");h="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+h+"return __p;\n";try{e=new Function(d.variable||"obj","_",h)}catch(i){i.source=h;throw i;}if(c)return e(c,b);c=function(a){return e.call(this,a,b)};c.source="function("+(d.variable||"obj")+"){\n"+h+"}";return c};b.chain=function(a){return b(a).chain()};
b.mixin(b);j("pop push reverse shift sort splice unshift".split(" "),function(a){var c=k[a];b.prototype[a]=function(){var d=this._wrapped;c.apply(d,arguments);(a=="shift"||a=="splice")&&d.length===0&&delete d[0];return this._chain?b(d).chain():d}});j(["concat","join","slice"],function(a){var c=k[a];b.prototype[a]=function(){var a=c.apply(this._wrapped,arguments);return this._chain?b(a).chain():a}});b.extend(b.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);
"function"===typeof window.define&&define("underscore",[],function(){return window._});;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/aui.soy' */
// This file was automatically generated from aui.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.
 */

if (typeof aui == 'undefined') { var aui = {}; }


aui.renderExtraAttributes = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '';
  if (opt_data.extraAttributes) {
    if (Object.prototype.toString.call(opt_data.extraAttributes) === '[object Object]') {
      var attrList7 = soy.$$getMapKeys(opt_data.extraAttributes);
      var attrListLen7 = attrList7.length;
      for (var attrIndex7 = 0; attrIndex7 < attrListLen7; attrIndex7++) {
        var attrData7 = attrList7[attrIndex7];
        output += ' ' + soy.$$escapeHtml(attrData7) + '="' + soy.$$escapeHtml(opt_data.extraAttributes[attrData7]) + '"';
      }
    } else {
      output += ' ' + soy.$$filterNoAutoescape(opt_data.extraAttributes);
    }
  }
  return output;
};
if (goog.DEBUG) {
  aui.renderExtraAttributes.soyTemplateName = 'aui.renderExtraAttributes';
}


aui.renderExtraClasses = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '';
  if (opt_data.extraClasses) {
    if ((opt_data.extraClasses) instanceof Array) {
      var classList23 = opt_data.extraClasses;
      var classListLen23 = classList23.length;
      for (var classIndex23 = 0; classIndex23 < classListLen23; classIndex23++) {
        var classData23 = classList23[classIndex23];
        output += ' ' + soy.$$escapeHtml(classData23);
      }
    } else {
      output += ' ' + soy.$$escapeHtml(opt_data.extraClasses);
    }
  }
  return output;
};
if (goog.DEBUG) {
  aui.renderExtraClasses.soyTemplateName = 'aui.renderExtraClasses';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/badges.soy' */
// This file was automatically generated from badges.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.badges.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.badges == 'undefined') { aui.badges = {}; }


aui.badges.badge = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'span') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-badge' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$escapeHtml(opt_data.text) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'span') + '>';
};
if (goog.DEBUG) {
  aui.badges.badge.soyTemplateName = 'aui.badges.badge';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/buttons.soy' */
// This file was automatically generated from buttons.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.buttons.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.buttons == 'undefined') { aui.buttons = {}; }


aui.buttons.button = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.href) {
    output += '<a href="' + soy.$$escapeHtml(opt_data.href) + '"' + aui.buttons.buttonAttributes(soy.$$augmentMap(opt_data, {tagName: 'a'})) + '>' + aui.buttons.buttonIcon(opt_data) + ((opt_data.hasLabel) ? '<span class="aui-button-label">' : '') + soy.$$escapeHtml(opt_data.text) + ((opt_data.hasLabel) ? '</span>' : '') + '</a>';
  } else if (opt_data.tagName == 'input') {
    output += '<input type="' + soy.$$escapeHtml(opt_data.inputType ? opt_data.inputType : 'button') + '" ' + aui.buttons.buttonAttributes(opt_data) + ' value="' + soy.$$escapeHtml(opt_data.text) + '" />';
  } else {
    var theTagName__soy29 = opt_data.tagName ? opt_data.tagName : 'button';
    output += '<' + soy.$$escapeHtml(theTagName__soy29) + aui.buttons.buttonAttributes(soy.$$augmentMap(opt_data, {tagName: theTagName__soy29})) + '>' + aui.buttons.buttonIcon(opt_data) + ((opt_data.hasLabel) ? '<span class="aui-button-label">' : '') + soy.$$escapeHtml(opt_data.text) + ((opt_data.hasLabel) ? '</span>' : '') + '</' + soy.$$escapeHtml(theTagName__soy29) + '>';
  }
  return output;
};
if (goog.DEBUG) {
  aui.buttons.button.soyTemplateName = 'aui.buttons.button';
}


aui.buttons.buttons = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-buttons' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  aui.buttons.buttons.soyTemplateName = 'aui.buttons.buttons';
}


aui.buttons.buttonAttributes = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-button' + ((opt_data.splitButtonType == 'main') ? ' aui-button-split-main' : '') + ((opt_data.dropdown2Target) ? ' aui-dropdown2-trigger' + ((opt_data.splitButtonType == 'more') ? ' aui-button-split-more' : '') : '');
  switch (opt_data.type) {
    case 'primary':
      output += ' aui-button-primary';
      break;
    case 'link':
      output += ' aui-button-link';
      break;
    case 'subtle':
      output += ' aui-button-subtle';
      break;
    case 'text':
      output += ' aui-button-text';
      break;
  }
  output += aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + ((opt_data.isPressed) ? ' aria-pressed="' + soy.$$escapeHtml(opt_data.isPressed) + '"' : '') + ((opt_data.isDisabled) ? ' aria-disabled="' + soy.$$escapeHtml(opt_data.isDisabled) + '"' + ((opt_data.isDisabled == true) ? (opt_data.tagName == 'button' || opt_data.tagName == 'input') ? ' disabled="disabled" ' : '' : '') : '') + ((opt_data.dropdown2Target) ? ' aria-owns="' + soy.$$escapeHtml(opt_data.dropdown2Target) + '" aria-haspopup="true"' : '') + ((opt_data.tagName == 'a') ? ' tabindex="0"' : '');
  return output;
};
if (goog.DEBUG) {
  aui.buttons.buttonAttributes.soyTemplateName = 'aui.buttons.buttonAttributes';
}


aui.buttons.buttonIcon = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.iconType) ? '<span class="' + ((opt_data.iconType == 'aui') ? 'aui-icon' : '') + ((opt_data.iconClass) ? ' ' + soy.$$escapeHtml(opt_data.iconClass) : '') + '">' + ((opt_data.iconText) ? soy.$$escapeHtml(opt_data.iconText) + ' ' : '') + '</span>' : '');
};
if (goog.DEBUG) {
  aui.buttons.buttonIcon.soyTemplateName = 'aui.buttons.buttonIcon';
}


aui.buttons.splitButton = function(opt_data, opt_ignored) {
  return '' + aui.buttons.button(soy.$$augmentMap(opt_data.splitButtonMain, {splitButtonType: 'main'})) + aui.buttons.button(soy.$$augmentMap(opt_data.splitButtonMore, {splitButtonType: 'more'}));
};
if (goog.DEBUG) {
  aui.buttons.splitButton.soyTemplateName = 'aui.buttons.splitButton';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/dropdown.soy' */
// This file was automatically generated from dropdown.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.dropdown.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.dropdown == 'undefined') { aui.dropdown = {}; }


aui.dropdown.trigger = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<a' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dd-trigger' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><span class="dropdown-text">' + ((opt_data.accessibilityText) ? soy.$$escapeHtml(opt_data.accessibilityText) : '') + '</span>' + ((! (opt_data.showIcon == false)) ? '<span class="icon icon-dropdown"></span>' : '') + '</a>';
};
if (goog.DEBUG) {
  aui.dropdown.trigger.soyTemplateName = 'aui.dropdown.trigger';
}


aui.dropdown.menu = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'ul') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dropdown hidden' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'ul') + '>';
};
if (goog.DEBUG) {
  aui.dropdown.menu.soyTemplateName = 'aui.dropdown.menu';
}


aui.dropdown.parent = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dd-parent' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
};
if (goog.DEBUG) {
  aui.dropdown.parent.soyTemplateName = 'aui.dropdown.parent';
}


aui.dropdown.item = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'li') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="dropdown-item' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><a href="' + soy.$$escapeHtml(opt_data.url ? opt_data.url : '#') + '">' + soy.$$escapeHtml(opt_data.text) + '</a></' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'li') + '>';
};
if (goog.DEBUG) {
  aui.dropdown.item.soyTemplateName = 'aui.dropdown.item';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/dropdown2.soy' */
// This file was automatically generated from dropdown2.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.dropdown2.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.dropdown2 == 'undefined') { aui.dropdown2 = {}; }


aui.dropdown2.dropdown2 = function(opt_data, opt_ignored) {
  return '' + aui.dropdown2.trigger(soy.$$augmentMap(opt_data.trigger, {menu: opt_data.menu})) + aui.dropdown2.contents(opt_data.menu);
};
if (goog.DEBUG) {
  aui.dropdown2.dropdown2.soyTemplateName = 'aui.dropdown2.dropdown2';
}


aui.dropdown2.trigger = function(opt_data, opt_ignored) {
  return '' + aui.trigger.trigger(soy.$$augmentMap(opt_data, {extraClasses: 'aui-dropdown2-trigger' + aui.renderExtraClasses(opt_data)}));
};
if (goog.DEBUG) {
  aui.dropdown2.trigger.soyTemplateName = 'aui.dropdown2.trigger';
}


aui.dropdown2.contents = function(opt_data, opt_ignored) {
  return '<div id="' + soy.$$escapeHtml(opt_data.id) + '" class="aui-dropdown2' + aui.renderExtraClasses(opt_data) + '" role="menu" aria-hidden="true"' + aui.renderExtraAttributes(opt_data) + '><div role="application">' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</div></div>';
};
if (goog.DEBUG) {
  aui.dropdown2.contents.soyTemplateName = 'aui.dropdown2.contents';
}


aui.dropdown2.section = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dropdown2-section' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.label) ? '<strong role="presentation" class="aui-dropdown2-heading">' + soy.$$escapeHtml(opt_data.label) + '</strong>' : '') + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  aui.dropdown2.section.soyTemplateName = 'aui.dropdown2.section';
}


aui.dropdown2.itemGroup = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div ' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' role="presentation" class="aui-dropdown2-section' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.label) ? '<strong role="presentation" class="aui-dropdown2-heading">' + soy.$$escapeHtml(opt_data.label) + '</strong>' : '') + '<div role="group"' + ((opt_data.label) ? ' aria-label="' + soy.$$escapeHtml(opt_data.label) + '"' : '') + '>' + aui.dropdown2.itemList(opt_data) + '</div></div>';
};
if (goog.DEBUG) {
  aui.dropdown2.itemGroup.soyTemplateName = 'aui.dropdown2.itemGroup';
}


aui.dropdown2.itemList = function(opt_data, opt_ignored) {
  var output = '<ul' + ((opt_data.isTruncated) ? ' class="aui-list-truncate"' : '') + ' role="presentation">';
  var itemList76 = opt_data.items;
  var itemListLen76 = itemList76.length;
  for (var itemIndex76 = 0; itemIndex76 < itemListLen76; itemIndex76++) {
    var itemData76 = itemList76[itemIndex76];
    output += '<li ' + ((itemData76.isHidden) ? 'class="aui-dropdown2-hidden" aria-hidden="true"' : '') + ' role="presentation">';
    switch (itemData76.itemType) {
      case 'checkbox':
        output += aui.dropdown2.menuCheckbox(itemData76);
        break;
      case 'radio':
        output += aui.dropdown2.menuRadio(itemData76);
        break;
      default:
        output += aui.dropdown2.menuLink(itemData76);
    }
    output += '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  aui.dropdown2.itemList.soyTemplateName = 'aui.dropdown2.itemList';
}


aui.dropdown2.menuLink = function(opt_data, opt_ignored) {
  return '<a role="menuitem" tabindex="-1" class="' + aui.renderExtraClasses(opt_data) + ((opt_data.submenuTarget) ? ' aui-dropdown2-sub-trigger' : '') + ((opt_data.isDisabled) ? ' aui-dropdown2-disabled' : '') + '"' + ((opt_data.href) ? ' href="' + soy.$$escapeHtml(opt_data.href) + '"' : '') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.isDisabled) ? ' aria-disabled="' + soy.$$escapeHtml(opt_data.isDisabled) + '"' : '') + ((opt_data.submenuTarget) ? ' aria-controls="' + soy.$$escapeHtml(opt_data.submenuTarget) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$escapeHtml(opt_data.text) + '</a>';
};
if (goog.DEBUG) {
  aui.dropdown2.menuLink.soyTemplateName = 'aui.dropdown2.menuLink';
}


aui.dropdown2.menuCheckbox = function(opt_data, opt_ignored) {
  return '<span role="menuitemcheckbox" tabindex="-1" class="aui-dropdown2-checkbox' + ((opt_data.isInteractive) ? ' aui-dropdown2-interactive' : '') + ((opt_data.isDisabled) ? ' aui-dropdown2-disabled' : '') + ((opt_data.isChecked) ? ' aui-dropdown2-checked' : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.isChecked) ? ' aria-checked="' + soy.$$escapeHtml(opt_data.isChecked) + '"' : ' aria-checked="false"') + ((opt_data.isDisabled) ? ' aria-disabled="' + soy.$$escapeHtml(opt_data.isDisabled) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$escapeHtml(opt_data.text) + '</span>';
};
if (goog.DEBUG) {
  aui.dropdown2.menuCheckbox.soyTemplateName = 'aui.dropdown2.menuCheckbox';
}


aui.dropdown2.menuRadio = function(opt_data, opt_ignored) {
  return '<span role="menuitemradio" tabindex="-1" class="aui-dropdown2-radio' + ((opt_data.isInteractive) ? ' aui-dropdown2-interactive' : '') + ((opt_data.isDisabled) ? ' aui-dropdown2-disabled' : '') + ((opt_data.isChecked) ? ' aui-dropdown2-checked' : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.isChecked) ? ' aria-checked="' + soy.$$escapeHtml(opt_data.isChecked) + '"' : ' aria-checked="false"') + ((opt_data.isDisabled) ? ' aria-disabled="' + soy.$$escapeHtml(opt_data.isDisabled) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$escapeHtml(opt_data.text) + '</span>';
};
if (goog.DEBUG) {
  aui.dropdown2.menuRadio.soyTemplateName = 'aui.dropdown2.menuRadio';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/form.soy' */
// This file was automatically generated from form.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.form.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.form == 'undefined') { aui.form = {}; }


aui.form.form = function(opt_data, opt_ignored) {
  return '<form' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui' + ((opt_data.isUnsectioned) ? ' unsectioned' : '') + ((opt_data.isLongLabels) ? ' long-label' : '') + ((opt_data.isTopLabels) ? ' top-label' : '') + aui.renderExtraClasses(opt_data) + '" action="' + soy.$$escapeHtml(opt_data.action) + '" method="' + soy.$$escapeHtml(opt_data.method ? opt_data.method : 'post') + '"' + ((opt_data.enctype) ? ' enctype="' + soy.$$escapeHtml(opt_data.enctype) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</form>';
};
if (goog.DEBUG) {
  aui.form.form.soyTemplateName = 'aui.form.form';
}


aui.form.formDescription = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="field-group' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  aui.form.formDescription.soyTemplateName = 'aui.form.formDescription';
}


aui.form.fieldset = function(opt_data, opt_ignored) {
  var output = '';
  var hasClass__soy51 = opt_data.isInline || opt_data.isDateSelect || opt_data.isGroup || opt_data.extraClasses;
  output += '<fieldset' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((hasClass__soy51) ? ' class="' + soy.$$escapeHtml(opt_data.isInline ? 'inline' : opt_data.isDateSelect ? 'date-select' : opt_data.isGroup ? 'group' : '') + aui.renderExtraClasses(opt_data) + '"' : '') + aui.renderExtraAttributes(opt_data) + '><legend><span>' + soy.$$filterNoAutoescape(opt_data.legendContent) + '</span></legend>' + soy.$$filterNoAutoescape(opt_data.content) + '</fieldset>';
  return output;
};
if (goog.DEBUG) {
  aui.form.fieldset.soyTemplateName = 'aui.form.fieldset';
}


aui.form.fieldGroup = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="field-group' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  aui.form.fieldGroup.soyTemplateName = 'aui.form.fieldGroup';
}


aui.form.buttons = function(opt_data, opt_ignored) {
  return '<div class="buttons-container' + ((opt_data.alignment) ? ' ' + soy.$$escapeHtml(opt_data.alignment) : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><div class="buttons">' + soy.$$filterNoAutoescape(opt_data.content) + '</div></div>';
};
if (goog.DEBUG) {
  aui.form.buttons.soyTemplateName = 'aui.form.buttons';
}


aui.form.label = function(opt_data, opt_ignored) {
  return '<label' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.forField) ? ' for="' + soy.$$escapeHtml(opt_data.forField) + '"' : '') + ((opt_data.extraClasses) ? ' class="' + aui.renderExtraClasses(opt_data) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + ((opt_data.isRequired) ? '<span class="aui-icon icon-required"></span>' : '') + '</label>';
};
if (goog.DEBUG) {
  aui.form.label.soyTemplateName = 'aui.form.label';
}


aui.form.input = function(opt_data, opt_ignored) {
  var output = '';
  var baseType__soy126 = '';
  switch (opt_data.type) {
    case 'password':
    case 'email':
    case 'url':
    case 'tel':
    case 'search':
      baseType__soy126 += 'text';
      break;
    case 'submit':
    case 'reset':
      baseType__soy126 += 'button';
      break;
    default:
      baseType__soy126 += soy.$$escapeHtml(opt_data.type);
  }
  output += '<input class="' + soy.$$escapeHtml(baseType__soy126) + aui.renderExtraClasses(opt_data) + ((opt_data.icon && baseType__soy126 == 'text') ? ' aui-field-has-icon' : '') + '" type="' + soy.$$escapeHtml(opt_data.type) + '" name="' + ((opt_data.name) ? soy.$$escapeHtml(opt_data.name) : soy.$$escapeHtml(opt_data.id)) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.value) ? ' value="' + soy.$$escapeHtml(opt_data.value) + '"' : '') + (((opt_data.type == 'checkbox' || opt_data.type == 'radio') && opt_data.isChecked) ? ' checked="checked"' : '') + ((baseType__soy126 == 'text' && opt_data.type != 'password' && opt_data.maxLength) ? ' maxlength="' + soy.$$escapeHtml(opt_data.maxLength) + '"' : '') + ((baseType__soy126 == 'text' && opt_data.type != 'password' && opt_data.size) ? ' size="' + soy.$$escapeHtml(opt_data.size) + '"' : '') + ((baseType__soy126 == 'text' && opt_data.placeholderText) ? ' placeholder="' + soy.$$escapeHtml(opt_data.placeholderText) + '"' : '') + ((baseType__soy126 == 'text' && opt_data.autocomplete) ? ' autocomplete="' + soy.$$escapeHtml(opt_data.autocomplete) + '"' : '') + ((opt_data.isDisabled) ? ' disabled' : '') + ((opt_data.isAutofocus) ? ' autofocus' : '') + aui.renderExtraAttributes(opt_data) + aui.form.renderValidationArguments(opt_data) + aui.form.renderInfoMessage(opt_data) + aui.form.renderFieldComponentAttribute(opt_data) + aui.form.renderTooltipArguments(opt_data) + '/>' + ((opt_data.icon && baseType__soy126 == 'text') ? aui.icons.icon({icon: opt_data.icon, useIconFont: true, size: 'small'}) : '');
  return output;
};
if (goog.DEBUG) {
  aui.form.input.soyTemplateName = 'aui.form.input';
}


aui.form.renderValidationArguments = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '';
  if (opt_data.validationArguments) {
    var argumentList203 = soy.$$getMapKeys(opt_data.validationArguments);
    var argumentListLen203 = argumentList203.length;
    for (var argumentIndex203 = 0; argumentIndex203 < argumentListLen203; argumentIndex203++) {
      var argumentData203 = argumentList203[argumentIndex203];
      output += ' ' + soy.$$escapeHtml('data-aui-validation-' + argumentData203) + '="' + soy.$$escapeHtml(opt_data.validationArguments[argumentData203]) + '"';
    }
  }
  return output;
};
if (goog.DEBUG) {
  aui.form.renderValidationArguments.soyTemplateName = 'aui.form.renderValidationArguments';
}


aui.form.renderTooltipArguments = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '';
  if (opt_data.tooltipArguments) {
    var argumentList213 = soy.$$getMapKeys(opt_data.tooltipArguments);
    var argumentListLen213 = argumentList213.length;
    for (var argumentIndex213 = 0; argumentIndex213 < argumentListLen213; argumentIndex213++) {
      var argumentData213 = argumentList213[argumentIndex213];
      output += ' ' + soy.$$escapeHtml('data-aui-notification-' + argumentData213) + '="' + soy.$$escapeHtml(opt_data.tooltipArguments[argumentData213]) + '"';
    }
  }
  return output;
};
if (goog.DEBUG) {
  aui.form.renderTooltipArguments.soyTemplateName = 'aui.form.renderTooltipArguments';
}


aui.form.renderInfoMessage = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.infoMessage) ? ' data-aui-notification-info="' + soy.$$escapeHtml(opt_data.infoMessage) + '"' : '');
};
if (goog.DEBUG) {
  aui.form.renderInfoMessage.soyTemplateName = 'aui.form.renderInfoMessage';
}


aui.form.renderFieldComponentAttribute = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.infoMessage) ? ' data-aui-notification-field' : '') + ((opt_data.validationArguments) ? ' data-aui-validation-field' : '');
};
if (goog.DEBUG) {
  aui.form.renderFieldComponentAttribute.soyTemplateName = 'aui.form.renderFieldComponentAttribute';
}


aui.form.submit = function(opt_data, opt_ignored) {
  return '' + aui.form.button(soy.$$augmentMap(opt_data, {tagName: 'input', inputType: 'submit'}));
};
if (goog.DEBUG) {
  aui.form.submit.soyTemplateName = 'aui.form.submit';
}


aui.form.button = function(opt_data, opt_ignored) {
  return '' + aui.buttons.button(soy.$$augmentMap(opt_data, {extraClasses: opt_data.extraClasses, extraAttributes: '' + ((opt_data.name) ? 'name="' + soy.$$escapeHtml(opt_data.name) + '"' : '') + aui.renderExtraAttributes(opt_data)}));
};
if (goog.DEBUG) {
  aui.form.button.soyTemplateName = 'aui.form.button';
}


aui.form.linkButton = function(opt_data, opt_ignored) {
  return '' + aui.buttons.button(soy.$$augmentMap(opt_data, {tagName: 'a', type: 'link', href: opt_data.href ? opt_data.href : opt_data.url, extraClasses: 'cancel' + aui.renderExtraClasses(opt_data), extraAttributes: '' + ((opt_data.name) ? 'name="' + soy.$$escapeHtml(opt_data.name) + '"' : '') + aui.renderExtraAttributes(opt_data)}));
};
if (goog.DEBUG) {
  aui.form.linkButton.soyTemplateName = 'aui.form.linkButton';
}


aui.form.textarea = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<textarea name="' + ((opt_data.name) ? soy.$$escapeHtml(opt_data.name) : soy.$$escapeHtml(opt_data.id)) + '" class="textarea' + aui.renderExtraClasses(opt_data) + ' ' + ((opt_data.icon) ? 'aui-field-has-icon' : '') + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.rows) ? ' rows="' + soy.$$escapeHtml(opt_data.rows) + '"' : '') + ((opt_data.cols) ? ' cols="' + soy.$$escapeHtml(opt_data.cols) + '"' : '') + ((opt_data.autocomplete) ? ' autocomplete="' + soy.$$escapeHtml(opt_data.autocomplete) + '"' : '') + ((opt_data.isDisabled) ? ' disabled' : '') + ((opt_data.isAutofocus) ? ' autofocus' : '') + ((opt_data.placeholderText) ? ' placeholder="' + soy.$$escapeHtml(opt_data.placeholderText) + '"' : '') + aui.renderExtraAttributes(opt_data) + aui.form.renderValidationArguments(opt_data) + aui.form.renderInfoMessage(opt_data) + aui.form.renderFieldComponentAttribute(opt_data) + aui.form.renderTooltipArguments(opt_data) + '>' + ((opt_data.value) ? soy.$$escapeHtml(opt_data.value) : '') + '</textarea>' + ((opt_data.icon) ? aui.icons.icon({icon: opt_data.icon, useIconFont: true, size: 'small'}) : '');
};
if (goog.DEBUG) {
  aui.form.textarea.soyTemplateName = 'aui.form.textarea';
}


aui.form.select = function(opt_data, opt_ignored) {
  var output = '<select' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' name="' + ((opt_data.name) ? soy.$$escapeHtml(opt_data.name) : soy.$$escapeHtml(opt_data.id)) + '" class="' + soy.$$escapeHtml(opt_data.isMultiple ? 'multi-select' : 'select') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.size) ? ' size="' + soy.$$escapeHtml(opt_data.size) + '"' : '') + ((opt_data.isDisabled) ? ' disabled' : '') + ((opt_data.isAutofocus) ? ' autofocus' : '') + ((opt_data.isMultiple) ? ' multiple' : '') + aui.renderExtraAttributes(opt_data) + aui.form.renderValidationArguments(opt_data) + aui.form.renderInfoMessage(opt_data) + aui.form.renderFieldComponentAttribute(opt_data) + aui.form.renderTooltipArguments(opt_data) + '>';
  var optionList367 = opt_data.options;
  var optionListLen367 = optionList367.length;
  for (var optionIndex367 = 0; optionIndex367 < optionListLen367; optionIndex367++) {
    var optionData367 = optionList367[optionIndex367];
    output += aui.form.optionOrOptgroup(soy.$$augmentMap(optionData367, {defaultValue: opt_data.value}));
  }
  output += '</select>';
  return output;
};
if (goog.DEBUG) {
  aui.form.select.soyTemplateName = 'aui.form.select';
}


aui.form.optionOrOptgroup = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.options) {
    output += '<optgroup label="' + soy.$$escapeHtml(opt_data.text) + '"' + ((opt_data.disabled) ? ' disabled' : '') + '>';
    var optionList382 = opt_data.options;
    var optionListLen382 = optionList382.length;
    for (var optionIndex382 = 0; optionIndex382 < optionListLen382; optionIndex382++) {
      var optionData382 = optionList382[optionIndex382];
      output += aui.form.optionOrOptgroup(soy.$$augmentMap(optionData382, {defaultValue: opt_data.defaultValue}));
    }
    output += '</optgroup>';
  } else {
    output += '<option value="' + soy.$$escapeHtml(opt_data.value) + '"' + ((opt_data.selected || opt_data.defaultValue == opt_data.value) ? ' selected' : '') + ((opt_data.disabled) ? ' disabled' : '') + '>' + soy.$$escapeHtml(opt_data.text) + '</option>';
  }
  return output;
};
if (goog.DEBUG) {
  aui.form.optionOrOptgroup.soyTemplateName = 'aui.form.optionOrOptgroup';
}


aui.form.value = function(opt_data, opt_ignored) {
  return '<span' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="field-value' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</span>';
};
if (goog.DEBUG) {
  aui.form.value.soyTemplateName = 'aui.form.value';
}


aui.form.field = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '';
  var isCheckboxOrRadio__soy416 = opt_data.type == 'checkbox' || opt_data.type == 'radio';
  var fieldWidthClass__soy417 = opt_data.fieldWidth ? opt_data.fieldWidth + '-field' : '';
  output += '<div class="' + ((isCheckboxOrRadio__soy416) ? soy.$$escapeHtml(opt_data.type) : 'field-group') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.labelContent && ! isCheckboxOrRadio__soy416) ? aui.form.label({forField: opt_data.id, isRequired: opt_data.isRequired, content: opt_data.labelContent}) : '');
  switch (opt_data.type) {
    case 'textarea':
      output += aui.form.textarea({id: opt_data.id, name: opt_data.name, value: opt_data.value, rows: opt_data.rows, cols: opt_data.cols, autocomplete: opt_data.autocomplete, placeholderText: opt_data.placeholderText, isDisabled: opt_data.isDisabled ? true : false, isAutofocus: opt_data.isAutofocus, extraClasses: fieldWidthClass__soy417, icon: opt_data.icon, validationArguments: opt_data.validationArguments, infoMessage: opt_data.infoMessage, tooltipArguments: opt_data.tooltipArguments});
      break;
    case 'select':
      output += aui.form.select({id: opt_data.id, name: opt_data.name, value: opt_data.value, options: opt_data.options, isMultiple: opt_data.isMultiple, size: opt_data.size, isDisabled: opt_data.isDisabled ? true : false, isAutofocus: opt_data.isAutofocus, extraClasses: fieldWidthClass__soy417, validationArguments: opt_data.validationArguments, infoMessage: opt_data.infoMessage, tooltipArguments: opt_data.tooltipArguments});
      break;
    case 'value':
      output += aui.form.value({id: opt_data.id, content: '' + soy.$$escapeHtml(opt_data.value)});
      break;
    case 'text':
    case 'password':
    case 'email':
    case 'url':
    case 'tel':
    case 'search':
    case 'file':
    case 'radio':
    case 'checkbox':
    case 'button':
    case 'submit':
    case 'reset':
      output += aui.form.input({id: opt_data.id, name: opt_data.name, type: opt_data.type, value: opt_data.value, maxLength: opt_data.maxLength, size: opt_data.size, autocomplete: opt_data.autocomplete, placeholderText: opt_data.placeholderText, isChecked: opt_data.isChecked, isDisabled: opt_data.isDisabled ? true : false, isAutofocus: opt_data.isAutofocus, extraClasses: fieldWidthClass__soy417, icon: opt_data.icon, validationArguments: opt_data.validationArguments, infoMessage: opt_data.infoMessage, tooltipArguments: opt_data.tooltipArguments});
      break;
  }
  output += ((opt_data.labelContent && isCheckboxOrRadio__soy416) ? aui.form.label({forField: opt_data.id, isRequired: opt_data.isRequired, content: opt_data.labelContent}) : '') + ((opt_data.descriptionText || opt_data.descriptionContent) ? aui.form.fieldDescription({text: opt_data.descriptionText, content: opt_data.descriptionContent}) : '');
  if (opt_data.errorTexts) {
    var errorList502 = opt_data.errorTexts;
    var errorListLen502 = errorList502.length;
    for (var errorIndex502 = 0; errorIndex502 < errorListLen502; errorIndex502++) {
      var errorData502 = errorList502[errorIndex502];
      output += aui.form.fieldError({message: errorData502});
    }
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  aui.form.field.soyTemplateName = 'aui.form.field';
}


aui.form.fieldError = function(opt_data, opt_ignored) {
  return '<div class="error' + aui.renderExtraClasses(opt_data) + '">' + soy.$$escapeHtml(opt_data.message) + '</div>';
};
if (goog.DEBUG) {
  aui.form.fieldError.soyTemplateName = 'aui.form.fieldError';
}


aui.form.fieldDescription = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div class="description' + aui.renderExtraClasses(opt_data) + '">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : (opt_data.message) ? soy.$$escapeHtml(opt_data.message) : soy.$$filterNoAutoescape(opt_data.content)) + '</div>';
};
if (goog.DEBUG) {
  aui.form.fieldDescription.soyTemplateName = 'aui.form.fieldDescription';
}


aui.form.textField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'text'}));
};
if (goog.DEBUG) {
  aui.form.textField.soyTemplateName = 'aui.form.textField';
}


aui.form.textareaField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'textarea'}));
};
if (goog.DEBUG) {
  aui.form.textareaField.soyTemplateName = 'aui.form.textareaField';
}


aui.form.passwordField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'password'}));
};
if (goog.DEBUG) {
  aui.form.passwordField.soyTemplateName = 'aui.form.passwordField';
}


aui.form.fileField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'file'}));
};
if (goog.DEBUG) {
  aui.form.fileField.soyTemplateName = 'aui.form.fileField';
}


aui.form.selectField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'select'}));
};
if (goog.DEBUG) {
  aui.form.selectField.soyTemplateName = 'aui.form.selectField';
}


aui.form.checkboxField = function(opt_data, opt_ignored) {
  var param547 = '' + ((opt_data.isMatrix) ? '<div class="matrix">' : '');
  var fieldList551 = opt_data.fields;
  var fieldListLen551 = fieldList551.length;
  for (var fieldIndex551 = 0; fieldIndex551 < fieldListLen551; fieldIndex551++) {
    var fieldData551 = fieldList551[fieldIndex551];
    param547 += aui.form.field(soy.$$augmentMap(fieldData551, {type: 'checkbox', labelContent: '' + soy.$$escapeHtml(fieldData551.labelText)}));
  }
  param547 += ((opt_data.isMatrix) ? '</div>' : '') + ((opt_data.descriptionText || opt_data.descriptionContent || opt_data.errorTexts && opt_data.errorTexts.length) ? aui.form.field({descriptionText: opt_data.descriptionText, descriptionContent: opt_data.descriptionContent, errorTexts: opt_data.errorTexts, isDisabled: false}) : '');
  var output = '' + aui.form.fieldset({legendContent: opt_data.legendContent + (opt_data.isRequired ? '<span class="aui-icon icon-required"></span>' : ''), isGroup: true, id: opt_data.id, extraClasses: opt_data.extraClasses, extraAttributes: opt_data.extraAttributes, content: param547});
  return output;
};
if (goog.DEBUG) {
  aui.form.checkboxField.soyTemplateName = 'aui.form.checkboxField';
}


aui.form.radioField = function(opt_data, opt_ignored) {
  var param574 = '' + ((opt_data.isMatrix) ? '<div class="matrix">' : '');
  var fieldList578 = opt_data.fields;
  var fieldListLen578 = fieldList578.length;
  for (var fieldIndex578 = 0; fieldIndex578 < fieldListLen578; fieldIndex578++) {
    var fieldData578 = fieldList578[fieldIndex578];
    param574 += aui.form.field(soy.$$augmentMap(fieldData578, {type: 'radio', name: opt_data.name ? opt_data.name : opt_data.id, labelContent: '' + soy.$$escapeHtml(fieldData578.labelText)}));
  }
  param574 += ((opt_data.isMatrix) ? '</div>' : '') + ((opt_data.descriptionText || opt_data.descriptionContent || opt_data.errorTexts && opt_data.errorTexts.length) ? aui.form.field({descriptionText: opt_data.descriptionText, descriptionContent: opt_data.descriptionContent, errorTexts: opt_data.errorTexts, isDisabled: false}) : '');
  var output = '' + aui.form.fieldset({legendContent: opt_data.legendContent + (opt_data.isRequired ? '<span class="aui-icon icon-required"></span>' : ''), isGroup: true, id: opt_data.id, extraClasses: opt_data.extraClasses, extraAttributes: opt_data.extraAttributes, content: param574});
  return output;
};
if (goog.DEBUG) {
  aui.form.radioField.soyTemplateName = 'aui.form.radioField';
}


aui.form.valueField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'value'}));
};
if (goog.DEBUG) {
  aui.form.valueField.soyTemplateName = 'aui.form.valueField';
}


aui.form.emailField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'email'}));
};
if (goog.DEBUG) {
  aui.form.emailField.soyTemplateName = 'aui.form.emailField';
}


aui.form.urlField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'url'}));
};
if (goog.DEBUG) {
  aui.form.urlField.soyTemplateName = 'aui.form.urlField';
}


aui.form.telephoneField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'tel'}));
};
if (goog.DEBUG) {
  aui.form.telephoneField.soyTemplateName = 'aui.form.telephoneField';
}


aui.form.searchField = function(opt_data, opt_ignored) {
  return '' + aui.form.field(soy.$$augmentMap(opt_data, {type: 'search'}));
};
if (goog.DEBUG) {
  aui.form.searchField.soyTemplateName = 'aui.form.searchField';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/group.soy' */
// This file was automatically generated from group.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.group.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.group == 'undefined') { aui.group = {}; }


aui.group.group = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-group' + ((opt_data.isSplit) ? ' aui-group-split' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
};
if (goog.DEBUG) {
  aui.group.group.soyTemplateName = 'aui.group.group';
}


aui.group.item = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-item' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
};
if (goog.DEBUG) {
  aui.group.item.soyTemplateName = 'aui.group.item';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/labels.soy' */
// This file was automatically generated from labels.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.labels.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.labels == 'undefined') { aui.labels = {}; }


aui.labels.label = function(opt_data, opt_ignored) {
  return '' + ((opt_data.url && opt_data.isCloseable == true) ? '<span' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-label aui-label-closeable aui-label-split' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><a class="aui-label-split-main" href="' + soy.$$escapeHtml(opt_data.url) + '">' + soy.$$escapeHtml(opt_data.text) + '</a><span class="aui-label-split-close" >' + aui.labels.closeIcon(opt_data) + '</span></span>' : '<' + soy.$$escapeHtml(opt_data.url ? 'a' : 'span') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-label' + ((opt_data.isCloseable) ? ' aui-label-closeable' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + ((opt_data.url) ? ' href="' + soy.$$escapeHtml(opt_data.url) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.text) + ((opt_data.isCloseable) ? aui.labels.closeIcon(opt_data) : '') + '</' + soy.$$escapeHtml(opt_data.url ? 'a' : 'span') + '>');
};
if (goog.DEBUG) {
  aui.labels.label.soyTemplateName = 'aui.labels.label';
}


aui.labels.closeIcon = function(opt_data, opt_ignored) {
  return '<span tabindex="0" class="aui-icon aui-icon-close"' + ((opt_data.hasTitle != false) ? ' title="' + aui.labels.closeIconText(opt_data) + '"' : '') + '>' + aui.labels.closeIconText(opt_data) + '</span>';
};
if (goog.DEBUG) {
  aui.labels.closeIcon.soyTemplateName = 'aui.labels.closeIcon';
}


aui.labels.closeIconText = function(opt_data, opt_ignored) {
  return '' + ((opt_data.closeIconText) ? soy.$$escapeHtml(opt_data.closeIconText) : '(' + soy.$$escapeHtml("Remove") + ' ' + soy.$$escapeHtml(opt_data.text) + ')');
};
if (goog.DEBUG) {
  aui.labels.closeIconText.soyTemplateName = 'aui.labels.closeIconText';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/message.soy' */
// This file was automatically generated from message.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.message.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.message == 'undefined') { aui.message = {}; }


aui.message.info = function(opt_data, opt_ignored) {
  return '' + aui.message.message(soy.$$augmentMap(opt_data, {type: 'info'}));
};
if (goog.DEBUG) {
  aui.message.info.soyTemplateName = 'aui.message.info';
}


aui.message.warning = function(opt_data, opt_ignored) {
  return '' + aui.message.message(soy.$$augmentMap(opt_data, {type: 'warning'}));
};
if (goog.DEBUG) {
  aui.message.warning.soyTemplateName = 'aui.message.warning';
}


aui.message.error = function(opt_data, opt_ignored) {
  return '' + aui.message.message(soy.$$augmentMap(opt_data, {type: 'error'}));
};
if (goog.DEBUG) {
  aui.message.error.soyTemplateName = 'aui.message.error';
}


aui.message.success = function(opt_data, opt_ignored) {
  return '' + aui.message.message(soy.$$augmentMap(opt_data, {type: 'success'}));
};
if (goog.DEBUG) {
  aui.message.success.soyTemplateName = 'aui.message.success';
}


aui.message.hint = function(opt_data, opt_ignored) {
  return '' + aui.message.message(soy.$$augmentMap(opt_data, {type: 'hint'}));
};
if (goog.DEBUG) {
  aui.message.hint.soyTemplateName = 'aui.message.hint';
}


aui.message.generic = function(opt_data, opt_ignored) {
  return '' + aui.message.message(soy.$$augmentMap(opt_data, {type: 'generic'}));
};
if (goog.DEBUG) {
  aui.message.generic.soyTemplateName = 'aui.message.generic';
}


aui.message.message = function(opt_data, opt_ignored) {
  var output = '';
  var theTagName__soy21 = opt_data.tagName ? opt_data.tagName : 'div';
  var theType__soy22 = opt_data.type ? opt_data.type : 'generic';
  output += '<' + soy.$$escapeHtml(theTagName__soy21) + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-message aui-message-' + soy.$$escapeHtml(theType__soy22) + ' ' + soy.$$escapeHtml(theType__soy22) + ((opt_data.isCloseable) ? ' closeable' : '') + ((opt_data.isShadowed) ? ' shadowed' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.titleContent) ? '<p class="title"><strong>' + soy.$$filterNoAutoescape(opt_data.titleContent) + '</strong></p>' : '') + soy.$$filterNoAutoescape(opt_data.content) + ((opt_data.isCloseable) ? '<span class="aui-icon icon-close" role="button" tabindex="0"></span>' : '') + '</' + soy.$$escapeHtml(theTagName__soy21) + '>';
  return output;
};
if (goog.DEBUG) {
  aui.message.message.soyTemplateName = 'aui.message.message';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/page.soy' */
// This file was automatically generated from page.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.page.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.page == 'undefined') { aui.page = {}; }


aui.page.document = function(opt_data, opt_ignored, opt_ijData) {
  return '<!DOCTYPE html><html lang="' + soy.$$escapeHtml(opt_ijData.language ? opt_ijData.language : 'en') + '">' + aui.page.documentHTMLContent(opt_data, null, opt_ijData) + '</html>';
};
if (goog.DEBUG) {
  aui.page.document.soyTemplateName = 'aui.page.document';
}


aui.page.documentHTMLContent = function(opt_data, opt_ignored, opt_ijData) {
  var output = '';
  var thePageSize__soy9 = opt_data.pageSize ? opt_data.pageSize : opt_data.focusedPageSize ? opt_data.focusedPageSize : 'xlarge';
  output += '<head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>' + soy.$$escapeHtml(opt_data.windowTitle) + '</title>' + ((opt_data.headContent) ? soy.$$filterNoAutoescape(opt_data.headContent) : '') + '</head><body' + ((opt_data.pageType) ? (opt_data.pageType == 'generic') ? (opt_data.extraClasses) ? ' class="' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' : '' : (opt_data.pageType == 'focused') ? ' class="aui-page-focused aui-page-focused-' + soy.$$escapeHtml(thePageSize__soy9) + ' aui-page-size-' + soy.$$escapeHtml(thePageSize__soy9) + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' : (opt_data.pageType == 'notification') ? ' class="aui-page-notification aui-page-size-' + soy.$$escapeHtml(thePageSize__soy9) + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' : (opt_data.pageType == 'sidebar') ? ' class="aui-page-sidebar' + soy.$$escapeHtml(opt_data.sidebarState ? ' aui-sidebar-' + opt_data.sidebarState : '') + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' : ' class="aui-page-' + soy.$$escapeHtml(opt_data.pageType) + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' : ' class="' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</body>';
  return output;
};
if (goog.DEBUG) {
  aui.page.documentHTMLContent.soyTemplateName = 'aui.page.documentHTMLContent';
}


aui.page.page = function(opt_data, opt_ignored, opt_ijData) {
  return '<div id="page"><header id="header" role="banner">' + soy.$$filterNoAutoescape(opt_data.headerContent) + '</header><!-- #header --><section id="content" role="main">' + soy.$$filterNoAutoescape(opt_data.contentContent) + '</section><!-- #content --><footer id="footer" role="contentinfo">' + soy.$$filterNoAutoescape(opt_data.footerContent) + '</footer><!-- #footer --></div><!-- #page -->';
};
if (goog.DEBUG) {
  aui.page.page.soyTemplateName = 'aui.page.page';
}


aui.page.header = function(opt_data, opt_ignored, opt_ijData) {
  return ((opt_data.bannerContent) ? '<div class="aui-banner aui-banner-error" role="banner">' + soy.$$filterNoAutoescape(opt_data.bannerContent) + '</div>' : '') + '<nav' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-header aui-dropdown2-trigger-group' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + aui.renderExtraAttributes(opt_data, null, opt_ijData) + ' role="navigation"><div class="aui-header-inner">' + ((opt_data.headerBeforeContent) ? '<div class="aui-header-before">' + soy.$$filterNoAutoescape(opt_data.headerBeforeContent) + '</div>' : '') + '<div class="aui-header-primary"><h1 id="logo" class="aui-header-logo' + ((opt_data.headerLogoImageUrl) ? ' aui-header-logo-custom' : (opt_data.logo) ? ' aui-header-logo-' + soy.$$escapeHtml(opt_data.logo) : '') + '"><a href="' + soy.$$escapeHtml(opt_data.headerLink ? opt_data.headerLink : '/') + '">' + ((opt_data.headerLogoImageUrl) ? '<img src="' + soy.$$escapeHtml(opt_data.headerLogoImageUrl) + '" alt="' + soy.$$escapeHtml(opt_data.headerLogoText) + '" />' : '<span class="aui-header-logo-device">' + soy.$$escapeHtml(opt_data.headerLogoText ? opt_data.headerLogoText : '') + '</span>') + ((opt_data.headerText) ? '<span class="aui-header-logo-text">' + soy.$$escapeHtml(opt_data.headerText) + '</span>' : '') + '</a></h1>' + ((opt_data.primaryNavContent) ? soy.$$filterNoAutoescape(opt_data.primaryNavContent) : '') + '</div>' + ((opt_data.secondaryNavContent) ? '<div class="aui-header-secondary">' + soy.$$filterNoAutoescape(opt_data.secondaryNavContent) + '</div>' : '') + ((opt_data.headerAfterContent) ? '<div class="aui-header-after">' + soy.$$filterNoAutoescape(opt_data.headerAfterContent) + '</div>' : '') + '</div><!-- .aui-header-inner--></nav><!-- .aui-header -->';
};
if (goog.DEBUG) {
  aui.page.header.soyTemplateName = 'aui.page.header';
}


aui.page.pagePanel = function(opt_data, opt_ignored, opt_ijData) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ' class="aui-page-panel' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '><div class="aui-page-panel-inner">' + soy.$$filterNoAutoescape(opt_data.content) + '</div><!-- .aui-page-panel-inner --></' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '><!-- .aui-page-panel -->';
};
if (goog.DEBUG) {
  aui.page.pagePanel.soyTemplateName = 'aui.page.pagePanel';
}


aui.page.pagePanelNav = function(opt_data, opt_ignored, opt_ijData) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ' class="aui-page-panel-nav' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '><!-- .aui-page-panel-nav -->';
};
if (goog.DEBUG) {
  aui.page.pagePanelNav.soyTemplateName = 'aui.page.pagePanelNav';
}


aui.page.pagePanelContent = function(opt_data, opt_ignored, opt_ijData) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'section') + ' class="aui-page-panel-content' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'section') + '><!-- .aui-page-panel-content -->';
};
if (goog.DEBUG) {
  aui.page.pagePanelContent.soyTemplateName = 'aui.page.pagePanelContent';
}


aui.page.pagePanelSidebar = function(opt_data, opt_ignored, opt_ijData) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'aside') + ' class="aui-page-panel-sidebar' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'aside') + '><!-- .aui-page-panel-sidebar -->';
};
if (goog.DEBUG) {
  aui.page.pagePanelSidebar.soyTemplateName = 'aui.page.pagePanelSidebar';
}


aui.page.pagePanelItem = function(opt_data, opt_ignored, opt_ijData) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'section') + ' class="aui-page-panel-item' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'section') + '><!-- .aui-page-panel-item -->';
};
if (goog.DEBUG) {
  aui.page.pagePanelItem.soyTemplateName = 'aui.page.pagePanelItem';
}


aui.page.pageHeader = function(opt_data, opt_ignored, opt_ijData) {
  return '<header class="aui-page-header' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '><div class="aui-page-header-inner">' + soy.$$filterNoAutoescape(opt_data.content) + '</div><!-- .aui-page-header-inner --></header><!-- .aui-page-header -->';
};
if (goog.DEBUG) {
  aui.page.pageHeader.soyTemplateName = 'aui.page.pageHeader';
}


aui.page.pageHeaderImage = function(opt_data, opt_ignored, opt_ijData) {
  return '<div class="aui-page-header-image' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</div><!-- .aui-page-header-image -->';
};
if (goog.DEBUG) {
  aui.page.pageHeaderImage.soyTemplateName = 'aui.page.pageHeaderImage';
}


aui.page.pageHeaderMain = function(opt_data, opt_ignored, opt_ijData) {
  return '<div class="aui-page-header-main' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</div><!-- .aui-page-header-main -->';
};
if (goog.DEBUG) {
  aui.page.pageHeaderMain.soyTemplateName = 'aui.page.pageHeaderMain';
}


aui.page.pageHeaderActions = function(opt_data, opt_ignored, opt_ijData) {
  return '<div class="aui-page-header-actions' + aui.renderExtraClasses(opt_data, null, opt_ijData) + '"' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + aui.renderExtraAttributes(opt_data, null, opt_ijData) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</div><!-- .aui-page-header-actions -->';
};
if (goog.DEBUG) {
  aui.page.pageHeaderActions.soyTemplateName = 'aui.page.pageHeaderActions';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/panel.soy' */
// This file was automatically generated from panel.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.
 */

if (typeof aui == 'undefined') { var aui = {}; }


aui.panel = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-panel' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
};
if (goog.DEBUG) {
  aui.panel.soyTemplateName = 'aui.panel';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/table.soy' */
// This file was automatically generated from table.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.
 */

if (typeof aui == 'undefined') { var aui = {}; }


aui.table = function(opt_data, opt_ignored) {
  return '<table' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.columnsContent) ? soy.$$filterNoAutoescape(opt_data.columnsContent) : '') + ((opt_data.captionContent) ? '<caption>' + soy.$$filterNoAutoescape(opt_data.captionContent) + '</caption>' : '') + ((opt_data.theadContent) ? '<thead>' + soy.$$filterNoAutoescape(opt_data.theadContent) + '</thead>' : '') + ((opt_data.tfootContent) ? '<tfoot>' + soy.$$filterNoAutoescape(opt_data.tfootContent) + '</tfoot>' : '') + ((! opt_data.contentIncludesTbody) ? '<tbody>' : '') + soy.$$filterNoAutoescape(opt_data.content) + ((! opt_data.contentIncludesTbody) ? '</tbody>' : '') + '</table>';
};
if (goog.DEBUG) {
  aui.table.soyTemplateName = 'aui.table';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/tabs.soy' */
// This file was automatically generated from tabs.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.
 */

if (typeof aui == 'undefined') { var aui = {}; }


aui.tabs = function(opt_data, opt_ignored) {
  var output = '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-tabs ' + soy.$$escapeHtml(opt_data.isVertical ? 'vertical-tabs' : 'horizontal-tabs') + ((opt_data.isDisabled) ? ' aui-tabs-disabled' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><ul class="tabs-menu">';
  var itemList19 = opt_data.menuItems;
  var itemListLen19 = itemList19.length;
  for (var itemIndex19 = 0; itemIndex19 < itemListLen19; itemIndex19++) {
    var itemData19 = itemList19[itemIndex19];
    output += aui.tabMenuItem(itemData19);
  }
  output += '</ul>' + soy.$$filterNoAutoescape(opt_data.paneContent) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
  return output;
};
if (goog.DEBUG) {
  aui.tabs.soyTemplateName = 'aui.tabs';
}


aui.tabMenuItem = function(opt_data, opt_ignored) {
  return '<li' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="menu-item' + ((opt_data.isActive) ? ' active-tab' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><a href="' + soy.$$escapeHtml(opt_data.url) + '"><strong>' + soy.$$escapeHtml(opt_data.text) + '</strong></a></li>';
};
if (goog.DEBUG) {
  aui.tabMenuItem.soyTemplateName = 'aui.tabMenuItem';
}


aui.tabPane = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="tabs-pane' + ((opt_data.isActive) ? ' active-pane' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
};
if (goog.DEBUG) {
  aui.tabPane.soyTemplateName = 'aui.tabPane';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/trigger.soy' */
// This file was automatically generated from trigger.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.trigger.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.trigger == 'undefined') { aui.trigger = {}; }


aui.trigger.trigger = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'a') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '" ' : '') + ' class="' + aui.renderExtraClasses(opt_data) + '" aria-controls="' + soy.$$escapeHtml(opt_data.menu.id) + '" aria-haspopup="true" role="button"' + ((opt_data.title) ? ' title="' + soy.$$escapeHtml(opt_data.title) + '"' : '') + ((opt_data.container) ? ' data-container="' + soy.$$escapeHtml(opt_data.container) + '"' : '') + (((! opt_data.tagName || opt_data.tagName == 'a') && (! opt_data.extraAttributes || Object.prototype.toString.call(opt_data.extraAttributes) === '[object Object]' && ! opt_data.extraAttributes.href && ! opt_data.extraAttributes.tabindex || (! opt_data.extraAttributes.href || ! opt_data.extraAttributes.tabindex))) ? ' tabindex="0"' : '') + ' data-aui-trigger' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + ((! (opt_data.showIcon == false)) ? '<span class="icon ' + soy.$$escapeHtml(opt_data.iconClasses ? opt_data.iconClasses : 'aui-icon-dropdown') + '">' + ((opt_data.iconText) ? soy.$$escapeHtml(opt_data.iconText) : '') + '</span>' : '') + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'a') + '>';
};
if (goog.DEBUG) {
  aui.trigger.trigger.soyTemplateName = 'aui.trigger.trigger';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/toolbar.soy' */
// This file was automatically generated from toolbar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.toolbar.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.toolbar == 'undefined') { aui.toolbar = {}; }


aui.toolbar.toolbar = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-toolbar' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
};
if (goog.DEBUG) {
  aui.toolbar.toolbar.soyTemplateName = 'aui.toolbar.toolbar';
}


aui.toolbar.split = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="toolbar-split toolbar-split-' + soy.$$escapeHtml(opt_data.split) + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
};
if (goog.DEBUG) {
  aui.toolbar.split.soyTemplateName = 'aui.toolbar.split';
}


aui.toolbar.group = function(opt_data, opt_ignored) {
  return '<ul' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="toolbar-group' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</ul>';
};
if (goog.DEBUG) {
  aui.toolbar.group.soyTemplateName = 'aui.toolbar.group';
}


aui.toolbar.item = function(opt_data, opt_ignored) {
  return '<li ' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="toolbar-item' + ((opt_data.isPrimary) ? ' primary' : '') + ((opt_data.isActive) ? ' active' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</li>';
};
if (goog.DEBUG) {
  aui.toolbar.item.soyTemplateName = 'aui.toolbar.item';
}


aui.toolbar.trigger = function(opt_data, opt_ignored) {
  return '<a' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="toolbar-trigger' + aui.renderExtraClasses(opt_data) + '" href="' + soy.$$escapeHtml(opt_data.url ? opt_data.url : '#') + '"' + ((opt_data.title) ? ' title="' + soy.$$escapeHtml(opt_data.title) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</a>';
};
if (goog.DEBUG) {
  aui.toolbar.trigger.soyTemplateName = 'aui.toolbar.trigger';
}


aui.toolbar.button = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + aui.toolbar.item({isActive: opt_data.isActive, isPrimary: opt_data.isPrimary, id: opt_data.id, extraClasses: opt_data.extraClasses, extraAttributes: opt_data.extraAttributes, content: '' + aui.toolbar.trigger({url: opt_data.url, title: opt_data.title, content: '' + ((opt_data.iconClass) ? '<span class="icon ' + soy.$$escapeHtml(opt_data.iconClass) + '"></span>' : '') + ((opt_data.text) ? '<span class="trigger-text">' + soy.$$escapeHtml(opt_data.text) + '</span>' : '')})});
};
if (goog.DEBUG) {
  aui.toolbar.button.soyTemplateName = 'aui.toolbar.button';
}


aui.toolbar.link = function(opt_data, opt_ignored) {
  return '' + aui.toolbar.item({id: opt_data.id, extraClasses: 'toolbar-item-link' + aui.renderExtraClasses(opt_data), extraAttributes: opt_data.extraAttributes, content: '' + aui.toolbar.trigger({url: opt_data.url, content: '' + soy.$$escapeHtml(opt_data.text)})});
};
if (goog.DEBUG) {
  aui.toolbar.link.soyTemplateName = 'aui.toolbar.link';
}


aui.toolbar.dropdownInternal = function(opt_data, opt_ignored) {
  return '' + aui.toolbar.item({isPrimary: opt_data.isPrimary, id: opt_data.id, extraClasses: '' + soy.$$filterNoAutoescape(opt_data.itemClass) + aui.renderExtraClasses(opt_data), extraAttributes: opt_data.extraAttributes, content: '' + ((opt_data.splitButtonContent) ? soy.$$filterNoAutoescape(opt_data.splitButtonContent) : '') + aui.dropdown.parent({content: '' + aui.dropdown.trigger({extraClasses: 'toolbar-trigger', accessibilityText: opt_data.text}) + aui.dropdown.menu({content: opt_data.dropdownItemsContent})})});
};
if (goog.DEBUG) {
  aui.toolbar.dropdownInternal.soyTemplateName = 'aui.toolbar.dropdownInternal';
}


aui.toolbar.dropdown = function(opt_data, opt_ignored) {
  return '' + aui.toolbar.dropdownInternal({isPrimary: opt_data.isPrimary, id: opt_data.id, itemClass: 'toolbar-dropdown', extraClasses: opt_data.extraClasses, extraAttributes: opt_data.extraAttributes, text: opt_data.text, dropdownItemsContent: opt_data.dropdownItemsContent});
};
if (goog.DEBUG) {
  aui.toolbar.dropdown.soyTemplateName = 'aui.toolbar.dropdown';
}


aui.toolbar.splitButton = function(opt_data, opt_ignored) {
  return '' + aui.toolbar.dropdownInternal({isPrimary: opt_data.isPrimary, id: opt_data.id, itemClass: 'toolbar-splitbutton', extraClasses: opt_data.extraClasses, extraAttributes: opt_data.extraAttributes, dropdownItemsContent: opt_data.dropdownItemsContent, splitButtonContent: '' + aui.toolbar.trigger({url: opt_data.url, content: '' + soy.$$escapeHtml(opt_data.text)})});
};
if (goog.DEBUG) {
  aui.toolbar.splitButton.soyTemplateName = 'aui.toolbar.splitButton';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/toolbar2.soy' */
// This file was automatically generated from toolbar2.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.toolbar2.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.toolbar2 == 'undefined') { aui.toolbar2 = {}; }


aui.toolbar2.toolbar2 = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-toolbar2' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + ' role="toolbar"><div class="aui-toolbar2-inner">' + soy.$$filterNoAutoescape(opt_data.content) + '</div></div>';
};
if (goog.DEBUG) {
  aui.toolbar2.toolbar2.soyTemplateName = 'aui.toolbar2.toolbar2';
}


aui.toolbar2.item = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-toolbar2-' + soy.$$escapeHtml(opt_data.item) + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  aui.toolbar2.item.soyTemplateName = 'aui.toolbar2.item';
}


aui.toolbar2.group = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-toolbar2-group' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  aui.toolbar2.group.soyTemplateName = 'aui.toolbar2.group';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/progress-tracker.soy' */
// This file was automatically generated from progress-tracker.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.progressTracker.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.progressTracker == 'undefined') { aui.progressTracker = {}; }


aui.progressTracker.progressTracker = function(opt_data, opt_ignored) {
  var output = '<ol' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-progress-tracker' + ((opt_data.isInverted) ? ' aui-progress-tracker-inverted' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>';
  var param18 = '';
  var currentStepList19 = opt_data.steps;
  var currentStepListLen19 = currentStepList19.length;
  for (var currentStepIndex19 = 0; currentStepIndex19 < currentStepListLen19; currentStepIndex19++) {
    var currentStepData19 = currentStepList19[currentStepIndex19];
    if (currentStepData19['isCurrent']) {
      var stepList22 = opt_data.steps;
      var stepListLen22 = stepList22.length;
      for (var stepIndex22 = 0; stepIndex22 < stepListLen22; stepIndex22++) {
        var stepData22 = stepList22[stepIndex22];
        param18 += aui.progressTracker.step(soy.$$augmentMap(stepData22, {width: Math.round(100 / opt_data.steps.length * 10000) / 10000, href: stepIndex22 < currentStepIndex19 ? stepData22['href'] : null}));
      }
    }
  }
  output += aui.progressTracker.content({steps: opt_data.steps, content: param18});
  output += '</ol>';
  return output;
};
if (goog.DEBUG) {
  aui.progressTracker.progressTracker.soyTemplateName = 'aui.progressTracker.progressTracker';
}


aui.progressTracker.content = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.content != '') {
    output += soy.$$filterNoAutoescape(opt_data.content);
  } else {
    var stepList36 = opt_data.steps;
    var stepListLen36 = stepList36.length;
    for (var stepIndex36 = 0; stepIndex36 < stepListLen36; stepIndex36++) {
      var stepData36 = stepList36[stepIndex36];
      output += aui.progressTracker.step(soy.$$augmentMap(stepData36, {isCurrent: stepIndex36 == 0, width: Math.round(100 / opt_data.steps.length * 10000) / 10000, href: null}));
    }
  }
  return output;
};
if (goog.DEBUG) {
  aui.progressTracker.content.soyTemplateName = 'aui.progressTracker.content';
}


aui.progressTracker.step = function(opt_data, opt_ignored) {
  return '<li' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-progress-tracker-step' + ((opt_data.isCurrent) ? ' aui-progress-tracker-step-current' : '') + aui.renderExtraClasses(opt_data) + '" style="width: ' + soy.$$escapeHtml(opt_data.width) + '%;"' + aui.renderExtraAttributes(opt_data) + '><' + soy.$$escapeHtml(opt_data.href ? 'a' : 'span') + ((opt_data.href) ? ' href="' + soy.$$escapeHtml(opt_data.href) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.text) + '</' + soy.$$escapeHtml(opt_data.href ? 'a' : 'span') + '></li>';
};
if (goog.DEBUG) {
  aui.progressTracker.step.soyTemplateName = 'aui.progressTracker.step';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/expander.soy' */
// This file was automatically generated from expander.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.expander.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.expander == 'undefined') { aui.expander = {}; }


aui.expander.content = function(opt_data, opt_ignored) {
  return '<div id="' + soy.$$escapeHtml(opt_data.id) + '" class="aui-expander-content' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + ((opt_data.initiallyExpanded) ? ' aria-expanded="' + soy.$$escapeHtml(opt_data.initiallyExpanded) + '"' : '') + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</div>';
};
if (goog.DEBUG) {
  aui.expander.content.soyTemplateName = 'aui.expander.content';
}


aui.expander.trigger = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tag ? opt_data.tag : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.replaceText) ? ' data-replace-text="' + soy.$$escapeHtml(opt_data.replaceText) + '"' : '') + ((opt_data.replaceSelector) ? ' data-replace-selector="' + soy.$$escapeHtml(opt_data.replaceSelector) + '"' : '') + ' class="aui-expander-trigger' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + ' aria-controls="' + soy.$$escapeHtml(opt_data.contentId) + '"' + ((opt_data.collapsible) ? ' data-collapsible="' + soy.$$escapeHtml(opt_data.collapsible) + '"' : '') + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</' + soy.$$escapeHtml(opt_data.tag ? opt_data.tag : 'div') + '>';
};
if (goog.DEBUG) {
  aui.expander.trigger.soyTemplateName = 'aui.expander.trigger';
}


aui.expander.revealText = function(opt_data, opt_ignored) {
  return '' + aui.expander.content({id: opt_data.contentId, content: '' + soy.$$escapeHtml(opt_data.contentContent) + aui.expander.trigger({id: opt_data.triggerId, contentId: opt_data.contentId, tag: 'a', content: '<span class=\'reveal-text-trigger-text\'>Show more</span>', replaceSelector: '.reveal-text-trigger-text', replaceText: 'Show less', extraAttributes: opt_data.triggerExtraAttributes, extraClasses: ((opt_data.triggerExtraClasses) ? soy.$$escapeHtml(opt_data.triggerExtraClasses) + '  ' : '') + ' aui-expander-reveal-text'}), extraAttributes: opt_data.contentExtraAttributes, extraClasses: opt_data.contentExtraClasses});
};
if (goog.DEBUG) {
  aui.expander.revealText.soyTemplateName = 'aui.expander.revealText';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/avatar.soy' */
// This file was automatically generated from avatar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.avatar.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.avatar == 'undefined') { aui.avatar = {}; }


aui.avatar.avatar = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'span') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-avatar aui-avatar-' + soy.$$escapeHtml(opt_data.size) + soy.$$escapeHtml(opt_data.isProject ? ' aui-avatar-project' : '') + soy.$$escapeHtml(opt_data.badgeContent ? ' aui-avatar-badged' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><span class="aui-avatar-inner"><img src="' + soy.$$escapeHtml(opt_data.avatarImageUrl) + '"' + ((opt_data.accessibilityText) ? ' alt="' + soy.$$escapeHtml(opt_data.accessibilityText) + '"' : '') + ((opt_data.title) ? ' title="' + soy.$$escapeHtml(opt_data.title) + '"' : '') + ((opt_data.imageClasses) ? ' class="' + soy.$$escapeHtml(opt_data.imageClasses) + '"' : '') + ' /></span>' + ((opt_data.badgeContent) ? soy.$$filterNoAutoescape(opt_data.badgeContent) : '') + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'span') + '>';
};
if (goog.DEBUG) {
  aui.avatar.avatar.soyTemplateName = 'aui.avatar.avatar';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/icons.soy' */
// This file was automatically generated from icons.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.icons.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.icons == 'undefined') { aui.icons = {}; }


aui.icons.icon = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'span') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-icon' + ((opt_data.useIconFont) ? ' aui-icon-' + soy.$$escapeHtml(opt_data.size ? opt_data.size : 'small') : '') + ' aui' + soy.$$escapeHtml(opt_data.useIconFont ? '-iconfont' : '-icon') + soy.$$escapeHtml(opt_data.iconFontSet ? '-' + opt_data.iconFontSet : '') + '-' + soy.$$escapeHtml(opt_data.icon) + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.accessibilityText) ? soy.$$escapeHtml(opt_data.accessibilityText) : '') + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'span') + '>';
};
if (goog.DEBUG) {
  aui.icons.icon.soyTemplateName = 'aui.icons.icon';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/lozenges.soy' */
// This file was automatically generated from lozenges.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.lozenges.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.lozenges == 'undefined') { aui.lozenges = {}; }


aui.lozenges.lozenge = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'span') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.title) ? ' title="' + soy.$$escapeHtml(opt_data.title) + '"' : '') + ' class="aui-lozenge' + soy.$$escapeHtml(opt_data.type ? ' aui-lozenge-' + opt_data.type : '') + soy.$$escapeHtml(opt_data.isSubtle ? ' aui-lozenge-subtle' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.maxLength) ? soy.$$truncate(soy.$$escapeHtml(opt_data.text), opt_data.maxLength, true) : soy.$$escapeHtml(opt_data.text)) + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'span') + '>';
};
if (goog.DEBUG) {
  aui.lozenges.lozenge.soyTemplateName = 'aui.lozenges.lozenge';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-soy-templates', location = 'soy/sidebar.soy' */
// This file was automatically generated from sidebar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.sidebar.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.sidebar == 'undefined') { aui.sidebar = {}; }


aui.sidebar.sidebar = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.state) ? ' aria-expanded="' + ((opt_data.state == 'collapsed') ? 'false' : 'true') + '"' : '') + ' class="aui-sidebar ' + ((opt_data.isAnimated) ? 'aui-is-animated' : '') + aui.renderExtraClasses(opt_data) + '" ' + ((opt_data.isResponsive == false) ? 'data-aui-responsive="false"' : '') + aui.renderExtraAttributes(opt_data) + '><div class="aui-sidebar-wrapper"><div class="aui-sidebar-body">' + soy.$$filterNoAutoescape(opt_data.headerContent) + soy.$$filterNoAutoescape(opt_data.content) + '</div><div class="aui-sidebar-footer">' + ((opt_data.footerContent) ? soy.$$filterNoAutoescape(opt_data.footerContent) : (opt_data.settingsButtonUrl && opt_data.settingsText) ? '<a href="' + soy.$$escapeHtml(opt_data.settingsButtonUrl) + '" class="aui-button aui-button-subtle aui-sidebar-settings-button' + ((opt_data.isSettingsButtonSelected) ? ' aui-sidebar-settings-selected' : '') + '" data-tooltip="' + soy.$$escapeHtml(opt_data.settingsTooltip ? opt_data.settingsTooltip : opt_data.settingsText) + '"><span class="aui-icon aui-icon-small aui-iconfont-configure"></span><span class="aui-button-label">' + soy.$$escapeHtml(opt_data.settingsText) + '</span></a>' : '') + '<a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="' + soy.$$escapeHtml("Expand sidebar ( [ )") + '" href="#"><span class="aui-icon aui-icon-small"></span></a></div>' + ((opt_data.isResizable) ? '<div class="aui-sidebar-handle"></div>' : '') + '</div></' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'div') + '>';
};
if (goog.DEBUG) {
  aui.sidebar.sidebar.soyTemplateName = 'aui.sidebar.sidebar';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-tipsy', location = 'js-vendor/jquery/jquery.tipsy.js' */
(function(b){function i(a){for(;a=a.parentNode;)if(a==document)return!0;return!1}function j(a,c){this.$element=b(a);this.options=c;this.enabled=!0;this.fixTitle()}var k=0;j.prototype={show:function(){if(i(this.$element[0])){var a=this.getTitle();if(a&&this.enabled){var c=this.tip();c.find(".tipsy-inner")[this.options.html?"html":"text"](a);c[0].className="tipsy";c.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var d=this;this.options.hoverable&&c.hover(function(){d.hoverTooltip=
!0},function(){"in"!=d.hoverState&&(d.hoverTooltip=!1,"manual"!=d.options.trigger&&d.$element.trigger("hover"==d.options.trigger?"mouseleave.tipsy":"blur.tipsy"))});this.options.className&&c.addClass("function"==typeof this.options.className?this.options.className.call(this.$element[0]):this.options.className);var a=b.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),f=c[0].offsetWidth,g=c[0].offsetHeight,h="function"==typeof this.options.gravity?
this.options.gravity.call(this.$element[0]):this.options.gravity,e;switch(h.charAt(0)){case "n":e={top:a.top+a.height+this.options.offset,left:a.left+a.width/2-f/2};break;case "s":e={top:a.top-g-this.options.offset,left:a.left+a.width/2-f/2};break;case "e":e={top:a.top+a.height/2-g/2,left:a.left-f-this.options.offset};break;case "w":e={top:a.top+a.height/2-g/2,left:a.left+a.width+this.options.offset}}2==h.length&&(e.left="w"==h.charAt(1)?a.left+a.width/2-15:a.left+a.width/2-f+15);c.css(e).addClass("tipsy-"+
h);c.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+h.charAt(0);this.options.fade?c.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):c.css({visibility:"visible",opacity:this.options.opacity});this.options.aria&&(e="tipsyuid"+k++,c.attr("id",e),this.$element.attr("aria-describedby",e))}}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){b(this).remove()}):this.tip().remove();this.options.aria&&this.$element.removeAttr("aria-describedby")},
fixTitle:function(){var a=this.$element;if(a.attr("title")||"string"!=typeof a.attr("original-title"))a.attr("original-title",a.attr("title")||"").removeAttr("title")},getTitle:function(){var a,b=this.$element,d=this.options;this.fixTitle();d=this.options;"string"==typeof d.title?a=b.attr("title"==d.title?"original-title":d.title):"function"==typeof d.title&&(a=d.title.call(b[0]));return(a=(""+a).replace(/(^\s*|\s*$)/,""))||d.fallback},tip:function(){this.$tip||(this.$tip=b('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>').attr("role",
"tooltip"),this.$tip.data("tipsy-pointee",this.$element[0]));return this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.options=this.$element=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}};b.fn.tipsy=function(a){function c(e){var c=b.data(e,"tipsy");c||(c=new j(e,b.fn.tipsy.elementOptions(e,a)),b.data(e,"tipsy",c));return c}function d(){var b=c(this);b.hoverState="in";0==a.delayIn?b.show():
(b.fixTitle(),setTimeout(function(){"in"==b.hoverState&&b.show()},a.delayIn))}function f(){var b=c(this);b.hoverState="out";0==a.delayOut?b.hide():setTimeout(function(){"out"==b.hoverState&&!b.hoverTooltip&&b.hide()},a.delayOut)}if(!0===a)return this.data("tipsy");if("string"==typeof a){var g=this.data("tipsy");if(g)g[a]();return this}a=b.extend({},b.fn.tipsy.defaults,a);a.hoverable&&(a.delayOut=a.delayOut||20);a.live||this.each(function(){c(this)});if("manual"!=a.trigger){var g="hover"==a.trigger?
"mouseenter.tipsy":"focus.tipsy",h="hover"==a.trigger?"mouseleave.tipsy":"blur.tipsy";if(a.live)b(this.context).on(g,this.selector,d).on(h,this.selector,f);else this.bind(g,d).bind(h,f)}return this};b.fn.tipsy.defaults={aria:!1,className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,hoverable:!1,offset:0,opacity:0.8,title:"title",trigger:"hover"};b.fn.tipsy.revalidate=function(){b(".tipsy").each(function(){var a=b.data(this,"tipsy-pointee");(!a||!i(a))&&b(this).remove()})};
b.fn.tipsy.elementOptions=function(a,c){return b.metadata?b.extend({},c,b(a).metadata()):c};b.fn.tipsy.autoNS=function(){return b(this).offset().top>b(document).scrollTop()+b(window).height()/2?"s":"n"};b.fn.tipsy.autoWE=function(){return b(this).offset().left>b(document).scrollLeft()+b(window).width()/2?"e":"w"};b.fn.tipsy.autoBounds=function(a,c){return function(){var d=c[0],f=1<c.length?c[1]:!1,g=b(document).scrollTop()+a,h=b(document).scrollLeft()+a,e=b(this);e.offset().top<g&&(d="n");e.offset().left<
h&&(f="w");b(window).width()+b(document).scrollLeft()-e.offset().left<a&&(f="e");b(window).height()+b(document).scrollTop()-e.offset().top<a&&(d="s");return d+(f?f:"")}}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:aui-tooltips', location = 'js/aui-experimental-tooltip.js' */
(function(b){b.fn.tooltip=function(a){if("string"==typeof a)return this.tipsy(a),c;var a=b.extend({},b.fn.tooltip.defaults,a),c=this.tipsy(a);if(a.hideOnClick&&("hover"==a.trigger||!a.trigger&&"hover"==this.tipsy.defaults.trigger)){var d=function(){b(this).tipsy("hide")};if(a.live)b(this.context).on("click.tipsy",this.selector,d);else this.bind("click.tipsy",d)}return c};b.fn.tooltip.defaults={opacity:1,offset:1,delayIn:500,hoverable:!0,hideOnClick:!0}})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:aui-select2', location = 'js-vendor/jquery/plugins/jquery.select2.js' */
(function(e){"undefined"==typeof e.fn.each2&&e.extend(e.fn,{each2:function(n){for(var j=e([0]),k=-1,w=this.length;++k<w&&(j.context=j[0]=this[k])&&!1!==n.call(j[0],k,j););return this}})})(jQuery);
(function(e){function n(a){var b,c,d,g;if(!a||1>a.length)return a;b="";c=0;for(d=a.length;c<d;c++)g=a.charAt(c),b+=M[g]||g;return b}function j(a,b){for(var c=0,d=b.length;c<d;c+=1)if(k(a,b[c]))return c;return-1}function k(a,b){return a===b?!0:void 0===a||void 0===b||null===a||null===b?!1:a.constructor===String?a+""===b+"":b.constructor===String?b+""===a+"":!1}function w(a,b){var c,d,g;if(null===a||1>a.length)return[];c=a.split(b);d=0;for(g=c.length;d<g;d+=1)c[d]=e.trim(c[d]);return c}function E(a){a.on("keydown",
function(){void 0===e.data(a,"keyup-change-value")&&e.data(a,"keyup-change-value",a.val())});a.on("keyup",function(){var b=e.data(a,"keyup-change-value");void 0!==b&&a.val()!==b&&(e.removeData(a,"keyup-change-value"),a.trigger("keyup-change"))})}function F(a,b,c){var c=c||void 0,d;return function(){var g=arguments;window.clearTimeout(d);d=window.setTimeout(function(){b.apply(c,g)},a)}}function l(a){a.preventDefault();a.stopPropagation()}function y(a,b,c){var d,g=[],h;(d=a.attr("class"))&&e((""+d).split(" ")).each2(function(){0===
this.indexOf("select2-")&&g.push(this)});(d=b.attr("class"))&&e((""+d).split(" ")).each2(function(){0!==this.indexOf("select2-")&&(h=c(this))&&g.push(h)});a.attr("class",g.join(" "))}function G(a,b,c,d){var g=n(a.toUpperCase()).indexOf(n(b.toUpperCase())),b=b.length;0>g?c.push(d(a)):(c.push(d(a.substring(0,g))),c.push("<span class='select2-match'>"),c.push(d(a.substring(g,g+b))),c.push("</span>"),c.push(d(a.substring(g+b,a.length))))}function H(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",
'"':"&quot;","'":"&#39;","/":"&#47;"};return String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})}function I(a){var b,c=null,d=a.quietMillis||100,g=a.url,h=this;return function(m){window.clearTimeout(b);b=window.setTimeout(function(){var b=a.data,d=g,t=a.transport||e.fn.select2.ajaxDefaults.transport,f=e.extend({},e.fn.select2.ajaxDefaults.params,{type:a.type||"GET",cache:a.cache||!1,jsonpCallback:a.jsonpCallback||void 0,dataType:a.dataType||"json"}),b=b?b.call(h,m.term,m.page,m.context):null,
d="function"===typeof d?d.call(h,m.term,m.page,m.context):d;c&&c.abort();a.params&&(e.isFunction(a.params)?e.extend(f,a.params.call(h)):e.extend(f,a.params));e.extend(f,{url:d,dataType:a.dataType,data:b,success:function(b){b=a.results(b,m.page);m.callback(b)}});c=t.call(h,f)},d)}}function J(a){var b=a,c,d,g=function(a){return""+a.text};e.isArray(b)&&(d=b,b={results:d});!1===e.isFunction(b)&&(d=b,b=function(){return d});a=b();a.text&&(g=a.text,e.isFunction(g)||(c=a.text,g=function(a){return a[c]}));
return function(a){var c=a.term,d={results:[]},o;if(c==="")a.callback(b());else{o=function(b,d){var i,f,b=b[0];if(b.children){i={};for(f in b)b.hasOwnProperty(f)&&(i[f]=b[f]);i.children=[];e(b.children).each2(function(a,b){o(b,i.children)});(i.children.length||a.matcher(c,g(i),b))&&d.push(i)}else a.matcher(c,g(b),b)&&d.push(b)};e(b().results).each2(function(a,b){o(b,d.results)});a.callback(d)}}}function K(a){var b=e.isFunction(a);return function(c){var d=c.term,g={results:[]};e(b?a():a).each(function(){var a=
void 0!==this.text,b=a?this.text:this;if(""===d||c.matcher(d,b))g.results.push(a?this:{id:this,text:this})});c.callback(g)}}function s(a,b){if(e.isFunction(a))return!0;if(!a)return!1;throw Error(b+" must be a function or a falsy value");}function p(a){return e.isFunction(a)?a():a}function L(a){var b=0;e.each(a,function(a,d){d.children?b+=L(d.children):b++});return b}function N(a,b,c,d){var g=a,h=!1,e,i,f,t;if(d.createSearchChoice&&d.tokenSeparators&&!(1>d.tokenSeparators.length)){for(;;){h=-1;i=0;
for(f=d.tokenSeparators.length;i<f&&!(t=d.tokenSeparators[i],h=a.indexOf(t),0<=h);i++);if(0>h)break;e=a.substring(0,h);a=a.substring(h+t.length);if(0<e.length&&(e=d.createSearchChoice.call(this,e,b),void 0!==e&&null!==e&&void 0!==d.id(e)&&null!==d.id(e))){h=!1;i=0;for(f=b.length;i<f;i++)if(k(d.id(e),d.id(b[i]))){h=!0;break}h||c(e)}}if(g!==a)return a}}function A(a,b){var c=function(){};c.prototype=new a;c.prototype.constructor=c;c.prototype.parent=a.prototype;c.prototype=e.extend(c.prototype,b);return c}
if(void 0===window.Select2){var f,u,B,C,z,v,x={x:0,y:0},D;f={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(a){a=a.which?a.which:a;switch(a){case f.LEFT:case f.RIGHT:case f.UP:case f.DOWN:return!0}return!1},isControl:function(a){switch(a.which){case f.SHIFT:case f.CTRL:case f.ALT:return!0}return a.metaKey?!0:!1},isFunctionKey:function(a){a=a.which?a.which:a;return 112<=a&&123>=a}};
var M={"\u24b6":"A","\uff21":"A","\u00c0":"A","\u00c1":"A","\u00c2":"A","\u1ea6":"A","\u1ea4":"A","\u1eaa":"A","\u1ea8":"A","\u00c3":"A","\u0100":"A","\u0102":"A","\u1eb0":"A","\u1eae":"A","\u1eb4":"A","\u1eb2":"A","\u0226":"A","\u01e0":"A","\u00c4":"A","\u01de":"A","\u1ea2":"A","\u00c5":"A","\u01fa":"A","\u01cd":"A","\u0200":"A","\u0202":"A","\u1ea0":"A","\u1eac":"A","\u1eb6":"A","\u1e00":"A","\u0104":"A","\u023a":"A","\u2c6f":"A","\ua732":"AA","\u00c6":"AE","\u01fc":"AE","\u01e2":"AE","\ua734":"AO",
"\ua736":"AU","\ua738":"AV","\ua73a":"AV","\ua73c":"AY","\u24b7":"B","\uff22":"B","\u1e02":"B","\u1e04":"B","\u1e06":"B","\u0243":"B","\u0182":"B","\u0181":"B","\u24b8":"C","\uff23":"C","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u00c7":"C","\u1e08":"C","\u0187":"C","\u023b":"C","\ua73e":"C","\u24b9":"D","\uff24":"D","\u1e0a":"D","\u010e":"D","\u1e0c":"D","\u1e10":"D","\u1e12":"D","\u1e0e":"D","\u0110":"D","\u018b":"D","\u018a":"D","\u0189":"D","\ua779":"D","\u01f1":"DZ","\u01c4":"DZ","\u01f2":"Dz",
"\u01c5":"Dz","\u24ba":"E","\uff25":"E","\u00c8":"E","\u00c9":"E","\u00ca":"E","\u1ec0":"E","\u1ebe":"E","\u1ec4":"E","\u1ec2":"E","\u1ebc":"E","\u0112":"E","\u1e14":"E","\u1e16":"E","\u0114":"E","\u0116":"E","\u00cb":"E","\u1eba":"E","\u011a":"E","\u0204":"E","\u0206":"E","\u1eb8":"E","\u1ec6":"E","\u0228":"E","\u1e1c":"E","\u0118":"E","\u1e18":"E","\u1e1a":"E","\u0190":"E","\u018e":"E","\u24bb":"F","\uff26":"F","\u1e1e":"F","\u0191":"F","\ua77b":"F","\u24bc":"G","\uff27":"G","\u01f4":"G","\u011c":"G",
"\u1e20":"G","\u011e":"G","\u0120":"G","\u01e6":"G","\u0122":"G","\u01e4":"G","\u0193":"G","\ua7a0":"G","\ua77d":"G","\ua77e":"G","\u24bd":"H","\uff28":"H","\u0124":"H","\u1e22":"H","\u1e26":"H","\u021e":"H","\u1e24":"H","\u1e28":"H","\u1e2a":"H","\u0126":"H","\u2c67":"H","\u2c75":"H","\ua78d":"H","\u24be":"I","\uff29":"I","\u00cc":"I","\u00cd":"I","\u00ce":"I","\u0128":"I","\u012a":"I","\u012c":"I","\u0130":"I","\u00cf":"I","\u1e2e":"I","\u1ec8":"I","\u01cf":"I","\u0208":"I","\u020a":"I","\u1eca":"I",
"\u012e":"I","\u1e2c":"I","\u0197":"I","\u24bf":"J","\uff2a":"J","\u0134":"J","\u0248":"J","\u24c0":"K","\uff2b":"K","\u1e30":"K","\u01e8":"K","\u1e32":"K","\u0136":"K","\u1e34":"K","\u0198":"K","\u2c69":"K","\ua740":"K","\ua742":"K","\ua744":"K","\ua7a2":"K","\u24c1":"L","\uff2c":"L","\u013f":"L","\u0139":"L","\u013d":"L","\u1e36":"L","\u1e38":"L","\u013b":"L","\u1e3c":"L","\u1e3a":"L","\u0141":"L","\u023d":"L","\u2c62":"L","\u2c60":"L","\ua748":"L","\ua746":"L","\ua780":"L","\u01c7":"LJ","\u01c8":"Lj",
"\u24c2":"M","\uff2d":"M","\u1e3e":"M","\u1e40":"M","\u1e42":"M","\u2c6e":"M","\u019c":"M","\u24c3":"N","\uff2e":"N","\u01f8":"N","\u0143":"N","\u00d1":"N","\u1e44":"N","\u0147":"N","\u1e46":"N","\u0145":"N","\u1e4a":"N","\u1e48":"N","\u0220":"N","\u019d":"N","\ua790":"N","\ua7a4":"N","\u01ca":"NJ","\u01cb":"Nj","\u24c4":"O","\uff2f":"O","\u00d2":"O","\u00d3":"O","\u00d4":"O","\u1ed2":"O","\u1ed0":"O","\u1ed6":"O","\u1ed4":"O","\u00d5":"O","\u1e4c":"O","\u022c":"O","\u1e4e":"O","\u014c":"O","\u1e50":"O",
"\u1e52":"O","\u014e":"O","\u022e":"O","\u0230":"O","\u00d6":"O","\u022a":"O","\u1ece":"O","\u0150":"O","\u01d1":"O","\u020c":"O","\u020e":"O","\u01a0":"O","\u1edc":"O","\u1eda":"O","\u1ee0":"O","\u1ede":"O","\u1ee2":"O","\u1ecc":"O","\u1ed8":"O","\u01ea":"O","\u01ec":"O","\u00d8":"O","\u01fe":"O","\u0186":"O","\u019f":"O","\ua74a":"O","\ua74c":"O","\u01a2":"OI","\ua74e":"OO","\u0222":"OU","\u24c5":"P","\uff30":"P","\u1e54":"P","\u1e56":"P","\u01a4":"P","\u2c63":"P","\ua750":"P","\ua752":"P","\ua754":"P",
"\u24c6":"Q","\uff31":"Q","\ua756":"Q","\ua758":"Q","\u024a":"Q","\u24c7":"R","\uff32":"R","\u0154":"R","\u1e58":"R","\u0158":"R","\u0210":"R","\u0212":"R","\u1e5a":"R","\u1e5c":"R","\u0156":"R","\u1e5e":"R","\u024c":"R","\u2c64":"R","\ua75a":"R","\ua7a6":"R","\ua782":"R","\u24c8":"S","\uff33":"S","\u1e9e":"S","\u015a":"S","\u1e64":"S","\u015c":"S","\u1e60":"S","\u0160":"S","\u1e66":"S","\u1e62":"S","\u1e68":"S","\u0218":"S","\u015e":"S","\u2c7e":"S","\ua7a8":"S","\ua784":"S","\u24c9":"T","\uff34":"T",
"\u1e6a":"T","\u0164":"T","\u1e6c":"T","\u021a":"T","\u0162":"T","\u1e70":"T","\u1e6e":"T","\u0166":"T","\u01ac":"T","\u01ae":"T","\u023e":"T","\ua786":"T","\ua728":"TZ","\u24ca":"U","\uff35":"U","\u00d9":"U","\u00da":"U","\u00db":"U","\u0168":"U","\u1e78":"U","\u016a":"U","\u1e7a":"U","\u016c":"U","\u00dc":"U","\u01db":"U","\u01d7":"U","\u01d5":"U","\u01d9":"U","\u1ee6":"U","\u016e":"U","\u0170":"U","\u01d3":"U","\u0214":"U","\u0216":"U","\u01af":"U","\u1eea":"U","\u1ee8":"U","\u1eee":"U","\u1eec":"U",
"\u1ef0":"U","\u1ee4":"U","\u1e72":"U","\u0172":"U","\u1e76":"U","\u1e74":"U","\u0244":"U","\u24cb":"V","\uff36":"V","\u1e7c":"V","\u1e7e":"V","\u01b2":"V","\ua75e":"V","\u0245":"V","\ua760":"VY","\u24cc":"W","\uff37":"W","\u1e80":"W","\u1e82":"W","\u0174":"W","\u1e86":"W","\u1e84":"W","\u1e88":"W","\u2c72":"W","\u24cd":"X","\uff38":"X","\u1e8a":"X","\u1e8c":"X","\u24ce":"Y","\uff39":"Y","\u1ef2":"Y","\u00dd":"Y","\u0176":"Y","\u1ef8":"Y","\u0232":"Y","\u1e8e":"Y","\u0178":"Y","\u1ef6":"Y","\u1ef4":"Y",
"\u01b3":"Y","\u024e":"Y","\u1efe":"Y","\u24cf":"Z","\uff3a":"Z","\u0179":"Z","\u1e90":"Z","\u017b":"Z","\u017d":"Z","\u1e92":"Z","\u1e94":"Z","\u01b5":"Z","\u0224":"Z","\u2c7f":"Z","\u2c6b":"Z","\ua762":"Z","\u24d0":"a","\uff41":"a","\u1e9a":"a","\u00e0":"a","\u00e1":"a","\u00e2":"a","\u1ea7":"a","\u1ea5":"a","\u1eab":"a","\u1ea9":"a","\u00e3":"a","\u0101":"a","\u0103":"a","\u1eb1":"a","\u1eaf":"a","\u1eb5":"a","\u1eb3":"a","\u0227":"a","\u01e1":"a","\u00e4":"a","\u01df":"a","\u1ea3":"a","\u00e5":"a",
"\u01fb":"a","\u01ce":"a","\u0201":"a","\u0203":"a","\u1ea1":"a","\u1ead":"a","\u1eb7":"a","\u1e01":"a","\u0105":"a","\u2c65":"a","\u0250":"a","\ua733":"aa","\u00e6":"ae","\u01fd":"ae","\u01e3":"ae","\ua735":"ao","\ua737":"au","\ua739":"av","\ua73b":"av","\ua73d":"ay","\u24d1":"b","\uff42":"b","\u1e03":"b","\u1e05":"b","\u1e07":"b","\u0180":"b","\u0183":"b","\u0253":"b","\u24d2":"c","\uff43":"c","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u00e7":"c","\u1e09":"c","\u0188":"c","\u023c":"c",
"\ua73f":"c","\u2184":"c","\u24d3":"d","\uff44":"d","\u1e0b":"d","\u010f":"d","\u1e0d":"d","\u1e11":"d","\u1e13":"d","\u1e0f":"d","\u0111":"d","\u018c":"d","\u0256":"d","\u0257":"d","\ua77a":"d","\u01f3":"dz","\u01c6":"dz","\u24d4":"e","\uff45":"e","\u00e8":"e","\u00e9":"e","\u00ea":"e","\u1ec1":"e","\u1ebf":"e","\u1ec5":"e","\u1ec3":"e","\u1ebd":"e","\u0113":"e","\u1e15":"e","\u1e17":"e","\u0115":"e","\u0117":"e","\u00eb":"e","\u1ebb":"e","\u011b":"e","\u0205":"e","\u0207":"e","\u1eb9":"e","\u1ec7":"e",
"\u0229":"e","\u1e1d":"e","\u0119":"e","\u1e19":"e","\u1e1b":"e","\u0247":"e","\u025b":"e","\u01dd":"e","\u24d5":"f","\uff46":"f","\u1e1f":"f","\u0192":"f","\ua77c":"f","\u24d6":"g","\uff47":"g","\u01f5":"g","\u011d":"g","\u1e21":"g","\u011f":"g","\u0121":"g","\u01e7":"g","\u0123":"g","\u01e5":"g","\u0260":"g","\ua7a1":"g","\u1d79":"g","\ua77f":"g","\u24d7":"h","\uff48":"h","\u0125":"h","\u1e23":"h","\u1e27":"h","\u021f":"h","\u1e25":"h","\u1e29":"h","\u1e2b":"h","\u1e96":"h","\u0127":"h","\u2c68":"h",
"\u2c76":"h","\u0265":"h","\u0195":"hv","\u24d8":"i","\uff49":"i","\u00ec":"i","\u00ed":"i","\u00ee":"i","\u0129":"i","\u012b":"i","\u012d":"i","\u00ef":"i","\u1e2f":"i","\u1ec9":"i","\u01d0":"i","\u0209":"i","\u020b":"i","\u1ecb":"i","\u012f":"i","\u1e2d":"i","\u0268":"i","\u0131":"i","\u24d9":"j","\uff4a":"j","\u0135":"j","\u01f0":"j","\u0249":"j","\u24da":"k","\uff4b":"k","\u1e31":"k","\u01e9":"k","\u1e33":"k","\u0137":"k","\u1e35":"k","\u0199":"k","\u2c6a":"k","\ua741":"k","\ua743":"k","\ua745":"k",
"\ua7a3":"k","\u24db":"l","\uff4c":"l","\u0140":"l","\u013a":"l","\u013e":"l","\u1e37":"l","\u1e39":"l","\u013c":"l","\u1e3d":"l","\u1e3b":"l","\u017f":"l","\u0142":"l","\u019a":"l","\u026b":"l","\u2c61":"l","\ua749":"l","\ua781":"l","\ua747":"l","\u01c9":"lj","\u24dc":"m","\uff4d":"m","\u1e3f":"m","\u1e41":"m","\u1e43":"m","\u0271":"m","\u026f":"m","\u24dd":"n","\uff4e":"n","\u01f9":"n","\u0144":"n","\u00f1":"n","\u1e45":"n","\u0148":"n","\u1e47":"n","\u0146":"n","\u1e4b":"n","\u1e49":"n","\u019e":"n",
"\u0272":"n","\u0149":"n","\ua791":"n","\ua7a5":"n","\u01cc":"nj","\u24de":"o","\uff4f":"o","\u00f2":"o","\u00f3":"o","\u00f4":"o","\u1ed3":"o","\u1ed1":"o","\u1ed7":"o","\u1ed5":"o","\u00f5":"o","\u1e4d":"o","\u022d":"o","\u1e4f":"o","\u014d":"o","\u1e51":"o","\u1e53":"o","\u014f":"o","\u022f":"o","\u0231":"o","\u00f6":"o","\u022b":"o","\u1ecf":"o","\u0151":"o","\u01d2":"o","\u020d":"o","\u020f":"o","\u01a1":"o","\u1edd":"o","\u1edb":"o","\u1ee1":"o","\u1edf":"o","\u1ee3":"o","\u1ecd":"o","\u1ed9":"o",
"\u01eb":"o","\u01ed":"o","\u00f8":"o","\u01ff":"o","\u0254":"o","\ua74b":"o","\ua74d":"o","\u0275":"o","\u01a3":"oi","\u0223":"ou","\ua74f":"oo","\u24df":"p","\uff50":"p","\u1e55":"p","\u1e57":"p","\u01a5":"p","\u1d7d":"p","\ua751":"p","\ua753":"p","\ua755":"p","\u24e0":"q","\uff51":"q","\u024b":"q","\ua757":"q","\ua759":"q","\u24e1":"r","\uff52":"r","\u0155":"r","\u1e59":"r","\u0159":"r","\u0211":"r","\u0213":"r","\u1e5b":"r","\u1e5d":"r","\u0157":"r","\u1e5f":"r","\u024d":"r","\u027d":"r","\ua75b":"r",
"\ua7a7":"r","\ua783":"r","\u24e2":"s","\uff53":"s","\u00df":"s","\u015b":"s","\u1e65":"s","\u015d":"s","\u1e61":"s","\u0161":"s","\u1e67":"s","\u1e63":"s","\u1e69":"s","\u0219":"s","\u015f":"s","\u023f":"s","\ua7a9":"s","\ua785":"s","\u1e9b":"s","\u24e3":"t","\uff54":"t","\u1e6b":"t","\u1e97":"t","\u0165":"t","\u1e6d":"t","\u021b":"t","\u0163":"t","\u1e71":"t","\u1e6f":"t","\u0167":"t","\u01ad":"t","\u0288":"t","\u2c66":"t","\ua787":"t","\ua729":"tz","\u24e4":"u","\uff55":"u","\u00f9":"u","\u00fa":"u",
"\u00fb":"u","\u0169":"u","\u1e79":"u","\u016b":"u","\u1e7b":"u","\u016d":"u","\u00fc":"u","\u01dc":"u","\u01d8":"u","\u01d6":"u","\u01da":"u","\u1ee7":"u","\u016f":"u","\u0171":"u","\u01d4":"u","\u0215":"u","\u0217":"u","\u01b0":"u","\u1eeb":"u","\u1ee9":"u","\u1eef":"u","\u1eed":"u","\u1ef1":"u","\u1ee5":"u","\u1e73":"u","\u0173":"u","\u1e77":"u","\u1e75":"u","\u0289":"u","\u24e5":"v","\uff56":"v","\u1e7d":"v","\u1e7f":"v","\u028b":"v","\ua75f":"v","\u028c":"v","\ua761":"vy","\u24e6":"w","\uff57":"w",
"\u1e81":"w","\u1e83":"w","\u0175":"w","\u1e87":"w","\u1e85":"w","\u1e98":"w","\u1e89":"w","\u2c73":"w","\u24e7":"x","\uff58":"x","\u1e8b":"x","\u1e8d":"x","\u24e8":"y","\uff59":"y","\u1ef3":"y","\u00fd":"y","\u0177":"y","\u1ef9":"y","\u0233":"y","\u1e8f":"y","\u00ff":"y","\u1ef7":"y","\u1e99":"y","\u1ef5":"y","\u01b4":"y","\u024f":"y","\u1eff":"y","\u24e9":"z","\uff5a":"z","\u017a":"z","\u1e91":"z","\u017c":"z","\u017e":"z","\u1e93":"z","\u1e95":"z","\u01b6":"z","\u0225":"z","\u0240":"z","\u2c6c":"z",
"\ua763":"z"};u=e(document);var O=1;z=function(){return O++};u.on("mousemove",function(a){x.x=a.pageX;x.y=a.pageY});u=A(Object,{bind:function(a){var b=this;return function(){a.apply(b,arguments)}},init:function(a){var b,c;this.opts=a=this.prepareOpts(a);this.id=a.id;void 0!==a.element.data("select2")&&null!==a.element.data("select2")&&a.element.data("select2").destroy();this.container=this.createContainer();this.containerId="s2id_"+(a.element.attr("id")||"autogen"+z());this.containerSelector="#"+
this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");this.container.attr("id",this.containerId);var d=!1,g;this.body=function(){!1===d&&(g=a.element.closest("body"),d=!0);return g};y(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.attr("style",a.element.attr("style"));this.container.css(p(a.containerCss));this.container.addClass(p(a.containerCssClass));this.elementTabIndex=this.opts.element.attr("tabindex");this.opts.element.data("select2",this).attr("tabindex",
"-1").before(this.container).on("click.select2",l);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(p(a.dropdownCssClass));this.dropdown.data("select2",this);this.dropdown.on("click",l);this.results=b=this.container.find(".select2-results");this.search=c=this.container.find("input.select2-input");this.resultsPage=this.queryCount=0;this.context=null;this.initContainer();this.container.on("click",
l);this.results.on("mousemove",function(a){(void 0===x||x.x!==a.pageX||x.y!==a.pageY)&&e(a.target).trigger("mousemove-filtered",a)});this.dropdown.on("mousemove-filtered touchstart touchmove touchend",".select2-results",this.bind(this.highlightUnderEvent));var h=this.results,m=F(80,function(a){h.trigger("scroll-debounced",a)});h.on("scroll",function(a){0<=j(a.target,h.get())&&m(a)});this.dropdown.on("scroll-debounced",".select2-results",this.bind(this.loadMoreIfNeeded));e(this.container).on("change",
".select2-input",function(a){a.stopPropagation()});e(this.dropdown).on("change",".select2-input",function(a){a.stopPropagation()});e.fn.mousewheel&&b.mousewheel(function(a,c,d,e){c=b.scrollTop();0<e&&0>=c-e?(b.scrollTop(0),l(a)):0>e&&b.get(0).scrollHeight-b.scrollTop()+e<=b.height()&&(b.scrollTop(b.get(0).scrollHeight-b.height()),l(a))});E(c);c.on("keyup-change input paste",this.bind(this.updateResults));c.on("focus",function(){c.addClass("select2-focused")});c.on("blur",function(){c.removeClass("select2-focused")});
this.dropdown.on("mouseup",".select2-results",this.bind(function(a){0<e(a.target).closest(".select2-result-selectable").length&&(this.highlightUnderEvent(a),this.selectHighlighted(a))}));this.dropdown.on("click mouseup mousedown",function(a){a.stopPropagation()});e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource());null!==a.maximumInputLength&&this.search.attr("maxlength",a.maximumInputLength);var i=a.element.prop("disabled");void 0===i&&(i=!1);this.enable(!i);i=a.element.prop("readonly");
void 0===i&&(i=!1);this.readonly(i);if(!(i=D)){i=e("<div class='select2-measure-scrollbar'></div>");i.appendTo("body");var f={width:i.width()-i[0].clientWidth,height:i.height()-i[0].clientHeight};i.remove();i=f}D=i;this.autofocus=a.element.prop("autofocus");a.element.prop("autofocus",!1);this.autofocus&&this.focus();this.nextSearchTerm=void 0},destroy:function(){var a=this.opts.element,b=a.data("select2");this.close();this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null);
void 0!==b&&(b.container.remove(),b.dropdown.remove(),a.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?a.attr({tabindex:this.elementTabIndex}):a.removeAttr("tabindex"),a.show())},optionToData:function(a){if(a.is("option"))return{id:a.prop("value"),text:a.text(),element:a.get(),css:a.attr("class"),disabled:a.prop("disabled"),locked:k(a.attr("locked"),"locked")||k(a.data("locked"),!0)};if(a.is("optgroup"))return{text:a.attr("label"),
children:[],element:a.get(),css:a.attr("class")}},prepareOpts:function(a){var b,c,d,g=this;b=a.element;"select"===b.get(0).tagName.toLowerCase()&&(this.select=c=a.element);c&&e.each("id multiple ajax query createSearchChoice initSelection data tags".split(" "),function(){if(this in a)throw Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.");});a=e.extend({},{populateResults:function(b,c,d){var f,t=this.opts.id;f=function(b,c,h){var m,l,k,j,n,p,r,b=a.sortResults(b,
c,d);m=0;for(l=b.length;m<l;m=m+1){k=b[m];n=k.disabled===true;j=!n&&t(k)!==void 0;p=k.children&&k.children.length>0;r=e("<li></li>");r.addClass("select2-results-dept-"+h);r.addClass("select2-result");r.addClass(j?"select2-result-selectable":"select2-result-unselectable");n&&r.addClass("select2-disabled");p&&r.addClass("select2-result-with-children");r.addClass(g.opts.formatResultCssClass(k));j=e(document.createElement("div"));j.addClass("select2-result-label");n=a.formatResult(k,j,d,g.opts.escapeMarkup);
n!==void 0&&j.html(n);r.append(j);if(p){p=e("<ul></ul>");p.addClass("select2-result-sub");f(k.children,p,h+1);r.append(p)}r.data("select2-data",k);c.append(r)}};f(c,b,0)}},e.fn.select2.defaults,a);"function"!==typeof a.id&&(d=a.id,a.id=function(a){return a[d]});if(e.isArray(a.element.data("select2Tags"))){if("tags"in a)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+a.element.attr("id");a.tags=a.element.data("select2Tags")}if(c)a.query=this.bind(function(a){var c=
{results:[],more:false},d=a.term,e,f,q;q=function(b,c){var e;if(b.is("option"))a.matcher(d,b.text(),b)&&c.push(g.optionToData(b));else if(b.is("optgroup")){e=g.optionToData(b);b.children().each2(function(a,b){q(b,e.children)});e.children.length>0&&c.push(e)}};e=b.children();if(this.getPlaceholder()!==void 0&&e.length>0)(f=this.getPlaceholderOption())&&(e=e.not(f));e.each2(function(a,b){q(b,c.results)});a.callback(c)}),a.id=function(a){return a.id},a.formatResultCssClass=function(a){return a.css};
else if(!("query"in a))if("ajax"in a){if((c=a.element.data("ajax-url"))&&0<c.length)a.ajax.url=c;a.query=I.call(a.element,a.ajax)}else if("data"in a)a.query=J(a.data);else if("tags"in a&&(a.query=K(a.tags),void 0===a.createSearchChoice&&(a.createSearchChoice=function(a){return{id:e.trim(a),text:e.trim(a)}}),void 0===a.initSelection))a.initSelection=function(b,c){var d=[];e(w(b.val(),a.separator)).each(function(){var b={id:this,text:this},c=a.tags;e.isFunction(c)&&(c=c());e(c).each(function(){if(k(this.id,
b.id)){b=this;return false}});d.push(b)});c(d)};if("function"!==typeof a.query)throw"query function not defined for Select2 "+a.element.attr("id");return a},monitorSource:function(){var a=this.opts.element,b,c;a.on("change.select2",this.bind(function(){!0!==this.opts.element.data("select2-change-triggered")&&this.initSelection()}));b=this.bind(function(){var b=a.prop("disabled");void 0===b&&(b=!1);this.enable(!b);b=a.prop("readonly");void 0===b&&(b=!1);this.readonly(b);y(this.container,this.opts.element,
this.opts.adaptContainerCssClass);this.container.addClass(p(this.opts.containerCssClass));y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(p(this.opts.dropdownCssClass))});a.on("propertychange.select2",b);void 0===this.mutationCallback&&(this.mutationCallback=function(a){a.forEach(b)});c=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;void 0!==c&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=
null),this.propertyObserver=new c(this.mutationCallback),this.propertyObserver.observe(a.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(a){a=e.Event("select2-selecting",{val:this.id(a),object:a});this.opts.element.trigger(a);return!a.isDefaultPrevented()},triggerChange:function(a){a=a||{};a=e.extend({},a,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",!0);this.opts.element.trigger(a);this.opts.element.data("select2-change-triggered",!1);this.opts.element.click();
this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return!0===this.enabledInterface},enableInterface:function(){var a=this._enabled&&!this._readonly;if(a===this.enabledInterface)return!1;this.container.toggleClass("select2-container-disabled",!a);this.close();this.enabledInterface=a;return!0},enable:function(a){void 0===a&&(a=!0);this._enabled!==a&&(this._enabled=a,this.opts.element.prop("disabled",!a),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(a){void 0===
a&&(a=!1);if(this._readonly===a)return!1;this._readonly=a;this.opts.element.prop("readonly",a);this.enableInterface();return!0},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var a=this.dropdown,b=this.container.offset(),c=this.container.outerHeight(!1),d=this.container.outerWidth(!1),g=a.outerHeight(!1),h=e(window),f=h.width(),i=h.height(),o=h.scrollLeft()+f,k=h.scrollTop()+i,c=b.top+c,q=b.left,k=c+g<=k,l=b.top-g>=this.body().scrollTop(),j=
a.outerWidth(!1),n=q+j<=o,s;a.hasClass("select2-drop-above")?(g=!0,!l&&k&&(s=!0,g=!1)):(g=!1,!k&&l&&(g=s=!0));s&&(a.hide(),b=this.container.offset(),c=this.container.outerHeight(!1),d=this.container.outerWidth(!1),a.outerHeight(!1),o=h.scrollLeft()+f,h.scrollTop(),c=b.top+c,q=b.left,j=a.outerWidth(!1),n=q+j<=o,a.show());this.opts.dropdownAutoWidth?(h=e(".select2-results",a)[0],a.addClass("select2-drop-auto-width"),a.css("width",""),j=a.outerWidth(!1)+(h.scrollHeight===h.clientHeight?0:D.width),j>
d?d=j:j=d,n=q+j<=o):this.container.removeClass("select2-drop-auto-width");"static"!==this.body().css("position")&&(o=this.body().offset(),c-=o.top,q-=o.left);n||(q=b.left+d-j);d={left:q,width:d};g?(d.bottom=i-b.top,d.top="auto",this.container.addClass("select2-drop-above"),a.addClass("select2-drop-above")):(d.top=c,d.bottom="auto",this.container.removeClass("select2-drop-above"),a.removeClass("select2-drop-above"));d=e.extend(d,p(this.opts.dropdownCss));a.css(d)},shouldOpen:function(){var a;if(this.opened()||
!1===this._enabled||!0===this._readonly)return!1;a=e.Event("select2-opening");this.opts.element.trigger(a);return!a.isDefaultPrevented()},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")},open:function(){if(!this.shouldOpen())return!1;this.opening();return!0},opening:function(){var a=this.containerId,b="scroll."+a,c="resize."+a,d="orientationchange."+a;this.container.addClass("select2-dropdown-open").addClass("select2-container-active");
this.clearDropdownAlignmentPreference();this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body());a=e("#select2-drop-mask");0==a.length&&(a=e(document.createElement("div")),a.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),a.hide(),a.appendTo(this.body()),a.on("mousedown touchstart click",function(a){var b=e("#select2-drop");0<b.length&&(b=b.data("select2"),b.opts.selectOnBlur&&b.selectHighlighted({noFocus:!0}),b.close({focus:!0}),a.preventDefault(),
a.stopPropagation())}));this.dropdown.prev()[0]!==a[0]&&this.dropdown.before(a);e("#select2-drop").removeAttr("id");this.dropdown.attr("id","select2-drop");a.show();this.positionDropdown();this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");var g=this;this.container.parents().add(window).each(function(){e(this).on(c+" "+b+" "+d,function(){g.positionDropdown()})})},close:function(){if(this.opened()){var a=this.containerId,b="scroll."+a,c="resize."+a,d="orientationchange."+
a;this.container.parents().add(window).each(function(){e(this).off(b).off(c).off(d)});this.clearDropdownAlignmentPreference();e("#select2-drop-mask").hide();this.dropdown.removeAttr("id");this.dropdown.hide();this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");this.results.empty();this.clearSearch();this.search.removeClass("select2-active");this.opts.element.trigger(e.Event("select2-close"))}},externalSearch:function(a){this.open();this.search.val(a);this.updateResults(!1)},
clearSearch:function(){},getMaximumSelectionSize:function(){return p(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var a=this.results,b,c,d,g;c=this.highlight();0>c||(0==c?a.scrollTop(0):(b=this.findHighlightableChoices().find(".select2-result-label"),d=e(b[c]),g=d.offset().top+d.outerHeight(!0),c===b.length-1&&(b=a.find("li.select2-more-results"),0<b.length&&(g=b.offset().top+b.outerHeight(!0))),b=a.offset().top+a.outerHeight(!0),g>b&&a.scrollTop(a.scrollTop()+(g-b)),g=d.offset().top-
a.offset().top,0>g&&"none"!=d.css("display")&&a.scrollTop(a.scrollTop()+g)))},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled, .select2-selected)")},moveHighlight:function(a){for(var b=this.findHighlightableChoices(),c=this.highlight();-1<c&&c<b.length;){var c=c+a,d=e(b[c]);if(d.hasClass("select2-result-selectable")&&!d.hasClass("select2-disabled")&&!d.hasClass("select2-selected")){this.highlight(c);break}}},highlight:function(a){var b=
this.findHighlightableChoices();if(0===arguments.length)return j(b.filter(".select2-highlighted")[0],b.get());a>=b.length&&(a=b.length-1);0>a&&(a=0);this.removeHighlight();b=e(b[a]);b.addClass("select2-highlighted");this.ensureHighlightVisible();(b=b.data("select2-data"))&&this.opts.element.trigger({type:"select2-highlight",val:this.id(b),choice:b})},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},countSelectableResults:function(){return this.findHighlightableChoices().length},
highlightUnderEvent:function(a){a=e(a.target).closest(".select2-result-selectable");if(0<a.length&&!a.is(".select2-highlighted")){var b=this.findHighlightableChoices();this.highlight(b.index(a))}else 0==a.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var a=this.results,b=a.find("li.select2-more-results"),c,d=this.resultsPage+1,e=this,h=this.search.val(),f=this.context;0!==b.length&&(c=b.offset().top-a.offset().top-a.height(),c<=this.opts.loadMorePadding&&(b.addClass("select2-active"),
this.opts.query({element:this.opts.element,term:h,page:d,context:f,matcher:this.opts.matcher,callback:this.bind(function(c){e.opened()&&(e.opts.populateResults.call(this,a,c.results,{term:h,page:d,context:f}),e.postprocessResults(c,!1,!1),!0===c.more?(b.detach().appendTo(a).text(e.opts.formatLoadMore(d+1)),window.setTimeout(function(){e.loadMoreIfNeeded()},10)):b.remove(),e.positionDropdown(),e.resultsPage=d,e.context=c.context,this.opts.element.trigger({type:"select2-loaded",items:c}))})})))},tokenize:function(){},
updateResults:function(a){function b(){d.removeClass("select2-active");i.positionDropdown()}function c(a){g.html(a);b()}var d=this.search,g=this.results,h=this.opts,f,i=this;f=d.val();var o=e.data(this.container,"select2-last-term"),j;if(!(!0!==a&&o&&k(f,o))&&(e.data(this.container,"select2-last-term",f),!(!0!==a&&(!1===this.showSearchInput||!this.opened())))){j=++this.queryCount;o=this.getMaximumSelectionSize();if(1<=o&&(f=this.data(),e.isArray(f)&&f.length>=o&&s(h.formatSelectionTooBig,"formatSelectionTooBig"))){c("<li class='select2-selection-limit'>"+
h.formatSelectionTooBig(o)+"</li>");return}d.val().length<h.minimumInputLength?(s(h.formatInputTooShort,"formatInputTooShort")?c("<li class='select2-no-results'>"+h.formatInputTooShort(d.val(),h.minimumInputLength)+"</li>"):c(""),a&&this.showSearch&&this.showSearch(!0)):h.maximumInputLength&&d.val().length>h.maximumInputLength?s(h.formatInputTooLong,"formatInputTooLong")?c("<li class='select2-no-results'>"+h.formatInputTooLong(d.val(),h.maximumInputLength)+"</li>"):c(""):(h.formatSearching&&0===this.findHighlightableChoices().length&&
c("<li class='select2-searching'>"+h.formatSearching()+"</li>"),d.addClass("select2-active"),this.removeHighlight(),f=this.tokenize(),void 0!=f&&null!=f&&d.val(f),this.resultsPage=1,h.query({element:h.element,term:d.val(),page:this.resultsPage,context:null,matcher:h.matcher,callback:this.bind(function(f){var m;j==this.queryCount&&(this.opened()?(this.context=void 0===f.context?null:f.context,this.opts.createSearchChoice&&""!==d.val()&&(m=this.opts.createSearchChoice.call(i,d.val(),f.results),void 0!==
m&&null!==m&&void 0!==i.id(m)&&null!==i.id(m)&&0===e(f.results).filter(function(){return k(i.id(this),i.id(m))}).length&&f.results.unshift(m)),0===f.results.length&&s(h.formatNoMatches,"formatNoMatches"))?c("<li class='select2-no-results'>"+h.formatNoMatches(d.val())+"</li>"):(g.empty(),i.opts.populateResults.call(this,g,f.results,{term:d.val(),page:this.resultsPage,context:null}),!0===f.more&&s(h.formatLoadMore,"formatLoadMore")&&(g.append("<li class='select2-more-results'>"+i.opts.escapeMarkup(h.formatLoadMore(this.resultsPage))+
"</li>"),window.setTimeout(function(){i.loadMoreIfNeeded()},10)),this.postprocessResults(f,a),b(),this.opts.element.trigger({type:"select2-loaded",items:f})):this.search.removeClass("select2-active"))})}))}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0});this.close();this.container.removeClass("select2-container-active");this.search[0]===document.activeElement&&this.search.blur();this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},
focusSearch:function(){var a=this.search;a[0]!==document.activeElement&&window.setTimeout(function(){var b=a[0],c=a.val().length;a.focus();a.is(":visible")&&b===document.activeElement&&(b.setSelectionRange?b.setSelectionRange(c,c):b.createTextRange&&(b=b.createTextRange(),b.collapse(!1),b.select()))},0)},selectHighlighted:function(a){var b=this.highlight(),c=this.results.find(".select2-highlighted").closest(".select2-result").data("select2-data");c?(this.highlight(b),this.onSelect(c,a)):a&&a.noFocus&&
this.close()},getPlaceholder:function(){var a;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||(void 0!==(a=this.getPlaceholderOption())?a.text():void 0)},getPlaceholderOption:function(){if(this.select){var a=this.select.children("option").first();if(void 0!==this.opts.placeholderOption)return"first"===this.opts.placeholderOption&&a||"function"===typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);
if(""===a.text()&&""===a.val())return a}},initContainerWidth:function(){var a=function(){var a,c,d,g;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){a=this.opts.element.attr("style");if(void 0!==a){a=a.split(";");d=0;for(g=a.length;d<g;d+=1)if(c=a[d].replace(/\s/g,""),c=c.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),
null!==c&&1<=c.length)return c[1]}return"resolve"===this.opts.width?(a=this.opts.element.css("width"),0<a.indexOf("%")?a:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}.call(this);null!==a&&this.container.css("width",a)}});B=A(u,{createContainer:function(){return e(document.createElement("div")).attr({"class":"select2-container"}).html("<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>   <span class='select2-arrow'><b></b></span></a><input class='select2-focusser select2-offscreen' type='text'/><div class='select2-drop select2-display-none'>   <div class='select2-search'>       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>   </div>   <ul class='select2-results'>   </ul></div>")},
enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var a,b;0<=this.opts.minimumResultsForSearch&&this.showSearch(!0);this.parent.opening.apply(this,arguments);!1!==this.showSearchInput&&this.search.val(this.focusser.val());this.search.focus();a=this.search.get(0);a.createTextRange?(a=a.createTextRange(),a.collapse(!1),a.select()):a.setSelectionRange&&(b=this.search.val().length,a.setSelectionRange(b,
b));""===this.search.val()&&void 0!=this.nextSearchTerm&&(this.search.val(this.nextSearchTerm),this.search.select());this.focusser.prop("disabled",!0).val("");this.updateResults(!0);this.opts.element.trigger(e.Event("select2-open"))},close:function(a){this.opened()&&(this.parent.close.apply(this,arguments),a=a||{focus:!0},this.focusser.removeAttr("disabled"),a.focus&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},
cancel:function(){this.parent.cancel.apply(this,arguments);this.focusser.removeAttr("disabled");this.focusser.focus()},destroy:function(){e("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id"));this.parent.destroy.apply(this,arguments)},initContainer:function(){var a,b=this.container,c=this.dropdown;0>this.opts.minimumResultsForSearch?this.showSearch(!1):this.showSearch(!0);this.selection=a=b.find(".select2-choice");this.focusser=b.find(".select2-focusser");this.focusser.attr("id",
"s2id_autogen"+z());e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id"));this.focusser.attr("tabindex",this.elementTabIndex);this.search.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled())if(a.which===f.PAGE_UP||a.which===f.PAGE_DOWN)l(a);else switch(a.which){case f.UP:case f.DOWN:this.moveHighlight(a.which===f.UP?-1:1);l(a);break;case f.ENTER:this.selectHighlighted();l(a);break;case f.TAB:this.selectHighlighted({noFocus:!0});break;case f.ESC:this.cancel(a),
l(a)}}));this.search.on("blur",this.bind(function(){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.search.focus()}),0)}));this.focusser.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()&&!(a.which===f.TAB||f.isControl(a)||f.isFunctionKey(a)||a.which===f.ESC))if(!1===this.opts.openOnEnter&&a.which===f.ENTER)l(a);else if(a.which==f.DOWN||a.which==f.UP||a.which==f.ENTER&&this.opts.openOnEnter)!a.altKey&&(!a.ctrlKey&&!a.shiftKey&&!a.metaKey)&&(this.open(),
l(a));else if(a.which==f.DELETE||a.which==f.BACKSPACE)this.opts.allowClear&&this.clear(),l(a)}));E(this.focusser);this.focusser.on("keyup-change input",this.bind(function(a){0<=this.opts.minimumResultsForSearch&&(a.stopPropagation(),this.opened()||this.open())}));a.on("mousedown","abbr",this.bind(function(a){this.isInterfaceEnabled()&&(this.clear(),a.preventDefault(),a.stopImmediatePropagation(),this.close(),this.selection.focus())}));a.on("mousedown",this.bind(function(a){this.container.hasClass("select2-container-active")||
this.opts.element.trigger(e.Event("select2-focus"));this.opened()?this.close():this.isInterfaceEnabled()&&this.open();l(a)}));c.on("mousedown",this.bind(function(){this.search.focus()}));a.on("focus",this.bind(function(a){l(a)}));this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus"));this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),
this.opts.element.trigger(e.Event("select2-blur")))}));this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus"));this.container.addClass("select2-container-active")}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.setPlaceholder()},clear:function(a){var b=this.selection.data("select2-data");if(b){var c=e.Event("select2-clearing");this.opts.element.trigger(c);c.isDefaultPrevented()||
(c=this.getPlaceholderOption(),this.opts.element.val(c?c.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),!1!==a&&(this.opts.element.trigger({type:"select2-removed",val:this.id(b),choice:b}),this.triggerChange({removed:b})))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var a=this;this.opts.initSelection.call(null,this.opts.element,function(b){void 0!==
b&&null!==b&&(a.updateSelection(b),a.close(),a.setPlaceholder())})}},isPlaceholderOptionSelected:function(){var a;return!this.getPlaceholder()?!1:void 0!==(a=this.getPlaceholderOption())&&a.prop("selected")||""===this.opts.element.val()||void 0===this.opts.element.val()||null===this.opts.element.val()},prepareOpts:function(){var a=this.parent.prepareOpts.apply(this,arguments),b=this;"select"===a.element.get(0).tagName.toLowerCase()?a.initSelection=function(a,d){var e=a.find("option").filter(function(){return this.selected});
d(b.optionToData(e))}:"data"in a&&(a.initSelection=a.initSelection||function(b,d){var g=b.val(),f=null;a.query({matcher:function(b,c,d){(b=k(g,a.id(d)))&&(f=d);return b},callback:!e.isFunction(d)?e.noop:function(){d(f)}})});return a},getPlaceholder:function(){return this.select&&void 0===this.getPlaceholderOption()?void 0:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var a=this.getPlaceholder();this.isPlaceholderOptionSelected()&&void 0!==a&&!(this.select&&void 0===this.getPlaceholderOption())&&
(this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(a)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear"))},postprocessResults:function(a,b,c){var d=0,e=this;this.findHighlightableChoices().each2(function(a,b){if(k(e.id(b.data("select2-data")),e.opts.element.val()))return d=a,!1});!1!==c&&(!0===b&&0<=d?this.highlight(d):this.highlight(0));!0===b&&(b=this.opts.minimumResultsForSearch,0<=b&&this.showSearch(L(a.results)>=b))},showSearch:function(a){this.showSearchInput!==
a&&(this.showSearchInput=a,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!a),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!a),e(this.dropdown,this.container).toggleClass("select2-with-searchbox",a))},onSelect:function(a,b){if(this.triggerSelect(a)){var c=this.opts.element.val(),d=this.data();this.opts.element.val(this.id(a));this.updateSelection(a);this.opts.element.trigger({type:"select2-selected",val:this.id(a),choice:a});this.nextSearchTerm=
this.opts.nextSearchTerm(a,this.search.val());this.close();(!b||!b.noFocus)&&this.focusser.focus();k(c,this.id(a))||this.triggerChange({added:a,removed:d})}},updateSelection:function(a){var b=this.selection.find(".select2-chosen"),c;this.selection.data("select2-data",a);b.empty();null!==a&&(c=this.opts.formatSelection(a,b,this.opts.escapeMarkup));void 0!==c&&b.append(c);a=this.opts.formatSelectionCssClass(a,b);void 0!==a&&b.addClass(a);this.selection.removeClass("select2-default");this.opts.allowClear&&
void 0!==this.getPlaceholder()&&this.container.addClass("select2-allowclear")},val:function(){var a,b=!1,c=null,d=this,e=this.data();if(0===arguments.length)return this.opts.element.val();a=arguments[0];1<arguments.length&&(b=arguments[1]);if(this.select)this.select.val(a).find("option").filter(function(){return this.selected}).each2(function(a,b){c=d.optionToData(b);return!1}),this.updateSelection(c),this.setPlaceholder(),b&&this.triggerChange({added:c,removed:e});else if(!a&&0!==a)this.clear(b);
else{if(void 0===this.opts.initSelection)throw Error("cannot call val() if initSelection() is not defined");this.opts.element.val(a);this.opts.initSelection(this.opts.element,function(a){d.opts.element.val(!a?"":d.id(a));d.updateSelection(a);d.setPlaceholder();b&&d.triggerChange({added:a,removed:e})})}},clearSearch:function(){this.search.val("");this.focusser.val("")},data:function(a){var b,c=!1;if(0===arguments.length)return b=this.selection.data("select2-data"),void 0==b&&(b=null),b;1<arguments.length&&
(c=arguments[1]);a?(b=this.data(),this.opts.element.val(!a?"":this.id(a)),this.updateSelection(a),c&&this.triggerChange({added:a,removed:b})):this.clear(c)}});C=A(u,{createContainer:function(){return e(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html("<ul class='select2-choices'>  <li class='select2-search-field'>    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>  </li></ul><div class='select2-drop select2-drop-multi select2-display-none'>   <ul class='select2-results'>   </ul></div>")},
prepareOpts:function(){var a=this.parent.prepareOpts.apply(this,arguments),b=this;"select"===a.element.get(0).tagName.toLowerCase()?a.initSelection=function(a,d){var e=[];a.find("option").filter(function(){return this.selected}).each2(function(a,c){e.push(b.optionToData(c))});d(e)}:"data"in a&&(a.initSelection=a.initSelection||function(b,d){var f=w(b.val(),a.separator),h=[];a.query({matcher:function(b,c,d){(b=e.grep(f,function(b){return k(b,a.id(d))}).length)&&h.push(d);return b},callback:!e.isFunction(d)?
e.noop:function(){for(var b=[],c=0;c<f.length;c++)for(var e=f[c],j=0;j<h.length;j++){var l=h[j];if(k(e,a.id(l))){b.push(l);h.splice(j,1);break}}d(b)}})});return a},selectChoice:function(a){var b=this.container.find(".select2-search-choice-focus");if(!b.length||!(a&&a[0]==b[0]))b.length&&this.opts.element.trigger("choice-deselected",b),b.removeClass("select2-search-choice-focus"),a&&a.length&&(this.close(),a.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",a))},destroy:function(){e("label[for='"+
this.search.attr("id")+"']").attr("for",this.opts.element.attr("id"));this.parent.destroy.apply(this,arguments)},initContainer:function(){var a;this.searchContainer=this.container.find(".select2-search-field");this.selection=a=this.container.find(".select2-choices");var b=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",function(){b.search[0].focus();b.selectChoice(e(this))});this.search.attr("id","s2id_autogen"+z());e("label[for='"+this.opts.element.attr("id")+"']").attr("for",
this.search.attr("id"));this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())}));this.search.attr("tabindex",this.elementTabIndex);this.keydowns=0;this.search.on("keydown",this.bind(function(b){var d,g;if(this.isInterfaceEnabled()){++this.keydowns;var h=a.find(".select2-search-choice-focus"),j=h.prev(".select2-search-choice:not(.select2-locked)"),i=h.next(".select2-search-choice:not(.select2-locked)");d=this.search;d=e(d)[0];var k=0;g=0;"selectionStart"in
d?(k=d.selectionStart,g=d.selectionEnd-k):"selection"in document&&(d.focus(),k=document.selection.createRange(),g=document.selection.createRange().text.length,k.moveStart("character",-d.value.length),k=k.text.length-g);d=k;if(h.length&&(b.which==f.LEFT||b.which==f.RIGHT||b.which==f.BACKSPACE||b.which==f.DELETE||b.which==f.ENTER))g=h,b.which==f.LEFT&&j.length?g=j:b.which==f.RIGHT?g=i.length?i:null:b.which===f.BACKSPACE?(this.unselect(h.first()),this.search.width(10),g=j.length?j:i):b.which==f.DELETE?
(this.unselect(h.first()),this.search.width(10),g=i.length?i:null):b.which==f.ENTER&&(g=null),this.selectChoice(g),l(b),(!g||!g.length)&&this.open();else if((b.which===f.BACKSPACE&&1==this.keydowns||b.which==f.LEFT)&&0==d&&!g)this.selectChoice(a.find(".select2-search-choice:not(.select2-locked)").last()),l(b);else{this.selectChoice(null);if(this.opened())switch(b.which){case f.UP:case f.DOWN:this.moveHighlight(b.which===f.UP?-1:1);l(b);return;case f.ENTER:this.selectHighlighted();l(b);return;case f.TAB:this.selectHighlighted({noFocus:!0});
this.close();return;case f.ESC:this.cancel(b);l(b);return}b.which===f.TAB||f.isControl(b)||f.isFunctionKey(b)||b.which===f.BACKSPACE||b.which===f.ESC||b.which===f.ENTER&&(!1===this.opts.openOnEnter||b.altKey||b.ctrlKey||b.shiftKey||b.metaKey)||(this.open(),(b.which===f.PAGE_UP||b.which===f.PAGE_DOWN)&&l(b),b.which===f.ENTER&&l(b))}}}));this.search.on("keyup",this.bind(function(){this.keydowns=0;this.resizeSearch()}));this.search.on("blur",this.bind(function(a){this.container.removeClass("select2-container-active");
this.search.removeClass("select2-focused");this.selectChoice(null);this.opened()||this.clearSearch();a.stopImmediatePropagation();this.opts.element.trigger(e.Event("select2-blur"))}));this.container.on("click",".select2-choices",this.bind(function(a){this.isInterfaceEnabled()&&!(0<e(a.target).closest(".select2-search-choice").length)&&(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.open(),
this.focusSearch(),a.preventDefault())}));this.container.on("focus",".select2-choices",this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,
arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch());if(this.select||""!==this.opts.element.val()){var a=this;this.opts.initSelection.call(null,this.opts.element,function(b){if(b!==void 0&&b!==null){a.updateSelection(b);a.close();a.clearSearch()}})}},clearSearch:function(){var a=this.getPlaceholder(),b=this.getMaxSearchWidth();void 0!==a&&
0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(a).addClass("select2-default"),this.search.width(0<b?b:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder();this.resizeSearch();this.parent.opening.apply(this,arguments);this.focusSearch();this.updateResults(!0);this.search.focus();this.opts.element.trigger(e.Event("select2-open"))},
close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close();this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(a){var b=[],c=[],d=this;e(a).each(function(){0>j(d.id(this),b)&&(b.push(d.id(this)),c.push(this))});a=c;this.selection.find(".select2-search-choice").remove();e(a).each(function(){d.addSelectedChoice(this)});d.postprocessResults()},tokenize:function(){var a=this.search.val(),a=this.opts.tokenizer.call(this,
a,this.data(),this.bind(this.onSelect),this.opts);null!=a&&void 0!=a&&(this.search.val(a),0<a.length&&this.open())},onSelect:function(a,b){this.triggerSelect(a)&&(this.addSelectedChoice(a),this.opts.element.trigger({type:"selected",val:this.id(a),choice:a}),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(a,!1,!0===this.opts.closeOnSelect),this.opts.closeOnSelect?(this.close(),this.search.width(10)):0<this.countSelectableResults()?(this.search.width(10),this.resizeSearch(),0<this.getMaximumSelectionSize()&&
this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:a}),(!b||!b.noFocus)&&this.focusSearch())},cancel:function(){this.close();this.focusSearch()},addSelectedChoice:function(a){var b=!a.locked,c=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),d=e("<li class='select2-search-choice select2-locked'><div></div></li>"),
c=b?c:d,d=this.id(a),f=this.getVal(),h;h=this.opts.formatSelection(a,c.find("div"),this.opts.escapeMarkup);void 0!=h&&c.find("div").replaceWith("<div>"+h+"</div>");h=this.opts.formatSelectionCssClass(a,c.find("div"));void 0!=h&&c.addClass(h);if(b)c.find(".select2-search-choice-close").on("mousedown",l).on("click dblclick",this.bind(function(a){this.isInterfaceEnabled()&&(e(a.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(a.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");
this.close();this.focusSearch()})).dequeue(),l(a))})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))}));c.data("select2-data",a);c.insertBefore(this.searchContainer);f.push(d);this.setVal(f)},unselect:function(a){var b=this.getVal(),c,d,a=a.closest(".select2-search-choice");if(0===a.length)throw"Invalid argument: "+a+". Must be .select2-search-choice";if(c=a.data("select2-data")){for(;0<=
(d=j(this.id(c),b));)b.splice(d,1),this.setVal(b),this.select&&this.postprocessResults();b=e.Event("select2-removing");b.val=this.id(c);b.choice=c;this.opts.element.trigger(b);b.isDefaultPrevented()||(a.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(c),choice:c}),this.triggerChange({removed:c}))}},postprocessResults:function(a,b,c){var d=this.getVal(),b=this.results.find(".select2-result"),e=this.results.find(".select2-result-with-children"),f=this;b.each2(function(a,b){var c=
f.id(b.data("select2-data"));0<=j(c,d)&&(b.addClass("select2-selected"),b.find(".select2-result-selectable").addClass("select2-selected"))});e.each2(function(a,b){!b.is(".select2-result-selectable")&&0===b.find(".select2-result-selectable:not(.select2-selected)").length&&b.addClass("select2-selected")});-1==this.highlight()&&!1!==c&&f.highlight(0);!this.opts.createSearchChoice&&0<!b.filter(".select2-result:not(.select2-selected)").length&&(!a||a&&!a.more&&0===this.results.find(".select2-no-results").length)&&
s(f.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+f.opts.formatNoMatches(f.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-(this.search.outerWidth(!1)-this.search.width())},resizeSearch:function(){var a,b,c,d,f=this.search.outerWidth(!1)-this.search.width();a=this.search;v||(c=a[0].currentStyle||window.getComputedStyle(a[0],null),v=e(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",
display:"none",fontSize:c.fontSize,fontFamily:c.fontFamily,fontStyle:c.fontStyle,fontWeight:c.fontWeight,letterSpacing:c.letterSpacing,textTransform:c.textTransform,whiteSpace:"nowrap"}),v.attr("class","select2-sizer"),e("body").append(v));v.text(a.val());a=v.width()+10;b=this.search.offset().left;c=this.selection.width();d=this.selection.offset().left;b=c-(b-d)-f;b<a&&(b=c-f);40>b&&(b=c-f);0>=b&&(b=a);this.search.width(Math.floor(b))},getVal:function(){var a;if(this.select)return a=this.select.val(),
null===a?[]:a;a=this.opts.element.val();return w(a,this.opts.separator)},setVal:function(a){var b;this.select?this.select.val(a):(b=[],e(a).each(function(){0>j(this,b)&&b.push(this)}),this.opts.element.val(0===b.length?"":b.join(this.opts.separator)))},buildChangeDetails:function(a,b){for(var b=b.slice(0),a=a.slice(0),c=0;c<b.length;c++)for(var d=0;d<a.length;d++)k(this.opts.id(b[c]),this.opts.id(a[d]))&&(b.splice(c,1),0<c&&c--,a.splice(d,1),d--);return{added:b,removed:a}},val:function(a,b){var c,
d=this;if(0===arguments.length)return this.getVal();c=this.data();c.length||(c=[]);if(!a&&0!==a)this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),b&&this.triggerChange({added:this.data(),removed:c});else{this.setVal(a);if(this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),b&&this.triggerChange(this.buildChangeDetails(c,this.data()));else{if(void 0===this.opts.initSelection)throw Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,
function(a){var f=e.map(a,d.id);d.setVal(f);d.updateSelection(a);d.clearSearch();b&&d.triggerChange(d.buildChangeDetails(c,d.data()))})}this.clearSearch()}},onSortStart:function(){if(this.select)throw Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0);this.searchContainer.hide()},onSortEnd:function(){var a=[],b=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();
this.selection.find(".select2-search-choice").each(function(){a.push(b.opts.id(e(this).data("select2-data")))});this.setVal(a);this.triggerChange()},data:function(a,b){var c=this,d,f;if(0===arguments.length)return this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get();f=this.data();a||(a=[]);d=e.map(a,function(a){return c.opts.id(a)});this.setVal(d);this.updateSelection(a);this.clearSearch();b&&this.triggerChange(this.buildChangeDetails(f,this.data()))}});
e.fn.select2=function(){var a=Array.prototype.slice.call(arguments,0),b,c,d,f,h,k="val destroy opened open close focus isFocused container dropdown onSortStart onSortEnd enable disable readonly positionDropdown data search".split(" "),i=["opened","isFocused","container","dropdown"],l=["val","data"],n={search:"externalSearch"};this.each(function(){if(0===a.length||"object"===typeof a[0])b=0===a.length?{}:e.extend({},a[0]),b.element=e(this),"select"===b.element.get(0).tagName.toLowerCase()?h=b.element.prop("multiple"):
(h=b.multiple||!1,"tags"in b&&(b.multiple=h=!0)),c=h?new C:new B,c.init(b);else if("string"===typeof a[0]){if(0>j(a[0],k))throw"Unknown method: "+a[0];f=void 0;c=e(this).data("select2");if(void 0!==c&&(d=a[0],"container"===d?f=c.container:"dropdown"===d?f=c.dropdown:(n[d]&&(d=n[d]),f=c[d].apply(c,a.slice(1))),0<=j(a[0],i)||j(a[0],l)&&1==a.length))return!1}else throw"Invalid arguments to select2 plugin: "+a;});return void 0===f?this:f};e.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,
openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(a,b,c,d){b=[];G(a.text,c.term,b,d);return b.join("")},formatSelection:function(a,b,c){return a?c(a.text):void 0},sortResults:function(a){return a},formatResultCssClass:function(){},formatSelectionCssClass:function(){},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(a,b){var c=b-a.length;return"Please enter "+c+" more character"+(1==c?"":"s")},formatInputTooLong:function(a,
b){var c=a.length-b;return"Please delete "+c+" character"+(1==c?"":"s")},formatSelectionTooBig:function(a){return"You can only select "+a+" item"+(1==a?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(a){return a.id},matcher:function(a,b){return 0<=n(""+b).toUpperCase().indexOf(n(""+a).toUpperCase())},separator:",",tokenSeparators:[],
tokenizer:N,escapeMarkup:H,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(a){return a},adaptDropdownCssClass:function(){return null},nextSearchTerm:function(){}};e.fn.select2.ajaxDefaults={transport:e.ajax,params:{type:"GET",cache:!1,dataType:"json"}};window.Select2={query:{ajax:I,local:J,tags:K},util:{debounce:F,markMatch:G,escapeMarkup:H,stripDiacritics:n},"class":{"abstract":u,single:B,multi:C}}}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:aui-select2', location = 'js/aui-select2.js' */
(function(c){var e=c.fn.select2;c.fn.auiSelect2=function(d){var b;if(c.isPlainObject(d)){var a=c.extend({},d);b=a.hasAvatar?" aui-has-avatar":"";a.containerCssClass="aui-select2-container"+b+(a.containerCssClass?" "+a.containerCssClass:"");a.dropdownCssClass="aui-select2-drop aui-dropdown2 aui-style-default"+b+(a.dropdownCssClass?" "+a.dropdownCssClass:"");b=Array.prototype.slice.call(arguments,1);b.unshift(a)}else b=arguments.length?arguments:[{containerCssClass:"aui-select2-container",dropdownCssClass:"aui-select2-drop aui-dropdown2 aui-style-default"}];
return e.apply(this,b)}})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:aui-banner', location = '/js/aui/banner.js' */
(function(c){define("aui/banner",[],function(){return c(AJS,AJS.$,AJS.template)})})(function(c,b,e){return function(a){a=b(e('<div class="aui-banner aui-banner-{type}" role="banner">{body}</div>').fill({type:"error","body:html":a.body||""}).toString());b("#header").find(".aui-banner").get().forEach(function(a){"true"===a.getAttribute("aria-hidden")&&b(a).remove()});var d=b("#header");if(!d.length)throw Error("You must implement the application header");a.prependTo(d);c._internal.animation.recomputeStyle(a);
a.attr("aria-hidden","false");return a[0]}});;
;
/* module-key = 'bamboo.web.resources:ajs', location = '/scripts/aui-overrides.js' */
;
;
/* module-key = 'com.atlassian.auiplugin:internal-jquery-ui-datepicker', location = 'js-vendor/jquery/jquery-ui/jquery.ui.datepicker.js' */
(function(d){function B(){this.debug=!1;this._curInst=null;this._keyEvent=!1;this._disabledInputs=[];this._inDialog=this._datepickerShowing=!1;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass=
"ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:"January February March April May June July August September October November December".split(" "),monthNamesShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),dayNames:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),dayNamesMin:"Su Mo Tu We Th Fr Sa".split(" "),
weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,
beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1};d.extend(this._defaults,this.regional[""]);this.dpDiv=C(d('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function C(a){return a.bind("mouseout",function(a){a=d(a.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");
a.length&&a.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(b){b=d(b.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");if(!d.datepicker._isDisabledDatepicker(D.inline?a.parent()[0]:D.input[0])&&b.length)b.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),b.addClass("ui-state-hover"),b.hasClass("ui-datepicker-prev")&&b.addClass("ui-datepicker-prev-hover"),b.hasClass("ui-datepicker-next")&&
b.addClass("ui-datepicker-next-hover")})}function z(a,b){d.extend(a,b);for(var c in b)if(null==b[c]||void 0==b[c])a[c]=b[c];return a}d.extend(d.ui,{datepicker:{version:"1.8.24"}});var x=(new Date).getTime(),D;d.extend(B.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(a){z(this._defaults,a||{});return this},_attachDatepicker:function(a,b){var c=null,e;for(e in this._defaults){var f=
a.getAttribute("date:"+e);if(f){c=c||{};try{c[e]=eval(f)}catch(h){c[e]=f}}}e=a.nodeName.toLowerCase();f="div"==e||"span"==e;a.id||(this.uuid+=1,a.id="dp"+this.uuid);var j=this._newInst(d(a),f);j.settings=d.extend({},b||{},c||{});"input"==e?this._connectDatepicker(a,j):f&&this._inlineDatepicker(a,j)},_newInst:function(a,b){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:a,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:b,dpDiv:!b?this.dpDiv:C(d('<div class="'+
this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(a,b){var c=d(a);b.append=d([]);b.trigger=d([]);c.hasClass(this.markerClassName)||(this._attachments(c,b),c.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),this._autoSize(b),d.data(a,"datepicker",
b),b.settings.disabled&&this._disableDatepicker(a))},_attachments:function(a,b){var c=this._get(b,"appendText"),e=this._get(b,"isRTL");b.append&&b.append.remove();c&&(b.append=d('<span class="'+this._appendClass+'">'+c+"</span>"),a[e?"before":"after"](b.append));a.unbind("focus",this._showDatepicker);b.trigger&&b.trigger.remove();c=this._get(b,"showOn");("focus"==c||"both"==c)&&a.focus(this._showDatepicker);if("button"==c||"both"==c){var c=this._get(b,"buttonText"),f=this._get(b,"buttonImage");b.trigger=
d(this._get(b,"buttonImageOnly")?d("<img/>").addClass(this._triggerClass).attr({src:f,alt:c,title:c}):d('<button type="button"></button>').addClass(this._triggerClass).html(""==f?c:d("<img/>").attr({src:f,alt:c,title:c})));a[e?"before":"after"](b.trigger);b.trigger.click(function(){if(d.datepicker._datepickerShowing&&d.datepicker._lastInput==a[0])d.datepicker._hideDatepicker();else{d.datepicker._datepickerShowing&&d.datepicker._lastInput!=a[0]&&d.datepicker._hideDatepicker();d.datepicker._showDatepicker(a[0])}return false})}},
_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b=new Date(2009,11,20),c=this._get(a,"dateFormat");if(c.match(/[DM]/)){var d=function(a){for(var b=0,c=0,d=0;d<a.length;d++)a[d].length>b&&(b=a[d].length,c=d);return c};b.setMonth(d(this._get(a,c.match(/MM/)?"monthNames":"monthNamesShort")));b.setDate(d(this._get(a,c.match(/DD/)?"dayNames":"dayNamesShort"))+20-b.getDay())}a.input.attr("size",this._formatDate(a,b).length)}},_inlineDatepicker:function(a,b){var c=d(a);c.hasClass(this.markerClassName)||
(c.addClass(this.markerClassName).append(b.dpDiv).bind("setData.datepicker",function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),d.data(a,"datepicker",b),this._setDate(b,this._getDefaultDate(b),!0),this._updateDatepicker(b),this._updateAlternate(b),b.settings.disabled&&this._disableDatepicker(a),b.dpDiv.css("display","block"))},_dialogDatepicker:function(a,b,c,e,f){a=this._dialogInst;a||(this.uuid+=1,this._dialogInput=d('<input type="text" id="dp'+this.uuid+
'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),d("body").append(this._dialogInput),a=this._dialogInst=this._newInst(this._dialogInput,!1),a.settings={},d.data(this._dialogInput[0],"datepicker",a));z(a.settings,e||{});b=b&&b.constructor==Date?this._formatDate(a,b):b;this._dialogInput.val(b);this._pos=f?f.length?f:[f.pageX,f.pageY]:null;this._pos||(this._pos=[document.documentElement.clientWidth/2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),
document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)]);this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");a.settings.onSelect=c;this._inDialog=!0;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);d.blockUI&&d.blockUI(this.dpDiv);d.data(this._dialogInput[0],"datepicker",a);return this},_destroyDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=
a.nodeName.toLowerCase();d.removeData(a,"datepicker");"input"==e?(c.append.remove(),c.trigger.remove(),b.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==e||"span"==e)&&b.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();if("input"==e)a.disabled=
!1,c.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if("div"==e||"span"==e)b=b.children("."+this._inlineClass),b.children().removeClass("ui-state-disabled"),b.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled");this._disabledInputs=d.map(this._disabledInputs,function(b){return b==a?null:b})}},_disableDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=
a.nodeName.toLowerCase();if("input"==e)a.disabled=!0,c.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if("div"==e||"span"==e)b=b.children("."+this._inlineClass),b.children().addClass("ui-state-disabled"),b.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled");this._disabledInputs=d.map(this._disabledInputs,function(b){return b==a?null:b});this._disabledInputs[this._disabledInputs.length]=
a}},_isDisabledDatepicker:function(a){if(!a)return!1;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]==a)return!0;return!1},_getInst:function(a){try{return d.data(a,"datepicker")}catch(b){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(a,b,c){var e=this._getInst(a);if(2==arguments.length&&"string"==typeof b)return"defaults"==b?d.extend({},d.datepicker._defaults):e?"all"==b?d.extend({},e.settings):this._get(e,b):null;var f=b||{};"string"==typeof b&&
(f={},f[b]=c);if(e){this._curInst==e&&this._hideDatepicker();var h=this._getDateDatepicker(a,!0),j=this._getMinMaxDate(e,"min"),g=this._getMinMaxDate(e,"max");z(e.settings,f);null!==j&&(void 0!==f.dateFormat&&void 0===f.minDate)&&(e.settings.minDate=this._formatDate(e,j));null!==g&&(void 0!==f.dateFormat&&void 0===f.maxDate)&&(e.settings.maxDate=this._formatDate(e,g));this._attachments(d(a),e);this._autoSize(e);this._setDate(e,h);this._updateAlternate(e);this._updateDatepicker(e)}},_changeDatepicker:function(a,
b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){(a=this._getInst(a))&&this._updateDatepicker(a)},_setDateDatepicker:function(a,b){var c=this._getInst(a);c&&(this._setDate(c,b),this._updateDatepicker(c),this._updateAlternate(c))},_getDateDatepicker:function(a,b){var c=this._getInst(a);c&&!c.inline&&this._setDateFromField(c,b);return c?this._getDate(c):null},_doKeyDown:function(a){var b=d.datepicker._getInst(a.target),c=!0,e=b.dpDiv.is(".ui-datepicker-rtl");b._keyEvent=!0;if(d.datepicker._datepickerShowing)switch(a.keyCode){case 9:d.datepicker._hideDatepicker();
c=!1;break;case 13:return c=d("td."+d.datepicker._dayOverClass+":not(."+d.datepicker._currentClass+")",b.dpDiv),c[0]&&d.datepicker._selectDay(a.target,b.selectedMonth,b.selectedYear,c[0]),(a=d.datepicker._get(b,"onSelect"))?(c=d.datepicker._formatDate(b),a.apply(b.input?b.input[0]:null,[c,b])):d.datepicker._hideDatepicker(),!1;case 27:d.datepicker._hideDatepicker();break;case 33:d.datepicker._adjustDate(a.target,a.ctrlKey?-d.datepicker._get(b,"stepBigMonths"):-d.datepicker._get(b,"stepMonths"),"M");
break;case 34:d.datepicker._adjustDate(a.target,a.ctrlKey?+d.datepicker._get(b,"stepBigMonths"):+d.datepicker._get(b,"stepMonths"),"M");break;case 35:(a.ctrlKey||a.metaKey)&&d.datepicker._clearDate(a.target);c=a.ctrlKey||a.metaKey;break;case 36:(a.ctrlKey||a.metaKey)&&d.datepicker._gotoToday(a.target);c=a.ctrlKey||a.metaKey;break;case 37:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,e?1:-1,"D");c=a.ctrlKey||a.metaKey;a.originalEvent.altKey&&d.datepicker._adjustDate(a.target,a.ctrlKey?
-d.datepicker._get(b,"stepBigMonths"):-d.datepicker._get(b,"stepMonths"),"M");break;case 38:(a.ctrlKey||a.metaKey)&&d.datepicker._adjustDate(a.target,-7,"D");c=a.ctrlKey||a.metaKey;break;case 39:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,e?-1:1,"D");c=a.ctrlKey||a.metaKey;a.originalEvent.altKey&&d.datepicker._adjustDate(a.target,a.ctrlKey?+d.datepicker._get(b,"stepBigMonths"):+d.datepicker._get(b,"stepMonths"),"M");break;case 40:(a.ctrlKey||a.metaKey)&&d.datepicker._adjustDate(a.target,
7,"D");c=a.ctrlKey||a.metaKey;break;default:c=!1}else 36==a.keyCode&&a.ctrlKey?d.datepicker._showDatepicker(this):c=!1;c&&(a.preventDefault(),a.stopPropagation())},_doKeyPress:function(a){var b=d.datepicker._getInst(a.target);if(d.datepicker._get(b,"constrainInput")){var b=d.datepicker._possibleChars(d.datepicker._get(b,"dateFormat")),c=String.fromCharCode(void 0==a.charCode?a.keyCode:a.charCode);return a.ctrlKey||a.metaKey||" ">c||!b||-1<b.indexOf(c)}},_doKeyUp:function(a){a=d.datepicker._getInst(a.target);
if(a.input.val()!=a.lastVal)try{if(d.datepicker.parseDate(d.datepicker._get(a,"dateFormat"),a.input?a.input.val():null,d.datepicker._getFormatConfig(a)))d.datepicker._setDateFromField(a),d.datepicker._updateAlternate(a),d.datepicker._updateDatepicker(a)}catch(b){d.datepicker.log(b)}return!0},_showDatepicker:function(a){a=a.target||a;"input"!=a.nodeName.toLowerCase()&&(a=d("input",a.parentNode)[0]);if(!(d.datepicker._isDisabledDatepicker(a)||d.datepicker._lastInput==a)){var b=d.datepicker._getInst(a);
d.datepicker._curInst&&d.datepicker._curInst!=b&&(d.datepicker._curInst.dpDiv.stop(!0,!0),b&&d.datepicker._datepickerShowing&&d.datepicker._hideDatepicker(d.datepicker._curInst.input[0]));var c=d.datepicker._get(b,"beforeShow"),c=c?c.apply(a,[a,b]):{};if(!1!==c){z(b.settings,c);b.lastVal=null;d.datepicker._lastInput=a;d.datepicker._setDateFromField(b);d.datepicker._inDialog&&(a.value="");d.datepicker._pos||(d.datepicker._pos=d.datepicker._findPos(a),d.datepicker._pos[1]+=a.offsetHeight);var e=!1;
d(a).parents().each(function(){e=e|d(this).css("position")=="fixed";return!e});e&&d.browser.opera&&(d.datepicker._pos[0]-=document.documentElement.scrollLeft,d.datepicker._pos[1]-=document.documentElement.scrollTop);c={left:d.datepicker._pos[0],top:d.datepicker._pos[1]};d.datepicker._pos=null;b.dpDiv.empty();b.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});d.datepicker._updateDatepicker(b);c=d.datepicker._checkOffset(b,c,e);b.dpDiv.css({position:d.datepicker._inDialog&&d.blockUI?"static":
e?"fixed":"absolute",display:"none",left:c.left+"px",top:c.top+"px"});if(!b.inline){var c=d.datepicker._get(b,"showAnim"),f=d.datepicker._get(b,"duration"),h=function(){var a=b.dpDiv.find("iframe.ui-datepicker-cover");if(a.length){var c=d.datepicker._getBorders(b.dpDiv);a.css({left:-c[0],top:-c[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()})}};b.dpDiv.zIndex(d(a).zIndex()+1);d.datepicker._datepickerShowing=!0;if(d.effects&&d.effects[c])b.dpDiv.show(c,d.datepicker._get(b,"showOptions"),
f,h);else b.dpDiv[c||"show"](c?f:null,h);(!c||!f)&&h();b.input.is(":visible")&&!b.input.is(":disabled")&&b.input.focus();d.datepicker._curInst=b}}}},_updateDatepicker:function(a){this.maxRows=4;var b=d.datepicker._getBorders(a.dpDiv);D=a;a.dpDiv.empty().append(this._generateHTML(a));this._attachHandlers(a);var c=a.dpDiv.find("iframe.ui-datepicker-cover");c.length&&c.css({left:-b[0],top:-b[1],width:a.dpDiv.outerWidth(),height:a.dpDiv.outerHeight()});a.dpDiv.find("."+this._dayOverClass+" a").mouseover();
b=this._getNumberOfMonths(a);c=b[1];a.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");1<c&&a.dpDiv.addClass("ui-datepicker-multi-"+c).css("width",17*c+"em");a.dpDiv[(1!=b[0]||1!=b[1]?"add":"remove")+"Class"]("ui-datepicker-multi");a.dpDiv[(this._get(a,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");a==d.datepicker._curInst&&(d.datepicker._datepickerShowing&&a.input&&a.input.is(":visible")&&!a.input.is(":disabled")&&a.input[0]!=document.activeElement)&&
a.input.focus();if(a.yearshtml){var e=a.yearshtml;setTimeout(function(){e===a.yearshtml&&a.yearshtml&&a.dpDiv.find("select.ui-datepicker-year:first").replaceWith(a.yearshtml);e=a.yearshtml=null},0)}},_getBorders:function(a){var b=function(a){return{thin:1,medium:2,thick:3}[a]||a};return[parseFloat(b(a.css("border-left-width"))),parseFloat(b(a.css("border-top-width")))]},_checkOffset:function(a,b,c){var e=a.dpDiv.outerWidth(),f=a.dpDiv.outerHeight(),h=a.input?a.input.outerWidth():0,j=a.input?a.input.outerHeight():
0,g=document.documentElement.clientWidth+(c?0:d(document).scrollLeft()),i=document.documentElement.clientHeight+(c?0:d(document).scrollTop());b.left-=this._get(a,"isRTL")?e-h:0;b.left-=c&&b.left==a.input.offset().left?d(document).scrollLeft():0;b.top-=c&&b.top==a.input.offset().top+j?d(document).scrollTop():0;b.left-=Math.min(b.left,b.left+e>g&&g>e?Math.abs(b.left+e-g):0);b.top-=Math.min(b.top,b.top+f>i&&i>f?Math.abs(f+j):0);return b},_findPos:function(a){for(var b=this._getInst(a),b=this._get(b,
"isRTL");a&&("hidden"==a.type||1!=a.nodeType||d.expr.filters.hidden(a));)a=a[b?"previousSibling":"nextSibling"];a=d(a).offset();return[a.left,a.top]},_hideDatepicker:function(a){var b=this._curInst;if(b&&!(a&&b!=d.data(a,"datepicker"))&&this._datepickerShowing){var a=this._get(b,"showAnim"),c=this._get(b,"duration"),e=function(){d.datepicker._tidyDialog(b)};if(d.effects&&d.effects[a])b.dpDiv.hide(a,d.datepicker._get(b,"showOptions"),c,e);else b.dpDiv["slideDown"==a?"slideUp":"fadeIn"==a?"fadeOut":
"hide"](a?c:null,e);a||e();this._datepickerShowing=!1;(a=this._get(b,"onClose"))&&a.apply(b.input?b.input[0]:null,[b.input?b.input.val():"",b]);this._lastInput=null;this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),d.blockUI&&(d.unblockUI(),d("body").append(this.dpDiv)));this._inDialog=!1}},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(a){if(d.datepicker._curInst){var a=d(a.target),b=
d.datepicker._getInst(a[0]);(a[0].id!=d.datepicker._mainDivId&&0==a.parents("#"+d.datepicker._mainDivId).length&&!a.hasClass(d.datepicker.markerClassName)&&!a.closest("."+d.datepicker._triggerClass).length&&d.datepicker._datepickerShowing&&(!d.datepicker._inDialog||!d.blockUI)||a.hasClass(d.datepicker.markerClassName)&&d.datepicker._curInst!=b)&&d.datepicker._hideDatepicker()}},_adjustDate:function(a,b,c){var a=d(a),e=this._getInst(a[0]);this._isDisabledDatepicker(a[0])||(this._adjustInstDate(e,b+
("M"==c?this._get(e,"showCurrentAtPos"):0),c),this._updateDatepicker(e))},_gotoToday:function(a){var a=d(a),b=this._getInst(a[0]);if(this._get(b,"gotoCurrent")&&b.currentDay)b.selectedDay=b.currentDay,b.drawMonth=b.selectedMonth=b.currentMonth,b.drawYear=b.selectedYear=b.currentYear;else{var c=new Date;b.selectedDay=c.getDate();b.drawMonth=b.selectedMonth=c.getMonth();b.drawYear=b.selectedYear=c.getFullYear()}this._notifyChange(b);this._adjustDate(a)},_selectMonthYear:function(a,b,c){var a=d(a),e=
this._getInst(a[0]);e["selected"+("M"==c?"Month":"Year")]=e["draw"+("M"==c?"Month":"Year")]=parseInt(b.options[b.selectedIndex].value,10);this._notifyChange(e);this._adjustDate(a)},_selectDay:function(a,b,c,e){var f=d(a);!d(e).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(f[0])&&(f=this._getInst(f[0]),f.selectedDay=f.currentDay=d("a",e).html(),f.selectedMonth=f.currentMonth=b,f.selectedYear=f.currentYear=c,this._selectDate(a,this._formatDate(f,f.currentDay,f.currentMonth,f.currentYear)))},
_clearDate:function(a){a=d(a);this._getInst(a[0]);this._selectDate(a,"")},_selectDate:function(a,b){var c=d(a),c=this._getInst(c[0]),b=null!=b?b:this._formatDate(c);c.input&&c.input.val(b);this._updateAlternate(c);var e=this._get(c,"onSelect");e?e.apply(c.input?c.input[0]:null,[b,c]):c.input&&c.input.trigger("change");c.inline?this._updateDatepicker(c):(this._hideDatepicker(),this._lastInput=c.input[0],"object"!=typeof c.input[0]&&c.input.focus(),this._lastInput=null)},_updateAlternate:function(a){var b=
this._get(a,"altField");if(b){var c=this._get(a,"altFormat")||this._get(a,"dateFormat"),e=this._getDate(a),f=this.formatDate(c,e,this._getFormatConfig(a));d(b).each(function(){d(this).val(f)})}},noWeekends:function(a){a=a.getDay();return[0<a&&6>a,""]},iso8601Week:function(a){a=new Date(a.getTime());a.setDate(a.getDate()+4-(a.getDay()||7));var b=a.getTime();a.setMonth(0);a.setDate(1);return Math.floor(Math.round((b-a)/864E5)/7)+1},parseDate:function(a,b,c){if(null==a||null==b)throw"Invalid arguments";
b="object"==typeof b?b.toString():b+"";if(""==b)return null;for(var e=(c?c.shortYearCutoff:null)||this._defaults.shortYearCutoff,e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),f=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,h=(c?c.dayNames:null)||this._defaults.dayNames,j=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,g=(c?c.monthNames:null)||this._defaults.monthNames,i=c=-1,p=-1,r=-1,k=!1,m=function(b){(b=y+1<a.length&&a.charAt(y+1)==b)&&y++;return b},l=function(a){var c=
m(a),a=RegExp("^\\d{1,"+("@"==a?14:"!"==a?20:"y"==a&&c?4:"o"==a?3:2)+"}"),a=b.substring(u).match(a);if(!a)throw"Missing number at position "+u;u+=a[0].length;return parseInt(a[0],10)},n=function(a,c,e){var a=d.map(m(a)?e:c,function(a,b){return[[b,a]]}).sort(function(a,b){return-(a[1].length-b[1].length)}),f=-1;d.each(a,function(a,c){var d=c[1];if(b.substr(u,d.length).toLowerCase()==d.toLowerCase())return f=c[0],u+=d.length,!1});if(-1!=f)return f+1;throw"Unknown name at position "+u;},s=function(){if(b.charAt(u)!=
a.charAt(y))throw"Unexpected literal at position "+u;u++},u=0,y=0;y<a.length;y++)if(k)"'"==a.charAt(y)&&!m("'")?k=!1:s();else switch(a.charAt(y)){case "d":p=l("d");break;case "D":n("D",f,h);break;case "o":r=l("o");break;case "m":i=l("m");break;case "M":i=n("M",j,g);break;case "y":c=l("y");break;case "@":var v=new Date(l("@")),c=v.getFullYear(),i=v.getMonth()+1,p=v.getDate();break;case "!":v=new Date((l("!")-this._ticksTo1970)/1E4);c=v.getFullYear();i=v.getMonth()+1;p=v.getDate();break;case "'":m("'")?
s():k=!0;break;default:s()}if(u<b.length)throw"Extra/unparsed characters found in date: "+b.substring(u);-1==c?c=(new Date).getFullYear():100>c&&(c+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c<=e?0:-100));if(-1<r){i=1;p=r;do{e=this._getDaysInMonth(c,i-1);if(p<=e)break;i++;p-=e}while(1)}v=this._daylightSavingAdjust(new Date(c,i-1,p));if(v.getFullYear()!=c||v.getMonth()+1!=i||v.getDate()!=p)throw"Invalid date";return v},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",
RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864E9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(a,b,c){if(!b)return"";var d=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,h=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,c=(c?c.monthNames:null)||this._defaults.monthNames,j=function(b){(b=r+1<
a.length&&a.charAt(r+1)==b)&&r++;return b},g=function(a,b,c){b=""+b;if(j(a))for(;b.length<c;)b="0"+b;return b},i="",p=!1;if(b)for(var r=0;r<a.length;r++)if(p)"'"==a.charAt(r)&&!j("'")?p=!1:i+=a.charAt(r);else switch(a.charAt(r)){case "d":i+=g("d",b.getDate(),2);break;case "D":var k;k=b.getDay();var m=d,l=f;k=j("D")?l[k]:m[k];i+=k;break;case "o":i+=g("o",Math.round(((new Date(b.getFullYear(),b.getMonth(),b.getDate())).getTime()-(new Date(b.getFullYear(),0,0)).getTime())/864E5),3);break;case "m":i+=
g("m",b.getMonth()+1,2);break;case "M":k=b.getMonth();m=h;l=c;k=j("M")?l[k]:m[k];i+=k;break;case "y":i+=j("y")?b.getFullYear():(10>b.getYear()%100?"0":"")+b.getYear()%100;break;case "@":i+=b.getTime();break;case "!":i+=1E4*b.getTime()+this._ticksTo1970;break;case "'":j("'")?i+="'":p=!0;break;default:i+=a.charAt(r)}return i},_possibleChars:function(a){for(var b="",c=!1,d=function(b){(b=f+1<a.length&&a.charAt(f+1)==b)&&f++;return b},f=0;f<a.length;f++)if(c)"'"==a.charAt(f)&&!d("'")?c=!1:b+=a.charAt(f);
else switch(a.charAt(f)){case "d":case "m":case "y":case "@":b+="0123456789";break;case "D":case "M":return null;case "'":d("'")?b+="'":c=!0;break;default:b+=a.charAt(f)}return b},_get:function(a,b){return void 0!==a.settings[b]?a.settings[b]:this._defaults[b]},_setDateFromField:function(a,b){if(a.input.val()!=a.lastVal){var c=this._get(a,"dateFormat"),d=a.lastVal=a.input?a.input.val():null,f,h;f=h=this._getDefaultDate(a);var j=this._getFormatConfig(a);try{f=this.parseDate(c,d,j)||h}catch(g){this.log(g),
d=b?"":d}a.selectedDay=f.getDate();a.drawMonth=a.selectedMonth=f.getMonth();a.drawYear=a.selectedYear=f.getFullYear();a.currentDay=d?f.getDate():0;a.currentMonth=d?f.getMonth():0;a.currentYear=d?f.getFullYear():0;this._adjustInstDate(a)}},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(a,b,c){if(null==b||""===b)b=c;else{var e;if("string"==typeof b)a:{try{e=d.datepicker.parseDate(d.datepicker._get(a,"dateFormat"),
b,d.datepicker._getFormatConfig(a));break a}catch(f){}var h=(b.toLowerCase().match(/^c/)?d.datepicker._getDate(a):null)||new Date,a=h.getFullYear();e=h.getMonth();for(var h=h.getDate(),j=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,g=j.exec(b);g;){switch(g[2]||"d"){case "d":case "D":h+=parseInt(g[1],10);break;case "w":case "W":h+=7*parseInt(g[1],10);break;case "m":case "M":e+=parseInt(g[1],10);h=Math.min(h,d.datepicker._getDaysInMonth(a,e));break;case "y":case "Y":a+=parseInt(g[1],10),h=Math.min(h,d.datepicker._getDaysInMonth(a,
e))}g=j.exec(b)}e=new Date(a,e,h)}else"number"==typeof b?isNaN(b)?b=c:(a=new Date,a.setDate(a.getDate()+b),b=a):b=new Date(b.getTime()),e=b;b=e}if(b=b&&"Invalid Date"==b.toString()?c:b)b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0);return this._daylightSavingAdjust(b)},_daylightSavingAdjust:function(a){if(!a)return null;a.setHours(12<a.getHours()?a.getHours()+2:0);return a},_setDate:function(a,b,c){var d=!b,f=a.selectedMonth,h=a.selectedYear,b=this._restrictMinMax(a,this._determineDate(a,
b,new Date));a.selectedDay=a.currentDay=b.getDate();a.drawMonth=a.selectedMonth=a.currentMonth=b.getMonth();a.drawYear=a.selectedYear=a.currentYear=b.getFullYear();(f!=a.selectedMonth||h!=a.selectedYear)&&!c&&this._notifyChange(a);this._adjustInstDate(a);a.input&&a.input.val(d?"":this._formatDate(a))},_getDate:function(a){return!a.currentYear||a.input&&""==a.input.val()?null:this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay))},_attachHandlers:function(a){var b=this._get(a,
"stepMonths"),c="#"+a.id.replace(/\\\\/g,"\\");a.dpDiv.find("[data-handler]").map(function(){d(this).bind(this.getAttribute("data-event"),{prev:function(){window["DP_jQuery_"+x].datepicker._adjustDate(c,-b,"M")},next:function(){window["DP_jQuery_"+x].datepicker._adjustDate(c,+b,"M")},hide:function(){window["DP_jQuery_"+x].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+x].datepicker._gotoToday(c)},selectDay:function(){window["DP_jQuery_"+x].datepicker._selectDay(c,+this.getAttribute("data-month"),
+this.getAttribute("data-year"),this);return!1},selectMonth:function(){window["DP_jQuery_"+x].datepicker._selectMonthYear(c,this,"M");return!1},selectYear:function(){window["DP_jQuery_"+x].datepicker._selectMonthYear(c,this,"Y");return!1}}[this.getAttribute("data-handler")])})},_generateHTML:function(a){var b=new Date,b=this._daylightSavingAdjust(new Date(b.getFullYear(),b.getMonth(),b.getDate())),c=this._get(a,"isRTL"),e=this._get(a,"showButtonPanel"),f=this._get(a,"hideIfNoPrevNext"),h=this._get(a,
"navigationAsDateFormat"),j=this._getNumberOfMonths(a),g=this._get(a,"showCurrentAtPos"),i=this._get(a,"stepMonths"),p=1!=j[0]||1!=j[1],r=this._daylightSavingAdjust(!a.currentDay?new Date(9999,9,9):new Date(a.currentYear,a.currentMonth,a.currentDay)),k=this._getMinMaxDate(a,"min"),m=this._getMinMaxDate(a,"max"),g=a.drawMonth-g,l=a.drawYear;0>g&&(g+=12,l--);if(m)for(var n=this._daylightSavingAdjust(new Date(m.getFullYear(),m.getMonth()-j[0]*j[1]+1,m.getDate())),n=k&&n<k?k:n;this._daylightSavingAdjust(new Date(l,
g,1))>n;)g--,0>g&&(g=11,l--);a.drawMonth=g;a.drawYear=l;var n=this._get(a,"prevText"),n=!h?n:this.formatDate(n,this._daylightSavingAdjust(new Date(l,g-i,1)),this._getFormatConfig(a)),n=this._canAdjustMonth(a,-1,l,g)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+n+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+n+"</span></a>":f?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+n+'"><span class="ui-icon ui-icon-circle-triangle-'+
(c?"e":"w")+'">'+n+"</span></a>",s=this._get(a,"nextText"),s=!h?s:this.formatDate(s,this._daylightSavingAdjust(new Date(l,g+i,1)),this._getFormatConfig(a)),f=this._canAdjustMonth(a,1,l,g)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>":f?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":
"e")+'">'+s+"</span></a>",i=this._get(a,"currentText"),s=this._get(a,"gotoCurrent")&&a.currentDay?r:b,i=!h?i:this.formatDate(i,s,this._getFormatConfig(a)),h=!a.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(a,"closeText")+"</button>":"",e=e?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(c?h:"")+(this._isInRange(a,s)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+
i+"</button>":"")+(c?"":h)+"</div>":"",h=parseInt(this._get(a,"firstDay"),10),h=isNaN(h)?0:h,i=this._get(a,"showWeek"),s=this._get(a,"dayNames");this._get(a,"dayNamesShort");var u=this._get(a,"dayNamesMin"),y=this._get(a,"monthNames"),v=this._get(a,"monthNamesShort"),x=this._get(a,"beforeShowDay"),z=this._get(a,"showOtherMonths"),D=this._get(a,"selectOtherMonths");this._get(a,"calculateWeek");for(var B=this._getDefaultDate(a),E="",F=0;F<j[0];F++){var I="";this.maxRows=4;for(var G=0;G<j[1];G++){var C=
this._daylightSavingAdjust(new Date(l,g,a.selectedDay)),t=" ui-corner-all",q="";if(p){q+='<div class="ui-datepicker-group';if(1<j[1])switch(G){case 0:q+=" ui-datepicker-group-first";t=" ui-corner-"+(c?"right":"left");break;case j[1]-1:q+=" ui-datepicker-group-last";t=" ui-corner-"+(c?"left":"right");break;default:q+=" ui-datepicker-group-middle",t=""}q+='">'}for(var q=q+('<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+t+'">'+(/all|left/.test(t)&&0==F?c?f:n:"")+(/all|right/.test(t)&&
0==F?c?n:f:"")+this._generateMonthYearHeader(a,g,l,k,m,0<F||0<G,y,v)+'</div><table class="ui-datepicker-calendar"><thead><tr>'),w=i?'<th class="ui-datepicker-week-col">'+this._get(a,"weekHeader")+"</th>":"",t=0;7>t;t++)var o=(t+h)%7,w=w+("<th"+(5<=(t+h+6)%7?' class="ui-datepicker-week-end"':"")+'><span title="'+s[o]+'">'+u[o]+"</span></th>");q+=w+"</tr></thead><tbody>";w=this._getDaysInMonth(l,g);l==a.selectedYear&&g==a.selectedMonth&&(a.selectedDay=Math.min(a.selectedDay,w));t=(this._getFirstDayOfMonth(l,
g)-h+7)%7;w=Math.ceil((t+w)/7);this.maxRows=w=p?this.maxRows>w?this.maxRows:w:w;for(var o=this._daylightSavingAdjust(new Date(l,g,1-t)),L=0;L<w;L++){for(var q=q+"<tr>",J=!i?"":'<td class="ui-datepicker-week-col">'+this._get(a,"calculateWeek")(o)+"</td>",t=0;7>t;t++){var H=x?x.apply(a.input?a.input[0]:null,[o]):[!0,""],A=o.getMonth()!=g,K=A&&!D||!H[0]||k&&o<k||m&&o>m,J=J+('<td class="'+(5<=(t+h+6)%7?" ui-datepicker-week-end":"")+(A?" ui-datepicker-other-month":"")+(o.getTime()==C.getTime()&&g==a.selectedMonth&&
a._keyEvent||B.getTime()==o.getTime()&&B.getTime()==C.getTime()?" "+this._dayOverClass:"")+(K?" "+this._unselectableClass+" ui-state-disabled":"")+(A&&!z?"":" "+H[1]+(o.getTime()==r.getTime()?" "+this._currentClass:"")+(o.getTime()==b.getTime()?" ui-datepicker-today":""))+'"'+((!A||z)&&H[2]?' title="'+H[2]+'"':"")+(K?"":' data-handler="selectDay" data-event="click" data-month="'+o.getMonth()+'" data-year="'+o.getFullYear()+'"')+">"+(A&&!z?"&#xa0;":K?'<span class="ui-state-default">'+o.getDate()+"</span>":
'<a class="ui-state-default'+(o.getTime()==b.getTime()?" ui-state-highlight":"")+(o.getTime()==r.getTime()?" ui-state-active":"")+(A?" ui-priority-secondary":"")+'" href="#">'+o.getDate()+"</a>")+"</td>");o.setDate(o.getDate()+1);o=this._daylightSavingAdjust(o)}q+=J+"</tr>"}g++;11<g&&(g=0,l++);q+="</tbody></table>"+(p?"</div>"+(0<j[0]&&G==j[1]-1?'<div class="ui-datepicker-row-break"></div>':""):"");I+=q}E+=I}E+=e+(d.browser.msie&&7>parseInt(d.browser.version,10)&&!a.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':
"");a._keyEvent=!1;return E},_generateMonthYearHeader:function(a,b,c,d,f,h,j,g){var i=this._get(a,"changeMonth"),p=this._get(a,"changeYear"),r=this._get(a,"showMonthAfterYear"),k='<div class="ui-datepicker-title">',m="";if(h||!i)m+='<span class="ui-datepicker-month">'+j[b]+"</span>";else{for(var j=d&&d.getFullYear()==c,l=f&&f.getFullYear()==c,m=m+'<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">',n=0;12>n;n++)if((!j||n>=d.getMonth())&&(!l||n<=f.getMonth()))m+='<option value="'+
n+'"'+(n==b?' selected="selected"':"")+">"+g[n]+"</option>";m+="</select>"}r||(k+=m+(h||!i||!p?"&#xa0;":""));if(!a.yearshtml)if(a.yearshtml="",h||!p)k+='<span class="ui-datepicker-year">'+c+"</span>";else{var g=this._get(a,"yearRange").split(":"),s=(new Date).getFullYear(),j=function(a){a=a.match(/c[+-].*/)?c+parseInt(a.substring(1),10):a.match(/[+-].*/)?s+parseInt(a,10):parseInt(a,10);return isNaN(a)?s:a},b=j(g[0]),g=Math.max(b,j(g[1]||"")),b=d?Math.max(b,d.getFullYear()):b,g=f?Math.min(g,f.getFullYear()):
g;for(a.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';b<=g;b++)a.yearshtml+='<option value="'+b+'"'+(b==c?' selected="selected"':"")+">"+b+"</option>";a.yearshtml+="</select>";k+=a.yearshtml;a.yearshtml=null}k+=this._get(a,"yearSuffix");r&&(k+=(h||!i||!p?"&#xa0;":"")+m);return k+"</div>"},_adjustInstDate:function(a,b,c){var d=a.drawYear+("Y"==c?b:0),f=a.drawMonth+("M"==c?b:0),b=Math.min(a.selectedDay,this._getDaysInMonth(d,f))+("D"==c?b:0),d=this._restrictMinMax(a,
this._daylightSavingAdjust(new Date(d,f,b)));a.selectedDay=d.getDate();a.drawMonth=a.selectedMonth=d.getMonth();a.drawYear=a.selectedYear=d.getFullYear();("M"==c||"Y"==c)&&this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max"),c=c&&b<c?c:b;return d&&c>d?d:c},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");b&&b.apply(a.input?a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){a=this._get(a,
"numberOfMonths");return null==a?[1,1]:"number"==typeof a?[1,a]:a},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return(new Date(a,b,1)).getDay()},_canAdjustMonth:function(a,b,c,d){var f=this._getNumberOfMonths(a),c=this._daylightSavingAdjust(new Date(c,d+(0>b?b:f[0]*f[1]),1));0>b&&c.setDate(this._getDaysInMonth(c.getFullYear(),
c.getMonth()));return this._isInRange(a,c)},_isInRange:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max");return(!c||b.getTime()>=c.getTime())&&(!d||b.getTime()<=d.getTime())},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff"),b="string"!=typeof b?b:(new Date).getFullYear()%100+parseInt(b,10);return{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,
"monthNames")}},_formatDate:function(a,b,c,d){b||(a.currentDay=a.selectedDay,a.currentMonth=a.selectedMonth,a.currentYear=a.selectedYear);b=b?"object"==typeof b?b:this._daylightSavingAdjust(new Date(d,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),b,this._getFormatConfig(a))}});d.fn.datepicker=function(a){if(!this.length)return this;d.datepicker.initialized||(d(document).mousedown(d.datepicker._checkExternalClick).find("body").append(d.datepicker.dpDiv),
d.datepicker.initialized=!0);var b=Array.prototype.slice.call(arguments,1);return"string"==typeof a&&("isDisabled"==a||"getDate"==a||"widget"==a)||"option"==a&&2==arguments.length&&"string"==typeof arguments[1]?d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this[0]].concat(b)):this.each(function(){typeof a=="string"?d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this].concat(b)):d.datepicker._attachDatepicker(this,a)})};d.datepicker=new B;d.datepicker.initialized=!1;d.datepicker.uuid=
(new Date).getTime();d.datepicker.version="1.8.24";window["DP_jQuery_"+x]=d})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.position.js' */
(function(c){c.ui=c.ui||{};var o=/left|center|right/,p=/top|center|bottom/,q={},r=c.fn.position,s=c.fn.offset;c.fn.position=function(b){if(!b||!b.of)return r.apply(this,arguments);var b=c.extend({},b),a=c(b.of),d=a[0],l=(b.collision||"flip").split(" "),g=b.offset?b.offset.split(" "):[0,0],m,e,f;9===d.nodeType?(m=a.width(),e=a.height(),f={top:0,left:0}):d.setTimeout?(m=a.width(),e=a.height(),f={top:a.scrollTop(),left:a.scrollLeft()}):d.preventDefault?(b.at="left top",m=e=0,f={top:b.of.pageY,left:b.of.pageX}):
(m=a.outerWidth(),e=a.outerHeight(),f=a.offset());c.each(["my","at"],function(){var a=(b[this]||"").split(" ");a.length===1&&(a=o.test(a[0])?a.concat(["center"]):p.test(a[0])?["center"].concat(a):["center","center"]);a[0]=o.test(a[0])?a[0]:"center";a[1]=p.test(a[1])?a[1]:"center";b[this]=a});1===l.length&&(l[1]=l[0]);g[0]=parseInt(g[0],10)||0;1===g.length&&(g[1]=g[0]);g[1]=parseInt(g[1],10)||0;"right"===b.at[0]?f.left+=m:"center"===b.at[0]&&(f.left+=m/2);"bottom"===b.at[1]?f.top+=e:"center"===b.at[1]&&
(f.top+=e/2);f.left+=g[0];f.top+=g[1];return this.each(function(){var a=c(this),d=a.outerWidth(),h=a.outerHeight(),j=parseInt(c.curCSS(this,"marginLeft",true))||0,k=parseInt(c.curCSS(this,"marginTop",true))||0,o=d+j+(parseInt(c.curCSS(this,"marginRight",true))||0),p=h+k+(parseInt(c.curCSS(this,"marginBottom",true))||0),i=c.extend({},f),n;if(b.my[0]==="right")i.left=i.left-d;else if(b.my[0]==="center")i.left=i.left-d/2;if(b.my[1]==="bottom")i.top=i.top-h;else if(b.my[1]==="center")i.top=i.top-h/2;
if(!q.fractions){i.left=Math.round(i.left);i.top=Math.round(i.top)}n={left:i.left-j,top:i.top-k};c.each(["left","top"],function(a,f){if(c.ui.position[l[a]])c.ui.position[l[a]][f](i,{targetWidth:m,targetHeight:e,elemWidth:d,elemHeight:h,collisionPosition:n,collisionWidth:o,collisionHeight:p,offset:g,my:b.my,at:b.at})});c.fn.bgiframe&&a.bgiframe();a.offset(c.extend(i,{using:b.using}))})};c.ui.position={fit:{left:function(b,a){var d=c(window),d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft();
b.left=0<d?b.left-d:Math.max(b.left-a.collisionPosition.left,b.left)},top:function(b,a){var d=c(window),d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop();b.top=0<d?b.top-d:Math.max(b.top-a.collisionPosition.top,b.top)}},flip:{left:function(b,a){if("center"!==a.at[0]){var d=c(window),d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft(),l="left"===a.my[0]?-a.elemWidth:"right"===a.my[0]?a.elemWidth:0,g="left"===a.at[0]?a.targetWidth:-a.targetWidth,e=-2*a.offset[0];
b.left+=0>a.collisionPosition.left?l+g+e:0<d?l+g+e:0}},top:function(b,a){if("center"!==a.at[1]){var d=c(window),d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop(),e="top"===a.my[1]?-a.elemHeight:"bottom"===a.my[1]?a.elemHeight:0,g="top"===a.at[1]?a.targetHeight:-a.targetHeight,h=-2*a.offset[1];b.top+=0>a.collisionPosition.top?e+g+h:0<d?e+g+h:0}}}};c.offset.setOffset||(c.offset.setOffset=function(b,a){/static/.test(c.curCSS(b,"position"))&&(b.style.position="relative");var d=c(b),
e=d.offset(),g=parseInt(c.curCSS(b,"top",!0),10)||0,h=parseInt(c.curCSS(b,"left",!0),10)||0,e={top:a.top-e.top+g,left:a.left-e.left+h};"using"in a?a.using.call(b,e):d.css(e)},c.fn.offset=function(b){var a=this[0];return!a||!a.ownerDocument?null:b?c.isFunction(b)?this.each(function(a){c(this).offset(b.call(this,a,c(this).offset()))}):this.each(function(){c.offset.setOffset(this,b)}):s.call(this)});c.curCSS||(c.curCSS=c.css);var h=document.getElementsByTagName("body")[0],j=document.createElement("div"),
k,e;k=document.createElement(h?"div":"body");e={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};h&&c.extend(e,{position:"absolute",left:"-1000px",top:"-1000px"});for(var n in e)k.style[n]=e[n];k.appendChild(j);e=h||document.documentElement;e.insertBefore(k,e.firstChild);j.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;";j=c(j).offset(function(b,a){return a}).offset();k.innerHTML="";e.removeChild(k);h=j.top+j.left+(h?2E3:
0);q.fractions=21<h&&22>h})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.droppable.js' */
(function(d){d.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var a=this.options,b=a.accept;this.isover=0;this.isout=1;this.accept=d.isFunction(b)?b:function(a){return a.is(b)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};d.ui.ddmanager.droppables[a.scope]=d.ui.ddmanager.droppables[a.scope]||[];d.ui.ddmanager.droppables[a.scope].push(this);
a.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var a=d.ui.ddmanager.droppables[this.options.scope],b=0;b<a.length;b++)a[b]==this&&a.splice(b,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(a,b){"accept"==a&&(this.accept=d.isFunction(b)?b:function(a){return a.is(b)});d.Widget.prototype._setOption.apply(this,arguments)},_activate:function(a){var b=d.ui.ddmanager.current;this.options.activeClass&&
this.element.addClass(this.options.activeClass);b&&this._trigger("activate",a,this.ui(b))},_deactivate:function(a){var b=d.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);b&&this._trigger("deactivate",a,this.ui(b))},_over:function(a){var b=d.ui.ddmanager.current;if(b&&(b.currentItem||b.element)[0]!=this.element[0])if(this.accept.call(this.element[0],b.currentItem||b.element))this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",
a,this.ui(b))},_out:function(a){var b=d.ui.ddmanager.current;if(b&&(b.currentItem||b.element)[0]!=this.element[0])if(this.accept.call(this.element[0],b.currentItem||b.element))this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",a,this.ui(b))},_drop:function(a,b){var c=b||d.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return!1;var f=!1;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var a=d.data(this,
"droppable");if(a.options.greedy&&!a.options.disabled&&a.options.scope==c.options.scope&&a.accept.call(a.element[0],c.currentItem||c.element)&&d.ui.intersect(c,d.extend(a,{offset:a.element.offset()}),a.options.tolerance))return f=!0,!1});return f?!1:this.accept.call(this.element[0],c.currentItem||c.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",a,this.ui(c)),this.element):
!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}});d.extend(d.ui.droppable,{version:"1.8.24"});d.ui.intersect=function(a,b,c){if(!b.offset)return!1;var f=(a.positionAbs||a.position.absolute).left,g=f+a.helperProportions.width,e=(a.positionAbs||a.position.absolute).top,h=e+a.helperProportions.height,i=b.offset.left,k=i+b.proportions.width,j=b.offset.top,l=j+b.proportions.height;switch(c){case "fit":return i<=f&&g<=k&&j<=e&&h<=l;
case "intersect":return i<f+a.helperProportions.width/2&&g-a.helperProportions.width/2<k&&j<e+a.helperProportions.height/2&&h-a.helperProportions.height/2<l;case "pointer":return d.ui.isOver((a.positionAbs||a.position.absolute).top+(a.clickOffset||a.offset.click).top,(a.positionAbs||a.position.absolute).left+(a.clickOffset||a.offset.click).left,j,i,b.proportions.height,b.proportions.width);case "touch":return(e>=j&&e<=l||h>=j&&h<=l||e<j&&h>l)&&(f>=i&&f<=k||g>=i&&g<=k||f<i&&g>k);default:return!1}};
d.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(a,b){var c=d.ui.ddmanager.droppables[a.options.scope]||[],f=b?b.type:null,g=(a.currentItem||a.element).find(":data(droppable)").andSelf(),e=0;a:for(;e<c.length;e++)if(!(c[e].options.disabled||a&&!c[e].accept.call(c[e].element[0],a.currentItem||a.element))){for(var h=0;h<g.length;h++)if(g[h]==c[e].element[0]){c[e].proportions.height=0;continue a}c[e].visible="none"!=c[e].element.css("display");c[e].visible&&("mousedown"==
f&&c[e]._activate.call(c[e],b),c[e].offset=c[e].element.offset(),c[e].proportions={width:c[e].element[0].offsetWidth,height:c[e].element[0].offsetHeight})}},drop:function(a,b){var c=!1;d.each(d.ui.ddmanager.droppables[a.options.scope]||[],function(){if(this.options&&(!this.options.disabled&&(this.visible&&d.ui.intersect(a,this,this.options.tolerance))&&(c=this._drop.call(this,b)||c),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],a.currentItem||a.element)))this.isout=1,this.isover=
0,this._deactivate.call(this,b)});return c},dragStart:function(a,b){a.element.parents(":not(body,html)").bind("scroll.droppable",function(){a.options.refreshPositions||d.ui.ddmanager.prepareOffsets(a,b)})},drag:function(a,b){a.options.refreshPositions&&d.ui.ddmanager.prepareOffsets(a,b);d.each(d.ui.ddmanager.droppables[a.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var c=d.ui.intersect(a,this,this.options.tolerance);if(c=!c&&1==this.isover?"isout":c&&0==
this.isover?"isover":null){var f;if(this.options.greedy){var g=this.options.scope,e=this.element.parents(":data(droppable)").filter(function(){return d.data(this,"droppable").options.scope===g});e.length&&(f=d.data(e[0],"droppable"),f.greedyChild="isover"==c?1:0)}f&&"isover"==c&&(f.isover=0,f.isout=1,f._out.call(f,b));this[c]=1;this["isout"==c?"isover":"isout"]=0;this["isover"==c?"_over":"_out"].call(this,b);f&&"isout"==c&&(f.isout=0,f.isover=1,f._over.call(f,b))}}})},dragStop:function(a,b){a.element.parents(":not(body,html)").unbind("scroll.droppable");
a.options.refreshPositions||d.ui.ddmanager.prepareOffsets(a,b)}}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.resizable.js' */
(function(e){e.widget("ui.resizable",e.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1E3},_create:function(){var b=this,a=this.options;this.element.addClass("ui-resizable");e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],
_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null});this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=
!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,
display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize());this.handles=a.handles||(!e(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var c=this.handles.split(",");this.handles=
{};for(var d=0;d<c.length;d++){var f=e.trim(c[d]),g=e('<div class="ui-resizable-handle ui-resizable-'+f+'"></div>');g.css({zIndex:a.zIndex});"se"==f&&g.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[f]=".ui-resizable-"+f;this.element.append(g)}}this._renderAxis=function(a){var a=a||this.element,b;for(b in this.handles){this.handles[b].constructor==String&&(this.handles[b]=e(this.handles[b],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var c=
e(this.handles[b],this.element),d=0,d=/sw|ne|nw|se|n|s/.test(b)?c.outerHeight():c.outerWidth(),c=["padding",/ne|nw|n/.test(b)?"Top":/se|sw|s/.test(b)?"Bottom":/^e$/.test(b)?"Right":"Left"].join("");a.css(c,d);this._proportionallyResize()}e(this.handles[b])}};this._renderAxis(this.element);this._handles=e(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!b.resizing){if(this.className)var a=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);b.axis=
a&&a[1]?a[1]:"se"}});a.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").hover(function(){if(!a.disabled){e(this).removeClass("ui-resizable-autohide");b._handles.show()}},function(){if(!a.disabled&&!b.resizing){e(this).addClass("ui-resizable-autohide");b._handles.hide()}}));this._mouseInit()},destroy:function(){this._mouseDestroy();var b=function(a){e(a).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};
if(this.elementIsWrapper){b(this.element);var a=this.element;a.after(this.originalElement.css({position:a.css("position"),width:a.outerWidth(),height:a.outerHeight(),top:a.css("top"),left:a.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);b(this.originalElement);return this},_mouseCapture:function(b){var a=!1,c;for(c in this.handles)e(this.handles[c])[0]==b.target&&(a=!0);return!this.options.disabled&&a},_mouseStart:function(b){var a=this.options,c=this.element.position(),
d=this.element;this.resizing=!0;this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()};(d.is(".ui-draggable")||/absolute/.test(d.css("position")))&&d.css({position:"absolute",top:c.top,left:c.left});this._renderProxy();var c=j(this.helper.css("left")),f=j(this.helper.css("top"));a.containment&&(c+=e(a.containment).scrollLeft()||0,f+=e(a.containment).scrollTop()||0);this.offset=this.helper.offset();this.position={left:c,top:f};this.size=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:
{width:d.width(),height:d.height()};this.originalSize=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:{width:d.width(),height:d.height()};this.originalPosition={left:c,top:f};this.sizeDiff={width:d.outerWidth()-d.width(),height:d.outerHeight()-d.height()};this.originalMousePosition={left:b.pageX,top:b.pageY};this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1;a=e(".ui-resizable-"+this.axis).css("cursor");e("body").css("cursor",
"auto"==a?this.axis+"-resize":a);d.addClass("ui-resizable-resizing");this._propagate("start",b);return!0},_mouseDrag:function(b){var a=this.helper,c=this.originalMousePosition,d=this._change[this.axis];if(!d)return!1;c=d.apply(this,[b,b.pageX-c.left||0,b.pageY-c.top||0]);this._updateVirtualBoundaries(b.shiftKey);if(this._aspectRatio||b.shiftKey)c=this._updateRatio(c,b);c=this._respectSize(c,b);this._propagate("resize",b);a.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+
"px",height:this.size.height+"px"});!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();this._updateCache(c);this._trigger("resize",b,this.ui());return!1},_mouseStop:function(b){this.resizing=!1;var a=this.options;if(this._helper){var c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),c=d&&e.ui.hasScroll(c[0],"left")?0:this.sizeDiff.height,d=d?0:this.sizeDiff.width,d={width:this.helper.width()-d,height:this.helper.height()-c},c=parseInt(this.element.css("left"),
10)+(this.position.left-this.originalPosition.left)||null,f=parseInt(this.element.css("top"),10)+(this.position.top-this.originalPosition.top)||null;a.animate||this.element.css(e.extend(d,{top:f,left:c}));this.helper.height(this.size.height);this.helper.width(this.size.width);this._helper&&!a.animate&&this._proportionallyResize()}e("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",b);this._helper&&this.helper.remove();return!1},_updateVirtualBoundaries:function(b){var a=
this.options,c,d,e,a={minWidth:i(a.minWidth)?a.minWidth:0,maxWidth:i(a.maxWidth)?a.maxWidth:Infinity,minHeight:i(a.minHeight)?a.minHeight:0,maxHeight:i(a.maxHeight)?a.maxHeight:Infinity};if(this._aspectRatio||b)if(b=a.minHeight*this.aspectRatio,d=a.minWidth/this.aspectRatio,c=a.maxHeight*this.aspectRatio,e=a.maxWidth/this.aspectRatio,b>a.minWidth&&(a.minWidth=b),d>a.minHeight&&(a.minHeight=d),c<a.maxWidth&&(a.maxWidth=c),e<a.maxHeight)a.maxHeight=e;this._vBoundaries=a},_updateCache:function(b){this.offset=
this.helper.offset();i(b.left)&&(this.position.left=b.left);i(b.top)&&(this.position.top=b.top);i(b.height)&&(this.size.height=b.height);i(b.width)&&(this.size.width=b.width)},_updateRatio:function(b){var a=this.position,c=this.size,d=this.axis;i(b.height)?b.width=b.height*this.aspectRatio:i(b.width)&&(b.height=b.width/this.aspectRatio);"sw"==d&&(b.left=a.left+(c.width-b.width),b.top=null);"nw"==d&&(b.top=a.top+(c.height-b.height),b.left=a.left+(c.width-b.width));return b},_respectSize:function(b){var a=
this._vBoundaries,c=this.axis,d=i(b.width)&&a.maxWidth&&a.maxWidth<b.width,e=i(b.height)&&a.maxHeight&&a.maxHeight<b.height,g=i(b.width)&&a.minWidth&&a.minWidth>b.width,h=i(b.height)&&a.minHeight&&a.minHeight>b.height;g&&(b.width=a.minWidth);h&&(b.height=a.minHeight);d&&(b.width=a.maxWidth);e&&(b.height=a.maxHeight);var k=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,m=/sw|nw|w/.test(c),c=/nw|ne|n/.test(c);g&&m&&(b.left=k-a.minWidth);d&&m&&(b.left=k-a.maxWidth);
h&&c&&(b.top=l-a.minHeight);e&&c&&(b.top=l-a.maxHeight);(a=!b.width&&!b.height)&&!b.left&&b.top?b.top=null:a&&(!b.top&&b.left)&&(b.left=null);return b},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var b=this.helper||this.element,a=0;a<this._proportionallyResizeElements.length;a++){var c=this._proportionallyResizeElements[a];if(!this.borderDif){var d=[c.css("borderTopWidth"),c.css("borderRightWidth"),c.css("borderBottomWidth"),c.css("borderLeftWidth")],f=[c.css("paddingTop"),
c.css("paddingRight"),c.css("paddingBottom"),c.css("paddingLeft")];this.borderDif=e.map(d,function(a,b){var c=parseInt(a,10)||0,d=parseInt(f[b],10)||0;return c+d})}if(!e.browser.msie||!e(b).is(":hidden")&&!e(b).parents(":hidden").length)c.css({height:b.height()-this.borderDif[0]-this.borderDif[2]||0,width:b.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var b=this.options;this.elementOffset=this.element.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');
var a=e.browser.msie&&7>e.browser.version,c=a?1:0,a=a?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+a,height:this.element.outerHeight()+a,position:"absolute",left:this.elementOffset.left-c+"px",top:this.elementOffset.top-c+"px",zIndex:++b.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(b,a){return{width:this.originalSize.width+a}},w:function(b,a){return{left:this.originalPosition.left+a,width:this.originalSize.width-
a}},n:function(b,a,c){return{top:this.originalPosition.top+c,height:this.originalSize.height-c}},s:function(b,a,c){return{height:this.originalSize.height+c}},se:function(b,a,c){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,a,c]))},sw:function(b,a,c){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,a,c]))},ne:function(b,a,c){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,a,c]))},nw:function(b,a,
c){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,a,c]))}},_propagate:function(b,a){e.ui.plugin.call(this,b,[a,this.ui()]);"resize"!=b&&this._trigger(b,a,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});e.extend(e.ui.resizable,{version:"1.8.24"});e.ui.plugin.add("resizable","alsoResize",
{start:function(){var b=e(this).data("resizable").options,a=function(a){e(a).each(function(){var a=e(this);a.data("resizable-alsoresize",{width:parseInt(a.width(),10),height:parseInt(a.height(),10),left:parseInt(a.css("left"),10),top:parseInt(a.css("top"),10)})})};"object"==typeof b.alsoResize&&!b.alsoResize.parentNode?b.alsoResize.length?(b.alsoResize=b.alsoResize[0],a(b.alsoResize)):e.each(b.alsoResize,function(b){a(b)}):a(b.alsoResize)},resize:function(b,a){var c=e(this).data("resizable"),d=c.options,
f=c.originalSize,g=c.originalPosition,h={height:c.size.height-f.height||0,width:c.size.width-f.width||0,top:c.position.top-g.top||0,left:c.position.left-g.left||0},i=function(b,c){e(b).each(function(){var b=e(this),d=e(this).data("resizable-alsoresize"),f={},g=c&&c.length?c:b.parents(a.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(g,function(a,b){var c=(d[b]||0)+(h[b]||0);c&&0<=c&&(f[b]=c||null)});b.css(f)})};"object"==typeof d.alsoResize&&!d.alsoResize.nodeType?
e.each(d.alsoResize,function(a,b){i(a,b)}):i(d.alsoResize)},stop:function(){e(this).removeData("resizable-alsoresize")}});e.ui.plugin.add("resizable","animate",{stop:function(b){var a=e(this).data("resizable"),c=a.options,d=a._proportionallyResizeElements,f=d.length&&/textarea/i.test(d[0].nodeName),g=f&&e.ui.hasScroll(d[0],"left")?0:a.sizeDiff.height,f={width:a.size.width-(f?0:a.sizeDiff.width),height:a.size.height-g},g=parseInt(a.element.css("left"),10)+(a.position.left-a.originalPosition.left)||
null,h=parseInt(a.element.css("top"),10)+(a.position.top-a.originalPosition.top)||null;a.element.animate(e.extend(f,h&&g?{top:h,left:g}:{}),{duration:c.animateDuration,easing:c.animateEasing,step:function(){var c={width:parseInt(a.element.css("width"),10),height:parseInt(a.element.css("height"),10),top:parseInt(a.element.css("top"),10),left:parseInt(a.element.css("left"),10)};d&&d.length&&e(d[0]).css({width:c.width,height:c.height});a._updateCache(c);a._propagate("resize",b)}})}});e.ui.plugin.add("resizable",
"containment",{start:function(){var b=e(this).data("resizable"),a=b.element,c=b.options.containment;if(a=c instanceof e?c.get(0):/parent/.test(c)?a.parent().get(0):c)if(b.containerElement=e(a),/document/.test(c)||c==document)b.containerOffset={left:0,top:0},b.containerPosition={left:0,top:0},b.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var d=e(a),f=[];e(["Top","Right","Left","Bottom"]).each(function(a,
b){f[a]=j(d.css("padding"+b))});b.containerOffset=d.offset();b.containerPosition=d.position();b.containerSize={height:d.innerHeight()-f[3],width:d.innerWidth()-f[1]};var c=b.containerOffset,g=b.containerSize.height,h=b.containerSize.width,h=e.ui.hasScroll(a,"left")?a.scrollWidth:h,g=e.ui.hasScroll(a)?a.scrollHeight:g;b.parentData={element:a,left:c.left,top:c.top,width:h,height:g}}},resize:function(b){var a=e(this).data("resizable"),c=a.options,d=a.containerOffset,f=a.position,b=a._aspectRatio||b.shiftKey,
g={top:0,left:0},h=a.containerElement;h[0]!=document&&/static/.test(h.css("position"))&&(g=d);if(f.left<(a._helper?d.left:0))a.size.width+=a._helper?a.position.left-d.left:a.position.left-g.left,b&&(a.size.height=a.size.width/a.aspectRatio),a.position.left=c.helper?d.left:0;if(f.top<(a._helper?d.top:0))a.size.height+=a._helper?a.position.top-d.top:a.position.top,b&&(a.size.width=a.size.height*a.aspectRatio),a.position.top=a._helper?d.top:0;a.offset.left=a.parentData.left+a.position.left;a.offset.top=
a.parentData.top+a.position.top;c=Math.abs(a.offset.left-g.left+a.sizeDiff.width);d=Math.abs((a._helper?a.offset.top-g.top:a.offset.top-d.top)+a.sizeDiff.height);f=a.containerElement.get(0)==a.element.parent().get(0);g=/relative|absolute/.test(a.containerElement.css("position"));f&&g&&(c-=a.parentData.left);c+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-c,b&&(a.size.height=a.size.width/a.aspectRatio));d+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-d,
b&&(a.size.width=a.size.height*a.aspectRatio))},stop:function(){var b=e(this).data("resizable"),a=b.options,c=b.containerOffset,d=b.containerPosition,f=b.containerElement,g=e(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,g=g.outerHeight()-b.sizeDiff.height;b._helper&&(!a.animate&&/relative/.test(f.css("position")))&&e(this).css({left:h.left-d.left-c.left,width:i,height:g});b._helper&&(!a.animate&&/static/.test(f.css("position")))&&e(this).css({left:h.left-d.left-c.left,width:i,height:g})}});
e.ui.plugin.add("resizable","ghost",{start:function(){var b=e(this).data("resizable"),a=b.options,c=b.size;b.ghost=b.originalElement.clone();b.ghost.css({opacity:0.25,display:"block",position:"relative",height:c.height,width:c.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof a.ghost?a.ghost:"");b.ghost.appendTo(b.helper)},resize:function(){var b=e(this).data("resizable");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=
e(this).data("resizable");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}});e.ui.plugin.add("resizable","grid",{resize:function(){var b=e(this).data("resizable"),a=b.options,c=b.size,d=b.originalSize,f=b.originalPosition,g=b.axis;a.grid="number"==typeof a.grid?[a.grid,a.grid]:a.grid;var h=Math.round((c.width-d.width)/(a.grid[0]||1))*(a.grid[0]||1),a=Math.round((c.height-d.height)/(a.grid[1]||1))*(a.grid[1]||1);/^(se|s|e)$/.test(g)?(b.size.width=d.width+h,b.size.height=d.height+a):
/^(ne)$/.test(g)?(b.size.width=d.width+h,b.size.height=d.height+a,b.position.top=f.top-a):(/^(sw)$/.test(g)?(b.size.width=d.width+h,b.size.height=d.height+a):(b.size.width=d.width+h,b.size.height=d.height+a,b.position.top=f.top-a),b.position.left=f.left-h)}});var j=function(b){return parseInt(b,10)||0},i=function(b){return!isNaN(parseInt(b,10))}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.selectable.js' */
(function(e){e.widget("ui.selectable",e.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var b=this;this.element.addClass("ui-selectable");this.dragged=!1;var f;this.refresh=function(){f=e(b.options.filter,b.element[0]);f.addClass("ui-selectee");f.each(function(){var b=e(this),c=b.offset();e.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,
selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})};this.refresh();this.selectees=f.addClass("ui-selectee");this._mouseInit();this.helper=e("<div class='ui-selectable-helper'></div>")},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this},_mouseStart:function(b){var f=
this;this.opos=[b.pageX,b.pageY];if(!this.options.disabled){var d=this.options;this.selectees=e(d.filter,this.element[0]);this._trigger("start",b);e(d.appendTo).append(this.helper);this.helper.css({left:b.clientX,top:b.clientY,width:0,height:0});d.autoRefresh&&this.refresh();this.selectees.filter(".ui-selected").each(function(){var c=e.data(this,"selectable-item");c.startselected=!0;!b.metaKey&&!b.ctrlKey&&(c.$element.removeClass("ui-selected"),c.selected=!1,c.$element.addClass("ui-unselecting"),
c.unselecting=!0,f._trigger("unselecting",b,{unselecting:c.element}))});e(b.target).parents().andSelf().each(function(){var c=e.data(this,"selectable-item");if(c){var d=!b.metaKey&&!b.ctrlKey||!c.$element.hasClass("ui-selected");c.$element.removeClass(d?"ui-unselecting":"ui-selected").addClass(d?"ui-selecting":"ui-unselecting");c.unselecting=!d;c.selecting=d;(c.selected=d)?f._trigger("selecting",b,{selecting:c.element}):f._trigger("unselecting",b,{unselecting:c.element});return!1}})}},_mouseDrag:function(b){var f=
this;this.dragged=!0;if(!this.options.disabled){var d=this.options,c=this.opos[0],g=this.opos[1],i=b.pageX,j=b.pageY;if(c>i)var h=i,i=c,c=h;g>j&&(h=j,j=g,g=h);this.helper.css({left:c,top:g,width:i-c,height:j-g});this.selectees.each(function(){var a=e.data(this,"selectable-item");if(a&&a.element!=f.element[0]){var h=false;d.tolerance=="touch"?h=!(a.left>i||a.right<c||a.top>j||a.bottom<g):d.tolerance=="fit"&&(h=a.left>c&&a.right<i&&a.top>g&&a.bottom<j);if(h){if(a.selected){a.$element.removeClass("ui-selected");
a.selected=false}if(a.unselecting){a.$element.removeClass("ui-unselecting");a.unselecting=false}if(!a.selecting){a.$element.addClass("ui-selecting");a.selecting=true;f._trigger("selecting",b,{selecting:a.element})}}else{if(a.selecting)if((b.metaKey||b.ctrlKey)&&a.startselected){a.$element.removeClass("ui-selecting");a.selecting=false;a.$element.addClass("ui-selected");a.selected=true}else{a.$element.removeClass("ui-selecting");a.selecting=false;if(a.startselected){a.$element.addClass("ui-unselecting");
a.unselecting=true}f._trigger("unselecting",b,{unselecting:a.element})}if(a.selected&&!b.metaKey&&!b.ctrlKey&&!a.startselected){a.$element.removeClass("ui-selected");a.selected=false;a.$element.addClass("ui-unselecting");a.unselecting=true;f._trigger("unselecting",b,{unselecting:a.element})}}}});return!1}},_mouseStop:function(b){var f=this;this.dragged=!1;e(".ui-unselecting",this.element[0]).each(function(){var d=e.data(this,"selectable-item");d.$element.removeClass("ui-unselecting");d.unselecting=
!1;d.startselected=!1;f._trigger("unselected",b,{unselected:d.element})});e(".ui-selecting",this.element[0]).each(function(){var d=e.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected");d.selecting=!1;d.selected=!0;d.startselected=!0;f._trigger("selected",b,{selected:d.element})});this._trigger("stop",b);this.helper.remove();return!1}});e.extend(e.ui.selectable,{version:"1.8.24"})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.accordion.js' */
(function(d){d.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:!0,clearStyle:!1,collapsible:!1,event:"click",fillSpace:!1,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var a=this,b=a.options;a.running=0;a.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");
a.headers=a.element.find(b.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){b.disabled||d(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){b.disabled||d(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){b.disabled||d(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){b.disabled||d(this).removeClass("ui-state-focus")});a.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");
if(b.navigation){var c=a.element.find("a").filter(b.navigationFilter).eq(0);if(c.length){var f=c.closest(".ui-accordion-header");a.active=f.length?f:c.closest(".ui-accordion-content").prev()}}a.active=a._findActive(a.active||b.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");a.active.next().addClass("ui-accordion-content-active");a._createIcons();a.resize();a.element.attr("role","tablist");a.headers.attr("role","tab").bind("keydown.accordion",
function(b){return a._keydown(b)}).next().attr("role","tabpanel");a.headers.not(a.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();a.active.length?a.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):a.headers.eq(0).attr("tabIndex",0);d.browser.safari||a.headers.find("a").attr("tabIndex",-1);b.event&&a.headers.bind(b.event.split(" ").join(".accordion ")+".accordion",function(b){a._clickHandler.call(a,b,this);b.preventDefault()})},_createIcons:function(){var a=
this.options;a.icons&&(d("<span></span>").addClass("ui-icon "+a.icons.header).prependTo(this.headers),this.active.children(".ui-icon").toggleClass(a.icons.header).toggleClass(a.icons.headerSelected),this.element.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons")},destroy:function(){var a=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex");
this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var b=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");(a.autoHeight||a.fillHeight)&&b.css("height","");return d.Widget.prototype.destroy.call(this)},_setOption:function(a,b){d.Widget.prototype._setOption.apply(this,arguments);"active"==a&&this.activate(b);"icons"==a&&(this._destroyIcons(),
b&&this._createIcons());if("disabled"==a)this.headers.add(this.headers.next())[b?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(a){if(!this.options.disabled&&!a.altKey&&!a.ctrlKey){var b=d.ui.keyCode,c=this.headers.length,f=this.headers.index(a.target),g=!1;switch(a.keyCode){case b.RIGHT:case b.DOWN:g=this.headers[(f+1)%c];break;case b.LEFT:case b.UP:g=this.headers[(f-1+c)%c];break;case b.SPACE:case b.ENTER:this._clickHandler({target:a.target},a.target),a.preventDefault()}return g?
(d(a.target).attr("tabIndex",-1),d(g).attr("tabIndex",0),g.focus(),!1):!0}},resize:function(){var a=this.options,b;if(a.fillSpace){if(d.browser.msie){var c=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}b=this.element.parent().height();d.browser.msie&&this.element.parent().css("overflow",c);this.headers.each(function(){b-=d(this).outerHeight(!0)});this.headers.next().each(function(){d(this).height(Math.max(0,b-d(this).innerHeight()+d(this).height()))}).css("overflow",
"auto")}else a.autoHeight&&(b=0,this.headers.next().each(function(){b=Math.max(b,d(this).height("").height())}).height(b));return this},activate:function(a){this.options.active=a;a=this._findActive(a)[0];this._clickHandler({target:a},a);return this},_findActive:function(a){return a?"number"===typeof a?this.headers.filter(":eq("+a+")"):this.headers.not(this.headers.not(a)):!1===a?d([]):this.headers.filter(":eq(0)")},_clickHandler:function(a,b){var c=this.options;if(!c.disabled)if(a.target){var f=d(a.currentTarget||
b),g=f[0]===this.active[0];c.active=c.collapsible&&g?!1:this.headers.index(f);if(!(this.running||!c.collapsible&&g)){var i=this.active,e=f.next(),h=this.active.next(),k={options:c,newHeader:g&&c.collapsible?d([]):f,oldHeader:this.active,newContent:g&&c.collapsible?d([]):e,oldContent:h},j=this.headers.index(this.active[0])>this.headers.index(f[0]);this.active=g?d([]):f;this._toggle(e,h,k,g,j);i.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(c.icons.headerSelected).addClass(c.icons.header);
g||(f.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(c.icons.header).addClass(c.icons.headerSelected),f.next().addClass("ui-accordion-content-active"))}}else if(c.collapsible){this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(c.icons.headerSelected).addClass(c.icons.header);this.active.next().addClass("ui-accordion-content-active");var h=this.active.next(),
k={options:c,newHeader:d([]),oldHeader:c.active,newContent:d([]),oldContent:h},e=this.active=d([]);this._toggle(e,h,k)}},_toggle:function(a,b,c,f,g){var i=this,e=i.options;i.toShow=a;i.toHide=b;i.data=c;var h=function(){if(i)return i._completed.apply(i,arguments)};i._trigger("changestart",null,i.data);i.running=0===b.size()?a.size():b.size();if(e.animated){c={};c=e.collapsible&&f?{toShow:d([]),toHide:b,complete:h,down:g,autoHeight:e.autoHeight||e.fillSpace}:{toShow:a,toHide:b,complete:h,down:g,autoHeight:e.autoHeight||
e.fillSpace};e.proxied||(e.proxied=e.animated);e.proxiedDuration||(e.proxiedDuration=e.duration);e.animated=d.isFunction(e.proxied)?e.proxied(c):e.proxied;e.duration=d.isFunction(e.proxiedDuration)?e.proxiedDuration(c):e.proxiedDuration;var f=d.ui.accordion.animations,k=e.duration,j=e.animated;j&&(!f[j]&&!d.easing[j])&&(j="slide");f[j]||(f[j]=function(a){this.slide(a,{easing:j,duration:k||700})});f[j](c)}else e.collapsible&&f?a.toggle():(b.hide(),a.show()),h(!0);b.prev().attr({"aria-expanded":"false",
"aria-selected":"false",tabIndex:-1}).blur();a.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(a){this.running=a?0:--this.running;this.running||(this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""}),this.toHide.removeClass("ui-accordion-content-active"),this.toHide.length&&(this.toHide.parent()[0].className=this.toHide.parent()[0].className),this._trigger("change",null,this.data))}});d.extend(d.ui.accordion,{version:"1.8.24",
animations:{slide:function(a,b){a=d.extend({easing:"swing",duration:300},a,b);if(a.toHide.size())if(a.toShow.size()){var c=a.toShow.css("overflow"),f=0,g={},i={},e,h=a.toShow;e=h[0].style.width;h.width(h.parent().width()-parseFloat(h.css("paddingLeft"))-parseFloat(h.css("paddingRight"))-(parseFloat(h.css("borderLeftWidth"))||0)-(parseFloat(h.css("borderRightWidth"))||0));d.each(["height","paddingTop","paddingBottom"],function(b,c){i[c]="hide";var e=(""+d.css(a.toShow[0],c)).match(/^([\d+-.]+)(.*)$/);
g[c]={value:e[1],unit:e[2]||"px"}});a.toShow.css({height:0,overflow:"hidden"}).show();a.toHide.filter(":hidden").each(a.complete).end().filter(":visible").animate(i,{step:function(b,c){"height"==c.prop&&(f=0===c.end-c.start?0:(c.now-c.start)/(c.end-c.start));a.toShow[0].style[c.prop]=f*g[c.prop].value+g[c.prop].unit},duration:a.duration,easing:a.easing,complete:function(){a.autoHeight||a.toShow.css("height","");a.toShow.css({width:e,overflow:c});a.complete()}})}else a.toHide.animate({height:"hide",
paddingTop:"hide",paddingBottom:"hide"},a);else a.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},a)},bounceslide:function(a){this.slide(a,{easing:a.down?"easeOutBounce":"swing",duration:a.down?1E3:200})}}})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.autocomplete.js' */
(function(d){var c=0;d.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var a=this,b=this.element[0].ownerDocument,c;this.isMultiLine=this.element.is("textarea");this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(b){if(!a.options.disabled&&
!a.element.propAttr("readOnly")){c=!1;var f=d.ui.keyCode;switch(b.keyCode){case f.PAGE_UP:a._move("previousPage",b);break;case f.PAGE_DOWN:a._move("nextPage",b);break;case f.UP:a._keyEvent("previous",b);break;case f.DOWN:a._keyEvent("next",b);break;case f.ENTER:case f.NUMPAD_ENTER:a.menu.active&&(c=!0,b.preventDefault());case f.TAB:if(!a.menu.active)break;a.menu.select(b);break;case f.ESCAPE:a.element.val(a.term);a.close(b);break;default:clearTimeout(a.searching),a.searching=setTimeout(function(){a.term!=
a.element.val()&&(a.selectedItem=null,a.search(null,b))},a.options.delay)}}}).bind("keypress.autocomplete",function(a){c&&(c=!1,a.preventDefault())}).bind("focus.autocomplete",function(){a.options.disabled||(a.selectedItem=null,a.previous=a.element.val())}).bind("blur.autocomplete",function(b){a.options.disabled||(clearTimeout(a.searching),a.closing=setTimeout(function(){a.close(b);a._change(b)},150))});this._initSource();this.menu=d("<ul></ul>").addClass("ui-autocomplete").appendTo(d(this.options.appendTo||
"body",b)[0]).mousedown(function(b){var c=a.menu.element[0];d(b.target).closest(".ui-menu-item").length||setTimeout(function(){d(document).one("mousedown",function(b){b.target!==a.element[0]&&(b.target!==c&&!d.ui.contains(c,b.target))&&a.close()})},1);setTimeout(function(){clearTimeout(a.closing)},13)}).menu({focus:function(b,d){var c=d.item.data("item.autocomplete");!1!==a._trigger("focus",b,{item:c})&&/^key/.test(b.originalEvent.type)&&a.element.val(c.value)},selected:function(c,d){var e=d.item.data("item.autocomplete"),
h=a.previous;a.element[0]!==b.activeElement&&(a.element.focus(),a.previous=h,setTimeout(function(){a.previous=h;a.selectedItem=e},1));!1!==a._trigger("select",c,{item:e})&&a.element.val(e.value);a.term=a.element.val();a.close(c);a.selectedItem=e},blur:function(){a.menu.element.is(":visible")&&a.element.val()!==a.term&&a.element.val(a.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");d.fn.bgiframe&&this.menu.element.bgiframe();a.beforeunloadHandler=function(){a.element.removeAttr("autocomplete")};
d(window).bind("beforeunload",a.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();d(window).unbind("beforeunload",this.beforeunloadHandler);d.Widget.prototype.destroy.call(this)},_setOption:function(a,b){d.Widget.prototype._setOption.apply(this,arguments);"source"===a&&this._initSource();"appendTo"===a&&this.menu.element.appendTo(d(b||
"body",this.element[0].ownerDocument)[0]);"disabled"===a&&(b&&this.xhr)&&this.xhr.abort()},_initSource:function(){var a=this,b,c;d.isArray(this.options.source)?(b=this.options.source,this.source=function(a,c){c(d.ui.autocomplete.filter(b,a.term))}):"string"===typeof this.options.source?(c=this.options.source,this.source=function(b,f){a.xhr&&a.xhr.abort();a.xhr=d.ajax({url:c,data:b,dataType:"json",success:function(a){f(a)},error:function(){f([])}})}):this.source=this.options.source},search:function(a,
b){a=null!=a?a:this.element.val();this.term=this.element.val();if(a.length<this.options.minLength)return this.close(b);clearTimeout(this.closing);if(!1!==this._trigger("search",b))return this._search(a)},_search:function(a){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:a},this._response())},_response:function(){var a=this,b=++c;return function(d){b===c&&a.__response(d);a.pending--;a.pending||a.element.removeClass("ui-autocomplete-loading")}},__response:function(a){!this.options.disabled&&
a&&a.length?(a=this._normalize(a),this._suggest(a),this._trigger("open")):this.close()},close:function(a){clearTimeout(this.closing);this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",a))},_change:function(a){this.previous!==this.element.val()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(a){return a.length&&a[0].label&&a[0].value?a:d.map(a,function(a){return"string"===typeof a?{label:a,value:a}:d.extend({label:a.label||
a.value,value:a.value||a.label},a)})},_suggest:function(a){var b=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(b,a);this.menu.deactivate();this.menu.refresh();b.show();this._resizeMenu();b.position(d.extend({of:this.element},this.options.position));this.options.autoFocus&&this.menu.next(new d.Event("mouseover"))},_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(a,b){var c=
this;d.each(b,function(b,d){c._renderItem(a,d)})},_renderItem:function(a,b){return d("<li></li>").data("item.autocomplete",b).append(d("<a></a>").text(b.label)).appendTo(a)},_move:function(a,b){if(this.menu.element.is(":visible"))if(this.menu.first()&&/^previous/.test(a)||this.menu.last()&&/^next/.test(a))this.element.val(this.term),this.menu.deactivate();else this.menu[a](b);else this.search(null,b)},widget:function(){return this.menu.element},_keyEvent:function(a,b){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(a,
b),b.preventDefault()}});d.extend(d.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(a,b){var c=RegExp(d.ui.autocomplete.escapeRegex(b),"i");return d.grep(a,function(a){return c.test(a.label||a.value||a)})}})})(jQuery);
(function(d){d.widget("ui.menu",{_create:function(){var c=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(a){d(a.target).closest(".ui-menu-item a").length&&(a.preventDefault(),c.select(a))});this.refresh()},refresh:function(){var c=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",
-1).mouseenter(function(a){c.activate(a,d(this).parent())}).mouseleave(function(){c.deactivate()})},activate:function(c,a){this.deactivate();if(this.hasScroll()){var b=a.offset().top-this.element.offset().top,d=this.element.scrollTop(),g=this.element.height();0>b?this.element.scrollTop(d+b):b>=g&&this.element.scrollTop(d+b-g+a.height())}this.active=a.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",c,{item:a})},deactivate:function(){this.active&&
(this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null)},next:function(c){this.move("next",".ui-menu-item:first",c)},previous:function(c){this.move("prev",".ui-menu-item:last",c)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(c,a,b){this.active?(c=this.active[c+"All"](".ui-menu-item").eq(0),c.length?this.activate(b,
c):this.activate(b,this.element.children(a))):this.activate(b,this.element.children(a))},nextPage:function(c){if(this.hasScroll())if(!this.active||this.last())this.activate(c,this.element.children(".ui-menu-item:first"));else{var a=this.active.offset().top,b=this.element.height(),e=this.element.children(".ui-menu-item").filter(function(){var c=d(this).offset().top-a-b+d(this).height();return 10>c&&-10<c});e.length||(e=this.element.children(".ui-menu-item:last"));this.activate(c,e)}else this.activate(c,
this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(c){if(this.hasScroll())if(!this.active||this.first())this.activate(c,this.element.children(".ui-menu-item:last"));else{var a=this.active.offset().top,b=this.element.height(),e=this.element.children(".ui-menu-item").filter(function(){var c=d(this).offset().top-a+b-d(this).height();return 10>c&&-10<c});e.length||(e=this.element.children(".ui-menu-item:first"));this.activate(c,e)}else this.activate(c,
this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[d.fn.prop?"prop":"attr"]("scrollHeight")},select:function(c){this._trigger("selected",c,{item:this.active})}})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.button.js' */
(function(b){var g,h,i,e,k=function(){var a=b(this).find(":ui-button");setTimeout(function(){a.button("refresh")},1)},j=function(a){var c=a.name,d=a.form,f=b([]);c&&(f=d?b(d).find("[name='"+c+"']"):b("[name='"+c+"']",a.ownerDocument).filter(function(){return!this.form}));return f};b.widget("ui.button",{options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",k);"boolean"!==typeof this.options.disabled?
this.options.disabled=!!this.element.propAttr("disabled"):this.element.propAttr("disabled",this.options.disabled);this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var a=this,c=this.options,d="checkbox"===this.type||"radio"===this.type,f="ui-state-hover"+(!d?" ui-state-active":"");null===c.label&&(c.label=this.buttonElement.html());this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseenter.button",function(){if(!c.disabled){b(this).addClass("ui-state-hover");
this===g&&b(this).addClass("ui-state-active")}}).bind("mouseleave.button",function(){c.disabled||b(this).removeClass(f)}).bind("click.button",function(a){if(c.disabled){a.preventDefault();a.stopImmediatePropagation()}});this.element.bind("focus.button",function(){a.buttonElement.addClass("ui-state-focus")}).bind("blur.button",function(){a.buttonElement.removeClass("ui-state-focus")});d&&(this.element.bind("change.button",function(){e||a.refresh()}),this.buttonElement.bind("mousedown.button",function(a){if(!c.disabled){e=
false;h=a.pageX;i=a.pageY}}).bind("mouseup.button",function(a){if(!c.disabled&&(h!==a.pageX||i!==a.pageY))e=true}));"checkbox"===this.type?this.buttonElement.bind("click.button",function(){if(c.disabled||e)return false;b(this).toggleClass("ui-state-active");a.buttonElement.attr("aria-pressed",a.element[0].checked)}):"radio"===this.type?this.buttonElement.bind("click.button",function(){if(c.disabled||e)return false;b(this).addClass("ui-state-active");a.buttonElement.attr("aria-pressed","true");var d=
a.element[0];j(d).not(d).map(function(){return b(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown.button",function(){if(c.disabled)return false;b(this).addClass("ui-state-active");g=this;b(document).one("mouseup",function(){g=null})}).bind("mouseup.button",function(){if(c.disabled)return false;b(this).removeClass("ui-state-active")}).bind("keydown.button",function(a){if(c.disabled)return false;(a.keyCode==b.ui.keyCode.SPACE||
a.keyCode==b.ui.keyCode.ENTER)&&b(this).addClass("ui-state-active")}).bind("keyup.button",function(){b(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(a){a.keyCode===b.ui.keyCode.SPACE&&b(this).click()}));this._setOption("disabled",c.disabled);this._resetButton()},_determineButtonType:function(){this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button";if("checkbox"===this.type||
"radio"===this.type){var a=this.element.parents().filter(":last"),b="label[for='"+this.element.attr("id")+"']";this.buttonElement=a.find(b);this.buttonElement.length||(a=a.length?a.siblings():this.element.siblings(),this.buttonElement=a.filter(b),this.buttonElement.length||(this.buttonElement=a.find(b)));this.element.addClass("ui-helper-hidden-accessible");(a=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active");this.buttonElement.attr("aria-pressed",a)}else this.buttonElement=
this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active  ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());this.hasTitle||
this.buttonElement.removeAttr("title");b.Widget.prototype.destroy.call(this)},_setOption:function(a,c){b.Widget.prototype._setOption.apply(this,arguments);"disabled"===a?c?this.element.propAttr("disabled",!0):this.element.propAttr("disabled",!1):this._resetButton()},refresh:function(){var a=this.element.is(":disabled");a!==this.options.disabled&&this._setOption("disabled",a);"radio"===this.type?j(this.element[0]).each(function(){b(this).is(":checked")?b(this).button("widget").addClass("ui-state-active").attr("aria-pressed",
"true"):b(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)this.options.label&&this.element.val(this.options.label);else{var a=this.buttonElement.removeClass("ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only"),
c=b("<span></span>",this.element[0].ownerDocument).addClass("ui-button-text").html(this.options.label).appendTo(a.empty()).text(),d=this.options.icons,f=d.primary&&d.secondary,e=[];d.primary||d.secondary?(this.options.text&&e.push("ui-button-text-icon"+(f?"s":d.primary?"-primary":"-secondary")),d.primary&&a.prepend("<span class='ui-button-icon-primary ui-icon "+d.primary+"'></span>"),d.secondary&&a.append("<span class='ui-button-icon-secondary ui-icon "+d.secondary+"'></span>"),this.options.text||
(e.push(f?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||a.attr("title",c))):e.push("ui-button-text-only");a.addClass(e.join(" "))}}});b.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(a,c){"disabled"===a&&this.buttons.button("option",a,c);b.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var a="rtl"===
this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return b(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(a?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(a?"ui-corner-left":"ui-corner-right").end().end()},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return b(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");
b.Widget.prototype.destroy.call(this)}})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.dialog.js' */
(function(c){var i={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},j={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};c.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(a){var b=c(this).css(a).offset().top;0>b&&c(this).css("top",a.top-b)}},resizable:!0,
show:null,stack:!0,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title");"string"!==typeof this.originalTitle&&(this.originalTitle="");this.options.title=this.options.title||this.originalTitle;var a=this,b=a.options,d=b.title||"&#160;",e=c.ui.dialog.getTitleId(a.element),f=(a.uiDialog=c("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+b.dialogClass).css({zIndex:b.zIndex}).attr("tabIndex",-1).css("outline",
0).keydown(function(d){if(b.closeOnEscape&&!d.isDefaultPrevented()&&d.keyCode&&d.keyCode===c.ui.keyCode.ESCAPE){a.close(d);d.preventDefault()}}).attr({role:"dialog","aria-labelledby":e}).mousedown(function(b){a.moveToTop(false,b)});a.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(f);var h=(a.uiDialogTitlebar=c("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(f),g=c('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role",
"button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).focus(function(){g.addClass("ui-state-focus")}).blur(function(){g.removeClass("ui-state-focus")}).click(function(b){a.close(b);return false}).appendTo(h);(a.uiDialogTitlebarCloseText=c("<span></span>")).addClass("ui-icon ui-icon-closethick").text(b.closeText).appendTo(g);c("<span></span>").addClass("ui-dialog-title").attr("id",e).html(d).prependTo(h);c.isFunction(b.beforeclose)&&!c.isFunction(b.beforeClose)&&
(b.beforeClose=b.beforeclose);h.find("*").add(h).disableSelection();b.draggable&&c.fn.draggable&&a._makeDraggable();b.resizable&&c.fn.resizable&&a._makeResizable();a._createButtons(b.buttons);a._isOpen=!1;c.fn.bgiframe&&f.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){this.overlay&&this.overlay.destroy();this.uiDialog.hide();this.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");this.uiDialog.remove();
this.originalTitle&&this.element.attr("title",this.originalTitle);return this},widget:function(){return this.uiDialog},close:function(a){var b=this,d,e;if(!1!==b._trigger("beforeClose",a))return b.overlay&&b.overlay.destroy(),b.uiDialog.unbind("keypress.ui-dialog"),b._isOpen=!1,b.options.hide?b.uiDialog.hide(b.options.hide,function(){b._trigger("close",a)}):(b.uiDialog.hide(),b._trigger("close",a)),c.ui.dialog.overlay.resize(),b.options.modal&&(d=0,c(".ui-dialog").each(function(){if(this!==b.uiDialog[0]){e=
c(this).css("z-index");isNaN(e)||(d=Math.max(d,e))}}),c.ui.dialog.maxZ=d),b},isOpen:function(){return this._isOpen},moveToTop:function(a,b){var d=this.options;if(d.modal&&!a||!d.stack&&!d.modal)return this._trigger("focus",b);d.zIndex>c.ui.dialog.maxZ&&(c.ui.dialog.maxZ=d.zIndex);this.overlay&&(c.ui.dialog.maxZ+=1,this.overlay.$el.css("z-index",c.ui.dialog.overlay.maxZ=c.ui.dialog.maxZ));d={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()};c.ui.dialog.maxZ+=1;this.uiDialog.css("z-index",
c.ui.dialog.maxZ);this.element.attr(d);this._trigger("focus",b);return this},open:function(){if(!this._isOpen){var a=this.options,b=this.uiDialog;this.overlay=a.modal?new c.ui.dialog.overlay(this):null;this._size();this._position(a.position);b.show(a.show);this.moveToTop(!0);a.modal&&b.bind("keydown.ui-dialog",function(a){if(a.keyCode===c.ui.keyCode.TAB){var b=c(":tabbable",this),f=b.filter(":first"),b=b.filter(":last");if(a.target===b[0]&&!a.shiftKey)return f.focus(1),!1;if(a.target===f[0]&&a.shiftKey)return b.focus(1),
!1}});c(this.element.find(":tabbable").get().concat(b.find(".ui-dialog-buttonpane :tabbable").get().concat(b.get()))).eq(0).focus();this._isOpen=!0;this._trigger("open");return this}},_createButtons:function(a){var b=this,d=!1,e=c("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),f=c("<div></div>").addClass("ui-dialog-buttonset").appendTo(e);b.uiDialog.find(".ui-dialog-buttonpane").remove();"object"===typeof a&&null!==a&&c.each(a,function(){return!(d=!0)});d&&(c.each(a,
function(a,d){var d=c.isFunction(d)?{click:d,text:a}:d,e=c('<button type="button"></button>').click(function(){d.click.apply(b.element[0],arguments)}).appendTo(f);c.each(d,function(a,b){if("click"!==a)if(a in e)e[a](b);else e.attr(a,b)});c.fn.button&&e.button()}),e.appendTo(b.uiDialog))},_makeDraggable:function(){function a(a){return{position:a.position,offset:a.offset}}var b=this,d=b.options,e=c(document),f;b.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",
containment:"document",start:function(e,g){f="auto"===d.height?"auto":c(this).height();c(this).height(c(this).height()).addClass("ui-dialog-dragging");b._trigger("dragStart",e,a(g))},drag:function(c,d){b._trigger("drag",c,a(d))},stop:function(h,g){d.position=[g.position.left-e.scrollLeft(),g.position.top-e.scrollTop()];c(this).removeClass("ui-dialog-dragging").height(f);b._trigger("dragStop",h,a(g));c.ui.dialog.overlay.resize()}})},_makeResizable:function(a){function b(a){return{originalPosition:a.originalPosition,
originalSize:a.originalSize,position:a.position,size:a.size}}var a=void 0===a?this.options.resizable:a,d=this,e=d.options,f=d.uiDialog.css("position"),a="string"===typeof a?a:"n,e,s,w,se,sw,ne,nw";d.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:d.element,maxWidth:e.maxWidth,maxHeight:e.maxHeight,minWidth:e.minWidth,minHeight:d._minHeight(),handles:a,start:function(a,e){c(this).addClass("ui-dialog-resizing");d._trigger("resizeStart",a,b(e))},resize:function(a,c){d._trigger("resize",
a,b(c))},stop:function(a,f){c(this).removeClass("ui-dialog-resizing");e.height=c(this).height();e.width=c(this).width();d._trigger("resizeStop",a,b(f));c.ui.dialog.overlay.resize()}}).css("position",f).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(a){var b=[],d=[0,0],e;if(a){if("string"===typeof a||"object"===typeof a&&"0"in a)b=a.split?a.split(" "):
[a[0],a[1]],1===b.length&&(b[1]=b[0]),c.each(["left","top"],function(a,c){+b[a]===b[a]&&(d[a]=b[a],b[a]=c)}),a={my:b.join(" "),at:b.join(" "),offset:d.join(" ")};a=c.extend({},c.ui.dialog.prototype.options.position,a)}else a=c.ui.dialog.prototype.options.position;(e=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position(c.extend({of:window},a));e||this.uiDialog.hide()},_setOptions:function(a){var b=this,d={},e=!1;c.each(a,function(a,c){b._setOption(a,c);a in
i&&(e=!0);a in j&&(d[a]=c)});e&&this._size();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",d)},_setOption:function(a,b){var d=this.uiDialog;switch(a){case "beforeclose":a="beforeClose";break;case "buttons":this._createButtons(b);break;case "closeText":this.uiDialogTitlebarCloseText.text(""+b);break;case "dialogClass":d.removeClass(this.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+b);break;case "disabled":b?d.addClass("ui-dialog-disabled"):
d.removeClass("ui-dialog-disabled");break;case "draggable":var e=d.is(":data(draggable)");e&&!b&&d.draggable("destroy");!e&&b&&this._makeDraggable();break;case "position":this._position(b);break;case "resizable":(e=d.is(":data(resizable)"))&&!b&&d.resizable("destroy");e&&"string"===typeof b&&d.resizable("option","handles",b);!e&&!1!==b&&this._makeResizable(b);break;case "title":c(".ui-dialog-title",this.uiDialogTitlebar).html(""+(b||"&#160;"))}c.Widget.prototype._setOption.apply(this,arguments)},
_size:function(){var a=this.options,b,d,e=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});a.minWidth>a.width&&(a.width=a.minWidth);b=this.uiDialog.css({height:"auto",width:a.width}).height();d=Math.max(0,a.minHeight-b);"auto"===a.height?c.support.minHeight?this.element.css({minHeight:d,height:"auto"}):(this.uiDialog.show(),a=this.element.css("height","auto").height(),e||this.uiDialog.hide(),this.element.height(Math.max(a,d))):this.element.height(Math.max(a.height-
b,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}});c.extend(c.ui.dialog,{version:"1.8.24",uuid:0,maxZ:0,getTitleId:function(a){a=a.attr("id");a||(a=this.uuid+=1);return"ui-dialog-title-"+a},overlay:function(a){this.$el=c.ui.dialog.overlay.create(a)}});c.extend(c.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:c.map("focus mousedown mouseup keydown keypress click".split(" "),function(a){return a+".dialog-overlay"}).join(" "),
create:function(a){0===this.instances.length&&(setTimeout(function(){c.ui.dialog.overlay.instances.length&&c(document).bind(c.ui.dialog.overlay.events,function(a){if(c(a.target).zIndex()<c.ui.dialog.overlay.maxZ)return!1})},1),c(document).bind("keydown.dialog-overlay",function(b){a.options.closeOnEscape&&(!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===c.ui.keyCode.ESCAPE)&&(a.close(b),b.preventDefault())}),c(window).bind("resize.dialog-overlay",c.ui.dialog.overlay.resize));var b=(this.oldInstances.pop()||
c("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});c.fn.bgiframe&&b.bgiframe();this.instances.push(b);return b},destroy:function(a){var b=c.inArray(a,this.instances);-1!=b&&this.oldInstances.push(this.instances.splice(b,1)[0]);0===this.instances.length&&c([document,window]).unbind(".dialog-overlay");a.remove();var d=0;c.each(this.instances,function(){d=Math.max(d,this.css("z-index"))});this.maxZ=d},height:function(){var a,b;return c.browser.msie&&
7>c.browser.version?(a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),b=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),a<b?c(window).height()+"px":a+"px"):c(document).height()+"px"},width:function(){var a,b;return c.browser.msie?(a=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),b=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),a<b?c(window).width()+"px":a+"px"):c(document).width()+"px"},resize:function(){var a=
c([]);c.each(c.ui.dialog.overlay.instances,function(){a=a.add(this)});a.css({width:0,height:0}).css({width:c.ui.dialog.overlay.width(),height:c.ui.dialog.overlay.height()})}});c.extend(c.ui.dialog.overlay.prototype,{destroy:function(){c.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.progressbar.js' */
(function(b){b.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=b("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");
this.valueDiv.remove();b.Widget.prototype.destroy.apply(this,arguments)},value:function(a){if(void 0===a)return this._value();this._setOption("value",a);return this},_setOption:function(a,c){"value"===a&&(this.options.value=c,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete"));b.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var a=this.options.value;"number"!==typeof a&&(a=0);return Math.min(this.options.max,Math.max(this.min,a))},_percentage:function(){return 100*
this._value()/this.options.max},_refreshValue:function(){var a=this.value(),b=this._percentage();this.oldValue!==a&&(this.oldValue=a,this._trigger("change"));this.valueDiv.toggle(a>this.min).toggleClass("ui-corner-right",a===this.options.max).width(b.toFixed(0)+"%");this.element.attr("aria-valuenow",a)}});b.extend(b.ui.progressbar,{version:"1.8.24"})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.slider.js' */
(function(d){d.widget("ui.slider",d.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var a=this,b=this.options,c=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f=b.values&&b.values.length||1,e=[];this._mouseSliding=this._keySliding=!1;this._animateOff=!0;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+
this.orientation+" ui-widget ui-widget-content ui-corner-all"+(b.disabled?" ui-slider-disabled ui-disabled":""));this.range=d([]);if(b.range){if(!0===b.range&&(b.values||(b.values=[this._valueMin(),this._valueMin()]),b.values.length&&2!==b.values.length))b.values=[b.values[0],b.values[0]];this.range=d("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===b.range||"max"===b.range?" ui-slider-range-"+b.range:""))}for(var g=c.length;g<f;g+=1)e.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");
this.handles=c.add(d(e.join("")).appendTo(a.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(a){a.preventDefault()}).hover(function(){b.disabled||d(this).addClass("ui-state-hover")},function(){d(this).removeClass("ui-state-hover")}).focus(function(){b.disabled?d(this).blur():(d(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),d(this).addClass("ui-state-focus"))}).blur(function(){d(this).removeClass("ui-state-focus")});this.handles.each(function(a){d(this).data("index.ui-slider-handle",
a)});this.handles.keydown(function(b){var c=d(this).data("index.ui-slider-handle"),e,f,g;if(!a.options.disabled){switch(b.keyCode){case d.ui.keyCode.HOME:case d.ui.keyCode.END:case d.ui.keyCode.PAGE_UP:case d.ui.keyCode.PAGE_DOWN:case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:if(b.preventDefault(),!a._keySliding&&(a._keySliding=!0,d(this).addClass("ui-state-active"),e=a._start(b,c),!1===e))return}g=a.options.step;e=a.options.values&&a.options.values.length?
f=a.values(c):f=a.value();switch(b.keyCode){case d.ui.keyCode.HOME:f=a._valueMin();break;case d.ui.keyCode.END:f=a._valueMax();break;case d.ui.keyCode.PAGE_UP:f=a._trimAlignValue(e+(a._valueMax()-a._valueMin())/5);break;case d.ui.keyCode.PAGE_DOWN:f=a._trimAlignValue(e-(a._valueMax()-a._valueMin())/5);break;case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:if(e===a._valueMax())return;f=a._trimAlignValue(e+g);break;case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:if(e===a._valueMin())return;f=a._trimAlignValue(e-
g)}a._slide(b,c,f)}}).keyup(function(b){var c=d(this).data("index.ui-slider-handle");a._keySliding&&(a._keySliding=!1,a._stop(b,c),a._change(b,c),d(this).removeClass("ui-state-active"))});this._refreshValue();this._animateOff=!1},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this},
_mouseCapture:function(a){var b=this.options,c,f,e,g,h;if(b.disabled)return!1;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();c=this._normValueFromMouse({x:a.pageX,y:a.pageY});f=this._valueMax()-this._valueMin()+1;g=this;this.handles.each(function(b){var a=Math.abs(c-g.values(b));f>a&&(f=a,e=d(this),h=b)});!0===b.range&&this.values(1)===b.min&&(h+=1,e=d(this.handles[h]));if(!1===this._start(a,h))return!1;this._mouseSliding=
!0;g._handleIndex=h;e.addClass("ui-state-active").focus();b=e.offset();this._clickOffset=!d(a.target).parents().andSelf().is(".ui-slider-handle")?{left:0,top:0}:{left:a.pageX-b.left-e.width()/2,top:a.pageY-b.top-e.height()/2-(parseInt(e.css("borderTopWidth"),10)||0)-(parseInt(e.css("borderBottomWidth"),10)||0)+(parseInt(e.css("marginTop"),10)||0)};this.handles.hasClass("ui-state-hover")||this._slide(a,h,c);return this._animateOff=!0},_mouseStart:function(){return!0},_mouseDrag:function(a){var b=this._normValueFromMouse({x:a.pageX,
y:a.pageY});this._slide(a,this._handleIndex,b);return!1},_mouseStop:function(a){this.handles.removeClass("ui-state-active");this._mouseSliding=!1;this._stop(a,this._handleIndex);this._change(a,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b;"horizontal"===this.orientation?(b=this.elementSize.width,a=a.x-this.elementOffset.left-
(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,a=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0));b=a/b;1<b&&(b=1);0>b&&(b=0);"vertical"===this.orientation&&(b=1-b);a=this._valueMax()-this._valueMin();b=this._valueMin()+b*a;return this._trimAlignValue(b)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values());return this._trigger("start",
a,c)},_slide:function(a,b,c){var d;if(this.options.values&&this.options.values.length){d=this.values(b?0:1);if(2===this.options.values.length&&!0===this.options.range&&(0===b&&c>d||1===b&&c<d))c=d;c!==this.values(b)&&(d=this.values(),d[b]=c,a=this._trigger("slide",a,{handle:this.handles[b],value:c,values:d}),this.values(b?0:1),!1!==a&&this.values(b,c,!0))}else c!==this.value()&&(a=this._trigger("slide",a,{handle:this.handles[b],value:c}),!1!==a&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],
value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values());this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values());this._trigger("change",a,c)}},value:function(a){if(arguments.length)this.options.value=this._trimAlignValue(a),this._refreshValue(),this._change(null,
0);else return this._value()},values:function(a,b){var c,f,e;if(1<arguments.length)this.options.values[a]=this._trimAlignValue(b),this._refreshValue(),this._change(null,a);else if(arguments.length)if(d.isArray(arguments[0])){c=this.options.values;f=arguments[0];for(e=0;e<c.length;e+=1)c[e]=this._trimAlignValue(f[e]),this._change(null,e);this._refreshValue()}else return this.options.values&&this.options.values.length?this._values(a):this.value();else return this._values()},_setOption:function(a,b){var c,
f=0;d.isArray(this.options.values)&&(f=this.options.values.length);d.Widget.prototype._setOption.apply(this,arguments);switch(a){case "disabled":b?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case "orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+
this.orientation);this._refreshValue();break;case "value":this._animateOff=!0;this._refreshValue();this._change(null,0);this._animateOff=!1;break;case "values":this._animateOff=!0;this._refreshValue();for(c=0;c<f;c+=1)this._change(null,c);this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b);b=this.options.values.slice();for(c=0;c<b.length;c+=1)b[c]=
this._trimAlignValue(b[c]);return b},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=0<this.options.step?this.options.step:1,c=(a-this._valueMin())%b,a=a-c;2*Math.abs(c)>=b&&(a+=0<c?b:-b);return parseFloat(a.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var a=this.options.range,b=this.options,c=this,f=!this._animateOff?b.animate:!1,e,g=
{},h,k,i,j;if(this.options.values&&this.options.values.length)this.handles.each(function(a){e=100*((c.values(a)-c._valueMin())/(c._valueMax()-c._valueMin()));g["horizontal"===c.orientation?"left":"bottom"]=e+"%";d(this).stop(1,1)[f?"animate":"css"](g,b.animate);if(!0===c.options.range)if("horizontal"===c.orientation){if(0===a)c.range.stop(1,1)[f?"animate":"css"]({left:e+"%"},b.animate);if(1===a)c.range[f?"animate":"css"]({width:e-h+"%"},{queue:!1,duration:b.animate})}else{if(0===a)c.range.stop(1,
1)[f?"animate":"css"]({bottom:e+"%"},b.animate);if(1===a)c.range[f?"animate":"css"]({height:e-h+"%"},{queue:!1,duration:b.animate})}h=e});else{k=this.value();i=this._valueMin();j=this._valueMax();e=j!==i?100*((k-i)/(j-i)):0;g["horizontal"===c.orientation?"left":"bottom"]=e+"%";this.handle.stop(1,1)[f?"animate":"css"](g,b.animate);if("min"===a&&"horizontal"===this.orientation)this.range.stop(1,1)[f?"animate":"css"]({width:e+"%"},b.animate);if("max"===a&&"horizontal"===this.orientation)this.range[f?
"animate":"css"]({width:100-e+"%"},{queue:!1,duration:b.animate});if("min"===a&&"vertical"===this.orientation)this.range.stop(1,1)[f?"animate":"css"]({height:e+"%"},b.animate);if("max"===a&&"vertical"===this.orientation)this.range[f?"animate":"css"]({height:100-e+"%"},{queue:!1,duration:b.animate})}}});d.extend(d.ui.slider,{version:"1.8.24"})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.ui.tabs.js' */
(function(d){var n=0,o=0;d.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:!1,cookie:null,collapsible:!1,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(!0)},_setOption:function(a,d){"selected"==a?this.options.collapsible&&d==this.options.selected||this.select(d):
(this.options[a]=d,this._tabify())},_tabId:function(a){return a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+ ++n},_sanitizeSelector:function(a){return a.replace(/:/g,"\\:")},_cookie:function(){var a=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++o);return d.cookie.apply(null,[a].concat(d.makeArray(arguments)))},_ui:function(a,d){return{tab:a,panel:d,index:this.anchors.index(a)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var a=
d(this);a.html(a.data("label.tabs")).removeData("label.tabs")})},_tabify:function(a){function e(b,a){b.css("display","");!d.support.opacity&&a.opacity&&b[0].style.removeAttribute("filter")}var b=this,c=this.options,g=/^#.+/;this.list=this.element.find("ol,ul").eq(0);this.lis=d(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return d("a",this)[0]});this.panels=d([]);this.anchors.each(function(a,e){var h=d(e).attr("href"),f=h.split("#")[0],k;if(f&&(f===location.toString().split("#")[0]||
(k=d("base")[0])&&f===k.href))h=e.hash,e.href=h;g.test(h)?b.panels=b.panels.add(b.element.find(b._sanitizeSelector(h))):h&&"#"!==h?(d.data(e,"href.tabs",h),d.data(e,"load.tabs",h.replace(/#.*$/,"")),h=b._tabId(e),e.href="#"+h,f=b.element.find("#"+h),f.length||(f=d(c.panelTemplate).attr("id",h).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(b.panels[a-1]||b.list),f.data("destroy.tabs",!0)),b.panels=b.panels.add(f)):c.disabled.push(a)});a?(this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),
this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),void 0===c.selected?(location.hash&&this.anchors.each(function(b,a){if(a.hash==location.hash)return c.selected=b,!1}),"number"!==typeof c.selected&&c.cookie&&(c.selected=parseInt(b._cookie(),10)),"number"!==typeof c.selected&&this.lis.filter(".ui-tabs-selected").length&&(c.selected=
this.lis.index(this.lis.filter(".ui-tabs-selected"))),c.selected=c.selected||(this.lis.length?0:-1)):null===c.selected&&(c.selected=-1),c.selected=0<=c.selected&&this.anchors[c.selected]||0>c.selected?c.selected:0,c.disabled=d.unique(c.disabled.concat(d.map(this.lis.filter(".ui-state-disabled"),function(a){return b.lis.index(a)}))).sort(),-1!=d.inArray(c.selected,c.disabled)&&c.disabled.splice(d.inArray(c.selected,c.disabled),1),this.panels.addClass("ui-tabs-hide"),this.lis.removeClass("ui-tabs-selected ui-state-active"),
0<=c.selected&&this.anchors.length&&(b.element.find(b._sanitizeSelector(b.anchors[c.selected].hash)).removeClass("ui-tabs-hide"),this.lis.eq(c.selected).addClass("ui-tabs-selected ui-state-active"),b.element.queue("tabs",function(){b._trigger("show",null,b._ui(b.anchors[c.selected],b.element.find(b._sanitizeSelector(b.anchors[c.selected].hash))[0]))}),this.load(c.selected)),d(window).bind("unload",function(){b.lis.add(b.anchors).unbind(".tabs");b.lis=b.anchors=b.panels=null})):c.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));
this.element[c.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");c.cookie&&this._cookie(c.selected,c.cookie);for(var a=0,f;f=this.lis[a];a++)d(f)[-1!=d.inArray(a,c.disabled)&&!d(f).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");!1===c.cache&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if("mouseover"!==c.event){var k=function(b,a){a.is(":not(.ui-state-disabled)")&&a.addClass("ui-state-"+b)};this.lis.bind("mouseover.tabs",
function(){k("hover",d(this))});this.lis.bind("mouseout.tabs",function(){d(this).removeClass("ui-state-hover")});this.anchors.bind("focus.tabs",function(){k("focus",d(this).closest("li"))});this.anchors.bind("blur.tabs",function(){d(this).closest("li").removeClass("ui-state-focus")})}var j,i;c.fx&&(d.isArray(c.fx)?(j=c.fx[0],i=c.fx[1]):j=i=c.fx);var l=i?function(a,c){d(a).closest("li").addClass("ui-tabs-selected ui-state-active");c.hide().removeClass("ui-tabs-hide").animate(i,i.duration||"normal",
function(){e(c,i);b._trigger("show",null,b._ui(a,c[0]))})}:function(a,c){d(a).closest("li").addClass("ui-tabs-selected ui-state-active");c.removeClass("ui-tabs-hide");b._trigger("show",null,b._ui(a,c[0]))},m=j?function(a,c){c.animate(j,j.duration||"normal",function(){b.lis.removeClass("ui-tabs-selected ui-state-active");c.addClass("ui-tabs-hide");e(c,j);b.element.dequeue("tabs")})}:function(a,c){b.lis.removeClass("ui-tabs-selected ui-state-active");c.addClass("ui-tabs-hide");b.element.dequeue("tabs")};
this.anchors.bind(c.event+".tabs",function(){var a=this,e=d(a).closest("li"),f=b.panels.filter(":not(.ui-tabs-hide)"),g=b.element.find(b._sanitizeSelector(a.hash));if(e.hasClass("ui-tabs-selected")&&!c.collapsible||e.hasClass("ui-state-disabled")||e.hasClass("ui-state-processing")||b.panels.filter(":animated").length||b._trigger("select",null,b._ui(this,g[0]))===false){this.blur();return false}c.selected=b.anchors.index(this);b.abort();if(c.collapsible){if(e.hasClass("ui-tabs-selected")){c.selected=
-1;c.cookie&&b._cookie(c.selected,c.cookie);b.element.queue("tabs",function(){m(a,f)}).dequeue("tabs");this.blur();return false}if(!f.length){c.cookie&&b._cookie(c.selected,c.cookie);b.element.queue("tabs",function(){l(a,g)});b.load(b.anchors.index(this));this.blur();return false}}c.cookie&&b._cookie(c.selected,c.cookie);if(g.length){f.length&&b.element.queue("tabs",function(){m(a,f)});b.element.queue("tabs",function(){l(a,g)});b.load(b.anchors.index(this))}else throw"jQuery UI Tabs: Mismatching fragment identifier.";
d.browser.msie&&this.blur()});this.anchors.bind("click.tabs",function(){return false})},_getIndex:function(a){"string"==typeof a&&(a=this.anchors.index(this.anchors.filter("[href$='"+a+"']")));return a},destroy:function(){var a=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var a=
d.data(this,"href.tabs");a&&(this.href=a);var b=d(this).unbind(".tabs");d.each(["href","load","cache"],function(a,d){b.removeData(d+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){d.data(this,"destroy.tabs")?d(this).remove():d(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")});a.cookie&&this._cookie(null,a.cookie);return this},add:function(a,
e,b){void 0===b&&(b=this.anchors.length);var c=this,g=this.options,e=d(g.tabTemplate.replace(/#\{href\}/g,a).replace(/#\{label\}/g,e)),a=!a.indexOf("#")?a.replace("#",""):this._tabId(d("a",e)[0]);e.addClass("ui-state-default ui-corner-top").data("destroy.tabs",!0);var f=c.element.find("#"+a);f.length||(f=d(g.panelTemplate).attr("id",a).data("destroy.tabs",!0));f.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");b>=this.lis.length?(e.appendTo(this.list),f.appendTo(this.list[0].parentNode)):
(e.insertBefore(this.lis[b]),f.insertBefore(this.panels[b]));g.disabled=d.map(g.disabled,function(a){return a>=b?++a:a});this._tabify();1==this.anchors.length&&(g.selected=0,e.addClass("ui-tabs-selected ui-state-active"),f.removeClass("ui-tabs-hide"),this.element.queue("tabs",function(){c._trigger("show",null,c._ui(c.anchors[0],c.panels[0]))}),this.load(0));this._trigger("add",null,this._ui(this.anchors[b],this.panels[b]));return this},remove:function(a){var a=this._getIndex(a),e=this.options,b=this.lis.eq(a).remove(),
c=this.panels.eq(a).remove();b.hasClass("ui-tabs-selected")&&1<this.anchors.length&&this.select(a+(a+1<this.anchors.length?1:-1));e.disabled=d.map(d.grep(e.disabled,function(b){return b!=a}),function(b){return b>=a?--b:b});this._tabify();this._trigger("remove",null,this._ui(b.find("a")[0],c[0]));return this},enable:function(a){var a=this._getIndex(a),e=this.options;if(-1!=d.inArray(a,e.disabled))return this.lis.eq(a).removeClass("ui-state-disabled"),e.disabled=d.grep(e.disabled,function(b){return b!=
a}),this._trigger("enable",null,this._ui(this.anchors[a],this.panels[a])),this},disable:function(a){var a=this._getIndex(a),d=this.options;a!=d.selected&&(this.lis.eq(a).addClass("ui-state-disabled"),d.disabled.push(a),d.disabled.sort(),this._trigger("disable",null,this._ui(this.anchors[a],this.panels[a])));return this},select:function(a){a=this._getIndex(a);if(-1==a)if(this.options.collapsible&&-1!=this.options.selected)a=this.options.selected;else return this;this.anchors.eq(a).trigger(this.options.event+
".tabs");return this},load:function(a){var a=this._getIndex(a),e=this,b=this.options,c=this.anchors.eq(a)[0],g=d.data(c,"load.tabs");this.abort();if(!g||0!==this.element.queue("tabs").length&&d.data(c,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(a).addClass("ui-state-processing");if(b.spinner){var f=d("span",c);f.data("label.tabs",f.html()).html(b.spinner)}this.xhr=d.ajax(d.extend({},b.ajaxOptions,{url:g,success:function(f,g){e.element.find(e._sanitizeSelector(c.hash)).html(f);e._cleanup();
b.cache&&d.data(c,"cache.tabs",!0);e._trigger("load",null,e._ui(e.anchors[a],e.panels[a]));try{b.ajaxOptions.success(f,g)}catch(i){}},error:function(d,f){e._cleanup();e._trigger("load",null,e._ui(e.anchors[a],e.panels[a]));try{b.ajaxOptions.error(d,f,a,c)}catch(g){}}}));e.element.dequeue("tabs");return this}},abort:function(){this.element.queue([]);this.panels.stop(!1,!0);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));this.xhr&&(this.xhr.abort(),delete this.xhr);this._cleanup();
return this},url:function(a,d){this.anchors.eq(a).removeData("cache.tabs").data("load.tabs",d);return this},length:function(){return this.anchors.length}});d.extend(d.ui.tabs,{version:"1.8.24"});d.extend(d.ui.tabs.prototype,{rotation:null,rotate:function(a,d){var b=this,c=this.options,g=b._rotate||(b._rotate=function(d){clearTimeout(b.rotation);b.rotation=setTimeout(function(){var a=c.selected;b.select(++a<b.anchors.length?a:0)},a);d&&d.stopPropagation()}),f=b._unrotate||(b._unrotate=!d?function(a){a.clientX&&
b.rotate(null)}:function(){g()});a?(this.element.bind("tabsshow",g),this.anchors.bind(c.event+".tabs",f),g()):(clearTimeout(b.rotation),this.element.unbind("tabsshow",g),this.anchors.unbind(c.event+".tabs",f),delete this._rotate,delete this._unrotate);return this}})})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.core.js' */
jQuery.effects||function(d){function l(a){var b;return a&&a.constructor==Array&&3==a.length?a:(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(a))?[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10)]:(b=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(a))?[2.55*parseFloat(b[1]),2.55*parseFloat(b[2]),2.55*parseFloat(b[3])]:(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(a))?[parseInt(b[1],16),parseInt(b[2],
16),parseInt(b[3],16)]:(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(a))?[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]:/rgba\(0, 0, 0, 0\)/.exec(a)?m.transparent:m[d.trim(a).toLowerCase()]}function n(){var a=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,b={},c,d;if(a&&a.length&&a[0]&&a[a[0]])for(var f=a.length;f--;)c=a[f],"string"==typeof a[c]&&(d=c.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),b[d]=a[c]);else for(c in a)"string"===
typeof a[c]&&(b[c]=a[c]);return b}function o(a){var b,c;for(b in a)c=a[b],(null==c||d.isFunction(c)||b in q||/scrollbar/.test(b)||!/color/i.test(b)&&isNaN(parseFloat(c)))&&delete a[b];return a}function r(a,b){var c={_:0},d;for(d in b)a[d]!=b[d]&&(c[d]=b[d]);return c}function i(a,b,c,e){"object"==typeof a&&(e=b,c=null,b=a,a=b.effect);d.isFunction(b)&&(e=b,c=null,b={});if("number"==typeof b||d.fx.speeds[b])e=c,c=b,b={};d.isFunction(c)&&(e=c,c=null);b=b||{};c=c||b.duration;c=d.fx.off?0:"number"==typeof c?
c:c in d.fx.speeds?d.fx.speeds[c]:d.fx.speeds._default;e=e||b.complete;return[a,b,c,e]}function j(a){return!a||("number"===typeof a||d.fx.speeds[a])||"string"===typeof a&&!d.effects[a]?!0:!1}d.effects={};d.each("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor borderColor color outlineColor".split(" "),function(a,b){d.fx.step[b]=function(a){if(!a.colorInit){var e;e=a.elem;var f=b,g;do{g=(d.curCSS||d.css)(e,f);if(g!=""&&g!="transparent"||d.nodeName(e,"body"))break;
f="backgroundColor"}while(e=e.parentNode);e=l(g);a.start=e;a.end=l(a.end);a.colorInit=true}a.elem.style[b]="rgb("+Math.max(Math.min(parseInt(a.pos*(a.end[0]-a.start[0])+a.start[0],10),255),0)+","+Math.max(Math.min(parseInt(a.pos*(a.end[1]-a.start[1])+a.start[1],10),255),0)+","+Math.max(Math.min(parseInt(a.pos*(a.end[2]-a.start[2])+a.start[2],10),255),0)+")"}});var m={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,
0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,
255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},p=["add","remove","toggle"],q={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};d.effects.animateClass=function(a,b,c,e){d.isFunction(c)&&(e=c,c=null);return this.queue(function(){var f=
d(this),g=f.attr("style")||" ",h=o(n.call(this)),i,j=f.attr("class")||"";d.each(p,function(b,c){if(a[c])f[c+"Class"](a[c])});i=o(n.call(this));f.attr("class",j);f.animate(r(h,i),{queue:false,duration:b,easing:c,complete:function(){d.each(p,function(b,c){if(a[c])f[c+"Class"](a[c])});if(typeof f.attr("style")=="object"){f.attr("style").cssText="";f.attr("style").cssText=g}else f.attr("style",g);e&&e.apply(this,arguments);d.dequeue(this)}})})};d.fn.extend({_addClass:d.fn.addClass,addClass:function(a,
b,c,e){return b?d.effects.animateClass.apply(this,[{add:a},b,c,e]):this._addClass(a)},_removeClass:d.fn.removeClass,removeClass:function(a,b,c,e){return b?d.effects.animateClass.apply(this,[{remove:a},b,c,e]):this._removeClass(a)},_toggleClass:d.fn.toggleClass,toggleClass:function(a,b,c,e,f){return"boolean"==typeof b||void 0===b?c?d.effects.animateClass.apply(this,[b?{add:a}:{remove:a},c,e,f]):this._toggleClass(a,b):d.effects.animateClass.apply(this,[{toggle:a},b,c,e])},switchClass:function(a,b,c,
e,f){return d.effects.animateClass.apply(this,[{add:b,remove:a},c,e,f])}});d.extend(d.effects,{version:"1.8.24",save:function(a,b){for(var c=0;c<b.length;c++)null!==b[c]&&a.data("ec.storage."+b[c],a[0].style[b[c]])},restore:function(a,b){for(var c=0;c<b.length;c++)null!==b[c]&&a.css(b[c],a.data("ec.storage."+b[c]))},setMode:function(a,b){"toggle"==b&&(b=a.is(":hidden")?"show":"hide");return b},getBaseline:function(a,b){var c,d;switch(a[0]){case "top":c=0;break;case "middle":c=0.5;break;case "bottom":c=
1;break;default:c=a[0]/b.height}switch(a[1]){case "left":d=0;break;case "center":d=0.5;break;case "right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(a){if(a.parent().is(".ui-effects-wrapper"))return a.parent();var b={width:a.outerWidth(!0),height:a.outerHeight(!0),"float":a.css("float")},c=d("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),e=document.activeElement;try{e.id}catch(f){e=document.body}a.wrap(c);
(a[0]===e||d.contains(a[0],e))&&d(e).focus();c=a.parent();"static"==a.css("position")?(c.css({position:"relative"}),a.css({position:"relative"})):(d.extend(b,{position:a.css("position"),zIndex:a.css("z-index")}),d.each(["top","left","bottom","right"],function(c,d){b[d]=a.css(d);isNaN(parseInt(b[d],10))&&(b[d]="auto")}),a.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"}));return c.css(b).show()},removeWrapper:function(a){var b,c=document.activeElement;return a.parent().is(".ui-effects-wrapper")?
(b=a.parent().replaceWith(a),(a[0]===c||d.contains(a[0],c))&&d(c).focus(),b):a},setTransition:function(a,b,c,e){e=e||{};d.each(b,function(b,d){var h=a.cssUnit(d);0<h[0]&&(e[d]=h[0]*c+h[1])});return e}});d.fn.extend({effect:function(a,b,c,e){var f=i.apply(this,arguments),g={options:f[1],duration:f[2],callback:f[3]},f=g.options.mode,h=d.effects[a];return d.fx.off||!h?f?this[f](g.duration,g.callback):this.each(function(){g.callback&&g.callback.call(this)}):h.call(this,g)},_show:d.fn.show,show:function(a){if(j(a))return this._show.apply(this,
arguments);var b=i.apply(this,arguments);b[1].mode="show";return this.effect.apply(this,b)},_hide:d.fn.hide,hide:function(a){if(j(a))return this._hide.apply(this,arguments);var b=i.apply(this,arguments);b[1].mode="hide";return this.effect.apply(this,b)},__toggle:d.fn.toggle,toggle:function(a){if(j(a)||"boolean"===typeof a||d.isFunction(a))return this.__toggle.apply(this,arguments);var b=i.apply(this,arguments);b[1].mode="toggle";return this.effect.apply(this,b)},cssUnit:function(a){var b=this.css(a),
c=[];d.each(["em","px","%","pt"],function(a,d){0<b.indexOf(d)&&(c=[parseFloat(b),d])});return c}});var k={};d.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,b){k[b]=function(b){return Math.pow(b,a+2)}});d.extend(k,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){for(var b,c=4;a<((b=Math.pow(2,
--c))-1)/11;);return 1/Math.pow(4,3-c)-7.5625*Math.pow((3*b-2)/22-a,2)}});d.each(k,function(a,b){d.easing["easeIn"+a]=b;d.easing["easeOut"+a]=function(a){return 1-b(1-a)};d.easing["easeInOut"+a]=function(a){return 0.5>a?b(2*a)/2:b(-2*a+2)/-2+1}})}(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.blind.js' */
(function(b){b.effects.blind=function(c){return this.queue(function(){var a=b(this),g=["position","top","bottom","left","right"],f=b.effects.setMode(a,c.options.mode||"hide"),d=c.options.direction||"vertical";b.effects.save(a,g);a.show();var e=b.effects.createWrapper(a).css({overflow:"hidden"}),h="vertical"==d?"height":"width",d="vertical"==d?e.height():e.width();"show"==f&&e.css(h,0);var i={};i[h]="show"==f?d:0;e.animate(i,c.duration,c.options.easing,function(){"hide"==f&&a.hide();b.effects.restore(a,
g);b.effects.removeWrapper(a);c.callback&&c.callback.apply(a[0],arguments);a.dequeue()})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.bounce.js' */
(function(e){e.effects.bounce=function(b){return this.queue(function(){var a=e(this),l=["position","top","bottom","left","right"],h=e.effects.setMode(a,b.options.mode||"effect"),d=b.options.direction||"up",c=b.options.distance||20,m=b.options.times||5,i=b.duration||250;/show|hide/.test(h)&&l.push("opacity");e.effects.save(a,l);a.show();e.effects.createWrapper(a);var f="up"==d||"down"==d?"top":"left",d="up"==d||"left"==d?"pos":"neg",c=b.options.distance||("top"==f?a.outerHeight(!0)/3:a.outerWidth(!0)/
3);"show"==h&&a.css("opacity",0).css(f,"pos"==d?-c:c);"hide"==h&&(c/=2*m);"hide"!=h&&m--;if("show"==h){var g={opacity:1};g[f]=("pos"==d?"+=":"-=")+c;a.animate(g,i/2,b.options.easing);c/=2;m--}for(g=0;g<m;g++){var j={},k={};j[f]=("pos"==d?"-=":"+=")+c;k[f]=("pos"==d?"+=":"-=")+c;a.animate(j,i/2,b.options.easing).animate(k,i/2,b.options.easing);c="hide"==h?2*c:c/2}"hide"==h?(g={opacity:0},g[f]=("pos"==d?"-=":"+=")+c,a.animate(g,i/2,b.options.easing,function(){a.hide();e.effects.restore(a,l);e.effects.removeWrapper(a);
b.callback&&b.callback.apply(this,arguments)})):(j={},k={},j[f]=("pos"==d?"-=":"+=")+c,k[f]=("pos"==d?"+=":"-=")+c,a.animate(j,i/2,b.options.easing).animate(k,i/2,b.options.easing,function(){e.effects.restore(a,l);e.effects.removeWrapper(a);b.callback&&b.callback.apply(this,arguments)}));a.queue("fx",function(){a.dequeue()});a.dequeue()})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.clip.js' */
(function(b){b.effects.clip=function(e){return this.queue(function(){var a=b(this),h="position top bottom left right height width".split(" "),f=b.effects.setMode(a,e.options.mode||"hide"),c=e.options.direction||"vertical";b.effects.save(a,h);a.show();var d=b.effects.createWrapper(a).css({overflow:"hidden"}),d="IMG"==a[0].tagName?d:a,i="vertical"==c?"height":"width",j="vertical"==c?"top":"left",c="vertical"==c?d.height():d.width();"show"==f&&(d.css(i,0),d.css(j,c/2));var g={};g[i]="show"==f?c:0;g[j]=
"show"==f?0:c/2;d.animate(g,{queue:!1,duration:e.duration,easing:e.options.easing,complete:function(){f=="hide"&&a.hide();b.effects.restore(a,h);b.effects.removeWrapper(a);e.callback&&e.callback.apply(a[0],arguments);a.dequeue()}})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.drop.js' */
(function(c){c.effects.drop=function(d){return this.queue(function(){var a=c(this),h="position top bottom left right opacity".split(" "),e=c.effects.setMode(a,d.options.mode||"hide"),b=d.options.direction||"left";c.effects.save(a,h);a.show();c.effects.createWrapper(a);var f="up"==b||"down"==b?"top":"left",b="up"==b||"left"==b?"pos":"neg",g=d.options.distance||("top"==f?a.outerHeight(!0)/2:a.outerWidth(!0)/2);"show"==e&&a.css("opacity",0).css(f,"pos"==b?-g:g);var i={opacity:"show"==e?1:0};i[f]=("show"==
e?"pos"==b?"+=":"-=":"pos"==b?"-=":"+=")+g;a.animate(i,{queue:!1,duration:d.duration,easing:d.options.easing,complete:function(){"hide"==e&&a.hide();c.effects.restore(a,h);c.effects.removeWrapper(a);d.callback&&d.callback.apply(this,arguments);a.dequeue()}})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.explode.js' */
(function(j){j.effects.explode=function(a){return this.queue(function(){var c=a.options.pieces?Math.round(Math.sqrt(a.options.pieces)):3,d=a.options.pieces?Math.round(Math.sqrt(a.options.pieces)):3;a.options.mode="toggle"==a.options.mode?j(this).is(":visible")?"hide":"show":a.options.mode;var b=j(this).show().css("visibility","hidden"),e=b.offset();e.top-=parseInt(b.css("marginTop"),10)||0;e.left-=parseInt(b.css("marginLeft"),10)||0;for(var h=b.outerWidth(!0),i=b.outerHeight(!0),f=0;f<c;f++)for(var g=
0;g<d;g++)b.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-g*(h/d),top:-f*(i/c)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:h/d,height:i/c,left:e.left+g*(h/d)+("show"==a.options.mode?(g-Math.floor(d/2))*(h/d):0),top:e.top+f*(i/c)+("show"==a.options.mode?(f-Math.floor(c/2))*(i/c):0),opacity:"show"==a.options.mode?0:1}).animate({left:e.left+g*(h/d)+("show"==a.options.mode?0:(g-Math.floor(d/2))*(h/d)),top:e.top+
f*(i/c)+("show"==a.options.mode?0:(f-Math.floor(c/2))*(i/c)),opacity:"show"==a.options.mode?1:0},a.duration||500);setTimeout(function(){"show"==a.options.mode?b.css({visibility:"visible"}):b.css({visibility:"visible"}).hide();a.callback&&a.callback.apply(b[0]);b.dequeue();j("div.ui-effects-explode").remove()},a.duration||500)})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.fade.js' */
(function(b){b.effects.fade=function(a){return this.queue(function(){var c=b(this),d=b.effects.setMode(c,a.options.mode||"hide");c.animate({opacity:d},{queue:!1,duration:a.duration,easing:a.options.easing,complete:function(){a.callback&&a.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.fold.js' */
(function(c){c.effects.fold=function(a){return this.queue(function(){var b=c(this),j=["position","top","bottom","left","right"],d=c.effects.setMode(b,a.options.mode||"hide"),g=a.options.size||15,h=!!a.options.horizFirst,k=a.duration?a.duration/2:c.fx.speeds._default/2;c.effects.save(b,j);b.show();var e=c.effects.createWrapper(b).css({overflow:"hidden"}),f="show"==d!=h,l=f?["width","height"]:["height","width"],f=f?[e.width(),e.height()]:[e.height(),e.width()],i=/([0-9]+)%/.exec(g);i&&(g=parseInt(i[1],
10)/100*f["hide"==d?0:1]);"show"==d&&e.css(h?{height:0,width:g}:{height:g,width:0});h={};i={};h[l[0]]="show"==d?f[0]:g;i[l[1]]="show"==d?f[1]:0;e.animate(h,k,a.options.easing).animate(i,k,a.options.easing,function(){"hide"==d&&b.hide();c.effects.restore(b,j);c.effects.removeWrapper(b);a.callback&&a.callback.apply(b[0],arguments);b.dequeue()})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.highlight.js' */
(function(b){b.effects.highlight=function(c){return this.queue(function(){var a=b(this),e=["backgroundImage","backgroundColor","opacity"],d=b.effects.setMode(a,c.options.mode||"show"),f={backgroundColor:a.css("backgroundColor")};"hide"==d&&(f.opacity=0);b.effects.save(a,e);a.show().css({backgroundImage:"none",backgroundColor:c.options.color||"#ffff99"}).animate(f,{queue:!1,duration:c.duration,easing:c.options.easing,complete:function(){d=="hide"&&a.hide();b.effects.restore(a,e);d=="show"&&!b.support.opacity&&
this.style.removeAttribute("filter");c.callback&&c.callback.apply(this,arguments);a.dequeue()}})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.pulsate.js' */
(function(e){e.effects.pulsate=function(a){return this.queue(function(){var b=e(this),d=e.effects.setMode(b,a.options.mode||"show"),g=2*(a.options.times||5)-1,h=a.duration?a.duration/2:e.fx.speeds._default/2,f=b.is(":visible"),c=0;f||(b.css("opacity",0).show(),c=1);("hide"==d&&f||"show"==d&&!f)&&g--;for(d=0;d<g;d++)b.animate({opacity:c},h,a.options.easing),c=(c+1)%2;b.animate({opacity:c},h,a.options.easing,function(){c==0&&b.hide();a.callback&&a.callback.apply(this,arguments)});b.queue("fx",function(){b.dequeue()}).dequeue()})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.scale.js' */
(function(c){c.effects.puff=function(b){return this.queue(function(){var a=c(this),d=c.effects.setMode(a,b.options.mode||"hide"),e=parseInt(b.options.percent,10)||150,i=e/100,g={height:a.height(),width:a.width()};c.extend(b.options,{fade:!0,mode:d,percent:"hide"==d?e:100,from:"hide"==d?g:{height:g.height*i,width:g.width*i}});a.effect("scale",b.options,b.duration,b.callback);a.dequeue()})};c.effects.scale=function(b){return this.queue(function(){var a=c(this),d=c.extend(!0,{},b.options),e=c.effects.setMode(a,
b.options.mode||"effect"),i=parseInt(b.options.percent,10)||(0==parseInt(b.options.percent,10)?0:"hide"==e?0:100),g=b.options.direction||"both",f=b.options.origin;"effect"!=e&&(d.origin=f||["middle","center"],d.restore=!0);f={height:a.height(),width:a.width()};a.from=b.options.from||("show"==e?{height:0,width:0}:f);a.to={height:f.height*("horizontal"!=g?i/100:1),width:f.width*("vertical"!=g?i/100:1)};if(b.options.fade&&("show"==e&&(a.from.opacity=0,a.to.opacity=1),"hide"==e))a.from.opacity=1,a.to.opacity=
0;d.from=a.from;d.to=a.to;d.mode=e;a.effect("size",d,b.duration,b.callback);a.dequeue()})};c.effects.size=function(b){return this.queue(function(){var a=c(this),d="position top bottom left right width height overflow opacity".split(" "),e="position top bottom left right overflow opacity".split(" "),i=["width","height","overflow"],g=["fontSize"],f=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],j=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],r=c.effects.setMode(a,
b.options.mode||"effect"),q=b.options.restore||!1,n=b.options.scale||"both",k=b.options.origin,h={height:a.height(),width:a.width()};a.from=b.options.from||h;a.to=b.options.to||h;k&&(k=c.effects.getBaseline(k,h),a.from.top=(h.height-a.from.height)*k.y,a.from.left=(h.width-a.from.width)*k.x,a.to.top=(h.height-a.to.height)*k.y,a.to.left=(h.width-a.to.width)*k.x);var l=a.from.height/h.height,o=a.from.width/h.width,m=a.to.height/h.height,p=a.to.width/h.width;if("box"==n||"both"==n)if(l!=m&&(d=d.concat(f),
a.from=c.effects.setTransition(a,f,l,a.from),a.to=c.effects.setTransition(a,f,m,a.to)),o!=p)d=d.concat(j),a.from=c.effects.setTransition(a,j,o,a.from),a.to=c.effects.setTransition(a,j,p,a.to);if(("content"==n||"both"==n)&&l!=m)d=d.concat(g),a.from=c.effects.setTransition(a,g,l,a.from),a.to=c.effects.setTransition(a,g,m,a.to);c.effects.save(a,q?d:e);a.show();c.effects.createWrapper(a);a.css("overflow","hidden").css(a.from);if("content"==n||"both"==n)f=f.concat(["marginTop","marginBottom"]).concat(g),
j=j.concat(["marginLeft","marginRight"]),i=d.concat(f).concat(j),a.find("*[width]").each(function(){var a=c(this);q&&c.effects.save(a,i);var d=a.height(),e=a.width();a.from={height:d*l,width:e*o};a.to={height:d*m,width:e*p};if(l!=m){a.from=c.effects.setTransition(a,f,l,a.from);a.to=c.effects.setTransition(a,f,m,a.to)}if(o!=p){a.from=c.effects.setTransition(a,j,o,a.from);a.to=c.effects.setTransition(a,j,p,a.to)}a.css(a.from);a.animate(a.to,b.duration,b.options.easing,function(){q&&c.effects.restore(a,
i)})});a.animate(a.to,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){a.to.opacity===0&&a.css("opacity",a.from.opacity);r=="hide"&&a.hide();c.effects.restore(a,q?d:e);c.effects.removeWrapper(a);b.callback&&b.callback.apply(this,arguments);a.dequeue()}})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.shake.js' */
(function(d){d.effects.shake=function(a){return this.queue(function(){var b=d(this),j=["position","top","bottom","left","right"];d.effects.setMode(b,a.options.mode||"effect");var c=a.options.direction||"left",e=a.options.distance||20,l=a.options.times||3,f=a.duration||a.options.duration||140;d.effects.save(b,j);b.show();d.effects.createWrapper(b);var g="up"==c||"down"==c?"top":"left",h="up"==c||"left"==c?"pos":"neg",c={},i={},k={};c[g]=("pos"==h?"-=":"+=")+e;i[g]=("pos"==h?"+=":"-=")+2*e;k[g]=("pos"==
h?"-=":"+=")+2*e;b.animate(c,f,a.options.easing);for(e=1;e<l;e++)b.animate(i,f,a.options.easing).animate(k,f,a.options.easing);b.animate(i,f,a.options.easing).animate(c,f/2,a.options.easing,function(){d.effects.restore(b,j);d.effects.removeWrapper(b);a.callback&&a.callback.apply(this,arguments)});b.queue("fx",function(){b.dequeue()});b.dequeue()})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.slide.js' */
(function(c){c.effects.slide=function(d){return this.queue(function(){var a=c(this),h=["position","top","bottom","left","right"],f=c.effects.setMode(a,d.options.mode||"show"),b=d.options.direction||"left";c.effects.save(a,h);a.show();c.effects.createWrapper(a).css({overflow:"hidden"});var g="up"==b||"down"==b?"top":"left",b="up"==b||"left"==b?"pos":"neg",e=d.options.distance||("top"==g?a.outerHeight(!0):a.outerWidth(!0));"show"==f&&a.css(g,"pos"==b?isNaN(e)?"-"+e:-e:e);var i={};i[g]=("show"==f?"pos"==
b?"+=":"-=":"pos"==b?"-=":"+=")+e;a.animate(i,{queue:!1,duration:d.duration,easing:d.options.easing,complete:function(){"hide"==f&&a.hide();c.effects.restore(a,h);c.effects.removeWrapper(a);d.callback&&d.callback.apply(this,arguments);a.dequeue()}})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery-ui/jquery.effects.transfer.js' */
(function(e){e.effects.transfer=function(a){return this.queue(function(){var b=e(this),c=e(a.options.to),d=c.offset(),c={top:d.top,left:d.left,height:c.innerHeight(),width:c.innerWidth()},d=b.offset(),f=e('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(a.options.className).css({top:d.top,left:d.left,height:b.innerHeight(),width:b.innerWidth(),position:"absolute"}).animate(c,a.duration,a.options.easing,function(){f.remove();a.callback&&a.callback.apply(b[0],arguments);b.dequeue()})})}})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js-vendor/jquery/jquery.ui.menu.js' */
(function(d){d.widget("ui.menu",{_create:function(){var a=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(b){d(b.target).closest(".ui-menu-item a").length&&(b.preventDefault(),a.select(b))});this.refresh()},refresh:function(){var a=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",
-1).mouseenter(function(b){a.activate(b,d(this).parent())}).mouseleave(function(){a.deactivate()})},activate:function(a,b){this.deactivate();if(this.hasScroll()){var c=b.offset().top-this.element.offset().top,e=this.element.attr("scrollTop"),d=this.element.height();0>c?this.element.attr("scrollTop",e+c):c>d&&this.element.attr("scrollTop",e+c-d+b.height())}this.active=b.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",a,{item:b})},deactivate:function(){this.active&&
(this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null)},next:function(a){this.move("next",".ui-menu-item:first",a)},previous:function(a){this.move("prev",".ui-menu-item:last",a)},first:function(){return this.active&&!this.active.prev().length},last:function(){return this.active&&!this.active.next().length},move:function(a,b,c){this.active?(a=this.active[a+"All"](".ui-menu-item").eq(0),a.length?this.activate(c,a):this.activate(c,this.element.children(b))):
this.activate(c,this.element.children(b))},nextPage:function(a){if(this.hasScroll())if(!this.active||this.last())this.activate(a,this.element.children(":first"));else{var b=this.active.offset().top,c=this.element.height(),e=this.element.children("li").filter(function(){var a=d(this).offset().top-b-c+d(this).height();return 10>a&&-10<a});e.length||(e=this.element.children(":last"));this.activate(a,e)}else this.activate(a,this.element.children(!this.active||this.last()?":first":":last"))},previousPage:function(a){if(this.hasScroll())if(!this.active||
this.first())this.activate(a,this.element.children(":last"));else{var b=this.active.offset().top,c=this.element.height();result=this.element.children("li").filter(function(){var a=d(this).offset().top-b+c-d(this).height();return 10>a&&-10<a});result.length||(result=this.element.children(":first"));this.activate(a,result)}else this.activate(a,this.element.children(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element.attr("scrollHeight")},select:function(a){this._trigger("selected",
a,{item:this.active})}})})(jQuery);;
;
/* module-key = 'bamboo.web.resources:jQuery.cookie', location = '/bower/jquery.cookie/jquery.cookie.js' */
/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD
		define(['jquery'], factory);
	} else if (typeof exports === 'object') {
		// CommonJS
		factory(require('jquery'));
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write

		if (value !== undefined && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setTime(+t + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {};

		// To prevent the for loop in the first place assign an empty array
		// in case there are no cookies at all. Also prevents odd result when
		// calling $.cookie().
		var cookies = document.cookie ? document.cookie.split('; ') : [];

		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = parts.join('=');

			if (key && key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) === undefined) {
			return false;
		}

		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
		return !$.cookie(key);
	};

}));
;
;
/* module-key = 'bamboo.web.resources:extraJQuery', location = '/scripts/jquery/tablesorter-2.0.3/jquery.tablesorter.min.js' */

(function($){$.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:'.',debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms");}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s);}else{alert(s);}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug="";}var rows=table.tBodies[0].rows;if(table.tBodies[0].rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.metadata&&($($headers[i]).metadata()&&$($headers[i]).metadata().sorter)){p=getParserById($($headers[i]).metadata().sorter);}else if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter);}if(!p){p=detectParserForColumn(table,cells[i]);}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n";}list.push(p);}}if(table.config.debug){log(parsersDebug);}return list;};function detectParserForColumn(table,node){var l=parsers.length;for(var i=1;i<l;i++){if(parsers[i].is($.trim(getElementText(table.config,node)),table,node)){return parsers[i];}}return parsers[0];}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i];}}return false;}function buildCache(table){if(table.config.debug){var cacheTime=new Date();}var totalRows=(table.tBodies[0]&&table.tBodies[0].rows.length)||0,totalCells=(table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=table.tBodies[0].rows[i],cols=[];cache.row.push($(c));for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c.cells[j]),table,c.cells[j]));}cols.push(i);cache.normalized.push(cols);cols=null;};if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime);}return cache;};function getElementText(config,node){if(!node)return"";var t="";if(config.textExtraction=="simple"){if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){t=node.childNodes[0].innerHTML;}else{t=node.innerHTML;}}else{if(typeof(config.textExtraction)=="function"){t=config.textExtraction(node);}else{t=$(node).text();}}return t;}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){rows.push(r[n[i][checkCell]]);if(!table.config.appender){var o=r[n[i][checkCell]];var l=o.length;for(var j=0;j<l;j++){tableBody[0].appendChild(o[j]);}}}if(table.config.appender){table.config.appender(table,rows);}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime);}applyWidget(table);setTimeout(function(){$(table).trigger("sortEnd");},0);};function buildHeaders(table){if(table.config.debug){var time=new Date();}var meta=($.metadata)?true:false,tableHeadersRows=[];for(var i=0;i<table.tHead.rows.length;i++){tableHeadersRows[i]=0;};$tableHeaders=$("thead th",table);$tableHeaders.each(function(index){this.count=0;this.column=index;this.order=formatSortingOrder(table.config.sortInitialOrder);if(checkHeaderMetadata(this)||checkHeaderOptions(table,index))this.sortDisabled=true;if(!this.sortDisabled){$(this).addClass(table.config.cssHeader);}table.config.headerList[index]=this;});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders);}return $tableHeaders;};function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++));}else{if(table.tHead.length==1||(cell.rowSpan>1||!r[row+1])){arr.push(cell);}}}return arr;};function checkHeaderMetadata(cell){if(($.metadata)&&($(cell).metadata().sorter===false)){return true;};return false;}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true;};return false;}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table);}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i];}}};function formatSortingOrder(v){if(typeof(v)!="Number"){i=(v.toLowerCase()=="desc")?1:0;}else{i=(v==(0||1))?v:0;}return i;}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true;}}return false;}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this);}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]]);}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$('<colgroup>');$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($('<col>').css('width',$(this).width()));});$(table).prepend(colgroup);};}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++;}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date();}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(getCachedSortType(table.config.parsers,c)=="text")?((order==0)?"sortText":"sortTextDesc"):((order==0)?"sortNumeric":"sortNumericDesc");var e="e"+i;dynamicExp+="var "+e+" = "+s+"(a["+c+"],b["+c+"]); ";dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { ";}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; ";}dynamicExp+="return 0; ";dynamicExp+="}; ";eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime);}return cache;};function sortText(a,b){return((a<b)?-1:((a>b)?1:0));};function sortTextDesc(a,b){return((b<a)?-1:((b>a)?1:0));};function sortNumeric(a,b){return a-b;};function sortNumericDesc(a,b){return b-a;};function getCachedSortType(parsers,i){return parsers[i].type;};this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies)return;var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);$this=$(this);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){$this.trigger("sortStart");var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){var $cell=$(this);var i=this.column;this.order=this.count++%2;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j]);}}}config.sortList.push([i,this.order]);}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2;}}}else{config.sortList.push([i,this.order]);}};setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache));},1);return false;}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false;}});$this.bind("update",function(){this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);}).bind("sorton",function(e,list){$(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache));}).bind("appendCache",function(){appendToTable(this,cache);}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this);}).bind("applyWidgets",function(){applyWidget(this);});if($.metadata&&($(this).metadata()&&$(this).metadata().sortlist)){config.sortList=$(this).metadata().sortlist;}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList]);}applyWidget(this);});};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false;}}if(a){parsers.push(parser);};};this.addWidget=function(widget){widgets.push(widget);};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i;};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i;};this.isDigit=function(s,config){var DECIMAL='\\'+config.decimal;var exp='/(^[+]?0('+DECIMAL+'0+)?$)|(^([-+]?[1-9][0-9]*)$)|(^([-+]?((0?|[1-9][0-9]*)'+DECIMAL+'(0*[1-9][0-9]*)))$)|(^[-+]?[1-9]+[0-9]*'+DECIMAL+'0+$)/';return RegExp(exp).test($.trim(s));};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild)this.removeChild(this.firstChild);}empty.apply(table.tBodies[0]);}else{table.tBodies[0].innerHTML="";}};}});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true;},format:function(s){return $.trim(s.toLowerCase());},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $.tablesorter.isDigit(s,c);},format:function(s){return $.tablesorter.formatFloat(s);},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[$?.]/.test(s);},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[^0-9.]/g),""));},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s);},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item;}else{r+=item;}}return $.tablesorter.formatFloat(r);},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s);},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),''));},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s);},format:function(s){return $.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0");},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($.trim(s));},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""));},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/));},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s);},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");}else if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");}else if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");}return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s);},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime());},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false;},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?'sortValue':c.parserMetadataName;return $(cell).metadata()[p];},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date();}$("tr:visible",table.tBodies[0]).filter(':even').removeClass(table.config.widgetZebra.css[1]).addClass(table.config.widgetZebra.css[0]).end().filter(':odd').removeClass(table.config.widgetZebra.css[0]).addClass(table.config.widgetZebra.css[1]);if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time);}}});})(jQuery);;
;
/* module-key = 'com.atlassian.auiplugin:ajs-backbone', location = 'js-vendor/backbone/backbone.js' */
(function(){var l=this,A=l.Backbone,m=[],B=m.push,s=m.slice,C=m.splice,g;g="undefined"!==typeof exports?exports:l.Backbone={};g.VERSION="1.0.0";var e=l._;!e&&"undefined"!==typeof require&&(e=require("underscore"));g.$=l.jQuery||l.Zepto||l.ender||l.$;g.noConflict=function(){l.Backbone=A;return this};g.emulateHTTP=!1;g.emulateJSON=!1;var h=g.Events={on:function(a,b,c){if(!p(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:b,context:c,
ctx:c||this});return this},once:function(a,b,c){if(!p(this,"once",a,[b,c])||!b)return this;var d=this,f=e.once(function(){d.off(a,f);b.apply(this,arguments)});f._callback=b;return this.on(a,f,c)},off:function(a,b,c){var d,f,t,g,n,u,k,h;if(!this._events||!p(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;g=a?[a]:e.keys(this._events);n=0;for(u=g.length;n<u;n++)if(a=g[n],t=this._events[a]){this._events[a]=d=[];if(b||c){k=0;for(h=t.length;k<h;k++)f=t[k],(b&&b!==f.callback&&b!==
f.callback._callback||c&&c!==f.context)&&d.push(f)}d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=s.call(arguments,1);if(!p(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;c&&v(c,b);d&&v(d,arguments);return this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var f=!b&&!c;"object"===typeof b&&(c=this);a&&((d={})[a._listenerId]=a);for(var e in d)d[e].off(b,c,this),f&&delete this._listeners[e];return this}},
w=/\s+/,p=function(a,b,c,d){if(!c)return!0;if("object"===typeof c){for(var f in c)a[b].apply(a,[f,c[f]].concat(d));return!1}if(w.test(c)){c=c.split(w);f=0;for(var e=c.length;f<e;f++)a[b].apply(a,[c[f]].concat(d));return!1}return!0},v=function(a,b){var c,d=-1,f=a.length,e=b[0],g=b[1],n=b[2];switch(b.length){case 0:for(;++d<f;)(c=a[d]).callback.call(c.ctx);break;case 1:for(;++d<f;)(c=a[d]).callback.call(c.ctx,e);break;case 2:for(;++d<f;)(c=a[d]).callback.call(c.ctx,e,g);break;case 3:for(;++d<f;)(c=
a[d]).callback.call(c.ctx,e,g,n);break;default:for(;++d<f;)(c=a[d]).callback.apply(c.ctx,b)}};e.each({listenTo:"on",listenToOnce:"once"},function(a,b){h[b]=function(b,d,f){var g=this._listeners||(this._listeners={}),j=b._listenerId||(b._listenerId=e.uniqueId("l"));g[j]=b;"object"===typeof d&&(f=this);b[a](d,f,this);return this}});h.bind=h.on;h.unbind=h.off;e.extend(g,h);var o=g.Model=function(a,b){var c,d=a||{};b||(b={});this.cid=e.uniqueId("c");this.attributes={};e.extend(this,e.pick(b,D));b.parse&&
(d=this.parse(d,b)||{});if(c=e.result(this,"defaults"))d=e.defaults({},d,c);this.set(d,b);this.changed={};this.initialize.apply(this,arguments)},D=["url","urlRoot","collection"];e.extend(o.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return e.clone(this.attributes)},sync:function(){return g.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return e.escape(this.get(a))},has:function(a){return null!=
this.get(a)},set:function(a,b,c){var d,f,g,j,n,h,k;if(null==a)return this;"object"===typeof a?(f=a,c=b):(f={})[a]=b;c||(c={});if(!this._validate(f,c))return!1;g=c.unset;j=c.silent;a=[];n=this._changing;this._changing=!0;n||(this._previousAttributes=e.clone(this.attributes),this.changed={});k=this.attributes;h=this._previousAttributes;this.idAttribute in f&&(this.id=f[this.idAttribute]);for(d in f)b=f[d],e.isEqual(k[d],b)||a.push(d),e.isEqual(h[d],b)?delete this.changed[d]:this.changed[d]=b,g?delete k[d]:
k[d]=b;if(!j){a.length&&(this._pending=!0);b=0;for(d=a.length;b<d;b++)this.trigger("change:"+a[b],this,k[a[b]],c)}if(n)return this;if(!j)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);this._changing=this._pending=!1;return this},unset:function(a,b){return this.set(a,void 0,e.extend({},b,{unset:!0}))},clear:function(a){var b={},c;for(c in this.attributes)b[c]=void 0;return this.set(b,e.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!e.isEmpty(this.changed):e.has(this.changed,
a)},changedAttributes:function(a){if(!a)return this.hasChanged()?e.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes,f;for(f in a)if(!e.isEqual(d[f],b=a[f]))(c||(c={}))[f]=b;return c},previous:function(a){return null==a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return e.clone(this._previousAttributes)},fetch:function(a){a=a?e.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d){if(!b.set(b.parse(d,
a),a))return false;c&&c(b,d,a);b.trigger("sync",b,d,a)};q(this,a);return this.sync("read",this,a)},save:function(a,b,c){var d,f=this.attributes;null==a||"object"===typeof a?(d=a,c=b):(d={})[a]=b;if(d&&(!c||!c.wait)&&!this.set(d,c))return!1;c=e.extend({validate:!0},c);if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=e.extend({},f,d));void 0===c.parse&&(c.parse=!0);var g=this,j=c.success;c.success=function(a){g.attributes=f;var b=g.parse(a,c);c.wait&&(b=e.extend(d||{},b));if(e.isObject(b)&&
!g.set(b,c))return false;j&&j(g,a,c);g.trigger("sync",g,a,c)};q(this,c);a=this.isNew()?"create":c.patch?"patch":"update";"patch"===a&&(c.attrs=d);a=this.sync(a,this,c);d&&c.wait&&(this.attributes=f);return a},destroy:function(a){var a=a?e.clone(a):{},b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(e){(a.wait||b.isNew())&&d();c&&c(b,e,a);b.isNew()||b.trigger("sync",b,e,a)};if(this.isNew())return a.success(),!1;q(this,a);var f=this.sync("delete",this,a);a.wait||
d();return f},url:function(){var a=e.result(this,"urlRoot")||e.result(this.collection,"url")||x();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},e.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;var a=e.extend({},this.attributes,a),c=this.validationError=
this.validate(a,b)||null;if(!c)return!0;this.trigger("invalid",this,c,e.extend(b||{},{validationError:c}));return!1}});e.each("keys values pairs invert pick omit".split(" "),function(a){o.prototype[a]=function(){var b=s.call(arguments);b.unshift(this.attributes);return e[a].apply(e,b)}});var r=g.Collection=function(a,b){b||(b={});b.url&&(this.url=b.url);b.model&&(this.model=b.model);void 0!==b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,
e.extend({silent:!0},b))},E={add:!0,remove:!0,merge:!0},F={add:!0,merge:!1,remove:!1};e.extend(r.prototype,h,{model:o,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return g.sync.apply(this,arguments)},add:function(a,b){return this.set(a,e.defaults(b||{},F))},remove:function(a,b){a=e.isArray(a)?a.slice():[a];b||(b={});var c,d,f,g;c=0;for(d=a.length;c<d;c++)if(g=this.get(a[c]))delete this._byId[g.id],delete this._byId[g.cid],f=this.indexOf(g),
this.models.splice(f,1),this.length--,b.silent||(b.index=f,g.trigger("remove",g,this,b)),this._removeReference(g);return this},set:function(a,b){b=e.defaults(b||{},E);b.parse&&(a=this.parse(a,b));e.isArray(a)||(a=a?[a]:[]);var c,d,f,g,j,h=b.at,l=this.comparator&&null==h&&!1!==b.sort,k=e.isString(this.comparator)?this.comparator:null,i=[],m=[],o={};c=0;for(d=a.length;c<d;c++)if(f=this._prepareModel(a[c],b))(g=this.get(f))?(b.remove&&(o[g.cid]=!0),b.merge&&(g.set(f.attributes,b),l&&(!j&&g.hasChanged(k))&&
(j=!0))):b.add&&(i.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f));if(b.remove){c=0;for(d=this.length;c<d;++c)o[(f=this.models[c]).cid]||m.push(f);m.length&&this.remove(m,b)}i.length&&(l&&(j=!0),this.length+=i.length,null!=h?C.apply(this.models,[h,0].concat(i)):B.apply(this.models,i));j&&this.sort({silent:!0});if(b.silent)return this;c=0;for(d=i.length;c<d;c++)(f=i[c]).trigger("add",f,this,b);j&&this.trigger("sort",this,b);return this},reset:function(a,
b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);b.previousModels=this.models;this._reset();this.add(a,e.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,e.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,e.extend({at:0},b));return a},shift:function(a){var b=
this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return e.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var d in a)if(a[d]!==b.get(d))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");a||(a={});e.isString(this.comparator)||
1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(e.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=e.isFunction(b)?b:function(a){return a.get(b)};return e.sortedIndex(this.models,a,d,c)},pluck:function(a){return e.invoke(this.models,"get",a)},fetch:function(a){a=a?e.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;a.success=function(d){c[a.reset?"reset":
"set"](d,a);b&&b(c,d,a);c.trigger("sync",c,d,a)};q(this,a);return this.sync("read",this,a)},create:function(a,b){b=b?e.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;b.success=function(a,b,e){e.wait&&c.add(a,e);d&&d(a,b,e)};a.save(null,b);return a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof o)return a.collection||
(a.collection=this),a;b||(b={});b.collection=this;var c=new this.model(a,b);return!c._validate(a,b)?(this.trigger("invalid",this,a,b),!1):c},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"===a||"remove"===a)&&c!==this||("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});
e.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),function(a){r.prototype[a]=function(){var b=s.call(arguments);b.unshift(this.models);return e[a].apply(e,b)}});e.each(["groupBy","countBy","sortBy"],function(a){r.prototype[a]=function(b,c){var d=e.isFunction(b)?b:function(a){return a.get(b)};
return e[a](this.models,d,c)}});var m=g.View=function(a){this.cid=e.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},G=/^(\S+)\s*(.*)$/,H="model collection el id attributes className tagName events".split(" ");e.extend(m.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,
b){this.$el&&this.undelegateEvents();this.$el=a instanceof g.$?a:g.$(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(!a&&!(a=e.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];e.isFunction(c)||(c=this[a[b]]);if(c){var d=b.match(G),f=d[1],d=d[2],c=e.bind(c,this),f=f+(".delegateEvents"+this.cid);if(""===d)this.$el.on(f,c);else this.$el.on(f,d,c)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+
this.cid);return this},_configure:function(a){this.options&&(a=e.extend({},e.result(this,"options"),a));e.extend(this,e.pick(a,H));this.options=a},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"),!1);else{var a=e.extend({},e.result(this,"attributes"));this.id&&(a.id=e.result(this,"id"));this.className&&(a["class"]=e.result(this,"className"));a=g.$("<"+e.result(this,"tagName")+">").attr(a);this.setElement(a,!1)}}});g.sync=function(a,b,c){var d=I[a];e.defaults(c||(c={}),{emulateHTTP:g.emulateHTTP,
emulateJSON:g.emulateJSON});var f={type:d,dataType:"json"};c.url||(f.url=e.result(b,"url")||x());if(null==c.data&&b&&("create"===a||"update"===a||"patch"===a))f.contentType="application/json",f.data=JSON.stringify(c.attrs||b.toJSON(c));c.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{});if(c.emulateHTTP&&("PUT"===d||"DELETE"===d||"PATCH"===d)){f.type="POST";c.emulateJSON&&(f.data._method=d);var h=c.beforeSend;c.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",
d);if(h)return h.apply(this,arguments)}}"GET"!==f.type&&!c.emulateJSON&&(f.processData=!1);if("PATCH"===f.type&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled))f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")};a=c.xhr=g.ajax(e.extend(f,c));b.trigger("request",b,a,c);return a};var I={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};g.ajax=function(){return g.$.ajax.apply(g.$,arguments)};var y=g.Router=function(a){a||(a={});a.routes&&
(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},J=/\((.*?)\)/g,K=/(\(\?)?:\w+/g,L=/\*\w+/g,M=/[\-{}\[\]+?.,\\\^$|#\s]/g;e.extend(y.prototype,h,{initialize:function(){},route:function(a,b,c){e.isRegExp(a)||(a=this._routeToRegExp(a));e.isFunction(b)&&(c=b,b="");c||(c=this[b]);var d=this;g.history.route(a,function(e){e=d._extractParameters(a,e);c&&c.apply(d,e);d.trigger.apply(d,["route:"+b].concat(e));d.trigger("route",b,e);g.history.trigger("route",d,b,e)});return this},
navigate:function(a,b){g.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var a,b=e.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(M,"\\$&").replace(J,"(?:$1)?").replace(K,function(a,c){return c?a:"([^/]+)"}).replace(L,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return e.map(c,function(a){return a?decodeURIComponent(a):null})}});
var i=g.History=function(){this.handlers=[];e.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},z=/^[#\/]|\s+$/g,N=/^\/+|\/+$/g,O=/msie [\w.]+/,P=/\/$/;i.started=!1;e.extend(i.prototype,h,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){var a=this.location.pathname,c=this.root.replace(P,"");a.indexOf(c)||
(a=a.substr(c.length))}else a=this.getHash();return a.replace(z,"")},start:function(a){if(i.started)throw Error("Backbone.history has already been started");i.started=!0;this.options=e.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!this.history||!this.history.pushState);var a=this.getFragment(),b=document.documentMode,b=O.exec(navigator.userAgent.toLowerCase())&&
(!b||7>=b);this.root=("/"+this.root+"/").replace(N,"/");b&&this._wantsHashChange&&(this.iframe=g.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)g.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!b)g.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,
"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&(this._hasPushState&&b&&a.hash)&&(this.fragment=this.getHash().replace(z,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){g.$(window).off("popstate",this.checkUrl).off("hashchange",
this.checkUrl);clearInterval(this._checkUrlInterval);i.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return e.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),
!0})},navigate:function(a,b){if(!i.started)return!1;if(!b||!0===b)b={trigger:b};a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);
b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});g.history=new i;o.extend=r.extend=y.extend=m.extend=i.extend=function(a,b){var c=this,d;d=a&&e.has(a,"constructor")?a.constructor:function(){return c.apply(this,arguments)};e.extend(d,c,b);var f=function(){this.constructor=d};f.prototype=c.prototype;d.prototype=new f;a&&e.extend(d.prototype,a);d.__super__=c.prototype;return d};var x=function(){throw Error('A "url" property or function must be specified');
},q=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b);a.trigger("error",a,d,b)}}}).call(this);"function"===typeof window.define&&define("backbone",["underscore"],function(){return window.Backbone});;
;
/* module-key = 'bamboo.web.resources:lib-backbone', location = '/bower/backbone.wreqr/backbone.wreqr.js' */
// Backbone.Wreqr (Backbone.Marionette)
// ----------------------------------
// v1.3.2
//
// Copyright (c)2014 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://github.com/marionettejs/backbone.wreqr


(function(root, factory) {

  if (typeof define === 'function' && define.amd) {
    define(['backbone', 'underscore'], function(Backbone, _) {
      return factory(Backbone, _);
    });
  } else if (typeof exports !== 'undefined') {
    var Backbone = require('backbone');
    var _ = require('underscore');
    module.exports = factory(Backbone, _);
  } else {
    factory(root.Backbone, root._);
  }

}(this, function(Backbone, _) {
  "use strict";

  var previousWreqr = Backbone.Wreqr;

  var Wreqr = Backbone.Wreqr = {};

  Backbone.Wreqr.VERSION = '1.3.2';

  Backbone.Wreqr.noConflict = function () {
    Backbone.Wreqr = previousWreqr;
    return this;
  };

  // Handlers
  // --------
  // A registry of functions to call, given a name
  
  Wreqr.Handlers = (function(Backbone, _){
    "use strict";
    
    // Constructor
    // -----------
  
    var Handlers = function(options){
      this.options = options;
      this._wreqrHandlers = {};
      
      if (_.isFunction(this.initialize)){
        this.initialize(options);
      }
    };
  
    Handlers.extend = Backbone.Model.extend;
  
    // Instance Members
    // ----------------
  
    _.extend(Handlers.prototype, Backbone.Events, {
  
      // Add multiple handlers using an object literal configuration
      setHandlers: function(handlers){
        _.each(handlers, function(handler, name){
          var context = null;
  
          if (_.isObject(handler) && !_.isFunction(handler)){
            context = handler.context;
            handler = handler.callback;
          }
  
          this.setHandler(name, handler, context);
        }, this);
      },
  
      // Add a handler for the given name, with an
      // optional context to run the handler within
      setHandler: function(name, handler, context){
        var config = {
          callback: handler,
          context: context
        };
  
        this._wreqrHandlers[name] = config;
  
        this.trigger("handler:add", name, handler, context);
      },
  
      // Determine whether or not a handler is registered
      hasHandler: function(name){
        return !! this._wreqrHandlers[name];
      },
  
      // Get the currently registered handler for
      // the specified name. Throws an exception if
      // no handler is found.
      getHandler: function(name){
        var config = this._wreqrHandlers[name];
  
        if (!config){
          return;
        }
  
        return function(){
          return config.callback.apply(config.context, arguments);
        };
      },
  
      // Remove a handler for the specified name
      removeHandler: function(name){
        delete this._wreqrHandlers[name];
      },
  
      // Remove all handlers from this registry
      removeAllHandlers: function(){
        this._wreqrHandlers = {};
      }
    });
  
    return Handlers;
  })(Backbone, _);
  
  // Wreqr.CommandStorage
  // --------------------
  //
  // Store and retrieve commands for execution.
  Wreqr.CommandStorage = (function(){
    "use strict";
  
    // Constructor function
    var CommandStorage = function(options){
      this.options = options;
      this._commands = {};
  
      if (_.isFunction(this.initialize)){
        this.initialize(options);
      }
    };
  
    // Instance methods
    _.extend(CommandStorage.prototype, Backbone.Events, {
  
      // Get an object literal by command name, that contains
      // the `commandName` and the `instances` of all commands
      // represented as an array of arguments to process
      getCommands: function(commandName){
        var commands = this._commands[commandName];
  
        // we don't have it, so add it
        if (!commands){
  
          // build the configuration
          commands = {
            command: commandName, 
            instances: []
          };
  
          // store it
          this._commands[commandName] = commands;
        }
  
        return commands;
      },
  
      // Add a command by name, to the storage and store the
      // args for the command
      addCommand: function(commandName, args){
        var command = this.getCommands(commandName);
        command.instances.push(args);
      },
  
      // Clear all commands for the given `commandName`
      clearCommands: function(commandName){
        var command = this.getCommands(commandName);
        command.instances = [];
      }
    });
  
    return CommandStorage;
  })();
  
  // Wreqr.Commands
  // --------------
  //
  // A simple command pattern implementation. Register a command
  // handler and execute it.
  Wreqr.Commands = (function(Wreqr, _){
    "use strict";
  
    return Wreqr.Handlers.extend({
      // default storage type
      storageType: Wreqr.CommandStorage,
  
      constructor: function(options){
        this.options = options || {};
  
        this._initializeStorage(this.options);
        this.on("handler:add", this._executeCommands, this);
  
        Wreqr.Handlers.prototype.constructor.apply(this, arguments);
      },
  
      // Execute a named command with the supplied args
      execute: function(name){
        name = arguments[0];
        var args = _.rest(arguments);
  
        if (this.hasHandler(name)){
          this.getHandler(name).apply(this, args);
        } else {
          this.storage.addCommand(name, args);
        }
  
      },
  
      // Internal method to handle bulk execution of stored commands
      _executeCommands: function(name, handler, context){
        var command = this.storage.getCommands(name);
  
        // loop through and execute all the stored command instances
        _.each(command.instances, function(args){
          handler.apply(context, args);
        });
  
        this.storage.clearCommands(name);
      },
  
      // Internal method to initialize storage either from the type's
      // `storageType` or the instance `options.storageType`.
      _initializeStorage: function(options){
        var storage;
  
        var StorageType = options.storageType || this.storageType;
        if (_.isFunction(StorageType)){
          storage = new StorageType();
        } else {
          storage = StorageType;
        }
  
        this.storage = storage;
      }
    });
  
  })(Wreqr, _);
  
  // Wreqr.RequestResponse
  // ---------------------
  //
  // A simple request/response implementation. Register a
  // request handler, and return a response from it
  Wreqr.RequestResponse = (function(Wreqr, _){
    "use strict";
  
    return Wreqr.Handlers.extend({
      request: function(name){
        if (this.hasHandler(name)) {
          return this.getHandler(name).apply(this, _.rest(arguments));
        }
      }
    });
  
  })(Wreqr, _);
  
  // Event Aggregator
  // ----------------
  // A pub-sub object that can be used to decouple various parts
  // of an application through event-driven architecture.
  
  Wreqr.EventAggregator = (function(Backbone, _){
    "use strict";
    var EA = function(){};
  
    // Copy the `extend` function used by Backbone's classes
    EA.extend = Backbone.Model.extend;
  
    // Copy the basic Backbone.Events on to the event aggregator
    _.extend(EA.prototype, Backbone.Events);
  
    return EA;
  })(Backbone, _);
  
  // Wreqr.Channel
  // --------------
  //
  // An object that wraps the three messaging systems:
  // EventAggregator, RequestResponse, Commands
  Wreqr.Channel = (function(Wreqr){
    "use strict";
  
    var Channel = function(channelName) {
      this.vent        = new Backbone.Wreqr.EventAggregator();
      this.reqres      = new Backbone.Wreqr.RequestResponse();
      this.commands    = new Backbone.Wreqr.Commands();
      this.channelName = channelName;
    };
  
    _.extend(Channel.prototype, {
  
      // Remove all handlers from the messaging systems of this channel
      reset: function() {
        this.vent.off();
        this.vent.stopListening();
        this.reqres.removeAllHandlers();
        this.commands.removeAllHandlers();
        return this;
      },
  
      // Connect a hash of events; one for each messaging system
      connectEvents: function(hash, context) {
        this._connect('vent', hash, context);
        return this;
      },
  
      connectCommands: function(hash, context) {
        this._connect('commands', hash, context);
        return this;
      },
  
      connectRequests: function(hash, context) {
        this._connect('reqres', hash, context);
        return this;
      },
  
      // Attach the handlers to a given message system `type`
      _connect: function(type, hash, context) {
        if (!hash) {
          return;
        }
  
        context = context || this;
        var method = (type === 'vent') ? 'on' : 'setHandler';
  
        _.each(hash, function(fn, eventName) {
          this[type][method](eventName, _.bind(fn, context));
        }, this);
      }
    });
  
  
    return Channel;
  })(Wreqr);
  
  // Wreqr.Radio
  // --------------
  //
  // An object that lets you communicate with many channels.
  Wreqr.radio = (function(Wreqr, _){
    "use strict";
  
    var Radio = function() {
      this._channels = {};
      this.vent = {};
      this.commands = {};
      this.reqres = {};
      this._proxyMethods();
    };
  
    _.extend(Radio.prototype, {
  
      channel: function(channelName) {
        if (!channelName) {
          throw new Error('Channel must receive a name');
        }
  
        return this._getChannel( channelName );
      },
  
      _getChannel: function(channelName) {
        var channel = this._channels[channelName];
  
        if(!channel) {
          channel = new Wreqr.Channel(channelName);
          this._channels[channelName] = channel;
        }
  
        return channel;
      },
  
      _proxyMethods: function() {
        _.each(['vent', 'commands', 'reqres'], function(system) {
          _.each( messageSystems[system], function(method) {
            this[system][method] = proxyMethod(this, system, method);
          }, this);
        }, this);
      }
    });
  
  
    var messageSystems = {
      vent: [
        'on',
        'off',
        'trigger',
        'once',
        'stopListening',
        'listenTo',
        'listenToOnce'
      ],
  
      commands: [
        'execute',
        'setHandler',
        'setHandlers',
        'removeHandler',
        'removeAllHandlers'
      ],
  
      reqres: [
        'request',
        'setHandler',
        'setHandlers',
        'removeHandler',
        'removeAllHandlers'
      ]
    };
  
    var proxyMethod = function(radio, system, method) {
      return function(channelName) {
        var messageSystem = radio._getChannel(channelName)[system];
  
        return messageSystem[method].apply(messageSystem, _.rest(arguments));
      };
    };
  
    return new Radio();
  
  })(Wreqr, _);
  

  return Backbone.Wreqr;

}));
;
;
/* module-key = 'bamboo.web.resources:lib-backbone', location = '/bower/backbone-brace/backbone.brace.js' */
(function (root, factory) {
    // Global to export
    var rootExport = 'Brace';
    // Store a reference to any other copies of Brace include (if any)
    var previousBrace = root[rootExport];

    // noConflict will return this version of Brace and reset the global
    // Brace variable to the previously loaded version of Brace (or undefined
    // if there was no previous version loaded).
    /**
     * Returns the current copy of Brace and sets the global Brace object to the
     * previous version (or undefined if there was no previous version loaded).
     *
     * @returns Object A reference to this version of Brace.
     */
    var noConflict = function () {
        root[rootExport] = previousBrace;
        return this;
    };

    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['underscore', 'backbone'], factory);
    } else if (typeof exports === 'object') {
        // Node. Does not work with strict CommonJS, but
        // only CommonJS-like enviroments that support module.exports,
        // like Node.
        module.exports = factory(require('underscore'), require('backbone'));
    } else {
        // Browser globals
        var _brace = factory(root._, root.Backbone);
        _brace.noConflict = noConflict;
        root[rootExport] = _brace;
    }
}(this, function (_, Backbone) {

    var Brace = {};

    // ## Helper functions

    // Given an array, this function will return an object where each
    //     property name is an element of the original array. The value
    //     of each property will be null.
    // Given anything else, this function will return the object untouched.
    /**
     * This function is used to ensure a consistent shape for the namedAttributes property.
     * namedAttributes accepts two formats:
     * - An array like ['attr1', 'attr2'] if you don't care about the type of any attribute.
     * - An object like { attr1 : type1, attr2 : type2 } to specify an expected type.
     *
     * @param maybeArray {*} thing to transform into an object
     */
    function asObject(maybeArray) {
        if (_.isArray(maybeArray)) {
            return _.reduce(maybeArray, function(obj, prop) {
                obj[prop] =  null;
                return obj;
            }, {});
        }
        return maybeArray;
    }

    // Return a value of the specified type, generated from the value parameter.
    // If type conversion is necessary, this function will generate a new object using
    // `new type(value)`
    //
    // `value` Any value. null and undefined values will be untouched.
    //
    // `type` When given:
    //
    // * a falsy value: this function will do no type conversion.
    // * a string: this function will throw if `typeof value !== type`, and return value otherwise.
    // * an Array: this function will be recursively called for each element in value using
    //   type's first element as the type. E.g.,
    //         `ensureType([ Number ], [ 1 ])` will recursively call `ensureType(Number, 1)`
    //   It will return a new array consisting of the result of each recursive call.
    // * a Backbone.Collection constructor: this function may be recursively called for each element in
    //     value using type.model as the type. E.g.,
    //         `ensureType({ model : Number, __proto__ : Backbone.Collection.prototype }, [ 1 ])` will
    //         recursively call `ensureType(Number, 1)`
    //     It will return a Backbone.Collection via new type({array of recursive results})
    // * a function: This will check value instanceof type, and if false, will return `new type(value)`
    //     Otherwise it will return value directly
    /**
     * @param value {*}
     * @param type {Array|function(new:*, *)|string|false|null|undefined}
     */
    function ensureType(type, value) {
        /*jshint newcap: false */
        if (!type || value == null) {
            return value;
        }

        if (type === String && _.isString(value)) {
            return value;
        }
        if (type === Number && _.isNumber(value)) {
            return value;
        }
        if (type === Boolean && _.isBoolean(value)) {
            return value;
        }

        if (typeof type === 'string' || type instanceof String) {
            if (typeof value !== ""+type) {
                throw "The typeof " + value + " is " + typeof value + " but expected it to be " + type;
            }
            return value;
        }

        if (_.isArray(type) || type === Array) {
            if (!isArrayLike(value)) {
                throw "Array type expected, but nonnull, non-Array value provided.";
            }
            return type === Array || !type[0] ?
                value :
                _.map(value, _.bind(ensureType, null, type[0]));
        }

        if (typeof type !== 'function') {
            throw "Invalid expected type " + type +
            '. Should be falsy, String, Array, Backbone.Collection constructor, or function.';
        }

        if (value instanceof type) {
            return value;
        }

        if (isCollectionConstructor(type)) {
            return new type(ensureType([ type.model ], value));
        }

        return new type(value);
    }

    // Returns true if obj is extend()'ed from Backbone.Collection (or from another collection)
    /**
     * @param obj {*} object to check
     * @param rootConstructor {?function(new:Backbone.Collection)} optional constructor that inherits from
     *        Backbone.Collection. Will check that obj is extend()'ed from this instead of Backbone.Collection.
     */
    function isCollectionConstructor(obj, rootConstructor) {
        return  obj && (
            // obj *distantly* extends Backbone.Collection (most likely case)
            obj.__super__ instanceof (rootConstructor || Backbone.Collection) ||

            // obj *directly* extends Backbone.Collection (e.g., Brace.Collection)
            // !(fn.prototype instanceof fn), so the above check doesn't catch this case.
            obj.__super__ === (rootConstructor || Backbone.Collection).prototype ||

            // obj *is* Backbone.Collection
            obj === (rootConstructor || Backbone.Collection)
        );
    }

    // array-like is currently defined by "has a length property, and is not a string or
    // function or Backbone.Collection."
    // Backbone.Collections are excluded because you can't do collection[0] to access models.
    function isArrayLike(value) {
        return _.has(value,'length') && !(
            value instanceof String ||
            _.has({'string':1, 'function':1}, typeof value) ||
            value instanceof Backbone.Collection
        );
    }

    // With namedAttributes, we want to allow both the mixin, and the extender to define types.
    // We want to take the stricter of the two types where possible.
    // Where the types conflict, throw an error.
    function nonConflictedTypes(obj, refObj) {
        var newObj = {};
        _.each(obj, function(val, key) {
            if (!refObj[key] || assumes(val, refObj[key])) {
                newObj[key] = val;
            } else if (!val || assumes(refObj[key], val)) {
                return;
            } else {
                throw key + " has conflicted type descriptors.";
            }
        });
        return newObj;
    }

    // One type *assumes* another when the conditions for meeting its
    // type-check are a super set of the assumed type's conditions.
    // E.g., `[ 'string' ]` assumes `Array` because you can't have an array of strings without an array.
    function assumes(assumer, assumed) {
        if (!assumed || assumed === assumer) {
            return true;
        }
        // if it's a string, only the previous strict equality check would have sufficed.
        if (!assumer || typeof assumer === 'string') {
            return false;
        }
        if (assumer instanceof Array) {
            return assumed === Array ||
                (assumed instanceof Array && assumes(assumer[0], assumed[0]));
        }
        if (typeof assumed !== 'function') {
            return false;
        }
        if (isCollectionConstructor(assumed)) {
            return isCollectionConstructor(assumer, assumed);
        }
        return assumer.prototype instanceof assumed;
    }

    /**
     * @param {Object?} object
     * @return {Object} plain object
     */
    function nestedToJSON(object) {
        if (_.isObject(object)) {
            return _.reduce(object, function(memo, value, key) {
                if (value && _.isFunction(value.toJSON)) {
                    memo[key] = value.toJSON();
                } else if (_.isArray(value)) {
                    memo[key] = _.map(value, function(el) {
                        if (el && _.isFunction(el.toJSON)) {
                            return el.toJSON();
                        } else {
                            return el;
                        }
                    });
                }
                return memo;
            }, object);
        } else {
            return object;
        }
    }

    function createToJSON(previousToJSON) {
        return function toJSON() {
            var json = previousToJSON.call(this);
            return nestedToJSON(json);
        };
    }

    // ## Brace.Mixins ##
    // Mixin utilities
    Brace.Mixins = {
        // Creates a camelCased method name
        createMethodName: function(prefix, suffix) {
            return prefix + suffix.charAt(0).toUpperCase() + suffix.substr(1);
        },

        // Applies a mixin to the given constructor's prototype.
        applyMixin: function(ctor, mixin) {
            _.forEach(_.keys(mixin), function(key) {
                var proto = ctor.prototype;

                // `initialize` is not mixed in - we compose the mixin's initialize with the existing initialize method (if it exists).
                if ("initialize" === key) {
                    var oldInitialize = proto.initialize;
                    proto.initialize = function() {
                        if (oldInitialize) {
                            oldInitialize.apply(this, arguments);
                        }
                        mixin.initialize.apply(this, arguments);
                    };
                    return;
                }
                // `validate` is not mixed in - we compose the mixin's validate with the existing validate method (if it exists).
                if ("validate" === key) {
                    var oldValidate = proto.validate;
                    proto.validate = function() {
                        if (oldValidate) {
                            var errors = oldValidate.apply(this, arguments);
                            if (errors) {
                                return errors;
                            }
                        }
                        return mixin.validate.apply(this, arguments);
                    };
                    return;
                }
                // `defaults` are not mixed in - we compose the mixin's defaults with existing defaults if they exist
                if ("defaults" === key) {
                    var defaults = proto.defaults || (proto.defaults = {});
                    var mixinDefaults = mixin[key];
                    for (var id in mixinDefaults) {
                        if (defaults.hasOwnProperty(id)) {
                            throw "Mixin error: class already has default '" + id + "' defined";
                        }
                        defaults[id] = mixinDefaults[id];
                    }
                    return;
                }
                // `namedAttributes` are added to the mixin, and we mixin in getters and setters for each attribute.
                if ("namedAttributes" === key) {
                    var protoAttrs = asObject(proto.namedAttributes) || {};
                    var mixinAttrs = asObject(mixin[key]);
                    proto.namedAttributes = _.extend(protoAttrs, nonConflictedTypes(mixinAttrs, protoAttrs));
                    return;
                }

                // `namedEvents` are added to the mixin, and we mix in on and trigger methods for each event.
                if ("namedEvents" === key) {
                    // `events` must be an array
                    if (!_.isArray(mixin[key])) {
                        throw "Expects events member on mixin to be an array";
                    }
                    if (!proto.namedEvents) {
                        proto.namedEvents = [];
                    }
                    proto.namedEvents = _.uniq(proto.namedEvents.concat(mixin[key]));
                    return;
                }
                // Name collisions with other mixins or or the object we're mixing into result in violent and forceful disapproval.
                if (proto.hasOwnProperty(key)) {
                    throw "Mixin error: class already has property '" + key + "' defined";
                }
                proto[key] = mixin[key];
            }, this);
        }
    };

    // ## Brace.AttributesMixinCreator ##
    Brace.AttributesMixinCreator = {

        // Creates a mixin of getter and setter methods for each item in the given attribute list.
        // A getter and setter for `id` is always generated.
        create: function(attributes, idAttribute) {
            var methods = {};

            if (!attributes) {
                attributes = {};
            }

            if (!_.has(attributes, "id")) {
                attributes.id = null;
            }

            _.each(attributes, function (expectedType, attrName) {
                // TODO: has, escape, unset
                var setter = Brace.Mixins.createMethodName("set", attrName);
                methods[setter] = function (val,options) {
                    return this.set(attrName, val, options);
                };
                var getter = Brace.Mixins.createMethodName("get", attrName);
                methods[getter] = function () {
                    return this.get(attrName);
                };
            });

            // If an idAttribute is specified
            //
            //    * the ID is going to be of the same type as that attribute
            //    * alias the ID's getter/setter to that attribute's getter/setter
            //    * Don't alias if the idAttribute is set to 'id'
            if (typeof idAttribute === 'string' && typeof attributes[idAttribute] !== 'undefined' && idAttribute !== 'id') {
                attributes.id = attributes[idAttribute];
                var idGetter = Brace.Mixins.createMethodName("get", idAttribute);
                var idSetter = Brace.Mixins.createMethodName("set", idAttribute);
                methods.getId = function() { return this[idGetter](); };
                methods.setId = function(val, options) { return this[idSetter](val, options); };
            }

            return methods;
        },
        /**
         * See JSDoc for this function in the backbone.brace file.
         *
         * Expose the ensureType function for people with custom constructors that don't call
         * .set() to initialize attributes. Hopefully this is rarely used, as I would
         * consider not calling .set() to be a code smell.
         *
         * @param type
         * @param value
         */
        ensureType : ensureType
    };

    // ## Brace.EventsMixinCreator ##
    Brace.EventsMixinCreator = {

        // Creates a mixin of on and trigger methods for each item in the given list of events.
        create: function(events) {
            var eventMethods = {};
            var createEvent = function(eventName) {
                // TODO: off
                var binder = Brace.Mixins.createMethodName("on", eventName);
                eventMethods[binder] = function() {
                    return this.on.apply(this, [eventName].concat(_.toArray(arguments)));
                };
                var trigger = Brace.Mixins.createMethodName("trigger", eventName);
                eventMethods[trigger] = function() {
                    return this.trigger.apply(this, [eventName].concat(_.toArray(arguments)));
                };
            };
            _.each(events, _.bind(createEvent,this));

            return eventMethods;
        }
    };

     // Generates an `extend` method that overrides Backbone's default `extend`. The new extend calls Backbone's `extend`, then:
     //
     //   * Adds all mixins specified in the `mixins` array
     //   * Adds a `Brace.EventsMixinCreator` to mix in on and trigger methods for events specified in the `namedEvents` array
     //   * Adds a `Brace.AttributesMixinCreator` to mix in get and set methods for attributes specified in the `attributes` array
    function generateMixinExtend(oldExtend) {
        return function newExtend(protoProps, classProps) {
            var child;
            var cleanProtoProps = _.extend({}, protoProps);
            // Remove `mixins` - we don't want to see them on the created prototype. Note that we do want to see `namedAttributes` and `namedEvents` for debugging
            var mixins;
            if (protoProps && protoProps.mixins) {
                mixins = protoProps.mixins;
                delete cleanProtoProps.mixins;
            }
            child = oldExtend.call(this, cleanProtoProps, classProps);

            if (this.prototype.namedEvents) {
                Brace.Mixins.applyMixin(child, { namedEvents : this.prototype.namedEvents });
            }
            if (this.prototype.namedAttributes) {
                Brace.Mixins.applyMixin(child, { namedAttributes : this.prototype.namedAttributes });
            }

            if (mixins) {
                _.each(protoProps.mixins, function(mixin) {
                    Brace.Mixins.applyMixin(child, mixin);
                });
            }
            if (child.prototype.namedEvents) {
                Brace.Mixins.applyMixin(child, Brace.EventsMixinCreator.create(child.prototype.namedEvents));
            }
            if (child.prototype.namedAttributes) {
                child.prototype.namedAttributes = asObject(child.prototype.namedAttributes);
                Brace.Mixins.applyMixin(child, Brace.AttributesMixinCreator.create(child.prototype.namedAttributes, child.prototype.idAttribute));
            }

            if (child.prototype.toJSON) {
                child.prototype.toJSON = createToJSON(child.prototype.toJSON);
            }

            child.extend = newExtend;
            return child;
        };
    }

    // Overrides Backbone's `get` and `set` methods to validate that the attribute being get / set is a namedAttribute.
    function overrideSetGet(ctor, childCtor) {
        var proto = ctor.prototype;
        var childProto = childCtor.prototype;

        var oldSet = proto.set;
        childProto.set = function(key, value, options) {
            // TODO: has, escape, unset
            var attrs,
                attributes = this.namedAttributes;

            if (!attributes || key == null) {
                return oldSet.apply(this, arguments);
            }

            if (_.isObject(key)) {
                attrs = _.clone(key);
                options = value;
            } else {
                attrs = {};
                attrs[key] = value;
            }

            for (var attr in attrs) {
                if (!_.has(attrs, attr)) {
                    continue;
                }
                if (!_.has(attributes, attr)) {
                    throw "Attribute '" + attr + "' does not exist";
                }
                attrs[attr] = ensureType(attributes[attr], attrs[attr]);
            }

            return oldSet.call(this, attrs, options);
        };

        var oldGet = proto.get;
        childProto.get = function(attr) {
            if (this.namedAttributes && !_.has(this.namedAttributes, attr)) {
                throw "Attribute '" + attr + "' does not exist";
            }
            return oldGet.apply(this, arguments);
        };
    }

    // Overrides Backbone's `parse` method to parse only namedAttributes
    function overrideParse(ctor, childCtor) {
        var proto = ctor.prototype;
        var childProto = childCtor.prototype;

        var oldParse = proto.parse;
        childProto.parse = function(response, options) {
            return _.pick(oldParse(response, options), _.keys(this.namedAttributes));
        };
    }

    // Applies extensions to the given constructor function. Sets `extend` to a method generated by `generateMixinExtend`
    function applyExtensions(ctor) {
        var child = ctor.extend();
        var oldExtend = ctor.extend;
        child.extend = generateMixinExtend(oldExtend);
        return child;
    }


    // Applies extensions to the given constructor function. Sets `extend` to a method generated by `generateMixinExtend`
    function applyModelExtensions(ctor) {
        var child = applyExtensions(ctor);
        overrideSetGet(ctor, child);
        overrideParse(ctor, child);
        return child;
    }

    // Extend base Backbone classes
    Brace.Model = applyModelExtensions(Backbone.Model);
    Brace.Collection = applyExtensions(Backbone.Collection);
    Brace.View = applyExtensions(Backbone.View);
    Brace.Router = applyExtensions(Backbone.Router);
    var Evented = function() {
        this.initialize.apply(this, arguments);
    };
    _.extend(Evented.prototype, Backbone.Events, {
        initialize: function() {}
    });
    Evented.extend = Backbone.Model.extend;
    Brace.Evented = applyExtensions(Evented);

    return Brace;

}));
;
;
/* module-key = 'bamboo.web.resources:lib-backbone', location = '/bower/backbone-computedfields/backbone.computedfields.js' */
// Backbone.ComputedFields, v0.0.9
// Copyright (c)2014 alexander.beletsky@gmail.com
// Distributed under MIT license
// https://github.com/alexanderbeletsky/backbone-computedfields

Backbone.ComputedFields = (function(Backbone, _){

    var ComputedFields = function (model) {
        this.model = model;
        this._computedFields = [];

        this.initialize();
    };

    _.extend(ComputedFields.prototype, {
        initialize: function () {
            _.bindAll(
                this,
                '_bindModelEvents',
                '_computeFieldValue',
                '_dependentFields',
                '_isModelInitialized',
                '_lookUpComputedFields',
                '_thenComputedChanges',
                '_thenDependentChanges',
                '_toJSON',
                '_wrapJSON',
                'initialize'
            );

            this._lookUpComputedFields();
            this._bindModelEvents();
            this._wrapJSON();
        },

        _lookUpComputedFields: function () {
            for (var obj in this.model.computed) {
                var field = this.model.computed[obj];

                if (field && (field.set || field.get)) {
                    this._computedFields.push({name: obj, field: field});
                }
            }
        },

        _bindModelEvents: function () {
            _.each(this._computedFields, function (computedField) {
                var fieldName = computedField.name;
                var field = computedField.field;

                var updateComputed = _.bind(function () {
                    var value = this._computeFieldValue(field);
                    this.model.set(fieldName, value, { skipChangeEvent: true });
                }, this);

                var updateDependent = _.bind(function (model, value, options) {
                    if (options && options.skipChangeEvent) {
                        return;
                    }

                    if (field.set) {
                        var fields = this._dependentFields(field.depends);
                        value = value || this.model.get(fieldName);

                        field.set.call(this.model, value, fields);
                        this.model.set(fields, options);
                    }
                }, this);

                this._thenDependentChanges(field.depends, updateComputed);
                this._thenComputedChanges(fieldName, updateDependent);

                if (this._isModelInitialized()) {
                    updateComputed();
                }
            }, this);
        },

        _isModelInitialized: function () {
            return !_.isEmpty(this.model.attributes);
        },

        _thenDependentChanges: function (depends, callback) {
            _.each(depends, function (name) {
                if (typeof (name) === 'string') {
                    this.model.on('change:' + name, callback);
                }

                if (typeof (name) === 'function') {
                    name.call(this.model, callback);
                }
            }, this);
        },

        _thenComputedChanges: function (fieldName, callback) {
            this.model.on('change:' + fieldName, callback);
        },

        _wrapJSON: function () {
            this.model.toJSON = _.wrap(this.model.toJSON, this._toJSON);
        },

        _toJSON: function (toJSON) {
            var args = Array.prototype.slice.call(arguments, 1),
                attributes = toJSON.apply(this.model, args),
                strip = !!(args[0] || {}).computedFields;

            var stripped = strip ? {} : _.reduce(this._computedFields, function (memo, computed) {
                if (computed.field.toJSON === false) {
                    memo.push(computed.name);
                }
                return memo;
            },[]);

            return _.omit(attributes, stripped);
        },

        _computeFieldValue: function (computedField) {
            if (computedField && computedField.get) {
                var fields = this._dependentFields(computedField.depends);
                return computedField.get.call(this.model, fields);
            }
        },

        _dependentFields: function (depends) {
            return _.reduce(depends, function (memo, field) {
                memo[field] = this.model.get(field);
                return memo;
            }, {}, this);
        }

    });

    return ComputedFields;

})(Backbone, _);;
;
/* module-key = 'bamboo.web.resources:util-namespace', location = '/util/namespace.js' */
/**
 * Get/set the value at a compound namespace,
 * gracefully adding values where missing.
 *
 * @param {string} namespace
 * @param {Object} [context=window]
 * @param {Object} [value={}]
 * @deprecated
 */
AJS.namespace = function (namespace, context, value) {
    var names = namespace.split(".");
    context = context || window;
    for (var i = 0, n = names.length - 1; i < n; i++) {
        var x = context[names[i]];
        context = (x != null) ? x : context[names[i]] = {};
    }
    context[names[i]] = value || context[names[i]] || {};
    return context[names[i]];
};
;
;
/* module-key = 'bamboo.web.resources:util-require', location = '/util/require.js' */
(function (window) {

    'use strict';

    function fnFactory(fn) {
        return function () {
            return fn;
        };
    }

    var oldRequire = require;
    var logged = false;

    require = function (modules, cb) {
        if (typeof modules === 'string' && typeof cb === 'function') {
            if (!logged) {
                logged = true;
                /* [logging] */
                console.log('WARN: require() use with string an function has been deprecated in 2.11 and will throw an error in 3.0. Use an array of dependencies. (requiring ' + modules + ')');
                /* [logging] end */
            }
            modules = [ modules ];
        }

        //explicitly disallow use of Almond internal params.
        if (cb && typeof cb !== 'function') {
            throw new Error('Callback was not a function');
        }

        return oldRequire.call(window, modules, cb);
    };

    // predefined shims
    define('jquery', fnFactory(window.AJS ? window.AJS.$ : window.jQuery));
    define('underscore', fnFactory(window._));
    define('backbone', fnFactory(window.Backbone));
    define('brace', fnFactory(window.Brace));
    define('aui', fnFactory(window.AJS));
    define('skate', fnFactory(window.skate));

})(window || this);
;
;
/* module-key = 'bamboo.web.resources:util-mixins', location = '/bower/backbone.wreqr/backbone.wreqr.js' */
// Backbone.Wreqr (Backbone.Marionette)
// ----------------------------------
// v1.3.2
//
// Copyright (c)2014 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://github.com/marionettejs/backbone.wreqr


(function(root, factory) {

  if (typeof define === 'function' && define.amd) {
    define(['backbone', 'underscore'], function(Backbone, _) {
      return factory(Backbone, _);
    });
  } else if (typeof exports !== 'undefined') {
    var Backbone = require('backbone');
    var _ = require('underscore');
    module.exports = factory(Backbone, _);
  } else {
    factory(root.Backbone, root._);
  }

}(this, function(Backbone, _) {
  "use strict";

  var previousWreqr = Backbone.Wreqr;

  var Wreqr = Backbone.Wreqr = {};

  Backbone.Wreqr.VERSION = '1.3.2';

  Backbone.Wreqr.noConflict = function () {
    Backbone.Wreqr = previousWreqr;
    return this;
  };

  // Handlers
  // --------
  // A registry of functions to call, given a name
  
  Wreqr.Handlers = (function(Backbone, _){
    "use strict";
    
    // Constructor
    // -----------
  
    var Handlers = function(options){
      this.options = options;
      this._wreqrHandlers = {};
      
      if (_.isFunction(this.initialize)){
        this.initialize(options);
      }
    };
  
    Handlers.extend = Backbone.Model.extend;
  
    // Instance Members
    // ----------------
  
    _.extend(Handlers.prototype, Backbone.Events, {
  
      // Add multiple handlers using an object literal configuration
      setHandlers: function(handlers){
        _.each(handlers, function(handler, name){
          var context = null;
  
          if (_.isObject(handler) && !_.isFunction(handler)){
            context = handler.context;
            handler = handler.callback;
          }
  
          this.setHandler(name, handler, context);
        }, this);
      },
  
      // Add a handler for the given name, with an
      // optional context to run the handler within
      setHandler: function(name, handler, context){
        var config = {
          callback: handler,
          context: context
        };
  
        this._wreqrHandlers[name] = config;
  
        this.trigger("handler:add", name, handler, context);
      },
  
      // Determine whether or not a handler is registered
      hasHandler: function(name){
        return !! this._wreqrHandlers[name];
      },
  
      // Get the currently registered handler for
      // the specified name. Throws an exception if
      // no handler is found.
      getHandler: function(name){
        var config = this._wreqrHandlers[name];
  
        if (!config){
          return;
        }
  
        return function(){
          return config.callback.apply(config.context, arguments);
        };
      },
  
      // Remove a handler for the specified name
      removeHandler: function(name){
        delete this._wreqrHandlers[name];
      },
  
      // Remove all handlers from this registry
      removeAllHandlers: function(){
        this._wreqrHandlers = {};
      }
    });
  
    return Handlers;
  })(Backbone, _);
  
  // Wreqr.CommandStorage
  // --------------------
  //
  // Store and retrieve commands for execution.
  Wreqr.CommandStorage = (function(){
    "use strict";
  
    // Constructor function
    var CommandStorage = function(options){
      this.options = options;
      this._commands = {};
  
      if (_.isFunction(this.initialize)){
        this.initialize(options);
      }
    };
  
    // Instance methods
    _.extend(CommandStorage.prototype, Backbone.Events, {
  
      // Get an object literal by command name, that contains
      // the `commandName` and the `instances` of all commands
      // represented as an array of arguments to process
      getCommands: function(commandName){
        var commands = this._commands[commandName];
  
        // we don't have it, so add it
        if (!commands){
  
          // build the configuration
          commands = {
            command: commandName, 
            instances: []
          };
  
          // store it
          this._commands[commandName] = commands;
        }
  
        return commands;
      },
  
      // Add a command by name, to the storage and store the
      // args for the command
      addCommand: function(commandName, args){
        var command = this.getCommands(commandName);
        command.instances.push(args);
      },
  
      // Clear all commands for the given `commandName`
      clearCommands: function(commandName){
        var command = this.getCommands(commandName);
        command.instances = [];
      }
    });
  
    return CommandStorage;
  })();
  
  // Wreqr.Commands
  // --------------
  //
  // A simple command pattern implementation. Register a command
  // handler and execute it.
  Wreqr.Commands = (function(Wreqr, _){
    "use strict";
  
    return Wreqr.Handlers.extend({
      // default storage type
      storageType: Wreqr.CommandStorage,
  
      constructor: function(options){
        this.options = options || {};
  
        this._initializeStorage(this.options);
        this.on("handler:add", this._executeCommands, this);
  
        Wreqr.Handlers.prototype.constructor.apply(this, arguments);
      },
  
      // Execute a named command with the supplied args
      execute: function(name){
        name = arguments[0];
        var args = _.rest(arguments);
  
        if (this.hasHandler(name)){
          this.getHandler(name).apply(this, args);
        } else {
          this.storage.addCommand(name, args);
        }
  
      },
  
      // Internal method to handle bulk execution of stored commands
      _executeCommands: function(name, handler, context){
        var command = this.storage.getCommands(name);
  
        // loop through and execute all the stored command instances
        _.each(command.instances, function(args){
          handler.apply(context, args);
        });
  
        this.storage.clearCommands(name);
      },
  
      // Internal method to initialize storage either from the type's
      // `storageType` or the instance `options.storageType`.
      _initializeStorage: function(options){
        var storage;
  
        var StorageType = options.storageType || this.storageType;
        if (_.isFunction(StorageType)){
          storage = new StorageType();
        } else {
          storage = StorageType;
        }
  
        this.storage = storage;
      }
    });
  
  })(Wreqr, _);
  
  // Wreqr.RequestResponse
  // ---------------------
  //
  // A simple request/response implementation. Register a
  // request handler, and return a response from it
  Wreqr.RequestResponse = (function(Wreqr, _){
    "use strict";
  
    return Wreqr.Handlers.extend({
      request: function(name){
        if (this.hasHandler(name)) {
          return this.getHandler(name).apply(this, _.rest(arguments));
        }
      }
    });
  
  })(Wreqr, _);
  
  // Event Aggregator
  // ----------------
  // A pub-sub object that can be used to decouple various parts
  // of an application through event-driven architecture.
  
  Wreqr.EventAggregator = (function(Backbone, _){
    "use strict";
    var EA = function(){};
  
    // Copy the `extend` function used by Backbone's classes
    EA.extend = Backbone.Model.extend;
  
    // Copy the basic Backbone.Events on to the event aggregator
    _.extend(EA.prototype, Backbone.Events);
  
    return EA;
  })(Backbone, _);
  
  // Wreqr.Channel
  // --------------
  //
  // An object that wraps the three messaging systems:
  // EventAggregator, RequestResponse, Commands
  Wreqr.Channel = (function(Wreqr){
    "use strict";
  
    var Channel = function(channelName) {
      this.vent        = new Backbone.Wreqr.EventAggregator();
      this.reqres      = new Backbone.Wreqr.RequestResponse();
      this.commands    = new Backbone.Wreqr.Commands();
      this.channelName = channelName;
    };
  
    _.extend(Channel.prototype, {
  
      // Remove all handlers from the messaging systems of this channel
      reset: function() {
        this.vent.off();
        this.vent.stopListening();
        this.reqres.removeAllHandlers();
        this.commands.removeAllHandlers();
        return this;
      },
  
      // Connect a hash of events; one for each messaging system
      connectEvents: function(hash, context) {
        this._connect('vent', hash, context);
        return this;
      },
  
      connectCommands: function(hash, context) {
        this._connect('commands', hash, context);
        return this;
      },
  
      connectRequests: function(hash, context) {
        this._connect('reqres', hash, context);
        return this;
      },
  
      // Attach the handlers to a given message system `type`
      _connect: function(type, hash, context) {
        if (!hash) {
          return;
        }
  
        context = context || this;
        var method = (type === 'vent') ? 'on' : 'setHandler';
  
        _.each(hash, function(fn, eventName) {
          this[type][method](eventName, _.bind(fn, context));
        }, this);
      }
    });
  
  
    return Channel;
  })(Wreqr);
  
  // Wreqr.Radio
  // --------------
  //
  // An object that lets you communicate with many channels.
  Wreqr.radio = (function(Wreqr, _){
    "use strict";
  
    var Radio = function() {
      this._channels = {};
      this.vent = {};
      this.commands = {};
      this.reqres = {};
      this._proxyMethods();
    };
  
    _.extend(Radio.prototype, {
  
      channel: function(channelName) {
        if (!channelName) {
          throw new Error('Channel must receive a name');
        }
  
        return this._getChannel( channelName );
      },
  
      _getChannel: function(channelName) {
        var channel = this._channels[channelName];
  
        if(!channel) {
          channel = new Wreqr.Channel(channelName);
          this._channels[channelName] = channel;
        }
  
        return channel;
      },
  
      _proxyMethods: function() {
        _.each(['vent', 'commands', 'reqres'], function(system) {
          _.each( messageSystems[system], function(method) {
            this[system][method] = proxyMethod(this, system, method);
          }, this);
        }, this);
      }
    });
  
  
    var messageSystems = {
      vent: [
        'on',
        'off',
        'trigger',
        'once',
        'stopListening',
        'listenTo',
        'listenToOnce'
      ],
  
      commands: [
        'execute',
        'setHandler',
        'setHandlers',
        'removeHandler',
        'removeAllHandlers'
      ],
  
      reqres: [
        'request',
        'setHandler',
        'setHandlers',
        'removeHandler',
        'removeAllHandlers'
      ]
    };
  
    var proxyMethod = function(radio, system, method) {
      return function(channelName) {
        var messageSystem = radio._getChannel(channelName)[system];
  
        return messageSystem[method].apply(messageSystem, _.rest(arguments));
      };
    };
  
    return new Radio();
  
  })(Wreqr, _);
  

  return Backbone.Wreqr;

}));
;
;
/* module-key = 'bamboo.web.resources:util-mixins', location = '/util/mixins/events.js' */
define('util/events', [
    'underscore',
    'backbone',
    'exports'
], function(_, Backbone, exports) {

    'use strict';

    var EventBus = new Backbone.Wreqr.EventAggregator();
    var EventBusMixin = {

        onEvent: function(key, callback, object) {
            var handler = function(value, callback, object) {
                EventBus.on(value, _.bind(callback, object));
            };

            if (_.isArray(key)) {
                _.each(key, _.bind(function(value) {
                    handler(value, callback, object || this);
                }, this));
            }
            else {
                handler(key, callback, object || this);
            }
        },

        triggerEvent: function(key) {
            EventBus.trigger.apply(EventBus,
                [key, this].concat(
                    Array.prototype.slice.call(arguments, 1)
                )
            );
        },

        offEvent: function(events) {
            if (_.isArray(events)) {
                _.each(events, function(event) {
                    EventBus.off(event);
                });
            }
            else {
                EventBus.off(events);
            }
        },

        offEventNamespace: function(namespace) {
            if (namespace.length) {
                _.each(_.keys(EventBus._events), _.bind(function(event) {
                    if (event.indexOf(namespace + ':') === 0) {
                        this.offEvent(event);
                    }
                }, this));
            }
        },

        proxyEvents: function(key, events, object, bindMethod) {
            var scope = object || this, self = this;
            var proxyMethod = (bindMethod) ? scope[bindMethod] : scope.on;

            _.each(events, function(event) {
                proxyMethod.apply(scope, [event, function() {
                    self.triggerEvent(
                        [key, event].join(':'), scope
                    );
                }]);
            });
        }

    };

    exports.EventBus = EventBus;
    exports.EventBusMixin = EventBusMixin;

});

/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('Bamboo.EventBus', null, require('util/events').EventBus);
    AJS.namespace('Bamboo.EventBusMixin', null, require('util/events').EventBusMixin);
}
;
;
/* module-key = 'bamboo.web.resources:util-mixins', location = '/util/mixins/elements.js' */
define('util/elements', [
    'jquery',
    'underscore'
], function(
    $,
    _
) {

    'use strict';

    var Elements = {

        getElement: function(name) {
            var item = this.elements[name];

            if (_.isUndefined(item)) {
                throw '"' + name + '" not found in elements';
            }

            if (_.isString(item)) {
                this.elements[name] = {
                    selector: item,
                    query: this.$el.find(item)
                };

                item = this.elements[name];
            }

            return item.query;
        },

        clearElementsCache: function() {
            _.each(_.keys(this.elements), _.bind(function(key) {
                var item = this.elements[key];

                if (!_.isString(item)) {
                    this.elements[key] = item.selector;
                }
            }, this));
        },

        toggleContainer: function($selector, show) {
            if (!_.isUndefined(show)) {
                return $selector.toggle(!!show);
            }
            else {
                return $selector.hide();
            }
        }

    };

    return Elements;
});

/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('Bamboo.Util.Mixins.Elements', null, require('util/elements'));
};
;
/* module-key = 'bamboo.web.resources:lib-marionette', location = '/bower/backbone.babysitter/backbone.babysitter.js' */
// Backbone.BabySitter
// -------------------
// v0.1.6
//
// Copyright (c)2015 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://github.com/marionettejs/backbone.babysitter

(function(root, factory) {

  if (typeof define === 'function' && define.amd) {
    define(['backbone', 'underscore'], function(Backbone, _) {
      return factory(Backbone, _);
    });
  } else if (typeof exports !== 'undefined') {
    var Backbone = require('backbone');
    var _ = require('underscore');
    module.exports = factory(Backbone, _);
  } else {
    factory(root.Backbone, root._);
  }

}(this, function(Backbone, _) {
  'use strict';

  var previousChildViewContainer = Backbone.ChildViewContainer;

  // BabySitter.ChildViewContainer
  // -----------------------------
  //
  // Provide a container to store, retrieve and
  // shut down child views.
  
  Backbone.ChildViewContainer = (function (Backbone, _) {
  
    // Container Constructor
    // ---------------------
  
    var Container = function(views){
      this._views = {};
      this._indexByModel = {};
      this._indexByCustom = {};
      this._updateLength();
  
      _.each(views, this.add, this);
    };
  
    // Container Methods
    // -----------------
  
    _.extend(Container.prototype, {
  
      // Add a view to this container. Stores the view
      // by `cid` and makes it searchable by the model
      // cid (and model itself). Optionally specify
      // a custom key to store an retrieve the view.
      add: function(view, customIndex){
        var viewCid = view.cid;
  
        // store the view
        this._views[viewCid] = view;
  
        // index it by model
        if (view.model){
          this._indexByModel[view.model.cid] = viewCid;
        }
  
        // index by custom
        if (customIndex){
          this._indexByCustom[customIndex] = viewCid;
        }
  
        this._updateLength();
        return this;
      },
  
      // Find a view by the model that was attached to
      // it. Uses the model's `cid` to find it.
      findByModel: function(model){
        return this.findByModelCid(model.cid);
      },
  
      // Find a view by the `cid` of the model that was attached to
      // it. Uses the model's `cid` to find the view `cid` and
      // retrieve the view using it.
      findByModelCid: function(modelCid){
        var viewCid = this._indexByModel[modelCid];
        return this.findByCid(viewCid);
      },
  
      // Find a view by a custom indexer.
      findByCustom: function(index){
        var viewCid = this._indexByCustom[index];
        return this.findByCid(viewCid);
      },
  
      // Find by index. This is not guaranteed to be a
      // stable index.
      findByIndex: function(index){
        return _.values(this._views)[index];
      },
  
      // retrieve a view by its `cid` directly
      findByCid: function(cid){
        return this._views[cid];
      },
  
      // Remove a view
      remove: function(view){
        var viewCid = view.cid;
  
        // delete model index
        if (view.model){
          delete this._indexByModel[view.model.cid];
        }
  
        // delete custom index
        _.any(this._indexByCustom, function(cid, key) {
          if (cid === viewCid) {
            delete this._indexByCustom[key];
            return true;
          }
        }, this);
  
        // remove the view from the container
        delete this._views[viewCid];
  
        // update the length
        this._updateLength();
        return this;
      },
  
      // Call a method on every view in the container,
      // passing parameters to the call method one at a
      // time, like `function.call`.
      call: function(method){
        this.apply(method, _.tail(arguments));
      },
  
      // Apply a method on every view in the container,
      // passing parameters to the call method one at a
      // time, like `function.apply`.
      apply: function(method, args){
        _.each(this._views, function(view){
          if (_.isFunction(view[method])){
            view[method].apply(view, args || []);
          }
        });
      },
  
      // Update the `.length` attribute on this container
      _updateLength: function(){
        this.length = _.size(this._views);
      }
    });
  
    // Borrowing this code from Backbone.Collection:
    // http://backbonejs.org/docs/backbone.html#section-106
    //
    // Mix in methods from Underscore, for iteration, and other
    // collection related features.
    var methods = ['forEach', 'each', 'map', 'find', 'detect', 'filter',
      'select', 'reject', 'every', 'all', 'some', 'any', 'include',
      'contains', 'invoke', 'toArray', 'first', 'initial', 'rest',
      'last', 'without', 'isEmpty', 'pluck', 'reduce'];
  
    _.each(methods, function(method) {
      Container.prototype[method] = function() {
        var views = _.values(this._views);
        var args = [views].concat(_.toArray(arguments));
        return _[method].apply(_, args);
      };
    });
  
    // return the public API
    return Container;
  })(Backbone, _);
  

  Backbone.ChildViewContainer.VERSION = '0.1.6';

  Backbone.ChildViewContainer.noConflict = function () {
    Backbone.ChildViewContainer = previousChildViewContainer;
    return this;
  };

  return Backbone.ChildViewContainer;

}));
;
;
/* module-key = 'bamboo.web.resources:lib-marionette', location = '/bower/backbone.marionette/backbone.marionette.js' */
// MarionetteJS (Backbone.Marionette)
// ----------------------------------
// v2.4.1
//
// Copyright (c)2015 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://marionettejs.com

(function(root, factory) {

  if (typeof define === 'function' && define.amd) {
    define(['backbone', 'underscore', 'backbone.wreqr', 'backbone.babysitter'], function(Backbone, _) {
      return (root.Marionette = root.Mn = factory(root, Backbone, _));
    });
  } else if (typeof exports !== 'undefined') {
    var Backbone = require('backbone');
    var _ = require('underscore');
    var Wreqr = require('backbone.wreqr');
    var BabySitter = require('backbone.babysitter');
    module.exports = factory(root, Backbone, _);
  } else {
    root.Marionette = root.Mn = factory(root, root.Backbone, root._);
  }

}(this, function(root, Backbone, _) {
  'use strict';

  var previousMarionette = root.Marionette;
  var previousMn = root.Mn;

  var Marionette = Backbone.Marionette = {};

  Marionette.VERSION = '2.4.1';

  Marionette.noConflict = function() {
    root.Marionette = previousMarionette;
    root.Mn = previousMn;
    return this;
  };

  // Get the Deferred creator for later use
  Marionette.Deferred = Backbone.$.Deferred;

  Marionette.FEATURES = {
  };
  
  Marionette.isEnabled = function(name) {
    return !!Marionette.FEATURES[name];
  };
  
  /* jshint unused: false *//* global console */
  
  // Helpers
  // -------
  
  // Marionette.extend
  // -----------------
  
  // Borrow the Backbone `extend` method so we can use it as needed
  Marionette.extend = Backbone.Model.extend;
  
  // Marionette.isNodeAttached
  // -------------------------
  
  // Determine if `el` is a child of the document
  Marionette.isNodeAttached = function(el) {
    return Backbone.$.contains(document.documentElement, el);
  };
  
  // Merge `keys` from `options` onto `this`
  Marionette.mergeOptions = function(options, keys) {
    if (!options) { return; }
    _.extend(this, _.pick(options, keys));
  };
  
  // Marionette.getOption
  // --------------------
  
  // Retrieve an object, function or other value from a target
  // object or its `options`, with `options` taking precedence.
  Marionette.getOption = function(target, optionName) {
    if (!target || !optionName) { return; }
    if (target.options && (target.options[optionName] !== undefined)) {
      return target.options[optionName];
    } else {
      return target[optionName];
    }
  };
  
  // Proxy `Marionette.getOption`
  Marionette.proxyGetOption = function(optionName) {
    return Marionette.getOption(this, optionName);
  };
  
  // Similar to `_.result`, this is a simple helper
  // If a function is provided we call it with context
  // otherwise just return the value. If the value is
  // undefined return a default value
  Marionette._getValue = function(value, context, params) {
    if (_.isFunction(value)) {
      value = params ? value.apply(context, params) : value.call(context);
    }
    return value;
  };
  
  // Marionette.normalizeMethods
  // ----------------------
  
  // Pass in a mapping of events => functions or function names
  // and return a mapping of events => functions
  Marionette.normalizeMethods = function(hash) {
    return _.reduce(hash, function(normalizedHash, method, name) {
      if (!_.isFunction(method)) {
        method = this[method];
      }
      if (method) {
        normalizedHash[name] = method;
      }
      return normalizedHash;
    }, {}, this);
  };
  
  // utility method for parsing @ui. syntax strings
  // into associated selector
  Marionette.normalizeUIString = function(uiString, ui) {
    return uiString.replace(/@ui\.[a-zA-Z_$0-9]*/g, function(r) {
      return ui[r.slice(4)];
    });
  };
  
  // allows for the use of the @ui. syntax within
  // a given key for triggers and events
  // swaps the @ui with the associated selector.
  // Returns a new, non-mutated, parsed events hash.
  Marionette.normalizeUIKeys = function(hash, ui) {
    return _.reduce(hash, function(memo, val, key) {
      var normalizedKey = Marionette.normalizeUIString(key, ui);
      memo[normalizedKey] = val;
      return memo;
    }, {});
  };
  
  // allows for the use of the @ui. syntax within
  // a given value for regions
  // swaps the @ui with the associated selector
  Marionette.normalizeUIValues = function(hash, ui, properties) {
    _.each(hash, function(val, key) {
      if (_.isString(val)) {
        hash[key] = Marionette.normalizeUIString(val, ui);
      } else if (_.isObject(val) && _.isArray(properties)) {
        _.extend(val, Marionette.normalizeUIValues(_.pick(val, properties), ui));
        /* Value is an object, and we got an array of embedded property names to normalize. */
        _.each(properties, function(property) {
          var propertyVal = val[property];
          if (_.isString(propertyVal)) {
            val[property] = Marionette.normalizeUIString(propertyVal, ui);
          }
        });
      }
    });
    return hash;
  };
  
  // Mix in methods from Underscore, for iteration, and other
  // collection related features.
  // Borrowing this code from Backbone.Collection:
  // http://backbonejs.org/docs/backbone.html#section-121
  Marionette.actAsCollection = function(object, listProperty) {
    var methods = ['forEach', 'each', 'map', 'find', 'detect', 'filter',
      'select', 'reject', 'every', 'all', 'some', 'any', 'include',
      'contains', 'invoke', 'toArray', 'first', 'initial', 'rest',
      'last', 'without', 'isEmpty', 'pluck'];
  
    _.each(methods, function(method) {
      object[method] = function() {
        var list = _.values(_.result(this, listProperty));
        var args = [list].concat(_.toArray(arguments));
        return _[method].apply(_, args);
      };
    });
  };
  
  var deprecate = Marionette.deprecate = function(message, test) {
    if (_.isObject(message)) {
      message = (
        message.prev + ' is going to be removed in the future. ' +
        'Please use ' + message.next + ' instead.' +
        (message.url ? ' See: ' + message.url : '')
      );
    }
  
    if ((test === undefined || !test) && !deprecate._cache[message]) {
      deprecate._warn('Deprecation warning: ' + message);
      deprecate._cache[message] = true;
    }
  };
  
  deprecate._warn = typeof console !== 'undefined' && (console.warn || console.log) || function() {};
  deprecate._cache = {};
  
  /* jshint maxstatements: 14, maxcomplexity: 7 */
  
  // Trigger Method
  // --------------
  
  Marionette._triggerMethod = (function() {
    // split the event name on the ":"
    var splitter = /(^|:)(\w)/gi;
  
    // take the event section ("section1:section2:section3")
    // and turn it in to uppercase name
    function getEventName(match, prefix, eventName) {
      return eventName.toUpperCase();
    }
  
    return function(context, event, args) {
      var noEventArg = arguments.length < 3;
      if (noEventArg) {
        args = event;
        event = args[0];
      }
  
      // get the method name from the event name
      var methodName = 'on' + event.replace(splitter, getEventName);
      var method = context[methodName];
      var result;
  
      // call the onMethodName if it exists
      if (_.isFunction(method)) {
        // pass all args, except the event name
        result = method.apply(context, noEventArg ? _.rest(args) : args);
      }
  
      // trigger the event, if a trigger method exists
      if (_.isFunction(context.trigger)) {
        if (noEventArg + args.length > 1) {
          context.trigger.apply(context, noEventArg ? args : [event].concat(_.drop(args, 0)));
        } else {
          context.trigger(event);
        }
      }
  
      return result;
    };
  })();
  
  // Trigger an event and/or a corresponding method name. Examples:
  //
  // `this.triggerMethod("foo")` will trigger the "foo" event and
  // call the "onFoo" method.
  //
  // `this.triggerMethod("foo:bar")` will trigger the "foo:bar" event and
  // call the "onFooBar" method.
  Marionette.triggerMethod = function(event) {
    return Marionette._triggerMethod(this, arguments);
  };
  
  // triggerMethodOn invokes triggerMethod on a specific context
  //
  // e.g. `Marionette.triggerMethodOn(view, 'show')`
  // will trigger a "show" event or invoke onShow the view.
  Marionette.triggerMethodOn = function(context) {
    var fnc = _.isFunction(context.triggerMethod) ?
                  context.triggerMethod :
                  Marionette.triggerMethod;
  
    return fnc.apply(context, _.rest(arguments));
  };
  
  // DOM Refresh
  // -----------
  
  // Monitor a view's state, and after it has been rendered and shown
  // in the DOM, trigger a "dom:refresh" event every time it is
  // re-rendered.
  
  Marionette.MonitorDOMRefresh = function(view) {
  
    // track when the view has been shown in the DOM,
    // using a Marionette.Region (or by other means of triggering "show")
    function handleShow() {
      view._isShown = true;
      triggerDOMRefresh();
    }
  
    // track when the view has been rendered
    function handleRender() {
      view._isRendered = true;
      triggerDOMRefresh();
    }
  
    // Trigger the "dom:refresh" event and corresponding "onDomRefresh" method
    function triggerDOMRefresh() {
      if (view._isShown && view._isRendered && Marionette.isNodeAttached(view.el)) {
        if (_.isFunction(view.triggerMethod)) {
          view.triggerMethod('dom:refresh');
        }
      }
    }
  
    view.on({
      show: handleShow,
      render: handleRender
    });
  };
  
  /* jshint maxparams: 5 */
  
  // Bind Entity Events & Unbind Entity Events
  // -----------------------------------------
  //
  // These methods are used to bind/unbind a backbone "entity" (e.g. collection/model)
  // to methods on a target object.
  //
  // The first parameter, `target`, must have the Backbone.Events module mixed in.
  //
  // The second parameter is the `entity` (Backbone.Model, Backbone.Collection or
  // any object that has Backbone.Events mixed in) to bind the events from.
  //
  // The third parameter is a hash of { "event:name": "eventHandler" }
  // configuration. Multiple handlers can be separated by a space. A
  // function can be supplied instead of a string handler name.
  
  (function(Marionette) {
    'use strict';
  
    // Bind the event to handlers specified as a string of
    // handler names on the target object
    function bindFromStrings(target, entity, evt, methods) {
      var methodNames = methods.split(/\s+/);
  
      _.each(methodNames, function(methodName) {
  
        var method = target[methodName];
        if (!method) {
          throw new Marionette.Error('Method "' + methodName +
            '" was configured as an event handler, but does not exist.');
        }
  
        target.listenTo(entity, evt, method);
      });
    }
  
    // Bind the event to a supplied callback function
    function bindToFunction(target, entity, evt, method) {
      target.listenTo(entity, evt, method);
    }
  
    // Bind the event to handlers specified as a string of
    // handler names on the target object
    function unbindFromStrings(target, entity, evt, methods) {
      var methodNames = methods.split(/\s+/);
  
      _.each(methodNames, function(methodName) {
        var method = target[methodName];
        target.stopListening(entity, evt, method);
      });
    }
  
    // Bind the event to a supplied callback function
    function unbindToFunction(target, entity, evt, method) {
      target.stopListening(entity, evt, method);
    }
  
    // generic looping function
    function iterateEvents(target, entity, bindings, functionCallback, stringCallback) {
      if (!entity || !bindings) { return; }
  
      // type-check bindings
      if (!_.isObject(bindings)) {
        throw new Marionette.Error({
          message: 'Bindings must be an object or function.',
          url: 'marionette.functions.html#marionettebindentityevents'
        });
      }
  
      // allow the bindings to be a function
      bindings = Marionette._getValue(bindings, target);
  
      // iterate the bindings and bind them
      _.each(bindings, function(methods, evt) {
  
        // allow for a function as the handler,
        // or a list of event names as a string
        if (_.isFunction(methods)) {
          functionCallback(target, entity, evt, methods);
        } else {
          stringCallback(target, entity, evt, methods);
        }
  
      });
    }
  
    // Export Public API
    Marionette.bindEntityEvents = function(target, entity, bindings) {
      iterateEvents(target, entity, bindings, bindToFunction, bindFromStrings);
    };
  
    Marionette.unbindEntityEvents = function(target, entity, bindings) {
      iterateEvents(target, entity, bindings, unbindToFunction, unbindFromStrings);
    };
  
    // Proxy `bindEntityEvents`
    Marionette.proxyBindEntityEvents = function(entity, bindings) {
      return Marionette.bindEntityEvents(this, entity, bindings);
    };
  
    // Proxy `unbindEntityEvents`
    Marionette.proxyUnbindEntityEvents = function(entity, bindings) {
      return Marionette.unbindEntityEvents(this, entity, bindings);
    };
  })(Marionette);
  

  // Error
  // -----
  
  var errorProps = ['description', 'fileName', 'lineNumber', 'name', 'message', 'number'];
  
  Marionette.Error = Marionette.extend.call(Error, {
    urlRoot: 'http://marionettejs.com/docs/v' + Marionette.VERSION + '/',
  
    constructor: function(message, options) {
      if (_.isObject(message)) {
        options = message;
        message = options.message;
      } else if (!options) {
        options = {};
      }
  
      var error = Error.call(this, message);
      _.extend(this, _.pick(error, errorProps), _.pick(options, errorProps));
  
      this.captureStackTrace();
  
      if (options.url) {
        this.url = this.urlRoot + options.url;
      }
    },
  
    captureStackTrace: function() {
      if (Error.captureStackTrace) {
        Error.captureStackTrace(this, Marionette.Error);
      }
    },
  
    toString: function() {
      return this.name + ': ' + this.message + (this.url ? ' See: ' + this.url : '');
    }
  });
  
  Marionette.Error.extend = Marionette.extend;
  
  // Callbacks
  // ---------
  
  // A simple way of managing a collection of callbacks
  // and executing them at a later point in time, using jQuery's
  // `Deferred` object.
  Marionette.Callbacks = function() {
    this._deferred = Marionette.Deferred();
    this._callbacks = [];
  };
  
  _.extend(Marionette.Callbacks.prototype, {
  
    // Add a callback to be executed. Callbacks added here are
    // guaranteed to execute, even if they are added after the
    // `run` method is called.
    add: function(callback, contextOverride) {
      var promise = _.result(this._deferred, 'promise');
  
      this._callbacks.push({cb: callback, ctx: contextOverride});
  
      promise.then(function(args) {
        if (contextOverride) { args.context = contextOverride; }
        callback.call(args.context, args.options);
      });
    },
  
    // Run all registered callbacks with the context specified.
    // Additional callbacks can be added after this has been run
    // and they will still be executed.
    run: function(options, context) {
      this._deferred.resolve({
        options: options,
        context: context
      });
    },
  
    // Resets the list of callbacks to be run, allowing the same list
    // to be run multiple times - whenever the `run` method is called.
    reset: function() {
      var callbacks = this._callbacks;
      this._deferred = Marionette.Deferred();
      this._callbacks = [];
  
      _.each(callbacks, function(cb) {
        this.add(cb.cb, cb.ctx);
      }, this);
    }
  });
  
  // Controller
  // ----------
  
  // A multi-purpose object to use as a controller for
  // modules and routers, and as a mediator for workflow
  // and coordination of other objects, views, and more.
  Marionette.Controller = function(options) {
    this.options = options || {};
  
    if (_.isFunction(this.initialize)) {
      this.initialize(this.options);
    }
  };
  
  Marionette.Controller.extend = Marionette.extend;
  
  // Controller Methods
  // --------------
  
  // Ensure it can trigger events with Backbone.Events
  _.extend(Marionette.Controller.prototype, Backbone.Events, {
    destroy: function() {
      Marionette._triggerMethod(this, 'before:destroy', arguments);
      Marionette._triggerMethod(this, 'destroy', arguments);
  
      this.stopListening();
      this.off();
      return this;
    },
  
    // import the `triggerMethod` to trigger events with corresponding
    // methods if the method exists
    triggerMethod: Marionette.triggerMethod,
  
    // A handy way to merge options onto the instance
    mergeOptions: Marionette.mergeOptions,
  
    // Proxy `getOption` to enable getting options from this or this.options by name.
    getOption: Marionette.proxyGetOption
  
  });
  
  // Object
  // ------
  
  // A Base Class that other Classes should descend from.
  // Object borrows many conventions and utilities from Backbone.
  Marionette.Object = function(options) {
    this.options = _.extend({}, _.result(this, 'options'), options);
  
    this.initialize.apply(this, arguments);
  };
  
  Marionette.Object.extend = Marionette.extend;
  
  // Object Methods
  // --------------
  
  // Ensure it can trigger events with Backbone.Events
  _.extend(Marionette.Object.prototype, Backbone.Events, {
  
    //this is a noop method intended to be overridden by classes that extend from this base
    initialize: function() {},
  
    destroy: function() {
      this.triggerMethod('before:destroy');
      this.triggerMethod('destroy');
      this.stopListening();
  
      return this;
    },
  
    // Import the `triggerMethod` to trigger events with corresponding
    // methods if the method exists
    triggerMethod: Marionette.triggerMethod,
  
    // A handy way to merge options onto the instance
    mergeOptions: Marionette.mergeOptions,
  
    // Proxy `getOption` to enable getting options from this or this.options by name.
    getOption: Marionette.proxyGetOption,
  
    // Proxy `bindEntityEvents` to enable binding view's events from another entity.
    bindEntityEvents: Marionette.proxyBindEntityEvents,
  
    // Proxy `unbindEntityEvents` to enable unbinding view's events from another entity.
    unbindEntityEvents: Marionette.proxyUnbindEntityEvents
  });
  
  /* jshint maxcomplexity: 16, maxstatements: 45, maxlen: 120 */
  
  // Region
  // ------
  
  // Manage the visual regions of your composite application. See
  // http://lostechies.com/derickbailey/2011/12/12/composite-js-apps-regions-and-region-managers/
  
  Marionette.Region = Marionette.Object.extend({
    constructor: function(options) {
  
      // set options temporarily so that we can get `el`.
      // options will be overriden by Object.constructor
      this.options = options || {};
      this.el = this.getOption('el');
  
      // Handle when this.el is passed in as a $ wrapped element.
      this.el = this.el instanceof Backbone.$ ? this.el[0] : this.el;
  
      if (!this.el) {
        throw new Marionette.Error({
          name: 'NoElError',
          message: 'An "el" must be specified for a region.'
        });
      }
  
      this.$el = this.getEl(this.el);
      Marionette.Object.call(this, options);
    },
  
    // Displays a backbone view instance inside of the region.
    // Handles calling the `render` method for you. Reads content
    // directly from the `el` attribute. Also calls an optional
    // `onShow` and `onDestroy` method on your view, just after showing
    // or just before destroying the view, respectively.
    // The `preventDestroy` option can be used to prevent a view from
    // the old view being destroyed on show.
    // The `forceShow` option can be used to force a view to be
    // re-rendered if it's already shown in the region.
    show: function(view, options) {
      if (!this._ensureElement()) {
        return;
      }
  
      this._ensureViewIsIntact(view);
  
      var showOptions     = options || {};
      var isDifferentView = view !== this.currentView;
      var preventDestroy  = !!showOptions.preventDestroy;
      var forceShow       = !!showOptions.forceShow;
  
      // We are only changing the view if there is a current view to change to begin with
      var isChangingView = !!this.currentView;
  
      // Only destroy the current view if we don't want to `preventDestroy` and if
      // the view given in the first argument is different than `currentView`
      var _shouldDestroyView = isDifferentView && !preventDestroy;
  
      // Only show the view given in the first argument if it is different than
      // the current view or if we want to re-show the view. Note that if
      // `_shouldDestroyView` is true, then `_shouldShowView` is also necessarily true.
      var _shouldShowView = isDifferentView || forceShow;
  
      if (isChangingView) {
        this.triggerMethod('before:swapOut', this.currentView, this, options);
      }
  
      if (this.currentView) {
        delete this.currentView._parent;
      }
  
      if (_shouldDestroyView) {
        this.empty();
  
      // A `destroy` event is attached to the clean up manually removed views.
      // We need to detach this event when a new view is going to be shown as it
      // is no longer relevant.
      } else if (isChangingView && _shouldShowView) {
        this.currentView.off('destroy', this.empty, this);
      }
  
      if (_shouldShowView) {
  
        // We need to listen for if a view is destroyed
        // in a way other than through the region.
        // If this happens we need to remove the reference
        // to the currentView since once a view has been destroyed
        // we can not reuse it.
        view.once('destroy', this.empty, this);
        view.render();
  
        view._parent = this;
  
        if (isChangingView) {
          this.triggerMethod('before:swap', view, this, options);
        }
  
        this.triggerMethod('before:show', view, this, options);
        Marionette.triggerMethodOn(view, 'before:show', view, this, options);
  
        if (isChangingView) {
          this.triggerMethod('swapOut', this.currentView, this, options);
        }
  
        // An array of views that we're about to display
        var attachedRegion = Marionette.isNodeAttached(this.el);
  
        // The views that we're about to attach to the document
        // It's important that we prevent _getNestedViews from being executed unnecessarily
        // as it's a potentially-slow method
        var displayedViews = [];
  
        var triggerBeforeAttach = showOptions.triggerBeforeAttach || this.triggerBeforeAttach;
        var triggerAttach = showOptions.triggerAttach || this.triggerAttach;
  
        if (attachedRegion && triggerBeforeAttach) {
          displayedViews = this._displayedViews(view);
          this._triggerAttach(displayedViews, 'before:');
        }
  
        this.attachHtml(view);
        this.currentView = view;
  
        if (attachedRegion && triggerAttach) {
          displayedViews = this._displayedViews(view);
          this._triggerAttach(displayedViews);
        }
  
        if (isChangingView) {
          this.triggerMethod('swap', view, this, options);
        }
  
        this.triggerMethod('show', view, this, options);
        Marionette.triggerMethodOn(view, 'show', view, this, options);
  
        return this;
      }
  
      return this;
    },
  
    triggerBeforeAttach: true,
    triggerAttach: true,
  
    _triggerAttach: function(views, prefix) {
      var eventName = (prefix || '') + 'attach';
      _.each(views, function(view) {
        Marionette.triggerMethodOn(view, eventName, view, this);
      }, this);
    },
  
    _displayedViews: function(view) {
      return _.union([view], _.result(view, '_getNestedViews') || []);
    },
  
    _ensureElement: function() {
      if (!_.isObject(this.el)) {
        this.$el = this.getEl(this.el);
        this.el = this.$el[0];
      }
  
      if (!this.$el || this.$el.length === 0) {
        if (this.getOption('allowMissingEl')) {
          return false;
        } else {
          throw new Marionette.Error('An "el" ' + this.$el.selector + ' must exist in DOM');
        }
      }
      return true;
    },
  
    _ensureViewIsIntact: function(view) {
      if (!view) {
        throw new Marionette.Error({
          name: 'ViewNotValid',
          message: 'The view passed is undefined and therefore invalid. You must pass a view instance to show.'
        });
      }
  
      if (view.isDestroyed) {
        throw new Marionette.Error({
          name: 'ViewDestroyedError',
          message: 'View (cid: "' + view.cid + '") has already been destroyed and cannot be used.'
        });
      }
    },
  
    // Override this method to change how the region finds the DOM
    // element that it manages. Return a jQuery selector object scoped
    // to a provided parent el or the document if none exists.
    getEl: function(el) {
      return Backbone.$(el, Marionette._getValue(this.options.parentEl, this));
    },
  
    // Override this method to change how the new view is
    // appended to the `$el` that the region is managing
    attachHtml: function(view) {
      this.$el.contents().detach();
  
      this.el.appendChild(view.el);
    },
  
    // Destroy the current view, if there is one. If there is no
    // current view, it does nothing and returns immediately.
    empty: function(options) {
      var view = this.currentView;
  
      var preventDestroy = Marionette._getValue(options, 'preventDestroy', this);
      // If there is no view in the region
      // we should not remove anything
      if (!view) { return; }
  
      view.off('destroy', this.empty, this);
      this.triggerMethod('before:empty', view);
      if (!preventDestroy) {
        this._destroyView();
      }
      this.triggerMethod('empty', view);
  
      // Remove region pointer to the currentView
      delete this.currentView;
  
      if (preventDestroy) {
        this.$el.contents().detach();
      }
  
      return this;
    },
  
    // call 'destroy' or 'remove', depending on which is found
    // on the view (if showing a raw Backbone view or a Marionette View)
    _destroyView: function() {
      var view = this.currentView;
  
      if (view.destroy && !view.isDestroyed) {
        view.destroy();
      } else if (view.remove) {
        view.remove();
  
        // appending isDestroyed to raw Backbone View allows regions
        // to throw a ViewDestroyedError for this view
        view.isDestroyed = true;
      }
    },
  
    // Attach an existing view to the region. This
    // will not call `render` or `onShow` for the new view,
    // and will not replace the current HTML for the `el`
    // of the region.
    attachView: function(view) {
      this.currentView = view;
      return this;
    },
  
    // Checks whether a view is currently present within
    // the region. Returns `true` if there is and `false` if
    // no view is present.
    hasView: function() {
      return !!this.currentView;
    },
  
    // Reset the region by destroying any existing view and
    // clearing out the cached `$el`. The next time a view
    // is shown via this region, the region will re-query the
    // DOM for the region's `el`.
    reset: function() {
      this.empty();
  
      if (this.$el) {
        this.el = this.$el.selector;
      }
  
      delete this.$el;
      return this;
    }
  
  },
  
  // Static Methods
  {
  
    // Build an instance of a region by passing in a configuration object
    // and a default region class to use if none is specified in the config.
    //
    // The config object should either be a string as a jQuery DOM selector,
    // a Region class directly, or an object literal that specifies a selector,
    // a custom regionClass, and any options to be supplied to the region:
    //
    // ```js
    // {
    //   selector: "#foo",
    //   regionClass: MyCustomRegion,
    //   allowMissingEl: false
    // }
    // ```
    //
    buildRegion: function(regionConfig, DefaultRegionClass) {
      if (_.isString(regionConfig)) {
        return this._buildRegionFromSelector(regionConfig, DefaultRegionClass);
      }
  
      if (regionConfig.selector || regionConfig.el || regionConfig.regionClass) {
        return this._buildRegionFromObject(regionConfig, DefaultRegionClass);
      }
  
      if (_.isFunction(regionConfig)) {
        return this._buildRegionFromRegionClass(regionConfig);
      }
  
      throw new Marionette.Error({
        message: 'Improper region configuration type.',
        url: 'marionette.region.html#region-configuration-types'
      });
    },
  
    // Build the region from a string selector like '#foo-region'
    _buildRegionFromSelector: function(selector, DefaultRegionClass) {
      return new DefaultRegionClass({el: selector});
    },
  
    // Build the region from a configuration object
    // ```js
    // { selector: '#foo', regionClass: FooRegion, allowMissingEl: false }
    // ```
    _buildRegionFromObject: function(regionConfig, DefaultRegionClass) {
      var RegionClass = regionConfig.regionClass || DefaultRegionClass;
      var options = _.omit(regionConfig, 'selector', 'regionClass');
  
      if (regionConfig.selector && !options.el) {
        options.el = regionConfig.selector;
      }
  
      return new RegionClass(options);
    },
  
    // Build the region directly from a given `RegionClass`
    _buildRegionFromRegionClass: function(RegionClass) {
      return new RegionClass();
    }
  });
  
  // Region Manager
  // --------------
  
  // Manage one or more related `Marionette.Region` objects.
  Marionette.RegionManager = Marionette.Controller.extend({
    constructor: function(options) {
      this._regions = {};
      this.length = 0;
  
      Marionette.Controller.call(this, options);
  
      this.addRegions(this.getOption('regions'));
    },
  
    // Add multiple regions using an object literal or a
    // function that returns an object literal, where
    // each key becomes the region name, and each value is
    // the region definition.
    addRegions: function(regionDefinitions, defaults) {
      regionDefinitions = Marionette._getValue(regionDefinitions, this, arguments);
  
      return _.reduce(regionDefinitions, function(regions, definition, name) {
        if (_.isString(definition)) {
          definition = {selector: definition};
        }
        if (definition.selector) {
          definition = _.defaults({}, definition, defaults);
        }
  
        regions[name] = this.addRegion(name, definition);
        return regions;
      }, {}, this);
    },
  
    // Add an individual region to the region manager,
    // and return the region instance
    addRegion: function(name, definition) {
      var region;
  
      if (definition instanceof Marionette.Region) {
        region = definition;
      } else {
        region = Marionette.Region.buildRegion(definition, Marionette.Region);
      }
  
      this.triggerMethod('before:add:region', name, region);
  
      region._parent = this;
      this._store(name, region);
  
      this.triggerMethod('add:region', name, region);
      return region;
    },
  
    // Get a region by name
    get: function(name) {
      return this._regions[name];
    },
  
    // Gets all the regions contained within
    // the `regionManager` instance.
    getRegions: function() {
      return _.clone(this._regions);
    },
  
    // Remove a region by name
    removeRegion: function(name) {
      var region = this._regions[name];
      this._remove(name, region);
  
      return region;
    },
  
    // Empty all regions in the region manager, and
    // remove them
    removeRegions: function() {
      var regions = this.getRegions();
      _.each(this._regions, function(region, name) {
        this._remove(name, region);
      }, this);
  
      return regions;
    },
  
    // Empty all regions in the region manager, but
    // leave them attached
    emptyRegions: function() {
      var regions = this.getRegions();
      _.invoke(regions, 'empty');
      return regions;
    },
  
    // Destroy all regions and shut down the region
    // manager entirely
    destroy: function() {
      this.removeRegions();
      return Marionette.Controller.prototype.destroy.apply(this, arguments);
    },
  
    // internal method to store regions
    _store: function(name, region) {
      if (!this._regions[name]) {
        this.length++;
      }
  
      this._regions[name] = region;
    },
  
    // internal method to remove a region
    _remove: function(name, region) {
      this.triggerMethod('before:remove:region', name, region);
      region.empty();
      region.stopListening();
  
      delete region._parent;
      delete this._regions[name];
      this.length--;
      this.triggerMethod('remove:region', name, region);
    }
  });
  
  Marionette.actAsCollection(Marionette.RegionManager.prototype, '_regions');
  

  // Template Cache
  // --------------
  
  // Manage templates stored in `<script>` blocks,
  // caching them for faster access.
  Marionette.TemplateCache = function(templateId) {
    this.templateId = templateId;
  };
  
  // TemplateCache object-level methods. Manage the template
  // caches from these method calls instead of creating
  // your own TemplateCache instances
  _.extend(Marionette.TemplateCache, {
    templateCaches: {},
  
    // Get the specified template by id. Either
    // retrieves the cached version, or loads it
    // from the DOM.
    get: function(templateId, options) {
      var cachedTemplate = this.templateCaches[templateId];
  
      if (!cachedTemplate) {
        cachedTemplate = new Marionette.TemplateCache(templateId);
        this.templateCaches[templateId] = cachedTemplate;
      }
  
      return cachedTemplate.load(options);
    },
  
    // Clear templates from the cache. If no arguments
    // are specified, clears all templates:
    // `clear()`
    //
    // If arguments are specified, clears each of the
    // specified templates from the cache:
    // `clear("#t1", "#t2", "...")`
    clear: function() {
      var i;
      var args = _.toArray(arguments);
      var length = args.length;
  
      if (length > 0) {
        for (i = 0; i < length; i++) {
          delete this.templateCaches[args[i]];
        }
      } else {
        this.templateCaches = {};
      }
    }
  });
  
  // TemplateCache instance methods, allowing each
  // template cache object to manage its own state
  // and know whether or not it has been loaded
  _.extend(Marionette.TemplateCache.prototype, {
  
    // Internal method to load the template
    load: function(options) {
      // Guard clause to prevent loading this template more than once
      if (this.compiledTemplate) {
        return this.compiledTemplate;
      }
  
      // Load the template and compile it
      var template = this.loadTemplate(this.templateId, options);
      this.compiledTemplate = this.compileTemplate(template, options);
  
      return this.compiledTemplate;
    },
  
    // Load a template from the DOM, by default. Override
    // this method to provide your own template retrieval
    // For asynchronous loading with AMD/RequireJS, consider
    // using a template-loader plugin as described here:
    // https://github.com/marionettejs/backbone.marionette/wiki/Using-marionette-with-requirejs
    loadTemplate: function(templateId, options) {
      var template = Backbone.$(templateId).html();
  
      if (!template || template.length === 0) {
        throw new Marionette.Error({
          name: 'NoTemplateError',
          message: 'Could not find template: "' + templateId + '"'
        });
      }
  
      return template;
    },
  
    // Pre-compile the template before caching it. Override
    // this method if you do not need to pre-compile a template
    // (JST / RequireJS for example) or if you want to change
    // the template engine used (Handebars, etc).
    compileTemplate: function(rawTemplate, options) {
      return _.template(rawTemplate, options);
    }
  });
  
  // Renderer
  // --------
  
  // Render a template with data by passing in the template
  // selector and the data to render.
  Marionette.Renderer = {
  
    // Render a template with data. The `template` parameter is
    // passed to the `TemplateCache` object to retrieve the
    // template function. Override this method to provide your own
    // custom rendering and template handling for all of Marionette.
    render: function(template, data) {
      if (!template) {
        throw new Marionette.Error({
          name: 'TemplateNotFoundError',
          message: 'Cannot render the template since its false, null or undefined.'
        });
      }
  
      var templateFunc = _.isFunction(template) ? template : Marionette.TemplateCache.get(template);
  
      return templateFunc(data);
    }
  };
  

  /* jshint maxlen: 114, nonew: false */
  // View
  // ----
  
  // The core view class that other Marionette views extend from.
  Marionette.View = Backbone.View.extend({
    isDestroyed: false,
  
    constructor: function(options) {
      _.bindAll(this, 'render');
  
      options = Marionette._getValue(options, this);
  
      // this exposes view options to the view initializer
      // this is a backfill since backbone removed the assignment
      // of this.options
      // at some point however this may be removed
      this.options = _.extend({}, _.result(this, 'options'), options);
  
      this._behaviors = Marionette.Behaviors(this);
  
      Backbone.View.call(this, this.options);
  
      Marionette.MonitorDOMRefresh(this);
    },
  
    // Get the template for this view
    // instance. You can set a `template` attribute in the view
    // definition or pass a `template: "whatever"` parameter in
    // to the constructor options.
    getTemplate: function() {
      return this.getOption('template');
    },
  
    // Serialize a model by returning its attributes. Clones
    // the attributes to allow modification.
    serializeModel: function(model) {
      return model.toJSON.apply(model, _.rest(arguments));
    },
  
    // Mix in template helper methods. Looks for a
    // `templateHelpers` attribute, which can either be an
    // object literal, or a function that returns an object
    // literal. All methods and attributes from this object
    // are copies to the object passed in.
    mixinTemplateHelpers: function(target) {
      target = target || {};
      var templateHelpers = this.getOption('templateHelpers');
      templateHelpers = Marionette._getValue(templateHelpers, this);
      return _.extend(target, templateHelpers);
    },
  
    // normalize the keys of passed hash with the views `ui` selectors.
    // `{"@ui.foo": "bar"}`
    normalizeUIKeys: function(hash) {
      var uiBindings = _.result(this, '_uiBindings');
      return Marionette.normalizeUIKeys(hash, uiBindings || _.result(this, 'ui'));
    },
  
    // normalize the values of passed hash with the views `ui` selectors.
    // `{foo: "@ui.bar"}`
    normalizeUIValues: function(hash, properties) {
      var ui = _.result(this, 'ui');
      var uiBindings = _.result(this, '_uiBindings');
      return Marionette.normalizeUIValues(hash, uiBindings || ui, properties);
    },
  
    // Configure `triggers` to forward DOM events to view
    // events. `triggers: {"click .foo": "do:foo"}`
    configureTriggers: function() {
      if (!this.triggers) { return; }
  
      // Allow `triggers` to be configured as a function
      var triggers = this.normalizeUIKeys(_.result(this, 'triggers'));
  
      // Configure the triggers, prevent default
      // action and stop propagation of DOM events
      return _.reduce(triggers, function(events, value, key) {
        events[key] = this._buildViewTrigger(value);
        return events;
      }, {}, this);
    },
  
    // Overriding Backbone.View's delegateEvents to handle
    // the `triggers`, `modelEvents`, and `collectionEvents` configuration
    delegateEvents: function(events) {
      this._delegateDOMEvents(events);
      this.bindEntityEvents(this.model, this.getOption('modelEvents'));
      this.bindEntityEvents(this.collection, this.getOption('collectionEvents'));
  
      _.each(this._behaviors, function(behavior) {
        behavior.bindEntityEvents(this.model, behavior.getOption('modelEvents'));
        behavior.bindEntityEvents(this.collection, behavior.getOption('collectionEvents'));
      }, this);
  
      return this;
    },
  
    // internal method to delegate DOM events and triggers
    _delegateDOMEvents: function(eventsArg) {
      var events = Marionette._getValue(eventsArg || this.events, this);
  
      // normalize ui keys
      events = this.normalizeUIKeys(events);
      if (_.isUndefined(eventsArg)) {this.events = events;}
  
      var combinedEvents = {};
  
      // look up if this view has behavior events
      var behaviorEvents = _.result(this, 'behaviorEvents') || {};
      var triggers = this.configureTriggers();
      var behaviorTriggers = _.result(this, 'behaviorTriggers') || {};
  
      // behavior events will be overriden by view events and or triggers
      _.extend(combinedEvents, behaviorEvents, events, triggers, behaviorTriggers);
  
      Backbone.View.prototype.delegateEvents.call(this, combinedEvents);
    },
  
    // Overriding Backbone.View's undelegateEvents to handle unbinding
    // the `triggers`, `modelEvents`, and `collectionEvents` config
    undelegateEvents: function() {
      Backbone.View.prototype.undelegateEvents.apply(this, arguments);
  
      this.unbindEntityEvents(this.model, this.getOption('modelEvents'));
      this.unbindEntityEvents(this.collection, this.getOption('collectionEvents'));
  
      _.each(this._behaviors, function(behavior) {
        behavior.unbindEntityEvents(this.model, behavior.getOption('modelEvents'));
        behavior.unbindEntityEvents(this.collection, behavior.getOption('collectionEvents'));
      }, this);
  
      return this;
    },
  
    // Internal helper method to verify whether the view hasn't been destroyed
    _ensureViewIsIntact: function() {
      if (this.isDestroyed) {
        throw new Marionette.Error({
          name: 'ViewDestroyedError',
          message: 'View (cid: "' + this.cid + '") has already been destroyed and cannot be used.'
        });
      }
    },
  
    // Default `destroy` implementation, for removing a view from the
    // DOM and unbinding it. Regions will call this method
    // for you. You can specify an `onDestroy` method in your view to
    // add custom code that is called after the view is destroyed.
    destroy: function() {
      if (this.isDestroyed) { return this; }
  
      var args = _.toArray(arguments);
  
      this.triggerMethod.apply(this, ['before:destroy'].concat(args));
  
      // mark as destroyed before doing the actual destroy, to
      // prevent infinite loops within "destroy" event handlers
      // that are trying to destroy other views
      this.isDestroyed = true;
      this.triggerMethod.apply(this, ['destroy'].concat(args));
  
      // unbind UI elements
      this.unbindUIElements();
  
      this.isRendered = false;
  
      // remove the view from the DOM
      this.remove();
  
      // Call destroy on each behavior after
      // destroying the view.
      // This unbinds event listeners
      // that behaviors have registered for.
      _.invoke(this._behaviors, 'destroy', args);
  
      return this;
    },
  
    bindUIElements: function() {
      this._bindUIElements();
      _.invoke(this._behaviors, this._bindUIElements);
    },
  
    // This method binds the elements specified in the "ui" hash inside the view's code with
    // the associated jQuery selectors.
    _bindUIElements: function() {
      if (!this.ui) { return; }
  
      // store the ui hash in _uiBindings so they can be reset later
      // and so re-rendering the view will be able to find the bindings
      if (!this._uiBindings) {
        this._uiBindings = this.ui;
      }
  
      // get the bindings result, as a function or otherwise
      var bindings = _.result(this, '_uiBindings');
  
      // empty the ui so we don't have anything to start with
      this.ui = {};
  
      // bind each of the selectors
      _.each(bindings, function(selector, key) {
        this.ui[key] = this.$(selector);
      }, this);
    },
  
    // This method unbinds the elements specified in the "ui" hash
    unbindUIElements: function() {
      this._unbindUIElements();
      _.invoke(this._behaviors, this._unbindUIElements);
    },
  
    _unbindUIElements: function() {
      if (!this.ui || !this._uiBindings) { return; }
  
      // delete all of the existing ui bindings
      _.each(this.ui, function($el, name) {
        delete this.ui[name];
      }, this);
  
      // reset the ui element to the original bindings configuration
      this.ui = this._uiBindings;
      delete this._uiBindings;
    },
  
    // Internal method to create an event handler for a given `triggerDef` like
    // 'click:foo'
    _buildViewTrigger: function(triggerDef) {
      var hasOptions = _.isObject(triggerDef);
  
      var options = _.defaults({}, (hasOptions ? triggerDef : {}), {
        preventDefault: true,
        stopPropagation: true
      });
  
      var eventName = hasOptions ? options.event : triggerDef;
  
      return function(e) {
        if (e) {
          if (e.preventDefault && options.preventDefault) {
            e.preventDefault();
          }
  
          if (e.stopPropagation && options.stopPropagation) {
            e.stopPropagation();
          }
        }
  
        var args = {
          view: this,
          model: this.model,
          collection: this.collection
        };
  
        this.triggerMethod(eventName, args);
      };
    },
  
    setElement: function() {
      var ret = Backbone.View.prototype.setElement.apply(this, arguments);
  
      // proxy behavior $el to the view's $el.
      // This is needed because a view's $el proxy
      // is not set until after setElement is called.
      _.invoke(this._behaviors, 'proxyViewProperties', this);
  
      return ret;
    },
  
    // import the `triggerMethod` to trigger events with corresponding
    // methods if the method exists
    triggerMethod: function() {
      var ret = Marionette._triggerMethod(this, arguments);
  
      this._triggerEventOnBehaviors(arguments);
      this._triggerEventOnParentLayout(arguments[0], _.rest(arguments));
  
      return ret;
    },
  
    _triggerEventOnBehaviors: function(args) {
      var triggerMethod = Marionette._triggerMethod;
      var behaviors = this._behaviors;
      // Use good ol' for as this is a very hot function
      for (var i = 0, length = behaviors && behaviors.length; i < length; i++) {
        triggerMethod(behaviors[i], args);
      }
    },
  
    _triggerEventOnParentLayout: function(eventName, args) {
      var layoutView = this._parentLayoutView();
      if (!layoutView) {
        return;
      }
  
      // invoke triggerMethod on parent view
      var eventPrefix = Marionette.getOption(layoutView, 'childViewEventPrefix');
      var prefixedEventName = eventPrefix + ':' + eventName;
  
      Marionette._triggerMethod(layoutView, [prefixedEventName, this].concat(args));
  
      // call the parent view's childEvents handler
      var childEvents = Marionette.getOption(layoutView, 'childEvents');
      var normalizedChildEvents = layoutView.normalizeMethods(childEvents);
  
      if (!!normalizedChildEvents && _.isFunction(normalizedChildEvents[eventName])) {
        normalizedChildEvents[eventName].apply(layoutView, [this].concat(args));
      }
    },
  
    // This method returns any views that are immediate
    // children of this view
    _getImmediateChildren: function() {
      return [];
    },
  
    // Returns an array of every nested view within this view
    _getNestedViews: function() {
      var children = this._getImmediateChildren();
  
      if (!children.length) { return children; }
  
      return _.reduce(children, function(memo, view) {
        if (!view._getNestedViews) { return memo; }
        return memo.concat(view._getNestedViews());
      }, children);
    },
  
    // Internal utility for building an ancestor
    // view tree list.
    _getAncestors: function() {
      var ancestors = [];
      var parent  = this._parent;
  
      while (parent) {
        ancestors.push(parent);
        parent = parent._parent;
      }
  
      return ancestors;
    },
  
    // Returns the containing parent view.
    _parentLayoutView: function() {
      var ancestors = this._getAncestors();
      return _.find(ancestors, function(parent) {
        return parent instanceof Marionette.LayoutView;
      });
    },
  
    // Imports the "normalizeMethods" to transform hashes of
    // events=>function references/names to a hash of events=>function references
    normalizeMethods: Marionette.normalizeMethods,
  
    // A handy way to merge passed-in options onto the instance
    mergeOptions: Marionette.mergeOptions,
  
    // Proxy `getOption` to enable getting options from this or this.options by name.
    getOption: Marionette.proxyGetOption,
  
    // Proxy `bindEntityEvents` to enable binding view's events from another entity.
    bindEntityEvents: Marionette.proxyBindEntityEvents,
  
    // Proxy `unbindEntityEvents` to enable unbinding view's events from another entity.
    unbindEntityEvents: Marionette.proxyUnbindEntityEvents
  });
  
  // Item View
  // ---------
  
  // A single item view implementation that contains code for rendering
  // with underscore.js templates, serializing the view's model or collection,
  // and calling several methods on extended views, such as `onRender`.
  Marionette.ItemView = Marionette.View.extend({
  
    // Setting up the inheritance chain which allows changes to
    // Marionette.View.prototype.constructor which allows overriding
    constructor: function() {
      Marionette.View.apply(this, arguments);
    },
  
    // Serialize the model or collection for the view. If a model is
    // found, the view's `serializeModel` is called. If a collection is found,
    // each model in the collection is serialized by calling
    // the view's `serializeCollection` and put into an `items` array in
    // the resulting data. If both are found, defaults to the model.
    // You can override the `serializeData` method in your own view definition,
    // to provide custom serialization for your view's data.
    serializeData: function() {
      if (!this.model && !this.collection) {
        return {};
      }
  
      var args = [this.model || this.collection];
      if (arguments.length) {
        args.push.apply(args, arguments);
      }
  
      if (this.model) {
        return this.serializeModel.apply(this, args);
      } else {
        return {
          items: this.serializeCollection.apply(this, args)
        };
      }
    },
  
    // Serialize a collection by serializing each of its models.
    serializeCollection: function(collection) {
      return collection.toJSON.apply(collection, _.rest(arguments));
    },
  
    // Render the view, defaulting to underscore.js templates.
    // You can override this in your view definition to provide
    // a very specific rendering for your view. In general, though,
    // you should override the `Marionette.Renderer` object to
    // change how Marionette renders views.
    render: function() {
      this._ensureViewIsIntact();
  
      this.triggerMethod('before:render', this);
  
      this._renderTemplate();
      this.isRendered = true;
      this.bindUIElements();
  
      this.triggerMethod('render', this);
  
      return this;
    },
  
    // Internal method to render the template with the serialized data
    // and template helpers via the `Marionette.Renderer` object.
    // Throws an `UndefinedTemplateError` error if the template is
    // any falsely value but literal `false`.
    _renderTemplate: function() {
      var template = this.getTemplate();
  
      // Allow template-less item views
      if (template === false) {
        return;
      }
  
      if (!template) {
        throw new Marionette.Error({
          name: 'UndefinedTemplateError',
          message: 'Cannot render the template since it is null or undefined.'
        });
      }
  
      // Add in entity data and template helpers
      var data = this.mixinTemplateHelpers(this.serializeData());
  
      // Render and add to el
      var html = Marionette.Renderer.render(template, data, this);
      this.attachElContent(html);
  
      return this;
    },
  
    // Attaches the content of a given view.
    // This method can be overridden to optimize rendering,
    // or to render in a non standard way.
    //
    // For example, using `innerHTML` instead of `$el.html`
    //
    // ```js
    // attachElContent: function(html) {
    //   this.el.innerHTML = html;
    //   return this;
    // }
    // ```
    attachElContent: function(html) {
      this.$el.html(html);
  
      return this;
    }
  });
  
  /* jshint maxstatements: 14 */
  
  // Collection View
  // ---------------
  
  // A view that iterates over a Backbone.Collection
  // and renders an individual child view for each model.
  Marionette.CollectionView = Marionette.View.extend({
  
    // used as the prefix for child view events
    // that are forwarded through the collectionview
    childViewEventPrefix: 'childview',
  
    // flag for maintaining the sorted order of the collection
    sort: true,
  
    // constructor
    // option to pass `{sort: false}` to prevent the `CollectionView` from
    // maintaining the sorted order of the collection.
    // This will fallback onto appending childView's to the end.
    //
    // option to pass `{comparator: compFunction()}` to allow the `CollectionView`
    // to use a custom sort order for the collection.
    constructor: function(options) {
  
      this.once('render', this._initialEvents);
      this._initChildViewStorage();
  
      Marionette.View.apply(this, arguments);
  
      this.on('show', this._onShowCalled);
  
      this.initRenderBuffer();
    },
  
    // Instead of inserting elements one by one into the page,
    // it's much more performant to insert elements into a document
    // fragment and then insert that document fragment into the page
    initRenderBuffer: function() {
      this._bufferedChildren = [];
    },
  
    startBuffering: function() {
      this.initRenderBuffer();
      this.isBuffering = true;
    },
  
    endBuffering: function() {
      this.isBuffering = false;
      this._triggerBeforeShowBufferedChildren();
  
      this.attachBuffer(this);
  
      this._triggerShowBufferedChildren();
      this.initRenderBuffer();
    },
  
    _triggerBeforeShowBufferedChildren: function() {
      if (this._isShown) {
        _.each(this._bufferedChildren, _.partial(this._triggerMethodOnChild, 'before:show'));
      }
    },
  
    _triggerShowBufferedChildren: function() {
      if (this._isShown) {
        _.each(this._bufferedChildren, _.partial(this._triggerMethodOnChild, 'show'));
  
        this._bufferedChildren = [];
      }
    },
  
    // Internal method for _.each loops to call `Marionette.triggerMethodOn` on
    // a child view
    _triggerMethodOnChild: function(event, childView) {
      Marionette.triggerMethodOn(childView, event);
    },
  
    // Configured the initial events that the collection view
    // binds to.
    _initialEvents: function() {
      if (this.collection) {
        this.listenTo(this.collection, 'add', this._onCollectionAdd);
        this.listenTo(this.collection, 'remove', this._onCollectionRemove);
        this.listenTo(this.collection, 'reset', this.render);
  
        if (this.getOption('sort')) {
          this.listenTo(this.collection, 'sort', this._sortViews);
        }
      }
    },
  
    // Handle a child added to the collection
    _onCollectionAdd: function(child, collection, opts) {
      var index;
      if (opts.at !== undefined) {
        index = opts.at;
      } else {
        index = _.indexOf(this._filteredSortedModels(), child);
      }
  
      if (this._shouldAddChild(child, index)) {
        this.destroyEmptyView();
        var ChildView = this.getChildView(child);
        this.addChild(child, ChildView, index);
      }
    },
  
    // get the child view by model it holds, and remove it
    _onCollectionRemove: function(model) {
      var view = this.children.findByModel(model);
      this.removeChildView(view);
      this.checkEmpty();
    },
  
    _onShowCalled: function() {
      this.children.each(_.partial(this._triggerMethodOnChild, 'show'));
    },
  
    // Render children views. Override this method to
    // provide your own implementation of a render function for
    // the collection view.
    render: function() {
      this._ensureViewIsIntact();
      this.triggerMethod('before:render', this);
      this._renderChildren();
      this.isRendered = true;
      this.triggerMethod('render', this);
      return this;
    },
  
    // Reorder DOM after sorting. When your element's rendering
    // do not use their index, you can pass reorderOnSort: true
    // to only reorder the DOM after a sort instead of rendering
    // all the collectionView
    reorder: function() {
      var children = this.children;
      var models = this._filteredSortedModels();
      var modelsChanged = _.find(models, function(model) {
        return !children.findByModel(model);
      });
  
      // If the models we're displaying have changed due to filtering
      // We need to add and/or remove child views
      // So render as normal
      if (modelsChanged) {
        this.render();
      } else {
        // get the DOM nodes in the same order as the models
        var els = _.map(models, function(model) {
          return children.findByModel(model).el;
        });
  
        // since append moves elements that are already in the DOM,
        // appending the elements will effectively reorder them
        this.triggerMethod('before:reorder');
        this._appendReorderedChildren(els);
        this.triggerMethod('reorder');
      }
    },
  
    // Render view after sorting. Override this method to
    // change how the view renders after a `sort` on the collection.
    // An example of this would be to only `renderChildren` in a `CompositeView`
    // rather than the full view.
    resortView: function() {
      if (Marionette.getOption(this, 'reorderOnSort')) {
        this.reorder();
      } else {
        this.render();
      }
    },
  
    // Internal method. This checks for any changes in the order of the collection.
    // If the index of any view doesn't match, it will render.
    _sortViews: function() {
      var models = this._filteredSortedModels();
  
      // check for any changes in sort order of views
      var orderChanged = _.find(models, function(item, index) {
        var view = this.children.findByModel(item);
        return !view || view._index !== index;
      }, this);
  
      if (orderChanged) {
        this.resortView();
      }
    },
  
    // Internal reference to what index a `emptyView` is.
    _emptyViewIndex: -1,
  
    // Internal method. Separated so that CompositeView can append to the childViewContainer
    // if necessary
    _appendReorderedChildren: function(children) {
      this.$el.append(children);
    },
  
    // Internal method. Separated so that CompositeView can have
    // more control over events being triggered, around the rendering
    // process
    _renderChildren: function() {
      this.destroyEmptyView();
      this.destroyChildren();
  
      if (this.isEmpty(this.collection)) {
        this.showEmptyView();
      } else {
        this.triggerMethod('before:render:collection', this);
        this.startBuffering();
        this.showCollection();
        this.endBuffering();
        this.triggerMethod('render:collection', this);
  
        // If we have shown children and none have passed the filter, show the empty view
        if (this.children.isEmpty()) {
          this.showEmptyView();
        }
      }
    },
  
    // Internal method to loop through collection and show each child view.
    showCollection: function() {
      var ChildView;
  
      var models = this._filteredSortedModels();
  
      _.each(models, function(child, index) {
        ChildView = this.getChildView(child);
        this.addChild(child, ChildView, index);
      }, this);
    },
  
    // Allow the collection to be sorted by a custom view comparator
    _filteredSortedModels: function() {
      var models;
      var viewComparator = this.getViewComparator();
  
      if (viewComparator) {
        if (_.isString(viewComparator) || viewComparator.length === 1) {
          models = this.collection.sortBy(viewComparator, this);
        } else {
          models = _.clone(this.collection.models).sort(_.bind(viewComparator, this));
        }
      } else {
        models = this.collection.models;
      }
  
      // Filter after sorting in case the filter uses the index
      if (this.getOption('filter')) {
        models = _.filter(models, function(model, index) {
          return this._shouldAddChild(model, index);
        }, this);
      }
  
      return models;
    },
  
    // Internal method to show an empty view in place of
    // a collection of child views, when the collection is empty
    showEmptyView: function() {
      var EmptyView = this.getEmptyView();
  
      if (EmptyView && !this._showingEmptyView) {
        this.triggerMethod('before:render:empty');
  
        this._showingEmptyView = true;
        var model = new Backbone.Model();
        this.addEmptyView(model, EmptyView);
  
        this.triggerMethod('render:empty');
      }
    },
  
    // Internal method to destroy an existing emptyView instance
    // if one exists. Called when a collection view has been
    // rendered empty, and then a child is added to the collection.
    destroyEmptyView: function() {
      if (this._showingEmptyView) {
        this.triggerMethod('before:remove:empty');
  
        this.destroyChildren();
        delete this._showingEmptyView;
  
        this.triggerMethod('remove:empty');
      }
    },
  
    // Retrieve the empty view class
    getEmptyView: function() {
      return this.getOption('emptyView');
    },
  
    // Render and show the emptyView. Similar to addChild method
    // but "add:child" events are not fired, and the event from
    // emptyView are not forwarded
    addEmptyView: function(child, EmptyView) {
  
      // get the emptyViewOptions, falling back to childViewOptions
      var emptyViewOptions = this.getOption('emptyViewOptions') ||
                            this.getOption('childViewOptions');
  
      if (_.isFunction(emptyViewOptions)) {
        emptyViewOptions = emptyViewOptions.call(this, child, this._emptyViewIndex);
      }
  
      // build the empty view
      var view = this.buildChildView(child, EmptyView, emptyViewOptions);
  
      view._parent = this;
  
      // Proxy emptyView events
      this.proxyChildEvents(view);
  
      // trigger the 'before:show' event on `view` if the collection view
      // has already been shown
      if (this._isShown) {
        Marionette.triggerMethodOn(view, 'before:show');
      }
  
      // Store the `emptyView` like a `childView` so we can properly
      // remove and/or close it later
      this.children.add(view);
  
      // Render it and show it
      this.renderChildView(view, this._emptyViewIndex);
  
      // call the 'show' method if the collection view
      // has already been shown
      if (this._isShown) {
        Marionette.triggerMethodOn(view, 'show');
      }
    },
  
    // Retrieve the `childView` class, either from `this.options.childView`
    // or from the `childView` in the object definition. The "options"
    // takes precedence.
    // This method receives the model that will be passed to the instance
    // created from this `childView`. Overriding methods may use the child
    // to determine what `childView` class to return.
    getChildView: function(child) {
      var childView = this.getOption('childView');
  
      if (!childView) {
        throw new Marionette.Error({
          name: 'NoChildViewError',
          message: 'A "childView" must be specified'
        });
      }
  
      return childView;
    },
  
    // Render the child's view and add it to the
    // HTML for the collection view at a given index.
    // This will also update the indices of later views in the collection
    // in order to keep the children in sync with the collection.
    addChild: function(child, ChildView, index) {
      var childViewOptions = this.getOption('childViewOptions');
      childViewOptions = Marionette._getValue(childViewOptions, this, [child, index]);
  
      var view = this.buildChildView(child, ChildView, childViewOptions);
  
      // increment indices of views after this one
      this._updateIndices(view, true, index);
  
      this._addChildView(view, index);
  
      view._parent = this;
  
      return view;
    },
  
    // Internal method. This decrements or increments the indices of views after the
    // added/removed view to keep in sync with the collection.
    _updateIndices: function(view, increment, index) {
      if (!this.getOption('sort')) {
        return;
      }
  
      if (increment) {
        // assign the index to the view
        view._index = index;
      }
  
      // update the indexes of views after this one
      this.children.each(function(laterView) {
        if (laterView._index >= view._index) {
          laterView._index += increment ? 1 : -1;
        }
      });
    },
  
    // Internal Method. Add the view to children and render it at
    // the given index.
    _addChildView: function(view, index) {
      // set up the child view event forwarding
      this.proxyChildEvents(view);
  
      this.triggerMethod('before:add:child', view);
  
      // trigger the 'before:show' event on `view` if the collection view
      // has already been shown
      if (this._isShown && !this.isBuffering) {
        Marionette.triggerMethodOn(view, 'before:show');
      }
  
      // Store the child view itself so we can properly
      // remove and/or destroy it later
      this.children.add(view);
      this.renderChildView(view, index);
  
      if (this._isShown && !this.isBuffering) {
        Marionette.triggerMethodOn(view, 'show');
      }
  
      this.triggerMethod('add:child', view);
    },
  
    // render the child view
    renderChildView: function(view, index) {
      view.render();
      this.attachHtml(this, view, index);
      return view;
    },
  
    // Build a `childView` for a model in the collection.
    buildChildView: function(child, ChildViewClass, childViewOptions) {
      var options = _.extend({model: child}, childViewOptions);
      return new ChildViewClass(options);
    },
  
    // Remove the child view and destroy it.
    // This function also updates the indices of
    // later views in the collection in order to keep
    // the children in sync with the collection.
    removeChildView: function(view) {
  
      if (view) {
        this.triggerMethod('before:remove:child', view);
  
        // call 'destroy' or 'remove', depending on which is found
        if (view.destroy) {
          view.destroy();
        } else if (view.remove) {
          view.remove();
        }
  
        delete view._parent;
        this.stopListening(view);
        this.children.remove(view);
        this.triggerMethod('remove:child', view);
  
        // decrement the index of views after this one
        this._updateIndices(view, false);
      }
  
      return view;
    },
  
    // check if the collection is empty
    isEmpty: function() {
      return !this.collection || this.collection.length === 0;
    },
  
    // If empty, show the empty view
    checkEmpty: function() {
      if (this.isEmpty(this.collection)) {
        this.showEmptyView();
      }
    },
  
    // You might need to override this if you've overridden attachHtml
    attachBuffer: function(collectionView) {
      collectionView.$el.append(this._createBuffer(collectionView));
    },
  
    // Create a fragment buffer from the currently buffered children
    _createBuffer: function(collectionView) {
      var elBuffer = document.createDocumentFragment();
      _.each(collectionView._bufferedChildren, function(b) {
        elBuffer.appendChild(b.el);
      });
      return elBuffer;
    },
  
    // Append the HTML to the collection's `el`.
    // Override this method to do something other
    // than `.append`.
    attachHtml: function(collectionView, childView, index) {
      if (collectionView.isBuffering) {
        // buffering happens on reset events and initial renders
        // in order to reduce the number of inserts into the
        // document, which are expensive.
        collectionView._bufferedChildren.splice(index, 0, childView);
      } else {
        // If we've already rendered the main collection, append
        // the new child into the correct order if we need to. Otherwise
        // append to the end.
        if (!collectionView._insertBefore(childView, index)) {
          collectionView._insertAfter(childView);
        }
      }
    },
  
    // Internal method. Check whether we need to insert the view into
    // the correct position.
    _insertBefore: function(childView, index) {
      var currentView;
      var findPosition = this.getOption('sort') && (index < this.children.length - 1);
      if (findPosition) {
        // Find the view after this one
        currentView = this.children.find(function(view) {
          return view._index === index + 1;
        });
      }
  
      if (currentView) {
        currentView.$el.before(childView.el);
        return true;
      }
  
      return false;
    },
  
    // Internal method. Append a view to the end of the $el
    _insertAfter: function(childView) {
      this.$el.append(childView.el);
    },
  
    // Internal method to set up the `children` object for
    // storing all of the child views
    _initChildViewStorage: function() {
      this.children = new Backbone.ChildViewContainer();
    },
  
    // Handle cleanup and other destroying needs for the collection of views
    destroy: function() {
      if (this.isDestroyed) { return this; }
  
      this.triggerMethod('before:destroy:collection');
      this.destroyChildren();
      this.triggerMethod('destroy:collection');
  
      return Marionette.View.prototype.destroy.apply(this, arguments);
    },
  
    // Destroy the child views that this collection view
    // is holding on to, if any
    destroyChildren: function() {
      var childViews = this.children.map(_.identity);
      this.children.each(this.removeChildView, this);
      this.checkEmpty();
      return childViews;
    },
  
    // Return true if the given child should be shown
    // Return false otherwise
    // The filter will be passed (child, index, collection)
    // Where
    //  'child' is the given model
    //  'index' is the index of that model in the collection
    //  'collection' is the collection referenced by this CollectionView
    _shouldAddChild: function(child, index) {
      var filter = this.getOption('filter');
      return !_.isFunction(filter) || filter.call(this, child, index, this.collection);
    },
  
    // Set up the child view event forwarding. Uses a "childview:"
    // prefix in front of all forwarded events.
    proxyChildEvents: function(view) {
      var prefix = this.getOption('childViewEventPrefix');
  
      // Forward all child view events through the parent,
      // prepending "childview:" to the event name
      this.listenTo(view, 'all', function() {
        var args = _.toArray(arguments);
        var rootEvent = args[0];
        var childEvents = this.normalizeMethods(_.result(this, 'childEvents'));
  
        args[0] = prefix + ':' + rootEvent;
        args.splice(1, 0, view);
  
        // call collectionView childEvent if defined
        if (typeof childEvents !== 'undefined' && _.isFunction(childEvents[rootEvent])) {
          childEvents[rootEvent].apply(this, args.slice(1));
        }
  
        this.triggerMethod.apply(this, args);
      });
    },
  
    _getImmediateChildren: function() {
      return _.values(this.children._views);
    },
  
    getViewComparator: function() {
      return this.getOption('viewComparator');
    }
  });
  
  /* jshint maxstatements: 17, maxlen: 117 */
  
  // Composite View
  // --------------
  
  // Used for rendering a branch-leaf, hierarchical structure.
  // Extends directly from CollectionView and also renders an
  // a child view as `modelView`, for the top leaf
  Marionette.CompositeView = Marionette.CollectionView.extend({
  
    // Setting up the inheritance chain which allows changes to
    // Marionette.CollectionView.prototype.constructor which allows overriding
    // option to pass '{sort: false}' to prevent the CompositeView from
    // maintaining the sorted order of the collection.
    // This will fallback onto appending childView's to the end.
    constructor: function() {
      Marionette.CollectionView.apply(this, arguments);
    },
  
    // Configured the initial events that the composite view
    // binds to. Override this method to prevent the initial
    // events, or to add your own initial events.
    _initialEvents: function() {
  
      // Bind only after composite view is rendered to avoid adding child views
      // to nonexistent childViewContainer
  
      if (this.collection) {
        this.listenTo(this.collection, 'add', this._onCollectionAdd);
        this.listenTo(this.collection, 'remove', this._onCollectionRemove);
        this.listenTo(this.collection, 'reset', this._renderChildren);
  
        if (this.getOption('sort')) {
          this.listenTo(this.collection, 'sort', this._sortViews);
        }
      }
    },
  
    // Retrieve the `childView` to be used when rendering each of
    // the items in the collection. The default is to return
    // `this.childView` or Marionette.CompositeView if no `childView`
    // has been defined
    getChildView: function(child) {
      var childView = this.getOption('childView') || this.constructor;
  
      return childView;
    },
  
    // Serialize the model for the view.
    // You can override the `serializeData` method in your own view
    // definition, to provide custom serialization for your view's data.
    serializeData: function() {
      var data = {};
  
      if (this.model) {
        data = _.partial(this.serializeModel, this.model).apply(this, arguments);
      }
  
      return data;
    },
  
    // Renders the model and the collection.
    render: function() {
      this._ensureViewIsIntact();
      this._isRendering = true;
      this.resetChildViewContainer();
  
      this.triggerMethod('before:render', this);
  
      this._renderTemplate();
      this._renderChildren();
  
      this._isRendering = false;
      this.isRendered = true;
      this.triggerMethod('render', this);
      return this;
    },
  
    _renderChildren: function() {
      if (this.isRendered || this._isRendering) {
        Marionette.CollectionView.prototype._renderChildren.call(this);
      }
    },
  
    // Render the root template that the children
    // views are appended to
    _renderTemplate: function() {
      var data = {};
      data = this.serializeData();
      data = this.mixinTemplateHelpers(data);
  
      this.triggerMethod('before:render:template');
  
      var template = this.getTemplate();
      var html = Marionette.Renderer.render(template, data, this);
      this.attachElContent(html);
  
      // the ui bindings is done here and not at the end of render since they
      // will not be available until after the model is rendered, but should be
      // available before the collection is rendered.
      this.bindUIElements();
      this.triggerMethod('render:template');
    },
  
    // Attaches the content of the root.
    // This method can be overridden to optimize rendering,
    // or to render in a non standard way.
    //
    // For example, using `innerHTML` instead of `$el.html`
    //
    // ```js
    // attachElContent: function(html) {
    //   this.el.innerHTML = html;
    //   return this;
    // }
    // ```
    attachElContent: function(html) {
      this.$el.html(html);
  
      return this;
    },
  
    // You might need to override this if you've overridden attachHtml
    attachBuffer: function(compositeView) {
      var $container = this.getChildViewContainer(compositeView);
      $container.append(this._createBuffer(compositeView));
    },
  
    // Internal method. Append a view to the end of the $el.
    // Overidden from CollectionView to ensure view is appended to
    // childViewContainer
    _insertAfter: function(childView) {
      var $container = this.getChildViewContainer(this, childView);
      $container.append(childView.el);
    },
  
    // Internal method. Append reordered childView'.
    // Overidden from CollectionView to ensure reordered views
    // are appended to childViewContainer
    _appendReorderedChildren: function(children) {
      var $container = this.getChildViewContainer(this);
      $container.append(children);
    },
  
    // Internal method to ensure an `$childViewContainer` exists, for the
    // `attachHtml` method to use.
    getChildViewContainer: function(containerView, childView) {
      if ('$childViewContainer' in containerView) {
        return containerView.$childViewContainer;
      }
  
      var container;
      var childViewContainer = Marionette.getOption(containerView, 'childViewContainer');
      if (childViewContainer) {
  
        var selector = Marionette._getValue(childViewContainer, containerView);
  
        if (selector.charAt(0) === '@' && containerView.ui) {
          container = containerView.ui[selector.substr(4)];
        } else {
          container = containerView.$(selector);
        }
  
        if (container.length <= 0) {
          throw new Marionette.Error({
            name: 'ChildViewContainerMissingError',
            message: 'The specified "childViewContainer" was not found: ' + containerView.childViewContainer
          });
        }
  
      } else {
        container = containerView.$el;
      }
  
      containerView.$childViewContainer = container;
      return container;
    },
  
    // Internal method to reset the `$childViewContainer` on render
    resetChildViewContainer: function() {
      if (this.$childViewContainer) {
        delete this.$childViewContainer;
      }
    }
  });
  
  // Layout View
  // -----------
  
  // Used for managing application layoutViews, nested layoutViews and
  // multiple regions within an application or sub-application.
  //
  // A specialized view class that renders an area of HTML and then
  // attaches `Region` instances to the specified `regions`.
  // Used for composite view management and sub-application areas.
  Marionette.LayoutView = Marionette.ItemView.extend({
    regionClass: Marionette.Region,
  
    options: {
      destroyImmediate: false
    },
  
    // used as the prefix for child view events
    // that are forwarded through the layoutview
    childViewEventPrefix: 'childview',
  
    // Ensure the regions are available when the `initialize` method
    // is called.
    constructor: function(options) {
      options = options || {};
  
      this._firstRender = true;
      this._initializeRegions(options);
  
      Marionette.ItemView.call(this, options);
    },
  
    // LayoutView's render will use the existing region objects the
    // first time it is called. Subsequent calls will destroy the
    // views that the regions are showing and then reset the `el`
    // for the regions to the newly rendered DOM elements.
    render: function() {
      this._ensureViewIsIntact();
  
      if (this._firstRender) {
        // if this is the first render, don't do anything to
        // reset the regions
        this._firstRender = false;
      } else {
        // If this is not the first render call, then we need to
        // re-initialize the `el` for each region
        this._reInitializeRegions();
      }
  
      return Marionette.ItemView.prototype.render.apply(this, arguments);
    },
  
    // Handle destroying regions, and then destroy the view itself.
    destroy: function() {
      if (this.isDestroyed) { return this; }
      // #2134: remove parent element before destroying the child views, so
      // removing the child views doesn't retrigger repaints
      if (this.getOption('destroyImmediate') === true) {
        this.$el.remove();
      }
      this.regionManager.destroy();
      return Marionette.ItemView.prototype.destroy.apply(this, arguments);
    },
  
    showChildView: function(regionName, view) {
      return this.getRegion(regionName).show(view);
    },
  
    getChildView: function(regionName) {
      return this.getRegion(regionName).currentView;
    },
  
    // Add a single region, by name, to the layoutView
    addRegion: function(name, definition) {
      var regions = {};
      regions[name] = definition;
      return this._buildRegions(regions)[name];
    },
  
    // Add multiple regions as a {name: definition, name2: def2} object literal
    addRegions: function(regions) {
      this.regions = _.extend({}, this.regions, regions);
      return this._buildRegions(regions);
    },
  
    // Remove a single region from the LayoutView, by name
    removeRegion: function(name) {
      delete this.regions[name];
      return this.regionManager.removeRegion(name);
    },
  
    // Provides alternative access to regions
    // Accepts the region name
    // getRegion('main')
    getRegion: function(region) {
      return this.regionManager.get(region);
    },
  
    // Get all regions
    getRegions: function() {
      return this.regionManager.getRegions();
    },
  
    // internal method to build regions
    _buildRegions: function(regions) {
      var defaults = {
        regionClass: this.getOption('regionClass'),
        parentEl: _.partial(_.result, this, 'el')
      };
  
      return this.regionManager.addRegions(regions, defaults);
    },
  
    // Internal method to initialize the regions that have been defined in a
    // `regions` attribute on this layoutView.
    _initializeRegions: function(options) {
      var regions;
      this._initRegionManager();
  
      regions = Marionette._getValue(this.regions, this, [options]) || {};
  
      // Enable users to define `regions` as instance options.
      var regionOptions = this.getOption.call(options, 'regions');
  
      // enable region options to be a function
      regionOptions = Marionette._getValue(regionOptions, this, [options]);
  
      _.extend(regions, regionOptions);
  
      // Normalize region selectors hash to allow
      // a user to use the @ui. syntax.
      regions = this.normalizeUIValues(regions, ['selector', 'el']);
  
      this.addRegions(regions);
    },
  
    // Internal method to re-initialize all of the regions by updating the `el` that
    // they point to
    _reInitializeRegions: function() {
      this.regionManager.invoke('reset');
    },
  
    // Enable easy overriding of the default `RegionManager`
    // for customized region interactions and business specific
    // view logic for better control over single regions.
    getRegionManager: function() {
      return new Marionette.RegionManager();
    },
  
    // Internal method to initialize the region manager
    // and all regions in it
    _initRegionManager: function() {
      this.regionManager = this.getRegionManager();
      this.regionManager._parent = this;
  
      this.listenTo(this.regionManager, 'before:add:region', function(name) {
        this.triggerMethod('before:add:region', name);
      });
  
      this.listenTo(this.regionManager, 'add:region', function(name, region) {
        this[name] = region;
        this.triggerMethod('add:region', name, region);
      });
  
      this.listenTo(this.regionManager, 'before:remove:region', function(name) {
        this.triggerMethod('before:remove:region', name);
      });
  
      this.listenTo(this.regionManager, 'remove:region', function(name, region) {
        delete this[name];
        this.triggerMethod('remove:region', name, region);
      });
    },
  
    _getImmediateChildren: function() {
      return _.chain(this.regionManager.getRegions())
        .pluck('currentView')
        .compact()
        .value();
    }
  });
  

  // Behavior
  // --------
  
  // A Behavior is an isolated set of DOM /
  // user interactions that can be mixed into any View.
  // Behaviors allow you to blackbox View specific interactions
  // into portable logical chunks, keeping your views simple and your code DRY.
  
  Marionette.Behavior = Marionette.Object.extend({
    constructor: function(options, view) {
      // Setup reference to the view.
      // this comes in handle when a behavior
      // wants to directly talk up the chain
      // to the view.
      this.view = view;
      this.defaults = _.result(this, 'defaults') || {};
      this.options  = _.extend({}, this.defaults, options);
      // Construct an internal UI hash using
      // the views UI hash and then the behaviors UI hash.
      // This allows the user to use UI hash elements
      // defined in the parent view as well as those
      // defined in the given behavior.
      this.ui = _.extend({}, _.result(view, 'ui'), _.result(this, 'ui'));
  
      Marionette.Object.apply(this, arguments);
    },
  
    // proxy behavior $ method to the view
    // this is useful for doing jquery DOM lookups
    // scoped to behaviors view.
    $: function() {
      return this.view.$.apply(this.view, arguments);
    },
  
    // Stops the behavior from listening to events.
    // Overrides Object#destroy to prevent additional events from being triggered.
    destroy: function() {
      this.stopListening();
  
      return this;
    },
  
    proxyViewProperties: function(view) {
      this.$el = view.$el;
      this.el = view.el;
    }
  });
  
  /* jshint maxlen: 143 */
  // Behaviors
  // ---------
  
  // Behaviors is a utility class that takes care of
  // gluing your behavior instances to their given View.
  // The most important part of this class is that you
  // **MUST** override the class level behaviorsLookup
  // method for things to work properly.
  
  Marionette.Behaviors = (function(Marionette, _) {
    // Borrow event splitter from Backbone
    var delegateEventSplitter = /^(\S+)\s*(.*)$/;
  
    function Behaviors(view, behaviors) {
  
      if (!_.isObject(view.behaviors)) {
        return {};
      }
  
      // Behaviors defined on a view can be a flat object literal
      // or it can be a function that returns an object.
      behaviors = Behaviors.parseBehaviors(view, behaviors || _.result(view, 'behaviors'));
  
      // Wraps several of the view's methods
      // calling the methods first on each behavior
      // and then eventually calling the method on the view.
      Behaviors.wrap(view, behaviors, _.keys(methods));
      return behaviors;
    }
  
    var methods = {
      behaviorTriggers: function(behaviorTriggers, behaviors) {
        var triggerBuilder = new BehaviorTriggersBuilder(this, behaviors);
        return triggerBuilder.buildBehaviorTriggers();
      },
  
      behaviorEvents: function(behaviorEvents, behaviors) {
        var _behaviorsEvents = {};
  
        _.each(behaviors, function(b, i) {
          var _events = {};
          var behaviorEvents = _.clone(_.result(b, 'events')) || {};
  
          // Normalize behavior events hash to allow
          // a user to use the @ui. syntax.
          behaviorEvents = Marionette.normalizeUIKeys(behaviorEvents, getBehaviorsUI(b));
  
          var j = 0;
          _.each(behaviorEvents, function(behaviour, key) {
            var match     = key.match(delegateEventSplitter);
  
            // Set event name to be namespaced using the view cid,
            // the behavior index, and the behavior event index
            // to generate a non colliding event namespace
            // http://api.jquery.com/event.namespace/
            var eventName = match[1] + '.' + [this.cid, i, j++, ' '].join('');
            var selector  = match[2];
  
            var eventKey  = eventName + selector;
            var handler   = _.isFunction(behaviour) ? behaviour : b[behaviour];
  
            _events[eventKey] = _.bind(handler, b);
          }, this);
  
          _behaviorsEvents = _.extend(_behaviorsEvents, _events);
        }, this);
  
        return _behaviorsEvents;
      }
    };
  
    _.extend(Behaviors, {
  
      // Placeholder method to be extended by the user.
      // The method should define the object that stores the behaviors.
      // i.e.
      //
      // ```js
      // Marionette.Behaviors.behaviorsLookup: function() {
      //   return App.Behaviors
      // }
      // ```
      behaviorsLookup: function() {
        throw new Marionette.Error({
          message: 'You must define where your behaviors are stored.',
          url: 'marionette.behaviors.html#behaviorslookup'
        });
      },
  
      // Takes care of getting the behavior class
      // given options and a key.
      // If a user passes in options.behaviorClass
      // default to using that. Otherwise delegate
      // the lookup to the users `behaviorsLookup` implementation.
      getBehaviorClass: function(options, key) {
        if (options.behaviorClass) {
          return options.behaviorClass;
        }
  
        // Get behavior class can be either a flat object or a method
        return Marionette._getValue(Behaviors.behaviorsLookup, this, [options, key])[key];
      },
  
      // Iterate over the behaviors object, for each behavior
      // instantiate it and get its grouped behaviors.
      parseBehaviors: function(view, behaviors) {
        return _.chain(behaviors).map(function(options, key) {
          var BehaviorClass = Behaviors.getBehaviorClass(options, key);
  
          var behavior = new BehaviorClass(options, view);
          var nestedBehaviors = Behaviors.parseBehaviors(view, _.result(behavior, 'behaviors'));
  
          return [behavior].concat(nestedBehaviors);
        }).flatten().value();
      },
  
      // Wrap view internal methods so that they delegate to behaviors. For example,
      // `onDestroy` should trigger destroy on all of the behaviors and then destroy itself.
      // i.e.
      //
      // `view.delegateEvents = _.partial(methods.delegateEvents, view.delegateEvents, behaviors);`
      wrap: function(view, behaviors, methodNames) {
        _.each(methodNames, function(methodName) {
          view[methodName] = _.partial(methods[methodName], view[methodName], behaviors);
        });
      }
    });
  
    // Class to build handlers for `triggers` on behaviors
    // for views
    function BehaviorTriggersBuilder(view, behaviors) {
      this._view      = view;
      this._behaviors = behaviors;
      this._triggers  = {};
    }
  
    _.extend(BehaviorTriggersBuilder.prototype, {
      // Main method to build the triggers hash with event keys and handlers
      buildBehaviorTriggers: function() {
        _.each(this._behaviors, this._buildTriggerHandlersForBehavior, this);
        return this._triggers;
      },
  
      // Internal method to build all trigger handlers for a given behavior
      _buildTriggerHandlersForBehavior: function(behavior, i) {
        var triggersHash = _.clone(_.result(behavior, 'triggers')) || {};
  
        triggersHash = Marionette.normalizeUIKeys(triggersHash, getBehaviorsUI(behavior));
  
        _.each(triggersHash, _.bind(this._setHandlerForBehavior, this, behavior, i));
      },
  
      // Internal method to create and assign the trigger handler for a given
      // behavior
      _setHandlerForBehavior: function(behavior, i, eventName, trigger) {
        // Unique identifier for the `this._triggers` hash
        var triggerKey = trigger.replace(/^\S+/, function(triggerName) {
          return triggerName + '.' + 'behaviortriggers' + i;
        });
  
        this._triggers[triggerKey] = this._view._buildViewTrigger(eventName);
      }
    });
  
    function getBehaviorsUI(behavior) {
      return behavior._uiBindings || behavior.ui;
    }
  
    return Behaviors;
  
  })(Marionette, _);
  

  // App Router
  // ----------
  
  // Reduce the boilerplate code of handling route events
  // and then calling a single method on another object.
  // Have your routers configured to call the method on
  // your object, directly.
  //
  // Configure an AppRouter with `appRoutes`.
  //
  // App routers can only take one `controller` object.
  // It is recommended that you divide your controller
  // objects in to smaller pieces of related functionality
  // and have multiple routers / controllers, instead of
  // just one giant router and controller.
  //
  // You can also add standard routes to an AppRouter.
  
  Marionette.AppRouter = Backbone.Router.extend({
  
    constructor: function(options) {
      this.options = options || {};
  
      Backbone.Router.apply(this, arguments);
  
      var appRoutes = this.getOption('appRoutes');
      var controller = this._getController();
      this.processAppRoutes(controller, appRoutes);
      this.on('route', this._processOnRoute, this);
    },
  
    // Similar to route method on a Backbone Router but
    // method is called on the controller
    appRoute: function(route, methodName) {
      var controller = this._getController();
      this._addAppRoute(controller, route, methodName);
    },
  
    // process the route event and trigger the onRoute
    // method call, if it exists
    _processOnRoute: function(routeName, routeArgs) {
      // make sure an onRoute before trying to call it
      if (_.isFunction(this.onRoute)) {
        // find the path that matches the current route
        var routePath = _.invert(this.getOption('appRoutes'))[routeName];
        this.onRoute(routeName, routePath, routeArgs);
      }
    },
  
    // Internal method to process the `appRoutes` for the
    // router, and turn them in to routes that trigger the
    // specified method on the specified `controller`.
    processAppRoutes: function(controller, appRoutes) {
      if (!appRoutes) { return; }
  
      var routeNames = _.keys(appRoutes).reverse(); // Backbone requires reverted order of routes
  
      _.each(routeNames, function(route) {
        this._addAppRoute(controller, route, appRoutes[route]);
      }, this);
    },
  
    _getController: function() {
      return this.getOption('controller');
    },
  
    _addAppRoute: function(controller, route, methodName) {
      var method = controller[methodName];
  
      if (!method) {
        throw new Marionette.Error('Method "' + methodName + '" was not found on the controller');
      }
  
      this.route(route, methodName, _.bind(method, controller));
    },
  
    mergeOptions: Marionette.mergeOptions,
  
    // Proxy `getOption` to enable getting options from this or this.options by name.
    getOption: Marionette.proxyGetOption,
  
    triggerMethod: Marionette.triggerMethod,
  
    bindEntityEvents: Marionette.proxyBindEntityEvents,
  
    unbindEntityEvents: Marionette.proxyUnbindEntityEvents
  });
  
  // Application
  // -----------
  
  // Contain and manage the composite application as a whole.
  // Stores and starts up `Region` objects, includes an
  // event aggregator as `app.vent`
  Marionette.Application = Marionette.Object.extend({
    constructor: function(options) {
      this._initializeRegions(options);
      this._initCallbacks = new Marionette.Callbacks();
      this.submodules = {};
      _.extend(this, options);
      this._initChannel();
      Marionette.Object.call(this, options);
    },
  
    // Command execution, facilitated by Backbone.Wreqr.Commands
    execute: function() {
      this.commands.execute.apply(this.commands, arguments);
    },
  
    // Request/response, facilitated by Backbone.Wreqr.RequestResponse
    request: function() {
      return this.reqres.request.apply(this.reqres, arguments);
    },
  
    // Add an initializer that is either run at when the `start`
    // method is called, or run immediately if added after `start`
    // has already been called.
    addInitializer: function(initializer) {
      this._initCallbacks.add(initializer);
    },
  
    // kick off all of the application's processes.
    // initializes all of the regions that have been added
    // to the app, and runs all of the initializer functions
    start: function(options) {
      this.triggerMethod('before:start', options);
      this._initCallbacks.run(options, this);
      this.triggerMethod('start', options);
    },
  
    // Add regions to your app.
    // Accepts a hash of named strings or Region objects
    // addRegions({something: "#someRegion"})
    // addRegions({something: Region.extend({el: "#someRegion"}) });
    addRegions: function(regions) {
      return this._regionManager.addRegions(regions);
    },
  
    // Empty all regions in the app, without removing them
    emptyRegions: function() {
      return this._regionManager.emptyRegions();
    },
  
    // Removes a region from your app, by name
    // Accepts the regions name
    // removeRegion('myRegion')
    removeRegion: function(region) {
      return this._regionManager.removeRegion(region);
    },
  
    // Provides alternative access to regions
    // Accepts the region name
    // getRegion('main')
    getRegion: function(region) {
      return this._regionManager.get(region);
    },
  
    // Get all the regions from the region manager
    getRegions: function() {
      return this._regionManager.getRegions();
    },
  
    // Create a module, attached to the application
    module: function(moduleNames, moduleDefinition) {
  
      // Overwrite the module class if the user specifies one
      var ModuleClass = Marionette.Module.getClass(moduleDefinition);
  
      var args = _.toArray(arguments);
      args.unshift(this);
  
      // see the Marionette.Module object for more information
      return ModuleClass.create.apply(ModuleClass, args);
    },
  
    // Enable easy overriding of the default `RegionManager`
    // for customized region interactions and business-specific
    // view logic for better control over single regions.
    getRegionManager: function() {
      return new Marionette.RegionManager();
    },
  
    // Internal method to initialize the regions that have been defined in a
    // `regions` attribute on the application instance
    _initializeRegions: function(options) {
      var regions = _.isFunction(this.regions) ? this.regions(options) : this.regions || {};
  
      this._initRegionManager();
  
      // Enable users to define `regions` in instance options.
      var optionRegions = Marionette.getOption(options, 'regions');
  
      // Enable region options to be a function
      if (_.isFunction(optionRegions)) {
        optionRegions = optionRegions.call(this, options);
      }
  
      // Overwrite current regions with those passed in options
      _.extend(regions, optionRegions);
  
      this.addRegions(regions);
  
      return this;
    },
  
    // Internal method to set up the region manager
    _initRegionManager: function() {
      this._regionManager = this.getRegionManager();
      this._regionManager._parent = this;
  
      this.listenTo(this._regionManager, 'before:add:region', function() {
        Marionette._triggerMethod(this, 'before:add:region', arguments);
      });
  
      this.listenTo(this._regionManager, 'add:region', function(name, region) {
        this[name] = region;
        Marionette._triggerMethod(this, 'add:region', arguments);
      });
  
      this.listenTo(this._regionManager, 'before:remove:region', function() {
        Marionette._triggerMethod(this, 'before:remove:region', arguments);
      });
  
      this.listenTo(this._regionManager, 'remove:region', function(name) {
        delete this[name];
        Marionette._triggerMethod(this, 'remove:region', arguments);
      });
    },
  
    // Internal method to setup the Wreqr.radio channel
    _initChannel: function() {
      this.channelName = _.result(this, 'channelName') || 'global';
      this.channel = _.result(this, 'channel') || Backbone.Wreqr.radio.channel(this.channelName);
      this.vent = _.result(this, 'vent') || this.channel.vent;
      this.commands = _.result(this, 'commands') || this.channel.commands;
      this.reqres = _.result(this, 'reqres') || this.channel.reqres;
    }
  });
  
  /* jshint maxparams: 9 */
  
  // Module
  // ------
  
  // A simple module system, used to create privacy and encapsulation in
  // Marionette applications
  Marionette.Module = function(moduleName, app, options) {
    this.moduleName = moduleName;
    this.options = _.extend({}, this.options, options);
    // Allow for a user to overide the initialize
    // for a given module instance.
    this.initialize = options.initialize || this.initialize;
  
    // Set up an internal store for sub-modules.
    this.submodules = {};
  
    this._setupInitializersAndFinalizers();
  
    // Set an internal reference to the app
    // within a module.
    this.app = app;
  
    if (_.isFunction(this.initialize)) {
      this.initialize(moduleName, app, this.options);
    }
  };
  
  Marionette.Module.extend = Marionette.extend;
  
  // Extend the Module prototype with events / listenTo, so that the module
  // can be used as an event aggregator or pub/sub.
  _.extend(Marionette.Module.prototype, Backbone.Events, {
  
    // By default modules start with their parents.
    startWithParent: true,
  
    // Initialize is an empty function by default. Override it with your own
    // initialization logic when extending Marionette.Module.
    initialize: function() {},
  
    // Initializer for a specific module. Initializers are run when the
    // module's `start` method is called.
    addInitializer: function(callback) {
      this._initializerCallbacks.add(callback);
    },
  
    // Finalizers are run when a module is stopped. They are used to teardown
    // and finalize any variables, references, events and other code that the
    // module had set up.
    addFinalizer: function(callback) {
      this._finalizerCallbacks.add(callback);
    },
  
    // Start the module, and run all of its initializers
    start: function(options) {
      // Prevent re-starting a module that is already started
      if (this._isInitialized) { return; }
  
      // start the sub-modules (depth-first hierarchy)
      _.each(this.submodules, function(mod) {
        // check to see if we should start the sub-module with this parent
        if (mod.startWithParent) {
          mod.start(options);
        }
      });
  
      // run the callbacks to "start" the current module
      this.triggerMethod('before:start', options);
  
      this._initializerCallbacks.run(options, this);
      this._isInitialized = true;
  
      this.triggerMethod('start', options);
    },
  
    // Stop this module by running its finalizers and then stop all of
    // the sub-modules for this module
    stop: function() {
      // if we are not initialized, don't bother finalizing
      if (!this._isInitialized) { return; }
      this._isInitialized = false;
  
      this.triggerMethod('before:stop');
  
      // stop the sub-modules; depth-first, to make sure the
      // sub-modules are stopped / finalized before parents
      _.invoke(this.submodules, 'stop');
  
      // run the finalizers
      this._finalizerCallbacks.run(undefined, this);
  
      // reset the initializers and finalizers
      this._initializerCallbacks.reset();
      this._finalizerCallbacks.reset();
  
      this.triggerMethod('stop');
    },
  
    // Configure the module with a definition function and any custom args
    // that are to be passed in to the definition function
    addDefinition: function(moduleDefinition, customArgs) {
      this._runModuleDefinition(moduleDefinition, customArgs);
    },
  
    // Internal method: run the module definition function with the correct
    // arguments
    _runModuleDefinition: function(definition, customArgs) {
      // If there is no definition short circut the method.
      if (!definition) { return; }
  
      // build the correct list of arguments for the module definition
      var args = _.flatten([
        this,
        this.app,
        Backbone,
        Marionette,
        Backbone.$, _,
        customArgs
      ]);
  
      definition.apply(this, args);
    },
  
    // Internal method: set up new copies of initializers and finalizers.
    // Calling this method will wipe out all existing initializers and
    // finalizers.
    _setupInitializersAndFinalizers: function() {
      this._initializerCallbacks = new Marionette.Callbacks();
      this._finalizerCallbacks = new Marionette.Callbacks();
    },
  
    // import the `triggerMethod` to trigger events with corresponding
    // methods if the method exists
    triggerMethod: Marionette.triggerMethod
  });
  
  // Class methods to create modules
  _.extend(Marionette.Module, {
  
    // Create a module, hanging off the app parameter as the parent object.
    create: function(app, moduleNames, moduleDefinition) {
      var module = app;
  
      // get the custom args passed in after the module definition and
      // get rid of the module name and definition function
      var customArgs = _.drop(arguments, 3);
  
      // Split the module names and get the number of submodules.
      // i.e. an example module name of `Doge.Wow.Amaze` would
      // then have the potential for 3 module definitions.
      moduleNames = moduleNames.split('.');
      var length = moduleNames.length;
  
      // store the module definition for the last module in the chain
      var moduleDefinitions = [];
      moduleDefinitions[length - 1] = moduleDefinition;
  
      // Loop through all the parts of the module definition
      _.each(moduleNames, function(moduleName, i) {
        var parentModule = module;
        module = this._getModule(parentModule, moduleName, app, moduleDefinition);
        this._addModuleDefinition(parentModule, module, moduleDefinitions[i], customArgs);
      }, this);
  
      // Return the last module in the definition chain
      return module;
    },
  
    _getModule: function(parentModule, moduleName, app, def, args) {
      var options = _.extend({}, def);
      var ModuleClass = this.getClass(def);
  
      // Get an existing module of this name if we have one
      var module = parentModule[moduleName];
  
      if (!module) {
        // Create a new module if we don't have one
        module = new ModuleClass(moduleName, app, options);
        parentModule[moduleName] = module;
        // store the module on the parent
        parentModule.submodules[moduleName] = module;
      }
  
      return module;
    },
  
    // ## Module Classes
    //
    // Module classes can be used as an alternative to the define pattern.
    // The extend function of a Module is identical to the extend functions
    // on other Backbone and Marionette classes.
    // This allows module lifecyle events like `onStart` and `onStop` to be called directly.
    getClass: function(moduleDefinition) {
      var ModuleClass = Marionette.Module;
  
      if (!moduleDefinition) {
        return ModuleClass;
      }
  
      // If all of the module's functionality is defined inside its class,
      // then the class can be passed in directly. `MyApp.module("Foo", FooModule)`.
      if (moduleDefinition.prototype instanceof ModuleClass) {
        return moduleDefinition;
      }
  
      return moduleDefinition.moduleClass || ModuleClass;
    },
  
    // Add the module definition and add a startWithParent initializer function.
    // This is complicated because module definitions are heavily overloaded
    // and support an anonymous function, module class, or options object
    _addModuleDefinition: function(parentModule, module, def, args) {
      var fn = this._getDefine(def);
      var startWithParent = this._getStartWithParent(def, module);
  
      if (fn) {
        module.addDefinition(fn, args);
      }
  
      this._addStartWithParent(parentModule, module, startWithParent);
    },
  
    _getStartWithParent: function(def, module) {
      var swp;
  
      if (_.isFunction(def) && (def.prototype instanceof Marionette.Module)) {
        swp = module.constructor.prototype.startWithParent;
        return _.isUndefined(swp) ? true : swp;
      }
  
      if (_.isObject(def)) {
        swp = def.startWithParent;
        return _.isUndefined(swp) ? true : swp;
      }
  
      return true;
    },
  
    _getDefine: function(def) {
      if (_.isFunction(def) && !(def.prototype instanceof Marionette.Module)) {
        return def;
      }
  
      if (_.isObject(def)) {
        return def.define;
      }
  
      return null;
    },
  
    _addStartWithParent: function(parentModule, module, startWithParent) {
      module.startWithParent = module.startWithParent && startWithParent;
  
      if (!module.startWithParent || !!module.startWithParentIsConfigured) {
        return;
      }
  
      module.startWithParentIsConfigured = true;
  
      parentModule.addInitializer(function(options) {
        if (module.startWithParent) {
          module.start(options);
        }
      });
    }
  });
  

  return Marionette;
}));
;
;
/* module-key = 'bamboo.web.resources:lib-marionette', location = '/util/shims/marionette.js' */
(function(window) {
    'use strict';

    _.extend(Marionette.Renderer, {

        render: function(template, data, context) {
            if (!template) {
                throw new window.Marionette.Error({
                    name: 'TemplateNotFoundError',
                    message: 'Cannot render the template since its false, null or undefined.'
                });
            }

            var templateFunc = _.isFunction(template) ?
                template : window.Marionette.TemplateCache.get(template);

            return templateFunc.call(context, data);
        }

    });

    define('marionette', function () {
        return window.Marionette;
    });

})(window || this);
;
;
/* module-key = 'bamboo.web.resources:widget-help-dialog', location = '/widget/help/help-dialog.js' */
define('widget/help-dialog', [
    'jquery',
    'underscore',
    'brace',
    'util/events'
], function(
    $,
    _,
    Brace,
    events
) {

    'use strict';

    var HelpDialog = Brace.View.extend({

        mixins: [events.EventBusMixin],

        initialize: function() {
            AJS.InlineDialog(
                this.$el,
                this.$el.attr('id').replace(/[:\.]/g, "-"),
                _.bind(this.onDialogShow, this),
                {
                    hideDelay: null,
                    offsetX: -60,
                    arrowOffsetX: 0,
                    width: 420
                }
            );
        },

        onDialogShow: function(content, trigger, showPopup) {
            content.css({ padding: '20px' })
                .html((this.options.content || this.$el.find('span:first')).html());

            showPopup();
            return false;
        }
    });

    return HelpDialog;

});


/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('Bamboo.Widget.HelpDialog', null, require('widget/help-dialog'));
};
;
/* module-key = 'bamboo.web.resources:widget-action-tip', location = '/widget/action-tip/action-tip.soy' */
// This file was automatically generated from action-tip.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.actionTip.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.actionTip == 'undefined') { bamboo.widget.actionTip = {}; }


bamboo.widget.actionTip.dialog = function(opt_data, opt_ignored) {
  return '<p>' + soy.$$filterNoAutoescape(opt_data.content) + '</p><button class="aui-button action-tip-trigger">' + soy.$$escapeHtml(opt_data.label) + '</button>';
};
if (goog.DEBUG) {
  bamboo.widget.actionTip.dialog.soyTemplateName = 'bamboo.widget.actionTip.dialog';
}
;
;
/* module-key = 'bamboo.web.resources:widget-action-tip', location = '/widget/action-tip/action-tip.js' */
define('widget/action-tip', [
    'jquery',
    'underscore',
    'backbone',
    'util/preferences'
], function(
    $,
    _,
    Backbone,
    preferencesManager
) {

    'use strict';

    var ActionTip = Backbone.View.extend({

        template: bamboo.widget.actionTip,

        preference: function(key) {
            return ['bamboo.user.actions', key].join('.');
        },

        defaults: {
            content: '',
            params: {
                onTop: false
            }
        },

        initialize: function(options) {
            this.settings = $.extend(this.defaults, options || {});

            if (!this.settings.label) {
                this.settings.label = $.trim(this.$el.text());
            }

            var params = $.extend({
                hideCallback: _.bind(this.onClose, this),
                container: 'body',
                noBind: true
            }, this.settings.params);

            this.dialog = AJS.InlineDialog(
                this.$el, this.$el.attr('id'),
                _.bind(this.onShow, this), params
            );

            this.registerEvents();
        },

        registerEvents: function() {
            this.$el.on('click', _.bind(this.onClick, this));

            $(document).on('keydown', _.bind(function(event) {
                if (event.keyCode === 27) this.hide();
            }, this.dialog));
        },

        onClick: function() {
            var value = false;

            if (this.settings.actionKey) {
                value = preferencesManager.getBoolean(
                    this.preference(this.settings.actionKey)
                );
            }

            if (!value) {
                this.dialog.show();
                return false;
            }

            this.dialog.remove();
        },

        onShow: function(dialog, trigger, show) {
            var content = this.template.dialog({
                label: this.settings.label,
                content: this.settings.content
            });

            dialog
                .html(content)
                .addClass('action-tip')
                .find('button').on('click', _.bind(function() {
                    this.onAction.call(this);
                    this.dialog.hide();
                }, this));

            show();
        },

        onClose: function() {
            if (this.clicked) {
                this.$el.click();
                this.dialog.remove();
            }
        },

        onAction: function() {
            if (this.settings.actionKey) {
                this.clicked = true;

                if (!this.settings.callback) {
                    preferencesManager.setValue(
                        this.preference(this.settings.actionKey)
                    );
                }
                else {
                    this.settings.callback.call(this);
                }
            }
        }

    });

    return ActionTip;
});;
;
/* module-key = 'bamboo.web.resources:help-widget', location = '/widget/help/help.soy' */
// This file was automatically generated from help.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.help.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.help == 'undefined') { bamboo.widget.help = {}; }


bamboo.widget.help.panel = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.link ? 'a' : 'div') + ' class="help-panel' + ((opt_data.type) ? ' help-panel-' + soy.$$escapeHtml(opt_data.type) : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.link) ? ' href="' + soy.$$escapeHtml(opt_data.link) + '"' : '') + aui.renderExtraAttributes(opt_data) + '><strong class="help-panel-title">' + soy.$$escapeHtml(opt_data.title) + '</strong><div class="help-panel-content">' + soy.$$filterNoAutoescape(opt_data.content) + '</div></' + soy.$$escapeHtml(opt_data.link ? 'a' : 'div') + '>';
};
if (goog.DEBUG) {
  bamboo.widget.help.panel.soyTemplateName = 'bamboo.widget.help.panel';
}
;
;
/* module-key = 'bamboo.web.resources:moment-js', location = '/bower/moment/moment.js' */
// moment.js
// version : 2.0.0
// author : Tim Wood
// license : MIT
// momentjs.com

(function (undefined) {

    /************************************
        Constants
    ************************************/

    var moment,
        VERSION = "2.0.0",
        round = Math.round, i,
        // internal storage for language config files
        languages = {},

        // check for nodeJS
        hasModule = (typeof module !== 'undefined' && module.exports),

        // ASP.NET json date format regex
        aspNetJsonRegex = /^\/?Date\((\-?\d+)/i,

        // format tokens
        formattingTokens = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,
        localFormattingTokens = /(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,

        // parsing tokens
        parseMultipleFormatChunker = /([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,

        // parsing token regexes
        parseTokenOneOrTwoDigits = /\d\d?/, // 0 - 99
        parseTokenOneToThreeDigits = /\d{1,3}/, // 0 - 999
        parseTokenThreeDigits = /\d{3}/, // 000 - 999
        parseTokenFourDigits = /\d{1,4}/, // 0 - 9999
        parseTokenSixDigits = /[+\-]?\d{1,6}/, // -999,999 - 999,999
        parseTokenWord = /[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i, // any word (or two) characters or numbers including two word month in arabic.
        parseTokenTimezone = /Z|[\+\-]\d\d:?\d\d/i, // +00:00 -00:00 +0000 -0000 or Z
        parseTokenT = /T/i, // T (ISO seperator)
        parseTokenTimestampMs = /[\+\-]?\d+(\.\d{1,3})?/, // 123456789 123456789.123

        // preliminary iso regex
        // 0000-00-00 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000
        isoRegex = /^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,
        isoFormat = 'YYYY-MM-DDTHH:mm:ssZ',

        // iso time formats and regexes
        isoTimes = [
            ['HH:mm:ss.S', /(T| )\d\d:\d\d:\d\d\.\d{1,3}/],
            ['HH:mm:ss', /(T| )\d\d:\d\d:\d\d/],
            ['HH:mm', /(T| )\d\d:\d\d/],
            ['HH', /(T| )\d\d/]
        ],

        // timezone chunker "+10:00" > ["10", "00"] or "-1530" > ["-15", "30"]
        parseTimezoneChunker = /([\+\-]|\d\d)/gi,

        // getter and setter names
        proxyGettersAndSetters = 'Month|Date|Hours|Minutes|Seconds|Milliseconds'.split('|'),
        unitMillisecondFactors = {
            'Milliseconds' : 1,
            'Seconds' : 1e3,
            'Minutes' : 6e4,
            'Hours' : 36e5,
            'Days' : 864e5,
            'Months' : 2592e6,
            'Years' : 31536e6
        },

        // format function strings
        formatFunctions = {},

        // tokens to ordinalize and pad
        ordinalizeTokens = 'DDD w W M D d'.split(' '),
        paddedTokens = 'M D H h m s w W'.split(' '),

        formatTokenFunctions = {
            M    : function () {
                return this.month() + 1;
            },
            MMM  : function (format) {
                return this.lang().monthsShort(this, format);
            },
            MMMM : function (format) {
                return this.lang().months(this, format);
            },
            D    : function () {
                return this.date();
            },
            DDD  : function () {
                return this.dayOfYear();
            },
            d    : function () {
                return this.day();
            },
            dd   : function (format) {
                return this.lang().weekdaysMin(this, format);
            },
            ddd  : function (format) {
                return this.lang().weekdaysShort(this, format);
            },
            dddd : function (format) {
                return this.lang().weekdays(this, format);
            },
            w    : function () {
                return this.week();
            },
            W    : function () {
                return this.isoWeek();
            },
            YY   : function () {
                return leftZeroFill(this.year() % 100, 2);
            },
            YYYY : function () {
                return leftZeroFill(this.year(), 4);
            },
            YYYYY : function () {
                return leftZeroFill(this.year(), 5);
            },
            a    : function () {
                return this.lang().meridiem(this.hours(), this.minutes(), true);
            },
            A    : function () {
                return this.lang().meridiem(this.hours(), this.minutes(), false);
            },
            H    : function () {
                return this.hours();
            },
            h    : function () {
                return this.hours() % 12 || 12;
            },
            m    : function () {
                return this.minutes();
            },
            s    : function () {
                return this.seconds();
            },
            S    : function () {
                return ~~(this.milliseconds() / 100);
            },
            SS   : function () {
                return leftZeroFill(~~(this.milliseconds() / 10), 2);
            },
            SSS  : function () {
                return leftZeroFill(this.milliseconds(), 3);
            },
            Z    : function () {
                var a = -this.zone(),
                    b = "+";
                if (a < 0) {
                    a = -a;
                    b = "-";
                }
                return b + leftZeroFill(~~(a / 60), 2) + ":" + leftZeroFill(~~a % 60, 2);
            },
            ZZ   : function () {
                var a = -this.zone(),
                    b = "+";
                if (a < 0) {
                    a = -a;
                    b = "-";
                }
                return b + leftZeroFill(~~(10 * a / 6), 4);
            },
            X    : function () {
                return this.unix();
            }
        };

    function padToken(func, count) {
        return function (a) {
            return leftZeroFill(func.call(this, a), count);
        };
    }
    function ordinalizeToken(func) {
        return function (a) {
            return this.lang().ordinal(func.call(this, a));
        };
    }

    while (ordinalizeTokens.length) {
        i = ordinalizeTokens.pop();
        formatTokenFunctions[i + 'o'] = ordinalizeToken(formatTokenFunctions[i]);
    }
    while (paddedTokens.length) {
        i = paddedTokens.pop();
        formatTokenFunctions[i + i] = padToken(formatTokenFunctions[i], 2);
    }
    formatTokenFunctions.DDDD = padToken(formatTokenFunctions.DDD, 3);


    /************************************
        Constructors
    ************************************/

    function Language() {

    }

    // Moment prototype object
    function Moment(config) {
        extend(this, config);
    }

    // Duration Constructor
    function Duration(duration) {
        var data = this._data = {},
            years = duration.years || duration.year || duration.y || 0,
            months = duration.months || duration.month || duration.M || 0,
            weeks = duration.weeks || duration.week || duration.w || 0,
            days = duration.days || duration.day || duration.d || 0,
            hours = duration.hours || duration.hour || duration.h || 0,
            minutes = duration.minutes || duration.minute || duration.m || 0,
            seconds = duration.seconds || duration.second || duration.s || 0,
            milliseconds = duration.milliseconds || duration.millisecond || duration.ms || 0;

        // representation for dateAddRemove
        this._milliseconds = milliseconds +
            seconds * 1e3 + // 1000
            minutes * 6e4 + // 1000 * 60
            hours * 36e5; // 1000 * 60 * 60
        // Because of dateAddRemove treats 24 hours as different from a
        // day when working around DST, we need to store them separately
        this._days = days +
            weeks * 7;
        // It is impossible translate months into days without knowing
        // which months you are are talking about, so we have to store
        // it separately.
        this._months = months +
            years * 12;

        // The following code bubbles up values, see the tests for
        // examples of what that means.
        data.milliseconds = milliseconds % 1000;
        seconds += absRound(milliseconds / 1000);

        data.seconds = seconds % 60;
        minutes += absRound(seconds / 60);

        data.minutes = minutes % 60;
        hours += absRound(minutes / 60);

        data.hours = hours % 24;
        days += absRound(hours / 24);

        days += weeks * 7;
        data.days = days % 30;

        months += absRound(days / 30);

        data.months = months % 12;
        years += absRound(months / 12);

        data.years = years;
    }


    /************************************
        Helpers
    ************************************/


    function extend(a, b) {
        for (var i in b) {
            if (b.hasOwnProperty(i)) {
                a[i] = b[i];
            }
        }
        return a;
    }

    function absRound(number) {
        if (number < 0) {
            return Math.ceil(number);
        } else {
            return Math.floor(number);
        }
    }

    // left zero fill a number
    // see http://jsperf.com/left-zero-filling for performance comparison
    function leftZeroFill(number, targetLength) {
        var output = number + '';
        while (output.length < targetLength) {
            output = '0' + output;
        }
        return output;
    }

    // helper function for _.addTime and _.subtractTime
    function addOrSubtractDurationFromMoment(mom, duration, isAdding) {
        var ms = duration._milliseconds,
            d = duration._days,
            M = duration._months,
            currentDate;

        if (ms) {
            mom._d.setTime(+mom + ms * isAdding);
        }
        if (d) {
            mom.date(mom.date() + d * isAdding);
        }
        if (M) {
            currentDate = mom.date();
            mom.date(1)
                .month(mom.month() + M * isAdding)
                .date(Math.min(currentDate, mom.daysInMonth()));
        }
    }

    // check if is an array
    function isArray(input) {
        return Object.prototype.toString.call(input) === '[object Array]';
    }

    // compare two arrays, return the number of differences
    function compareArrays(array1, array2) {
        var len = Math.min(array1.length, array2.length),
            lengthDiff = Math.abs(array1.length - array2.length),
            diffs = 0,
            i;
        for (i = 0; i < len; i++) {
            if (~~array1[i] !== ~~array2[i]) {
                diffs++;
            }
        }
        return diffs + lengthDiff;
    }


    /************************************
        Languages
    ************************************/


    Language.prototype = {
        set : function (config) {
            var prop, i;
            for (i in config) {
                prop = config[i];
                if (typeof prop === 'function') {
                    this[i] = prop;
                } else {
                    this['_' + i] = prop;
                }
            }
        },

        _months : "January_February_March_April_May_June_July_August_September_October_November_December".split("_"),
        months : function (m) {
            return this._months[m.month()];
        },

        _monthsShort : "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),
        monthsShort : function (m) {
            return this._monthsShort[m.month()];
        },

        monthsParse : function (monthName) {
            var i, mom, regex, output;

            if (!this._monthsParse) {
                this._monthsParse = [];
            }

            for (i = 0; i < 12; i++) {
                // make the regex if we don't have it already
                if (!this._monthsParse[i]) {
                    mom = moment([2000, i]);
                    regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
                    this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
                }
                // test the regex
                if (this._monthsParse[i].test(monthName)) {
                    return i;
                }
            }
        },

        _weekdays : "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),
        weekdays : function (m) {
            return this._weekdays[m.day()];
        },

        _weekdaysShort : "Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),
        weekdaysShort : function (m) {
            return this._weekdaysShort[m.day()];
        },

        _weekdaysMin : "Su_Mo_Tu_We_Th_Fr_Sa".split("_"),
        weekdaysMin : function (m) {
            return this._weekdaysMin[m.day()];
        },

        _longDateFormat : {
            LT : "h:mm A",
            L : "MM/DD/YYYY",
            LL : "MMMM D YYYY",
            LLL : "MMMM D YYYY LT",
            LLLL : "dddd, MMMM D YYYY LT"
        },
        longDateFormat : function (key) {
            var output = this._longDateFormat[key];
            if (!output && this._longDateFormat[key.toUpperCase()]) {
                output = this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function (val) {
                    return val.slice(1);
                });
                this._longDateFormat[key] = output;
            }
            return output;
        },

        meridiem : function (hours, minutes, isLower) {
            if (hours > 11) {
                return isLower ? 'pm' : 'PM';
            } else {
                return isLower ? 'am' : 'AM';
            }
        },

        _calendar : {
            sameDay : '[Today at] LT',
            nextDay : '[Tomorrow at] LT',
            nextWeek : 'dddd [at] LT',
            lastDay : '[Yesterday at] LT',
            lastWeek : '[last] dddd [at] LT',
            sameElse : 'L'
        },
        calendar : function (key, mom) {
            var output = this._calendar[key];
            return typeof output === 'function' ? output.apply(mom) : output;
        },

        _relativeTime : {
            future : "in %s",
            past : "%s ago",
            s : "a few seconds",
            m : "a minute",
            mm : "%d minutes",
            h : "an hour",
            hh : "%d hours",
            d : "a day",
            dd : "%d days",
            M : "a month",
            MM : "%d months",
            y : "a year",
            yy : "%d years"
        },
        relativeTime : function (number, withoutSuffix, string, isFuture) {
            var output = this._relativeTime[string];
            return (typeof output === 'function') ?
                output(number, withoutSuffix, string, isFuture) :
                output.replace(/%d/i, number);
        },
        pastFuture : function (diff, output) {
            var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
            return typeof format === 'function' ? format(output) : format.replace(/%s/i, output);
        },

        ordinal : function (number) {
            return this._ordinal.replace("%d", number);
        },
        _ordinal : "%d",

        preparse : function (string) {
            return string;
        },

        postformat : function (string) {
            return string;
        },

        week : function (mom) {
            return weekOfYear(mom, this._week.dow, this._week.doy);
        },
        _week : {
            dow : 0, // Sunday is the first day of the week.
            doy : 6  // The week that contains Jan 1st is the first week of the year.
        }
    };

    // Loads a language definition into the `languages` cache.  The function
    // takes a key and optionally values.  If not in the browser and no values
    // are provided, it will load the language file module.  As a convenience,
    // this function also returns the language values.
    function loadLang(key, values) {
        values.abbr = key;
        if (!languages[key]) {
            languages[key] = new Language();
        }
        languages[key].set(values);
        return languages[key];
    }

    // Determines which language definition to use and returns it.
    //
    // With no parameters, it will return the global language.  If you
    // pass in a language key, such as 'en', it will return the
    // definition for 'en', so long as 'en' has already been loaded using
    // moment.lang.
    function getLangDefinition(key) {
        if (!key) {
            return moment.fn._lang;
        }
        if (!languages[key] && hasModule) {
            require('./lang/' + key);
        }
        return languages[key];
    }


    /************************************
        Formatting
    ************************************/


    function removeFormattingTokens(input) {
        if (input.match(/\[.*\]/)) {
            return input.replace(/^\[|\]$/g, "");
        }
        return input.replace(/\\/g, "");
    }

    function makeFormatFunction(format) {
        var array = format.match(formattingTokens), i, length;

        for (i = 0, length = array.length; i < length; i++) {
            if (formatTokenFunctions[array[i]]) {
                array[i] = formatTokenFunctions[array[i]];
            } else {
                array[i] = removeFormattingTokens(array[i]);
            }
        }

        return function (mom) {
            var output = "";
            for (i = 0; i < length; i++) {
                output += typeof array[i].call === 'function' ? array[i].call(mom, format) : array[i];
            }
            return output;
        };
    }

    // format date using native date object
    function formatMoment(m, format) {
        var i = 5;

        function replaceLongDateFormatTokens(input) {
            return m.lang().longDateFormat(input) || input;
        }

        while (i-- && localFormattingTokens.test(format)) {
            format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);
        }

        if (!formatFunctions[format]) {
            formatFunctions[format] = makeFormatFunction(format);
        }

        return formatFunctions[format](m);
    }


    /************************************
        Parsing
    ************************************/


    // get the regex to find the next token
    function getParseRegexForToken(token) {
        switch (token) {
        case 'DDDD':
            return parseTokenThreeDigits;
        case 'YYYY':
            return parseTokenFourDigits;
        case 'YYYYY':
            return parseTokenSixDigits;
        case 'S':
        case 'SS':
        case 'SSS':
        case 'DDD':
            return parseTokenOneToThreeDigits;
        case 'MMM':
        case 'MMMM':
        case 'dd':
        case 'ddd':
        case 'dddd':
        case 'a':
        case 'A':
            return parseTokenWord;
        case 'X':
            return parseTokenTimestampMs;
        case 'Z':
        case 'ZZ':
            return parseTokenTimezone;
        case 'T':
            return parseTokenT;
        case 'MM':
        case 'DD':
        case 'YY':
        case 'HH':
        case 'hh':
        case 'mm':
        case 'ss':
        case 'M':
        case 'D':
        case 'd':
        case 'H':
        case 'h':
        case 'm':
        case 's':
            return parseTokenOneOrTwoDigits;
        default :
            return new RegExp(token.replace('\\', ''));
        }
    }

    // function to convert string input to date
    function addTimeToArrayFromToken(token, input, config) {
        var a, b,
            datePartArray = config._a;

        switch (token) {
        // MONTH
        case 'M' : // fall through to MM
        case 'MM' :
            datePartArray[1] = (input == null) ? 0 : ~~input - 1;
            break;
        case 'MMM' : // fall through to MMMM
        case 'MMMM' :
            a = getLangDefinition(config._l).monthsParse(input);
            // if we didn't find a month name, mark the date as invalid.
            if (a != null) {
                datePartArray[1] = a;
            } else {
                config._isValid = false;
            }
            break;
        // DAY OF MONTH
        case 'D' : // fall through to DDDD
        case 'DD' : // fall through to DDDD
        case 'DDD' : // fall through to DDDD
        case 'DDDD' :
            if (input != null) {
                datePartArray[2] = ~~input;
            }
            break;
        // YEAR
        case 'YY' :
            datePartArray[0] = ~~input + (~~input > 68 ? 1900 : 2000);
            break;
        case 'YYYY' :
        case 'YYYYY' :
            datePartArray[0] = ~~input;
            break;
        // AM / PM
        case 'a' : // fall through to A
        case 'A' :
            config._isPm = ((input + '').toLowerCase() === 'pm');
            break;
        // 24 HOUR
        case 'H' : // fall through to hh
        case 'HH' : // fall through to hh
        case 'h' : // fall through to hh
        case 'hh' :
            datePartArray[3] = ~~input;
            break;
        // MINUTE
        case 'm' : // fall through to mm
        case 'mm' :
            datePartArray[4] = ~~input;
            break;
        // SECOND
        case 's' : // fall through to ss
        case 'ss' :
            datePartArray[5] = ~~input;
            break;
        // MILLISECOND
        case 'S' :
        case 'SS' :
        case 'SSS' :
            datePartArray[6] = ~~ (('0.' + input) * 1000);
            break;
        // UNIX TIMESTAMP WITH MS
        case 'X':
            config._d = new Date(parseFloat(input) * 1000);
            break;
        // TIMEZONE
        case 'Z' : // fall through to ZZ
        case 'ZZ' :
            config._useUTC = true;
            a = (input + '').match(parseTimezoneChunker);
            if (a && a[1]) {
                config._tzh = ~~a[1];
            }
            if (a && a[2]) {
                config._tzm = ~~a[2];
            }
            // reverse offsets
            if (a && a[0] === '+') {
                config._tzh = -config._tzh;
                config._tzm = -config._tzm;
            }
            break;
        }

        // if the input is null, the date is not valid
        if (input == null) {
            config._isValid = false;
        }
    }

    // convert an array to a date.
    // the array should mirror the parameters below
    // note: all values past the year are optional and will default to the lowest possible value.
    // [year, month, day , hour, minute, second, millisecond]
    function dateFromArray(config) {
        var i, date, input = [];

        if (config._d) {
            return;
        }

        for (i = 0; i < 7; i++) {
            config._a[i] = input[i] = (config._a[i] == null) ? (i === 2 ? 1 : 0) : config._a[i];
        }

        // add the offsets to the time to be parsed so that we can have a clean array for checking isValid
        input[3] += config._tzh || 0;
        input[4] += config._tzm || 0;

        date = new Date(0);

        if (config._useUTC) {
            date.setUTCFullYear(input[0], input[1], input[2]);
            date.setUTCHours(input[3], input[4], input[5], input[6]);
        } else {
            date.setFullYear(input[0], input[1], input[2]);
            date.setHours(input[3], input[4], input[5], input[6]);
        }

        config._d = date;
    }

    // date from string and format string
    function makeDateFromStringAndFormat(config) {
        // This array is used to make a Date, either with `new Date` or `Date.UTC`
        var tokens = config._f.match(formattingTokens),
            string = config._i,
            i, parsedInput;

        config._a = [];

        for (i = 0; i < tokens.length; i++) {
            parsedInput = (getParseRegexForToken(tokens[i]).exec(string) || [])[0];
            if (parsedInput) {
                string = string.slice(string.indexOf(parsedInput) + parsedInput.length);
            }
            // don't parse if its not a known token
            if (formatTokenFunctions[tokens[i]]) {
                addTimeToArrayFromToken(tokens[i], parsedInput, config);
            }
        }
        // handle am pm
        if (config._isPm && config._a[3] < 12) {
            config._a[3] += 12;
        }
        // if is 12 am, change hours to 0
        if (config._isPm === false && config._a[3] === 12) {
            config._a[3] = 0;
        }
        // return
        dateFromArray(config);
    }

    // date from string and array of format strings
    function makeDateFromStringAndArray(config) {
        var tempConfig,
            tempMoment,
            bestMoment,

            scoreToBeat = 99,
            i,
            currentDate,
            currentScore;

        while (config._f.length) {
            tempConfig = extend({}, config);
            tempConfig._f = config._f.pop();
            makeDateFromStringAndFormat(tempConfig);
            tempMoment = new Moment(tempConfig);

            if (tempMoment.isValid()) {
                bestMoment = tempMoment;
                break;
            }

            currentScore = compareArrays(tempConfig._a, tempMoment.toArray());

            if (currentScore < scoreToBeat) {
                scoreToBeat = currentScore;
                bestMoment = tempMoment;
            }
        }

        extend(config, bestMoment);
    }

    // date from iso format
    function makeDateFromString(config) {
        var i,
            string = config._i;
        if (isoRegex.exec(string)) {
            config._f = 'YYYY-MM-DDT';
            for (i = 0; i < 4; i++) {
                if (isoTimes[i][1].exec(string)) {
                    config._f += isoTimes[i][0];
                    break;
                }
            }
            if (parseTokenTimezone.exec(string)) {
                config._f += " Z";
            }
            makeDateFromStringAndFormat(config);
        } else {
            config._d = new Date(string);
        }
    }

    function makeDateFromInput(config) {
        var input = config._i,
            matched = aspNetJsonRegex.exec(input);

        if (input === undefined) {
            config._d = new Date();
        } else if (matched) {
            config._d = new Date(+matched[1]);
        } else if (typeof input === 'string') {
            makeDateFromString(config);
        } else if (isArray(input)) {
            config._a = input.slice(0);
            dateFromArray(config);
        } else {
            config._d = input instanceof Date ? new Date(+input) : new Date(input);
        }
    }


    /************************************
        Relative Time
    ************************************/


    // helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize
    function substituteTimeAgo(string, number, withoutSuffix, isFuture, lang) {
        return lang.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
    }

    function relativeTime(milliseconds, withoutSuffix, lang) {
        var seconds = round(Math.abs(milliseconds) / 1000),
            minutes = round(seconds / 60),
            hours = round(minutes / 60),
            days = round(hours / 24),
            years = round(days / 365),
            args = seconds < 45 && ['s', seconds] ||
                minutes === 1 && ['m'] ||
                minutes < 45 && ['mm', minutes] ||
                hours === 1 && ['h'] ||
                hours < 22 && ['hh', hours] ||
                days === 1 && ['d'] ||
                days <= 25 && ['dd', days] ||
                days <= 45 && ['M'] ||
                days < 345 && ['MM', round(days / 30)] ||
                years === 1 && ['y'] || ['yy', years];
        args[2] = withoutSuffix;
        args[3] = milliseconds > 0;
        args[4] = lang;
        return substituteTimeAgo.apply({}, args);
    }


    /************************************
        Week of Year
    ************************************/


    // firstDayOfWeek       0 = sun, 6 = sat
    //                      the day of the week that starts the week
    //                      (usually sunday or monday)
    // firstDayOfWeekOfYear 0 = sun, 6 = sat
    //                      the first week is the week that contains the first
    //                      of this day of the week
    //                      (eg. ISO weeks use thursday (4))
    function weekOfYear(mom, firstDayOfWeek, firstDayOfWeekOfYear) {
        var end = firstDayOfWeekOfYear - firstDayOfWeek,
            daysToDayOfWeek = firstDayOfWeekOfYear - mom.day();


        if (daysToDayOfWeek > end) {
            daysToDayOfWeek -= 7;
        }

        if (daysToDayOfWeek < end - 7) {
            daysToDayOfWeek += 7;
        }

        return Math.ceil(moment(mom).add('d', daysToDayOfWeek).dayOfYear() / 7);
    }


    /************************************
        Top Level Functions
    ************************************/

    function makeMoment(config) {
        var input = config._i,
            format = config._f;

        if (input === null || input === '') {
            return null;
        }

        if (typeof input === 'string') {
            config._i = input = getLangDefinition().preparse(input);
        }

        if (moment.isMoment(input)) {
            config = extend({}, input);
            config._d = new Date(+input._d);
        } else if (format) {
            if (isArray(format)) {
                makeDateFromStringAndArray(config);
            } else {
                makeDateFromStringAndFormat(config);
            }
        } else {
            makeDateFromInput(config);
        }

        return new Moment(config);
    }

    moment = function (input, format, lang) {
        return makeMoment({
            _i : input,
            _f : format,
            _l : lang,
            _isUTC : false
        });
    };

    // creating with utc
    moment.utc = function (input, format, lang) {
        return makeMoment({
            _useUTC : true,
            _isUTC : true,
            _l : lang,
            _i : input,
            _f : format
        });
    };

    // creating with unix timestamp (in seconds)
    moment.unix = function (input) {
        return moment(input * 1000);
    };

    // duration
    moment.duration = function (input, key) {
        var isDuration = moment.isDuration(input),
            isNumber = (typeof input === 'number'),
            duration = (isDuration ? input._data : (isNumber ? {} : input)),
            ret;

        if (isNumber) {
            if (key) {
                duration[key] = input;
            } else {
                duration.milliseconds = input;
            }
        }

        ret = new Duration(duration);

        if (isDuration && input.hasOwnProperty('_lang')) {
            ret._lang = input._lang;
        }

        return ret;
    };

    // version number
    moment.version = VERSION;

    // default format
    moment.defaultFormat = isoFormat;

    // This function will load languages and then set the global language.  If
    // no arguments are passed in, it will simply return the current global
    // language key.
    moment.lang = function (key, values) {
        var i;

        if (!key) {
            return moment.fn._lang._abbr;
        }
        if (values) {
            loadLang(key, values);
        } else if (!languages[key]) {
            getLangDefinition(key);
        }
        moment.duration.fn._lang = moment.fn._lang = getLangDefinition(key);
    };

    // returns language data
    moment.langData = function (key) {
        if (key && key._lang && key._lang._abbr) {
            key = key._lang._abbr;
        }
        return getLangDefinition(key);
    };

    // compare moment object
    moment.isMoment = function (obj) {
        return obj instanceof Moment;
    };

    // for typechecking Duration objects
    moment.isDuration = function (obj) {
        return obj instanceof Duration;
    };


    /************************************
        Moment Prototype
    ************************************/


    moment.fn = Moment.prototype = {

        clone : function () {
            return moment(this);
        },

        valueOf : function () {
            return +this._d;
        },

        unix : function () {
            return Math.floor(+this._d / 1000);
        },

        toString : function () {
            return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ");
        },

        toDate : function () {
            return this._d;
        },

        toJSON : function () {
            return moment.utc(this).format('YYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
        },

        toArray : function () {
            var m = this;
            return [
                m.year(),
                m.month(),
                m.date(),
                m.hours(),
                m.minutes(),
                m.seconds(),
                m.milliseconds()
            ];
        },

        isValid : function () {
            if (this._isValid == null) {
                if (this._a) {
                    this._isValid = !compareArrays(this._a, (this._isUTC ? moment.utc(this._a) : moment(this._a)).toArray());
                } else {
                    this._isValid = !isNaN(this._d.getTime());
                }
            }
            return !!this._isValid;
        },

        utc : function () {
            this._isUTC = true;
            return this;
        },

        local : function () {
            this._isUTC = false;
            return this;
        },

        format : function (inputString) {
            var output = formatMoment(this, inputString || moment.defaultFormat);
            return this.lang().postformat(output);
        },

        add : function (input, val) {
            var dur;
            // switch args to support add('s', 1) and add(1, 's')
            if (typeof input === 'string') {
                dur = moment.duration(+val, input);
            } else {
                dur = moment.duration(input, val);
            }
            addOrSubtractDurationFromMoment(this, dur, 1);
            return this;
        },

        subtract : function (input, val) {
            var dur;
            // switch args to support subtract('s', 1) and subtract(1, 's')
            if (typeof input === 'string') {
                dur = moment.duration(+val, input);
            } else {
                dur = moment.duration(input, val);
            }
            addOrSubtractDurationFromMoment(this, dur, -1);
            return this;
        },

        diff : function (input, units, asFloat) {
            var that = this._isUTC ? moment(input).utc() : moment(input).local(),
                zoneDiff = (this.zone() - that.zone()) * 6e4,
                diff, output;

            if (units) {
                // standardize on singular form
                units = units.replace(/s$/, '');
            }

            if (units === 'year' || units === 'month') {
                diff = (this.daysInMonth() + that.daysInMonth()) * 432e5; // 24 * 60 * 60 * 1000 / 2
                output = ((this.year() - that.year()) * 12) + (this.month() - that.month());
                output += ((this - moment(this).startOf('month')) - (that - moment(that).startOf('month'))) / diff;
                if (units === 'year') {
                    output = output / 12;
                }
            } else {
                diff = (this - that) - zoneDiff;
                output = units === 'second' ? diff / 1e3 : // 1000
                    units === 'minute' ? diff / 6e4 : // 1000 * 60
                    units === 'hour' ? diff / 36e5 : // 1000 * 60 * 60
                    units === 'day' ? diff / 864e5 : // 1000 * 60 * 60 * 24
                    units === 'week' ? diff / 6048e5 : // 1000 * 60 * 60 * 24 * 7
                    diff;
            }
            return asFloat ? output : absRound(output);
        },

        from : function (time, withoutSuffix) {
            return moment.duration(this.diff(time)).lang(this.lang()._abbr).humanize(!withoutSuffix);
        },

        fromNow : function (withoutSuffix) {
            return this.from(moment(), withoutSuffix);
        },

        calendar : function () {
            var diff = this.diff(moment().startOf('day'), 'days', true),
                format = diff < -6 ? 'sameElse' :
                diff < -1 ? 'lastWeek' :
                diff < 0 ? 'lastDay' :
                diff < 1 ? 'sameDay' :
                diff < 2 ? 'nextDay' :
                diff < 7 ? 'nextWeek' : 'sameElse';
            return this.format(this.lang().calendar(format, this));
        },

        isLeapYear : function () {
            var year = this.year();
            return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
        },

        isDST : function () {
            return (this.zone() < moment([this.year()]).zone() ||
                this.zone() < moment([this.year(), 5]).zone());
        },

        day : function (input) {
            var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
            return input == null ? day :
                this.add({ d : input - day });
        },

        startOf: function (units) {
            units = units.replace(/s$/, '');
            // the following switch intentionally omits break keywords
            // to utilize falling through the cases.
            switch (units) {
            case 'year':
                this.month(0);
                /* falls through */
            case 'month':
                this.date(1);
                /* falls through */
            case 'week':
            case 'day':
                this.hours(0);
                /* falls through */
            case 'hour':
                this.minutes(0);
                /* falls through */
            case 'minute':
                this.seconds(0);
                /* falls through */
            case 'second':
                this.milliseconds(0);
                /* falls through */
            }

            // weeks are a special case
            if (units === 'week') {
                this.day(0);
            }

            return this;
        },

        endOf: function (units) {
            return this.startOf(units).add(units.replace(/s?$/, 's'), 1).subtract('ms', 1);
        },

        isAfter: function (input, units) {
            units = typeof units !== 'undefined' ? units : 'millisecond';
            return +this.clone().startOf(units) > +moment(input).startOf(units);
        },

        isBefore: function (input, units) {
            units = typeof units !== 'undefined' ? units : 'millisecond';
            return +this.clone().startOf(units) < +moment(input).startOf(units);
        },

        isSame: function (input, units) {
            units = typeof units !== 'undefined' ? units : 'millisecond';
            return +this.clone().startOf(units) === +moment(input).startOf(units);
        },

        zone : function () {
            return this._isUTC ? 0 : this._d.getTimezoneOffset();
        },

        daysInMonth : function () {
            return moment.utc([this.year(), this.month() + 1, 0]).date();
        },

        dayOfYear : function (input) {
            var dayOfYear = round((moment(this).startOf('day') - moment(this).startOf('year')) / 864e5) + 1;
            return input == null ? dayOfYear : this.add("d", (input - dayOfYear));
        },

        isoWeek : function (input) {
            var week = weekOfYear(this, 1, 4);
            return input == null ? week : this.add("d", (input - week) * 7);
        },

        week : function (input) {
            var week = this.lang().week(this);
            return input == null ? week : this.add("d", (input - week) * 7);
        },

        // If passed a language key, it will set the language for this
        // instance.  Otherwise, it will return the language configuration
        // variables for this instance.
        lang : function (key) {
            if (key === undefined) {
                return this._lang;
            } else {
                this._lang = getLangDefinition(key);
                return this;
            }
        }
    };

    // helper for adding shortcuts
    function makeGetterAndSetter(name, key) {
        moment.fn[name] = moment.fn[name + 's'] = function (input) {
            var utc = this._isUTC ? 'UTC' : '';
            if (input != null) {
                this._d['set' + utc + key](input);
                return this;
            } else {
                return this._d['get' + utc + key]();
            }
        };
    }

    // loop through and add shortcuts (Month, Date, Hours, Minutes, Seconds, Milliseconds)
    for (i = 0; i < proxyGettersAndSetters.length; i ++) {
        makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase().replace(/s$/, ''), proxyGettersAndSetters[i]);
    }

    // add shortcut for year (uses different syntax than the getter/setter 'year' == 'FullYear')
    makeGetterAndSetter('year', 'FullYear');

    // add plural methods
    moment.fn.days = moment.fn.day;
    moment.fn.weeks = moment.fn.week;
    moment.fn.isoWeeks = moment.fn.isoWeek;

    /************************************
        Duration Prototype
    ************************************/


    moment.duration.fn = Duration.prototype = {
        weeks : function () {
            return absRound(this.days() / 7);
        },

        valueOf : function () {
            return this._milliseconds +
              this._days * 864e5 +
              this._months * 2592e6;
        },

        humanize : function (withSuffix) {
            var difference = +this,
                output = relativeTime(difference, !withSuffix, this.lang());

            if (withSuffix) {
                output = this.lang().pastFuture(difference, output);
            }

            return this.lang().postformat(output);
        },

        lang : moment.fn.lang
    };

    function makeDurationGetter(name) {
        moment.duration.fn[name] = function () {
            return this._data[name];
        };
    }

    function makeDurationAsGetter(name, factor) {
        moment.duration.fn['as' + name] = function () {
            return +this / factor;
        };
    }

    for (i in unitMillisecondFactors) {
        if (unitMillisecondFactors.hasOwnProperty(i)) {
            makeDurationAsGetter(i, unitMillisecondFactors[i]);
            makeDurationGetter(i.toLowerCase());
        }
    }

    makeDurationAsGetter('Weeks', 6048e5);


    /************************************
        Default Lang
    ************************************/


    // Set default language, other languages will inherit from English.
    moment.lang('en', {
        ordinal : function (number) {
            var b = number % 10,
                output = (~~ (number % 100 / 10) === 1) ? 'th' :
                (b === 1) ? 'st' :
                (b === 2) ? 'nd' :
                (b === 3) ? 'rd' : 'th';
            return number + output;
        }
    });


    /************************************
        Exposing Moment
    ************************************/


    // CommonJS module is defined
    if (hasModule) {
        module.exports = moment;
    }
    /*global ender:false */
    if (typeof ender === 'undefined') {
        // here, `this` means `window` in the browser, or `global` on the server
        // add `moment` as a global object via a string identifier,
        // for Closure Compiler "advanced" mode
        this['moment'] = moment;
    }
    /*global define:false */
    if (typeof define === "function" && define.amd) {
        define("moment", [], function () {
            return moment;
        });
    }
}).call(this);
;
;
/* module-key = 'bamboo.web.resources:time-widget', location = '/widget/time/time.soy' */
// This file was automatically generated from time.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.time.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.time == 'undefined') { bamboo.widget.time = {}; }


bamboo.widget.time.timestamp = function(opt_data, opt_ignored) {
  return '' + bamboo.widget.time.time(soy.$$augmentMap(opt_data, {content: opt_data.format ? BAMBOO.Time.format(opt_data.datetime, opt_data.format) : BAMBOO.Time.format(opt_data.datetime, 'short')}));
};
if (goog.DEBUG) {
  bamboo.widget.time.timestamp.soyTemplateName = 'bamboo.widget.time.timestamp';
}


bamboo.widget.time.relative = function(opt_data, opt_ignored) {
  return '' + bamboo.widget.time.time(soy.$$augmentMap(opt_data, {content: opt_data.format ? BAMBOO.Time.format(opt_data.datetime, opt_data.format + 'Age') : BAMBOO.Time.format(opt_data.datetime, 'shortAge')}));
};
if (goog.DEBUG) {
  bamboo.widget.time.relative.soyTemplateName = 'bamboo.widget.time.relative';
}


bamboo.widget.time.time = function(opt_data, opt_ignored) {
  return '<time datetime="' + soy.$$escapeHtml(BAMBOO.Time.format(opt_data.datetime, 'timestamp')) + '" title="' + soy.$$escapeHtml(BAMBOO.Time.format(opt_data.datetime, 'full')) + '"' + aui.renderExtraClasses(soy.$$augmentMap(opt_data, {isFullAttr: true})) + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</time>';
};
if (goog.DEBUG) {
  bamboo.widget.time.time.soyTemplateName = 'bamboo.widget.time.time';
}
;
;
/* module-key = 'bamboo.web.resources:time-widget', location = '/widget/time/time.js' */
(function (BAMBOO, moment) {
    BAMBOO.Time = {};

    var hasOwn = Object.prototype.hasOwnProperty,
        dateFormatCache = {},
        dateTokenizer = /d{1,2}|'[^']+'|M{1,4}|y{2,4}|h{1,2}|H{1,2}|m{2}|s{2}|S{1,4}|Z{1,2}|z{1,2}|a|:|-|\/|\s+/g;

    function Type(str, isAge) {
        if (this instanceof Type) {
            this.key = str;
            this.isAge = isAge;
            return this;
        } else {
            return str && hasOwn.call(Type, str) ? Type[str] : null;
        }
    }

    for (var a = ['shortAge', 'longAge', 'short', 'long', 'full', 'timestamp'], i = 0, l = a.length, t; i < l; i++) {
        t = a[i];
        Type[t] = new Type(t, t.toLowerCase().indexOf('age') !== -1);
    }

    function getTextForRelativeAge(age, type, param) {
        switch(age) {
            case 'aMomentAgo':
                return type === Type.shortAge ?
                       "A moment ago" :
                       "A moment ago";
            case 'oneMinuteAgo':
                return type === Type.shortAge ?
                       "1 min ago" :
                       "1 minute ago";
            case 'xMinutesAgo':
                return type === Type.shortAge ?
                       AJS.format("{0} mins ago", param) :
                       AJS.format("{0} minutes ago", param);
            case 'oneHourAgo':
                return type === Type.shortAge ?
                       "1 hour ago" :
                       "1 hour ago";
            case 'xHoursAgo':
                return type === Type.shortAge ?
                       AJS.format("{0} hours ago", param) :
                       AJS.format("{0} hours ago", param);
            case 'oneDayAgo':
                return type === Type.shortAge ?
                       "Yesterday" :
                       "Yesterday";
            case 'xDaysAgo':
                return type === Type.shortAge ?
                       AJS.format("{0} days ago", param) :
                       AJS.format("{0} days ago", param);
            case 'oneWeekAgo':
                return type === Type.shortAge ?
                       "1 week ago" :
                       "1 week ago";
            default:
                return null;
        }
    }

    function toMomentFormat(javaDateFormat) {
        if (hasOwn.call(dateFormatCache, javaDateFormat)) {
            return dateFormatCache[javaDateFormat];
        }
        var momentDateFormat = "", token;
        dateTokenizer.exec('');
        while (token = dateTokenizer.exec(javaDateFormat)) {
            token = token[0];
            switch(token.charAt(0)) {
                case "'":
                    momentDateFormat += '[' + token.substring(1, token.length-1) + ']';
                    break;
                case 'd':
                case 'y':
                case 'a':
                    momentDateFormat += token.toUpperCase();
                    break;
                default:
                    momentDateFormat += token;
            }
        }
        dateFormatCache[javaDateFormat] = momentDateFormat;
        return momentDateFormat;
    }
    
    function getFormatString(type) {
        switch (type.key) {
            case 'short':
            case 'shortAge':
                return "dd MMM yyyy";
            case 'long':
            case 'longAge':
                return "dd MMMM yyyy";
            case 'full':
                return "dd MMM yyyy hh:mm a";
            case 'timestamp':
                return "yyyy-MM-ddTHH:mm:ssZ";
            default:
                return null;
        }
    }

    function isYesterday(now, date) {
        var end = now.clone().add('d', 1).hours(0).minutes(0).seconds(0).milliseconds(0);
        while (end > now) {
            end.subtract('d', 1);
        }
        var start = end.clone().subtract('d', 1);
        return start <= date && date < end;
    }

    function getSecondsBetween(start, end) {
        return Math.floor(end.diff(start, 'seconds', true));
    }

    function getMinutesBetween(start, end) {
        return Math.floor(end.diff(start, 'minutes', true));
    }

    function getHoursBetween(start, end) {
        return end.diff(start, 'hours'); // diff rounds by default
    }

    function getDaysBetween(start, end) {
        return Math.floor(end.diff(start, 'days', true));
    }

    function getMonthsBetween(start, end) {
        return end.diff(start, 'months', true);
    }

    function formatDateWithFormatString(date, type) {
        var formatString = toMomentFormat(getFormatString(type));

        return date.format(formatString);
    }

    function formatDateWithRelativeAge(date, type, now) {
        now = now || moment();

        if (date <= now) {
            if (date > now.clone().subtract('m', 1)) {
                return getTextForRelativeAge('aMomentAgo', type);
            } else if (date > now.clone().subtract('m', 2)) {
                return getTextForRelativeAge('oneMinuteAgo', type);
            } else if (date > now.clone().subtract('m', 50)) {
                return getTextForRelativeAge('xMinutesAgo', type, getMinutesBetween(date, now));
            } else if (date > now.clone().subtract('m', 90)) {
                return getTextForRelativeAge('oneHourAgo', type);
            } else if (isYesterday(now, date) && date < now.clone().subtract('h', 5)) {
                return getTextForRelativeAge('oneDayAgo', type);
            } else if (date > now.clone().subtract('d', 1)) {
                return getTextForRelativeAge('xHoursAgo', type, getHoursBetween(date, now));
            } else if (date > now.clone().subtract('d', 7)) {
                return getTextForRelativeAge('xDaysAgo', type, Math.max(getDaysBetween(date, now), 2));// if it's not yesterday then don't say it's one day ago
            } else if (date > now.clone().subtract('d', 8)) {
                return getTextForRelativeAge('oneWeekAgo', type);
            }
        }
        return formatDateWithFormatString(date, type);
    }

    function formatDate(momentDate, type) {
        if (momentDate && type) {
            if (type.isAge) {
                return formatDateWithRelativeAge(momentDate, type);
            } else {
                return formatDateWithFormatString(momentDate, type);
            }
        } else {
            return null;
        }
    }

    /*
     * Currently only supports the default 'long' formatting.
     */
    function elapsedTime(dateFrom, dateTo) {
         dateTo = dateTo || moment();
         if (dateFrom && dateFrom <= dateTo) {
             var months = getMonthsBetween(dateFrom, dateTo);
             if (months < 1) {
                 var minutes = getMinutesBetween(dateFrom, dateTo);
                 if (minutes < 1) {
                     var seconds = getSecondsBetween(dateFrom, dateTo);
                     if (seconds < 1) {
                         return "\u003c 1 second";
                     } else if (seconds > 1) {
                         return AJS.format("{0} seconds", seconds);
                     } else {
                         return "1 second";
                     }
                 } else if (minutes > 1) {
                     return AJS.format("{0} minutes", minutes);
                 } else {
                     return "1 minute";
                 }
             } else {
                 return "more than a month";
             }
        }
        return null;
    }

    BAMBOO.Time.format = function (dateOrNumberOrString, typeString) {
        return formatDate(dateOrNumberOrString ? moment(dateOrNumberOrString) : null, Type(typeString));
    }

    BAMBOO.Time.elapsedTime = function (dateOrNumberOrStringFrom, dateOrNumberOrStringTo) {
        var dateFrom = dateOrNumberOrStringFrom ? moment(dateOrNumberOrStringFrom) : null;
        var dateTo = dateOrNumberOrStringTo ? moment(dateOrNumberOrStringTo) : null;
        return elapsedTime(dateFrom, dateTo);
    }

}(window.BAMBOO = (window.BAMBOO || {}), moment));;
;
/* module-key = 'bamboo.web.resources:feature-deployment-release', location = '/feature/deployment/deployment-release.js' */
define('feature/deployment-release', [
    'jquery',
    'underscore',
    'brace',
    'util/events'
], function(
    $,
    _,
    Brace,
    events
) {

    'use strict';

    var DeploymentRelease = Brace.View.extend({

        mixins: [events.EventBusMixin],

        initialize: function(options) {
            this.data = {
                create: {},
                promote: {},
                rollback: false
            };

            if (options.event) {
                this.data[options.event] = options.data || {};
                this.triggerWrapperEvent(options.event, true);
            }

            this.onEvent([
                'release:change',
                'release:change:initial'
            ], this.onReleaseChange);

            this.onEvent([
                'branch:change',
                'branch:change:initial'
            ], this.onBranchChange);

            this.onEvent([
                'build:change',
                'build:change:initial'
            ], this.onBuildChange);

            this.onEvent('deploy:release:warning', this.onToggleWarning);
            this.onEvent('deploy:release:rollback', this.onToggleRollbackWarning);

            $(document).on('change',
                'form input:radio[name="releaseTypeOption"]',
                _.bind(this.onTypeChange, this)
            );
        },

        onBranchChange: function(instance) {
            switch (instance.$el.attr('id')) {
                case 'newReleaseBranchKey':
                    this.data.create.branch = $.trim(instance.$el.val());
                    this.triggerWrapperEvent('create');
                    break;
                case 'promoteReleaseBranchKey':
                    this.triggerWrapperEvent('promote');
                    break;
            }
        },

        onBuildChange: function(instance) {
            switch (instance.$el.attr('id')) {
                case 'newReleaseBuildResult':
                    this.data.create.build = $.trim(instance.$el.val());
                    this.data.create.resultsSummary = instance.getSelectedData();
                    this.triggerWrapperEvent('create');
                    break;
            }
        },

        onReleaseChange: function(instance) {
            switch (instance.$el.attr('id')) {
                case 'promoteVersion':
                    this.data.promote.release = instance.$el.val();
                    this.triggerWrapperEvent('promote');
                    break;
            }
        },

        onTypeChange: function() {
            var type = $('form input:radio[name="releaseTypeOption"]:checked').val();
            var warning = $('#rollbackWarning');

            type = $.trim(type).toLowerCase();

            if (type === 'create') {
                warning.toggleClass('hidden', !this.data.rollback);
            }

            this.triggerWrapperEvent(type);
        },

        onToggleWarning: function(instance) {
            var warning = $('#emptyBuildResults');
            var container = instance.$el.parents('.radio:first');

            if (this.data.create.build) {
                this.triggerEvent('build:show', container);
                this.triggerEvent('release:show', container);

                warning.addClass('hidden');
            }
            else {
                this.triggerEvent('build:hide', container);
                this.triggerEvent('release:hide', container);

                warning.removeClass('hidden');
            }
        },

        onToggleRollbackWarning: function(state) {
            this.data.rollback = state;

            $('#rollbackWarning').toggleClass(
                'hidden', !state
            );
        },

        getSelectedType: function() {
            return $('form input:radio[name="releaseTypeOption"]:checked')
                .val().toLowerCase();
        },

        triggerWrapperEvent: function(event, force) {
            if (force || this.getSelectedType() === event) {
                this.lastEvent = [
                    'deploy:release',
                    event, this.data[event]
                ];

                setTimeout(_.bind(function() {
                    if (this.lastEvent) {
                        this.triggerEvent.apply(this, this.lastEvent);
                        this.lastEvent = null;
                    }
                }, this), 100);
            }
        }

    });

    return DeploymentRelease;
});
;
;
/* module-key = 'bamboo.web.resources:feature-release-input', location = '/feature/release/release-input.js' */
define('feature/release-input', [
    'jquery',
    'underscore',
    'backbone',
    'brace',
    'util/events',
    'util/errors'
], function(
    $,
    _,
    Backbone,
    Brace,
    events,
    errors
) {

    'use strict';

    var ReleaseInputModel = Backbone.Model.extend({

        url: [
            AJS.contextPath(),
            'rest/api/latest/deploy/preview/versionName'
        ].join('/'),

        initialize: function(params) {
            this.initialParams = params || {};
        },

        fetch: function(options) {
            options.data = _.extend(
                this.initialParams,
                options.data
            );

            return Backbone.Model.prototype.fetch.call(this, options);
        }
    });

    var ReleaseInput = Brace.View.extend({

        mixins: [events.EventBusMixin],

        initialize: function(options) {
            this.params = null;
            this.data = null;

            this.$el.on('keyup', _.bind(_.debounce(
                this.onContentChange, 320 || options.timeout
            ), this));

            this.settings = {
                masterPickerId: options.masterPickerId
            };

            this.$icon = $(bamboo.feature.release.input.icon());
            $(this.$icon).insertAfter(this.$el).before(' ');

            this.dialog = AJS.InlineDialog(
                this.$icon, this.$icon.attr('id'),
                _.bind(this.onDialogShow, this), {
                    hideDelay: null,
                    offsetX: -60,
                    arrowOffsetX: -7,
                    width: 420
                }
            );

            this.model = new ReleaseInputModel(options.params);

            this.onEvent('build:change', this.onMasterChange);
            this.onEvent('build:change:initial', this.onMasterChangeInitial);
            this.onEvent('build:hide', this.onHide);
            this.onEvent('build:show', this.onShow);
        },

        onContentChange: function() {
            this.triggerEvent('release:change');
        },

        onMasterChange: function(instance) {
            if (
                this.settings.masterPickerId &&
                instance.$el.attr('id') !== this.settings.masterPickerId
            ) {
                return;
            }

            this.data = null;
            this.params = null;
            this.$el.val('');

            if (instance.$el.val()) {
                this.params = {
                    resultKey: instance.$el.val()
                };

                this.loadData(_.bind(function() {
                    this.$el.val(this.data.nextVersionName);
                    this.onContentChange();
                }, this));
            }
        },

        onMasterChangeInitial: function(instance) {
            if (
                this.settings.masterPickerId &&
                instance.$el.attr('id') !== this.settings.masterPickerId
            ) {
                return;
            }

            if (instance.$el.val()) {
                this.params = {
                    resultKey: instance.$el.val()
                };

                this.loadData();
            }
        },

        onDialogShow: function(content, trigger, showPopup) {
            content.css({ padding: '20px' });

            var handler = _.bind(function() {
                content.html(bamboo.feature.release.input.content({
                    item: this.data
                }));

                showPopup();
            }, this);

            if (this.data) {
                handler();
            }
            else {
                this.loadData(handler);
            }

            return false;
        },

        onHide: function(instance, container) {
            if (!container || container.find(this.$el).length) {
                this.$el.parents('.field-group:first').hide();
            }
        },

        onShow: function(instance, container) {
            if (!container || container.find(this.$el).length) {
                this.$el.parents('.field-group:first').show();
            }
        },

        loadData: function(callback) {
            if (this.params) {
                this.model.fetch({
                    data: this.params,
                    error: errors,
                    success: _.bind(function(instance, data) {
                        this.data = this.model.toJSON();

                        if (callback) {
                            callback();
                        }
                    }, this)
                });
            }
            else if (callback) {
                callback();
            }
        }

    });

    return ReleaseInput;

});
;
;
/* module-key = 'bamboo.web.resources:feature-release-input', location = '/feature/release/release-input.soy' */
// This file was automatically generated from release-input.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.release.input.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.release == 'undefined') { bamboo.feature.release = {}; }
if (typeof bamboo.feature.release.input == 'undefined') { bamboo.feature.release.input = {}; }


bamboo.feature.release.input.icon = function(opt_data, opt_ignored) {
  return '<a id="helpDialog-releaseInput" href="#" rel="help"><span class="aui-icon aui-icon-small aui-iconfont-info" data-unicode="UTF+E012" original-title="">Info</span></a>';
};
if (goog.DEBUG) {
  bamboo.feature.release.input.icon.soyTemplateName = 'bamboo.feature.release.input.icon';
}


bamboo.feature.release.input.content = function(opt_data, opt_ignored) {
  return '<div class="release-input-info">' + ((opt_data.item) ? (opt_data.item.isBranch) ? '<h3>' + soy.$$escapeHtml("Release version naming for branch deployments") + '</h3><br/>' + soy.$$escapeHtml("When creating releases from a plan branch, the following naming scheme applies:") + '<br><br><span>&lt;branchname&gt;-&lt;incremented number&gt;</span><br><br>' + soy.$$escapeHtml("Changing the release name in this form is a one-time change. The subsequent release from a plan branch will once again use the naming scheme above.") + '<br><br>' + soy.$$filterNoAutoescape(AJS.format("Only releases from your default branch make use of the \x3ca href\x3d\x22{0}\x22\x3erelease version naming scheme\x3c/a\x3e.","" + '/deploy/config/configureDeploymentProjectVersioning.action?id=' + opt_data.item.deploymentProjectId)) : '<h3>' + soy.$$escapeHtml("Release version naming scheme") + '</h3><br/>' + soy.$$escapeHtml("Releases in this deployment project are named according to the following release version naming scheme:") + '<br><span>' + soy.$$escapeHtml(opt_data.item.versionNamingScheme) + '</span><br><br>' + soy.$$escapeHtml("The default value in the Release field was computed using this formula. Changing the release name in this form is a one-time change and will not influence the release version naming scheme for subsequent releases.") + '<br><br>' + soy.$$filterNoAutoescape(AJS.format("You can \x3ca href\x3d\x22{0}\x22\x3echange the release version naming scheme\x3c/a\x3e for permanent changes.","" + '/deploy/config/configureDeploymentProjectVersioning.action?id=' + opt_data.item.deploymentProjectId)) : '<span>' + soy.$$escapeHtml("Please select a build result.") + '</span>') + '</div>';
};
if (goog.DEBUG) {
  bamboo.feature.release.input.content.soyTemplateName = 'bamboo.feature.release.input.content';
}
;
;
/* module-key = 'bamboo.web.resources:widget-autocomplete', location = '/widget/autocomplete/autocomplete.js' */
define('widget/autocomplete', [
    'jquery',
    'underscore',
    'brace',
    'util/events'
], function(
    $,
    _,
    Brace,
    events
) {

    'use strict';

    var Autocomplete = Brace.View.extend({

        mixins: [
            events.EventBusMixin
        ],

        initialize: function(options) {
            this.data = [];

            options.initialValue = $.parseJSON(
                options.initialValue || null
            );

            if (_.isFunction(this.onInitSelection)) {
                options.initSelection = _.bind(this.onInitSelection, this);
            }

            this.settings = $.extend({
                escapeMarkup: function(m) {
                    return m;
                },
                placeholder: ' '
            }, options || {});

            if (!this.$el.val()) {
                if (!options.initialValue && options.loadAndProcess && this.onLoadAndProcess) {
                    this.settings.initSelection = _.bind(this.onLoadAndProcess, this);
                    this.$el.val('__LOADING__');
                }
            }

            this.$el.auiSelect2(this.settings);
            this.$el.on('change', _.bind(function() {
                $('#select2-drop-mask').hide();

                this.$el.auiSelect2('dropdown').hide();
                this.$el.auiSelect2('container')
                    .removeClass('select2-dropdown-open')
                    .removeClass('select2-container-active');
            }, this));

            this.onRegisterEvents();
        },

        onRegisterEvents: function() {
            this.proxyEvents('select',
                ['change', 'select2-open', 'select2-blur'],
                this.$el
            );
        },

        getSelectedData: function(callback) {
            var selected = this.$el.auiSelect2('data');

            if (!selected) {
                selected = _.find(this.data.results, _.bind(callback || function(item) {
                    return item.id === this.$el.val();
                }, this));
            }

            return selected;
        },

        initConfig: function(values) {
            var defaults = _.defaults(values || {}, {
                placeholder: this.settings.placeholder,
                data: []
            });

            this.$el.auiSelect2(_.defaults(
                defaults,
                this.settings
            ));

            return this;
        },

        getContainer: function() {
            return this.$el.auiSelect2('container');
        },

        addLoadingIcon: function() {
            var $icon = $(document.createElement('span'))
                .addClass('aui-icon aui-icon-wait');

            this.$el.siblings('.select2-container:first').append($icon);
            return this;
        },

        removeLoadingIcon: function() {
            setTimeout(_.bind(function() {
                this.$el.parent().find('.aui-icon-wait').fadeOut();
            }, this), 500);

            return this;
        },

        clearValue: function() {
            this.$el.auiSelect2('data', null);
            return this;
        },

        processData: function(data) {
            this.data = data;
            return this.data;
        },

        disable: function() {
            this.$el.auiSelect2('enable', false);
            return this;
        },

        enable: function() {
            this.$el.auiSelect2('enable', true);
            return this;
        }

    });

    return Autocomplete;

});

/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('Bamboo.Widget.Autocomplete', null, require('widget/autocomplete'));
};
;
/* module-key = 'bamboo.web.resources:widget-autocomplete', location = '/widget/autocomplete/autocomplete.soy' */
// This file was automatically generated from autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.autocomplete == 'undefined') { bamboo.widget.autocomplete = {}; }


bamboo.widget.autocomplete.result = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml(opt_data.name);
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.result.soyTemplateName = 'bamboo.widget.autocomplete.result';
}


bamboo.widget.autocomplete.selection = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml(opt_data.name);
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.selection.soyTemplateName = 'bamboo.widget.autocomplete.selection';
}
;
;
/* module-key = 'bamboo.web.resources:widget-autocomplete-ajax', location = '/widget/autocomplete/autocomplete-ajax.js' */
define('widget/autocomplete-ajax', [
    'jquery',
    'underscore',
    'widget/autocomplete',
    'util/events',
    'util/ajax',
    'util/errors'
], function(
    $,
    _,
    Autocomplete,
    events,
    ajax,
    errors
) {

    'use strict';

    var AutocompleteAjax = Autocomplete.extend({

        mixins: [
            events.EventBusMixin
        ],

        initialize: function(options) {
            this.params = $.extend({
                'max-results': 10
            }, this.params || {});

            if (_.isFunction(this.onFormatSelection)) {
                options.formatSelection = _.bind(this.onFormatSelection, this);
            }

            if (_.isFunction(this.onFormatResult)) {
                options.formatResult = _.bind(this.onFormatResult, this);
            }

            options.ajax.quietMillis = options.ajax.quietMillis || 320;

            if (_.isUndefined(options.cache) || !!options.cache) {
                options.ajax.resultsCallback = options.ajax.results;
                options.ajax.results = null;

                options.query = _.debounce(
                    _.bind(this.queryAjaxCache, this),
                    options.ajax.quietMillis
                );

                if (!options.ajax.params) {
                    if (_.isFunction(this.onRemoteData)) {
                        options.ajax.params = {
                            error: _.bind(this.onRemoteData, this)
                        };
                    }
                    else {
                        options.ajax.params = {
                            error: _.bind(function(jqXHR, textStatus, errorThrown) {
                                this.$el.auiSelect2('close');
                                errors(
                                    jqXHR, textStatus, errorThrown
                                );
                            }, this)
                        };
                    }
                }
            }

            Autocomplete.prototype.initialize.apply(
                this, [options || {}]
            );
        },

        queryAjaxCache: function(query) {
            this.cache = this.cache || {
                initial: {},
                term: {}
            };

            var term = $.trim(query.term);

            query.key = JSON.stringify(
                this.settings.ajax.data(term, query.page || 1, true)
            );

            var cache = (term.length) ?
                this.cache.term[query.key] :
                this.cache.initial[query.key];

            if (!_.isEmpty(cache)) {
                query.callback(cache);
                return;
            }

            this.settings.ajax.results = _.bind(function(data, page) {
                var response = this.settings.ajax
                    .resultsCallback(data, page);

                if (!response.results.length && this.settings.ajax.empty) {
                    response = {
                        results: this.settings.ajax.empty.call(this, query.term),
                        more: false
                    };
                }

                if (term) {
                    this.cache.term[query.key] = response;
                }
                else {
                    this.cache.initial[query.key] = response;
                }

                return response;
            }, this);

            window.Select2.query.ajax($.extend({
                transport: ajax
            }, this.settings.ajax))(query);
        },

        addQueryCache: function(request, data) {
            var key = JSON.stringify(request);
            data = data || this.data;

            if (!key.query || !key.query.length) {
                this.cache.initial[key] = data;
            }
            else {
                this.cache.term[key] = data;
            }

            return this;
        },

        clearQueryCache: function() {
            this.cache = {
                initial: {},
                term: {}
            };

            return this;
        }

    });

    return AutocompleteAjax;

});
;
;
/* module-key = 'bamboo.web.resources:feature-release-autocomplete', location = '/feature/release/release-autocomplete.js' */
define('feature/release-autocomplete', [
    'jquery',
    'underscore',
    'widget/autocomplete-ajax',
    'util/events',
    'util/ajax'
], function(
    $,
    _,
    AutocompleteAjax,
    events,
    ajax
) {

    'use strict';

    var ReleaseAutocomplete = AutocompleteAjax.extend({

        mixins: [events.EventBusMixin],

        initialize: function(options) {
            this.params = options.params || {};

            if (options.params) {
                delete options.params;
            }

            var dataCallback = _.bind(function(term, page) {
                return $.extend({
                    searchTerm: term,
                    'start-index': Math.max(
                        (page - 1) * this.params['max-results'], 0
                    ),
                    chronologicalOrder: true
                }, this.params);
            }, this);

            var settings = {
                minimumInputLength: 0,
                ajax: {
                    url: AJS.contextPath() + '/rest/api/latest/search/versions',
                    dataType: 'json',
                    data: dataCallback,
                    results: _.bind(function(data, page) {
                        return this.processData({
                            results: data.searchResults,
                            more: data.size ? data.size > (page * this.params['max-results']) : false
                        });
                    }, this)
                }
            };

            AutocompleteAjax.prototype.initialize.apply(
                this, [$.extend(settings, options || {})]
            );
        },

        onRegisterEvents: function() {
            this.proxyEvents('release', ['change'], this.$el);
            var events = ['branch:change'];

            if (!this.$el.val()) {
                events.push('branch:change:initial');
            }

            this.onEvent(events, this.onMasterChange);
        },

        onLoadAndProcess: function(element, callback) {
            var settings = _.defaults({
                data: this.settings.ajax.data('', 1)
            }, this.settings.ajax);

            ajax(settings)
                .done(_.bind(function(data) {
                    var selected = data.searchResults[0];

                    if (selected && selected.id) {
                        this.$el.val(selected.id);
                        this.$el.select2('data', selected);
                    }

                    this.processData({
                        results: data.searchResults,
                        more: data.size ? data.size > this.params['max-results'] : false
                    });

                    this.triggerEvent('release:change');

                    if (callback) {
                        callback(selected);
                    }
                }, this));
        },

        onFormatResult: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.widget.autocomplete.result({
                    name: item.searchEntity.name
                });
            }
        },

        onFormatSelection: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.widget.autocomplete.selection({
                    name: item.searchEntity.name
                });
            }
        },

        onMasterChange: function(instance) {
            if (
                this.settings.masterPickerId &&
                instance.$el.attr('id') !== this.settings.masterPickerId
            ) {
                return;
            }

            this.params.branchKey = '';
            this.clearValue();

            var value = instance.getSelectedData();

            if (value) {
                this.params.branchKey = value.searchEntity.key;
                this.onLoadAndProcess();
            }
        }

    });

    return ReleaseAutocomplete;
});
;
;
/* module-key = 'bamboo.web.resources:feature-release-autocomplete', location = '/feature/release/release-autocomplete.soy' */
// This file was automatically generated from release-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.release.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.release == 'undefined') { bamboo.feature.release = {}; }
if (typeof bamboo.feature.release.autocomplete == 'undefined') { bamboo.feature.release.autocomplete = {}; }


bamboo.feature.release.autocomplete.result = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml(opt_data.item.name);
};
if (goog.DEBUG) {
  bamboo.feature.release.autocomplete.result.soyTemplateName = 'bamboo.feature.release.autocomplete.result';
}


bamboo.feature.release.autocomplete.selection = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml(opt_data.item.name);
};
if (goog.DEBUG) {
  bamboo.feature.release.autocomplete.selection.soyTemplateName = 'bamboo.feature.release.autocomplete.selection';
}
;
;
/* module-key = 'bamboo.web.resources:piecon-js', location = '/scripts/piecon/piecon.js' */
//
// piecon.js
//
// https://github.com/lipka/piecon
//
// Copyright (c) 2012 Lukas Lipka <lukaslipka@gmail.com>. All rights reserved.
//
// Licenced under MIT Licence
//
// Modified by Atlassian
(function($, Piecon) {
    var currentFavicon = null;
    var originalFavicon = null;
    var originalTitle = null;
    var canvas = null;
    var options = {};
    var defaults = {
        color: '#3b73af',
        //background: '#999',
        background: '#ccd9ea',
        shadow: '#fff',
        fallback: false
    };

    var isRetina = window.devicePixelRatio > 1;

    var ua = (function () {
        var agent = navigator.userAgent.toLowerCase();
        return function (browser) {
            return agent.indexOf(browser) !== -1;
        };
    }());

    var browser = {
        ie: ua('msie'),
        chrome: ua('chrome'),
        webkit: ua('chrome') || ua('safari'),
        safari: ua('safari') && !ua('chrome'),
        mozilla: ua('mozilla') && !ua('chrome') && !ua('safari')
    };

    var getFaviconTag = function() {
        var links = $("head").find("link");

        for (var l = links.length, i = l-1; i >= 0; i--) {
            if (links[i].getAttribute('rel') === 'icon' || links[i].getAttribute('rel') === 'shortcut icon') {
                return links[i];
            }
        }
        return false;
    };

    var removeFaviconTag = function() {
        var $head = $("head");
        $head.find("link[rel='icon']").remove();
        $head.find("link[rel='shortcut icon']").remove();
    };

    var setFaviconTag = function(url) {
        removeFaviconTag();
        $("head").append("<link rel='icon' type='image/x-icon' href='" + url + "'/>")
    };

    var getCanvas = function () {
        if (!canvas) {
            canvas = document.createElement("canvas");
            if (isRetina) {
                canvas.width = 32;
                canvas.height = 32;
            } else {
                canvas.width = 16;
                canvas.height = 16;
            }
        }

        return canvas;
    };

    var drawFavicon = function(percentage) {
        var canvas = getCanvas();
        var context = canvas.getContext("2d");
        var percentage = percentage || 0;
        var src = currentFavicon;

        var faviconImage = new Image();
        faviconImage.onload = function() {
            if (context) {
                context.clearRect(0, 0, canvas.width, canvas.height);

                // Draw empty circle
                context.beginPath();
                context.arc(canvas.width / 2, canvas.height / 2, Math.min(canvas.width / 2 -1 , canvas.height / 2 -1), 0, Math.PI * 2, false);
                context.strokeStyle = options.color;
                context.stroke();

                // Draw pie
                if (percentage > 0) {
                    context.beginPath();
                    context.moveTo(canvas.width / 2, canvas.height / 2);
                    context.arc(canvas.width / 2, canvas.height / 2, Math.min(canvas.width / 2 - 1, canvas.height / 2 -1), (-0.5) * Math.PI, (-0.5 + 2 * percentage / 100) * Math.PI, false);
                    context.lineTo(canvas.width / 2, canvas.height / 2);
                    context.fillStyle = options.color;
                    context.fill();
                }

                setFaviconTag(canvas.toDataURL());
            }
        };

        // allow cross origin resource requests if the image is not a data:uri
        // as detailed here: https://github.com/mrdoob/three.js/issues/1305
        if (!src.match(/^data/)) {
            faviconImage.crossOrigin = 'anonymous';
        }

        faviconImage.src = src;
    };

    var updateTitle = function(percentage) {
        if (percentage > 0) {
            document.title = '(' + percentage + '%) ' + originalTitle;
        } else {
            document.title = originalTitle;
        }
    };

    Piecon.setOptions = function(custom) {
        options = {};

        for (var key in defaults){
            options[key] = custom.hasOwnProperty(key) ? custom[key] : defaults[key];
        }

        return this;
    };

    Piecon.setProgress = function(percentage) {
        if (!originalTitle) {
            originalTitle = document.title;
        }

        if (!originalFavicon || !currentFavicon) {
            var tag = getFaviconTag();
            originalFavicon = currentFavicon = tag ? tag.getAttribute('href') : '/favicon.ico';
        }

        if (!isNaN(parseFloat(percentage)) && isFinite(percentage)) {
            if (!getCanvas().getContext || browser.ie || browser.safari || options.fallback === true) {
                // Fallback to updating the browser title if unsupported
                return updateTitle(percentage);
            } else if (options.fallback === 'force') {
                updateTitle(percentage);
            }

            return drawFavicon(percentage);
        }

        return false;
    };

    Piecon.reset = function() {
        if (originalTitle) {
            document.title = originalTitle;
        }

        if (originalFavicon) {
            currentFavicon = originalFavicon;
            setFaviconTag(currentFavicon);
        }
    };

    Piecon.setFavicon = function(url)
    {
        if (!browser.ie)
        {
            setFaviconTag(url);
        }
    };

    Piecon.browserSupportsDynamicFavicon = function()
    {
        return !browser.ie && !browser.safari;
    };

    Piecon.setOptions(defaults);
}(jQuery, window.Piecon = (window.Piecon || {})));
;
;
/* module-key = 'bamboo.web.resources:piecon-js', location = '/scripts/piecon/favicon-update.js' */
(function ($, BAMBOO) {
    BAMBOO.FaviconUpdate = function (opts) {
        var resourcePrefix = opts.resourcePrefix,
            url = opts.faviconRestUrl,
            update = function () {
                $.ajax({
                           url: url,
                           dataType: "json",
                           cache: false,
                           success: function (json) {
                               Piecon.setFavicon(resourcePrefix + json.faviconUrl);
                           }
                       });
                // Update again in 20 seconds
                setTimeout(update, 20000);
            };
        return {
            init: function () {
                update();
            }
        };
    }
}(jQuery, window.BAMBOO = (window.BAMBOO || {})));
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/widget/icons.soy' */
// This file was automatically generated from icons.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.icons.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.icons == 'undefined') { widget.icons = {}; }


widget.icons.icon = function(opt_data, opt_ignored) {
  return '<span class="icon icon-' + soy.$$escapeHtml(opt_data.type) + '"' + ((opt_data.text && opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '') + '>' + ((opt_data.text) ? '<span>' + soy.$$escapeHtml(opt_data.text) + '</span>' : '') + '</span>';
};
if (goog.DEBUG) {
  widget.icons.icon.soyTemplateName = 'widget.icons.icon';
}


widget.icons.fontIcon = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-' + soy.$$escapeHtml(opt_data.type) + '"' + ((opt_data.text && opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '') + '>' + ((opt_data.text) ? '<span>' + soy.$$escapeHtml(opt_data.text) + '</span>' : '') + '</span>';
};
if (goog.DEBUG) {
  widget.icons.fontIcon.soyTemplateName = 'widget.icons.fontIcon';
}


widget.icons.auiFontLink = function(opt_data, opt_ignored) {
  return '<a ' + ((opt_data.text) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '" ' : '') + 'href="' + soy.$$escapeHtml("" + opt_data.relativeUrl) + '"><span class="aui-icon aui-icon-small aui-iconfont-' + soy.$$escapeHtml(opt_data.iconType) + '">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + '</span></a>';
};
if (goog.DEBUG) {
  widget.icons.auiFontLink.soyTemplateName = 'widget.icons.auiFontLink';
}


widget.icons.statusIcon = function(opt_data, opt_ignored) {
  return '' + ((opt_data.status == 'approve' || opt_data.status == 'project-success' || opt_data.status == 'Successful' || opt_data.status == 'SUCCESS' || opt_data.status == 'successful') ? widget.icons.fontIcon(soy.$$augmentMap(opt_data, {type: 'approve', text: opt_data.text, showTitle: opt_data.text ? true : false})) : (opt_data.status == 'error' || opt_data.status == 'project-fail' || opt_data.status == 'Failed' || opt_data.status == 'FAILED' || opt_data.status == 'failed') ? widget.icons.fontIcon(soy.$$augmentMap(opt_data, {type: 'error', text: opt_data.text, showTitle: opt_data.text ? true : false})) : (opt_data.status == 'task-cancelled' || opt_data.status == 'NotBuilt' || opt_data.status == 'notbuilt' || opt_data.status == 'NOT_BUILT' || opt_data.status == 'Unknown' || opt_data.status == 'UNKNOWN' || opt_data.status == 'unknown') ? widget.icons.fontIcon({type: 'devtools-task-cancelled', text: opt_data.text, showTitle: opt_data.text ? true : false}) : (opt_data.status == 'task-in-progress' || opt_data.status == 'Pending' || opt_data.status == 'PENDING' || opt_data.status == 'pending' || opt_data.status == 'Queued' || opt_data.status == 'QUEUED' || opt_data.status == 'queued') ? widget.icons.fontIcon(soy.$$augmentMap(opt_data, {type: 'devtools-task-in-progress', text: opt_data.text, showTitle: opt_data.text ? true : false})) : (opt_data.status == 'task-disabled' || opt_data.status == 'disabled' || opt_data.status == 'project-none' || opt_data.status == 'NeverExecuted' || opt_data.status == 'skipped' || opt_data.status == 'Suspended') ? widget.icons.fontIcon(soy.$$augmentMap(opt_data, {type: 'devtools-task-disabled', text: opt_data.text, showTitle: opt_data.text ? true : false})) : widget.icons.icon({type: opt_data.status + (opt_data.reversed ? ' icon-reversed' : ''), text: opt_data.text, showTitle: opt_data.text ? true : false}));
};
if (goog.DEBUG) {
  widget.icons.statusIcon.soyTemplateName = 'widget.icons.statusIcon';
}
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/widget/lozenges.soy' */
// This file was automatically generated from lozenges.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.lozenges.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.lozenges == 'undefined') { widget.lozenges = {}; }


widget.lozenges.lozenge = function(opt_data, opt_ignored) {
  return '<span class="lozenge lozenge-' + soy.$$escapeHtml(opt_data.colour ? opt_data.colour : 'default') + soy.$$escapeHtml(opt_data.subtle ? ' lozenge-subtle' : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$escapeHtml(opt_data.text) + '</span>';
};
if (goog.DEBUG) {
  widget.lozenges.lozenge.soyTemplateName = 'widget.lozenges.lozenge';
}


widget.lozenges.auilozenge = function(opt_data, opt_ignored) {
  return '<span class="aui-lozenge aui-lozenge-' + soy.$$escapeHtml(opt_data.colour ? opt_data.colour : 'default') + soy.$$escapeHtml(opt_data.subtle ? ' aui-lozenge-subtle' : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$escapeHtml(opt_data.text) + '</span>';
};
if (goog.DEBUG) {
  widget.lozenges.auilozenge.soyTemplateName = 'widget.lozenges.auilozenge';
}


widget.lozenges.branch = function(opt_data, opt_ignored) {
  return '<span class="' + ((opt_data.cssClass) ? soy.$$escapeHtml(opt_data.cssClass) : 'lozenge-newline') + '">' + ((opt_data.label) ? '<span class="inline-label">' + soy.$$escapeHtml(opt_data.label) + '</span> ' : '') + '<span class="lozenge branch-lozenge monospace" title="' + soy.$$escapeHtml(opt_data.planBranchName) + '"><span class="branch">' + aui.icons.icon({icon: 'devtools-branch-small', useIconFont: true}) + '<span class="name">' + soy.$$escapeHtml(opt_data.planBranchName) + '</span></span></span></span>';
};
if (goog.DEBUG) {
  widget.lozenges.branch.soyTemplateName = 'widget.lozenges.branch';
}
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/widget/agent.soy' */
// This file was automatically generated from agent.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.agent.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.agent == 'undefined') { widget.agent = {}; }


widget.agent.renderAgentNameLink = function(opt_data, opt_ignored) {
  return '' + ((opt_data.type == 'ELASTIC') ? (true) ? '<a href="' + soy.$$escapeHtml("" + '/admin/elastic/manageElasticInstances.action') + '">' + widget.icons.icon({type: 'elastic', text: '(elastic)', showTitle: true}) + '</a>' : widget.icons.icon({type: 'elastic', text: '(elastic)', showTitle: true}) : '') + ((opt_data.showAdminLink) ? '<a href="' + soy.$$escapeHtml("" + '/admin/agent/viewAgent.action?agentId=' + opt_data.id) + '">' + soy.$$escapeHtml(opt_data.name) + '</a>' : '<a href="' + soy.$$escapeHtml("" + '/agent/viewAgent.action?agentId=' + opt_data.id) + '">' + soy.$$escapeHtml(opt_data.name) + '</a>');
};
if (goog.DEBUG) {
  widget.agent.renderAgentNameLink.soyTemplateName = 'widget.agent.renderAgentNameLink';
}
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/widget/plan.soy' */
// This file was automatically generated from plan.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.plan.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.plan == 'undefined') { widget.plan = {}; }


widget.plan.renderPlanNameLink = function(opt_data, opt_ignored) {
  return '<a href="' + ((opt_data.url) ? soy.$$escapeHtml(opt_data.url) : soy.$$escapeHtml("" + '/browse/' + opt_data.plan.key)) + '" ' + ((opt_data.plan.description) ? 'title="' + soy.$$escapeHtml(opt_data.plan.description) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.plan.project.name) + ' &rsaquo; ' + ((opt_data.plan.master) ? soy.$$escapeHtml(opt_data.plan.master.buildName) + ' &rsaquo; ' + aui.icons.icon({icon: 'devtools-branch-small', useIconFont: true}) + ' ' : '') + soy.$$escapeHtml(opt_data.plan.buildName) + '</a>';
};
if (goog.DEBUG) {
  widget.plan.renderPlanNameLink.soyTemplateName = 'widget.plan.renderPlanNameLink';
}


widget.plan.renderPlanNameLinkWithoutBranch = function(opt_data, opt_ignored) {
  return '<a href="' + ((opt_data.url) ? soy.$$escapeHtml(opt_data.url) : soy.$$escapeHtml("" + '/browse/' + opt_data.plan.key)) + '" ' + ((opt_data.plan.description) ? 'title="' + soy.$$escapeHtml(opt_data.plan.description) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.plan.project.name) + ' &rsaquo; ' + ((opt_data.plan.master) ? soy.$$escapeHtml(opt_data.plan.master.buildName) : soy.$$escapeHtml(opt_data.plan.buildName)) + '</a>';
};
if (goog.DEBUG) {
  widget.plan.renderPlanNameLinkWithoutBranch.soyTemplateName = 'widget.plan.renderPlanNameLinkWithoutBranch';
}
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/widget/buildresult.soy' */
// This file was automatically generated from buildresult.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.buildresult.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.buildresult == 'undefined') { widget.buildresult = {}; }


widget.buildresult.resultStatusAndLink = function(opt_data, opt_ignored) {
  var output = '' + widget.status.buildResultStatusIcon(opt_data);
  var resultClass__soy5 = '' + widget.status.buildResultStatusClass(opt_data);
  output += ' <a href="' + soy.$$escapeHtml("" + '/browse/' + opt_data.resultSummary.planResultKey.key) + '" class="' + soy.$$escapeHtml(resultClass__soy5) + '">' + soy.$$escapeHtml('#' + opt_data.resultSummary.planResultKey.resultNumber) + '</a>';
  return output;
};
if (goog.DEBUG) {
  widget.buildresult.resultStatusAndLink.soyTemplateName = 'widget.buildresult.resultStatusAndLink';
}


widget.buildresult.resultStatus = function(opt_data, opt_ignored) {
  var output = '' + widget.status.buildResultStatusIcon(opt_data);
  var resultClass__soy18 = '' + widget.status.buildResultStatusClass(opt_data);
  output += ' <span class="' + soy.$$escapeHtml(resultClass__soy18) + '">' + soy.$$escapeHtml('#' + opt_data.resultSummary.planResultKey.resultNumber) + '</span>';
  return output;
};
if (goog.DEBUG) {
  widget.buildresult.resultStatus.soyTemplateName = 'widget.buildresult.resultStatus';
}
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/jquery/plugins/bamboo/progressbar.js' */
/**
 * Progress Bar jQuery plugin
 *
 * Options:
 * - value  {number}    Default: 0
 *      The value of the progressBar.
 *      Can be set when initialising (first creating) the progressBar.
 *          eg. $(".selector").progressBar({ value: 40 });
 *      Get or set the value option after initialisation:
 *          //getter
 *          var value = $(".selector").progressBar("option", "value");
 *          //setter
 *          $(".selector").progressBar("option", "value", 40);
 *
 * - text   {string}    Default: &nbsp;
 *      The text shown in the progressBar.
 *      Can be set when initialising (first creating) the progressBar.
 *          eg. $(".selector").progressBar({ text: "40% complete" });
 *      Get or set the value option after initialisation:
 *          //getter
 *          var text = $(".selector").progressBar("option", "text");
 *          //setter
 *          $(".selector").progressBar("option", "text", "40% complete");
 *
 * Initialisation:
 * $("#myBar").progressBar();
 *
 * This will turn the target element (in this case <div id="myBar"></div>) into a progress bar using the
 * default options. If the HTML for the progress bar is already contained within the target element the plugin will
 * initialise by extracting the data from the HTML, which from then onward can be updated using the plugin methods.
 *
 * You could also pass an object as the first parameter containing your own options with which to initialise the
 * progress bar. eg. $("#myBar").progressBar({ value: 40, text: "40% complete" });
 *
 * Methods:
 * - progressBar("destroy")
 *      Removes any data and bindings that were added to the element by the plugin leaving just the HTML.
 *
 * - progressBar("option", optionName, [value])
 *      Get or set any progressBar option. If no value is specified, will act as a getter.
 *
 * - progressBar("option", [options])
 *      Get or set multiple progressBar options at once by providing an options object. If options is not specified,
 *      will act as a getter.
 * 
 */
(function ($) {
    $.fn.progressBar = function (options) {
        if (typeof options == "string") {
            if (options == "option") {
                if (arguments.length == 1) { // getter
                    var retArr = [];
                    this.each(function () {
                        retArr.push($(this).data("options"));
                    });
                    return retArr;
                } else if (arguments.length == 2 && typeof arguments[1] == "string") { // individual option getter
                    var ret,
                        opt = arguments[1];
                    this.each(function () {
                        var $el = $(this);
                        ret = (typeof ret == "undefined") ? $el.data("options")[opt] : ret + $el.data("options")[opt];
                    });
                    return ret;
                } else if (arguments.length == 2 && typeof arguments[1] == "object") { // option object setter
                    var newOpts = arguments[1];
                    if (typeof newOpts.text != "undefined" && (newOpts.text == null || newOpts.text == "")) {
                        newOpts.text = $.fn.progressBar.defaults.text;
                    }
                    return this.each(function () {
                        var $el = $(this);
                        $el.data("options", $.extend($el.data("options"), newOpts)).trigger("updateProgressBar");
                    });
                } else if (arguments.length == 3 && typeof arguments[1] == "string") { // individual option setter
                    var key = arguments[1],
                        newVal = arguments[2];
                    if (key == "text" && (newVal == null || newVal == "")) {
                        newVal = $.fn.progressBar.defaults.text;
                    }
                    return this.each(function () {
                        var $el = $(this);
                        var currentOptions = $el.data("options");
                        currentOptions[key] = newVal;
                        $el.data("options", currentOptions).trigger("updateProgressBar");
                    });
                }
            } else if (options == "destroy") {
                return this.each(function () {
                    $(this).removeData("options").removeData("bar").removeData("text").unbind("updateProgressBar");
                });
            }
        } else { // init
            if (typeof options != "undefined" && typeof options.text != "undefined" && (options.text == null || options.text == "")) {
                delete options.text;
            }
            var opts = $.extend({}, $.fn.progressBar.defaults, options);
            return this.each(function () {
                var $el = $(this);
                $el.bind("updateProgressBar", function (e) {
                    var $el = $(this),
                        options = $el.data("options");
                    $el.data("bar").width(Math.max(0, Math.min(100, options.value)) + "%");
                    $el.data("text").html(options.text);
                });
                if ($(".progress-bar, .progress-text", this).length == 2) { // check if HTML for progressBar already exists
                    var bar = $(".progress-bar", this),
                        text = $(".progress-text", this),
                        optsFromExisting = {};
                    if (typeof options == "undefined") {
                        var barWidth = bar.clone().width(), // clone the element so we're working with a detached element, then get the detached element's width which won't be in px, it'll be the proper percentage
                            barText = text.text();
                        optsFromExisting.value = barWidth;
                        if (barText != null && barText != "") {
                            optsFromExisting.text = barText;
                        }
                    }
                    $el.data("options", $.extend({}, opts, optsFromExisting))
                       .data("bar", bar)
                       .data("text", text)
                       .trigger("updateProgressBar");
                } else {
                    $el.empty()
                       .data("options", opts)
                       .data("bar", $('<div class="progress-bar" style="width: ' + Math.max(0, Math.min(100, opts.value)) + '%;" />').appendTo(this))
                       .data("text", $('<div class="progress-text">' + opts.text + '</div>').appendTo(this));
                }
                if (!$el.hasClass("progress")) {
                    $el.addClass("progress");
                }
            });
        }
    };
    $.fn.progressBar.defaults = {
        value: 0,
        text: "&nbsp;"
    };
})(jQuery);;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/jquery/plugins/bamboo/cronbuilder.js' */
(function ($)
{
    /**
     * Creates a Cron builder on the page for a specific field.  The builder makes up two form components, the text display
     * (showing the pretty cron expression) and a hidden field (with the raw cron expression)
     * The value to be submitted can only be updated via the cron buidler dialog.
     *
     * USAGE
     * ------
     * Call against display field e.g:
     *
     *   AJS.$("#displayFieldId").cronBuilder({});
     *
     * Arguments (all required)
     *
     * opts {
     *  hiddenFieldSelector:    selector for the field that will be submited as part of the form (usually a hidden field)
     *  dialogTrigger:          html for the cron builder trigger
     *  eventNamespace:         unique namespace for this dialog click event
     *  contextPath:            context path for bamboo instance (used when generating urls;)
     *  dialogSubmitButtonText: text for the dialog submit button
     *  dialogHeadingText:      text for the dialog heading
     * }
     });
     */
    $.fn.cronBuilder = function (opts)
    {
        return this.each(function ()
                         {
                             var $this = $(this),
                                     initialCron = $(opts.hiddenFieldSelector).val(),
                                     $dialogTrigger = $(opts.dialogTrigger),

                                     addCronExpression = function (result)
                                     {
                                         //update fields
                                         $(opts.hiddenFieldSelector).val(result.cronExpression);
                                         $this.text(result.prettyCronExpression);

                                         // need to remove the old dialog and reattach with the new cron expression as the arg.
                                         $($dialogTrigger).unbind("click." + opts.eventNamespace);
                                         attachCronDialog(result.cronExpression);
                                     },

                                     attachCronDialog = function (cron)
                                     {
                                         simpleDialogForm($dialogTrigger, opts.contextPath + "/ajax/editCronExpression.action?cronExpression=" + encodeURIComponent(cron),
                                                          620, 480, opts.dialogSubmitButtonText, "ajax", addCronExpression, null, opts.dialogHeadingText, opts.eventNamespace);
                                     };

                             // generate pretty string
                             $.get(opts.contextPath + "/ajax/getPrettyCronExpression.action?cronExpression=" + encodeURIComponent(initialCron), function (result)
                             {
                                 $this.text(result.prettyCronExpression);
                             });

                             // add the link to the right spot - needed cause it avoids playing with the form templates.
                             $dialogTrigger.insertAfter($this);

                             attachCronDialog(initialCron);
                         });

    };

    /**
     * Replaces an element containing a cron expression with the pretty version of that expression.
     *
     * Usage:  e.g. AJS.$("#element").cronBuilder(${req.contextPath});
     *
     */
    $.fn.cronDisplay = function (contextPath)
    {
        return this.each(function ()
                         {
                             var $this = $(this),
                                     cron = $this.text();

                             // generate pretty string
                             $.get(contextPath + "/ajax/getPrettyCronExpression.action?cronExpression=" + encodeURIComponent(cron), function (result)
                             {
                                 $this.text(result.prettyCronExpression);
                             });
                         });
    };
})(jQuery);;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/jquery/plugins/bamboo/reload-image.js' */
(function ($) {
    $.fn.reloadImage = function (options) {
        var defaults = {
            text: "Reload image",
            cssClass: "image-reload"
        };
        var opts = $.extend(defaults, options);

        return this.each(function () {
            var $this = $(this);
            $('<span class="' + opts.cssClass + '" title="' + opts.text + '" />').insertAfter($this).click(function (e) {
                var src = $this.attr("src"),
                    pos = src.indexOf("&v="),
                    date = new Date();
                if (pos >= 0) {
                    src = src.substr(0, pos);
                }
                $this.attr("src", src + "&v=" + date.getTime());
                e.preventDefault();
            });
        });
    }
})(jQuery);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/build-decorator.js' */
(function ($, BAMBOO) {
    BAMBOO.BUILDRESULT = {};
    BAMBOO.PLAN = {};

    BAMBOO.BUILDRESULT.StatusRibbon = function (opts) {
        var defaults = {
                ribbonSelector: null,
                key: null,
                progressBarContainerSelector: '.status-ribbon-progress-bar'
            },
            options = $.extend(true, defaults, opts),
            isJobResult,
            $ribbon,
            $progressBar,
            $buildingForText,
            updateProgressBar = function (progress) {
                var progressPercentage = Math.ceil(100 - (progress['percentageCompleted'] * 100));
                if (!$progressBar.length) {
                    $progressBar = $('<div />', { id: 'sr-pb-' + options.key }).progressBar().appendTo($ribbon.find(options.progressBarContainerSelector));
                    $ribbon.trigger('createprogressbar.buildresult', [ progress ]);
                }
                if (progressPercentage < $progressBar.progressBar('option', 'value')) { // this progress bar works backwards
                    $progressBar.progressBar('option', 'value', progressPercentage);
                }
                updateBuildTime(progress[(progress['averageBuildDuration'] > 0 ? 'prettyTimeRemaining' : 'prettyBuildTime')], { prefix: '&ndash; ' });
                $ribbon.trigger('updateprogressbar.buildresult', [ progress ]);
                if (progressPercentage > 0)
                {
                    Piecon.setOptions({fallback: 'force'});
                    Piecon.setProgress(100 - progressPercentage);
                }
                else
                {
                    Piecon.reset();
                }
            },
            updateBuildTime = function (time, options) {
                options || (options = {});
                var prefix = options['prefix'] || '';
                var suffix = options['suffix'] || '';

                if (!$buildingForText.length) { return; }
                if (time) {
                    $buildingForText.text(time + suffix).prepend(prefix).show();
                } else {
                    $buildingForText.hide();
                }
            },
            res = {
                refresh: function (e, json) {
                    var progress, stages = json['stages']['stage'];

                    if (isJobResult) {
                        if (stages.length) {
                            for (var i = 0, ii = stages.length; i < ii && !progress; i++) {
                                var jobs = stages[i]['results']['result'];

                                for (var j = 0, jj = jobs.length; j < jj; j++) {
                                    var job = jobs[j];

                                    if (job['key'] == options.key) {
                                        progress = job['progress'];
                                        if (job['queued']) {
                                            updateBuildTime(job['prettyQueuedTime']);
                                        } else if (job['updatingSource']) {
                                            updateBuildTime(job['prettyVcsUpdateDuration']);
                                        } else if (progress) {
                                            updateProgressBar(progress);
                                        }
                                        break;
                                    }
                                }
                            }
                        }
                    } else {
                        progress = json['progress'];
                        if (!progress['buildTime']) {
                            updateBuildTime(json['prettyQueuedTime']);
                        } else {
                            updateProgressBar(progress);
                        }
                    }
                }
            };

        $(function () {
            $ribbon = $(options.ribbonSelector);
            $progressBar = $ribbon.find('.progress');
            $buildingForText = $ribbon.find('.operation-time');
            isJobResult = $ribbon.hasClass('has-job');
            $(document).bind('update.buildresult', res.refresh);
        });

        return res;
    };

    BAMBOO.BUILDRESULT.PlanNavigator = function (opts) {
        var defaults = {
                planNavigatorSelector: null,
                key: null
            },
            options = $.extend(true, defaults, opts),
            $planNavigator,
            $stageElements,
            hiddenClass = 'collapsed',
            updateIcon = function ($icon, iconType) {
                var fullIconType = 'icon-' + iconType;

                if (!$icon.hasClass(fullIconType)) {
                    $icon.attr('class', 'icon ' + fullIconType);
                }
            },
            togglePlanNav = function () {
                if ($planNavigator.parent().hasClass(hiddenClass)) {
                    $planNavigator.parent().removeClass(hiddenClass);
                    $(this).attr('title', "Hide");
                } else {
                    $planNavigator.parent().addClass(hiddenClass);
                    $(this).attr('title', "Show");
                }
            },
            addPlanNavToggle = function () {
                $('<button />', { title: ($planNavigator.parent().hasClass(hiddenClass) ? "Show" : "Hide"), id: 'plan-nav-toggle', click: togglePlanNav }).insertAfter($planNavigator);
            },
            res = {
                refresh: function (e, json) {
                    var jobs = [], stages = json['stages']['stage'];

                    if (stages.length) {
                        for (var i = 0, ii = stages.length, k = stages[0].index; i < ii; i++, k++) {
                            var stage = stages[i],
                                $stageElement = $($stageElements[k]),
                                $stageIcon = $('.stageIcon', $stageElement);

                            jobs = jobs.concat(stage['results']['result']);
                            if (stage['isBuilding']) {
                                $stageElement.removeClass('Pending').addClass('InProgress');
                                if ($stageIcon.length) {
                                    updateIcon($stageIcon, 'stage-InProgress stageIcon');
                                }
                            } else if (stage['isCompleted']) {
                                $stageElement.removeClass('Pending InProgress').addClass(stage['isSuccessful'] ? 'Successful' : 'Failed');
                                if ($stageIcon.length) {
                                    updateIcon($stageIcon, stage['isSuccessful'] ? 'stage-Successful stageIcon' : 'stage-Failed stageIcon');
                                }
                            } else {
                                $stageElement.addClass('Pending');
                                if ($stageIcon.length) {
                                    updateIcon($stageIcon, 'stage-Pending stageIcon');
                                }
                            }
                        }
                        for (var j = 0, jj = jobs.length; j < jj; j++) {
                            var job = jobs[j],
                                $job = $('#job-' + job['key']),
                                $icon = $job.find('.aui-icon, .icon'),
                                $progress = $job.find('.progress'),
                                progressPercentage;

                            $job.trigger('updatejob.buildresult', [ job ]);
                            
                            if (job['finished']) {
                                updateIcon($icon, job['state']);
                                if ($progress.length) {
                                    $progress.remove();
                                }
                            } else if (job['progress'] && !job['queued']) {
                                progressPercentage = Math.ceil(100 - (job['progress']['percentageCompleted'] * 100));
                                updateIcon($icon, 'InProgress');
                                if (!$progress.length) {
                                    $progress = $('<div />', { id: 'navPb' + job['key'] }).progressBar().prependTo($job);
                                }
                                if (progressPercentage < $progress.progressBar('option', 'value')) { // this progress bar works backwards
                                    $progress.progressBar('option', 'value', progressPercentage);
                                }
                            } else {
                                updateIcon($icon, 'Queued');
                            }
                        }
                    }
                }
            };

        $(function () {
            $planNavigator = $(options.planNavigatorSelector);
            $stageElements = $planNavigator.find("> ul > li");
            addPlanNavToggle();
            $(document).bind('update.buildresult', res.refresh);
        });

        return res;
    };

    BAMBOO.BUILDRESULT.BuildResult = (function () {
        var opts = {
                currentKey: null,
                getStatusUrl: null,
                jobStatus: null,
                isActive: false,
                ribbonSelector: '#status-ribbon'
            },
            planNavigator,
            statusRibbon,
            getJobStatus = function (job) {
                if (job['finished']) {
                    return job['state'];
                } else if (job['waiting']) {
                    return "Pending";
                } else if (job['progress'] && !job['queued']) {
                    if (job['updatingSource']) {
                        return "updatingSource";
                    } else {
                        return "InProgress";
                    }
                } else {
                    return "Queued";
                }
            },
            updateTimeout,
            update = function () {
                $.ajax({
                    url: opts.getStatusUrl,
                    cache: false,
                    data: {
                        expand: "stages.stage.results.result"
                    },
                    dataType: "json",
                    contentType: "application/json",
                    success: function (json) {
                        if (json['finished']) {
                            reloadThePage();
                            return;
                        }

                        $(document).trigger('update.buildresult', [ json ]);

                        // Update again in 5 seconds
                        updateTimeout = setTimeout(update, 5000);
                    },
                    error: function (XMLHttpRequest) {
                        // 404 for status means either no such result key exists OR build is not executing
                        // both cases are a good reason to reload, otherwise just wait
                        if (XMLHttpRequest.status == 404) {
                            reloadThePage();
                            return;
                        }
                        // Error occurred when doing the update, try again in 30 sec
                        updateTimeout = setTimeout(update, 30000);
                    }
                });
            },
            refreshDetails = function (e, progress) {
                if (progress) {
                    $(".started + dd > time").attr("datetime", progress['startedTimeFormatted']).html(progress['startedTime'] + ' &ndash; <span>' + progress['prettyStartedTime'] + '</span>');
                }
            },
            onJobUpdated = function (e, job) {
                if (opts.jobStatus && job['key'] == opts.currentKey && opts.jobStatus != getJobStatus(job)) {
                    reloadThePage();
                }
            };

        return {
            init: function (options) {
                $.extend(true, opts, options);

                if ($.browser.msie && parseInt($.browser.version, 10) <= 8) {
                    $(function () {
                        $(opts.ribbonSelector).prepend('<span class="before"></span>').append('<span class="after"></span>');
                    });
                }

                planNavigator = new BAMBOO.BUILDRESULT.PlanNavigator({ planNavigatorSelector: '#plan-navigator', key: opts.currentKey });

                if (opts.isActive) {
                    $(document)
                        .bind('updateprogressbar.buildresult', refreshDetails)
                        .bind('updatejob.buildresult', onJobUpdated)
                        .bind('createprogressbar.buildresult', function () { reloadThePage(); }); // TODO: Remove this when we can update the build results page dynamically without needing to refresh manually

                    statusRibbon = new BAMBOO.BUILDRESULT.StatusRibbon({ ribbonSelector: opts.ribbonSelector, key: opts.currentKey });

                    update();
                }
            }
        }
    }());

    BAMBOO.PLAN.LinkedJiraIssueDescription = (function (opts) {
        var options = $.extend(true, {
                planKey: null,
                issueSelector: '.plan-description'
            }, opts),
            $description = $(options.issueSelector),
            issueKey = $description.data('jiraIssueKey'),
            keyLink = AJS.contextPath() + '/project/jiraRedirect.action?jiraIssueKey=' + issueKey,
            remoteJiraLinkRequired = $description.data('remoteJiraLinkRequired');

        $(bamboo.feature.jiraIssueList.singleIssueLoading({
            key: issueKey,
            keyLink: keyLink
        })).appendTo($description);
        $.ajax({
            url: AJS.contextPath() + '/rest/api/latest/plan/' + options.planKey + '/issue/' + issueKey,
            cache: false,
            dataType: 'json'
        }).done(update).fail(error);

        function update(issue, textStatus, jqXHR) {
            var summary = issue['summary'];

            if (summary) {
                $description.html(bamboo.feature.jiraIssueList.singleIssue(issue));
                if (remoteJiraLinkRequired) {
                    showRemoteJiraLinkButton();
                }
            } else {
                error(jqXHR);
            }
        }
        function error(jqXHR) {
            var response, authUrl, authInstance;

            try {
                response = $.parseJSON(jqXHR.responseText);
                authUrl = response['authenticationRedirectUrl'];
                authInstance = response['authenticationInstanceName'] || "JIRA";
            }
            catch (e) {}
            if (authUrl) {
                $description.html(bamboo.feature.jiraIssueList.singleIssueOAuth({
                    key: issueKey,
                    keyLink: keyLink,
                    authenticationRedirectUrl: authUrl + '&redirectUrl=' + encodeURIComponent(document.location.href),
                    authenticationInstanceName: authInstance
                }));
            } else {
                $description.html(bamboo.feature.jiraIssueList.singleIssueRetrievalError({
                    key: issueKey,
                    keyLink: keyLink
                }));
            }
        }
        function showRemoteJiraLinkButton() {
            var disabledProperty = 'aria-disabled',
                $button = $('<button/>', { 'class': 'aui-button aui-style', text: "Create link in JIRA" }).click(initiateLink).insertAfter($description),
                $icon = $(widget.icons.icon({ type: 'loading' }));

            function initiateLink() {
                if (!$button.attr(disabledProperty)) {
                    $button.attr(disabledProperty, true).append($icon);

                    $.ajax({
                        url: AJS.contextPath() + '/ajax/createRemoteIssueLink.action',
                        cache: false,
                        dataType: 'json',
                        type: 'POST',
                        data: {
                            planKey: options.planKey,
                            issueKey: issueKey
                        }
                    }).done(linkCreated).fail(linkFailed);
                }
            }
            function linkCreated(response, textStatus, jqXHR) {
                if (response['status'] == "ERROR") {
                    linkFailed(jqXHR);
                } else {
                    $icon.replaceWith(widget.icons.icon({ type: 'tick-agent' }));
                    setTimeout(function () {
                        $button.fadeOut(function () { $(this).remove(); });
                    }, 1500);
                }
            }
            function linkFailed(jqXHR) {
                var response, authUrl, authInstance, authMessage, errors;

                try {
                    response = $.parseJSON(jqXHR.responseText);
                    errors = response['errors'];
                    authUrl = response['authorisationURI'];
                    authInstance = response['context'] || "JIRA";
                    authMessage = response['message'];
                }
                catch (e) {}

                if (authUrl) {
                    showMessageDialog(authMessage, BAMBOO.buildAUIMessage([ bamboo.feature.jiraIssueList.linkedIssueOAuth({
                        authenticationRedirectUrl: authUrl + '&redirectUrl=' + encodeURIComponent(document.location.href),
                        authenticationInstanceName: authInstance,
                        reason: 'in order to create a remote issue link'
                    }) ], 'warning', { escapeTitle: false }));
                } else {
                    if (!errors || !errors.length) {
                        errors = [ "Unable to link JIRA issue to branch" ];
                    }
                    showMessageDialog("Error while linking JIRA issue to branch", BAMBOO.buildAUIErrorMessage(errors));
                }
                $button.removeAttr(disabledProperty);
                $icon.remove();
            }
            function showMessageDialog(title, content) {
                var dialog = new AJS.Dialog({
                    width: 600
                }).addHeader(title).addPanel('', content).addButton("Close", function () { dialog.remove(); });

                dialog.show().updateHeightProperly();
            }
        }
    });
}(jQuery, window.BAMBOO = (window.BAMBOO || {})));;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/bamboo.js' */
//  ######
//  #     #  ######  #####   #####   ######   ####     ##     #####  ######  #####
//  #     #  #       #    #  #    #  #       #    #   #  #      #    #       #    #
//  #     #  #####   #    #  #    #  #####   #       #    #     #    #####   #    #
//  #     #  #       #####   #####   #       #       ######     #    #       #    #
//  #     #  #       #       #   #   #       #    #  #    #     #    #       #    #
//  ######   ######  #       #    #  ######   ####   #    #     #    ######  #####

// Constants
var BAMBOO_DASH_DISPLAY_TOGGLES = "bamboo.dash.display.toggles",
    BAMBOO_EVENT_ON_DASHBOARD_RELOADED = "BAMBOO_EVENT_ON_DASHBOARD_RELOADED";

window.BAMBOO = (window.BAMBOO || {});
BAMBOO.fastServerPollMillis = 5000;
BAMBOO.mediumServerPollMillis = 10000; // This polling interval is only used in one place. Should we replace it with fastServerPoll or slowServerPoll?
BAMBOO.slowServerPollMillis = 15000;
BAMBOO.afterErrorServerPollMillis = 30000;
BAMBOO.reloadDashboardTimeout = 20; // Seconds

//
// Display the given help page in a separate window
//
function openHelp(helpPage) {
    window.open(helpPage, 'manualPopup', 'width=770,height=550,scrollbars=yes,status=yes,resizable=yes');
}

function reloadThePage() {
    window.location.reload(true);
}

function redirectAfterReturningFromDialog(response) {
    if (response.redirectUrl) {
        window.location = AJS.contextPath() + response.redirectUrl;
    } else {
        reloadThePage();
    }
}

function isDefinedObject(reference) {
    return (typeof reference !== "undefined") && (reference !== null);
}

if (!jQuery.isNumeric) {
    jQuery.isNumeric = function (n) {
        return !isNaN(parseFloat(n)) && isFinite(n);
    };
}

/**
 * Any href clicked with rel=help (e.g. our help bubbles) will open in new window.
 * Any element with id=addPlanLabel will trigger the edit labels dialog
 * Applies to all of Bamboo.
**/
AJS.$(document).delegate("a[rel~='help']", "click", function (e) {
    var $this = AJS.$(this);
    e.preventDefault();
    if ($this.data('useHelpPopup')) {
        openHelp(this.href);
    } else {
        window.open(this.href);
    }
});


/**
 * Workaround for Cancel links in Dialog which append a hash to URL by default
 */
AJS.$("a.button-panel-link[href='#']").live("click", function (e) {
    e.preventDefault();
});

/**
 * AJS.BambooDialog
 */
AJS.BambooDialog = function(options, onSubmitCallback, onCancelCallback) {
    var dialog;
    options = options || {};
    options = jQuery.extend({}, options, {
        keypressListener: function(e) {
            if (e.which == jQuery.ui.keyCode.ESCAPE) {
                 if (isDefinedObject(onCancelCallback)) {
                     onCancelCallback(dialog);
                 } else {
                     dialog.remove();
                 }
            } else if (e.which == jQuery.ui.keyCode.ENTER && isDefinedObject(onSubmitCallback)) {
                onSubmitCallback(dialog);
                if (options.submitMode && options.submitMode == "ajax") {
                    e.preventDefault();
                }
            }
        }
    });
    dialog = new AJS.Dialog(options);
    return dialog;
};
AJS.Dialog.prototype.addHelpText = function (template, args) {
    if (!template) {
        // Don't do anything if there is no text to add.
        // This stops us printing 'undefined'.
        return;
    }

    var text = template;
    if (args) {
        text = AJS.template(template).fill(args).toString();
    }

    var page = this.page[this.curpage];
    if (!page.buttonpanel) {
        page.addButtonPanel();
    }

    // The text may include html i.e. links or strongs
    var tip = AJS.$("<div class='dialog-tip'></div>").html(text);
    page.buttonpanel.append(tip);
    tip.find("a").click(function() {
        window.open(this.href, '_blank').focus();
        return false;
    });
};
AJS.Dialog.prototype.updateHeightProperly = function () {
    this.updateHeight();
    this.getCurrentPanel().body.css('height', '');
};

String.prototype.replaceAll = function(pcFrom, pcTo) {
    var MARKER = "js___bmbo_mrk",
        i = this.indexOf(pcFrom),
        c = this;
    while (i > -1) {
        c = c.replace(pcFrom, MARKER);
        i = c.indexOf(pcFrom);
    }

    i = c.indexOf(MARKER);
    while (i > -1) {
        c = c.replace(MARKER, pcTo);
        i = c.indexOf(MARKER);
    }

    return c;
};


if (!jQuery.generateId) {
  jQuery.generateId = function() {
    return arguments.callee.prefix + arguments.callee.count++;
  };
  jQuery.generateId.prefix = 'jq-';
  jQuery.generateId.count = 0;

  jQuery.fn.generateId = function() {
    return this.each(function() {
      this.id = jQuery.generateId();
    });
  };
}

// Cookie handling functions

function saveToConglomerateCookie(cookieName, name, value)
{
    var cookieValue = getCookieValue(cookieName);
    cookieValue = addOrAppendToValue(name, value, cookieValue);

    saveCookie(cookieName, cookieValue, 365);
}

function readFromConglomerateCookie(cookieName, name, defaultValue)
{
    var cookieValue = getCookieValue(cookieName);
    var value = getValueFromCongolmerate(name, cookieValue);
    if (value != null)
    {
        return value;
    }

    return defaultValue;
}

function getValueFromCongolmerate(name, cookieValue)
{
    // a null cookieValue is just the first time through so create it
    if (cookieValue == null)
    {
        cookieValue = "";
    }
    var eq = name + "-";
    var cookieParts = cookieValue.split('|');
    for (var i = 0; i < cookieParts.length; i++)
    {
        var cp = cookieParts[i];
        while (cp.charAt(0) == ' ')
        {
            cp = cp.substring(1, cp.length);
        }
        // rebuild the value string exluding the named portion passed in
        if (cp.indexOf(name) == 0)
        {
            return cp.substring(eq.length, cp.length);
        }
    }
    return null;
}

//either append or replace the value in the cookie string
function addOrAppendToValue(name, value, cookieValue)
{
    var newCookieValue = "";
    // a null cookieValue is just the first time through so create it
    if (cookieValue == null)
    {
        cookieValue = "";
    }

    var cookieParts = cookieValue.split('|');
    for (var i = 0; i < cookieParts.length; i++)
    {
        var cp = cookieParts[i];

        // ignore any empty tokens
        if (cp != "")
        {
            while (cp.charAt(0) == ' ')
            {
                cp = cp.substring(1, cp.length);
            }
            // rebuild the value string exluding the named portion passed in
            if (cp.indexOf(name) != 0)
            {
                newCookieValue += cp + "|";
            }
        }
    }

    // always append the value passed in if it is not null or empty
    if (value != null && value != '')
    {
        var pair = name + "-" + value;
        if ((newCookieValue.length + pair.length) < 4020)
        {
            newCookieValue += pair;
        }
    }
    return newCookieValue;
}

function getCookieValue(name, defaultString)
{
    var eq = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++)
    {
        var c = ca[i];
        while (c.charAt(0) == ' ')
        {
            c = c.substring(1, c.length);
        }
        if (c.indexOf(eq) == 0)
        {
            return c.substring(eq.length, c.length);
        }
    }

    return defaultString;
}

function saveCookie(name, value, days)
{
    var ex;
    if (days)
    {
        var d = new Date();
        d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
        ex = "; expires=" + d.toGMTString();
    }
    else
    {
        ex = "";
    }
    document.cookie = name + "=" + value + ex + ";path=" + (!AJS.contextPath().length ? "/" : AJS.contextPath());
}

function toggleOn(e, toggleGroup_id)
{
    var onToggle = document.getElementById(toggleGroup_id + "_toggler_on");
    var offToggle = document.getElementById(toggleGroup_id + "_toggler_off");
    var target = document.getElementById(toggleGroup_id + "_target");
    onToggle.style.display = 'block';
    offToggle.style.display = 'none';
    target.style.display = 'block';
    saveToConglomerateCookie(BAMBOO_DASH_DISPLAY_TOGGLES, toggleGroup_id, null);
}

function toggleOff(e, toggleGroup_id)
{
    var onToggle = document.getElementById(toggleGroup_id + "_toggler_on");
    var offToggle = document.getElementById(toggleGroup_id + "_toggler_off");
    var target = document.getElementById(toggleGroup_id + "_target");
    onToggle.style.display = 'none';
    offToggle.style.display = 'block';
    target.style.display = 'none';
    saveToConglomerateCookie(BAMBOO_DASH_DISPLAY_TOGGLES, toggleGroup_id, '0');
}

function restoreTogglesFromCookie(toggleGroup_id)
{
    var elem = document.getElementById(toggleGroup_id + "_target");
    if (elem)
    {
        if (readFromConglomerateCookie(BAMBOO_DASH_DISPLAY_TOGGLES, toggleGroup_id, null) == '0')
        {
            toggleOff(null, toggleGroup_id);
        }
        else
        {
            toggleOn(null, toggleGroup_id);
        }
    }
}

// Forms JS
function toggleContainingCheckbox(e)
{
    if (e && e.target.tagName == "INPUT")
    {
        return true;
    }

    AJS.$(this).find("input:checkbox").each(function(){
        this.checked = !this.checked;
    });

    return true;
}

function toggleIconOff(dom)
{
    dom.src = dom.src.replace('_on.', '_off.');
}

function toggleIconOn(dom)
{
    dom.src = dom.src.replace('_off.', '_on.');
}

/*
*   For user picker - when you click "Check All' all the select boxes are changed
*/
    var selectedBoxes = [];

    function setCheckboxes()
    {
        var numelements = document.selectorform.elements.length;
        var item0 = document.selectorform.elements[0];
        var item1;

        for (var i=1 ; i < numelements ; i++)
        {
            item1 = document.selectorform.elements[i];
            item1.checked = item0.checked;
            if (!selectedBoxes[item1.name])
                selectedBoxes[item1.name] = [];
            selectedBoxes[item1.name][item1.value] = item1.checked;
        }
    }

/*
*  For User Picker - checkboxes are named after users so by compiling a list of all selected checkboxes
*   we have a list of users (comma seperated)
*/
    function getEntityNames()
    {
        var numelements = document.selectorform.elements.length;
        var item;
        var checkedList = "";

        var sep = "";
        for (var i = 0 ; i < numelements ; i++)
        {
            item = document.selectorform.elements[i];
            if (item != null && item.type == "checkbox" && item.name != "all" && item.checked == true)
            {
                var itemValue = item.value;
                itemValue = itemValue.replace(/\\/g, "\\\\").replace(/,/g, "\\,");
                checkedList  = checkedList + sep + itemValue;
                sep = ", ";
            }
        }

        return checkedList;
    }

/*
*   For User Picker - takes comma seperated list of users and places them in specified field.
*/
   function addUsers(commaDelimitedUserNames, fieldID, multiSelect)
    {
        var element = document.getElementById(fieldID);
        var currentUsers = element.value;
        if (!multiSelect) {
            element.value = commaDelimitedUserNames;
        } else if (currentUsers != null && currentUsers != ""){
            element.value = currentUsers + ", " + commaDelimitedUserNames;
        } else {
            element.value = commaDelimitedUserNames;
        }
    }

function updatePlan(plan, toHide, toShow)
{
    var STATUS_PREFIX = 'statusSection';
    var REASON_PREFIX = 'reasonSummary';
    var DURATION_PREFIX = 'durationSummary';
    var LAST_BUILT = 'lastBuiltSummary';
    var TESTCOUNT_PREFIX = 'testSummary';
    var LATEST_BUILD_PREFIX = 'latestBuild';
    var PLAN_PROPS = [LATEST_BUILD_PREFIX, REASON_PREFIX, DURATION_PREFIX, TESTCOUNT_PREFIX, LAST_BUILT];

    try
    {
        var planKey = plan.planKey;

        //the following for loops have len initialised as such for improved performance
        for (var i = 0, len = PLAN_PROPS.length; i < len; i++)
        {
            var propPrefix =  PLAN_PROPS[i];
            var elem = AJS.$("#" + propPrefix + planKey);
            if (LATEST_BUILD_PREFIX == propPrefix)
            {
                // Update the status when first item and clear the existing classes on this element

                elem.closest(".planKeySection").attr('class', 'planKeySection ' + plan.statusClass);
            }
            elem.html(plan[propPrefix]);
        }

        var iconClass = {
            'icon-disabled': 'aui-icon aui-icon-small aui-iconfont-devtools-task-disabled',
            'icon-queued': 'aui-icon aui-icon-small aui-iconfont-devtools-task-in-progress',
            'icon-successful': 'aui-icon aui-icon-small aui-iconfont-approve',
            'icon-failed': 'aui-icon aui-icon-small aui-iconfont-error',
            'icon-notbuilt': 'aui-icon aui-icon-small aui-iconfont-devtools-task-cancelled'
        }[plan.statusIconClass] || 'icon ' + plan.statusIconClass;

        AJS.$("#" + STATUS_PREFIX + planKey).find(".icon, .aui-icon").each(function(){
            if (!AJS.$(this).hasClass(plan.statusIconClass)){
                AJS.$(this).removeAttr('class').addClass(iconClass).attr("title", plan.statusText);
            }
        });

        //Update link
        var link = AJS.$("a#" + STATUS_PREFIX + planKey);
        if (link.length) {
            if (plan.lastResultKey != null) {
                link.attr("href", AJS.contextPath() + "/browse/" + plan.lastResultKey);
            } else {
                link.attr("href", AJS.contextPath() + "/browse/" + planKey);
            }
        }

        // Update favourites
        var faves = AJS.$('#favouriteIconFor_' + planKey);
        for (var i = 0, len = faves.length; i < len; i++)
        {
            var fave = faves.get(i);
            if (plan.favourite)
            {
                toggleIconOn(fave);
            }
            else
            {
                toggleIconOff(fave);
            }
        }

        if (plan.suspendedFromBuilding) {
            toShow.push('#resumeBuild_' + planKey);
            toHide.push( '#stopSingleBuild_' + planKey, '#stopMultipleBuilds_' + planKey, '#manualBuild_' + planKey);
        } else {
            toHide.push('#resumeBuild_' + planKey);
            if (plan.allowStop) {
                toHide.push('#manualBuild_' + planKey);
                if (plan.numberOfCurrentlyBuildingPlans > 1) {
                    toHide.push('#stopSingleBuild_' + planKey);
                    toShow.push('#stopMultipleBuilds_' + planKey);
                } else {
                    toShow.push('#stopSingleBuild_' + planKey);
                    toHide.push('#stopMultipleBuilds_' + planKey);
                }
            } else {
                toHide.push('#stopSingleBuild_' + planKey, '#stopMultipleBuilds_' + planKey);
                toShow.push('#manualBuild_' + planKey);
            }
        }
    } catch(ex) {
        //alert(ex);
        console.warn(ex);
    }
}

function updatePlans(sinceSystemTime) {
    // Make the call to the server for JSON data
    if (!sinceSystemTime) sinceSystemTime = 0;

    var $showMoreTrigger = AJS.$(".show-more-plans");
    var lastProjectKey = $showMoreTrigger.length ? $showMoreTrigger.data("lastProjectKey") : "";

    // Define the callbacks for the asyncRequest
    var timeout,
        panelId = 'dashboardUpdatePlans',
        callbacks = {
            dataType: 'json',
            url:AJS.contextPath() + "/ajax/viewPlanUpdates.action",
            data: { sinceSystemTime: sinceSystemTime,
                    lastProject: lastProjectKey
            },
            success : function (response) {
                if (!BAMBOO.reloadDashboard) return; // do nudda

                // Process the JSON data returned from the server
                try {
                    if (response.plans) {
                        var plans = response.plans,
                            toHide = [], toShow = [];
                        //Using toHide/toShow arrays here and deferring hide/show improved performance 20x,
                        //do not change it without heavy performance testing (on 2000 top level plans) please
                        for (var i = 0, len = plans.length; i < len; i++) {
                            var plan = plans[i];
                            updatePlan(plan, toHide, toShow);
                        }
                        if (toHide.length) {
                            AJS.$(toHide.join(',')).hide();
                        }
                        if (toShow.length) {
                            AJS.$(toShow.join(',')).show();
                        }
                    }
                } catch (x) {
                    console.warn("JSON Parse failed! " + x + "\n", response);
                }

                sinceSystemTime = response ? response.currentTime : 0;

                BAMBOO.panelTimeouts[panelId] = setTimeout(function () { updatePlans(sinceSystemTime); }, BAMBOO.reloadDashboardTimeout * 1000);
                hideAjaxErrorMessage();
                AJS.$("body").trigger(BAMBOO_EVENT_ON_DASHBOARD_RELOADED);
            },
            error : function (XMLHttpRequest) {
                showAjaxErrorMessage(XMLHttpRequest);
            },
            timeout : 60000
        };

    if (typeof BAMBOO.panelTimeouts === "undefined") {
        BAMBOO.panelTimeouts = {};
    } else {
        timeout = BAMBOO.panelTimeouts[panelId];
        clearTimeout(timeout);
    }
    AJS.$.ajax(callbacks);
}

function reloadPanel(id, url, reloadEvery, loadScripts, previousText, callback) {
    var timeout;
    if (typeof BAMBOO.panelTimeouts === "undefined") {
        BAMBOO.panelTimeouts = {};
    } else {
        timeout = BAMBOO.panelTimeouts[id];
        clearTimeout(timeout);
    }
    AJS.$.get(processReloadUrl(url), function(data) {
        var reponseText = data;

        if (!document.getElementById(id)) { return false; } // don't bother updating if the target isn't available to update

        if (!previousText || previousText != reponseText) {
            // only update if the previous response is different
            updateDomObject(reponseText, id, loadScripts, callback);
        }
        if (reloadEvery) {
            BAMBOO.panelTimeouts[id] = setTimeout(function () { reloadPanel(id, url, reloadEvery, loadScripts, reponseText, callback); }, reloadEvery * 1000);
        }
    });
}

function processReloadUrl(url)
{
    if (BAMBOO.buildLastCurrentStatus)
    {
        var indexOfCurrentStatus = url.indexOf("&lastCurrentStatus");
        if (indexOfCurrentStatus != -1)
        {
            url = url.substring(0, indexOfCurrentStatus);
        }

        return url + "&lastCurrentStatus=" + BAMBOO.buildLastCurrentStatus;

    }
    else
    {
        return url;
    }
}

function updateDomObject(html, targetId, loadScripts, callback)
{
    if(typeof html == 'undefined'){
        html = '';
    }
    if(loadScripts !== true){
        AJS.$("#" + targetId).html(html);
        if (AJS.$.isFunction(callback))
        {
            AJS.$("#" + targetId).each(callback);
        }
        return;
    }
    var id = AJS.$.generateId();
    html += '<span id="' + id + '"></span>';

    AJS.$("#" + id).ready(function(){
        var hd = document.getElementsByTagName("head")[0];
        var re = /(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/img;
        var srcRe = /\ssrc=([\'\"])(.*?)\1/i;
        var match;
        while(match = re.exec(html)){
            var srcMatch = match[0].match(srcRe);
            if(srcMatch && srcMatch[2]){
                var s = document.createElement("script");
                s.src = srcMatch[2];
                hd.appendChild(s);
            }else if(match[1] && match[1].length > 0){
                eval(match[1]);
            }
        }
        var el = document.getElementById(id);
        if(el){el.parentNode.removeChild(el);}
    });
    var newHtml = html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/img, '');
    AJS.$("#" + targetId).html(newHtml);

    if (AJS.$.isFunction(callback))
    {
        AJS.$("#" + targetId).each(callback);
    }
    return;
}


function updateInlineSection(url, sectionName)
{
     AJS.$.get(processReloadUrl(url), function(data)
      {
          updateDomObject(data, sectionName, "true", "null");
      });
}


function addConfirmationToLinks() {
    AJS.$(document).on(
        'click',
        '.requireConfirmation',
        function(e) {
            var $el = AJS.$(this);
            var isConfirmed = confirm('Please confirm that you are about to \n' + ($el.attr("title") ? $el.attr("title") : AJS.$.trim($el.text())));
            if (isConfirmed && $el.hasClass("mutative")) {
                e.preventDefault();
                $el.trigger("clickMutativeLink");
            }
            return isConfirmed;
        }
    );
}

/**
 * Build queue related stuff
 */
var buildQueue = function()
{
    AJS.$(document).ready(function () {
        if (buildQueue) {
            buildQueue.portletReloadCallback();
        }
    });

    return {
        /**
         * Shows and hides Build Queue's action panels
         */
        displayActions : function(actionsId)
        {
            var prevActionsId = readFromConglomerateCookie(BAMBOO_DASH_DISPLAY_TOGGLES, "buildQueueActions", actionsId);
            AJS.$("#builders").removeClass(prevActionsId);
            AJS.$("#builders").addClass(actionsId);

            saveToConglomerateCookie(BAMBOO_DASH_DISPLAY_TOGGLES, "buildQueueActions", actionsId);
        },

        restoreDisplayActionsFromCookie : function()
        {
            this.displayActions(readFromConglomerateCookie(BAMBOO_DASH_DISPLAY_TOGGLES, "buildQueueActions", "actions-queueControl"));
        },

        portletReloadCallback : function()
        {
            buildQueue.restoreDisplayActionsFromCookie();
        }
    };
}();


function initCommitsTooltip(targetId, planKey, buildNumber)
{
    AJS.InlineDialog(AJS.$("#" + targetId),
                 targetId,
                 AJS.contextPath() + "/build/ajax/viewBuildCommits.action?buildKey=" + planKey + "&buildNumber=" + buildNumber,
                {onHover: true, fadeTime: 50, hideDelay: 0, showDelay: 100, width: 300, offsetX: 0,offsetY: 10});
}

function initCommentTooltip(targetId, planKey, buildNumber)
{
    var link = AJS.$("#" + targetId);
    AJS.InlineDialog(link,
             targetId,
             AJS.contextPath() + "/build/ajax/viewBuildComments.action?buildKey=" + planKey + "&buildNumber=" + buildNumber,
            {onHover: true, fadeTime: 50, hideDelay: 0, showDelay: 100, width: 300, offsetX: 0,offsetY: 10});
}

/**
 * This function is not mentioned to be used directly but rather via @dj.simpleDialogForm FTL macro defined in dojo.ftl
 *
 * All the input params are also described in the dojo.ftl
 */
function simpleDialogForm(triggerSelector, getDialogBodyUrl, dialogWidth, dialogHeight, submitLabel, submitMode, submitCallback, cancelCallback, header, eventNamespace)
{
    function clearAllErrors(formJQ)
    {
        formJQ.find('.error,.aui-message').remove();
    }

    function addActionError(formJQ, errors)
    {
        formJQ.find(".field-group:first").before(BAMBOO.buildAUIErrorMessage(errors));
    }

    function applyErrors(formJQ, result)
    {
        if (result.fieldErrors) {
            for (var fieldName in result.fieldErrors) {
                BAMBOO.addFieldErrors(formJQ, fieldName, result.fieldErrors[fieldName]);
            }
        }

        if (result.errors) {
            addActionError(formJQ, result.errors);
        }
    }

    /**
     * This is called where callee requests non-ajax submit.
     * 1st phase is to call validation via AJAX using form's action attribute and then submit form in a classical way.
     *
     * @param formJQ  form to be submitted
     */
    function validateSubmitForm(formJQ)
    {
        clearAllErrors(formJQ);

        function validationCallback(result)
        {
            if (result.status.toUpperCase() == "OK")
            {
                formJQ.submit();
            }
            else
            {
               applyErrors(formJQ, result);
            }
        }

        AJS.$.post(formJQ.attr("action"), formJQ.serialize() + '&bamboo.enableJSONValidation=true', validationCallback, "json");
    }

    /**
     * For Ajax submit there's no separate validation phase.
     * Assumption is made that action will validate itself and will return proper JSON response in case of validation errors.
     *
     * @param formJQ          jQuery wrapper for form
     * @param submitCallback
     */
    function ajaxSubmitForm(formJQ, submitCallback)
    {
        clearAllErrors(formJQ);

        function successCallback(result)
        {
            if (result.status.toUpperCase()  == "OK")
            {
                submitCallback(result);
            }
            else
            {
               applyErrors(formJQ, result);
            }
        }

         function errorCallback(result)
        {
            if (result.status == 500)
            {
                addActionError(formJQ, Array("An internal server error has occurred. Please check the logs for more details."));
            }
            else
            {
                addActionError(formJQ, Array("An unknown error has occurred."));
            }
        }

        AJS.$.ajax({
            type: "POST",
            url: formJQ.attr("action"),
            data: formJQ.serialize(),
            success: successCallback,
            error: errorCallback,
            dataType: "json"
        });
    }

    function showDialog(linkElementJQ) {
        var $loading = AJS.$('<span class="icon icon-loading aui-dialog-content-loading" />'),
            $dialogForm = AJS.$("<div id='simpleDialogForm'/>").html($loading),
            setFocus = function () {
                var $firstError = $dialogForm.find(":input:visible:enabled.errorField:first").focus();
                if (!$firstError.length) {
                    $dialogForm.find(":input:visible:enabled:first").focus();
                }
            },
            onSubmitCallback = function(dialog) {
                var formJQ = AJS.$("#simpleDialogForm form");

                if (submitMode == "ajax") {
                    ajaxSubmitForm(formJQ, function(result) {
                        if (AJS.$.isFunction(submitCallback)) {
                            submitCallback(result);
                        }
                        dialog.remove();
                        $dialogForm.html($loading);
                    });
                } else {
                    validateSubmitForm(formJQ);
                }
            },
            onCancelCallback = function(dialog) {
                if (AJS.$.isFunction(cancelCallback)) {
                    cancelCallback();
                }
                dialog.remove();
                $dialogForm.html($loading);
            },
            $popup = new AJS.BambooDialog({width: dialogWidth, height: dialogHeight, submitMode: submitMode}, onSubmitCallback, onCancelCallback);

        $popup.addHeader(header != null ? header : linkElementJQ.attr('title'))
              .addPanel("I am invisible", $dialogForm)
              .addCancel("Cancel", onCancelCallback);

        AJS.$.get(getDialogBodyUrl, function(data) {
            $dialogForm.html(data);
            $popup.addSubmit(submitLabel, onSubmitCallback);
            $popup.getPage(0).button[1].moveLeft();
            setFocus();
            BAMBOO.DynamicFieldParameters.syncFieldShowHide($dialogForm, false);
        });
        $popup.show();
    }

    if (triggerSelector) {
        var namespace = "click";
        if (eventNamespace && eventNamespace.length) {
            namespace += "." + eventNamespace;
        }
        AJS.$(triggerSelector).bind(namespace, function(e) {
            showDialog(AJS.$(this));
            //disable the default behaviour (we don't want link to be followed when we display dialog)
            e.preventDefault();
        });
    } else {
        showDialog(AJS.$(this));
    }

}

/**
 * Asynchronous form handler
 * @param options
 *  - target        String - selector targeting the form
 *  - success       Function - handles JSON response from successful form submission
 *  - cancel        Function - handles what to do when the cancel link is clicked
 *  - formReplaced  Function - is fired after the form is replaced
 *  - $delegator    jQuery Object - where the event handler should be bound
 */
BAMBOO.asyncForm = function (options) {
    var $ = AJS.$,
        defaults = {
            target: null,
            success: null,
            cancel: null,
            formReplaced: null,
            error: null,
            $delegator: $(document),
            resetOnSuccess: false,
            loadingIconInsertionMethod: 'prepend'
        },
        handleSubmit = function (e) {
            var $form = $(this),
                cancelOnClick = function (e) { e.stopPropagation(); };

            e.preventDefault();
            $form.ajaxSubmit({
                data: {
                    "bamboo.successReturnMode": "json",
                    decorator: "nothing",
                    confirm: true
                },
                dataFilter: function (data) { //data contains HTML or escaped JSON embedded in a script tag
                    var scriptTagContent;
                    if (!data.startsWith("<script")) {
                        return data;
                    }
                    scriptTagContent = data.substring(data.indexOf(">") + 1, data.lastIndexOf("</script"));
                    return scriptTagContent
                            .replaceAll("<\\!--", "<!--")
                            .replaceAll("<\\script", "<script")
                            .replaceAll("<\\/script", "</script")
                            .valueOf();
                },
                dataType: "html",
                beforeSerialize: function ($form, options) {
                    var fileInputs = $form.find('input:file').length > 0,
                        mp = 'multipart/form-data',
                        multipart = ($form.attr('enctype') == mp || $form.attr('encoding') == mp);

                    if (options.iframe !== false && (fileInputs || options.iframe || multipart)) {
                        this.data["bamboo.successReturnMode"] = "json-as-html";
                    }
                },
                beforeSubmit: function (formData, $form) {
                    $form
                        .find(".buttons")[options.loadingIconInsertionMethod]('<span class="icon icon-loading"/>')
                        .find('input:submit').prop('disabled', true).end()
                        .find('.cancel').addClass('disabled').on('click', cancelOnClick);
                },
                success: function (data) {
                    var $data, json, messages, warnings;

                    if (typeof data == "object") {
                        // Returned data is JSON
                        json = data;
                    } else {
                        // Returned data is string
                        try {
                            // Try to parse string as JSON
                            json = $.parseJSON(data);
                        }
                        catch (e1) {
                            // Must be HTML
                            $data = $(data);
                            try {
                                // Check if the response only contains a textarea, if so it probably just contains JSON
                                if ($data.length == 1 && !$data.children().length && $data.is("textarea")) {
                                    json = $.parseJSON($data[0].value);
                                }
                            }
                            catch (e2) {}
                        }
                    }

                    if (json) {
                        $form.trigger("asyncform-success", [ json ]);

                        messages = json['messages'];
                        warnings = json['warnings'];
                        if (messages || warnings) {
                            $form.trigger("asyncform-notification", [ messages, warnings ]);
                        }

                        if (options.resetOnSuccess) {
                            $form
                                .find(".buttons").find('.icon-loading').remove().end()
                                .find('input:submit').prop('disabled', false).end()
                                .find('.cancel').removeClass('disabled').off('click', cancelOnClick);
                        }

                        options.success(json);
                    } else if ($data) {
                        $form.trigger("asyncform-replaced", [ $data ]);
                        // Returned data isn't JSON, isn't JSON in a textarea, assume it's straight HTML
                        if (!$data.is("form")) {
                            // Should have been a form, probably IE stripping the form element, will just replace form contents instead
                            $form.html($data);
                        } else {
                            $form.replaceWith($data);
                        }
                        if ($.isFunction(options.formReplaced)) {
                            options.formReplaced($data);
                        }
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $form.trigger("asyncform-error", [ jqXHR, textStatus, errorThrown ]);
                    if ($.isFunction(options.error)) {
                        options.error(jqXHR, textStatus, errorThrown);
                    } else {
                        var $dummy = $('<div />'), $stackTrace;

                        try {
                            $stackTrace = $(jqXHR.responseText).filter('pre');
                        }
                        catch (e) {}

                        if (!$stackTrace || !$stackTrace.length) {
                            $stackTrace = $('<p/>', { text: errorThrown });
                        }

                        AJS.messages.error($dummy, { title: "An unexpected error has occurred", body: $stackTrace.wrap('<div/>').parent().html(), closeable: false });
                        $form.replaceWith($dummy.children());
                    }
                }
            });
        },
        handleCancel = function (e) {
            e.preventDefault();
            options.cancel(e);
        };

    options = $.extend(defaults, options);

    if ($.isFunction(options.success)) { // No point in an async form if there's no success callback to handle a successful post
        options.$delegator.undelegate(options.target, "submit.asyncform").delegate(options.target, "submit.asyncform", handleSubmit);
    }

    if ($.isFunction(options.cancel)) {
        options.$delegator.undelegate(options.target + " .cancel", "click.asyncform").delegate(options.target + " .cancel", "click.asyncform", handleCancel);
    }
};

/**
 * Handles form input in dialogs
 * @param options
 *  - trigger       String - selector targeting the element that triggers the popup
 *  - dialogWidth   Number - dialog width
 *  - dialogHeight  Number - dialog height
 *  - success       Function - handles JSON response from successful form submission
 *  - cancel        Function - handles what to do when the cancel link is clicked
 *  - header        String - header for the dialog
 */
BAMBOO.simpleDialogForm = function (options) {
    var defaults = {
        trigger: null,
        $trigger: null,
        dialogWidth: null,
        dialogHeight: null,
        success: null,
        cancel: null,
        header: null,
        help: null
    };
    options = AJS.$.extend(defaults, options);
    var $trigger = options.$trigger,
        $loading = AJS.$('<span class="icon icon-loading aui-dialog-content-loading" />'),
        $formContainer = AJS.$('<div class="aui-dialog-content"/>').html($loading),
        dialog,
        setFocus = function () {
            var $firstError = $formContainer.find(":input:visible:enabled.errorField:first").focus();
            if (!$firstError.length) {
                $formContainer.find(":input:visible:enabled:first").focus();
            }
        },
        setupDialogContent = function (html) {
            $formContainer.html(html);
            setupForm($formContainer.find("form"));
            BAMBOO.asyncForm({
                $delegator: $formContainer,
                target: "form",
                success: function (data) {
                    if (AJS.$.isFunction(options.success)) {
                        options.success(data);
                    }
                    dialog.remove();
                    $formContainer.html($loading);
                },
                cancel: function (e) {
                    e.preventDefault();
                    if (AJS.$.isFunction(options.cancel)) {
                        options.cancel(e);
                    }
                    dialog.remove();
                    $formContainer.html($loading);
                },
                formReplaced: setupForm
            });
        },
        setupForm = function ($dialogForm) {
            if (options.help) {
                addHelp();
            }
            setFocus();
            BAMBOO.DynamicFieldParameters.syncFieldShowHide($dialogForm, false);
        },
        showDialog = function () {
            dialog = new AJS.Dialog({
                width: options.dialogWidth,
                height: options.dialogHeight,
                keypressListener: function (e) {
                    if (e.which == jQuery.ui.keyCode.ESCAPE) {
                        dialog.remove();
                        $formContainer.html($loading);
                    }
                }
            });
            var header = options.header ? options.header : $trigger.attr("title");
            if (header) {
                dialog.addHeader(header);
            }
            dialog.addPanel("", $formContainer);

            // $trigger.attr("data-dialog-href") won't be needed once we're on jQuery 1.4.3
            AJS.$.ajax({
                url: $trigger.attr("href") || $trigger.data("dialog-href") ||  $trigger.attr("data-dialog-href"),
                data: { 'bamboo.successReturnMode': 'json', decorator: 'nothing', confirm: true },
                success: setupDialogContent,
                cache: false
            });

            dialog.show();
        },
        addHelp = function () {
            return AJS.$('<div />', {
                'class': 'dialog-tip',
                html: options.help
            }).prependTo($formContainer.find('.buttons-container'));
        };

    if (options.trigger) {
        var namespace = "click";
        if (options.eventNamespace && options.eventNamespace.length) {
            namespace += "." + options.eventNamespace;
        }
        AJS.$(document).undelegate(options.trigger, namespace);
        AJS.$(document).delegate(options.trigger, namespace, function (e) {
            $trigger = AJS.$(this);
            e.preventDefault();
            showDialog();
        });
    } else {
        showDialog();
    }
};

/**
 * Displays confirmation dialog that is consistent in style with simpleDialogForm but with content
 * generated without additional server request.
 */
function simpleConfirmationDialog(dialogWidth, dialogHeight, content, header, submitLabel, cancelLabel, onSubmit, onCancel) {
    var confirmDialog = new AJS.BambooDialog({width: dialogWidth, height: dialogHeight, submitMode: "ajax"}),
            doSubmit = function(dialog)
            {
                if (AJS.$.isFunction(onSubmit)) {
                    onSubmit();
                }
                dialog.remove();
            },
            doCancel = function(dialog)
            {
                if (AJS.$.isFunction(onCancel))
                {
                    onCancel();
                }
                dialog.remove();
            };
    confirmDialog.addHeader(header);

    // @TODO a workaround to some bug... We should revisit this post AUI 2.0 upgrade
    confirmDialog.addPanel("nothing", "nothing");
    confirmDialog.addButton(submitLabel, doSubmit);
    confirmDialog.addCancel(cancelLabel, doCancel);

    confirmDialog.getCurrentPanel().html("<div id='simpleDialogForm'>" + content + "</div>");
    confirmDialog.show();
}

/**
 * General checkbox tree utilities.
 */
var checkboxTree = function() {
    return {
        DONT_ENABLE_PARENT_ON_ALL_CHILDREN_ENABLED : 1 << 0,
        DISABLE_CHILDREN_ON_PARENT_CHECKED : 1 << 1,
        /**
         * Cascade state of a parent checkbox to collection of children checkboxes.
         * @param jqParent    parent checkbox (jQuery object)
         * @param jqChildren  children checkboxes (jQuery object)
         */
        cascadeToChildren : function(jqParent, jqChildren, options) {
            if (jqParent.is(":checked")) {
                jqChildren.attr("checked", "checked");
            } else {
                jqChildren.removeAttr("checked");
            }
            if (options & this.DISABLE_CHILDREN_ON_PARENT_CHECKED) {
                if (jqParent.is(":checked")) {
                    jqChildren.attr("disabled", "disabled");
                } else {
                    jqChildren.removeAttr("disabled");
                }
            }
        },

        /**
         * Propagate state of children checkboxes to parent checkbox.
         * @param jqParent    parent checkbox (jQuery object)
         * @param jqChildren  children checkboxes (jQuery object)
         * @param options     options that modify default behavior
         */
        propagateToParent : function(jqParent, jqChildren, options) {
            if (jqChildren.is(":not(:checked)")) {
                jqParent.removeAttr("checked");
            } else {
                if (!(options & this.DONT_ENABLE_PARENT_ON_ALL_CHILDREN_ENABLED))
                {
                    jqParent.attr("checked", "checked");
                }
            }
        }
    };
}();

function enableShowSnapshotsForMaven2Dependencies(showAllSelector, showOnlySnapshotsSelector, tableSelector, hasSnapshots)
{
    AJS.$(document).ready(function() {
        var showAllLink = AJS.$(showAllSelector);
        var showOnlySnapshotsLink = AJS.$(showOnlySnapshotsSelector);
        var table = AJS.$(tableSelector);

        showAllLink.click(function() {
            showOnlySnapshotsLink.show();
            showAllLink.hide();
            AJS.$('.gav-tbody-releases').show();
        });

        showOnlySnapshotsLink.click(function() {
            showAllLink.show();
            showOnlySnapshotsLink.hide();
            AJS.$('.gav-tbody-releases').hide();
        });

        if (hasSnapshots) {
            showOnlySnapshotsLink.click();
        } else {
            showAllLink.hide();
            showOnlySnapshotsLink.hide();
        }
    });
}

function addAliasSubmitCallback(result) {
    AJS.$("select.selectAlias").append(AJS.$("<option />", { text: result.aliasName, selected: "selected", val: result.aliasId }))
                               .val(result.aliasId);
}

/**
 * Checks if any forms on the page need a submit on change hook.
 */
AJS.$(function($){
    $(".submitOnChange").change(function(){ $(this).closest("form").submit(); });
});

/**
 * Current Activity screen
 */
var CurrentActivity = {
    // Default options
    options: {
        contextPath: null,
        getBuildsUrl: null,
        viewAgentUrl: null,
        reorderBuildUrl: null,
        stopBuildUrl: null,
        stopDeploymentUrl: null,
        manageElasticInstancesUrl: null,
        emptyQueueText: null,
        emptyBuildingText: null,
        cancellingBuildText: null,
        cancelBuildText: null,
        cancelDeploymentText: null,
        queueOutOfDateText: null,
        canBuildElastically: null,
        canBuildElasticallyAdmin: null,
        fetchingBuildData: null,
        hasAdminPermission: false,
        canManageElasticBamboo: false,
        caParent: null,
        buildingParent: null,
        queueParent: null,
        activityStream: null,
        agentSummary: null
    },
    updateTimeout: null, // ID of timeout which determines when the data will be next fetched from the server
    building: null, // jQuery object referring to the list holding the currently building builds (set on init)
    queue: null, // jQuery object referring to the list holding the queued builds (set on init)
    noBuilding: null, // jQuery object referring to the message shown when there are no currently building builds (set on init)
    noQueued: null, // jQuery object referring to the message shown when there are no queued builds (set on init)
    loadingBuilding: null, // jQuery object referring to the loading indicator shown while currently building data is being fetched the first time (set on init)
    loadingQueued: null, // jQuery object referring to the loading indicator shown while queue data is being fetched the first time (set on init)
    queueOutOfDate: null, // jQuery object referring to the message shown when the queue order has been updated remotely and is not reflected locally (set on init)
    updateTimestamp: null, // Timestamp (represented as milliseconds since the Unix epoch) that the builds were last updated
    isBeingSorted: false, // Is the queue currently being sorted?
    disabledStopHTML: '', // HTML to replace the stop button with if it's disabled (set on init)
    /**
     * Generates a nice, readable string of Agents that the Plan can build on
     * @param executableAgents - Array of Agent objects
     * @returns {String} A readable sentence containing the list of agents
     */
    generateBuildableAgentsText: function (executableAgents) {
        var agentNames = [];

        for (var i = 0; i < executableAgents.length; i++) {
            agentNames.push(executableAgents[i].name);
        }
        return "Can build on " + agentNames.join(", ");
    },
    generateListItem: function (queueItem) {
        if (queueItem.itemType == 'BUILD') {
            return CurrentActivity.generateBuildListItem(queueItem);
        }
        else {
            return CurrentActivity.generateDeploymentListItem(queueItem);
        }
    },
    /**
     * Generates the list item
     * @param deployment - Deployment object
     * @returns {Object} containing the list item or false if no list item is built (would require build.status to be something other than BUILDING or QUEUED)
     */
    generateDeploymentListItem: function(deployment)
    {
        var ca = CurrentActivity,
            o = ca.options,
            handle = o.hasAdminPermission ? '<span class="handle"></span>' : '',
            el = '';
        if (deployment.hasReadPermission) {
            var name = 'Deployment of ' + deployment.deploymentProjectName + ' &rsaquo; ' + _.escape(deployment.versionName) + ' to     ' + deployment.environmentName;
            var resultLink = '<a href="' + o.contextPath + '/deploy/viewDeploymentResult.action?deploymentResultId=' + deployment.resultId + '">' + name + '</a>'

            if (deployment.status == "BUILDING") {
                var buildAgentInfo = deployment.agent ? ' running on <a href="' + o.viewAgentUrl + '?agentId=' + deployment.agent.id + '" class="' + deployment.agent.type.toLowerCase() + '">' + deployment.agent.name + '</a>' : '';
                el = '<li id="b' + deployment.resultKey + '" class="buildRow"><div class="buildInfo">' + resultLink + buildAgentInfo + '</div><div class="message ' + deployment.messageType.toLowerCase() + '">' + deployment.messageText + '</div>';
                if (deployment.hasBuildPermission) {
                    var stopButtonHTML = (deployment.isBeingStopped) ? ca.disabledStopHTML : '<a href="' + o.stopDeploymentUrl + '?deploymentResultId=' + deployment.resultId + '" class="build-stop">' + widget.icons.icon({ type: 'build-stop', text: o.cancelDeploymentText, showTitle: true }) + '</a>';
                    el += '<ul class="buildActions"><li>' + stopButtonHTML + '</li></ul>'
                }
                el += '</li>';
            } else if (deployment.status == "QUEUED") {
                var title = deployment.executableAgents ? ' title="' + ca.generateBuildableAgentsText(deployment.executableAgents) + '"' : '',
                        handle = o.hasAdminPermission ? '<span class="handle"></span>' : '';

                el = '<li id="b' + deployment.resultKey + '" class="buildRow"><div class="buildInfo">' + handle + resultLink + '</div>';
                el += '<div class="message ' + deployment.messageType.toLowerCase() + '"' + title + '>' + deployment.messageText + '</div>'

                if (deployment.executableElasticImages || deployment.hasBuildPermission) {
                    el += '<ul class="buildActions">';
                    if (deployment.executableElasticImages) {
                        if (o.canManageElasticBamboo) {
                            el += '<li><a href="' + o.manageElasticInstancesUrl + '">' + widget.icons.icon({ type: 'elastic', text: o.canBuildElasticallyAdmin, showTitle: true }) + '</a></li>';
                        } else {
                            el += '<li>' + widget.icons.icon({ type: 'elastic-disabled', text: o.canBuildElastically, showTitle: true }) + '</li>';
                        }
                    }
                    if (deployment.hasBuildPermission) {
                        el += '<li><a href="' + o.stopDeploymentUrl + '?deploymentResultId=' + deployment.resultId + '" class="build-stop">' + widget.icons.icon({ type: 'build-stop', text: o.cancelDeploymentText, showTitle: true }) + '</a></li>'
                    }
                    el += '</ul>';
                }
                el += '</li>';
            }
        } else {
            el = '<li id="b' + deployment.resultKey + '" class="buildRow"><div class="buildInfo">' + _.escape(deployment.versionName) + '</div><span class="message ' + deployment.messageType.toLowerCase() + '">' + deployment.messageText + '</span></li>';
        }
       return (el.length == 0 ? false : AJS.$(el).data("item-type", "DEPLOYMENT"));
    },
    /**
     * Generates the list item
     * @param build - Build object
     * @returns {Object} containing the list item or false if no list item is built (would require build.status to be something other than BUILDING or QUEUED)
     */
    generateBuildListItem: function (build) {
        var ca = CurrentActivity,
            o = ca.options,
            el = "";

        if (build.hasReadPermission) {
            var masterName = build.isBranch ? build.planName.split(" - ", 2)[1] + ' &rsaquo; <span class="aui-icon aui-icon-small aui-iconfont-devtools-branch"/> ' : "";
            var buildLink = '<a href="' + o.contextPath + '/browse/' + build.planResultKey + '/">' + build.projectName + ' &rsaquo; ' + masterName + build.chainName + ' &rsaquo; #' + build.buildNumber + '</a> &rsaquo; <a href="' + o.contextPath + '/browse/' + build.buildResultKey + '/">' + build.jobName + '</a>';

            if (build.status == "BUILDING") {
                var msgHtml = build.messageType == "PROGRESS" ? '<div class="progress-bar" style="width:' + build.percentageComplete + '%;"></div><div class="progress-text">' + build.messageText + '</div>' : build.messageText;
                var buildAgentInfo = build.agent ? ' building on <a href="' + o.viewAgentUrl + '?agentId=' + build.agent.id + '" class="' + build.agent.type.toLowerCase() + '">' + build.agent.name + '</a>' : '';
                el = '<li id="b' + build.buildResultKey + '" class="buildRow"><div class="buildInfo">' + buildLink + buildAgentInfo + '</div><div class="message ' + build.messageType.toLowerCase() + '">' + msgHtml + '</div>'; //Current Activity
                if (build.hasBuildPermission) {
                    var stopButtonHTML = (build.isBeingStopped) ? ca.disabledStopHTML : '<a href="' + o.stopBuildUrl + '?planResultKey=' + build.buildResultKey + '" class="build-stop">' + widget.icons.icon({ type: 'build-stop', text: o.cancelBuildText, showTitle: true }) + '</a>';
                    el += '<ul class="buildActions"><li>' + stopButtonHTML + '</li></ul>';
                }
                el += '</li>';
            } else if (build.status == "QUEUED") {
                var title = build.executableAgents ? ' title="' + ca.generateBuildableAgentsText(build.executableAgents) + '"' : '',
                    handle = o.hasAdminPermission ? '<span class="handle"></span>' : '';
                el = '<li id="b' + build.buildResultKey + '" class="buildRow"><div class="buildInfo">' + handle + buildLink + '</div><div class="message ' + build.messageType.toLowerCase() + '"' + title + '>' + build.messageText + '</div>';  //Current Activity
                if (build.executableElasticImages || build.hasBuildPermission) {
                    el += '<ul class="buildActions">';
                    if (build.executableElasticImages) {
                        if (o.canManageElasticBamboo) {
                            el += '<li><a href="' + o.manageElasticInstancesUrl + '">' + widget.icons.icon({ type: 'elastic', text: o.canBuildElasticallyAdmin, showTitle: true }) + '</a></li>';
                        } else {
                            el += '<li>' + widget.icons.icon({ type: 'elastic-disabled', text: o.canBuildElastically, showTitle: true }) + '</li>';
                        }
                    }
                    if (build.hasBuildPermission) {
                        el += '<li><a href="' + o.stopBuildUrl + '?planResultKey=' + build.buildResultKey + '" class="build-stop">' + widget.icons.icon({ type: 'build-stop', text: o.cancelBuildText, showTitle: true }) + '</a></li>'
                    }
                    el += '</ul>';
                }
                el += '</li>';
            }
        } else {
            el = '<li id="b' + build.buildResultKey + '" class="buildRow"><div class="buildInfo">' + build.planName + '</div><span class="message ' + build.messageType.toLowerCase() + '">' + build.messageText + '</span></li>';
        }
        return (el.length == 0 ? false : AJS.$(el).data("item-type", "BUILD"));
    },
    /**
     * Checks if an activity stream is available, and if it is (and there are no activity stream comment forms open -
     * which would indicate the user is probably in the middle of adding a comment) then trigger a refresh.
     */
    updateActivityStream: function () {
        var o = CurrentActivity.options;

        if (o.activityStream && AJS.$(".activity-item-comment-form:visible", document.getElementById("feedContainer-" + o.activityStream.feedId)).length == 0) {
            o.activityStream.populateFeed();
        }
    },
    /**
     * Checks the time the build was last updated with the time the last data was retrieved.
     * Removes the build if it's older than the last update.
     * @param li - List item containing the build
     * @returns {Boolean} indicating whether the build was removed or not
     */
    checkLastUpdated: function (li) {
        var b = AJS.$(li);

        if (b.data("lastUpdated") < CurrentActivity.updateTimestamp) {
            b.remove();
            return true;
        } else {
            return false;
        }
    },
    /**
     * Checks if build lists are empty and if so, hide the list and display a message, otherwise show the list and hide the message.
     */
    checkListsHaveBuilds: function () {
        var ca = CurrentActivity;

        if (ca.building.children().length == 0) {
            ca.building.hide();
            ca.noBuilding.show();
        } else {
            ca.building.show();
            ca.noBuilding.hide();
        }
        if (ca.queue.children().length == 0) {
            ca.queue.hide();
            ca.noQueued.show();
            // If queue is empty but "queue is out-of-date" message is being displayed then hide the message and re-enable sorting
            if (ca.queueOutOfDate.is(":visible")) {
                ca.queue.sortable("enable");
                ca.queueOutOfDate.hide();
            }
        } else {
            ca.queue.show();
            ca.noQueued.hide();
        }
    },
    /**
     * Checks if current activity container exists and is in DOM
     * @returns {Boolean} indicating whether the container exists in the DOM
     */
    isCurrentActivityPresent: function () {
        var o = CurrentActivity.options;

        return (!o.caParent || !o.caParent.length || !o.caParent.parent().length);
    },
    /**
     * Retrieves the build JSON from the server and adds/removes/changes builds in the currently building and queue as needed.
     * @param callback - Allows the ability to execute a callback once the update has completed
     */
    updateBuilds: function (callback) {
        var ca = CurrentActivity,
            o = ca.options;

        ca.updateTimestamp = (new Date()).getTime();
        // Get builds from API
        AJS.$.ajax({
            url: o.getBuildsUrl,
            dataType: 'json',
            cache: false,
            success: function (json) {
                if (ca.isCurrentActivityPresent()) {
                    return false;
                }

                // If a callback was supplied to updateBuilds, fire it
                if (callback && AJS.$.isFunction(callback)) {
                    callback.call();
                }
                // Update agent summary text if available
                if (o.agentSummary) {
                    o.agentSummary.text(json.agentSummary);
                }
                // Go through each build returned and either update or insert as required
                AJS.$.each(json.builds, function () {
                    var build = AJS.$("#b" + this.buildResultKey),
                        msg, progress, messageType, stopButton;

                    if (build.length > 0) { // Check if the build already exists in building/queue
                        if (this.status == "BUILDING") {
                            // Check if build has started, if so move to building
                            if (build.closest(".buildContainer")[0] == o.queueParent[0]) {
                                build.remove();
                                build = ca.generateListItem(this).appendTo(ca.building);
                                progress = AJS.$(".progress", build[0]);
                                if (progress.length > 0) {
                                    progress.progressBar();
                                }
                            } else {
                                msg = AJS.$(".message", build[0]);
                                messageType = this.messageType.toLowerCase();

                                if (messageType == "progress" && msg.hasClass(messageType)) {
                                    msg.progressBar("option", { value: this.percentageComplete, text: this.messageText });
                                } else if (messageType == "progress") {
                                    msg.attr("class", "message").progressBar({ value: this.percentageComplete, text: this.messageText });
                                } else {
                                    if (msg.hasClass("progress")) {
                                        msg.progressBar("destroy");
                                    }
                                    if (!msg.hasClass(messageType)) {
                                        msg.attr("class", "message " + messageType).text(this.messageText);
                                    } else {
                                        msg.text(this.messageText);
                                    }
                                }
                                if (this.hasBuildPermission && this.isBeingStopped) {
                                    stopButton = AJS.$(".build-stop", build[0]);
                                    if (stopButton.length > 0) {
                                        stopButton.replaceWith(ca.disabledStopHTML);
                                    }
                                }
                            }
                        } else if (this.status == "QUEUED") {
                            msg = AJS.$(".message", build[0]).text(this.messageText).attr("title", (this.executableAgents ? ca.generateBuildableAgentsText(this.executableAgents) : null));
                            if (!msg.hasClass(this.messageType.toLowerCase())) {
                                msg.attr("class", "message " + this.messageType.toLowerCase());
                            }
                        }
                    } else {
                        if (this.status == "BUILDING") {
                            build = ca.generateListItem(this).appendTo(ca.building);
                            progress = AJS.$(".progress", build[0]);
                            if (progress.length > 0) {
                                progress.progressBar();
                            }
                        } else if (this.status == "QUEUED") {
                            build = ca.generateListItem(this).appendTo(ca.queue);
                        }
                    }
                    // Check if queue order is correct and reorder if required
                    if (!ca.isBeingSorted && typeof(this.queueIndex) != "undefined" && this.queueIndex != build.prevAll().length) {
                        build.insertBefore(ca.queue.children("li:eq(" + this.queueIndex + ")"));
                    }
                    build.data("lastUpdated", ca.updateTimestamp);
                });

                // Clean up builds not returned in JSON
                var numRemoved = 0;
                ca.building.children().each(function () {
                    if (ca.checkLastUpdated(this)) { numRemoved++; }
                });
                ca.queue.children().each(function () {
                    if (ca.checkLastUpdated(this)) { numRemoved++; }
                });
                if (numRemoved > 0) { ca.updateActivityStream(); }

                if (o.hasAdminPermission) {
                    // Refresh sorting
                    ca.queue.sortable("refresh");
                }

                ca.checkListsHaveBuilds();

                // Clear timeout to ensure we don't have multiple running
                clearTimeout(ca.updateTimeout);

                ca.updateTimeout = setTimeout(ca.updateBuilds, BAMBOO.mediumServerPollMillis);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                if (ca.isCurrentActivityPresent()) {
                    return false;
                }

                // Clear timeout to ensure we don't have multiple running
                clearTimeout(ca.updateTimeout);

                // Error occurred when doing the update, try again in 30 sec, making sure the callback is passed so that it will actually get executed when it finally succeeds
                ca.updateTimeout = setTimeout(function () { ca.updateBuilds(callback); }, BAMBOO.afterErrorServerPollMillis);
            }
        });
    },
    /**
     * Strips a build list item's id down to a build result key
     * @param buildListItemID - String containing the build list item's id - eg. bBAM-FUNC-1234
     * @returns {String} containing the build result key - eg. BAM-FUNC-1234
     */
    buildListItemIDToBuildResultKey: function (buildListItemID) {
        return buildListItemID.substr(1);
    },
    /**
     * Initialisation for the Current Activity
     * @param options - Object containing the options to overwrite our defaults
     */
    init: function (options) {
        var ca = CurrentActivity,
            o = ca.options;

        AJS.$.extend(o, options);

        ca.building = AJS.$("<ul/>").appendTo(o.buildingParent).hide();
        ca.queue = AJS.$("<ul/>").appendTo(o.queueParent).hide();
        ca.noBuilding = AJS.$("<p>" + o.emptyBuildingText + "</p>").appendTo(o.buildingParent).hide();
        ca.noQueued = AJS.$("<p>" + o.emptyQueueText + "</p>").appendTo(o.queueParent).hide();
        ca.queueOutOfDate = AJS.$("<p>" + o.queueOutOfDateText + "</p>").insertBefore(ca.queue).hide();
        ca.loadingBuilding = AJS.$('<p class="loading">' + o.fetchingBuildData + '</p>').appendTo(o.buildingParent);
        ca.loadingQueued = AJS.$('<p class="loading">' + o.fetchingBuildData + '</p>').appendTo(o.queueParent);
        ca.disabledStopHTML = widget.icons.icon({ type: 'build-stop-disabled', text: o.cancellingBuildText, showTitle: true });

        clearTimeout(ca.updateTimeout);
        ca.updateTimestamp = null;

        o.caParent.delegate(".buildActions a.build-stop", "click", function (e) {
            var el = AJS.$(this),
                li = el.closest(".buildRow");
            AJS.$.post(this.href, function () {
                // Only remove from the queue immediately - currently building builds may take a while to stop and clean up - let the next updateBuilds() that runs clean it up
                if (li.closest(".buildContainer")[0] == o.queueParent[0]) {
                    li.remove();
                }
                ca.checkListsHaveBuilds();
            });
            el.replaceWith(ca.disabledStopHTML);
            e.preventDefault();
        });
        AJS.$("a", ca.queueOutOfDate[0]).click(function (e) {
            clearTimeout(ca.updateTimeout);
            ca.queue.empty().sortable("enable");
            AJS.$(this).parent().hide();
            ca.updateBuilds();
            ca.updateActivityStream();
            e.preventDefault();
        });
        if (o.hasAdminPermission) {
            ca.queue.sortable({
                handle: "span.handle",
                update: function (event, ui) {
                    var self = AJS.$(ui.item),
                        resultKey = ca.buildListItemIDToBuildResultKey(self.attr("id")),
                        checkListItemExists = function ($el) {
                            if ($el.length > 0) {
                                return ca.buildListItemIDToBuildResultKey($el.attr("id"));
                            } else {
                                return "";
                            }
                        },
                        prevResultKey = checkListItemExists(self.prev()),
                        itemType = self.data("item-type");
                    AJS.$.post(o.reorderBuildUrl,
                        { resultKey: resultKey, prevResultKey: prevResultKey, itemType: itemType },
                        function (json) {
                            // If an error is returned show the queue out of date message. The next update will restore the correct queue order.
                            if (json.status == "ERROR") {
                                ca.queueOutOfDate.show();
                                ca.queue.sortable("disable");
                            }
                        }, "json");
                },
                start: function (event, ui) {
                    ca.isBeingSorted = true;
                },
                stop: function (event, ui) {
                    ca.isBeingSorted = false;
                }
            });
        }
        ca.updateBuilds(function () {
            ca.loadingBuilding.hide();
            ca.loadingQueued.hide();
        });
    }
};

/**
 * Agent Manager dropdown
 */
var AgentManager = {
    // Default options
    options: {
        contextPath: null,
        getAgentsUrl: null,
        enableAgentUrl: null,
        disableAgentUrl: null,
        enableAllAgentsUrl: null,
        disableAllAgentsUrl: null,
        viewAgentUrl: null,
        enableAgentText: null,
        disableAgentText: null,
        enableAllAgentsText: null,
        disableAllAgentsText: null,
        onlineAgentsText: null,
        defaultRemoteAgentSummaryText: null,
        onlineOnly: false,
        includeRemoteAgentSummary: false,
        triggerId: null,
        dedicatedLozenge: null
    },
    $agentList: null, // jQuery object referring to the list holding the agents
    $dialog: null, // jQuery object referring to the AUI Inline Dialog
    $remoteAgentSummary: null, // jQuery object referring to the paragraph containing the remote agent summary text
    /**
     * Generates the list item
     * @param agent - Agent object
     * @returns {Object} containing the list item or false if no list item is built
     */
    generateListItem: function (agent) {
        var am = AgentManager,
            o = am.options,
            el = "";
        el = '<li class="' + agent.type.toLowerCase() + ' ' + (agent.enabled ? "enabled" : "disabled") + '"><h3><a href="' + o.viewAgentUrl + '?agentId=' + agent.id + '">' + agent.name + '</a>' + (agent.isDedicated ? ' ' + o.dedicatedLozenge : '') + '</h3><span>' + (agent.agentStatus == "Building" ? agent.agentStatus + ' - <a href="' + o.contextPath + agent.buildLogUrl + '">' + agent.buildDisplayName + '</a>' : agent.agentStatus) + '</span> <button class="aui-button ' + (agent.enabled ? "disable" : "enable") + '">' + (agent.enabled ? o.disableAgentText : o.enableAgentText) + '</button></li>';
        return (el.length == 0 ? false : AJS.$(el).data("agentId", agent.id));
    },
    /**
     * Updates the list of agents
     * @param $contents - jQuery element of the Inline Dialog's contents
     * @param $trigger - jQuery element that is triggering the popup
     * @param doShowPopup - function to display the popup
     */
    updateAgents: function ($contents, $trigger, doShowPopup) {
        var am = AgentManager,
            o = am.options;
        AJS.$.ajax({
            url: o.getAgentsUrl,
            data: { onlineOnly: o.onlineOnly, includeRemoteAgentSummary: o.includeRemoteAgentSummary },
            dataType: 'json',
            cache: false,
            success: function (json) {
                if (o.includeRemoteAgentSummary && json.remoteAgentSummary) {
                    am.$remoteAgentSummary.html(json.remoteAgentSummary);
                } else if (o.includeRemoteAgentSummary) {
                    am.$remoteAgentSummary.html(o.defaultRemoteAgentSummaryText);
                }
                am.$agentList.empty();
                AJS.$.each(json.agents, function () {
                    am.$agentList.append(am.generateListItem(this));
                });
                if (doShowPopup) {
                    doShowPopup();
                }
            }
        });
    },
    /**
     * Initialisation for the Agent Manager
     * @param options - Object containing the options to overwrite our defaults
     */
    init: function (options) {
        var am = AgentManager,
            o = am.options;

        // Don't init if already created
        if (am.$dialog) { return false; }

        AJS.$.extend(o, options);

        am.$dialog = AJS.InlineDialog("#" + o.triggerId, o.triggerId, am.updateAgents, {
            onHover: true,
            width: 400,
            offsetX: 0,
            offsetY: 3,
            cacheContent: false,
            useLiveEvents: true
        });
        var $contents = am.$dialog.find(".contents").addClass("agentManager");
        am.$agentList = AJS.$('<ul />').appendTo($contents).before('<h2>' + o.onlineAgentsText + '</h2>');
        if (o.includeRemoteAgentSummary) {
            am.$remoteAgentSummary = AJS.$('<p>' + o.defaultRemoteAgentSummaryText + '</p>').insertBefore(am.$agentList);
        }
        var $buttons = AJS.$('<div class="aui-buttons"></div>').appendTo($contents);
        AJS.$('<button class="aui-button">' + o.enableAllAgentsText + '</button>').appendTo($buttons).click(function () {
            var el = AJS.$(this);
            el.attr("disabled", "disabled");
            AJS.$.post(o.enableAllAgentsUrl, function () {
                el.removeAttr("disabled");
                am.updateAgents();
            });
        });
        AJS.$('<button class="aui-button">' + o.disableAllAgentsText + '</button>').appendTo($buttons).click(function () {
            var el = AJS.$(this);
            el.attr("disabled", "disabled");
            AJS.$.post(o.disableAllAgentsUrl, function () {
                el.removeAttr("disabled");
                am.updateAgents();
            });
        });
        // FF not firing buttons on click for some reason, mouseup is okay though?!!
        var dialogId = am.$dialog.attr("id");
        AJS.$("#" + dialogId + " button.enable").live("mouseup", function () {
            var el = AJS.$(this),
                li = el.closest("li");
            var agentId = li.data("agentId");
            el.attr("disabled", "disabled");
            AJS.$.post(o.enableAgentUrl, { agentId: agentId }, function () {
                el.text(o.disableAgentText).attr("class", "aui-button disable").removeAttr("disabled").parent().removeClass("disabled");
            });
        });
        AJS.$("#" + dialogId + " button.disable").live("mouseup", function () {
            var el = AJS.$(this),
                li = el.closest("li");
            var agentId = li.data("agentId");
            el.attr("disabled", "disabled");
            AJS.$.post(o.disableAgentUrl, { agentId: agentId }, function () {
                el.text(o.enableAgentText).attr("class", "aui-button enable").removeAttr("disabled").parent().addClass("disabled");
            });
        });
    }
};

var SelectionActions = function() {
    return {
        init: function (formId) {
            registerSelectionActions();

            function registerSelectionActions() {
                AJS.$("span[selector='"+formId+"_all']").click( function() {
                    clearSelectionStatus();

                    getSelectAllWarning().show();
                    getAllPagesSelectedInfo().hide();

                    getAllCheckBoxes("").attr("checked", "checked");
                });
                AJS.$("span[selector='"+formId+"_none']").click( function() {
                    clearSelectionStatus();
                });
                AJS.$("span[selector='"+formId+"_disabled']").click( function() {
                    clearSelectionStatus();
                    getAllCheckBoxes("[class~='selectorAgentEnabled_false']").attr("checked", "checked");
                });
                AJS.$("span[selector='"+formId+"_idle']").click( function() {
                    clearSelectionStatus();
                    getAllCheckBoxes("[class~='selectorAgentStatus_Idle']").attr("checked", "checked");
                });
                AJS.$("span[selector='"+formId+"_allPages']").click( function() {
                    setCompleteContentSelected(true);
                    getSelectAllWarning().hide();
                    getAllPagesSelectedInfo().show();
                });
            }

            function getAllCheckBoxes(selector) {
                return AJS.$("input:checkbox.selectorAgentType_"+formId+"[name='selectedAgents']"+selector);
            }

            function setCompleteContentSelected(newValue) {
                AJS.$('.'+formId+'_completeContentSelected').val(newValue);
            }

            function clearSelectionStatus() {
                AJS.$('.'+formId+'_paginatedWarning').hide();
                getAllCheckBoxes("").removeAttr("checked");
                setCompleteContentSelected(false);
            }

            function getSelectAllWarning() {
                return AJS.$('.'+formId+'_paginatedSelectAllWarning');
            }

            function getAllPagesSelectedInfo() {
                return AJS.$('.'+formId+'_paginatedAllPagesSelected');
            }
        }
    };
}();

/**
 * Generic selection in table control without support for pagination.
 * Selectors need to have 2 attributes :
 *  - data-selector-id (must match name of the checkbox group)
 *  - data-selector-type (ALL, NONE or custom selector that will be match by discriminators)
 *
 * Checkboxes can specify a comma-separated list of discriminators for selection in
 * the 'data-selector-discriminator' attribute.
 *
 */
var GenericSelectionActions = function($) {
    var SELECT_ALL = "ALL", DESELECT_ALL = "NONE";

    return {

        init: function (formId, checkboxName) {
            registerSelectionActions();

            function registerSelectionActions() {
                var $form = $(BAMBOO.escapeIdToJQuerySelector("#" + formId));
                if ($form.length === 0) {
                    return;
                }
                $form.find("span[data-selector-id='"+checkboxName+"']").click(function() {
                        discriminator = $(this).data("selectorType");
                    applyToCheckboxes($form, discriminator);
                });
            }

            function applyToCheckboxes($inForm, discriminator) {
                $inForm.find("input:checkbox").each(function() {
                    var $this = $(this);
                    if (matchesDiscriminator($this, discriminator)) {
                        $this.attr("checked", "checked");
                    } else {
                        $this.removeAttr("checked");
                    }
                });
            }

            function matchesDiscriminator($checkbox, selector) {
                var found = false;
                if (selector === SELECT_ALL) {
                    return true;
                } else if (selector === DESELECT_ALL) {
                    return false;
                } else {
                    $.each($checkbox.data("selectorDiscriminator").split(","), function(index, value) {
                        if (value === selector) {
                            found = true;
                            return true;
                        }
                    });
                    return found;
                }
            }
        }
    };
}(AJS.$);

/**
 * @deprecated since 5.10 use 'widget/bulk-selection-links'
 */
var BulkSelectionActions = function() {
    return {
        init: function (formId) {
            registerSelectionActions();

            function registerSelectionActions() {
                AJS.$("span[selector='bulk_selector_all']").click( function() {
                    clearSelectionStatus();
                    getAllCheckBoxes("").attr("checked", "checked");
                });
                AJS.$("span[selector='bulk_selector_none']").click( function() {
                    clearSelectionStatus();
                });
                AJS.$("span[selector='bulk_selector_plans']").click( function() {
                    clearSelectionStatus();
                    getAllCheckBoxes("Plan").attr("checked", "checked");
                });
                AJS.$("span[selector='bulk_selector_jobs']").click( function() {
                    clearSelectionStatus();
                    getAllCheckBoxes("Job").attr("checked", "checked");
                });
            }

            function getAllCheckBoxes(selector) {
                return AJS.$("input:checkbox.bulk"+selector);
            }

            function setCompleteContentSelected(newValue) {
                AJS.$('.'+formId+'_completeContentSelected').val(newValue);
            }

            function clearSelectionStatus() {
                getAllCheckBoxes("").removeAttr("checked");
                setCompleteContentSelected(false);
            }
        }
    };
}();

/**
 * @deprecated since 5.10 use 'widget/bulk-selection-links'
 */
var BulkSubtreeSelectionActions = function() {
    return {
        init: function (formId, enableProjectCheckbox) {
            registerSelectionActions(enableProjectCheckbox);

            function registerSelectionActions(enableProjectCheckbox) {
                AJS.$("span[selector='bulk_selector_sub_"+formId+"']").click( function() {
                    clearSelectionStatus();
                    getAllCheckBoxes(formId).attr("checked", "checked");
                });
                AJS.$("span[selector='bulk_selector_sub_none_"+formId+"']").click( function() {
                    clearSelectionStatus();
                });
                AJS.$("span[selector='bulk_selector_sub_plans_"+formId+"']").click( function() {
                    clearSelectionStatus();
                    getAllCheckBoxes("Plan" + formId).attr("checked", "checked");
                });
                AJS.$("span[selector='bulk_selector_sub_jobs_"+formId+"']").click( function() {
                    clearSelectionStatus();
                    getAllCheckBoxes("Job" + formId).attr("checked", "checked");
                });

                if (enableProjectCheckbox) {
                    AJS.$("#checkbox_"+formId).change( function() {
                        var val = AJS.$(this).is(":checked");
                        clearSelectionStatus();
                        if (val) {
                            getAllCheckBoxes(formId).attr("checked", "checked");
                        }
                    });
                }
            }

            function getAllCheckBoxes(selector) {
                return AJS.$("input:checkbox.bulk"+selector);
            }

            function clearSelectionStatus() {
                getAllCheckBoxes(formId).removeAttr("checked");
            }
        }
    };
}();

var ConfigurableSelectionActions = function() {
    return {
        init: function (formId) {
            var formIdSelector = formId.replace(/([\.:])/g, "\\$1");
            registerSelectionActions();

            function registerSelectionActions() {
                AJS.$("span[selector='"+formId+"_all']").click( function() {
                    getAllCheckBoxes("").attr("checked", "checked");
                });
                AJS.$("span[selector='"+formId+"_none']").click( function() {
                    clearSelectionStatus();
                });

                AJS.$("span[selector^='"+formId+"_'][selector!='"+formId+"_none'][selector!='"+formId+"_all']").each(function () {
                    var span = AJS.$(this),
                        selector = span.attr("selector").substring(formId.length + 1);
                    span.click( function() {
                        clearSelectionStatus();
                        getAllCheckBoxes("[class~='selector_"+selector+"_true']").attr("checked", "checked");
                    });
                });
            }

            function getAllCheckBoxes(selector) {
                return AJS.$("input:checkbox.selectorScope_"+formIdSelector+selector);
            }

            function clearSelectionStatus() {
                getAllCheckBoxes("").removeAttr("checked");
            }
        }
    };
}();

/**
 * Live Activity for Plans
 */
var LiveActivity = function ($) {
    var opts = {
        planKey: null,
        container: null,
        getBuildsUrl: null,
        getResultUrl: null,
        getChangesUrl: null,
        queueEmptyText: null,
        cancellingBuildText: null,
        noAdditionalInfoText: null,
        defaultIssueIconUrl: null,
        defaultIssueType: null,
        slideSpeed: 600,
        templates: {
            buildListItemTemplate: null,
            buildingOnTemplate: null,
            buildMessageTemplate: null,
            jiraIssueTemplate: null,
            codeChangeTemplate: null,
            codeChangeChangesetLinkTemplate: null,
            codeChangeChangesetDisplayTemplate: null,
            currentStageTemplate: null,
            toggleDetailsButton: AJS.template('<span class="toggle-details"></span>')
        }
    },
    $buildList, // jQuery object referring to the list holding the builds
    $noBuilds, // jQuery object referring to the message that shows when there are no builds
    disabledStopHTML, // HTML fragment that replaces the stop button when a user clicks it (so it can't be clicked multiple times)
    toggleDetailsHTML, // HTML fragment inserted to enable the user to toggle the display of additional information
    /**
     * Checks if build list is empty and if so, hide the list and display a message, otherwise show the list and hide the message.
     */
    checkListHasBuilds = function () {
        if ($buildList.children().length == 0) {
            $buildList.hide();
            $noBuilds.show();
        } else {
            $buildList.show();
            $noBuilds.hide();
        }
    },
    updateTimeout, // ID of timeout which determines when the data will be next fetched from the server
    updateTimestamp, // Timestamp (represented as milliseconds since the Unix epoch) that the builds were last updated
    /**
     * Retrieves the build JSON from the server and adds/removes/changes builds in the build list as needed.
     */
    update = function () {
        // Otherwise switching to history tab results in undefined behaviour
        if($('#liveActivity').length == 0) return;
        updateTimestamp = (new Date()).getTime();
        $.ajax({
            url: opts.getBuildsUrl,
            data: { planKey: opts.planKey },
            dataType: "json",
            cache: false,
            success: function (json) {
                // Go through each build returned and either update or insert as required
                $.each(json.builds, function () {
                    var $build = $("#b" + this.buildResultKey),
                        messageType = this.messageType.toLowerCase(),
                        status = this.status.toLowerCase();
                    if ($build.length > 0) { // Check if the build already exists in list
                        var $msg = $(".message", $build[0]),
                            $stageInfo = $(".stage-info", $build[0]),
                            $agentInfo = $(".agent-info", $build[0]);
                        if (messageType == "progress" && $msg.hasClass(messageType)) {
                            $msg.progressBar("option", { value: this.percentageComplete, text: this.messageText });
                        } else if (messageType == "progress") {
                            $msg.attr("class", "message").progressBar({ value: this.percentageComplete, text: this.messageText });
                        } else {
                            if ($msg.hasClass("progress")) {
                                $msg.progressBar("destroy");
                            }
                            if (!$msg.hasClass(messageType)) {
                                $msg.attr("class", "message " + messageType).text(this.messageText);
                            } else {
                                $msg.text(this.messageText);
                            }
                        }
                        if (status == "building") {
                            if ($agentInfo.length == 0 && this.agent != null) {
                                var buildingOnHTML = status == "building" ? AJS.template.load(opts.templates.buildingOnTemplate).fill({ agentId: this.agent.id, agentType: this.agent.type.toLowerCase(), agentName: this.agent.name }).toString() : "";
                                $(".build-description", $build[0]).append(buildingOnHTML);
                            }
                            if (this.stage != null && $stageInfo.length > 0) {
                                var currentStageHTML = (status == "building" ? AJS.template.load(opts.templates.currentStageTemplate).fill({ stageName: this.stage.name, stageNumber: this.stage.number, totalStages: this.stage.totalStages }).toString() : "");
                                $stageInfo.html($.trim(currentStageHTML));
                            }
                        }
                        if (!$build.hasClass(status)) {
                            $build.removeClass(status == "building" ? "queued" : "building").addClass(status);
                        }
                    } else {
                        var buildingOnHTML = (status == "building" && this.agent != null) ? AJS.template.load(opts.templates.buildingOnTemplate).fill({ agentId: this.agent.id, agentType: this.agent.type.toLowerCase(), agentName: this.agent.name }).toString() : "",
                            currentStageHTML = (status == "building" && this.stage != null) ? AJS.template.load(opts.templates.currentStageTemplate).fill({stageName: this.stage.name, stageNumber: this.stage.number, totalStages: this.stage.totalStages }).toString() : "",
                            buildMessageHTML = AJS.template.load(opts.templates.buildMessageTemplate).fill({ type: messageType, text: this.messageText }).toString(),
                            listItemHTML = AJS.template.load(opts.templates.buildListItemTemplate).fill({
                                buildResultKey: this.buildResultKey,
                                cssClass: status,
                                planKey: this.planKey
                            }).fillHtml({
                                buildingOn: buildingOnHTML,
                                triggerReason: this.triggerReason,
                                currentStage: currentStageHTML,
                                buildMessage: buildMessageHTML
                            }).toString();
                        $build = $(listItemHTML).appendTo($buildList);
                        var $msg = $(".message", $build[0]);
                        $build.addClass("collapsed").prepend(toggleDetailsHTML);
                        $(".additional-information", $build).hide();
                        if (messageType == "progress") {
                            $msg.progressBar({ value: this.percentageComplete, text: this.messageText });
                        }
                    }
                    $build.data("lastUpdated", updateTimestamp);
                });

                // Clean up builds not returned in JSON
                var planResultKeys = [];
                $buildList.children().each(function () {
                    var b = $(this);
                    if (b.data("lastUpdated") < updateTimestamp) {
                        b.fadeOut(500, function () {
                            $(this).remove();
                            checkListHasBuilds();
                        })
                        planResultKeys.push(b.attr('id').substring(1));
                    }
                });
                if (planResultKeys.length > 0) {
                    // Pet peeve - reverse mutates in place :(
                    planResultKeys.reverse();
                    $.ajax({
                        url: opts.getResultUrl,
                        data: { planResultKeys: planResultKeys },
                        success: function (result) {
                            $('.buildResultsNone').hide();
                            $('#buildResultsTable').show().find('tbody').prepend($(result).find('tr'));
                        }
                    });
                }

                checkListHasBuilds();

                // Use a fast poll if something is going on, slow poll if everything is calm
                updateTimeout = setTimeout(update, json.builds && json.builds.length ? BAMBOO.fastServerPollMillis : BAMBOO.slowServerPollMillis);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                // Error occurred when doing the update, try again in 30 sec
                updateTimeout = setTimeout(update, BAMBOO.afterErrorServerPollMillis);
            }
        });
    };
    return {
        /**
         * Initialisation for the Live Activity
         * @param options - Object containing the options to overwrite our defaults
         */
        init: function (options) {
            $.extend(true, opts, options);
            disabledStopHTML = widget.icons.icon({ type: 'build-stop-disabled', text: opts.cancellingBuildText, showTitle: true });
            if (opts.templates.toggleDetailsButton) {
                toggleDetailsHTML = opts.templates.toggleDetailsButton.toString();
            }

            $buildList = $("> ul", opts.container);
            if ($buildList.length == 0) {
                $buildList = $("<ul />").hide().prependTo(opts.container);
            } else {
                $buildList.children().addClass("collapsed").prepend(toggleDetailsHTML);
                $(".additional-information", $buildList).hide();
            }
            $noBuilds = $("> p", opts.container);
            if ($noBuilds.length == 0) {
                $noBuilds = $("<p>" + opts.queueEmptyText + "</p>").hide().appendTo(opts.container);
            }

            $("#" + opts.container.attr("id") + " a.build-stop").live("click", function (e) {
                var el = $(this),
                    li = el.closest("li");
                $.post(this.href, function () {
                    // Only remove from the queue immediately - currently building builds may take a while to stop and clean up - let the next updateBuilds() that runs clean it up
                    if (li.hasClass("queued")) {
                        li.fadeOut(500, function () {
                            $(this).remove();
                            checkListHasBuilds();
                        })
                    }
                });
                el.replaceWith(disabledStopHTML);
                e.preventDefault();
            });

            $("#" + opts.container.attr("id") + " .collapsed .toggle-details").live("click", function (e) {
                var el = $(this),
                    li = el.closest("li"),
                    additionalInfo = $(".additional-information", li[0]),
                    buildResultKey = li.attr("id").substring(1);

                if (!additionalInfo.data("data-retrieved")) {
                    li.removeClass("collapsed");
                    $.ajax({
                        url: opts.getChangesUrl + buildResultKey,
                        data: {
                            expand: "jiraIssues,vcsRevisions.vcsRevision.changes.change"
                        },
                        dataType: "json",
                        contentType: "application/json",
                        success: function (json) {
                            var issues = "";
                            if (json.jiraIssues && json.jiraIssues.size > 0) {
                                $.each(json.jiraIssues.issue, function () {
                                    if (this.url && this.url.href && this.key && this.summary) {
                                        issues += AJS.template.load(opts.templates.jiraIssueTemplate).fill({
                                            url: this.url.href,
                                            issueType: (this.issueType && this.issueType.length > 0) ? this.issueType : opts.defaultIssueType,
                                            issueIconUrl: (this.iconUrl && this.iconUrl.length > 0) ? this.iconUrl : opts.defaultIssueIconUrl,
                                            key: this.key,
                                            details: this.summary
                                        }).toString();
                                    }
                                });
                            }

                            var changes = "";
                            if (json.vcsRevisions && json.vcsRevisions.size > 0) {
                                $.each(json.vcsRevisions.vcsRevision, function() {
                                    if (this.changes && this.changes.size > 0) {
                                        $.each(this.changes.change, function () {
                                            if (this.author && this.comment) {
                                                changes += AJS.template.load(opts.templates.codeChangeTemplate).fill({
                                                    authorOrUser: (this.userName && this.userName.length > 0) ? "user" : "author",
                                                    author: (this.userName && this.userName.length > 0) ? this.userName : this.author,
                                                    displayName: (this.fullName && this.fullName.length > 0) ? this.fullName : this.author,
                                                    comment: this.comment
                                                }).fillHtml({
                                                    changesetInfo: this.changesetId ? AJS.template.load(this.commitUrl ? opts.templates.codeChangeChangesetLinkTemplate : opts.templates.codeChangeChangesetDisplayTemplate).fill({
                                                        commitUrl: this.commitUrl ? this.commitUrl : null,
                                                        changesetId: this.changesetId
                                                    }).toString() : ""
                                                }).toString();
                                            }
                                        });
                                    }
                                });
                            }

                            if (issues.length == 0 && changes.length == 0) {
                                additionalInfo.text(opts.noAdditionalInfoText);
                            } else {
                                if (issues.length == 0) {
                                    $(".issueSummary", additionalInfo[0]).remove();
                                } else {
                                    $(".issueSummary", additionalInfo[0]).append("<ul>" + issues + "</ul>");
                                }
                                if (changes.length == 0) {
                                    $(".changesSummary", additionalInfo[0]).remove();
                                } else {
                                    $(".changesSummary", additionalInfo[0]).append("<ul>" + changes + "</ul>");
                                }
                            }

                            li.addClass("expanded");
                            additionalInfo.data("data-retrieved", true, true).stop(true).slideDown(opts.slideSpeed);
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            li.addClass("collapsed");
                        }
                    });
                } else {
                    li.removeClass("collapsed").addClass("expanded");
                    additionalInfo.stop(true, true).slideDown(opts.slideSpeed);
                }
            });

            $("#" + opts.container.attr("id") + " .expanded .toggle-details").live("click", function (e) {
                var el = $(this),
                    li = el.closest("li");
                li.removeClass("expanded").addClass("collapsed");
                $(".additional-information", li[0]).stop(true, true).slideUp(opts.slideSpeed);
            });

            // Trigger the first update
            update();
        }
    }
}(jQuery);


function showAjaxErrorMessage(XMLHttpRequest) {
    AJS.$(".ajaxErrorMessage").html('"' + getMessageToShow(XMLHttpRequest.statusText) + '"');
    AJS.$("#ajaxErrorHolder").removeClass("hidden").show();
}

/**
 * Translates indecipherable messages into something more readable
 *
 * @param originalMessage the original message
 * @returns {string} either the original message passed in (if it's not indecipherable) or a generic message
 */
function getMessageToShow(originalMessage) {
    originalMessage = AJS.$.trim(originalMessage);
    if (originalMessage === "" || originalMessage === "error") {
        return "Error whilst communicating with server";
    }
    return originalMessage;
}

function hideAjaxErrorMessage() {
    AJS.$(".ajaxErrorMessage").empty();
    AJS.$("#ajaxErrorHolder").hide();
}

/**
 * Usage: init(selector, reloadEvent) . Calling init function multiple times on the same page is safe regardless of used selectors.
 *
 * @param selector the jQuery selector used to mark asynchronously executed links
 * @param resetLinkStateEventName (optional, nullable) the event causing the "executed" status of links to be cleared
 * @param onUrlCallFinished (optional) handler to call when url processing is finished
 */
var AsynchronousRequestManager = function($) {
    var IN_PROGRESS_KEY = "isInProgress";
    var registeredResetLinkStateHandlers = {};

    function isInProgress(link) {
        return link.data(IN_PROGRESS_KEY);
    }

    function setInProgress(link, newValue) {
        link.data(IN_PROGRESS_KEY, newValue);
        if (newValue) {
            link.fadeTo("slow", 0.4);
        } else {
            link.fadeTo("slow", 1);
        }
    }

    var onAsynchronousLinkClick = function(event) {
        var $this = $(this);
        var data = event.data;
        if (!isInProgress($this)) {
            $.ajax({
                url: this.href,
                type: $this.hasClass("usePostMethod") ? "POST" : "GET",
                error: function (XMLHttpRequest) {
                    setInProgress($this, false);
                    if (event.data.failureHandler) {
                        event.data.failureHandler();
                    }
                    showAjaxErrorMessage(XMLHttpRequest);
                },
                success: function (htmlOrJson) {
                    if (htmlOrJson.status && htmlOrJson.status == "ERROR") {
                        if (data.failureHandler) {
                            data.failureHandler(htmlOrJson);
                        }
                    } else {
                        if (data.successHandler) {
                            data.successHandler();
                        }
                    }
                    setInProgress($this, false);
                }
            });
            setInProgress($this, true);
        }
        event.preventDefault();
    };

    function makePair(first, second) {
        return first + "##" + second;
    }

    return {
        init: function (selector, resetLinkStateEventName, onUrlCallFinished) {
            var $selector = $(selector);
            if (resetLinkStateEventName) {
                var pair = makePair(resetLinkStateEventName, selector);
                if (!(pair in registeredResetLinkStateHandlers)) {
                    $("body").bind(resetLinkStateEventName, function () {
                        $selector.filter(":visible").each(function () {
                            setInProgress($(this), false);
                        });
                    });
                    registeredResetLinkStateHandlers[pair] = true;
                }
            }

            $(document)
                .off("click", selector, onAsynchronousLinkClick)
                .on("click", selector, {
                    successHandler: onUrlCallFinished,
                    failureHandler: onUrlCallFinished
                }, onAsynchronousLinkClick);
        }
    }
}(AJS.$);



/**
 * JobResultSummary page
 */
var JobResultSummaryLiveActivity = function ($) {
    var opts = {
        buildResultKey: null,
        buildLifeCycleState: null,
        container: null,
        getBuildUrl: null,
        reloadUrl: null,
        templates: {
            disabledStopButton: null,
            logTableRow: null,
            progressOverAverage: null,
            progressUnderAverage: null,
            queueDurationDescription: null,
            queuePositionDescription: null,
            updatingSourceFor: null
        }
    },
    linesOfLogToDisplay = 10,
    $linesOfLogToDisplaySelect,
    $logBody,
    $logContainer,
    $logLoading,
    $progressBarContainer,
    $queueDurationDescriptionContainer,
    $queuePositionDescriptionContainer,
    queueDuration,
    updateTimeout,
    update = function () {

        clearTimeout(updateTimeout);

        var ajaxData = $logContainer.is(":visible") ? {
            expand: 'logEntries[-' + linesOfLogToDisplay + ':]',
            'max-results': linesOfLogToDisplay
        } : {};

        $.ajax({
            url: opts.getBuildUrl,
            data: ajaxData,
            dataType: "json",
            contentType: "application/json",
            cache: false,
            success: function (buildResult) {
                if (buildResult.lifeCycleState != opts.buildLifeCycleState) {
                    document.location = opts.reloadUrl;
                    return;
                } else if (buildResult.lifeCycleState == "Pending" || buildResult.lifeCycleState == "Queued") {
                    if (queueDuration != buildResult.queueDuration) {
                        var queueDurationMarkup = AJS.template.load(opts.templates.queueDurationDescription)
                                .fill({ durationDescription: DurationUtils.getPrettyPrint(buildResult.queueDuration)}).toString();
                        $queueDurationDescriptionContainer.html(queueDurationMarkup);
                        $queueDurationDescriptionContainer.show();
                        queueDuration = buildResult.queueDuration;
                    }

                    var queuePositionMarkup = AJS.template.load(opts.templates.queuePositionDescription)
                            .fill({
                                position: buildResult.queue.position + 1,
                                length: buildResult.queue.length
                            }).toString();
                    $queuePositionDescriptionContainer.html(queuePositionMarkup);
                    $queuePositionDescriptionContainer.show();

                } else if (buildResult.lifeCycleState == "InProgress") {
                    if (buildResult.progress) {

                        var pbOptions = {};

                        if (buildResult.buildStartedTime) {
                            pbOptions.value = buildResult.progress.percentageCompleted * 100;
                            if (buildResult.progress.isUnderAverageTime) {
                                pbOptions.text = AJS.template.load(opts.templates.progressUnderAverage).fill({
                                    elapsed: buildResult.progress.prettyBuildTime,
                                    remaining: buildResult.progress.prettyTimeRemainingLong
                                }).toString();
                            } else {
                                pbOptions.text = AJS.template.load(opts.templates.progressOverAverage).fill({
                                    elapsed: buildResult.progress.prettyBuildTime,
                                    remaining: buildResult.progress.prettyTimeRemainingLong
                                }).toString();
                            }
                        } else {
                            pbOptions.value = 0;
                            pbOptions.text = AJS.template.load(opts.templates.updatingSourceFor).fill({
                                prettyVcsUpdateDuration: buildResult.prettyVcsUpdateDuration
                            }).toString();
                        }

                        $progressBarContainer.progressBar(pbOptions);
                    }

                    if (buildResult.logEntries && buildResult.logEntries.logEntry) {

                        var newLogBody = '';

                        for (var i = 0, ii = buildResult.logEntries.logEntry.length; i < ii; i++) {
                            var logEntry = buildResult.logEntries.logEntry[i];
                            newLogBody += AJS.template.load(opts.templates.logTableRow)
                                    .fill({ time: logEntry.formattedDate })
                                    .fillHtml({ log: logEntry.log }).toString();
                        }
                        if ($logBody.html() != newLogBody) {
                            $logBody.html(newLogBody);
                        }
                        if ($logLoading.is(":visible")) {
                            $logLoading.hide();
                            $logBody.parent().removeClass("hidden");
                        }
                    }
                }

                // Update again in 5 seconds
                updateTimeout = setTimeout(update, BAMBOO.fastServerPollMillis);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                // Error occurred when doing the update, try again in 30 sec
                updateTimeout = setTimeout(update, BAMBOO.afterErrorServerPollMillis);
            }
        });
    };
    return {
        init: function (options) {
            $.extend(true, opts, options);

            $linesOfLogToDisplaySelect = $("#linesToDisplay");
            $logBody = $("#buildLog tbody");
            $logContainer = $logBody.parent().parent();
            $logLoading = $(".loading", $logContainer[0]);
            $progressBarContainer = $("#pb" + opts.buildResultKey);
            $queueDurationDescriptionContainer = $("#queueDurationDescription");
            $queuePositionDescriptionContainer = $("#queuePositionDescription");

            // Get our default in line with what was set previously
            linesOfLogToDisplay = $linesOfLogToDisplaySelect.val();

            $linesOfLogToDisplaySelect.change(function () {
                linesOfLogToDisplay = $(this).val();
                saveCookie("BAMBOO-MAX-DISPLAY-LINES", linesOfLogToDisplay, 365);
                update();
            });

            if (opts.templates.disabledStopButton)
            {
                var disabledStopHTML = opts.templates.disabledStopButton.toString();
                $("#buildResults a.build-stop").live("click", function (e) {
                    var $el = $(this);
                    $.post(this.href);
                    $el.replaceWith(disabledStopHTML);
                    e.preventDefault();
                });
            }

            // Trigger the first update
            update();
        }
    }
}(jQuery);


var DurationUtils = function() {
    var opts = {
        format: "{value} {unit}",
        units: {
            SEC: ["second", "seconds"],
            MIN: ["minute", "minutes"]
        }
    },
    MILLIS_IN_MINUTE = 60 * 1000,
    MILLIS_IN_SECOND = 1000,
    describeValueAs = function(value, unit) {
        return opts.format.replace("{value}", value).replace("{unit}", value == 1 ? unit[0] : unit[1]);
    };
    return {
        init: function (options) {
            $.extend(true, opts, options);
        },
        getPrettyPrint: function(elapsedTimeMillis) {
            if (elapsedTimeMillis >= MILLIS_IN_MINUTE) {
                return describeValueAs(Math.floor(elapsedTimeMillis / MILLIS_IN_MINUTE), opts.units.MIN)
            } else if (elapsedTimeMillis >= MILLIS_IN_SECOND) {
                return describeValueAs(Math.floor(elapsedTimeMillis / MILLIS_IN_SECOND), opts.units.SEC)
            } else {
                return "< 1 {unit}".replace("{unit}", opts.units.SEC[0]);
            }
        }
    }
}();

/**
 * BuildResultSummary page
 */
var BuildResultSummaryLiveActivity = function ($) {
    var opts = {
        getBuildUrl: null,
        activeJobResultKey: null,
        templates: {
            logMessagePending: null,
            logMessageQueued: null,
            logMessageFinished: null,
            logTableRow: null
        }
    },
    displayLogActivity = function(logBody) {
        $logMessage.hide();
        $logLoading.hide();
        if ($logBody.html() != logBody) {
            $logBody.html(logBody);
        }
        $logBody.parent().show();
        $logContainer.show();
    },
    displayLogLoading = function() {
        $logMessage.hide();
        $logBody.parent().hide();
        $logLoading.show();
        $logContainer.show();
    },
    displayLogMessage = function(template) {
        $logContainer.hide();
        $logMessage.html(AJS.template.load(template).fill({job: jobName})).show();
    },
    $jobResultKeyForLogDisplaySelect,
    jobResultKey,
    jobName,
    linesOfLogToDisplay = 10,
    $linesOfLogToDisplaySelect,
    $logBody,
    $logContainer,
    $logLoading,
    $logMessage,
    updateTimeout,
    update = function () {

        clearTimeout(updateTimeout);

        $.ajax({
            url: opts.getBuildUrl.replace("@KEY@", jobResultKey),
            data: {
                expand: 'logEntries[-' + linesOfLogToDisplay + ':]',
                'max-results': linesOfLogToDisplay
            },
            dataType: "json",
            contentType: "application/json",
            cache: false,
            success: function (buildResult) {
                if (buildResult.lifeCycleState == "Pending") {
                    displayLogMessage(opts.templates.logMessagePending);
                } else if (buildResult.lifeCycleState == "Queued") {
                    displayLogMessage(opts.templates.logMessageQueued);
                } else if (buildResult.lifeCycleState == "InProgress") {
                    if (buildResult.logEntries && typeof(buildResult.logEntries.logEntry) != "undefined") {
                        var newLogBody = '';
                        for (var i = 0, ii = buildResult.logEntries.logEntry.length; i < ii; i++) {
                            var logEntry = buildResult.logEntries.logEntry[i];
                            newLogBody += AJS.template.load(opts.templates.logTableRow)
                                    .fill({ time: logEntry.formattedDate })
                                    .fillHtml({ log: logEntry.log }).toString();
                        }
                        displayLogActivity(newLogBody);
                    } else {
                        displayLogLoading();
                    }
                } else if (buildResult.lifeCycleState == "Finished") {
                    displayLogMessage(opts.templates.logMessageFinished);
                }

                // Update again in 5 seconds
                updateTimeout = setTimeout(update, BAMBOO.fastServerPollMillis);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                // Error occurred when doing the update, try again in 30 sec
                updateTimeout = setTimeout(update, BAMBOO.afterErrorServerPollMillis);
            }
        });
    };
    return {
        init: function(options) {
            $.extend(true, opts, options);
            $jobResultKeyForLogDisplaySelect = $("#jobResultKeyForLogDisplay");
            $linesOfLogToDisplaySelect = $("#linesToDisplay");
            $logContainer = $("#buildResultSummaryLogs");
            $logBody = $("table > tbody", $logContainer[0]);
            $logLoading = $(".loading", $logContainer[0]);
            $logMessage = $("#buildResultSummaryLogMessage");

            // Get our default in line with what was set previously
            linesOfLogToDisplay = $linesOfLogToDisplaySelect.val();

            $jobResultKeyForLogDisplaySelect.change(function () {
                jobResultKey = $jobResultKeyForLogDisplaySelect.val();
                jobName = $jobResultKeyForLogDisplaySelect.find("option:selected").text();
                update();
            });

            $linesOfLogToDisplaySelect.change(function () {
                linesOfLogToDisplay = $linesOfLogToDisplaySelect.val();
                saveCookie("BAMBOO-MAX-DISPLAY-LINES", linesOfLogToDisplay, 365);
                update();
            });

            // Trigger the first update
            if (opts.activeJobResultKey) {
                $jobResultKeyForLogDisplaySelect.val(opts.activeJobResultKey);
            }
            $jobResultKeyForLogDisplaySelect.change();
        }
    }
}(jQuery);


var ChainConfiguration = function ($) {
    var opts = {
        $list: null,
        moveStageUrl: null,
        moveJobUrl: null,
        confirmStageMoveUrl: null,
        confirmJobMoveJobUrl: null,
        chainKey: null,
        canReorder: false,
        stageMoveHeader: "Move Stage",
        jobMoveHeader: "Move Job"
    };
    return {
        init: function (options) {
            $.extend(true, opts, options);
            opts.$list.children(":last-child").addClass("last");

            if (!opts.canReorder) {
                return;
            }

            opts.$list.sortable({
                cursor: "move",
                distance: 5,
                handle: "dl",
                start: function (event, ui) {
                    var $self = $(ui.item);
                    $self.data("movedFromPos", $self.prevAll().length);
                },
                update: function (event, ui) {
                    var $self = $(ui.item),
                        revertMove = function(index) {
                            if ((opts.$list.children().length - 1) == $self.data("movedFromPos")) {
                                $self.appendTo(opts.$list).removeData("movedFromPos");
                            } else {
                                $self.insertBefore(opts.$list.children("li:eq(" + ($self.data("movedFromPos") + (($self.data("movedFromPos") > index)?1:0)) + ")")).removeData("movedFromPos");
                            }
                        },
                        showError = function () {
                            var message = arguments.length ? arguments[0] : "There was a problem moving your stage.",
                                errorDialog = new AJS.Dialog(550, 300);
                            errorDialog.addHeader("Stage move failed").addPanel("errorPanel", '<div class="fieldError errorText">' + message + '</div>').addButton("Close", function (dialog) {
                                dialog.hide();
                            });
                            errorDialog.show();
                            revertMove();
                        },
                        callMoveAction = function() {
                            var stageId = $self.attr("id").split("_")[1],
                                index = $self.prevAll().length;
                            $.ajax({
                                type: "POST",
                                url: opts.moveStageUrl,
                                data: { buildKey: opts.chainKey, stageId: stageId, index: index},
                                success: function (json) {
                                    if (json.status == "ERROR") {
                                        if (json.errors && json.errors.length > 0) {
                                            var message = json.errors.join("<br>");
                                            showError(message);
                                        } else {
                                            showError();
                                        }
                                    } else if (json.status == "CONFIRM") {
                                        var cancelCallback = function (dialog) {
                                            revertMove(index);
                                        };
                                        simpleDialogForm(null, opts.confirmStageMoveUrl + "?buildKey=" + opts.chainKey + "&stageId=" + stageId + "&index=" + index, 600, 500, opts.stageMoveHeader, "ajax", null, cancelCallback, opts.stageMoveHeader);
                                    } else {
                                        opts.$list.children(":last-child").addClass("last").siblings().removeClass("last");
                                    }
                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    showError();
                                },
                                dataType: "json"
                            });
                        };
                    callMoveAction();
                }
            });

            var jobLists = opts.$list.find("> li > div > ul");
            jobLists.children("[id^='job_']").draggable({
                cursor: "move",
                handle: ".handle",
                revert: "invalid",
                revertDuration: 300,
                scope: "jobs",
                start: function (event, ui) {
                    var $self = $(this);
                    $self.data("movedFrom", $self.parent()).data("movedFromPos", $self.prevAll().length);

                    // Add a z-index to the stage when someone drags a job to fix IE7's crappy stacking
                    if ($.browser.msie && parseInt($.browser.version, 10) == 7) {
                        $self.closest("li[id^='stage_']").css("zIndex", 1).siblings().css("zIndex", "")
                    }
                }
            });
            jobLists.droppable({
                accept: function (li) {
                    return (this != li.parent()[0]); // prevents being able to drop to the same stage
                },
                activeClass: "ui-state-active",
                drop: function (event, ui) {
                    var $self = ui.draggable,
                        revertMove = function () {
                            var $originalFollowingElement = $self.data("movedFrom").children("li:eq(" + $self.data("movedFromPos") + ")");
                            if ($originalFollowingElement.length == 0)  {
                                $self.appendTo($self.data("movedFrom")).removeData("movedFrom").removeData("movedFromPos");
                            } else  {
                                $self.insertBefore($originalFollowingElement).removeData("movedFrom").removeData("movedFromPos");
                            }
                        },
                        showError = function () {
                            var message = arguments.length ? arguments[0] : "There was a problem moving your Job.",
                                errorDialog = new AJS.Dialog(400, 150);

                            errorDialog.addHeader("Job move failed").addPanel("errorPanel", '<div class="fieldError errorText">' + message + '</div>').addButton("Close", function (dialog) {
                                 dialog.hide();
                            });
                            errorDialog.show();
                            revertMove();
                        },
                        callMoveAction = function() {
                            var stageId = $self.closest("li[id^='stage_']").attr("id").split("_")[1],
                                jobKey = $self.attr("id").split("_")[1];
                            $.ajax({
                                type: "POST",
                                url: opts.moveJobUrl,
                                data: { buildKey: opts.chainKey, stageId: stageId, jobKey: jobKey },
                                success: function (json) {
                                    if (json.status == "ERROR") {
                                        if (json.errors && json.errors.length > 0) {
                                            var message = json.errors.join("<br>");
                                            showError(message);
                                        } else {
                                            showError();
                                        }
                                    } else if (json.status == "CONFIRM") {
                                        var cancelCallback = function () {
                                            revertMove();
                                        };
                                        simpleDialogForm(null, opts.confirmJobMoveJobUrl + "?buildKey=" + opts.chainKey + "&stageId=" + stageId + "&jobKey=" + jobKey, 600, 500, opts.jobMoveHeader, "ajax", null, cancelCallback, opts.jobMoveHeader);
                                    }
                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    showError();
                                },
                                dataType: "json"
                            });
                        };
                    $self.prependTo(this).css({ left: "", top: "" });
                    callMoveAction();
                },
                hoverClass: "ui-state-hover",
                scope: "jobs"
            });
        }
    }
}(jQuery);

var ArtifactDefinitionEdit = function ($) {
    var opts = {
        html: {
            artifactSharingToggleContentShared: null,
            artifactSharingToggleContentUnshared: null
        },
        i18n: {
            artifact_definition_shareToggle_error: null,
            artifact_definition_shareToggle_error_header: null,
            global_buttons_close: null
        },
        deletePackageItem: {
            actionUrl: null,
            submitLabel: null,
            title: null
        },
        editPackageItem: {
            actionUrl: null,
            submitLabel: null,
            title: null
        },
        renameArtifactDefinitionToEnableSharing: {
            actionUrl: null,
            submitLabel: null,
            title: null
        },
        toggleArtifactDefinitionSharing: {
            actionUrl: null,
            submitLabel: null,
            title: null
        },
        confirmToggleArtifactDefinitionSharing: {
            actionUrl: null,
            submitLabel: null,
            title: null
        }
    },
    $artifactDefinitionsTable,
    deleteArtifactDefinitionCallback = function (result) {
        var artifact = result.artifactDefinition;

        (($("tbody > tr", $artifactDefinitionsTable).length == 1) ? $artifactDefinitionsTable : $("#artifactDefinition-" + artifact.id)).remove();
    },
    deleteArtifactDefinitionOnClick = function() {
        var artifactId = this.id.split("-")[1],
            hasDependencies = $(this).hasClass("hasDependencies");

        simpleDialogForm(null,
                         opts.deletePackageItem.actionUrl + "&artifactId=" + artifactId,
                         hasDependencies ? 600 : 400,
                         hasDependencies ? 500 : 200,
                         opts.deletePackageItem.submitLabel,
                         "ajax",
                         deleteArtifactDefinitionCallback,
                         null,
                         opts.deletePackageItem.title,
                         null);
    },
    editArtifactDefinitionOnClick = function() {
        var artifactId = this.id.split("-")[1];

        simpleDialogForm(null,
                         opts.editPackageItem.actionUrl + "&artifactId=" + artifactId,
                         800,
                         600,
                         opts.editPackageItem.submitLabel,
                         "ajax",
                         updateArtifactDefinitionCallback,
                         null,
                         opts.editPackageItem.title,
                         null);
    },
    toggleArtifactDefinitionSharingOnClick = function() {
        var artifactId = this.id.split("-")[1],
            showError = function () {
                var message = arguments.length ? arguments[0] : opts.i18n.artifact_definition_shareToggle_error,
                    errorDialog = new AJS.Dialog(400, 150);
                errorDialog.addHeader(opts.i18n.artifact_definition_shareToggle_error_header)
                        .addPanel("errorPanel", '<div class="fieldError errorText">' + message + '</div>')
                        .addCancel(opts.i18n.global_buttons_close, function (dialog) { dialog.hide(); })
                        .show();
            };

        AJS.$.ajax({
            type: "POST",
            url: opts.toggleArtifactDefinitionSharing.actionUrl,
            data: { artifactId: artifactId },
            success: function (json) {
                if (json.status == "ERROR") {
                    if (json.errors && json.errors.length) {
                        showError(json.errors.join("<br>"));
                    } else if (json.fieldErrors) {
                        if (json.fieldErrors.name && json.fieldErrors.name.length) {
                            simpleDialogForm(null,
                                             opts.renameArtifactDefinitionToEnableSharing.actionUrl + "&artifactId=" + artifactId,
                                             700, 300,
                                             opts.renameArtifactDefinitionToEnableSharing.submitLabel,
                                             "ajax",
                                             updateArtifactDefinitionCallback, null,
                                             opts.renameArtifactDefinitionToEnableSharing.title);
                        } else {
                            var errorMessages = [];
                            for (var fieldError in json.fieldErrors) {
                                errorMessages.push(json.fieldErrors[fieldError].join("<br>"));
                            }
                            showError(errorMessages.join("<br>"));
                        }
                    } else {
                        showError();
                    }
                } else {
                    if (json.status == "CONFIRM") {
                        simpleDialogForm(null,
                                         opts.confirmToggleArtifactDefinitionSharing.actionUrl + "&artifactId=" + artifactId,
                                         600, 500,
                                         opts.confirmToggleArtifactDefinitionSharing.submitLabel,
                                         "ajax",
                                         updateArtifactDefinitionCallback, null,
                                         opts.confirmToggleArtifactDefinitionSharing.title);
                    } else {
                        updateArtifactDefinitionCallback(json);
                    }
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                showError();
            },
            dataType: "json"
        });
    },
    updateArtifactDefinitionCallback = function (result) {
        var artifact = result.artifactDefinition,
            $cells = $("#artifactDefinition-" + artifact.id + " > td");

        $($cells[0]).find("span.artifactName").text(artifact.name);
        $($cells[0]).find("span.icon").attr("class", artifact.sharedArtifact ? "icon icon-artifact-shared" : "icon icon-artifact");

        $($cells[1]).text(artifact.location);
        $($cells[2]).text(artifact.copyPattern);

        $("#toggleArtifactDefinitionSharing-" + artifact.id).html(artifact.sharedArtifact ? opts.html.artifactSharingToggleContentShared : opts.html.artifactSharingToggleContentUnshared);

        $artifactDefinitionsTable.trigger("update").trigger("sorton", [$artifactDefinitionsTable.get(0).config.sortList]);
    };

    return {
        init: function (options) {
            $.extend(true, opts, options);

            $artifactDefinitionsTable = $("#artifactDefinitions");

            // initialize table sorter
            $artifactDefinitionsTable.tablesorter({
                headers: {3:{sorter:false},4:{sorter:false}},
                sortList: [[0,0]]
            });
            $artifactDefinitionsTable.delegate("a.deleteArtifactDefinition", "click", deleteArtifactDefinitionOnClick)
                                     .delegate("a.editArtifactDefinition", "click", editArtifactDefinitionOnClick)
                                     .delegate("a.toggleArtifactDefinitionSharing", "click", toggleArtifactDefinitionSharingOnClick);
        }
    }
}(jQuery);


var LinkedJiraProjects = function ($) {
    var defaults = {
        deleteItem: {
            title: null
        }
    },
    $table,
    deleteItemCallback = function (result) {
        var item = result.linkedJiraProject;
        (($("tbody > tr", $table).length == 1) ? $table : $(BAMBOO.escapeIdToJQuerySelector("#linkedJiraProject-" + item.id))).remove();
    };

    return {
        init: function (options) {
            options = AJS.$.extend(defaults, options);

            $table = $("#linkedJiraProjects");

            // initialize table sorter
            $table.tablesorter({
                headers: {2:{sorter:false}},
                sortList: [[0,0]]
            });

            BAMBOO.simpleDialogForm({
                trigger: '#linkedJiraProjects a.deleteLinkedJiraProject',
                dialogWidth: 400,
                dialogHeight: 200,
                success: deleteItemCallback,
                header: options.deleteItem.title
            });
        }
    }
}(jQuery);


/* Tests Tables */
AJS.$(document).delegate(".tests-table > tbody > tr > .twixie > span", "click", function (e) {
    var $twixie = AJS.$(this),
        $tr = $twixie.closest("tr"),
        $stack = $tr.next(),
        newTwixieText = !$twixie.hasClass("icon-collapse") ? "Collapse" : "Expand"; //negated because we toggle the class later
    $stack[$tr.hasClass("collapsed") ? "show" : "hide"]();
    $tr.toggleClass("collapsed expanded");
    $twixie.toggleClass("icon-collapse icon-expand").attr("title", newTwixieText).html("<span>" + newTwixieText + "</span>");
});
AJS.$(document).delegate(".tests-table-container > .controls li", "click", function (e) {
    var $trigger = AJS.$(this),
        $li = $trigger.closest("li"),
        $table = $trigger.closest(".controls").prevAll(".tests-table");
    if ($li.hasClass("expand-all")) {
        $table.find("tbody > .collapsed .twixie > span").click();
    } else if ($li.hasClass("collapse-all")) {
        $table.find("tbody > .expanded .twixie > span").click();
    }
});


/**
 * Strip given prefix from input.
 * Can handle String and jQuery object input.
 *
 * @param prefix String                   prefix to be stripped from input
 * @param input  String or jQuery object
 */
BAMBOO.stripPrefixFromId = function(prefix, input) {
    if (typeof(input) == 'string') {
        if (input.indexOf(prefix) == 0) {
            return input.slice(prefix.length);
        } else {
            return input;
        }
    } else {
        return this.stripPrefixFromId(prefix, AJS.$(input).attr("id"));
    }
};

/**
 * Unsafe (for jQuery id's) character regex
 * Reference: http://docs.jquery.com/Frequently_Asked_Questions#How_do_I_select_an_element_by_an_ID_that_has_characters_used_in_CSS_notation.3F
 */
BAMBOO.unsafeIdCharacterRegex = /(:|\.)/g;

/**
 * Escape characters in element id to use it as jQuery selector
 * @param id
 */
BAMBOO.escapeIdToJQuerySelector = function(id) {
    return id.replace(BAMBOO.unsafeIdCharacterRegex, '\\$1');
};

BAMBOO.buildAUIMessage = function (messages, type, opts) {
    var defaults = {
            escapeTitle : true
        },
        options = AJS.$.extend(true, defaults, opts),
        msg,
        $dummy = AJS.$('<div/>');
    if (messages.length == 1) {
        msg = (options.escapeTitle ? messages[0] : '<strong>' + messages[0] + '</strong>');
        AJS.messages[type]($dummy, (options.escapeTitle ? {title: msg, closeable: false} : {body: msg, closeable: false}));
    } else if (messages.length > 1) {
        var list = ['<ul>'];
        for (var i = 0, ii = messages.length; i < ii; i++) {
            list.push('<li>', messages[i], '</li>');
        }
        list.push('</ul>');
        AJS.messages[type]($dummy, {body: list.join(''), closeable: false});
    }
    return $dummy.children();
};

BAMBOO.buildAUIErrorMessage = function(errors) {
    return BAMBOO.buildAUIMessage(errors, 'error', {});
};

BAMBOO.buildAUIWarningMessage = function(warnings) {
    return BAMBOO.buildAUIMessage(warnings, 'warning', {});
};

BAMBOO.buildFieldError = function(errors) {
    var $dummy = AJS.$('<div/>');
    for (var i = 0, ii = errors.length; i < ii; i++) {
        $dummy.append(AJS.$('<div class="error"/>').html(errors[i]));
    }
    return $dummy.children();
};

/**
 * Add errors to a form field
 * @param $form
 * @param fieldName
 * @param {Array} errors
 * @param {boolean=} animate - display the error(s) with an animation
 */
BAMBOO.addFieldErrors = function($form, fieldName, errors, animate) {
    var $field = AJS.$('#fieldArea_' + $form.attr('id') + '_' + fieldName.replace(BAMBOO.addFieldErrorsFieldNameRegex, "_")),
        $input = AJS.$('#' + $form.attr('id') + '_' + fieldName.replace(BAMBOO.addFieldErrorsFieldNameRegex, "_")),
        $description = $field.find('.description'),
        $errors = BAMBOO.buildFieldError(errors);

    if (animate) {
        $errors.hide();
    }
    if ($description.length) {
        $description.before($errors);
    } else if ($field.length) {
        $field.append($errors);
    } else {
        $input.after($errors);
    }
    if (animate) {
        $errors.slideDown();
    }
};
BAMBOO.addFieldErrorsFieldNameRegex = /\./g;

(function ($) {
    var i18nCollapse = "Collapse",
        i18nExpand = "Expand";

    $(document).delegate(".collapsible-section > .summary > h3, .collapsible-section > .summary > .icon", "click", function (e) {
        var $summary = $(this).parent(),
            $section = $summary.closest(".collapsible-section"),
            $details = $section.children(".collapsible-details"),
            $icon = $summary.children(".icon");

        if ($section.hasClass("collapsed")) {
            $icon.addClass("icon-collapse").removeClass("icon-expand").attr({ title: i18nCollapse }).children().text(i18nCollapse);
            $details.stop(true, true).slideDown(function() {
                $section.removeClass("collapsed");
            });
        } else {
            $icon.addClass("icon-expand").removeClass("icon-collapse").attr({ title: i18nExpand }).children().text(i18nExpand);
            $details.stop(true, true).slideUp(function() {
                $section.addClass("collapsed");
            });
        }
    });
})(AJS.$);

/**
 * TODO: extend this with automatic link adding (which will work also for AJAX loaded forms).
 */
BAMBOO.JdkBuilderSelectWidget = function(options) {
    var opts = {
            dialog: {
                height: 320,
                width: 540
            }
        };

    AJS.$.extend(true, opts, options);

    BAMBOO.simpleDialogForm({
        trigger: options.clickTarget,
        dialogWidth: opts.dialog.width,
        dialogHeight: opts.dialog.height,
        success: function(result) {
            AJS.$(opts.displayTarget).append(AJS.$("<option />", { val: result.capability.label, text: result.capability.label })).val(result.capability.label);
        }
    });
};

AJS.$(function ($) {
    addConfirmationToLinks();

    /* Default options for jQuery's tablesorter plugin */
    if ($.tablesorter) {
        // use 'zebra' plugin by default
        $.tablesorter.defaults.widgets = ['zebra'];
        // use AUI compatible classes
        $.tablesorter.defaults.widgetZebra = {css: ['', 'zebra']};
    }

    // Drop down for user profile
    AJS.$("#header > .global > .secondary .aui-dd-parent").dropDown("Standard", { trigger: "span.aui-dd-trigger" });
});

BAMBOO.JdkBuilderSelectWidget({clickTarget: "a.addSharedJdkCapability", displayTarget: "select.jdkSelectWidget"});
BAMBOO.JdkBuilderSelectWidget({clickTarget: "a.addSharedBuilderCapability", displayTarget: "select.builderSelectWidget"});

/**
 * Small jQuery method to check if the element has been clipped (content breaking outside it's bounding box) or not
 */
jQuery.fn.isClipped = function () {
    var $el = this.filter(':first');
    return ($el.prop('scrollWidth') > $el.prop('clientWidth'));
};

BAMBOO.openJiraIssueTransitionDialog = function(e) {
    e.preventDefault();
    var $trigger = AJS.$(this),
            dialog = new AJS.Dialog({
                width: 720,
                height: 350,
                keypressListener: function (e) {
                    if (e.which == jQuery.ui.keyCode.ESCAPE) {
                        dialog.remove();
                    }
                }
            });
    dialog.addHeader("Transition Issue").addCancel("Done", function () {
//      dialog.remove();
        reloadThePage();
    });
    AJS.$.ajax({
        url: $trigger.attr("href"),
        data: { 'bamboo.successReturnMode': 'json', decorator: 'rest', confirm: true },
        success: function (html) {
            var $html = AJS.$(html);

            dialog.addPanel("", $html).show();
            BAMBOO.JIRAISSUETRANSITION.init({
                issueKey: $trigger.attr("issueKey"),
                returnUrl: $trigger.attr("returnUrl")
            });
        },
        cache: false
    });
};

BAMBOO.isFlashInstalled = (function() {
    var flashInstalled = function(a,b){try{a=new ActiveXObject(a+b+'.'+a+b)}catch(e){a=navigator.plugins[a+' '+b]}return!!a}('Shockwave','Flash')
    if (!flashInstalled) {
        AJS.$('html').addClass("no-flash");
    }
    return flashInstalled;
}());

(function ($) {
    $(document).on('aui-message-close', function(e,a) {
        if (a.hasClass('system-error-message')) {
            var $link = a.find('.system-error-message-remove');
            if ($link.length) {
                $.post($link.attr('href'));
            }
        }
    });
}(AJS.$));

// trigger analytics event when clicked element with 'data-bamboo-analytics-event' attribute
(function ($) {
    $(document).on('click', '[data-bamboo-analytics-event]', function() {
        AJS.trigger('analytics', $.parseJSON($(this).attr('data-bamboo-analytics-event')));
    });
}(AJS.$));

(function($) {
    $.ajaxSetup({
        cache: false
    });
}(AJS.$));;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/dynamic-field-parameters.js' */
BAMBOO.DynamicFieldParameters = (function ($) {
    var handleOnSelectShowHideSelector = ".handleOnSelectShowHide",
        handleDynamicDescriptionSelector = ".handleDynamicDescription",
        // lifted straight from jQuery, just changed the order
        fxAttrs = [
            // height animations
            [ "height", "marginTop", "marginBottom", "paddingTop", "paddingBottom" ],
            // opacity animations
            [ "opacity" ],
            // width animations
            [ "width", "marginLeft", "marginRight", "paddingLeft", "paddingRight" ]
        ],
        // object to handle the methods we make 'public'
        ret = {};

    /**
     * Handles form select field dynamic description updating
     */
    function handleDynamicSelectDescription() {
        var $select = $(this);

        $select.nextAll(".description").html($select.find("option:selected").attr("data-dynamic-select-description") || null);
    }

    /**
     * Syncs form display states for handleOnSelectShowHide fields and select field dynamic description updating
     * @param context (optional) - DOM Element, Document or jQuery object to use as context
     * @param animate (optional) - force transition animations
     */
    ret.syncFieldShowHide = function (context, animate) {
        if (typeof context === "boolean") {
            animate = context;
            context = null;
        }
        $(".handleOnSelectShowHide", context).each(function () { handleOnSelectShowHide.call(this, animate); });
        $(handleDynamicDescriptionSelector, context).each(handleDynamicSelectDescription);
    };

    function escapeCss(str) {
        var charsToEscape = /[!"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~]/g; //from jQuery docs
        return str.replace(charsToEscape, '\\$&');
    }

    /**
     * Runs on a change of a field
     */
    function handleOnSelectShowHide(e) {
        var $el = $(this),
            dependsOnSelector = (".dependsOn" + escapeCss($el.prop("name") || "")),
            switchValue = getSwitchValue($el),
            showPattern, hidePattern,
            useAnimations = (e instanceof jQuery.Event || (typeof e === "boolean" && e)),
            showFn = !useAnimations ? jQuery.fn.show : function () {
                this.animate(genFx("show", 2), function () { $(this).show(); });
            },
            hideFn = !useAnimations ? jQuery.fn.hide : function () {
                this.animate(genFx("hide", 2), function () { $(this).hide(); });
            };

        if (!(!switchValue && $el.is(":radio"))) {
            showPattern = "showOn" + switchValue;
            hidePattern = "showOn__" + switchValue;

            $el.closest("form").find(dependsOnSelector).each(function () {
                var $deps = $(this);

                if ($deps.prop("class").indexOf("showOn__") != -1) {
                    if ($deps.hasClass(hidePattern)) {
                        hideFn.call($deps);
                    } else {
                        showFn.call($deps);
                    }
                } else {
                    if ($deps.hasClass(showPattern)) {
                        showFn.call($deps);
                    } else {
                        hideFn.call($deps);
                    }
                }
                if ($deps.hasClass(hidePattern)) {
                    hideFn.call($deps);
                }
            });
        }
    }

    /**
     * JSOn listData looks like:
     *
     *  [data: [{value: 'key1', text: 'name for the screen', supportedValues: ['dependencyKey1', 'dependencyKey2']},
     *   {value: 'key2', text: "name 2", supportedValues: ['dependencyKey1']}]]
     *
     * If supportedValues is empty it will be shown for all selections in selParentJQ.
     *
     * @param selParentJQ - the select list that the your data depends on
     * @param selToMutateJQ - the select list that you want to mutate based on the contents of the selDependency
     * @param listDataJson - the json containing all information required to generate the selToMutate
     */
    ret.mutateSelectListContent = function (selParentJQ, selToMutateJQ, listDataJson) {
        var selToMutate = selToMutateJQ[0],
            currentSelectedValue = selToMutateJQ.val(),
            switchValue = getSwitchValue(selParentJQ),
            listData = listDataJson.data;

        //wipe existing items
        selToMutate.options.length = 0;

        // go through selToMutate check if each item is in allowed Items, if not remove?
        for (var i = 0; i<listData.length; i++){
            var value = listData[i].value,
                text = listData[i].text,
                allowedOptions = listData[i].supportedValues,
                show = allowedOptions === null || allowedOptions.length <= 0 || !switchValue;

            if (!show) {
                for (var x = 0; x < allowedOptions.length; x++) {
                    var allowedOption = allowedOptions[x];
                    if (switchValue === allowedOption) {
                        show = true;
                        break;
                    }
                }
            }

            if (show) {
                selToMutate.options[selToMutate.options.length] = new Option(text, value, false, value === currentSelectedValue);
            }
        }

        // make sure we update the dependents of the mutated list.
        handleOnSelectShowHide.call(selToMutate)
    };

    function getSwitchValue($el) {
        if ($el.is("select") && $el.prop("selectedIndex") > -1) {
            var $opt = $el.find("option:selected").filter(":first"),
                optClass = $opt.prop("class");

            //  Special uiSwitch* class prefix
            if (optClass.indexOf('uiSwitch') != -1) {
                return optClass.substring(optClass.lastIndexOf("uiSwitch") + 8);
            } else {
                return $el.val();
            }
        } else if ($el.is(":radio") || $el.is(":checkbox")) {
            return ($el.is(":checked") ? $el.val() : false);
        } else {
            return $el.val();
        }
    }

    ret.selectFirstFieldOfForm = function (formId) {
        var $form = $("#" + formId),
            $firstError = $form.find(":input:visible:enabled.errorField:first").focus();

        if (!$firstError.length) {
            $form.find(":input:visible:enabled:first").focus();
        }
    };

    /** Generate parameters to create a standard animation
     * This has been lifted straight from jQuery
     * @param type
     * @param num
     */
    function genFx( type, num ) {
        var obj = {};

        jQuery.each( fxAttrs.concat.apply([], fxAttrs.slice(0,num)), function() {
            obj[ this ] = type;
        });

        return obj;
    }

    // handleOnSelectShowHide functionality
    $(document)
        .delegate('input' + handleOnSelectShowHideSelector, 'click', handleOnSelectShowHide)
        .delegate('select, input' + handleOnSelectShowHideSelector, 'change', handleOnSelectShowHide)
        .delegate(handleDynamicDescriptionSelector, 'change', handleDynamicSelectDescription);

    $(function () {
        ret.syncFieldShowHide();
    });

    return ret;
})(jQuery);;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/config-panel-editor.js' */
BAMBOO.ConfigPanelEditor = function () {
    var events = require('util/events');
    var $ = AJS.$,
        defaults = {
            editor: null,
            configContainer: null,
            itemList: null,
            deleteItemKey: null,
            configFormSuccess: $.noop,
            configFormWarnings: $.noop,
            checkListHasItems: $.noop,
            templates: {
                item: null,
                icon: null
            },
            i18n: {
                confirmAbandonItem: null,
                itemDeleteSuccess: null,
                sortingHasUnsavedItemError: null,
                sortingHasUnspecifiedError: null,
                sortingErrorDialogHeader: null,
                defaultDisplayText: null,
                defaultDisplayTextDescription: null
            },
            sortable: {
                enabled: true,
                items: "> li",
                moveItem: $.noop
            },
            deleteDialogHeight: 200,
            onShowData: null
        },
        options,
        $editor,
        $configContainer,
        $itemList,
        displayMessages = function (messages) {
            var $dummy = $("<div/>"),
                $messages,
                $form = $configContainer.children("form"),
                defaultMsgType = "success";

            for (var i = 0, ii = messages.length; i < ii; i++) {
                var message = messages[i],
                    msgType = message.type || defaultMsgType;
                
                AJS.messages[msgType]($dummy, { title: message.title, closeable: (msgType != defaultMsgType), body: message.body });
            }

            $messages = $dummy.children();

            if ($form.length) {
                $form.css("visibility", "hidden").slideUp(function () { $(this).remove(); }).before($messages);
            } else {
                $configContainer.append($messages);
            }

            $messages.filter("." + defaultMsgType).delay(3000).fadeOut(function () {
                $(this).remove();
            });
            insertDefaultText();
        },
        setFocus = function () {
            var $firstError = $configContainer.find(":input:visible:enabled.errorField:first").focus();

            if (!$firstError.length) {
                $configContainer.find(":input:visible:enabled:first").focus();
            }
        },
        insertDefaultText = function () {
            var noItemId = "no-item-selected",
                $noItem = $("#" + noItemId);

            if (!$noItem.length) {
                $noItem = $("<div/>", { "id": noItemId })
                    .append($("<h2/>", { text: options.i18n.defaultDisplayText }))
                    .append($("<p/>", { text: options.i18n.defaultDisplayTextDescription }))
                    .hide()
                    .prependTo($configContainer)
                    .fadeIn();
            }
            return $noItem;
        },
        setupAsyncForm = function ($item) {
            BAMBOO.asyncForm({
                $delegator: $configContainer,
                target: "form",
                success: function (data) {
                    var $newItem = options.configFormSuccess(data, $item.hasClass("unsaved"));
                    $item.replaceWith($newItem);
                    if (data.warnings) {
                        options.configFormWarnings(data.warnings);
                    }
                    setTimeout(function () { $newItem.removeClass("active"); }, 0); // this is so that the class doesn't get removed immediately after the DOM element is replaced which would causes the CSS transition (fading) not to be applied
                },
                cancel: function () {
                    $configContainer.children("form").css("visibility", "hidden").slideUp(function () {
                        $(this).remove();
                    });

                    // clean previous widgets
                    events.EventBus.trigger('unbind');

                    if ($item.hasClass("unsaved")) {
                        $item.remove();
                        checkListHasItems();
                    } else {
                        $item.removeClass("active");
                    }
                    insertDefaultText();
                },
                formReplaced: asyncFormReplaced
            });
        },
        asyncFormReplaced = function () {
            handleOnShow();
            setFocus();
        },
        showItemLoadingIndicator = function ($item) {
            var $configLink;
            if (!$item) {
                $item = $itemList.find('.active');
            }
            $configLink = $item.find("> a:not(.delete)");
            $(AJS.template.load(options.templates.icon).fill({ type: "loading" }).toString()).insertAfter($configLink);
        },
        hideItemLoadingIndicator = function ($item) {
            if (!$item) $item = $itemList.find('.active');
            $item.find(".icon-loading").remove();
        },
        hasUnsavedItem = function () {
            var $unsaved = $itemList.find(".unsaved");

            return ($unsaved.length ? $unsaved : false);
        },
        isOkayToProceedWithUnsavedItem = function () {
            var $unsavedItem = hasUnsavedItem();

            if ($unsavedItem) {
                if (confirm(options.i18n.confirmAbandonItem)) {
                    $unsavedItem.remove();
                    $configContainer.empty();
                    checkListHasItems();
                } else {
                    return false;
                }
            }
            return true;
        },
        checkListHasItems = function () {
            var hasItems = $itemList.children(".item").length;

            $editor.toggleClass("no-items", !hasItems);
            options.checkListHasItems(hasItems);
        },
        add = function (url, $item, attachMethod, attachTarget) {
            // clean previous widgets
            events.EventBus.trigger('unbind');

            return $.ajax({
                url: url,
                data: { decorator: 'nothing', confirm: true },
                success: function (html) {
                    $item[attachMethod](attachTarget).addClass("active unsaved").siblings().removeClass("active");
                    checkListHasItems();
                    $configContainer.html(html);
                    handleOnShow();
                    setupAsyncForm($item);
                    setFocus();
                    if (options.onShowData) {
                        options.onShowData();
                    }
                },
                cache: false
            });
        },
        edit = function (e) {
            var $item = $(this),
                $target = $(e.target),
                showData = function (html) {
                    $configContainer.html(html);
                    handleOnShow();
                    hideItemLoadingIndicator($item);
                    $item.addClass("active").siblings().removeClass("active");
                    setupAsyncForm($item);
                    setFocus();
                    if (options.onShowData) {
                        options.onShowData();
                    }
                };

            if (!$target.hasClass("delete") && !$target.hasClass("icon-delete") && !$target.is(":input")) {
                e.preventDefault();
                if ($item.hasClass("active") || !isOkayToProceedWithUnsavedItem()) {
                    setFocus();
                } else {
                    showItemLoadingIndicator($item);

                    // clean previous widgets
                    events.EventBus.trigger('unbind');

                    $.ajax({
                        url: $item.find("> a:not(.delete)").attr("href"),
                        data: { decorator: 'nothing', confirm: true },
                        success: showData,
                        error: function (data) {
                            showData(data.responseText ? data.responseText : data.responseXML);
                        },
                        cache: false
                    });
                }
            }
        },
        sortUpdate = function (event, ui) {
            if (hasUnsavedItem()) {
                alert(options.i18n.sortingHasUnsavedItemError);
                $itemList.sortable("cancel");
                return;
            }
            var $item = $(ui.item),
                showSortingError = function () {
                    var message = arguments.length ? arguments[0] : BAMBOO.buildAUIErrorMessage([ options.i18n.sortingHasUnspecifiedError ]),
                        errorDialog = new AJS.Dialog(400, 180),
                        index = $item.prevAll().length;

                    errorDialog.addHeader(options.i18n.sortingErrorDialogHeader).addPanel("errorPanel", message).addButton("Close", function (dialog) {
                        dialog.hide();
                    });
                    errorDialog.show();

                    if (($itemList.children().length - 1) == $item.data("movedFromPos")) {
                        $item.appendTo($itemList).removeData("movedFromPos");
                    } else {
                        $item.insertBefore($itemList.children("li:eq(" + ($item.data("movedFromPos") + (($item.data("movedFromPos") > index) ? 1 : 0)) + ")")).removeData("movedFromPos");
                    }
                },
                jqXHR = options.sortable.moveItem($item);

            if (jqXHR) {
                jqXHR.done(function (json) {
                    if (json.status == "ERROR") {
                        if (json.errors && json.errors.length) {
                            showSortingError(BAMBOO.buildAUIErrorMessage(json.errors));
                        } else {
                            showSortingError();
                        }
                    }
                }).fail(function () {
                    showSortingError();
                });
            }
        },
        sortStart = function (event, ui) {
            var $self = $(ui.item);

            $self.data("movedFromPos", $self.prevAll().length);
        },
        handleOnShow = function () {
            BAMBOO.DynamicFieldParameters.syncFieldShowHide($configContainer);
            AJS.messages.setup();
        };

    return {
        init: function (opts) {
            options = $.extend(true, defaults, opts);

            $(document)
                .delegate(options.itemList + " > .item", "click", edit)
                .delegate("#finalisePlanCreation, #finaliseJobCreation", "submit", function (e) {
                    if (!isOkayToProceedWithUnsavedItem()) {
                        e.preventDefault();
                    }
                });

            $(function () {
                $editor = $(options.editor);
                $configContainer = $(options.configContainer)
                    .delegate("form", "submit", function () {
                        showItemLoadingIndicator();

                        // clean previous widgets
                        events.EventBus.trigger('unbind');
                    })
                    .delegate("form", "asyncform-error asyncform-replaced", function () {
                        hideItemLoadingIndicator();
                    });
                $itemList = $(options.itemList);
                if (options.sortable.enabled) {
                    $itemList.sortable({
                        cursor: "move",
                        items: options.sortable.items,
                        update: sortUpdate,
                        start: sortStart
                    });
                }

                BAMBOO.simpleDialogForm({
                    $delegator: $itemList,
                    trigger: "a.delete",
                    dialogWidth: 540,
                    dialogHeight: options.deleteDialogHeight,
                    success: function (data) {
                        displayMessages([{ title: options.i18n.itemDeleteSuccess }]);
                        $("#item-" + data[options.deleteItemKey].id).remove();
                        checkListHasItems();
                        events.EventBus.trigger('config-panel-item-removed', data);
                    }
                });
                insertDefaultText();
            });
        },
        add: add,
        setFocus: setFocus,
        displayMessages: displayMessages,
        isOkayToProceedWithUnsavedItem: isOkayToProceedWithUnsavedItem,
        checkListHasItems: checkListHasItems,
        updateUnspecifiedSortingErrorText: function (updatedText) {
            options.i18n.sortingHasUnspecifiedError = updatedText;
        }
    }
};
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/tasks.js' */
BAMBOO.TASKS = {};

BAMBOO.TASKS.tasksConfig = function ($) {
    var events = require('util/events');
    var defaults = {
        addTaskTrigger: null,
        taskSetupContainer: null,
        taskConfigContainer: null,
        taskList: null,
        defaultTaskToSelect: null,
        taskTypeCategories: { categories: [] },
        taskTypesDialog: {
            id: "task-types-dialog",
            header: "Task types",
            width: 865,
            height: 530,
            filterForm: null
        },
        templates: {
            taskListItem: null,
            lozengeDisabled: null,
            iconTemplate: null,
            getMoreOnPac: null
        },
        i18n: {
            cancel: "Cancel",
            confirmAbandonTask: "The new task has not yet been saved. If you continue you will abandon the new task.\n\nAre you sure you want to continue?",
            tasksAddSuccess: "Task created successfully.",
            tasksAddSuccessWarning: "Possible conflicting requirements found.",
            tasksEditSuccess: "Task saved successfully.",
            tasksEditSuccessWarning: "Possible conflicting requirements found.",
            tasksDeleteSuccess: "Task deleted successfully.",
            sortingHasUnsavedTaskError: "Please save the new task before reordering.",
            sortingHasUnspecifiedError: "There was a problem moving your task.",
            sortingErrorDialogHeader: "Task move failed",
            defaultDisplayText: "No task selected",
            defaultDisplayTextDescription: "Select a task from the list on the left to configure it."
        },
        agentAvailabilityDescriptionContainer: null,
        agentAvailabilityDescriptionUrl: null,
        moveTaskUrl: null,
        moveFinalBarUrl: null
    },
    options,
    editor = new BAMBOO.ConfigPanelEditor(),
    $filterForm,
    $taskTypesDialog,
    $taskSetupContainer,
    $taskConfigContainer,
    $taskList,
    $loadingIndicator,
    $finalTasksBar,
    taskTypesDialog,
    updateAgentAvailabilityDescription = function () {
        $.ajax({
            url: options.agentAvailabilityDescriptionUrl,
            data: { decorator: "nothing", confirm: true },
            cache: false
          }).done(function (data) {
                $(options.agentAvailabilityDescriptionContainer).html(data);
          });
    },
    displaySuccessMessageAndPossibleWarning = function (isNew, data) {
        var list,
            messages = [{ title: (isNew ? options.i18n.tasksAddSuccess : options.i18n.tasksEditSuccess) }];

        if (data.taskResult.warning.requirementsConflicts) {
            list = ["<ul>"];
            for (var r = 0, rr = data.taskResult.warning.requirementsConflicts.length; r < rr; r++) {
                var req = data.taskResult.warning.requirementsConflicts[r],
                    reqKey = req.group,
                    conflicts = req.labels;

                list.push("<li>", reqKey, "</li><ul>");
                for (var i = 0, ii = conflicts.length; i < ii; i++) {
                    list.push("<li>", conflicts[i], "</li>");
                }
                list.push("</ul>");
            }
            list.push("</ul>");
            messages.unshift({ title: (isNew ? options.i18n.tasksAddSuccessWarning : options.i18n.tasksEditSuccessWarning), type: "warning", body: list.join("") });
        }
        editor.displayMessages(messages);
    },
    configFormSuccess = function (data, isUnsaved) {
        updateAgentAvailabilityDescription();
        displaySuccessMessageAndPossibleWarning(isUnsaved, data);
        var taskItem = $(AJS.template.load(options.templates.taskListItem).fill({ name: data.taskResult.task.name, description: data.taskResult.task.description, id: data.taskResult.task.id, valid : data.taskResult.task.valid }).toString()).addClass("active");
        if (data.taskResult.task.isEnabled === false) {
            $(AJS.template.load(options.templates.lozengeDisabled).toString()).insertBefore(taskItem.find(".delete"));
        }
        return taskItem;
    },
    addTask = function (e) {
        var $taskTypeListItem = $(this).append($(AJS.template.load(options.templates.iconTemplate).fill({ type: "loading" }).toString())),
            $taskConfigLink = $taskTypeListItem.find("> a"),
            $taskListItem = $(AJS.template.load(options.templates.taskListItem).fill({
                name: $taskConfigLink.attr("title"),
                description: "",
                id: "",
                valid: true
            }).toString());

        e.preventDefault();

        editor.add($taskConfigLink.attr("href"), $taskListItem, "insertBefore", $finalTasksBar).success(function () {
            taskTypesDialog.remove();
        });
    },
    setupTaskTypesDialogContent = function (html) {
        var $html = $(html);

        $loadingIndicator.hide();

        taskTypesDialog.addPanel("All", $html);
        for (var i = 0, ii = options.taskTypeCategories.length; i < ii; i++) {
            var category = options.taskTypeCategories[i],
                $categoryTasks = $html.clone();
            $categoryTasks.children(":not(.task-type-category-" + category.key + ")").remove();
            if ($categoryTasks.children().length) {
                taskTypesDialog.addPanel(category.label, $categoryTasks);
            }
        }

        taskTypesDialog.show().gotoPanel(0);

        $taskTypesDialog = $("#" + options.taskTypesDialog.id).delegate(".task-type-list > li", "click", addTask);

        if (options.taskTypesDialog.filterForm) {
            $filterForm.find("> input").focus();
        }
    },
    showTaskTypesPicker = function (e) {
        var $addTaskTrigger = $(this),
            header = options.taskTypesDialog.header ? options.taskTypesDialog.header : $addTaskTrigger.text();

        e.preventDefault();

        if (!editor.isOkayToProceedWithUnsavedItem()) {
            editor.setFocus();
            return false;
        }

        if (!$loadingIndicator) {
            $loadingIndicator = $(AJS.template.load(options.templates.iconTemplate).fill({ type: "loading" }).toString()).insertAfter($addTaskTrigger.closest(".aui-toolbar"));
        } else {
            $loadingIndicator.show();
        }

        taskTypesDialog = new AJS.Dialog({
            id: options.taskTypesDialog.id,
            width: options.taskTypesDialog.width,
            height: options.taskTypesDialog.height,
            keypressListener: function (e) {
                if (e.which == jQuery.ui.keyCode.ESCAPE) {
                    taskTypesDialog.remove();
                }
            }
        });

        if (header) {
            taskTypesDialog.addHeader(header);

            if (options.taskTypesDialog.filterForm) {
                $filterForm = $(options.taskTypesDialog.filterForm).appendTo(taskTypesDialog.page[0].header);

                $filterForm.submit(function (e) { e.preventDefault(); }).find("> input").bind("keypress keyup click", function (e) {
                    var textToLookFor = $(this).val().toUpperCase();

                    e.stopPropagation();
                    $taskTypesDialog.find(".task-type-list > li").each(function () {
                        var $li = $(this);

                        $li[( $li.text().toUpperCase().indexOf(textToLookFor) >= 0 ? "show" : "hide" )]();
                    });
                });
            }
        }
        taskTypesDialog.addCancel(options.i18n.cancel, function () { taskTypesDialog.remove(); });
        if (options.templates.getMoreOnPac) {
            taskTypesDialog.addHelpText(options.templates.getMoreOnPac, {});
        }

        $.ajax({
            url: $addTaskTrigger.attr("href"),
            data: { decorator: "nothing", confirm: true },
            success: setupTaskTypesDialogContent,
            cache: false
        });
    },
    moveTask = function ($taskListItem) {
        var isMovedToFinal, status,
            requestComplete = function () {
                if (!status || status == "ERROR") {
                    triggerReflowOnPrompt();
                }
            };

        triggerReflowOnPrompt();

        if ($taskListItem.hasClass("final-tasks-bar")) {
            editor.updateUnspecifiedSortingErrorText("There was a problem moving the final tasks bar.");

            return $.ajax({
                type: "POST",
                url: options.moveFinalBarUrl,
                data: {
                    afterId: $taskListItem.nextAll(".item:first").data("item-id"),
                    beforeId: $taskListItem.prevAll(".item:first").data("item-id")
                },
                dataType: "json",
                complete: requestComplete
            }).done(function (json) {
                status = json.status;
                if (status != "ERROR") {
                    $taskListItem.nextAll(".item").addClass("final").end().prevAll(".item").removeClass("final");
                }
            });
        } else {
            isMovedToFinal = !!$taskListItem.prevAll(".final-tasks-bar").length;
            editor.updateUnspecifiedSortingErrorText(options.i18n.sortingHasUnspecifiedError);

            return $.ajax({
                type: "POST",
                url: options.moveTaskUrl,
                data: {
                    taskId: $taskListItem.data("item-id"),
                    afterId: $taskListItem.nextAll(".item:first").data("item-id"),
                    beforeId: $taskListItem.prevAll(".item:first").data("item-id"),
                    finalising: isMovedToFinal
                },
                dataType: "json",
                complete: requestComplete
            }).done(function (json) {
                status = json.status;
                if (status != "ERROR") {
                    $taskListItem.toggleClass("final", isMovedToFinal);
                }
            });
        }
    },
    triggerReflowOnPrompt = function () {
        var prompt;

        if ($.browser.msie && parseInt($.browser.version, 10) <= 8) {
            prompt = $("#final-tasks-prompt")[0];
            prompt.style.zoom = "100%";
            prompt.style.zoom = "normal";
        }
    };

    return {
        init: function (opts) {

            options = $.extend(true, defaults, opts);

            editor.init({
                editor: options.taskSetupContainer,
                configContainer: options.taskConfigContainer,
                itemList: options.taskList,
                deleteItemKey: "taskResult",
                configFormSuccess: configFormSuccess,
                templates: {
                    item: options.templates.taskListItem,
                    icon: options.templates.iconTemplate
                },
                i18n: {
                    confirmAbandonItem: options.i18n.confirmAbandonTask,
                    itemDeleteSuccess: options.i18n.tasksDeleteSuccess,
                    sortingHasUnsavedItemError: options.i18n.sortingHasUnsavedTaskError,
                    sortingHasUnspecifiedError: options.i18n.sortingHasUnspecifiedError,
                    sortingErrorDialogHeader: options.i18n.sortingErrorDialogHeader,
                    defaultDisplayText: options.i18n.defaultDisplayText,
                    defaultDisplayTextDescription: options.i18n.defaultDisplayTextDescription
                },
                sortable: {
                    items: "> li:not(#final-tasks-prompt)",
                    moveItem: moveTask
                }
            });

            $(document).undelegate(options.addTaskTrigger, "click");
            $(document)
                    .delegate(options.addTaskTrigger, "click", showTaskTypesPicker);

            events.EventBus.on('config-panel-item-removed', updateAgentAvailabilityDescription);

            $(function () {
                $taskSetupContainer = $(options.taskSetupContainer);
                $taskList = $(options.taskList);
                $taskConfigContainer = $(options.taskConfigContainer);
                $finalTasksBar = $taskList.find(".final-tasks-bar");

                options.defaultTaskToSelect && $taskList.find("#item-" + options.defaultTaskToSelect).click();
            });
        }
    }
}(jQuery);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/repository.js' */
(function ($, BAMBOO) {
    BAMBOO.REPOSITORY = {};

    BAMBOO.REPOSITORY.repositoryConfig = (function () {
        var events = require('util/events');
        var defaults = {
                    addRepositoryTrigger: null,
                    repositorySetupContainer: null,
                    repositoryConfigContainer: null,
                    repositoryList: null,
                    selectRepositorySelector: "#selectedRepository",
                    templates: {
                        repositoryListItem: null,
                        repositoryListItemDefaultMarker: null,
                        iconTemplate: null
                    },
                    displayCategories: null,
                    repositoryTypeCategories: [{
                            key:"linked",
                            label:"Link existing"
                        }, {
                            key:"new",
                            label: "Create new"
                        }
                    ],
                    repositoryTypesDialog: {
                        id: "repository-types-dialog",
                        header: "Repository host",
                        width: 865,
                        height: 530,
                        filterForm: null,
                        isNewAllowed: true
                    },
                    i18n: {
                        cancel: "Cancel",
                        confirmAbandonRepository: "The new repository has not yet been saved. If you continue you will abandon the new repository.\n\nAre you sure you want to continue?",
                        repositoryAddSuccess: "Repository created successfully.",
                        repositoryEditSuccess: "Repository updated successfully.",
                        repositoryDeleteSuccess: "Repository deleted successfully.",
                        sortingHasUnsavedRepositoryError: "Please save the new repository before reordering.",
                        defaultDisplayText: "No repository selected",
                        defaultDisplayTextDescription: "Select a repository from the list on the left to configure it.",
                        repositoryMovingError: AJS.I18n.getText("There was a problem moving your repository."),
                        repositoryMovingFailure: AJS.I18n.getText("Repository move failed")
                    },
                    moveRepositoryUrl: null,
                    markDefault: true,
                    preselectItemId: null
                },
                options,
                editor = new BAMBOO.ConfigPanelEditor(),
                $repositorySetupContainer,
                $repositoryConfigContainer,
                $repositoryList,
                $loadingIndicator,
                $repositoryTypesDialog,
                repositoryTypesDialog,
                $filterForm,

                checkListHasItems = function(hasItems) {
                    if (hasItems) {
                        markDefaultRepository();
                    }
                },
                configFormSuccess = function (data, isUnsaved) {
                    editor.displayMessages([{ title: (isUnsaved ? options.i18n.repositoryAddSuccess : options.i18n.repositoryEditSuccess) }]);
                    return $(AJS.template.load(options.templates.repositoryListItem).fill({ name: data.repositoryResult.name, id: data.repositoryResult.id }).toString()).addClass("active");
                },
                configFormWarnings = function (warnings) {
                    for (var i = 0, ii = warnings.length; i < ii; i++) {
                        editor.displayMessages([{ type: "warning", title: warnings[i] }]);
                    }
                },
                markDefaultRepository = function() {
                    if (options.markDefault) {
                        $repositoryList.find(".item-default").removeClass("item-default").find(".item-default-marker").remove();
                        $repositoryList.find(".item:first").addClass("item-default").find(".item-title").append(
                                AJS.template.load(options.templates.repositoryListItemDefaultMarker).toString()
                        );
                    }
                },
                addRepository = function (e) {
                    var $repositoryTypeListItem = $(this).append($(AJS.template.load(options.templates.iconTemplate).fill({ type: "loading" }).toString())),
                        $repositoryConfigLink = $repositoryTypeListItem.find(".trigger-type-title > a"),
                        $repositoryListItem = $(AJS.template.load(options.templates.repositoryListItem).fill({ name: "New Repository", id: "" }).toString());

                    e.preventDefault();

                    editor.add($repositoryConfigLink.attr("href"), $repositoryListItem, "appendTo", $repositoryList).success(function () {
                        repositoryTypesDialog.remove();
                    });
                    markDefaultRepository();
                },
                moveRepository = function ($repositoryListItem) {
                    return $.post(options.moveRepositoryUrl, {
                        repositoryId: $repositoryListItem.data("item-id"),
                        afterPosition: $repositoryListItem.nextAll(".item:first").data("item-id"),
                        beforePosition: $repositoryListItem.prevAll(".item:first").data("item-id"),
                        "bamboo.successReturnMode": "json"
                    }).done(markDefaultRepository);
                },
                setupRepositoryTypesDialogContent = function (html) {
                    var $html = $(html);

                    $loadingIndicator.hide();

                    repositoryTypesDialog.addPanel("All", $html);

                    if (options.displayCategories)
                    {
                        for (var i = 0, ii = options.repositoryTypeCategories.length; i < ii; i++)
                        {
                            var category = options.repositoryTypeCategories[i];

                            if (category.key == "new" && !options.repositoryTypesDialog.isNewAllowed)
                                continue;

                            var $categoryTasks = $html.clone();
                            $categoryTasks.children(":not(.repository-type-category-" + category.key + ")").remove();
                            if ($categoryTasks.children().length)
                            {
                                repositoryTypesDialog.addPanel(category.label, $categoryTasks);
                            }
                        }
                    }

                    repositoryTypesDialog.show().gotoPanel(0);

                    $repositoryTypesDialog = $("#" + options.repositoryTypesDialog.id).delegate(".trigger-type-list > li", "click", addRepository);

                    if (options.repositoryTypesDialog.filterForm) {
                        $filterForm.find("> input").focus();
                    }
                },
                showRepositoryTypesPicker = function (e) {
                    var $addRepositoryTrigger = $(this),
                            header = options.repositoryTypesDialog.header ? options.repositoryTypesDialog.header : $addRepositoryTrigger.text();

                    e.preventDefault();

                    if (!editor.isOkayToProceedWithUnsavedItem()) {
                        editor.setFocus();
                        return false;
                    }

                    if (!$loadingIndicator) {
                        $loadingIndicator = $(AJS.template.load(options.templates.iconTemplate).fill({ type: "loading" }).toString()).insertAfter($addRepositoryTrigger.closest(".aui-toolbar"));
                    } else {
                        $loadingIndicator.show();
                    }

                    repositoryTypesDialog = new AJS.Dialog({
                        id: options.repositoryTypesDialog.id,
                        width: options.repositoryTypesDialog.width,
                        height: options.repositoryTypesDialog.height,
                        keypressListener: function (e) {
                            if (e.which == jQuery.ui.keyCode.ESCAPE) {
                                repositoryTypesDialog.remove();
                            }
                        }
                    });

                    if (header) {
                        repositoryTypesDialog.addHeader(header);

                        if (options.repositoryTypesDialog.filterForm) {
                            $filterForm = $(options.repositoryTypesDialog.filterForm).appendTo(repositoryTypesDialog.page[0].header);

                            $filterForm.submit(function (e) { e.preventDefault(); }).find("> input").bind("keypress keyup click", function (e) {
                                var textToLookFor = $(this).val().toUpperCase();

                                e.stopPropagation();
                                $repositoryTypesDialog.find(".trigger-type-list > li").each(function () {
                                    var $li = $(this);

                                    $li[( $li.text().toUpperCase().indexOf(textToLookFor) >= 0 ? "show" : "hide" )]();
                                });
                            });
                        }
                    }
                    repositoryTypesDialog.addCancel(options.i18n.cancel, function () { repositoryTypesDialog.remove(); });
                    if (options.templates.getMoreOnPac) {
                        repositoryTypesDialog.addHelpText(options.templates.getMoreOnPac, {});
                    }

                    $.ajax({
                        url: $addRepositoryTrigger.attr("href"),
                        data: { decorator: "nothing", confirm: true },
                        success: setupRepositoryTypesDialogContent,
                        cache: false
                    });
                };

        return {
            init: function (opts) {
                options = $.extend(true, defaults, opts);

                editor.init({
                    editor: options.repositorySetupContainer,
                    configContainer: options.repositoryConfigContainer,
                    itemList: options.repositoryList,
                    deleteItemKey: "repositoryResult",
                    checkListHasItems: checkListHasItems,
                    configFormSuccess: configFormSuccess,
                    configFormWarnings: configFormWarnings,
                    templates: {
                        item: options.templates.repositoryListItem,
                        icon: options.templates.iconTemplate
                    },
                    i18n: {
                        confirmAbandonItem: options.i18n.confirmAbandonRepository,
                        itemDeleteSuccess: options.i18n.repositoryDeleteSuccess,
                        sortingHasUnsavedItemError: options.i18n.sortingHasUnsavedRepositoryError,
                        sortingHasUnspecifiedError: options.i18n.repositoryMovingError,
                        sortingErrorDialogHeader: options.i18n.repositoryMovingFailure,
                        defaultDisplayText: options.i18n.defaultDisplayText,
                        defaultDisplayTextDescription: options.i18n.defaultDisplayTextDescription
                    },
                    sortable: {
                        enabled: !!options.moveRepositoryUrl,
                        items: "> li:not(#repository-trigger-item)",
                        moveItem: moveRepository
                    },
                    deleteDialogHeight: 540
                });

                $(function () {
                    $repositorySetupContainer = $(options.repositorySetupContainer)
                            .delegate(options.addRepositoryTrigger, "click", showRepositoryTypesPicker);

                    $repositoryList = $(options.repositoryList);
                    $repositoryConfigContainer = $(options.repositoryConfigContainer);

                    editor.checkListHasItems();

                    if (options.preselectItemId) {
                        $(options.repositoryList).children("#item-" + options.preselectItemId).click();
                    }
                });
            }
        }
    }());


    BAMBOO.REPOSITORY.buildStrategyToggle = (function () {
        var defaults = {
                    noVcsStrategyOptions : null,
                    vcsStrategyOptions : null,
                    strategyList: null
                },
                options,
                $strategyList,
                toggleStrategiesForCreate = function () {
                    if (!$strategyList) {
                        $strategyList = $(options.strategyList);
                    }
                    var value = $strategyList.val();
                    $strategyList.attr("disabled", "disabled");
                    if ($(this).val() == "nullRepository") {
                        $strategyList.html(options.noVcsStrategyOptions);
                    } else {
                        $strategyList.html(options.vcsStrategyOptions);
                    }
                    $strategyList.removeAttr("disabled").val(value).change();
                };
        return {
            init: function (opts) {
                options = $.extend(true, defaults, opts);
                $(document).delegate("#selectedRepository", "change", toggleStrategiesForCreate);
            }
        }
    }());

    BAMBOO.REPOSITORY.CheckoutTaskConfiguration = (function () {
        var defaults = {
                    addCheckoutSelector: null,
                    removeCheckoutSelector: '.toolbar-trigger',
                    checkoutListSelector: null,
                    checkoutDirectorySelector: null,
                    selectedRepositorySelector: 'select[name^="selectedRepository_"]',
                    templates: {
                        checkoutListItem: null
                    },
                    i18n: {
                        checkoutDirectoryInUse: null
                    }
                },
                options,
                $list,
                $form,
                addCheckoutListItem = function () {
                    var newIndex, $lastCheckout;

                    $lastCheckout = $list.children(':last');
                    newIndex = ($lastCheckout.length ? (parseInt($lastCheckout.attr('data-checkout-id'), 10) + 1) : 0);

                    $(AJS.template.load(options.templates.checkoutListItem).fill({ index: newIndex }).toString())
                            .hide().appendTo($list)
                            .find(options.selectedRepositorySelector).end()
                            .slideDown();

                    BAMBOO.DynamicFieldParameters.syncFieldShowHide($list);
                },
                removeCheckoutListItem = function () {
                    $(this).closest('.aui-toolbar').closest('li').slideUp(function () { $(this).remove(); });
                },
                validateForm = function (e) {
                    var checkoutDirectories = {},
                            hasError = false,
                            checkField = function () {
                                var $field = $(this),
                                        val = $field.val();

                                if (checkoutDirectories.hasOwnProperty(val)) {
                                    $('<div/>', { 'class': 'error', text: options.i18n.checkoutDirectoryInUse }).insertAfter($field.next('.description'));
                                    hasError = true;
                                } else {
                                    checkoutDirectories[val] = true;
                                }
                            },
                            $trigger = $(this),
                            $fieldsToCheck = $form.find(options.checkoutDirectorySelector);

                    $form.find('.error').remove();

                    if ($trigger.is(':text')) {
                        $fieldsToCheck = $fieldsToCheck.not($trigger);
                        $fieldsToCheck.each(checkField);
                        checkField.apply(this);
                    } else {
                        $fieldsToCheck.each(checkField);
                        if (hasError) {
                            e.preventDefault();
                            e.stopPropagation();
                        }
                    }
                };

        return {
            init: function (opts) {
                options = $.extend(true, defaults, opts);

                $(function () {
                    $list = $(options.checkoutListSelector)
                            .delegate(options.removeCheckoutSelector, 'click', removeCheckoutListItem)
                            .delegate(options.checkoutDirectorySelector, 'blur', validateForm);

                    $form = $list.closest('form').submit(validateForm);
                    $(options.addCheckoutSelector).click(addCheckoutListItem);
                });
            }
        };
    }());

    BAMBOO.REPOSITORY.viewUsages = (function () {
        var defaults = {
                    trigger: ".viewRepositoryUsagesTrigger",
                    labelsDialog: {
                        id: "repositoryUsagesDialog",
                        header: null,
                        width: 600,
                        height: 300
                    },
                    i18n: {
                        close: "Close"
                    },
                    templates: {
                        iconTemplate: '<span class="icon icon-{type}"></span>'
                    }
                },
                options,
                dialog,
                initialised = false,
                setupDialogContent = function (html) {
                    var $html = $(html);
                    dialog.addPanel("All", $html).show();
                    $("#viewRepositoryUsagesForm .buttons-container").hide();
                },
                showDialog = function (e) {
                    e.preventDefault();
                    var $trigger = $(this);

                    dialog = new AJS.Dialog({
                        id: options.labelsDialog.id,
                        width: options.labelsDialog.width,
                        height: options.labelsDialog.height,
                        keypressListener: function (e) {
                            if (e.which == jQuery.ui.keyCode.ESCAPE) {
                                dialog.remove();
                            }
                        }
                    });

                    dialog.addCancel(options.i18n.close, function () { dialog.remove(); })
                            .addHeader(options.labelsDialog.header);

                    $.ajax({
                        url: $trigger.attr("href"),
                        data: { decorator: 'nothing', confirm: true },
                        success: setupDialogContent,
                        cache: false
                    });
                };
        return {
            init: function (opts) {
                if (!initialised) {
                    options = $.extend(true, defaults, opts);

                    $(document).undelegate("." + options.labelsDialog.id)
                            .delegate(options.trigger, "click." + options.labelsDialog.id, showDialog);
                    initialised = true;
                }
            }
        };
    }());
}(jQuery, window.BAMBOO = (window.BAMBOO || {})));;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/chainTriggers.js' */
(function ($, BAMBOO) {
    BAMBOO.TRIGGER = {};

    BAMBOO.TRIGGER.chainTriggerConfig = (function () {
        var defaults = {
                    addTriggerTrigger: null,
                    triggerSetupContainer: null,
                    triggerConfigContainer: null,
                    triggerList: null,
                    templates: {
                        triggerListItem: null,
                        triggerListItemDefaultMarker: null,
                        iconTemplate: null,
                        lozengeDisabled: null
                    },
                    triggerTypesDialog: {
                        id: "trigger-types-dialog",
                        header: "Select trigger",
                        width: 865,
                        height: 530,
                        filterForm: null
                    },
                    i18n: {
                        cancel: "Cancel",
                        confirmAbandonTrigger: "The new trigger has not yet been saved. If you continue you will abandon the new trigger.\n\nAre you sure you want to continue?",
                        triggerAddSuccess: "Trigger created successfully.",
                        triggerEditSuccess: "Trigger saved successfully.",
                        triggerDeleteSuccess: "Trigger deleted successfully.",
                        defaultDisplayText: "No trigger selected",
                        defaultDisplayTextDescription: "Select a trigger from the list on the left to configure it."
                    },
                    preselectItemId: null
                },
                options,
                editor = new BAMBOO.ConfigPanelEditor(),
                $triggerSetupContainer,
                $triggerConfigContainer,
                $triggerList,
                $loadingIndicator,
                $triggerTypesDialog,
                triggerTypesDialog,
                checkListHasItems = function(hasItems) {
                },
                configFormSuccess = function (data, isUnsaved) {
                    editor.displayMessages([{ title: (isUnsaved ? options.i18n.triggerAddSuccess : options.i18n.triggerEditSuccess) }]);
                    var triggerItem = $(AJS.template.load(options.templates.triggerListItem).fill({ name: data.triggerResult.name, id: data.triggerResult.id, description: data.triggerResult.description }).toString()).addClass("active");
                    if (data.triggerResult.isEnabled === false) {
                        $(AJS.template.load(options.templates.lozengeDisabled).toString()).insertBefore(triggerItem.find(".delete"));
                    }
                    return triggerItem;
                },
                configFormWarnings = function (warnings) {
                    for (var i = 0, ii = warnings.length; i < ii; i++) {
                        editor.displayMessages([{ type: "warning", title: warnings[i] }]);
                    }
                },
                addTrigger = function (e) {
                    var $triggerTypeListItem = $(this).append($(AJS.template.load(options.templates.iconTemplate).fill({ type: "loading" }).toString())),
                        $triggerConfigLink = $triggerTypeListItem.find(".trigger-type-title > a"),
                        $triggerListItem = $(AJS.template.load(options.templates.triggerListItem).fill({ name: $triggerConfigLink.text(), description: "", id: "" , valid : true }).toString());

                    e.preventDefault();

                    editor.add($triggerConfigLink.attr("href"), $triggerListItem, "appendTo", $triggerList).success(function () {
                        triggerTypesDialog.remove();
                    });

                },
                setupTriggerTypesDialogContent = function (html) {
                    var $html = $(html);

                    $loadingIndicator.hide();

                    triggerTypesDialog.addPanel("All", $html);
                    triggerTypesDialog.show().gotoPanel(0);

                    $triggerTypesDialog = $("#" + options.triggerTypesDialog.id).delegate(".trigger-type-list > li", "click", addTrigger);

                    if (options.triggerTypesDialog.filterForm) {
                        $filterForm.find("> input").focus();
                    }
                },
                showTaskTypesPicker = function (e) {
                    var $addTriggerTrigger = $(this),
                        header = options.triggerTypesDialog.header ? options.triggerTypesDialog.header : $addTriggerTrigger.text();

                    e.preventDefault();

                    if (!editor.isOkayToProceedWithUnsavedItem()) {
                        editor.setFocus();
                        return false;
                    }

                    if (!$loadingIndicator) {
                        $loadingIndicator = $(AJS.template.load(options.templates.iconTemplate).fill({ type: "loading" }).toString()).insertAfter($addTriggerTrigger.closest(".aui-toolbar"));
                    } else {
                        $loadingIndicator.show();
                    }

                    triggerTypesDialog = new AJS.Dialog({
                                                         id: options.triggerTypesDialog.id,
                                                         width: options.triggerTypesDialog.width,
                                                         height: options.triggerTypesDialog.height,
                                                         keypressListener: function (e) {
                                                             if (e.which == jQuery.ui.keyCode.ESCAPE) {
                                                                 triggerTypesDialog.remove();
                                                             }
                                                         }
                                                     });

                    if (header) {
                        triggerTypesDialog.addHeader(header);

                        if (options.triggerTypesDialog.filterForm) {
                            $filterForm = $(options.triggerTypesDialog.filterForm).appendTo(triggerTypesDialog.page[0].header);

                            $filterForm.submit(function (e) { e.preventDefault(); }).find("> input").bind("keypress keyup click", function (e) {
                                var textToLookFor = $(this).val().toUpperCase();

                                e.stopPropagation();
                                $triggerTypesDialog.find(".trigger-type-list > li").each(function () {
                                    var $li = $(this);

                                    $li[( $li.text().toUpperCase().indexOf(textToLookFor) >= 0 ? "show" : "hide" )]();
                                });
                            });
                        }
                    }
                    triggerTypesDialog.addCancel(options.i18n.cancel, function () { triggerTypesDialog.remove(); });
                    if (options.templates.getMoreOnPac) {
                        triggerTypesDialog.addHelpText(options.templates.getMoreOnPac, {});
                    }

                    $.ajax({
                               url: $addTriggerTrigger.attr("href"),
                               data: { decorator: "nothing", confirm: true },
                               success: setupTriggerTypesDialogContent,
                               cache: false
                           });
                };

        return {
            init: function (opts) {
                options = $.extend(true, defaults, opts);

                editor.init({
                                editor: options.triggerSetupContainer,
                                configContainer: options.triggerConfigContainer,
                                itemList: options.triggerList,
                                deleteItemKey: "triggerResult",
                                checkListHasItems: checkListHasItems,
                                configFormSuccess: configFormSuccess,
                                configFormWarnings: configFormWarnings,
                                templates: {
                                    item: options.templates.triggerListItem,
                                    icon: options.templates.iconTemplate
                                },
                                i18n: {
                                    confirmAbandonItem: options.i18n.confirmAbandonTrigger,
                                    itemDeleteSuccess: options.i18n.triggerDeleteSuccess,
                                    defaultDisplayText: options.i18n.defaultDisplayText,
                                    defaultDisplayTextDescription: options.i18n.defaultDisplayTextDescription
                                },
                                sortable: {
                                    enabled: false
                                }
                            });

                $(function () {
                    $triggerSetupContainer = $(options.triggerSetupContainer)
                            .delegate(options.addTriggerTrigger, "click", showTaskTypesPicker);
                    $triggerList = $(options.triggerList);
                    $triggerConfigContainer = $(options.triggerConfigContainer);

                    editor.checkListHasItems();

                    if (options.preselectItemId) {
                        $(options.triggerList).children("#item-" + options.preselectItemId).click();
                    }
                });
            }
        }
    }());
}(jQuery, window.BAMBOO = (window.BAMBOO || {})));;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/labels.js' */
(function ($, BAMBOO) {
    BAMBOO.LABELS = {};
    BAMBOO.LABELS.LabelDialog = LabelDialog;

    function LabelDialog(opts) {
        var defaults = {
                trigger: '.labels-edit',
                labelView: '.label-list, .label-none',
                labelsDialog: {
                    id: 'labels-dialog',
                    header: null,
                    width: 550,
                    height: 250,
                    shortcutKey: "L"
                },
                removeUrl: ''
            },
            options = $.extend(true, defaults, opts),
            $loadingIndicator,
            dialog,
            setupDialogContent = function (html) {
                var $html = $(html);
                $loadingIndicator.hide();

                dialog.addPanel('All', $html).show();
            },
            showDialog = function (e) {
                e.preventDefault();
                var $trigger = $(this);

                if (!$loadingIndicator) {
                    $loadingIndicator = $(widget.icons.icon({ type: 'loading' })).insertAfter($trigger);
                } else {
                    $loadingIndicator.show();
                }

                dialog = new AJS.Dialog({
                    id: options.labelsDialog.id,
                    width: options.labelsDialog.width,
                    height: options.labelsDialog.height,
                    keypressListener: function (e) {
                        if (e.which == jQuery.ui.keyCode.ESCAPE) {
                            dialog.remove();
                        }
                    }
                });

                dialog.addCancel("Close", function () { dialog.remove(); })
                      .addHeader(options.labelsDialog.header);

                if (options.labelsDialog.shortcutKey) {
                    dialog.addHelpText(AJS.format("Shortcut tip: pressing \u003ckbd\u003e{0}\u003c/kbd\u003e also opens this dialog box", options.labelsDialog.shortcutKey));
                }

                $.ajax({
                    url: $trigger.attr('href'),
                    data: { decorator: 'nothing', confirm: true },
                    success: setupDialogContent,
                    cache: false
                });
                $('#' + options.labelsDialog.id).addClass('labels-dialog');
            },
            addLabels = function (e) {
                e.preventDefault();

                var $form = $(this),
                    $input = $form.find('input:text').attr('readonly', 'readonly'),
                    $submit = $form.find('input:submit').attr('disabled', 'disabled'),
                    $loading = $(widget.icons.icon({ type: 'loading' })).insertAfter($submit);

                $.post($form.attr('action'), $form.serialize(), function (data) {
                    var fieldErrors;
                    $form.find('.error,.aui-message').remove();
                    if (typeof data == 'object') {
                        // Returned data is JSON
                        fieldErrors = data.fieldErrors;
                        if (fieldErrors) {
                            for (var fieldName in fieldErrors) {
                                if (fieldErrors.hasOwnProperty(fieldName)) {
                                    BAMBOO.addFieldErrors($form, fieldName, fieldErrors[fieldName]);
                                }
                            }
                        }
                        if (data.errors) {
                            $form.prepend(BAMBOO.buildAUIErrorMessage(data.errors));
                        }
                    } else {
                        // Returned data isn't JSON, assume it's HTML
                        updateDisplay(data);
                        $form.find('input:text').val('');
                    }
                    $input.removeAttr('readonly');
                    $submit.removeAttr('disabled');
                    $loading.remove();
                    $form.find('input:text').focus();
                });
            },
            deleteLabel = function (e) {
                e.preventDefault();

                $.post(options.removeUrl, { selectedLabel: $(this).closest('.aui-label').attr('data-label') }).done(updateDisplay);
            },
            updateDisplay = function (data) {
                var $html = $(data),
                    edit = $html.filter('.label-edit-mode').html(),
                    view = $html.filter('.label-view-mode').html();

                $(options.labelView).each(function () {
                    var $replaceTarget = $(this);
                    $replaceTarget.replaceWith($replaceTarget.closest('#' + options.labelsDialog.id).length ? edit : view);
                });


                var labels = AJS.$('#plan-labels');
                if (labels.length) {
                    var $container = $('<div/>').append(view);
                    $container.find('.label-none').remove();

                    labels.html($container.html());
                }

            },
            handlersBoundKey = options.labelsDialog.id + 'handlersBound';

        if (!$(document).data(handlersBoundKey)) {
            $(document)
                .undelegate('.' + options.labelsDialog.id)
                .delegate(options.trigger, 'click.' + options.labelsDialog.id, showDialog)
                .delegate('#' + options.labelsDialog.id + ' form', 'submit.' + options.labelsDialog.id, addLabels)
                .delegate('#' + options.labelsDialog.id + ' .aui-icon-close', 'click.' + options.labelsDialog.id, deleteLabel);

            if (options.labelsDialog.shortcutKey) {
                $(function(){
                    AJS.whenIType(options.labelsDialog.shortcutKey).click(options.trigger);
                });
            }
            $(document).data(handlersBoundKey, true);
        }
    }
}(AJS.$, window.BAMBOO = (window.BAMBOO || {})));
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/logs.js' */
/* Chain Log Tables */
(function ($) {
    var BAMBOO = window.BAMBOO || {};
    BAMBOO.LOGS = {};
    BAMBOO.LOGS.chainTableLiveView = (function () {
        var opts = {
            getBuildUrl: null,
            chainStatus: "",
            noLogsFound: 'No logs were found for this Job',
            templates: {
                logTableRow: null
            }
        },
        updateTimeout,
        update = function () {
            clearTimeout(updateTimeout);
            updateLogDisplay();

            //If build not finished update again in 5 seconds
            if (opts.chainStatus != "Finished" && opts.chainStatus != "NotBuilt") {
                updateTimeout = setTimeout(update, 5000);
            }
        },
        updateLogDisplay = function() {
            $(".chain-logs-table > tbody > tr.log-trace > td.code table").each(function() {
                var $logContainer = $(this),
                    $tr = $logContainer.closest("tr").prev();

                if ($tr.hasClass("expanded")) {
                    updateSingleLog($tr.find(".twixie > span"));
                }
            });
        },
        updateSingleLog = function ($twixie) {
            var $tr = $twixie.closest("tr"),
                $stack = $tr.next(),
                $logContainer = $stack.find("table"),
                $loading = $('<span />', { 'class': 'icon icon-loading' });

            if ($logContainer.data('dontUpdate') || $logContainer.data('updateInProgress')) {
                return;
            }
            $logContainer.data('updateInProgress', true);

            $twixie.hide().before($loading);

            $.ajax({
                url: opts.getBuildUrl.replace("@KEY@", $logContainer.attr("id")),
                data: {
                    expand: 'logEntries[-' + 25 + ':]',
                    'max-results': 25
                },
                dataType: "json",
                contentType: "application/json",
                cache: false,
                success: function (buildResult) {
                    var newLogBody = '';

                    if (buildResult.lifeCycleState == "Finished" || buildResult.lifeCycleState == "NotBuilt") {
                        //if build result is finished there will be no more log changes
                        $logContainer.data('dontUpdate', true);
                    }
                    if (buildResult.logEntries && typeof(buildResult.logEntries.logEntry) != "undefined") {
                        for (var i = 0, ii = buildResult.logEntries.logEntry.length; i < ii; i++) {
                            var logEntry = buildResult.logEntries.logEntry[i];

                            newLogBody += AJS.template.load(opts.templates.logTableRow)
                                .fill({ time: logEntry.formattedDate })
                                .fillHtml({ log: logEntry.log }).toString();
                        }
                    }

                    if ($.trim(newLogBody).length) {
                        $logContainer.html(newLogBody);
                    } else {
                        $logContainer.html(AJS.template.load(opts.templates.logTableRow)
                            .fill({time : ''})
                            .fillHtml({ log: opts.noLogsFound }).toString());
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // Error occurred when doing the update, try again in 30 sec
                    $logContainer.html(opts.noLogsFound);
                },
                complete: function (jqXHR, textStatus) {
                    $loading.remove();
                    $twixie.show();
                    $logContainer.data('updateInProgress', false);
                }
            });
        };

        return {
            init: function(options) {
                var twixieSelector = ".chain-logs-table > tbody > tr > .twixie > span",
                    twixieAllSelector = ".chain-logs-table > thead > tr > .twixie span[role]";

                $.extend(true, opts, options);

                $(document)
                    .undelegate(twixieSelector, "click")
                    .delegate(twixieSelector, "click", function (e) {
                        var $twixie = $(this),
                                $tr = $twixie.closest("tr"),
                                $stack = $tr.next(),
                                newTwixieText = !$twixie.hasClass("icon-collapse") ? "Collapse" : "Expand"; //negated because we toggle the class later

                        $stack[$tr.hasClass("collapsed") ? "show" : "hide"]();
                        $tr.toggleClass("collapsed expanded");
                        $twixie.toggleClass("icon-collapse icon-expand").attr("title", newTwixieText).html("<span>" + newTwixieText + "</span>");
                        if ($tr.hasClass("expanded")) {
                            updateSingleLog($twixie);
                        }
                    })
                    .undelegate(twixieAllSelector, "click")
                    .delegate(twixieAllSelector, "click", function (e) {
                        var $trigger = $(this),
                                $li = $trigger.closest("li"),
                                $table = $trigger.closest("table");

                        if ($li.hasClass("expand-all")) {
                            $table.find("tbody > .collapsed .twixie > span").click();
                        } else if ($li.hasClass("collapse-all")) {
                            $table.find("tbody > .expanded .twixie > span").click();
                        }
                    });

                update();
            }
        }
    })();
})(jQuery);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/plugin-content.js' */
(function ($) {
    var BAMBOO = window.BAMBOO || {};
    BAMBOO.AGGREGATE_PLUGIN_CONTENT = {};
    BAMBOO.AGGREGATE_PLUGIN_CONTENT.loadPluginContent = (function () {
        var opts = {
            pluginUrl: null,
            jobKeySelector: null,
            contentSelector: null
        },
        $content,
        $jobDropdown,
        update = function () {
            var jobKey = $jobDropdown.val(),
                buildUrl = AJS.template(opts.pluginUrl).fill({ buildKey: jobKey, planKey: jobKey }).toString(),
                $tabsContainer = $('.aui-tabs.aui-tabs-disabled').addClass('loading');

            $.ajax({
                cache: false,
                url: buildUrl,
                beforeSend: function (jqXHR) {
                    jqXHR.setRequestHeader('X-No-Decorate', true);
                },
                success: function (data, textStatus, jqXHR) {
                    // If no data is returned, or an entire web page, go directly to that page for normal error handling
                    if (!$.trim(data) || /<html/i.test(data)) {
                        return window.location = this.url;
                    }
                    $content.html(data);
                    $tabsContainer.removeClass('loading');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    if (textStatus != 'abort') {
                        return window.location = this.url;
                    }
                }
            });
        };

        return {
            init: function (options) {
                opts = $.extend(true, options);

                $(function () {
                    $content = $(opts.contentSelector);
                    $jobDropdown = $(opts.jobKeySelector).change(update);
                    update();
                });
            }
        }
    })();
})(jQuery);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/manual-stages.js' */
(function($) {
    var BAMBOO = window.BAMBOO || {};
    BAMBOO.STAGES = {};
    BAMBOO.STAGES.manualStagesSelection = (function () {
        return {
            init: function() {
               $("#stageContainer").delegate("input:checkbox", "click", function() {
                    var $checkbox = $(this),
                        checked = $checkbox.is(":checked"),
                        $selectedStage = $("#selectedStage"),
                        prevManualFound = false;

                    if (checked) {
                        $selectedStage.val($checkbox.val());
                    } else {
                        $selectedStage.val("");
                    }

                    $checkbox.parent().closest(".checkbox").toggleClass("selected", checked).prevAll(".checkbox").each(function () {
                        var $checkboxContainer = $(this),
                            $checkbox = $checkboxContainer.children("input:checkbox"),
                            isManual = $checkboxContainer.hasClass("manual");
                        if (checked) {
                            $checkboxContainer.addClass("selected");
                            if (isManual) {
                                $checkbox.attr("checked", "checked").attr("disabled", "disabled");
                            }
                        } else {
                            if (isManual && !prevManualFound) {
                                $selectedStage.val($checkbox.val());
                                $checkbox.removeAttr("disabled");
                                prevManualFound = true;
                            }
                        }
                    }).end().nextAll(".checkbox").each(function () {
                        var $checkboxContainer = $(this);
                        if ($checkboxContainer.hasClass("manual")) {
                            return false; // breaks the loop
                        } else {
                            $checkboxContainer.toggleClass("selected", checked);
                        }
                    });
                });
            }
        }
    })();
})(jQuery);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/dashboard.js' */
(function($, BAMBOO){
    BAMBOO.DASHBOARD = {};

    BAMBOO.DASHBOARD.Expander = function (opts) {
        var defaults = {
                toggleFilterClass: null,
                triggerSelector: null,
                triggerRootSelector: null,
                tableSelector: null,
                pageSize: 50,
                disabledAttr: 'aria-disabled',
                disabledProperty: 'disabled',
                editFilterClass: 'edit-project-filter',
                icons: {
                    filter: 'filter',
                    loading: 'loading'
                }
            },
            options = $.extend(true, defaults, opts),
            request,
            iconClassPrefix = 'icon-',
            iconFilterClass = iconClassPrefix + options.icons.filter,
            iconLoadingClass = iconClassPrefix + options.icons.loading,
            showMorePlans = function (e) {
                var $loading,
                    $trigger = $(this),
                    lastProjectKey = $trigger.closest(options.triggerRootSelector).data('lastProjectKey'),
                    getPlansUrl = $trigger.hasClass('quick-filters') ? '/quickFilteredPlansSnippet.action' : '/allPlansSnippet.action';

                if ($(e.target).hasClass(options.editFilterClass) || $trigger.is(':disabled')) {
                    return;
                }

                $loading = $(widget.icons.icon({ type: options.icons.loading }));
                $trigger.append($loading).prop(options.disabledProperty, true);

                var $activeFilters = $('.quick-filters-container').find('.quick-filter.active');
                var filterIds = $activeFilters.toArray()
                    .map(function(element) {
                        return $(element).attr('data-filter-id');
                    });

                getPlans(AJS.contextPath() + getPlansUrl, {
                    pageSize: options.pageSize,
                    lastProject: lastProjectKey,
                    filterIds : filterIds
                }).done(updateTable).fail(showError);

                function showError() {
                    $loading.remove();
                    $trigger.prop(options.disabledProperty, false).html("Bamboo appears to be unresponsive, \u003cspan class=\u0022try-again\u0022\u003etry again\u003c/span\u003e?");
                }
            },
            updateTable = function (response) {
                var $table = $(options.tableSelector),
                    $htmlResponse = $(response);

                $table.append($htmlResponse.find('tbody'));
                $table.find('tfoot').replaceWith($htmlResponse.find('tfoot'));
            },
            toggleFilter = function (e, enable) {
                var $button = $('#toggle-project-filter'),
                    filterEnabled = (typeof enable === 'boolean' ? !enable : $button.is('[aria-pressed="true"]')),
                    updateButton = function () {
                        $button.attr('aria-pressed', !filterEnabled).removeAttr(options.disabledAttr);
                        if ($button.hasClass(options.editFilterClass)) {
                            $button.removeClass(options.editFilterClass).addClass(options.toggleFilterClass);
                        }
                        $button.html(widget.icons.icon({ type: options.icons.filter }) + '&nbsp;' + (filterEnabled ? "Personal filter is off" : "Personal filter is on"));
                    },
                    restoreButton = function () {
                        $button.removeAttr(options.disabledAttr)
                            .find('.icon').removeClass(iconLoadingClass).addClass(iconFilterClass);
                    };

                e && e.preventDefault();

                if ($button.is('[' + options.disabledAttr + '="true"]')) {
                    return;
                }
                $button.attr(options.disabledAttr, true)
                    .find('.icon').removeClass(iconFilterClass).addClass(iconLoadingClass);

                getPlans(AJS.contextPath() + '/toggleDashboardFilterInline.action', { filterEnabled: !filterEnabled })
                    .done(replaceTable).done(updateButton)
                    .fail(restoreButton);
            },
            replaceTable = function (response) {
                $(options.tableSelector).replaceWith(response);
            },
            getPlans = function (url, data) {
                if (request) {
                    request.abort();
                }
                return request = $.ajax({
                    url: url,
                    type: 'POST',
                    cache: false,
                    dataType: 'html',
                    data: $.extend(true, { decorator: 'nothing', confirm: true }, data || {})
                });
            },
            enableFilter = function () {
                toggleFilter(null, true);
            };

        return {
            init: function ()  {
                $(options.tableSelector).on('click', options.triggerSelector, showMorePlans);
                $(document).on('click', makeClassSelector(options.toggleFilterClass), toggleFilter);

                BAMBOO.simpleDialogForm({
                    trigger: makeClassSelector(options.editFilterClass),
                    dialogWidth: 640,
                    dialogHeight: 420,
                    success: enableFilter,
                    header: "Filter projects"
                });

                AJS.whenIType("L").click('#main-edit-project-filter');
            }
        };
    };

    BAMBOO.DASHBOARD.InlineActions = function () {
        var options = {
            classes: {
                favourite: 'markBuildFavourite',
                unfavourite: 'unmarkBuildFavourite',
                enable: 'enableBuild',
                loading: 'loading',
                icon: 'aui-icon',
                iconFavourite: 'aui-iconfont-unstar', //this is counter intuitive but "star" and "unstar" is action in AUI while we're showing state
                iconUnfavourite: 'aui-iconfont-star'
            },
            texts: {
                favourite: "Favourite",
                unfavourite: "Unfavourite"
            }

        };

        $(document)
            .on('click', makeClassSelector([ options.classes.favourite, options.classes.unfavourite ]), toggleFavourite)
            .on('click', makeClassSelector(options.classes.enable), enableBuild);

        function toggleFavourite(e) {
            var $this = $(this),
                planKey = $this.data('planKey'),
                icon = $this.children(makeClassSelector(options.classes.icon)),
                isFavourite = $this.hasClass(options.classes.unfavourite),
                endpoint = AJS.contextPath() + '/rest/api/latest/plan/' + planKey + '/favourite';

            e.preventDefault();

            if ($this.hasClass(options.classes.loading)) {
                return;
            }
            $this.addClass(options.classes.loading);

            $.ajax({
                url: endpoint,
                type: (isFavourite ? 'DELETE' : 'POST'),
                dataType: 'json'
            }).done((isFavourite ? unmark : mark)).always(reset);

            function toggleTitle(e, on) {
                if (on) {
                    e.prop('title', e.prop('title').replace(options.texts.favourite, options.texts.unfavourite));
                } else {
                    e.prop('title', e.prop('title').replace(options.texts.unfavourite, options.texts.favourite));
                }
            }
            function mark() {
                $this.removeClass(options.classes.favourite).addClass(options.classes.unfavourite);
                icon.removeClass(options.classes.iconFavourite).addClass(options.classes.iconUnfavourite);
                toggleTitle($this, true);
                toggleTitle(icon, true);
            }
            function unmark() {
                $this.removeClass(options.classes.unfavourite).addClass(options.classes.favourite);
                icon.removeClass(options.classes.iconUnfavourite).addClass(options.classes.iconFavourite);
                toggleTitle($this, false);
                toggleTitle(icon, false);
            }
            function reset() {
                $this.removeClass(options.classes.loading);
            }
        }

        function enableBuild(e) {
            var $this = $(this),
                planKey = $this.data('planKey');

            e.preventDefault();

            if ($this.hasClass(options.classes.loading)) {
                return;
            }
            $this.addClass(options.classes.loading);

            $.ajax({
                type: 'POST',
                url: AJS.contextPath() + '/rest/api/latest/plan/' + planKey + '/enable',
                dataType: 'json'
            }).done(enable).always(reset);

            function enable() {
                $this.hide();
                $('#manualBuild_' + planKey).css("display", "");
            }
            function reset() {
                $this.removeClass(options.classes.loading);
            }
        }
    };
    BAMBOO.DASHBOARD.InlineActions();

    function makeClassSelector(classes) {
        var classArr = (typeof classes === 'string' ? [ classes ] : classes);
        return '.' + classArr.join(',.');
    }
}(jQuery, window.BAMBOO = (window.BAMBOO || {})));;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/jira-issues.js' */
(function ($) {
    BAMBOO.JIRAISSUES = (function () {
        var opts = {
                resultSummaryKey: null,
                getIssuesUrl: null,
                currentFullUrl: null,
                defaultIssueIconUrl: null,
                defaultIssueType: null,
                defaultIssueDetails: null,
                newIssueKey: null,
                jiraTabUrl: null,
                maxIssues: null,
                hideStatus: null,
                templates: {
                    authenticationRequiredTemplate: null
                }
            },
            $issuesPanel,
            refresh = function () {
                opts.newIssueKey = (arguments.length ? arguments[0] : null);

                return ($issuesPanel && $issuesPanel.length ? $.ajax({
                    url: opts.getIssuesUrl + opts.resultSummaryKey,
                    cache: false,
                    data: {
                        expand: "jiraIssues[0:" + (opts.maxIssues - 1) + "]",
                        returnUrl: opts.currentFullUrl
                    },
                    dataType: "json",
                    contentType: "application/json"
               }).done(update).fail(error) : false);
            },
            update = function (json) {
                if (json.jiraIssues && json.jiraIssues.issue && json.jiraIssues.issue.length) {
                    $issuesPanel
                        .find('> table')
                        .replaceWith(bamboo.feature.jiraIssueList.jiraIssueList({
                            issues: json.jiraIssues.issue,
                            defaultIssueType: opts.defaultIssueType,
                            defaultIssueIconUrl: opts.defaultIssueIconUrl,
                            hideStatus: opts.hideStatus,
                            jiraTabUrl: opts.jiraTabUrl,
                            maxIssues: opts.maxIssues,
                            issuesCount: json.jiraIssues.size
                        }));

                    $issuesPanel.removeClass('hidden').show();
                    if (opts.newIssueKey) {
                        highlightIssue($issuesPanel.find("tr:contains('" + opts.newIssueKey + "')"));
                    }
                } else {
                    $issuesPanel.hide();
                }
            },
            error = function (jqXHR, textStatus, errorThrown) {
                var response, authUrl, authInstance,
                    $issueTable = $issuesPanel.find('> table');

                try {
                    response = $.parseJSON(jqXHR.responseText);
                    authUrl = response['authenticationRedirectUrl'];
                    authInstance = response['authenticationInstanceName'] || "JIRA";
                }
                catch (e) {}

                $issueTable.removeClass('loading');
                if (authUrl) {
                    $(AJS.template.load(opts.templates.authenticationRequiredTemplate).fill({ authenticationUrl: authUrl, authenticationInstanceName: authInstance }).toString()).insertBefore($issueTable);
                }
            };
        
        function highlightIssue($newIssue) {
            if ($newIssue.length) {
                var oldColor = $newIssue.css("backgroundColor");
                $newIssue.css("backgroundColor", "#FFFFDD").delay(3000).animate({ backgroundColor:oldColor }, 1500, "swing");
            }
        }
        
        return {
            /**
             * @param options - Object containing the options to overwrite our defaults
             */
            init: function (options) {
                $.extend(true, opts, options);
                $(function () {
                    $issuesPanel = $(".issueSummary");
                    refresh();
                });
            },
            refresh: refresh,
            highlightIssue: highlightIssue
        }
    })();

    BAMBOO.JIRATEASER = (function () {
        var jiraTeaserPopup,
            dialogOptions = {
                width: 420,
                hideDelay: 36e5
            },
            generatePopup = function ($contents, trigger, doShowPopup) {
                // hide popup hooks
                var doHidePopup = function () {
                    jiraTeaserPopup.hide();
                    return false;
                };

                $(document).keyup(function (e) {
                    if (e.which == jQuery.ui.keyCode.ESCAPE) {
                        doHidePopup();
                        $(document).unbind("keyup", arguments.callee);
                        return false;
                    }
                    return true;
                });

                // replace container contents with teaser
                $contents
                    .html(AJS.template.load("jira-teaser-popup").fill())
                    .find(".close-dialog").click(doHidePopup).end()
                    .find(".jiraTeaserCheckbox").change(function (e) {
                        var val = $(this).is(":checked");
                        $.ajax({
                            url: AJS.contextPath() + "/rest/pref/latest/user",
                            type: "post",
                            data: {
                                "bamboo.user.jira.teaser.hide" : val
                            }
                        });
                    });

                doShowPopup();
            };

        $(function ($) {
            if ($("#jira-teaser-template").length) {
                jiraTeaserPopup = AJS.InlineDialog($("#changesSummary .jiraIssueLink:last"), "jiraChangesSummary", generatePopup, dialogOptions);
                jiraTeaserPopup.show();
            }
        });
    }());
})(AJS.$);

var JiraIssueLinkManager = (function ($) {
    var globalBambooProjectKey,
        addLink = function () {
            var $this = $(this),
                jiraIssueKey = $this.data("issue-key"),
                bambooProjectKey = $this.data("bamboo-project-key") || globalBambooProjectKey,
                href = AJS.contextPath() + "/project/jiraRedirect.action?jiraIssueKey=" + jiraIssueKey;

            if (bambooProjectKey) {
                href += "&bambooProjectKey=" + bambooProjectKey;
            }
            $this.attr("href", href);
        };

    return {
        init: function (bambooProjectKey) {
            globalBambooProjectKey = bambooProjectKey;
            $(function () {
                $("a.jiraIssueLink").each(addLink);
           });
        }
    };
})(AJS.$);

var JiraRelatedIssues = (function ($) {
    return {
        init: function() {
            BAMBOO.JIRAISSUES.highlightIssue($(".newJiraIssue"));
        }
    }
})(AJS.$);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/jiraIssueCreation.js' */
BAMBOO.JIRAISSUECREATION = (function ($) {
    var defaults = {
            planResultKey: null,
            applinkId: null,
            projectId: null,
            returnUrl: null,
            issueTypeId: null,
            noProjectsMessage: null,
            templates: {
                authenticationRequiredTemplate: null,
                cannotCreateTemplate: null,
                shortcutHint: null,
                genericErrorHelpLink: null
            }
        },
        options,
        firstTime = true,
        setRequiredField = function ($selectField, value) {
            var $label = $("label[for="+$selectField.attr('id')+"]");
            $label.find("span").remove();
            if (value) {
                $label.append("<span class=\"aui-icon icon-required\"></span><span class=\"content\"> (required)</span>");
            }
        },
        hideSelect = function ($selectField) {
            $selectField.parent().hide();
            $selectField.find("option").remove();
        },
        populateMultiSelect = function ($selectField, fieldSchema) {
            var show = false;
            setRequiredField($selectField, fieldSchema.required);

            $(fieldSchema.allowedValues).each(function () {
                $('<option />', {
                    val: this.id,
                    text: this.name,
                    title: this.description
                }).appendTo($selectField);
               show = true;
            });
            if (show) {
                $selectField.parent().show();
            }
        },
        populateErrors = function (data) {
            var $messageContainer = $("#cannot-create-message-container"),
                $issueContainer = $("#issue-contents-container"),
                $message;
            /* other error cases */
            if (data.errors && data.errors.length) {
                $message = BAMBOO.buildAUIErrorMessage(data.errors);
            } else if (data.fieldErrors && data.fieldErrors.length) {
                var renderedErrors = [];
                for (var fieldError in data.fieldErrors){
                    if (data.fieldErrors.hasOwnProperty(fieldError)) {
                        renderedErrors.push(fieldError + ": " + data.fieldErrors[fieldError]);
                    }
                }
                $message = BAMBOO.buildAUIErrorMessage(renderedErrors);
            } else if (data.messages && data.messages.length) {
                $message = BAMBOO.buildAUIWarningMessage(data.messages);
            }
            $message.append(AJS.template.load(options.templates.genericErrorHelpLink).toString());
            $messageContainer.append($message).show();
        },
        clearErrors = function () {
            $("#executeCreateNewJiraIssue div.error").remove();
        },
        populateForm = function (projectKey, issueTypeId) {
            var $versionSelectField = $("#jiraProjectVersions"),
                $componentSelectField =$("#jiraProjectComponents"),
                $messageContainer = $("#cannot-create-message-container"),
                $fieldContainer = $("#issue-fields-container"),
                $loadingSpinner = $("#fields-loading-spinner"),
                $createButton = $("#executeCreateNewJiraIssue_save");

            $messageContainer.hide().children().remove();
            $fieldContainer.hide();
            $loadingSpinner.show();
            $createButton.attr("disabled", "disabled");
            hideSelect($versionSelectField);
            hideSelect($componentSelectField);

            $.ajax({
                url: AJS.contextPath() + "/ajax/issueTypeSchema.action",
                data: {
                    appLinkId: $("#jiraServer option:selected").val(),
                    projectKey: projectKey,
                    issueTypeId: issueTypeId,
                    returnUrl: options.returnUrl
                },
                dataType: 'json',
                contentType: 'application/json',
                success: function (data) {
                    if (data.status != 'ERROR') {
                        var fields = data.projects[0].issuetypes[0].fields,
                            unhandledRequiredFields = "";

                        for (var fieldName in fields) {
                            if (fields.hasOwnProperty(fieldName)) {
                                var field = fields[fieldName];
                                if (fieldName == "summary") {
                                    setRequiredField($("#jiraIssueSummary"), field.required);
                                } else if (fieldName == "description") {
                                    setRequiredField($("#issueDescription"), field.required);
                                } else if (fieldName == "components") {
                                    populateMultiSelect($componentSelectField, field);
                                } else if (fieldName == "versions") {
                                    populateMultiSelect($versionSelectField, field);
                                } else if (field.required && fieldName != "issuetype" && fieldName != "reporter" && fieldName != "project" && fieldName != "assignee") {
                                    unhandledRequiredFields = unhandledRequiredFields + " " + field.name;
                                }
                            }
                        }
                        $loadingSpinner.hide();
                        if (unhandledRequiredFields.length) {
                            $messageContainer.append(AJS.template.load(options.templates.cannotCreateTemplate).fill({issueTypeName: data.projects[0].issuetypes[0].name, fieldNames: unhandledRequiredFields}).toString()).show();
                        } else {
                            $createButton.removeAttr("disabled");
                            $fieldContainer.show();
                        }
                    } else {
                        populateErrors(data);
                    }
                },
                error: function (request, textStatus, errorThrown) {}
            });
        },
        serverSelect = function () {
            var projectsById = {},
                $loginDanceContainer = $("#login-dance-message-container"),
                $issueContainer = $("#issue-contents-container"),
                $messageContainer = $("#cannot-create-message-container");

            $("#executeCreateNewJiraIssue_save").attr("disabled", "disabled");
            $("#jiraServer").attr("disabled", "disabled");
            $loginDanceContainer.hide();
            $issueContainer.hide();
            $("#cannot-create-message-container").hide();
            $("#issue-loading-spinner").show();
            $('#jiraProjectKey option').remove();
            $('#jiraIssueType option').remove();
            $messageContainer.hide().children().remove();

            $.ajax({
                url: AJS.contextPath() + "/ajax/jiraIssueSchema.action",
                data: {
                    appLinkId: $("#jiraServer option:selected").val(),
                    returnUrl: options.returnUrl
                },
                dataType: 'json',
                contentType: 'application/json',
                success: function (data) {
                    if (data.status != 'ERROR') {
                        var $projects = $('#jiraProjectKey'),
                            projectIdExists = false;

                        // there is a slight chance of multiple requests being made via selenium or bad programming.
                        // this prevents the project list from getting duplicate options
                        $projects.children().remove();

                        if (data.projects && data.projects.length) {
                            $(data.projects).each(function () {
                                projectsById[this.id] = this;
                                $('<option />', {
                                    val: this.id,
                                    text: this.name
                                }).appendTo($projects);
                                if (this.id == options.projectId) {
                                    projectIdExists = true;
                                }
                            });

                            $projects.unbind();
                            var updateForProject = function () {
                                var project = $('option:selected', $projects),
                                    projectScheme = projectsById[project.val()],
                                    issueTypeExists = false,
                                    $types = $('#jiraIssueType');

                                $types.find("option").remove();
                                $types.unbind();
                                $(projectScheme.issuetypes).each(function () {
                                    if (!this.subtask) {
                                        $('<option />', {
                                            val: this.id,
                                            text: this.name,
                                            title: this.description
                                        }).appendTo($types);
                                        if (this.id == options.issueTypeId) {
                                            issueTypeExists = true;
                                        }
                                    }
                                });

                                var updateForType = function () {
                                    populateForm(projectScheme.key, $types.val());
                                };
                                $types.change(function () {
                                    clearErrors();
                                    updateForType();
                                });
                                if (firstTime && issueTypeExists) {
                                    $types.val(options.issueTypeId);
                                }
                                updateForType();
                            };
                            $projects.change(function () {
                                clearErrors();
                                updateForProject();
                            });
                            if (firstTime && projectIdExists) {
                                $projects.val(options.projectId);
                            }
                            updateForProject();
                            $projects.focus();
                            $loginDanceContainer.hide();
                            $issueContainer.show();
                            firstTime=false;
                        } else {
                            var $message = BAMBOO.buildAUIErrorMessage([options.noProjectsMessage]);
                            $message.append(AJS.template.load(options.templates.genericErrorHelpLink).toString());
                            $messageContainer.append($message).show();
                        }
                    } else if (data.authenticationRedirectUrl && data.authenticationRedirectUrl.length) {
                        $loginDanceContainer.children().remove();
                        $loginDanceContainer.append(AJS.template.load(options.templates.authenticationRequiredTemplate).fill({ authenticationUrl: data.authenticationRedirectUrl, authenticationInstanceName: (data['authenticationInstanceName'] || "JIRA") }).toString()).show();
                        $issueContainer.hide();
                    } else {
                        populateErrors(data);
                    }
                    $("#issue-loading-spinner").hide();
                    $("#jiraServer").removeAttr("disabled");
                },
                error: function (request, textStatus, errorThrown) {}
            });
        };

    return {
        init: function (opts) {
            options = $.extend(true, defaults, opts);
            firstTime = true;
            $("#executeCreateNewJiraIssue").find(".buttons-container").prepend(AJS.template.load(options.templates.shortcutHint).toString());
            var $jiraServer = $("#jiraServer");
            $jiraServer.change(function () {
                clearErrors();
                serverSelect();
            });
            if (options.applinkId && $jiraServer.find("option[value='" + options.applinkId + "']").length) {
                $jiraServer.val(options.applinkId);
            }
            serverSelect();
            $jiraServer.closest('form').bind('asyncform-notification', function (e, messages, warnings) {
                var messageDialog, $messages = $('<div />');

                if (messages && messages.length) {
                    $messages.append(BAMBOO.buildAUIMessage(messages, 'success', {escapeTitle: false}));
                }
                if (warnings && warnings.length) {
                    var $message = BAMBOO.buildAUIWarningMessage(warnings);
                    $message.append(AJS.template.load(options.templates.genericErrorHelpLink).toString());
                    $messages.append($message);
                }
                if ($messages.children().length) {
                    $messages.hide().appendTo(document.body); // append to the DOM so we can calculate how big the dialog should be to accommodate the messages
                    messageDialog = new AJS.Dialog({
                        width: 600,
                        height: $messages.innerHeight() + 70 // ~70px should be enough for the button bar plus a bit of padding
                    });
                    messageDialog.addPanel('', $messages.remove().html());
                    messageDialog.addButton("Close", function (dialog) {
                        dialog.remove();
                    });
                    messageDialog.show();
                }
            });
        },
        returnFromDialog: function (response) {
            BAMBOO.JIRAISSUES.refresh(response['newIssueKey']);
        }
    };
})(jQuery);


BAMBOO.JIRAISSUECREATION.NOAPPLINK = (function ($) {
    var defaults = {
        trigger: null,
        contentTemplate: null,
        appLinksAdminUrl: null,
        admin: null
    },
    options,
    showDialog = function () {
        var dialog = new AJS.Dialog({
            width: 600,
            height: 600,
            keypressListener: function (e) {
                if (e.which == jQuery.ui.keyCode.ESCAPE) {
                    dialog.remove();
                }
            }
        });
        dialog.addHeader("Create issue for build");
        dialog.addPanel("", AJS.template.load(options.contentTemplate).toString());
        if (options.admin) {
            dialog.addButton("Connect to JIRA", function (dialog) {
                window.location = options.appLinksAdminUrl;
            });
        }
        dialog.addCancel("Cancel", function (dialog)
        {
            dialog.hide();
        });
        dialog.show();
    };

    return {
        init: function (opts) {
            options = $.extend(true, defaults, opts);
            $(document).delegate(options.trigger, "click", function (e) {
                e.preventDefault();
                showDialog();
            });
        }
    }
})(AJS.$);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/transition-jira-issue.js' */
BAMBOO.JIRAISSUETRANSITION = (function ($) {
    var opts = {
        issueKey: null,
        returnUrl: null
    },
    $errorMessagesContainer,
    $issueControlsContainer,
    $loginDanceMessageContainer,
    $loadingSpinner,
    $issueDetails,
    $issueStatus,
    $transitionButton,
    $transitionSelect,
    $transitionIssueResolution,
    $resolutionButton,
    $resolutionSelect,

    onTransitionClick = function() {
        $transitionButton.attr("disabled", "disabled");
        $transitionSelect.attr("disabled", "disabled");
        $resolutionButton.attr("disabled", "disabled");
        $resolutionSelect.attr("disabled", "disabled");
        $loadingSpinner.show();
        AJS.$.ajax({
            url: AJS.contextPath() + "/ajax/transitionIssue.action?issueKey=" + opts.issueKey + "&transitionId=" + $transitionButton.val()
                    + ($transitionIssueResolution.is(":visible") ? ("&resolutionId=" + $resolutionButton.val()) : "")
                    + "&returnUrl=" + encodeURIComponent(opts.returnUrl),
            dataType: 'json',
            contentType: 'application/json',
            success: function(response) {
                if (response.status != 'ERROR') {
                    if (response.requireResolution) {
                        $resolutionSelect.children().remove();
                        $(response.resolution.allowedValues).each(function(){
                            $('<option value="' + this.id + '"></option>').appendTo($resolutionSelect).text(this.name);
                        });
                        $resolutionSelect.change();
                        $resolutionButton.removeAttr("disabled");
                        $resolutionSelect.removeAttr("disabled");
                        $transitionIssueResolution.show();
                        $loadingSpinner.hide();
                    } else {
                        refreshIssueStatus();
                    }
                } else {
                    handleErrorResponse(response);
                }
                handleLoginDanceResponse(response);
            },
            error: function (request, textStatus, errorThrown) {
                $transitionButton.removeAttr("disabled");
                $transitionSelect.removeAttr("disabled");
                $resolutionButton.removeAttr("disabled");
                $resolutionSelect.removeAttr("disabled");
            }
        });

    },

    onChangeTransition = function() {
        $transitionButton.val($transitionSelect.val());
        $transitionButton.text($(":selected", $transitionSelect).text());
    },

    onChangeResolution = function() {
        $resolutionButton.val($resolutionSelect.val());
        $resolutionButton.text($(":selected", $resolutionSelect).text());
    },

    refreshIssueStatus = function() {
        $loadingSpinner.show();
        AJS.$.ajax({
            url: AJS.contextPath() + "/ajax/issueDetails.action?issueKey=" + opts.issueKey
                    + "&returnUrl=" + encodeURIComponent(opts.returnUrl),
            dataType: 'json',
            contentType: 'application/json',
            success: function(response) {
                if (response.status != 'ERROR') {
                    $issueDetails.children().remove();
                    $issueDetails.append(AJS.template.load("issueDetails-template").fill({url: response.issueUrl, title: response.fields.summary, iconUrl: response.fields.issuetype.iconUrl, key: response.key}).toString());

                    $issueStatus.children().remove();
                    $issueStatus.append(AJS.template.load("issueStatus-template").fill({iconUrl: response.fields.status.iconUrl, name: response.fields.status.name}).toString());
                    refreshTransitions();
                } else {
                    handleErrorResponse(response);
                }
                handleLoginDanceResponse(response);
            },
            error: function (request, textStatus, errorThrown) {
            }
        });
    },

    refreshTransitions = function() {
        AJS.$.ajax({
            url: AJS.contextPath() + "/ajax/issueTransitions.action?issueKey=" + opts.issueKey
                    + "&returnUrl=" + encodeURIComponent(opts.returnUrl),
            dataType: 'json',
            contentType: 'application/json',
            success: function(response) {
                if (response.status != 'ERROR') {
                    $transitionSelect.children().remove();
                    $(response.transitions).each(function(){
                        $('<option value="' + this.id + '"></option>').appendTo($transitionSelect).text(this.name);
                    });
                    $transitionSelect.change();
                    $issueControlsContainer.show();
                } else {
                    handleErrorResponse(response);
                }
                $loadingSpinner.hide();
                $transitionButton.removeAttr("disabled");
                $transitionSelect.removeAttr("disabled");
                $transitionIssueResolution.hide();
                handleLoginDanceResponse(response);
            },
            error: function (request, textStatus, errorThrown) {
            }
        });
    },

    handleLoginDanceResponse = function(response) {
        if (isDefinedObject(response.authenticationRedirectUrl)) {
            $loginDanceMessageContainer.children().remove();
            $loginDanceMessageContainer.append(AJS.template.load("authenticationRequired-template").fill({authenticationUrl: response.authenticationRedirectUrl}).toString()).show();
            $loginDanceMessageContainer.show();
            $issueControlsContainer.hide();
        } else {
            $loginDanceMessageContainer.hide();
        }
    },

    handleErrorResponse = function(response) {
        $errorMessagesContainer.children().remove();
        $(response.errors).each(function(){
            AJS.messages.error($errorMessagesContainer, { body: this, closeable: false });
        });
        $issueControlsContainer.hide();
        $errorMessagesContainer.show();
        $loadingSpinner.hide();
    };

    return {
        init: function (options) {
            $.extend(true, opts, options);
            $errorMessagesContainer = $("#error-messages-container");
            $issueControlsContainer = $("#issue-controls-container");
            $loginDanceMessageContainer = $("#login-dance-message-container");
            $loadingSpinner = $("#loading-spinner");
            $issueDetails = $("#issue-details");
            $issueStatus = $("#issue-status");
            $transitionButton = $("#transition-button");
            $transitionButton.click(onTransitionClick);
            $transitionSelect = $("#transition-select");
            $transitionSelect.change(onChangeTransition);
            $transitionIssueResolution = $("#transition-issue-resolution");
            $resolutionButton = $("#resolution-button");
            $resolutionButton.click(onTransitionClick);
            $resolutionSelect = $("#resolution-select");
            $resolutionSelect.change(onChangeResolution);
            refreshIssueStatus();
        }
    }
})(jQuery);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/test-actions.js' */
BAMBOO.TESTACTIONS = (function ($, _) {
    var toggleFail = function (jqXHR) {
        var json,
                message = 'An error occurred while connecting to Bamboo server. Please refresh the page and try again.';

        try {
            json = $.parseJSON(jqXHR.responseText);
            if (json.errors && json.errors.length) {
                message += "\n\n" + json.errors.join("\n");
            }
        }
        catch (e) {}
        alert(message); //todo: ask Matty how to better present error message
    };

    $(document).delegate(".unlink-test-to-jira-action", "click", function (e) {
        var $button = $(this),
                $toolbarItem = $button.closest(".toolbar-item"),
                isDisabledClass = "disabled",
                jqXHR;

        e.preventDefault();

        if (!$toolbarItem.hasClass(isDisabledClass)) {
            $toolbarItem.addClass(isDisabledClass);
            jqXHR = $.post($button.attr("href"), { "bamboo.successReturnMode": "json" }).fail(toggleFail).always(function () { $toolbarItem.removeClass(isDisabledClass); });

            jqXHR.done(function (json) {
                if (json && json.status && json.status == "OK") {
                    var $tableRows = AJS.$(".test-case-row-"+$button.data('testCaseId'));
                    $tableRows.find(".linked-jira-issue").html('');

                    $tableRows.find(".link-test-to-jira-action").toggleClass("hidden", false);
                    $tableRows.find(".create-jira-issue-for-test-action").toggleClass("hidden", false);
                    $tableRows.find(".unlink-test-to-jira-action").toggleClass("hidden", true);
                } else {
                    toggleFail(jqXHR);
                }
            });
        }
    });

    var renderLinkedJiraIssue = function ($element, issue) {
        $element.html(bamboo.feature.jiraIssueList.singleIssue(issue));
    };

    return {
        onReturnFromLinkingIssueManually: function (json) {
            if (json && json.status && json.status == "OK") {
                var $tableRows = AJS.$(".test-case-row-"+json.testCaseId),
                        $linkedJiraIssueContainers = $tableRows.find(".linked-jira-issue");

                if (json.authenticationRedirectUrl)
                {
                    $linkedJiraIssueContainers.html(bamboo.feature.jiraIssueList.singleIssueOAuth({
                        key: json.issue.key,
                        keyLink: AJS.contextPath() + '/project/jiraRedirect.action?jiraIssueKey=' + json.issue.key,
                        authenticationRedirectUrl: json.authenticationRedirectUrl + '&redirectUrl=' + encodeURIComponent(document.location.href),
                        authenticationInstanceName: json.authenticationInstanceName
                    }));
                }
                else
                {
                    renderLinkedJiraIssue($linkedJiraIssueContainers, json.issue);
                }

                $tableRows.find(".unlink-test-to-jira-action").toggleClass("hidden", false);
                $tableRows.find(".link-test-to-jira-action").toggleClass("hidden", true);
                $tableRows.find(".create-jira-issue-for-test-action").toggleClass("hidden", true);
            } else {
                //show some error alert?... shouldn't happen anyway...
            }
        }
    };

})(jQuery, _);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/config-sidebar.js' */
BAMBOO.ConfigSidebar = (function ($) {
    var classes = {
            animating: "animating",
            collapsed: "collapsed",
            expanded: "expanded",
            icons: {
                collapse: "icon-collapse",
                expand: "icon-expand"
            }
        },
        toggleState = function (shouldExpand) {
            var $h2 = $(this),
                $icon = $h2.children(".icon").addClass(classes.animating),
                $listOrMessage = $h2.next();

            $listOrMessage[shouldExpand ? "slideDown" : "slideUp"](function () {
                $h2.removeClass(shouldExpand ? classes.collapsed : classes.expanded).addClass(shouldExpand ? classes.expanded : classes.collapsed);
                $icon
                    .removeClass(classes.animating)
                    .removeClass(shouldExpand ? classes.icons.expand : classes.icons.collapse)
                    .addClass(shouldExpand ? classes.icons.collapse : classes.icons.expand);
                AJS.Cookie.save("config.sidebar." + $h2.data("sidebarSection") + ".expanded", shouldExpand, 365);
            });
        };

    return {
        init: function () {
            $(function () {
                var $configSidebar = $("#config-sidebar")
                    .delegate("." + classes.collapsed, "click", function () { toggleState.call(this, true); })
                    .delegate("." + classes.expanded, "click", function () { toggleState.call(this, false); });

                $configSidebar.find("ul a").each(function () {
                    var $a = $(this);

                    if ($a.isClipped() && !$a.attr("title")) {
                        $a.attr("title", $a.text());
                    }
                });
                $configSidebar.children("." + classes.collapsed).each(function () {
                    $(this).next().hide();
                });
            });
        }
    };
})(AJS.$);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/plan-branches.js' */
BAMBOO.BRANCHES = {};

BAMBOO.BRANCHES.EditChainBranchDetails = function (opts) {
    var $ = AJS.$,
            defaults = {
                controls : {
                    form: null,
                    integrationEnabled: null,
                    integrationStrategy: null,
                    gateKeeperCheckoutBranch: null,
                    gateKeeperPushBranch: null,
                    integrationStrategies: '.integration-strategy'
                }
            },
            options = $.extend(true, defaults, opts),
            $controls = {
                form: null,
                integrationStrategy: null,
                gateKeeperPushBranch: null
            },
            onChangeGateKeeperCheckoutBranch = function() {
                var gateKeeperBranch = $(this).find('option:selected').text();
                $controls.gateKeeperPushBranch.text(gateKeeperBranch);
            },
            onChangeIntegrationEnabled = function() {
                if ($(this).is(':checked')) {
                    if (!$controls.integrationStrategy.is(':checked')) {
                        $controls.integrationStrategy.filter(':first').prop('checked', true);
                    }
                    indicateActiveStrategy();
                }
            },
            indicateActiveStrategy = function () {
                $controls.integrationStrategy.each(function () {
                    var $radio = $(this);

                    $radio.closest(options.controls.integrationStrategies).toggleClass('active', $radio.is(':checked'));
                });
            },
            onClickInStrategy = function () {
                $(this).find(options.controls.integrationStrategy).prop('checked', true);
                indicateActiveStrategy();
            };

    return {
        init: function () {
            $controls.form = $(options.controls.form);
            $controls.integrationStrategy = $controls.form.find(options.controls.integrationStrategy).click(indicateActiveStrategy);
            $controls.gateKeeperPushBranch = $controls.form.find(options.controls.gateKeeperPushBranch);

            $controls.form.find(options.controls.gateKeeperCheckoutBranch).change(onChangeGateKeeperCheckoutBranch).each(onChangeGateKeeperCheckoutBranch);
            $controls.form.find(options.controls.integrationEnabled).change(onChangeIntegrationEnabled).each(onChangeIntegrationEnabled);
            $controls.form.find(options.controls.integrationStrategies).click(onClickInStrategy);
        }
    };
};

BAMBOO.BRANCHES.BranchesSplashScreen = (function ($) {
    var defaults = {
            content: null,
            contentId: 'branch-splash-content',
            dialog: {
                width: 688,
                height: 480,
                id: 'branch-splash',
                keypressListener: function (e) {
                    if (e.which == jQuery.ui.keyCode.ESCAPE) {
                        dialog.remove();
                    }
                }
            },
            templates: {
                dontShowCheckbox: null
            }
        },
        options,
        dialog,
        $dontShowCheckbox;

    return {
        init: function (opts) {
            options = $.extend(true, defaults, opts);

            dialog = new AJS.Dialog(options.dialog)
                .addHeader("Building branches")
                .addPanel('', $('<div />', { html: options.content, id: options.contentId }))
                .addButton("Close", function () { dialog.remove(); });

            $dontShowCheckbox = $(AJS.template.load(options.templates.dontShowCheckbox).toString())
                .prependTo($(dialog.page[0].element).find('.dialog-button-panel'))
                .find('input:checkbox');

            dialog.show();

            $(window).bind('remove.dialog', function (e, data) {
                if (data.dialog.id === options.dialog.id && $dontShowCheckbox.is(':checked')) {
                    $.post(AJS.contextPath() + '/rest/pref/latest/user', { 'bamboo.user.branches.splashscreen.hide': true });
                }
            });
        }
    }
})(jQuery);;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/plan-branch-selector.js' */
BAMBOO.PlanBranchSelector = function (opts) {
    var $ = AJS.$,
        defaults = {
            trigger: null,
            planKey: null,
            id: 'plan-branch-selector',
            includeMaster: false,
            masterBranchName: null,
            masterBranchDescription: null,
            includeLatestResult: false,
            inlineDialogClass: null,
            maxBranches: 10,
            getPlanDetailsUrl: AJS.contextPath() + '/rest/api/latest/plan/{planKey}/branch',
            templates: {
                branchItem: null,
                branchItemActiveBuild: null
            }
        },
        options = $.extend(true, defaults, opts),
        inlineDialog,
        createInlineDialogContent = function ($contents, trigger, showInlineDialog) {
            var $trigger = $(trigger),
                planKey = (options.planKey || $trigger.data('planKey'));

            $contents.html(widget.icons.icon({ type: 'loading' }));

            if (!inlineDialog.is(':visible')) {
                showInlineDialog();
            }
            inlineDialog.refresh();

            getPlanDetails(planKey).done(function (json) {
                var $ul = $('<ul/>'),
                    branches = json['branches']['branch'];

                if (options.includeMaster) {
                    $(AJS.template.load(options.templates.branchItem).fill({
                        key: planKey,
                        shortName: options.masterBranchName,
                        description: options.masterBranchDescription
                    }).toString()).addClass('master').appendTo($ul);
                }

                for (var i = 0, ii = branches.length; i < ii; i++) {
                    var branchData = branches[i],
                        defaultBranchData = {
                            latestResult: {
                                key: branchData['key'] + '/latest',
                                state: 'NeverExecuted',
                                number: '--',
                                suspendedClass: "",
                                description: ""
                            }
                        },
                        branch = $.extend(true, defaultBranchData, branchData),
                        latestResultNumber = branch['latestResult']['number'];

                    if (typeof latestResultNumber == 'number') {
                        branch['latestResult']['number'] = '#' + latestResultNumber;
                    }

                    if (!branchData.enabled) {
                        branch.latestResult.suspendedClass = "Suspended";
                    }
                    $(AJS.template.load((options.templates.branchItemActiveBuild && branch['latestCurrentlyActive'] ? options.templates.branchItemActiveBuild : options.templates.branchItem)).fill(branch).toString()).appendTo($ul);
                }

                $contents.html($ul);
                $('<a/>', {
                    text: "View all branches",
                    href: AJS.contextPath() + '/browse/' + planKey + '/branches',
                    'class': 'complete-listing'
                }).insertAfter($ul);

                showInlineDialog();
            });
        },
        getPlanDetails = function (planKey) {
            return $.ajax({
                url: options.getPlanDetailsUrl.replace('{planKey}', planKey),
                cache: false,
                dataType: 'json',
                data: {
                    expand: (options.includeLatestResult ? 'branches.branch' : 'branches'),
                    'max-results': (options.maxBranches || 0)
                }
            });
        };

    return {
        init: function () {
            inlineDialog = AJS.InlineDialog(options.trigger, options.id, createInlineDialogContent, {
                fadeTime: 0,
                showDelay: 0,
                useLiveEvents: true,
                width: 250,
                offsetY: 14,
                arrowOffsetX: 10
            }).addClass('plan-branch-selector ' + (options.inlineDialogClass || ''));
            
            $(document).delegate(options.trigger, 'keydown', function (e) {
                if (e.which == jQuery.ui.keyCode.ENTER) {
                    e.preventDefault();
                    inlineDialog.show.call(this);
                }
            });
        }
    };
};
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/scripts/branch-creation.js' */
BAMBOO.BranchCreation = (function ($) {
    var defaults = {
        containerSelector: null,
        checkBoxFieldSetSelector: null,
        showMoreSelector: null,
        placeHolderSelector: null,
        optionsSelector: null,
        getBranchesUrl: null,
        planKey: null,
        templates: {
            branchesList: null,
            branchesItem: null,
            branchesNone: null,
            branchesTooMany: null,
            branchesTimeout: null,
            branchesError: null
        }
    },
    options,
    lastResult = 0,
    $container,
    execute = function () {
        var $branchesCheckboxes = $(options.checkBoxFieldSetSelector);
        if (!$branchesCheckboxes.length)  {
            lastResult = 0; /*reset if there is no checkboxes on the page*/
        }
        $.ajax({
            url: options.getBranchesUrl,
            cache: false,
            dataType: 'json',
            data: {
                planKey: options.planKey,
                "start-index": lastResult,
                "max-results": lastResult > 0 ? 100 : 30
            }
        }).done(function (json) {
            $(options.placeHolderSelector).remove();
            var branches = json["branches"]["branch"];
            if (branches && branches.length > 0) {
                var $toAppend = $();
                for (var i = 0, ii = branches.length; i < ii; i++) {
                    $toAppend = $toAppend.add($(AJS.template.load(options.templates.branchesItem).fill({branch: branches[i].name, itemCount: (i+lastResult)}).toString()));
                }

                if (!$branchesCheckboxes.length) {
                    var $branchesContent = $(AJS.template.load(options.templates.branchesList).toString());
                    $branchesCheckboxes = $branchesContent.filter(options.checkBoxFieldSetSelector);
                    $toAppend.appendTo($branchesCheckboxes);
                    $branchesContent.appendTo($container);
                } else {
                    $toAppend.appendTo($branchesCheckboxes);
                }

                var $tooManyBranches = $(options.showMoreSelector);
                lastResult = json.branches["max-result"] + json.branches["start-index"];
                if (!$tooManyBranches.length && json.branches["size"] > lastResult) {
                    $(AJS.template.load(options.templates.branchesTooMany).toString()).appendTo($container);
                } else if ($tooManyBranches.length && json.branches["size"] <= lastResult) {
                    $tooManyBranches.remove();
                }
                $(options.optionsSelector).show().removeClass("hidden");
            } else {
                $(AJS.template.load(options.templates.branchesNone).toString()).appendTo($container);
            }
        }).error(function(jqXHR, textStatus, errorThrown) {
            $(options.placeHolderSelector).remove();
            if (textStatus === "timeout") {
                BAMBOO.buildAUIMessage([AJS.template.load(options.templates.branchesTimeout).toString()], "error", {escapeTitle:false}).appendTo($container);
            } else {
                BAMBOO.buildAUIMessage([AJS.template.load(options.templates.branchesError).toString()], "error", {escapeTitle:false}).appendTo($container);
            }
        });
    },
    switchToAuto = function() {
                 $("#autoBranchCreation").show().removeClass("hidden");
                 $("#manualBranchCreation").hide().addClass("hidden");
                 $("#creationOption").val("AUTO");
    },
    switchToManual = function(){
                 $("#manualBranchCreation").show().removeClass("hidden");
                 $("#autoBranchCreation").hide().addClass("hidden");
                 $("#creationOption").val("MANUAL");
    };

    return {
        init: function (opts) {
            options = $.extend(true, defaults, opts);
            $("#createPlanBranch").delegate(".switchToAuto", "click", switchToAuto)
                                  .delegate(".switchToManual", "click", switchToManual)
                                  .delegate(options.showMoreSelector, "click", execute);
            $container = $(options.containerSelector);
            execute();
        }
    };
})(AJS.$);
;
;
/* module-key = 'bamboo.web.resources:bamboo-js', location = '/widget/error/error.js' */
define('widget/generate-error-messages', [
    'jquery',
    'underscore'
], function(
    $,
    _
) {

    'use strict';

    var generateErrorMessages = function(jqXHR, textStatus, errorThrown) {
        var $message, data;
        try {
            data = $.parseJSON(jqXHR.responseText);
            if (data.errors && data.errors.length) {
                $message = BAMBOO.buildAUIErrorMessage(data.errors);
            } else if (data.fieldErrors && data.fieldErrors.length) {
                var renderedErrors = [];
                for (var fieldError in data.fieldErrors) {
                    if (data.fieldErrors.hasOwnProperty(fieldError)) {
                        renderedErrors.push(fieldError + ': ' + data.fieldErrors[fieldError]);
                    }
                }
                $message = BAMBOO.buildAUIErrorMessage(renderedErrors);
            } else if (data.messages && data.messages.length) {
                $message = BAMBOO.buildAUIWarningMessage(data.messages);
            }
        } catch (ignore) {}
        return $message;
    };

    return generateErrorMessages;

});
;
;
/* module-key = 'bamboo.web.resources:aceEditor', location = '/scripts/ace/bamboo-ace.js' */
var AceEditorManager = function($) {
    var
            toEditorSession = function(aceDataModel) {
                var $aceDataModel = $(aceDataModel),
                        editorRef = $aceDataModel.data("editorRef");
                return eval(editorRef).getSession();
            },
            forEachDataModel = function(fun) {
                $(".aceDataModel").each(fun);
            };
    return {
        init: function() {
            forEachDataModel(function(){ toEditorSession(this).setValue($(this).val());  } );
        },
        editorToModel: function() {
            forEachDataModel(function(){ $(this).val(toEditorSession(this).getValue()); }  );
        }
    }
}(jQuery);
;
;
/* module-key = 'bamboo.web.resources:aceEditor', location = '/bower/ace-builds/ace.js' */
/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

(function() {

var ACE_NAMESPACE = "ace";

var global = (function() {
    return this;
})();


if (!ACE_NAMESPACE && typeof requirejs !== "undefined")
    return;


var _define = function(module, deps, payload) {
    if (typeof module !== 'string') {
        if (_define.original)
            _define.original.apply(window, arguments);
        else {
            console.error('dropping module because define wasn\'t a string.');
            console.trace();
        }
        return;
    }

    if (arguments.length == 2)
        payload = deps;

    if (!_define.modules) {
        _define.modules = {};
        _define.payloads = {};
    }
    
    _define.payloads[module] = payload;
    _define.modules[module] = null;
};
var _require = function(parentId, module, callback) {
    if (Object.prototype.toString.call(module) === "[object Array]") {
        var params = [];
        for (var i = 0, l = module.length; i < l; ++i) {
            var dep = lookup(parentId, module[i]);
            if (!dep && _require.original)
                return _require.original.apply(window, arguments);
            params.push(dep);
        }
        if (callback) {
            callback.apply(null, params);
        }
    }
    else if (typeof module === 'string') {
        var payload = lookup(parentId, module);
        if (!payload && _require.original)
            return _require.original.apply(window, arguments);

        if (callback) {
            callback();
        }

        return payload;
    }
    else {
        if (_require.original)
            return _require.original.apply(window, arguments);
    }
};

var normalizeModule = function(parentId, moduleName) {
    if (moduleName.indexOf("!") !== -1) {
        var chunks = moduleName.split("!");
        return normalizeModule(parentId, chunks[0]) + "!" + normalizeModule(parentId, chunks[1]);
    }
    if (moduleName.charAt(0) == ".") {
        var base = parentId.split("/").slice(0, -1).join("/");
        moduleName = base + "/" + moduleName;

        while(moduleName.indexOf(".") !== -1 && previous != moduleName) {
            var previous = moduleName;
            moduleName = moduleName.replace(/\/\.\//, "/").replace(/[^\/]+\/\.\.\//, "");
        }
    }

    return moduleName;
};
var lookup = function(parentId, moduleName) {

    moduleName = normalizeModule(parentId, moduleName);

    var module = _define.modules[moduleName];
    if (!module) {
        module = _define.payloads[moduleName];
        if (typeof module === 'function') {
            var exports = {};
            var mod = {
                id: moduleName,
                uri: '',
                exports: exports,
                packaged: true
            };

            var req = function(module, callback) {
                return _require(moduleName, module, callback);
            };

            var returnValue = module(req, exports, mod);
            exports = returnValue || mod.exports;
            _define.modules[moduleName] = exports;
            delete _define.payloads[moduleName];
        }
        module = _define.modules[moduleName] = exports || module;
    }
    return module;
};

function exportAce(ns) {
    var require = function(module, callback) {
        return _require("", module, callback);
    };    

    var root = global;
    if (ns) {
        if (!global[ns])
            global[ns] = {};
        root = global[ns];
    }

    if (!root.define || !root.define.packaged) {
        _define.original = root.define;
        root.define = _define;
        root.define.packaged = true;
    }

    if (!root.require || !root.require.packaged) {
        _require.original = root.require;
        root.require = require;
        root.require.packaged = true;
    }
}

exportAce(ACE_NAMESPACE);

})();

ace.define('ace/ace', ['require', 'exports', 'module' , 'ace/lib/fixoldbrowsers', 'ace/lib/dom', 'ace/lib/event', 'ace/editor', 'ace/edit_session', 'ace/undomanager', 'ace/virtual_renderer', 'ace/multi_select', 'ace/worker/worker_client', 'ace/keyboard/hash_handler', 'ace/placeholder', 'ace/mode/folding/fold_mode', 'ace/theme/textmate', 'ace/ext/error_marker', 'ace/config'], function(require, exports, module) {


require("./lib/fixoldbrowsers");

var dom = require("./lib/dom");
var event = require("./lib/event");

var Editor = require("./editor").Editor;
var EditSession = require("./edit_session").EditSession;
var UndoManager = require("./undomanager").UndoManager;
var Renderer = require("./virtual_renderer").VirtualRenderer;
var MultiSelect = require("./multi_select").MultiSelect;
require("./worker/worker_client");
require("./keyboard/hash_handler");
require("./placeholder");
require("./mode/folding/fold_mode");
require("./theme/textmate");
require("./ext/error_marker");

exports.config = require("./config");
exports.require = require;
exports.edit = function(el) {
    if (typeof(el) == "string") {
        var _id = el;
        var el = document.getElementById(_id);
        if (!el)
            throw new Error("ace.edit can't find div #" + _id);
    }

    if (el.env && el.env.editor instanceof Editor)
        return el.env.editor;

    var doc = exports.createEditSession(dom.getInnerText(el));
    el.innerHTML = '';

    var editor = new Editor(new Renderer(el));
    new MultiSelect(editor);
    editor.setSession(doc);

    var env = {
        document: doc,
        editor: editor,
        onResize: editor.resize.bind(editor, null)
    };
    event.addListener(window, "resize", env.onResize);
    editor.on("destroy", function() {
        event.removeListener(window, "resize", env.onResize);
    });
    el.env = editor.env = env;
    return editor;
};
exports.createEditSession = function(text, mode) {
    var doc = new EditSession(text, mode);
    doc.setUndoManager(new UndoManager());
    return doc;
}
exports.EditSession = EditSession;
exports.UndoManager = UndoManager;
});

ace.define('ace/mode/behaviour', ['require', 'exports', 'module' ], function(require, exports, module) {


var Behaviour = function() {
   this.$behaviours = {};
};

(function () {

    this.add = function (name, action, callback) {
        switch (undefined) {
          case this.$behaviours:
              this.$behaviours = {};
          case this.$behaviours[name]:
              this.$behaviours[name] = {};
        }
        this.$behaviours[name][action] = callback;
    }
    
    this.addBehaviours = function (behaviours) {
        for (var key in behaviours) {
            for (var action in behaviours[key]) {
                this.add(key, action, behaviours[key][action]);
            }
        }
    }
    
    this.remove = function (name) {
        if (this.$behaviours && this.$behaviours[name]) {
            delete this.$behaviours[name];
        }
    }
    
    this.inherit = function (mode, filter) {
        if (typeof mode === "function") {
            var behaviours = new mode().getBehaviours(filter);
        } else {
            var behaviours = mode.getBehaviours(filter);
        }
        this.addBehaviours(behaviours);
    }
    
    this.getBehaviours = function (filter) {
        if (!filter) {
            return this.$behaviours;
        } else {
            var ret = {}
            for (var i = 0; i < filter.length; i++) {
                if (this.$behaviours[filter[i]]) {
                    ret[filter[i]] = this.$behaviours[filter[i]];
                }
            }
            return ret;
        }
    }

}).call(Behaviour.prototype);

exports.Behaviour = Behaviour;
});
ace.define('ace/unicode', ['require', 'exports', 'module' ], function(require, exports, module) {
exports.packages = {};

addUnicodePackage({
    L:  "0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05250531-055605590561-058705D0-05EA05F0-05F20621-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA07F407F507FA0800-0815081A082408280904-0939093D09500958-0961097109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EC60EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10A0-10C510D0-10FA10FC1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209421022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2D00-2D252D30-2D652D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A65FA662-A66EA67F-A697A6A0-A6E5A717-A71FA722-A788A78BA78CA7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",
    Ll: "0061-007A00AA00B500BA00DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02AF037103730377037B-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F0521052305250561-05871D00-1D2B1D62-1D771D79-1D9A1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF7210A210E210F2113212F21342139213C213D2146-2149214E21842C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7C2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2D00-2D25A641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76FA771-A778A77AA77CA77FA781A783A785A787A78CFB00-FB06FB13-FB17FF41-FF5A",
    Lu: "0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E0520052205240531-055610A0-10C51E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F214521832C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CEDA640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BFF21-FF3A",
    Lt: "01C501C801CB01F21F88-1F8F1F98-1F9F1FA8-1FAF1FBC1FCC1FFC",
    Lm: "02B0-02C102C6-02D102E0-02E402EC02EE0374037A0559064006E506E607F407F507FA081A0824082809710E460EC610FC17D718431AA71C78-1C7D1D2C-1D611D781D9B-1DBF2071207F2090-20942C7D2D6F2E2F30053031-3035303B309D309E30FC-30FEA015A4F8-A4FDA60CA67FA717-A71FA770A788A9CFAA70AADDFF70FF9EFF9F",
    Lo: "01BB01C0-01C3029405D0-05EA05F0-05F20621-063F0641-064A066E066F0671-06D306D506EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA0800-08150904-0939093D09500958-096109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E450E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10D0-10FA1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317DC1820-18421844-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C771CE9-1CEC1CEE-1CF12135-21382D30-2D652D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE3006303C3041-3096309F30A1-30FA30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A014A016-A48CA4D0-A4F7A500-A60BA610-A61FA62AA62BA66EA6A0-A6E5A7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2AA00-AA28AA40-AA42AA44-AA4BAA60-AA6FAA71-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADBAADCABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF66-FF6FFF71-FF9DFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",
    M:  "0300-036F0483-04890591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DE-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0903093C093E-094E0951-0955096209630981-098309BC09BE-09C409C709C809CB-09CD09D709E209E30A01-0A030A3C0A3E-0A420A470A480A4B-0A4D0A510A700A710A750A81-0A830ABC0ABE-0AC50AC7-0AC90ACB-0ACD0AE20AE30B01-0B030B3C0B3E-0B440B470B480B4B-0B4D0B560B570B620B630B820BBE-0BC20BC6-0BC80BCA-0BCD0BD70C01-0C030C3E-0C440C46-0C480C4A-0C4D0C550C560C620C630C820C830CBC0CBE-0CC40CC6-0CC80CCA-0CCD0CD50CD60CE20CE30D020D030D3E-0D440D46-0D480D4A-0D4D0D570D620D630D820D830DCA0DCF-0DD40DD60DD8-0DDF0DF20DF30E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F3E0F3F0F71-0F840F860F870F90-0F970F99-0FBC0FC6102B-103E1056-1059105E-10601062-10641067-106D1071-10741082-108D108F109A-109D135F1712-17141732-1734175217531772177317B6-17D317DD180B-180D18A91920-192B1930-193B19B0-19C019C819C91A17-1A1B1A55-1A5E1A60-1A7C1A7F1B00-1B041B34-1B441B6B-1B731B80-1B821BA1-1BAA1C24-1C371CD0-1CD21CD4-1CE81CED1CF21DC0-1DE61DFD-1DFF20D0-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66F-A672A67CA67DA6F0A6F1A802A806A80BA823-A827A880A881A8B4-A8C4A8E0-A8F1A926-A92DA947-A953A980-A983A9B3-A9C0AA29-AA36AA43AA4CAA4DAA7BAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE3-ABEAABECABEDFB1EFE00-FE0FFE20-FE26",
    Mn: "0300-036F0483-04870591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0902093C0941-0948094D0951-095509620963098109BC09C1-09C409CD09E209E30A010A020A3C0A410A420A470A480A4B-0A4D0A510A700A710A750A810A820ABC0AC1-0AC50AC70AC80ACD0AE20AE30B010B3C0B3F0B41-0B440B4D0B560B620B630B820BC00BCD0C3E-0C400C46-0C480C4A-0C4D0C550C560C620C630CBC0CBF0CC60CCC0CCD0CE20CE30D41-0D440D4D0D620D630DCA0DD2-0DD40DD60E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F71-0F7E0F80-0F840F860F870F90-0F970F99-0FBC0FC6102D-10301032-10371039103A103D103E10581059105E-10601071-1074108210851086108D109D135F1712-17141732-1734175217531772177317B7-17BD17C617C9-17D317DD180B-180D18A91920-19221927192819321939-193B1A171A181A561A58-1A5E1A601A621A65-1A6C1A73-1A7C1A7F1B00-1B031B341B36-1B3A1B3C1B421B6B-1B731B801B811BA2-1BA51BA81BA91C2C-1C331C361C371CD0-1CD21CD4-1CE01CE2-1CE81CED1DC0-1DE61DFD-1DFF20D0-20DC20E120E5-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66FA67CA67DA6F0A6F1A802A806A80BA825A826A8C4A8E0-A8F1A926-A92DA947-A951A980-A982A9B3A9B6-A9B9A9BCAA29-AA2EAA31AA32AA35AA36AA43AA4CAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE5ABE8ABEDFB1EFE00-FE0FFE20-FE26",
    Mc: "0903093E-09400949-094C094E0982098309BE-09C009C709C809CB09CC09D70A030A3E-0A400A830ABE-0AC00AC90ACB0ACC0B020B030B3E0B400B470B480B4B0B4C0B570BBE0BBF0BC10BC20BC6-0BC80BCA-0BCC0BD70C01-0C030C41-0C440C820C830CBE0CC0-0CC40CC70CC80CCA0CCB0CD50CD60D020D030D3E-0D400D46-0D480D4A-0D4C0D570D820D830DCF-0DD10DD8-0DDF0DF20DF30F3E0F3F0F7F102B102C10311038103B103C105610571062-10641067-106D108310841087-108C108F109A-109C17B617BE-17C517C717C81923-19261929-192B193019311933-193819B0-19C019C819C91A19-1A1B1A551A571A611A631A641A6D-1A721B041B351B3B1B3D-1B411B431B441B821BA11BA61BA71BAA1C24-1C2B1C341C351CE11CF2A823A824A827A880A881A8B4-A8C3A952A953A983A9B4A9B5A9BAA9BBA9BD-A9C0AA2FAA30AA33AA34AA4DAA7BABE3ABE4ABE6ABE7ABE9ABEAABEC",
    Me: "0488048906DE20DD-20E020E2-20E4A670-A672",
    N:  "0030-003900B200B300B900BC-00BE0660-066906F0-06F907C0-07C90966-096F09E6-09EF09F4-09F90A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BF20C66-0C6F0C78-0C7E0CE6-0CEF0D66-0D750E50-0E590ED0-0ED90F20-0F331040-10491090-10991369-137C16EE-16F017E0-17E917F0-17F91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C5920702074-20792080-20892150-21822185-21892460-249B24EA-24FF2776-27932CFD30073021-30293038-303A3192-31953220-32293251-325F3280-328932B1-32BFA620-A629A6E6-A6EFA830-A835A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",
    Nd: "0030-00390660-066906F0-06F907C0-07C90966-096F09E6-09EF0A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BEF0C66-0C6F0CE6-0CEF0D66-0D6F0E50-0E590ED0-0ED90F20-0F291040-10491090-109917E0-17E91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C59A620-A629A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",
    Nl: "16EE-16F02160-21822185-218830073021-30293038-303AA6E6-A6EF",
    No: "00B200B300B900BC-00BE09F4-09F90BF0-0BF20C78-0C7E0D70-0D750F2A-0F331369-137C17F0-17F920702074-20792080-20892150-215F21892460-249B24EA-24FF2776-27932CFD3192-31953220-32293251-325F3280-328932B1-32BFA830-A835",
    P:  "0021-00230025-002A002C-002F003A003B003F0040005B-005D005F007B007D00A100AB00B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F3A-0F3D0F850FD0-0FD4104A-104F10FB1361-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2E00-2E2E2E302E313001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65",
    Pd: "002D058A05BE140018062010-20152E172E1A301C303030A0FE31FE32FE58FE63FF0D",
    Ps: "0028005B007B0F3A0F3C169B201A201E2045207D208D23292768276A276C276E27702772277427C527E627E827EA27EC27EE2983298529872989298B298D298F299129932995299729D829DA29FC2E222E242E262E283008300A300C300E3010301430163018301A301DFD3EFE17FE35FE37FE39FE3BFE3DFE3FFE41FE43FE47FE59FE5BFE5DFF08FF3BFF5BFF5FFF62",
    Pe: "0029005D007D0F3B0F3D169C2046207E208E232A2769276B276D276F27712773277527C627E727E927EB27ED27EF298429862988298A298C298E2990299229942996299829D929DB29FD2E232E252E272E293009300B300D300F3011301530173019301B301E301FFD3FFE18FE36FE38FE3AFE3CFE3EFE40FE42FE44FE48FE5AFE5CFE5EFF09FF3DFF5DFF60FF63",
    Pi: "00AB2018201B201C201F20392E022E042E092E0C2E1C2E20",
    Pf: "00BB2019201D203A2E032E052E0A2E0D2E1D2E21",
    Pc: "005F203F20402054FE33FE34FE4D-FE4FFF3F",
    Po: "0021-00230025-0027002A002C002E002F003A003B003F0040005C00A100B700BF037E0387055A-055F058905C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F850FD0-0FD4104A-104F10FB1361-1368166D166E16EB-16ED1735173617D4-17D617D8-17DA1800-18051807-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD3201620172020-20272030-2038203B-203E2041-20432047-205120532055-205E2CF9-2CFC2CFE2CFF2E002E012E06-2E082E0B2E0E-2E162E182E192E1B2E1E2E1F2E2A-2E2E2E302E313001-3003303D30FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFE10-FE16FE19FE30FE45FE46FE49-FE4CFE50-FE52FE54-FE57FE5F-FE61FE68FE6AFE6BFF01-FF03FF05-FF07FF0AFF0CFF0EFF0FFF1AFF1BFF1FFF20FF3CFF61FF64FF65",
    S:  "0024002B003C-003E005E0060007C007E00A2-00A900AC00AE-00B100B400B600B800D700F702C2-02C502D2-02DF02E5-02EB02ED02EF-02FF03750384038503F604820606-0608060B060E060F06E906FD06FE07F609F209F309FA09FB0AF10B700BF3-0BFA0C7F0CF10CF20D790E3F0F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-139917DB194019E0-19FF1B61-1B6A1B74-1B7C1FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE20442052207A-207C208A-208C20A0-20B8210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B2140-2144214A-214D214F2190-2328232B-23E82400-24262440-244A249C-24E92500-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE27C0-27C427C7-27CA27CC27D0-27E527F0-29822999-29D729DC-29FB29FE-2B4C2B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F309B309C319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A700-A716A720A721A789A78AA828-A82BA836-A839AA77-AA79FB29FDFCFDFDFE62FE64-FE66FE69FF04FF0BFF1C-FF1EFF3EFF40FF5CFF5EFFE0-FFE6FFE8-FFEEFFFCFFFD",
    Sm: "002B003C-003E007C007E00AC00B100D700F703F60606-060820442052207A-207C208A-208C2140-2144214B2190-2194219A219B21A021A321A621AE21CE21CF21D221D421F4-22FF2308-230B23202321237C239B-23B323DC-23E125B725C125F8-25FF266F27C0-27C427C7-27CA27CC27D0-27E527F0-27FF2900-29822999-29D729DC-29FB29FE-2AFF2B30-2B442B47-2B4CFB29FE62FE64-FE66FF0BFF1C-FF1EFF5CFF5EFFE2FFE9-FFEC",
    Sc: "002400A2-00A5060B09F209F309FB0AF10BF90E3F17DB20A0-20B8A838FDFCFE69FF04FFE0FFE1FFE5FFE6",
    Sk: "005E006000A800AF00B400B802C2-02C502D2-02DF02E5-02EB02ED02EF-02FF0375038403851FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE309B309CA700-A716A720A721A789A78AFF3EFF40FFE3",
    So: "00A600A700A900AE00B000B60482060E060F06E906FD06FE07F609FA0B700BF3-0BF80BFA0C7F0CF10CF20D790F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-1399194019E0-19FF1B61-1B6A1B74-1B7C210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B214A214C214D214F2195-2199219C-219F21A121A221A421A521A7-21AD21AF-21CD21D021D121D321D5-21F32300-2307230C-231F2322-2328232B-237B237D-239A23B4-23DB23E2-23E82400-24262440-244A249C-24E92500-25B625B8-25C025C2-25F72600-266E2670-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE2800-28FF2B00-2B2F2B452B462B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A828-A82BA836A837A839AA77-AA79FDFDFFE4FFE8FFEDFFEEFFFCFFFD",
    Z:  "002000A01680180E2000-200A20282029202F205F3000",
    Zs: "002000A01680180E2000-200A202F205F3000",
    Zl: "2028",
    Zp: "2029",
    C:  "0000-001F007F-009F00AD03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-0605061C061D0620065F06DD070E070F074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17B417B517DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF200B-200F202A-202E2060-206F20722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-F8FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFD-FF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFFBFFFEFFFF",
    Cc: "0000-001F007F-009F",
    Cf: "00AD0600-060306DD070F17B417B5200B-200F202A-202E2060-2064206A-206FFEFFFFF9-FFFB",
    Co: "E000-F8FF",
    Cs: "D800-DFFF",
    Cn: "03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-05FF06040605061C061D0620065F070E074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF2065-206920722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-D7FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFDFEFEFF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFF8FFFEFFFF"
});

function addUnicodePackage (pack) {
    var codePoint = /\w{4}/g;
    for (var name in pack)
        exports.packages[name] = pack[name].replace(codePoint, "\\u$&");
};

});

ace.define('ace/token_iterator', ['require', 'exports', 'module' ], function(require, exports, module) {
var TokenIterator = function(session, initialRow, initialColumn) {
    this.$session = session;
    this.$row = initialRow;
    this.$rowTokens = session.getTokens(initialRow);

    var token = session.getTokenAt(initialRow, initialColumn);
    this.$tokenIndex = token ? token.index : -1;
};

(function() { 
    this.stepBackward = function() {
        this.$tokenIndex -= 1;
        
        while (this.$tokenIndex < 0) {
            this.$row -= 1;
            if (this.$row < 0) {
                this.$row = 0;
                return null;
            }
                
            this.$rowTokens = this.$session.getTokens(this.$row);
            this.$tokenIndex = this.$rowTokens.length - 1;
        }
            
        return this.$rowTokens[this.$tokenIndex];
    };   
    this.stepForward = function() {
        this.$tokenIndex += 1;
        var rowCount;
        while (this.$tokenIndex >= this.$rowTokens.length) {
            this.$row += 1;
            if (!rowCount)
                rowCount = this.$session.getLength();
            if (this.$row >= rowCount) {
                this.$row = rowCount - 1;
                return null;
            }

            this.$rowTokens = this.$session.getTokens(this.$row);
            this.$tokenIndex = 0;
        }
            
        return this.$rowTokens[this.$tokenIndex];
    };      
    this.getCurrentToken = function () {
        return this.$rowTokens[this.$tokenIndex];
    };      
    this.getCurrentTokenRow = function () {
        return this.$row;
    };     
    this.getCurrentTokenColumn = function() {
        var rowTokens = this.$rowTokens;
        var tokenIndex = this.$tokenIndex;
        var column = rowTokens[tokenIndex].start;
        if (column !== undefined)
            return column;
            
        column = 0;
        while (tokenIndex > 0) {
            tokenIndex -= 1;
            column += rowTokens[tokenIndex].value.length;
        }
        
        return column;  
    };
            
}).call(TokenIterator.prototype);

exports.TokenIterator = TokenIterator;
});

ace.define('ace/mode/text_highlight_rules', ['require', 'exports', 'module' , 'ace/lib/lang'], function(require, exports, module) {


var lang = require("../lib/lang");

var TextHighlightRules = function() {

    this.$rules = {
        "start" : [{
            token : "empty_line",
            regex : '^$'
        }, {
            defaultToken : "text"
        }]
    };
};

(function() {

    this.addRules = function(rules, prefix) {
        if (!prefix) {
            for (var key in rules)
                this.$rules[key] = rules[key];
            return;
        }
        for (var key in rules) {
            var state = rules[key];
            for (var i = 0; i < state.length; i++) {
                var rule = state[i];
                if (rule.next) {
                    if (typeof rule.next != "string") {
                        if (rule.nextState && rule.nextState.indexOf(prefix) !== 0)
                            rule.nextState = prefix + rule.nextState;
                    } else {
                        if (rule.next.indexOf(prefix) !== 0)
                            rule.next = prefix + rule.next;
                    }

                }
            }
            this.$rules[prefix + key] = state;
        }
    };

    this.getRules = function() {
        return this.$rules;
    };

    this.embedRules = function (HighlightRules, prefix, escapeRules, states, append) {
        var embedRules = typeof HighlightRules == "function"
            ? new HighlightRules().getRules()
            : HighlightRules;
        if (states) {
            for (var i = 0; i < states.length; i++)
                states[i] = prefix + states[i];
        } else {
            states = [];
            for (var key in embedRules)
                states.push(prefix + key);
        }

        this.addRules(embedRules, prefix);

        if (escapeRules) {
            var addRules = Array.prototype[append ? "push" : "unshift"];
            for (var i = 0; i < states.length; i++)
                addRules.apply(this.$rules[states[i]], lang.deepCopy(escapeRules));
        }

        if (!this.$embeds)
            this.$embeds = [];
        this.$embeds.push(prefix);
    };

    this.getEmbeds = function() {
        return this.$embeds;
    };

    var pushState = function(currentState, stack) {
        if (currentState != "start" || stack.length)
            stack.unshift(this.nextState, currentState);
        return this.nextState;
    };
    var popState = function(currentState, stack) {
        stack.shift();
        return stack.shift() || "start";
    };

    this.normalizeRules = function() {
        var id = 0;
        var rules = this.$rules;
        function processState(key) {
            var state = rules[key];
            state.processed = true;
            for (var i = 0; i < state.length; i++) {
                var rule = state[i];
                if (!rule.regex && rule.start) {
                    rule.regex = rule.start;
                    if (!rule.next)
                        rule.next = [];
                    rule.next.push({
                        defaultToken: rule.token
                    }, {
                        token: rule.token + ".end",
                        regex: rule.end || rule.start,
                        next: "pop"
                    });
                    rule.token = rule.token + ".start";
                    rule.push = true;
                }
                var next = rule.next || rule.push;
                if (next && Array.isArray(next)) {
                    var stateName = rule.stateName;
                    if (!stateName)  {
                        stateName = rule.token;
                        if (typeof stateName != "string")
                            stateName = stateName[0] || "";
                        if (rules[stateName])
                            stateName += id++;
                    }
                    rules[stateName] = next;
                    rule.next = stateName;
                    processState(stateName);
                } else if (next == "pop") {
                    rule.next = popState;
                }

                if (rule.push) {
                    rule.nextState = rule.next || rule.push;
                    rule.next = pushState;
                    delete rule.push;
                }

                if (rule.rules) {
                    for (var r in rule.rules) {
                        if (rules[r]) {
                            if (rules[r].push)
                                rules[r].push.apply(rules[r], rule.rules[r]);
                        } else {
                            rules[r] = rule.rules[r];
                        }
                    }
                }
                if (rule.include || typeof rule == "string") {
                    var includeName = rule.include || rule;
                    var toInsert = rules[includeName];
                } else if (Array.isArray(rule))
                    toInsert = rule;

                if (toInsert) {
                    var args = [i, 1].concat(toInsert);
                    if (rule.noEscape)
                        args = args.filter(function(x) {return !x.next;});
                    state.splice.apply(state, args);
                    i--;
                    toInsert = null
                }
                
                if (rule.keywordMap) {
                    rule.token = this.createKeywordMapper(
                        rule.keywordMap, rule.defaultToken || "text", rule.caseInsensitive
                    );
                    delete rule.defaultToken;
                }
            }
        };
        Object.keys(rules).forEach(processState, this);
    };

    this.createKeywordMapper = function(map, defaultToken, ignoreCase, splitChar) {
        var keywords = Object.create(null);
        Object.keys(map).forEach(function(className) {
            var a = map[className];
            if (ignoreCase)
                a = a.toLowerCase();
            var list = a.split(splitChar || "|");
            for (var i = list.length; i--; )
                keywords[list[i]] = className;
        });
        if (Object.getPrototypeOf(keywords)) {
            keywords.__proto__ = null;
        }
        this.$keywordList = Object.keys(keywords);
        map = null;
        return ignoreCase
            ? function(value) {return keywords[value.toLowerCase()] || defaultToken }
            : function(value) {return keywords[value] || defaultToken };
    }

    this.getKeywords = function() {
        return this.$keywords;
    };

}).call(TextHighlightRules.prototype);

exports.TextHighlightRules = TextHighlightRules;
});

ace.define('ace/anchor', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/event_emitter'], function(require, exports, module) {


var oop = require("./lib/oop");
var EventEmitter = require("./lib/event_emitter").EventEmitter;

var Anchor = exports.Anchor = function(doc, row, column) {
    this.$onChange = this.onChange.bind(this);
    this.attach(doc);
    
    if (typeof column == "undefined")
        this.setPosition(row.row, row.column);
    else
        this.setPosition(row, column);
};

(function() {

    oop.implement(this, EventEmitter);
    this.getPosition = function() {
        return this.$clipPositionToDocument(this.row, this.column);
    };
    this.getDocument = function() {
        return this.document;
    };
    this.$insertRight = false;
    this.onChange = function(e) {
        var delta = e.data;
        var range = delta.range;

        if (range.start.row == range.end.row && range.start.row != this.row)
            return;

        if (range.start.row > this.row)
            return;

        if (range.start.row == this.row && range.start.column > this.column)
            return;

        var row = this.row;
        var column = this.column;
        var start = range.start;
        var end = range.end;

        if (delta.action === "insertText") {
            if (start.row === row && start.column <= column) {
                if (start.column === column && this.$insertRight) {
                } else if (start.row === end.row) {
                    column += end.column - start.column;
                } else {
                    column -= start.column;
                    row += end.row - start.row;
                }
            } else if (start.row !== end.row && start.row < row) {
                row += end.row - start.row;
            }
        } else if (delta.action === "insertLines") {
            if (start.row <= row) {
                row += end.row - start.row;
            }
        } else if (delta.action === "removeText") {
            if (start.row === row && start.column < column) {
                if (end.column >= column)
                    column = start.column;
                else
                    column = Math.max(0, column - (end.column - start.column));

            } else if (start.row !== end.row && start.row < row) {
                if (end.row === row)
                    column = Math.max(0, column - end.column) + start.column;
                row -= (end.row - start.row);
            } else if (end.row === row) {
                row -= end.row - start.row;
                column = Math.max(0, column - end.column) + start.column;
            }
        } else if (delta.action == "removeLines") {
            if (start.row <= row) {
                if (end.row <= row)
                    row -= end.row - start.row;
                else {
                    row = start.row;
                    column = 0;
                }
            }
        }

        this.setPosition(row, column, true);
    };
    this.setPosition = function(row, column, noClip) {
        var pos;
        if (noClip) {
            pos = {
                row: row,
                column: column
            };
        } else {
            pos = this.$clipPositionToDocument(row, column);
        }

        if (this.row == pos.row && this.column == pos.column)
            return;

        var old = {
            row: this.row,
            column: this.column
        };

        this.row = pos.row;
        this.column = pos.column;
        this._signal("change", {
            old: old,
            value: pos
        });
    };
    this.detach = function() {
        this.document.removeEventListener("change", this.$onChange);
    };
    this.attach = function(doc) {
        this.document = doc || this.document;
        this.document.on("change", this.$onChange);
    };
    this.$clipPositionToDocument = function(row, column) {
        var pos = {};

        if (row >= this.document.getLength()) {
            pos.row = Math.max(0, this.document.getLength() - 1);
            pos.column = this.document.getLine(pos.row).length;
        }
        else if (row < 0) {
            pos.row = 0;
            pos.column = 0;
        }
        else {
            pos.row = row;
            pos.column = Math.min(this.document.getLine(pos.row).length, Math.max(0, column));
        }

        if (column < 0)
            pos.column = 0;

        return pos;
    };

}).call(Anchor.prototype);

});

ace.define('ace/background_tokenizer', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/event_emitter'], function(require, exports, module) {


var oop = require("./lib/oop");
var EventEmitter = require("./lib/event_emitter").EventEmitter;

var BackgroundTokenizer = function(tokenizer, editor) {
    this.running = false;
    this.lines = [];
    this.states = [];
    this.currentLine = 0;
    this.tokenizer = tokenizer;

    var self = this;

    this.$worker = function() {
        if (!self.running) { return; }

        var workerStart = new Date();
        var currentLine = self.currentLine;
        var endLine = -1;
        var doc = self.doc;

        while (self.lines[currentLine])
            currentLine++;

        var startLine = currentLine;

        var len = doc.getLength();
        var processedLines = 0;
        self.running = false;
        while (currentLine < len) {
            self.$tokenizeRow(currentLine);
            endLine = currentLine;
            do {
                currentLine++;
            } while (self.lines[currentLine]);
            processedLines ++;
            if ((processedLines % 5 == 0) && (new Date() - workerStart) > 20) {                
                self.running = setTimeout(self.$worker, 20);
                self.currentLine = currentLine;
                return;
            }
        }
        self.currentLine = currentLine;
        
        if (startLine <= endLine)
            self.fireUpdateEvent(startLine, endLine);
    };
};

(function(){

    oop.implement(this, EventEmitter);
    this.setTokenizer = function(tokenizer) {
        this.tokenizer = tokenizer;
        this.lines = [];
        this.states = [];

        this.start(0);
    };
    this.setDocument = function(doc) {
        this.doc = doc;
        this.lines = [];
        this.states = [];

        this.stop();
    };
    this.fireUpdateEvent = function(firstRow, lastRow) {
        var data = {
            first: firstRow,
            last: lastRow
        };
        this._signal("update", {data: data});
    };
    this.start = function(startRow) {
        this.currentLine = Math.min(startRow || 0, this.currentLine, this.doc.getLength());
        this.lines.splice(this.currentLine, this.lines.length);
        this.states.splice(this.currentLine, this.states.length);

        this.stop();
        this.running = setTimeout(this.$worker, 700);
    };
    
    this.scheduleStart = function() {
        if (!this.running)
            this.running = setTimeout(this.$worker, 700);
    }

    this.$updateOnChange = function(delta) {
        var range = delta.range;
        var startRow = range.start.row;
        var len = range.end.row - startRow;

        if (len === 0) {
            this.lines[startRow] = null;
        } else if (delta.action == "removeText" || delta.action == "removeLines") {
            this.lines.splice(startRow, len + 1, null);
            this.states.splice(startRow, len + 1, null);
        } else {
            var args = Array(len + 1);
            args.unshift(startRow, 1);
            this.lines.splice.apply(this.lines, args);
            this.states.splice.apply(this.states, args);
        }

        this.currentLine = Math.min(startRow, this.currentLine, this.doc.getLength());

        this.stop();
    };
    this.stop = function() {
        if (this.running)
            clearTimeout(this.running);
        this.running = false;
    };
    this.getTokens = function(row) {
        return this.lines[row] || this.$tokenizeRow(row);
    };
    this.getState = function(row) {
        if (this.currentLine == row)
            this.$tokenizeRow(row);
        return this.states[row] || "start";
    };

    this.$tokenizeRow = function(row) {
        var line = this.doc.getLine(row);
        var state = this.states[row - 1];

        var data = this.tokenizer.getLineTokens(line, state, row);

        if (this.states[row] + "" !== data.state + "") {
            this.states[row] = data.state;
            this.lines[row + 1] = null;
            if (this.currentLine > row + 1)
                this.currentLine = row + 1;
        } else if (this.currentLine == row) {
            this.currentLine = row + 1;
        }

        return this.lines[row] = data.tokens;
    };

}).call(BackgroundTokenizer.prototype);

exports.BackgroundTokenizer = BackgroundTokenizer;
});

ace.define('ace/search_highlight', ['require', 'exports', 'module' , 'ace/lib/lang', 'ace/lib/oop', 'ace/range'], function(require, exports, module) {


var lang = require("./lib/lang");
var oop = require("./lib/oop");
var Range = require("./range").Range;

var SearchHighlight = function(regExp, clazz, type) {
    this.setRegexp(regExp);
    this.clazz = clazz;
    this.type = type || "text";
};

(function() {
    this.MAX_RANGES = 500;
    
    this.setRegexp = function(regExp) {
        if (this.regExp+"" == regExp+"")
            return;
        this.regExp = regExp;
        this.cache = [];
    };

    this.update = function(html, markerLayer, session, config) {
        if (!this.regExp)
            return;
        var start = config.firstRow, end = config.lastRow;

        for (var i = start; i <= end; i++) {
            var ranges = this.cache[i];
            if (ranges == null) {
                ranges = lang.getMatchOffsets(session.getLine(i), this.regExp);
                if (ranges.length > this.MAX_RANGES)
                    ranges = ranges.slice(0, this.MAX_RANGES);
                ranges = ranges.map(function(match) {
                    return new Range(i, match.offset, i, match.offset + match.length);
                });
                this.cache[i] = ranges.length ? ranges : "";
            }

            for (var j = ranges.length; j --; ) {
                markerLayer.drawSingleLineMarker(
                    html, ranges[j].toScreenRange(session), this.clazz, config);
            }
        }
    };

}).call(SearchHighlight.prototype);

exports.SearchHighlight = SearchHighlight;
});

ace.define('ace/edit_session/folding', ['require', 'exports', 'module' , 'ace/range', 'ace/edit_session/fold_line', 'ace/edit_session/fold', 'ace/token_iterator'], function(require, exports, module) {


var Range = require("../range").Range;
var FoldLine = require("./fold_line").FoldLine;
var Fold = require("./fold").Fold;
var TokenIterator = require("../token_iterator").TokenIterator;

function Folding() {
    this.getFoldAt = function(row, column, side) {
        var foldLine = this.getFoldLine(row);
        if (!foldLine)
            return null;

        var folds = foldLine.folds;
        for (var i = 0; i < folds.length; i++) {
            var fold = folds[i];
            if (fold.range.contains(row, column)) {
                if (side == 1 && fold.range.isEnd(row, column)) {
                    continue;
                } else if (side == -1 && fold.range.isStart(row, column)) {
                    continue;
                }
                return fold;
            }
        }
    };
    this.getFoldsInRange = function(range) {
        var start = range.start;
        var end = range.end;
        var foldLines = this.$foldData;
        var foundFolds = [];

        start.column += 1;
        end.column -= 1;

        for (var i = 0; i < foldLines.length; i++) {
            var cmp = foldLines[i].range.compareRange(range);
            if (cmp == 2) {
                continue;
            }
            else if (cmp == -2) {
                break;
            }

            var folds = foldLines[i].folds;
            for (var j = 0; j < folds.length; j++) {
                var fold = folds[j];
                cmp = fold.range.compareRange(range);
                if (cmp == -2) {
                    break;
                } else if (cmp == 2) {
                    continue;
                } else
                if (cmp == 42) {
                    break;
                }
                foundFolds.push(fold);
            }
        }
        start.column -= 1;
        end.column += 1;

        return foundFolds;
    };

    this.getFoldsInRangeList = function(ranges) {
        if (Array.isArray(ranges)) {
            var folds = [];
            ranges.forEach(function(range) {
                folds = folds.concat(this.getFoldsInRange(range));
            }, this);
        } else {
            var folds = this.getFoldsInRange(ranges);
        }
        return folds;
    }
    this.getAllFolds = function() {
        var folds = [];
        var foldLines = this.$foldData;
        
        for (var i = 0; i < foldLines.length; i++)
            for (var j = 0; j < foldLines[i].folds.length; j++)
                folds.push(foldLines[i].folds[j]);

        return folds;
    };
    this.getFoldStringAt = function(row, column, trim, foldLine) {
        foldLine = foldLine || this.getFoldLine(row);
        if (!foldLine)
            return null;

        var lastFold = {
            end: { column: 0 }
        };
        var str, fold;
        for (var i = 0; i < foldLine.folds.length; i++) {
            fold = foldLine.folds[i];
            var cmp = fold.range.compareEnd(row, column);
            if (cmp == -1) {
                str = this
                    .getLine(fold.start.row)
                    .substring(lastFold.end.column, fold.start.column);
                break;
            }
            else if (cmp === 0) {
                return null;
            }
            lastFold = fold;
        }
        if (!str)
            str = this.getLine(fold.start.row).substring(lastFold.end.column);

        if (trim == -1)
            return str.substring(0, column - lastFold.end.column);
        else if (trim == 1)
            return str.substring(column - lastFold.end.column);
        else
            return str;
    };

    this.getFoldLine = function(docRow, startFoldLine) {
        var foldData = this.$foldData;
        var i = 0;
        if (startFoldLine)
            i = foldData.indexOf(startFoldLine);
        if (i == -1)
            i = 0;
        for (i; i < foldData.length; i++) {
            var foldLine = foldData[i];
            if (foldLine.start.row <= docRow && foldLine.end.row >= docRow) {
                return foldLine;
            } else if (foldLine.end.row > docRow) {
                return null;
            }
        }
        return null;
    };
    this.getNextFoldLine = function(docRow, startFoldLine) {
        var foldData = this.$foldData;
        var i = 0;
        if (startFoldLine)
            i = foldData.indexOf(startFoldLine);
        if (i == -1)
            i = 0;
        for (i; i < foldData.length; i++) {
            var foldLine = foldData[i];
            if (foldLine.end.row >= docRow) {
                return foldLine;
            }
        }
        return null;
    };

    this.getFoldedRowCount = function(first, last) {
        var foldData = this.$foldData, rowCount = last-first+1;
        for (var i = 0; i < foldData.length; i++) {
            var foldLine = foldData[i],
                end = foldLine.end.row,
                start = foldLine.start.row;
            if (end >= last) {
                if(start < last) {
                    if(start >= first)
                        rowCount -= last-start;
                    else
                        rowCount = 0;//in one fold
                }
                break;
            } else if(end >= first){
                if (start >= first) //fold inside range
                    rowCount -=  end-start;
                else
                    rowCount -=  end-first+1;
            }
        }
        return rowCount;
    };

    this.$addFoldLine = function(foldLine) {
        this.$foldData.push(foldLine);
        this.$foldData.sort(function(a, b) {
            return a.start.row - b.start.row;
        });
        return foldLine;
    };
    this.addFold = function(placeholder, range) {
        var foldData = this.$foldData;
        var added = false;
        var fold;
        
        if (placeholder instanceof Fold)
            fold = placeholder;
        else {
            fold = new Fold(range, placeholder);
            fold.collapseChildren = range.collapseChildren;
        }
        this.$clipRangeToDocument(fold.range);

        var startRow = fold.start.row;
        var startColumn = fold.start.column;
        var endRow = fold.end.row;
        var endColumn = fold.end.column;
        if (!(startRow < endRow || 
            startRow == endRow && startColumn <= endColumn - 2))
            throw new Error("The range has to be at least 2 characters width");

        var startFold = this.getFoldAt(startRow, startColumn, 1);
        var endFold = this.getFoldAt(endRow, endColumn, -1);
        if (startFold && endFold == startFold)
            return startFold.addSubFold(fold);

        if (
            (startFold && !startFold.range.isStart(startRow, startColumn))
            || (endFold && !endFold.range.isEnd(endRow, endColumn))
        ) {
            throw new Error("A fold can't intersect already existing fold" + fold.range + startFold.range);
        }
        var folds = this.getFoldsInRange(fold.range);
        if (folds.length > 0) {
            this.removeFolds(folds);
            folds.forEach(function(subFold) {
                fold.addSubFold(subFold);
            });
        }

        for (var i = 0; i < foldData.length; i++) {
            var foldLine = foldData[i];
            if (endRow == foldLine.start.row) {
                foldLine.addFold(fold);
                added = true;
                break;
            } else if (startRow == foldLine.end.row) {
                foldLine.addFold(fold);
                added = true;
                if (!fold.sameRow) {
                    var foldLineNext = foldData[i + 1];
                    if (foldLineNext && foldLineNext.start.row == endRow) {
                        foldLine.merge(foldLineNext);
                        break;
                    }
                }
                break;
            } else if (endRow <= foldLine.start.row) {
                break;
            }
        }

        if (!added)
            foldLine = this.$addFoldLine(new FoldLine(this.$foldData, fold));

        if (this.$useWrapMode)
            this.$updateWrapData(foldLine.start.row, foldLine.start.row);
        else
            this.$updateRowLengthCache(foldLine.start.row, foldLine.start.row);
        this.$modified = true;
        this._emit("changeFold", { data: fold, action: "add" });

        return fold;
    };

    this.addFolds = function(folds) {
        folds.forEach(function(fold) {
            this.addFold(fold);
        }, this);
    };

    this.removeFold = function(fold) {
        var foldLine = fold.foldLine;
        var startRow = foldLine.start.row;
        var endRow = foldLine.end.row;

        var foldLines = this.$foldData;
        var folds = foldLine.folds;
        if (folds.length == 1) {
            foldLines.splice(foldLines.indexOf(foldLine), 1);
        } else
        if (foldLine.range.isEnd(fold.end.row, fold.end.column)) {
            folds.pop();
            foldLine.end.row = folds[folds.length - 1].end.row;
            foldLine.end.column = folds[folds.length - 1].end.column;
        } else
        if (foldLine.range.isStart(fold.start.row, fold.start.column)) {
            folds.shift();
            foldLine.start.row = folds[0].start.row;
            foldLine.start.column = folds[0].start.column;
        } else
        if (fold.sameRow) {
            folds.splice(folds.indexOf(fold), 1);
        } else
        {
            var newFoldLine = foldLine.split(fold.start.row, fold.start.column);
            folds = newFoldLine.folds;
            folds.shift();
            newFoldLine.start.row = folds[0].start.row;
            newFoldLine.start.column = folds[0].start.column;
        }

        if (!this.$updating) {
            if (this.$useWrapMode)
                this.$updateWrapData(startRow, endRow);
            else
                this.$updateRowLengthCache(startRow, endRow);
        }
        this.$modified = true;
        this._emit("changeFold", { data: fold, action: "remove" });
    };

    this.removeFolds = function(folds) {
        var cloneFolds = [];
        for (var i = 0; i < folds.length; i++) {
            cloneFolds.push(folds[i]);
        }

        cloneFolds.forEach(function(fold) {
            this.removeFold(fold);
        }, this);
        this.$modified = true;
    };

    this.expandFold = function(fold) {
        this.removeFold(fold);
        fold.subFolds.forEach(function(subFold) {
            fold.restoreRange(subFold);
            this.addFold(subFold);
        }, this);
        if (fold.collapseChildren > 0) {
            this.foldAll(fold.start.row+1, fold.end.row, fold.collapseChildren-1);
        }
        fold.subFolds = [];
    };

    this.expandFolds = function(folds) {
        folds.forEach(function(fold) {
            this.expandFold(fold);
        }, this);
    };

    this.unfold = function(location, expandInner) {
        var range, folds;
        if (location == null) {
            range = new Range(0, 0, this.getLength(), 0);
            expandInner = true;
        } else if (typeof location == "number")
            range = new Range(location, 0, location, this.getLine(location).length);
        else if ("row" in location)
            range = Range.fromPoints(location, location);
        else
            range = location;
        
        folds = this.getFoldsInRangeList(range);
        if (expandInner) {
            this.removeFolds(folds);
        } else {
            var subFolds = folds;
            while (subFolds.length) {
                this.expandFolds(subFolds);
                subFolds = this.getFoldsInRangeList(range);
            }
        }
        if (folds.length)
            return folds;
    };
    this.isRowFolded = function(docRow, startFoldRow) {
        return !!this.getFoldLine(docRow, startFoldRow);
    };

    this.getRowFoldEnd = function(docRow, startFoldRow) {
        var foldLine = this.getFoldLine(docRow, startFoldRow);
        return foldLine ? foldLine.end.row : docRow;
    };

    this.getRowFoldStart = function(docRow, startFoldRow) {
        var foldLine = this.getFoldLine(docRow, startFoldRow);
        return foldLine ? foldLine.start.row : docRow;
    };

    this.getFoldDisplayLine = function(foldLine, endRow, endColumn, startRow, startColumn) {
        if (startRow == null) {
            startRow = foldLine.start.row;
            startColumn = 0;
        }

        if (endRow == null) {
            endRow = foldLine.end.row;
            endColumn = this.getLine(endRow).length;
        }
        var doc = this.doc;
        var textLine = "";

        foldLine.walk(function(placeholder, row, column, lastColumn) {
            if (row < startRow)
                return;
            if (row == startRow) {
                if (column < startColumn)
                    return;
                lastColumn = Math.max(startColumn, lastColumn);
            }

            if (placeholder != null) {
                textLine += placeholder;
            } else {
                textLine += doc.getLine(row).substring(lastColumn, column);
            }
        }, endRow, endColumn);
        return textLine;
    };

    this.getDisplayLine = function(row, endColumn, startRow, startColumn) {
        var foldLine = this.getFoldLine(row);

        if (!foldLine) {
            var line;
            line = this.doc.getLine(row);
            return line.substring(startColumn || 0, endColumn || line.length);
        } else {
            return this.getFoldDisplayLine(
                foldLine, row, endColumn, startRow, startColumn);
        }
    };

    this.$cloneFoldData = function() {
        var fd = [];
        fd = this.$foldData.map(function(foldLine) {
            var folds = foldLine.folds.map(function(fold) {
                return fold.clone();
            });
            return new FoldLine(fd, folds);
        });

        return fd;
    };

    this.toggleFold = function(tryToUnfold) {
        var selection = this.selection;
        var range = selection.getRange();
        var fold;
        var bracketPos;

        if (range.isEmpty()) {
            var cursor = range.start;
            fold = this.getFoldAt(cursor.row, cursor.column);

            if (fold) {
                this.expandFold(fold);
                return;
            } else if (bracketPos = this.findMatchingBracket(cursor)) {
                if (range.comparePoint(bracketPos) == 1) {
                    range.end = bracketPos;
                } else {
                    range.start = bracketPos;
                    range.start.column++;
                    range.end.column--;
                }
            } else if (bracketPos = this.findMatchingBracket({row: cursor.row, column: cursor.column + 1})) {
                if (range.comparePoint(bracketPos) == 1)
                    range.end = bracketPos;
                else
                    range.start = bracketPos;

                range.start.column++;
            } else {
                range = this.getCommentFoldRange(cursor.row, cursor.column) || range;
            }
        } else {
            var folds = this.getFoldsInRange(range);
            if (tryToUnfold && folds.length) {
                this.expandFolds(folds);
                return;
            } else if (folds.length == 1 ) {
                fold = folds[0];
            }
        }

        if (!fold)
            fold = this.getFoldAt(range.start.row, range.start.column);

        if (fold && fold.range.toString() == range.toString()) {
            this.expandFold(fold);
            return;
        }

        var placeholder = "...";
        if (!range.isMultiLine()) {
            placeholder = this.getTextRange(range);
            if(placeholder.length < 4)
                return;
            placeholder = placeholder.trim().substring(0, 2) + "..";
        }

        this.addFold(placeholder, range);
    };

    this.getCommentFoldRange = function(row, column, dir) {
        var iterator = new TokenIterator(this, row, column);
        var token = iterator.getCurrentToken();
        if (token && /^comment|string/.test(token.type)) {
            var range = new Range();
            var re = new RegExp(token.type.replace(/\..*/, "\\."));
            if (dir != 1) {
                do {
                    token = iterator.stepBackward();
                } while(token && re.test(token.type));
                iterator.stepForward();
            }
            
            range.start.row = iterator.getCurrentTokenRow();
            range.start.column = iterator.getCurrentTokenColumn() + 2;

            iterator = new TokenIterator(this, row, column);
            
            if (dir != -1) {
                do {
                    token = iterator.stepForward();
                } while(token && re.test(token.type));
                token = iterator.stepBackward();
            } else
                token = iterator.getCurrentToken();

            range.end.row = iterator.getCurrentTokenRow();
            range.end.column = iterator.getCurrentTokenColumn() + token.value.length - 2;
            return range;
        }
    };

    this.foldAll = function(startRow, endRow, depth) {
        if (depth == undefined)
            depth = 100000; // JSON.stringify doesn't hanle Infinity
        var foldWidgets = this.foldWidgets;
        if (!foldWidgets)
            return; // mode doesn't support folding
        endRow = endRow || this.getLength();
        startRow = startRow || 0;
        for (var row = startRow; row < endRow; row++) {
            if (foldWidgets[row] == null)
                foldWidgets[row] = this.getFoldWidget(row);
            if (foldWidgets[row] != "start")
                continue;

            var range = this.getFoldWidgetRange(row);
            if (range && range.isMultiLine()
                && range.end.row <= endRow
                && range.start.row >= startRow
            ) {
                row = range.end.row;
                try {
                    var fold = this.addFold("...", range);
                    if (fold)
                        fold.collapseChildren = depth;
                } catch(e) {}
            }
        }
    };
    this.$foldStyles = {
        "manual": 1,
        "markbegin": 1,
        "markbeginend": 1
    };
    this.$foldStyle = "markbegin";
    this.setFoldStyle = function(style) {
        if (!this.$foldStyles[style])
            throw new Error("invalid fold style: " + style + "[" + Object.keys(this.$foldStyles).join(", ") + "]");
        
        if (this.$foldStyle == style)
            return;

        this.$foldStyle = style;
        
        if (style == "manual")
            this.unfold();
        var mode = this.$foldMode;
        this.$setFolding(null);
        this.$setFolding(mode);
    };

    this.$setFolding = function(foldMode) {
        if (this.$foldMode == foldMode)
            return;
            
        this.$foldMode = foldMode;
        
        this.removeListener('change', this.$updateFoldWidgets);
        this._emit("changeAnnotation");
        
        if (!foldMode || this.$foldStyle == "manual") {
            this.foldWidgets = null;
            return;
        }
        
        this.foldWidgets = [];
        this.getFoldWidget = foldMode.getFoldWidget.bind(foldMode, this, this.$foldStyle);
        this.getFoldWidgetRange = foldMode.getFoldWidgetRange.bind(foldMode, this, this.$foldStyle);
        
        this.$updateFoldWidgets = this.updateFoldWidgets.bind(this);
        this.on('change', this.$updateFoldWidgets);
        
    };

    this.getParentFoldRangeData = function (row, ignoreCurrent) {
        var fw = this.foldWidgets;
        if (!fw || (ignoreCurrent && fw[row]))
            return {};

        var i = row - 1, firstRange;
        while (i >= 0) {
            var c = fw[i];
            if (c == null)
                c = fw[i] = this.getFoldWidget(i);

            if (c == "start") {
                var range = this.getFoldWidgetRange(i);
                if (!firstRange)
                    firstRange = range;
                if (range && range.end.row >= row)
                    break;
            }
            i--;
        }

        return {
            range: i !== -1 && range,
            firstRange: firstRange
        };
    }

    this.onFoldWidgetClick = function(row, e) {
        e = e.domEvent;
        var options = {
            children: e.shiftKey,
            all: e.ctrlKey || e.metaKey,
            siblings: e.altKey
        };
        
        var range = this.$toggleFoldWidget(row, options);
        if (!range) {
            var el = (e.target || e.srcElement)
            if (el && /ace_fold-widget/.test(el.className))
                el.className += " ace_invalid";
        }
    };
    
    this.$toggleFoldWidget = function(row, options) {
        if (!this.getFoldWidget)
            return;
        var type = this.getFoldWidget(row);
        var line = this.getLine(row);

        var dir = type === "end" ? -1 : 1;
        var fold = this.getFoldAt(row, dir === -1 ? 0 : line.length, dir);

        if (fold) {
            if (options.children || options.all)
                this.removeFold(fold);
            else
                this.expandFold(fold);
            return;
        }

        var range = this.getFoldWidgetRange(row, true);
        if (range && !range.isMultiLine()) {
            fold = this.getFoldAt(range.start.row, range.start.column, 1);
            if (fold && range.isEqual(fold.range)) {
                this.removeFold(fold);
                return;
            }
        }
        
        if (options.siblings) {
            var data = this.getParentFoldRangeData(row);
            if (data.range) {
                var startRow = data.range.start.row + 1;
                var endRow = data.range.end.row;
            }
            this.foldAll(startRow, endRow, options.all ? 10000 : 0);
        } else if (options.children) {
            endRow = range ? range.end.row : this.getLength();
            this.foldAll(row + 1, range.end.row, options.all ? 10000 : 0);
        } else if (range) {
            if (options.all) 
                range.collapseChildren = 10000;
            this.addFold("...", range);
        }
        
        return range;
    };
    
    
    
    this.toggleFoldWidget = function(toggleParent) {
        var row = this.selection.getCursor().row;
        row = this.getRowFoldStart(row);
        var range = this.$toggleFoldWidget(row, {});
        
        if (range)
            return;
        var data = this.getParentFoldRangeData(row, true);
        range = data.range || data.firstRange;
        
        if (range) {
            row = range.start.row;
            var fold = this.getFoldAt(row, this.getLine(row).length, 1);

            if (fold) {
                this.removeFold(fold);
            } else {
                this.addFold("...", range);
            }
        }
    };

    this.updateFoldWidgets = function(e) {
        var delta = e.data;
        var range = delta.range;
        var firstRow = range.start.row;
        var len = range.end.row - firstRow;

        if (len === 0) {
            this.foldWidgets[firstRow] = null;
        } else if (delta.action == "removeText" || delta.action == "removeLines") {
            this.foldWidgets.splice(firstRow, len + 1, null);
        } else {
            var args = Array(len + 1);
            args.unshift(firstRow, 1);
            this.foldWidgets.splice.apply(this.foldWidgets, args);
        }
    };

}

exports.Folding = Folding;

});

ace.define('ace/edit_session/fold_line', ['require', 'exports', 'module' , 'ace/range'], function(require, exports, module) {


var Range = require("../range").Range;
function FoldLine(foldData, folds) {
    this.foldData = foldData;
    if (Array.isArray(folds)) {
        this.folds = folds;
    } else {
        folds = this.folds = [ folds ];
    }

    var last = folds[folds.length - 1]
    this.range = new Range(folds[0].start.row, folds[0].start.column,
                           last.end.row, last.end.column);
    this.start = this.range.start;
    this.end   = this.range.end;

    this.folds.forEach(function(fold) {
        fold.setFoldLine(this);
    }, this);
}

(function() {
    this.shiftRow = function(shift) {
        this.start.row += shift;
        this.end.row += shift;
        this.folds.forEach(function(fold) {
            fold.start.row += shift;
            fold.end.row += shift;
        });
    }

    this.addFold = function(fold) {
        if (fold.sameRow) {
            if (fold.start.row < this.startRow || fold.endRow > this.endRow) {
                throw new Error("Can't add a fold to this FoldLine as it has no connection");
            }
            this.folds.push(fold);
            this.folds.sort(function(a, b) {
                return -a.range.compareEnd(b.start.row, b.start.column);
            });
            if (this.range.compareEnd(fold.start.row, fold.start.column) > 0) {
                this.end.row = fold.end.row;
                this.end.column =  fold.end.column;
            } else if (this.range.compareStart(fold.end.row, fold.end.column) < 0) {
                this.start.row = fold.start.row;
                this.start.column = fold.start.column;
            }
        } else if (fold.start.row == this.end.row) {
            this.folds.push(fold);
            this.end.row = fold.end.row;
            this.end.column = fold.end.column;
        } else if (fold.end.row == this.start.row) {
            this.folds.unshift(fold);
            this.start.row = fold.start.row;
            this.start.column = fold.start.column;
        } else {
            throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");
        }
        fold.foldLine = this;
    }

    this.containsRow = function(row) {
        return row >= this.start.row && row <= this.end.row;
    }

    this.walk = function(callback, endRow, endColumn) {
        var lastEnd = 0,
            folds = this.folds,
            fold,
            comp, stop, isNewRow = true;

        if (endRow == null) {
            endRow = this.end.row;
            endColumn = this.end.column;
        }

        for (var i = 0; i < folds.length; i++) {
            fold = folds[i];

            comp = fold.range.compareStart(endRow, endColumn);
            if (comp == -1) {
                callback(null, endRow, endColumn, lastEnd, isNewRow);
                return;
            }

            stop = callback(null, fold.start.row, fold.start.column, lastEnd, isNewRow);
            stop = !stop && callback(fold.placeholder, fold.start.row, fold.start.column, lastEnd);
            if (stop || comp == 0) {
                return;
            }
            isNewRow = !fold.sameRow;
            lastEnd = fold.end.column;
        }
        callback(null, endRow, endColumn, lastEnd, isNewRow);
    }

    this.getNextFoldTo = function(row, column) {
        var fold, cmp;
        for (var i = 0; i < this.folds.length; i++) {
            fold = this.folds[i];
            cmp = fold.range.compareEnd(row, column);
            if (cmp == -1) {
                return {
                    fold: fold,
                    kind: "after"
                };
            } else if (cmp == 0) {
                return {
                    fold: fold,
                    kind: "inside"
                }
            }
        }
        return null;
    }

    this.addRemoveChars = function(row, column, len) {
        var ret = this.getNextFoldTo(row, column),
            fold, folds;
        if (ret) {
            fold = ret.fold;
            if (ret.kind == "inside"
                && fold.start.column != column
                && fold.start.row != row)
            {
                window.console && window.console.log(row, column, fold);
            } else if (fold.start.row == row) {
                folds = this.folds;
                var i = folds.indexOf(fold);
                if (i == 0) {
                    this.start.column += len;
                }
                for (i; i < folds.length; i++) {
                    fold = folds[i];
                    fold.start.column += len;
                    if (!fold.sameRow) {
                        return;
                    }
                    fold.end.column += len;
                }
                this.end.column += len;
            }
        }
    }

    this.split = function(row, column) {
        var fold = this.getNextFoldTo(row, column).fold;
        var folds = this.folds;
        var foldData = this.foldData;

        if (!fold)
            return null;

        var i = folds.indexOf(fold);
        var foldBefore = folds[i - 1];
        this.end.row = foldBefore.end.row;
        this.end.column = foldBefore.end.column;
        folds = folds.splice(i, folds.length - i);

        var newFoldLine = new FoldLine(foldData, folds);
        foldData.splice(foldData.indexOf(this) + 1, 0, newFoldLine);
        return newFoldLine;
    }

    this.merge = function(foldLineNext) {
        var folds = foldLineNext.folds;
        for (var i = 0; i < folds.length; i++) {
            this.addFold(folds[i]);
        }
        var foldData = this.foldData;
        foldData.splice(foldData.indexOf(foldLineNext), 1);
    }

    this.toString = function() {
        var ret = [this.range.toString() + ": [" ];

        this.folds.forEach(function(fold) {
            ret.push("  " + fold.toString());
        });
        ret.push("]")
        return ret.join("\n");
    }

    this.idxToPosition = function(idx) {
        var lastFoldEndColumn = 0;
        var fold;

        for (var i = 0; i < this.folds.length; i++) {
            var fold = this.folds[i];

            idx -= fold.start.column - lastFoldEndColumn;
            if (idx < 0) {
                return {
                    row: fold.start.row,
                    column: fold.start.column + idx
                };
            }

            idx -= fold.placeholder.length;
            if (idx < 0) {
                return fold.start;
            }

            lastFoldEndColumn = fold.end.column;
        }

        return {
            row: this.end.row,
            column: this.end.column + idx
        };
    }
}).call(FoldLine.prototype);

exports.FoldLine = FoldLine;
});

ace.define('ace/tokenizer', ['require', 'exports', 'module' ], function(require, exports, module) {
var MAX_TOKEN_COUNT = 1000;
var Tokenizer = function(rules) {
    this.states = rules;

    this.regExps = {};
    this.matchMappings = {};
    for (var key in this.states) {
        var state = this.states[key];
        var ruleRegExps = [];
        var matchTotal = 0;
        var mapping = this.matchMappings[key] = {defaultToken: "text"};
        var flag = "g";

        var splitterRurles = [];
        for (var i = 0; i < state.length; i++) {
            var rule = state[i];
            if (rule.defaultToken)
                mapping.defaultToken = rule.defaultToken;
            if (rule.caseInsensitive)
                flag = "gi";
            if (rule.regex == null)
                continue;

            if (rule.regex instanceof RegExp)
                rule.regex = rule.regex.toString().slice(1, -1);
            var adjustedregex = rule.regex;
            var matchcount = new RegExp("(?:(" + adjustedregex + ")|(.))").exec("a").length - 2;
            if (Array.isArray(rule.token)) {
                if (rule.token.length == 1 || matchcount == 1) {
                    rule.token = rule.token[0];
                } else if (matchcount - 1 != rule.token.length) {
                    throw new Error("number of classes and regexp groups in '" + 
                        rule.token + "'\n'" + rule.regex +  "' doesn't match\n"
                        + (matchcount - 1) + "!=" + rule.token.length);
                } else {
                    rule.tokenArray = rule.token;
                    rule.token = null;
                    rule.onMatch = this.$arrayTokens;
                }
            } else if (typeof rule.token == "function" && !rule.onMatch) {
                if (matchcount > 1)
                    rule.onMatch = this.$applyToken;
                else
                    rule.onMatch = rule.token;
            }

            if (matchcount > 1) {
                if (/\\\d/.test(rule.regex)) {
                    adjustedregex = rule.regex.replace(/\\([0-9]+)/g, function(match, digit) {
                        return "\\" + (parseInt(digit, 10) + matchTotal + 1);
                    });
                } else {
                    matchcount = 1;
                    adjustedregex = this.removeCapturingGroups(rule.regex);
                }
                if (!rule.splitRegex && typeof rule.token != "string")
                    splitterRurles.push(rule); // flag will be known only at the very end
            }

            mapping[matchTotal] = i;
            matchTotal += matchcount;

            ruleRegExps.push(adjustedregex);
            if (!rule.onMatch)
                rule.onMatch = null;
            rule.__proto__ = null;
        }
        
        splitterRurles.forEach(function(rule) {
            rule.splitRegex = this.createSplitterRegexp(rule.regex, flag);
        }, this);

        this.regExps[key] = new RegExp("(" + ruleRegExps.join(")|(") + ")|($)", flag);
    }
};

(function() {
    this.$setMaxTokenCount = function(m) {
        MAX_TOKEN_COUNT = m | 0;
    };
    
    this.$applyToken = function(str) {
        var values = this.splitRegex.exec(str).slice(1);
        var types = this.token.apply(this, values);
        if (typeof types === "string")
            return [{type: types, value: str}];

        var tokens = [];
        for (var i = 0, l = types.length; i < l; i++) {
            if (values[i])
                tokens[tokens.length] = {
                    type: types[i],
                    value: values[i]
                };
        }
        return tokens;
    },

    this.$arrayTokens = function(str) {
        if (!str)
            return [];
        var values = this.splitRegex.exec(str);
        if (!values)
            return "text";
        var tokens = [];
        var types = this.tokenArray;
        for (var i = 0, l = types.length; i < l; i++) {
            if (values[i + 1])
                tokens[tokens.length] = {
                    type: types[i],
                    value: values[i + 1]
                };
        }
        return tokens;
    };

    this.removeCapturingGroups = function(src) {
        var r = src.replace(
            /\[(?:\\.|[^\]])*?\]|\\.|\(\?[:=!]|(\()/g,
            function(x, y) {return y ? "(?:" : x;}
        );
        return r;
    };

    this.createSplitterRegexp = function(src, flag) {
        if (src.indexOf("(?=") != -1) {
            var stack = 0;
            var inChClass = false;
            var lastCapture = {};
            src.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g, function(
                m, esc, parenOpen, parenClose, square, index
            ) {
                if (inChClass) {
                    inChClass = square != "]";
                } else if (square) {
                    inChClass = true;
                } else if (parenClose) {
                    if (stack == lastCapture.stack) {
                        lastCapture.end = index+1;
                        lastCapture.stack = -1;
                    }
                    stack--;
                } else if (parenOpen) {
                    stack++;
                    if (parenOpen.length != 1) {
                        lastCapture.stack = stack
                        lastCapture.start = index;
                    }
                }
                return m;
            });

            if (lastCapture.end != null && /^\)*$/.test(src.substr(lastCapture.end)))
                src = src.substring(0, lastCapture.start) + src.substr(lastCapture.end);
        }
        return new RegExp(src, (flag||"").replace("g", ""));
    };
    this.getLineTokens = function(line, startState) {
        if (startState && typeof startState != "string") {
            var stack = startState.slice(0);
            startState = stack[0];
        } else
            var stack = [];

        var currentState = startState || "start";
        var state = this.states[currentState];
        if (!state) {
            currentState = "start";
            state = this.states[currentState];
        }
        var mapping = this.matchMappings[currentState];
        var re = this.regExps[currentState];
        re.lastIndex = 0;

        var match, tokens = [];
        var lastIndex = 0;

        var token = {type: null, value: ""};

        while (match = re.exec(line)) {
            var type = mapping.defaultToken;
            var rule = null;
            var value = match[0];
            var index = re.lastIndex;

            if (index - value.length > lastIndex) {
                var skipped = line.substring(lastIndex, index - value.length);
                if (token.type == type) {
                    token.value += skipped;
                } else {
                    if (token.type)
                        tokens.push(token);
                    token = {type: type, value: skipped};
                }
            }

            for (var i = 0; i < match.length-2; i++) {
                if (match[i + 1] === undefined)
                    continue;

                rule = state[mapping[i]];

                if (rule.onMatch)
                    type = rule.onMatch(value, currentState, stack);
                else
                    type = rule.token;

                if (rule.next) {
                    if (typeof rule.next == "string")
                        currentState = rule.next;
                    else
                        currentState = rule.next(currentState, stack);

                    state = this.states[currentState];
                    if (!state) {
                        window.console && console.error && console.error(currentState, "doesn't exist");
                        currentState = "start";
                        state = this.states[currentState];
                    }
                    mapping = this.matchMappings[currentState];
                    lastIndex = index;
                    re = this.regExps[currentState];
                    re.lastIndex = index;
                }
                break;
            }

            if (value) {
                if (typeof type == "string") {
                    if ((!rule || rule.merge !== false) && token.type === type) {
                        token.value += value;
                    } else {
                        if (token.type)
                            tokens.push(token);
                        token = {type: type, value: value};
                    }
                } else if (type) {
                    if (token.type)
                        tokens.push(token);
                    token = {type: null, value: ""};
                    for (var i = 0; i < type.length; i++)
                        tokens.push(type[i]);
                }
            }

            if (lastIndex == line.length)
                break;

            lastIndex = index;

            if (tokens.length > MAX_TOKEN_COUNT) {
                while (lastIndex < line.length) {
                    if (token.type)
                        tokens.push(token);
                    token = {
                        value: line.substring(lastIndex, lastIndex += 2000),
                        type: "overflow"
                    };
                }
                currentState = "start";
                stack = [];
                break;
            }
        }

        if (token.type)
            tokens.push(token);
        
        if (stack.length > 1) {
            if (stack[0] !== currentState)
                stack.unshift(currentState);
        }
        return {
            tokens : tokens,
            state : stack.length ? stack : currentState
        };
    };

}).call(Tokenizer.prototype);

exports.Tokenizer = Tokenizer;
});

ace.define('ace/edit_session/fold', ['require', 'exports', 'module' , 'ace/range', 'ace/range_list', 'ace/lib/oop'], function(require, exports, module) {


var Range = require("../range").Range;
var RangeList = require("../range_list").RangeList;
var oop = require("../lib/oop")
var Fold = exports.Fold = function(range, placeholder) {
    this.foldLine = null;
    this.placeholder = placeholder;
    this.range = range;
    this.start = range.start;
    this.end = range.end;

    this.sameRow = range.start.row == range.end.row;
    this.subFolds = this.ranges = [];
};

oop.inherits(Fold, RangeList);

(function() {

    this.toString = function() {
        return '"' + this.placeholder + '" ' + this.range.toString();
    };

    this.setFoldLine = function(foldLine) {
        this.foldLine = foldLine;
        this.subFolds.forEach(function(fold) {
            fold.setFoldLine(foldLine);
        });
    };

    this.clone = function() {
        var range = this.range.clone();
        var fold = new Fold(range, this.placeholder);
        this.subFolds.forEach(function(subFold) {
            fold.subFolds.push(subFold.clone());
        });
        fold.collapseChildren = this.collapseChildren;
        return fold;
    };

    this.addSubFold = function(fold) {
        if (this.range.isEqual(fold))
            return;

        if (!this.range.containsRange(fold))
            throw new Error("A fold can't intersect already existing fold" + fold.range + this.range);
        consumeRange(fold, this.start);

        var row = fold.start.row, column = fold.start.column;
        for (var i = 0, cmp = -1; i < this.subFolds.length; i++) {
            cmp = this.subFolds[i].range.compare(row, column);
            if (cmp != 1)
                break;
        }
        var afterStart = this.subFolds[i];

        if (cmp == 0)
            return afterStart.addSubFold(fold);
        var row = fold.range.end.row, column = fold.range.end.column;
        for (var j = i, cmp = -1; j < this.subFolds.length; j++) {
            cmp = this.subFolds[j].range.compare(row, column);
            if (cmp != 1)
                break;
        }
        var afterEnd = this.subFolds[j];

        if (cmp == 0)
            throw new Error("A fold can't intersect already existing fold" + fold.range + this.range);

        var consumedFolds = this.subFolds.splice(i, j - i, fold);
        fold.setFoldLine(this.foldLine);

        return fold;
    };
    
    this.restoreRange = function(range) {
        return restoreRange(range, this.start);
    };

}).call(Fold.prototype);

function consumePoint(point, anchor) {
    point.row -= anchor.row;
    if (point.row == 0)
        point.column -= anchor.column;
}
function consumeRange(range, anchor) {
    consumePoint(range.start, anchor);
    consumePoint(range.end, anchor);
}
function restorePoint(point, anchor) {
    if (point.row == 0)
        point.column += anchor.column;
    point.row += anchor.row;
}
function restoreRange(range, anchor) {
    restorePoint(range.start, anchor);
    restorePoint(range.end, anchor);
}

});

ace.define('ace/mode/text', ['require', 'exports', 'module' , 'ace/tokenizer', 'ace/mode/text_highlight_rules', 'ace/mode/behaviour', 'ace/unicode', 'ace/lib/lang', 'ace/token_iterator', 'ace/range'], function(require, exports, module) {


var Tokenizer = require("../tokenizer").Tokenizer;
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;
var Behaviour = require("./behaviour").Behaviour;
var unicode = require("../unicode");
var lang = require("../lib/lang");
var TokenIterator = require("../token_iterator").TokenIterator;
var Range = require("../range").Range;

var Mode = function() {
    this.HighlightRules = TextHighlightRules;
    this.$behaviour = new Behaviour();
};

(function() {

    this.tokenRe = new RegExp("^["
        + unicode.packages.L
        + unicode.packages.Mn + unicode.packages.Mc
        + unicode.packages.Nd
        + unicode.packages.Pc + "\\$_]+", "g"
    );

    this.nonTokenRe = new RegExp("^(?:[^"
        + unicode.packages.L
        + unicode.packages.Mn + unicode.packages.Mc
        + unicode.packages.Nd
        + unicode.packages.Pc + "\\$_]|\\s])+", "g"
    );

    this.getTokenizer = function() {
        if (!this.$tokenizer) {
            this.$highlightRules = new this.HighlightRules();
            this.$tokenizer = new Tokenizer(this.$highlightRules.getRules());
        }
        return this.$tokenizer;
    };

    this.lineCommentStart = "";
    this.blockComment = "";

    this.toggleCommentLines = function(state, session, startRow, endRow) {
        var doc = session.doc;

        var ignoreBlankLines = true;
        var shouldRemove = true;
        var minIndent = Infinity;
        var tabSize = session.getTabSize();
        var insertAtTabStop = false;

        if (!this.lineCommentStart) {
            if (!this.blockComment)
                return false;
            var lineCommentStart = this.blockComment.start;
            var lineCommentEnd = this.blockComment.end;
            var regexpStart = new RegExp("^(\\s*)(?:" + lang.escapeRegExp(lineCommentStart) + ")");
            var regexpEnd = new RegExp("(?:" + lang.escapeRegExp(lineCommentEnd) + ")\\s*$");

            var comment = function(line, i) {
                if (testRemove(line, i))
                    return;
                if (!ignoreBlankLines || /\S/.test(line)) {
                    doc.insertInLine({row: i, column: line.length}, lineCommentEnd);
                    doc.insertInLine({row: i, column: minIndent}, lineCommentStart);
                }
            };

            var uncomment = function(line, i) {
                var m;
                if (m = line.match(regexpEnd))
                    doc.removeInLine(i, line.length - m[0].length, line.length);
                if (m = line.match(regexpStart))
                    doc.removeInLine(i, m[1].length, m[0].length);
            };

            var testRemove = function(line, row) {
                if (regexpStart.test(line))
                    return true;
                var tokens = session.getTokens(row);
                for (var i = 0; i < tokens.length; i++) {
                    if (tokens[i].type === 'comment')
                        return true;
                }
            };
        } else {
            if (Array.isArray(this.lineCommentStart)) {
                var regexpStart = this.lineCommentStart.map(lang.escapeRegExp).join("|");
                var lineCommentStart = this.lineCommentStart[0];
            } else {
                var regexpStart = lang.escapeRegExp(this.lineCommentStart);
                var lineCommentStart = this.lineCommentStart;
            }
            regexpStart = new RegExp("^(\\s*)(?:" + regexpStart + ") ?");
            
            insertAtTabStop = session.getUseSoftTabs();

            var uncomment = function(line, i) {
                var m = line.match(regexpStart);
                if (!m) return;
                var start = m[1].length, end = m[0].length;
                if (!shouldInsertSpace(line, start, end) && m[0][end - 1] == " ")
                    end--;
                doc.removeInLine(i, start, end);
            };
            var commentWithSpace = lineCommentStart + " ";
            var comment = function(line, i) {
                if (!ignoreBlankLines || /\S/.test(line)) {
                    if (shouldInsertSpace(line, minIndent, minIndent))
                        doc.insertInLine({row: i, column: minIndent}, commentWithSpace);
                    else
                        doc.insertInLine({row: i, column: minIndent}, lineCommentStart);
                }
            };
            var testRemove = function(line, i) {
                return regexpStart.test(line);
            };
            
            var shouldInsertSpace = function(line, before, after) {
                var spaces = 0;
                while (before-- && line.charAt(before) == " ")
                    spaces++;
                if (spaces % tabSize != 0)
                    return false;
                var spaces = 0;
                while (line.charAt(after++) == " ")
                    spaces++;
                if (tabSize > 2)
                    return spaces % tabSize != tabSize - 1;
                else
                    return spaces % tabSize == 0;
                return true;
            };
        }

        function iter(fun) {
            for (var i = startRow; i <= endRow; i++)
                fun(doc.getLine(i), i);
        }


        var minEmptyLength = Infinity;
        iter(function(line, i) {
            var indent = line.search(/\S/);
            if (indent !== -1) {
                if (indent < minIndent)
                    minIndent = indent;
                if (shouldRemove && !testRemove(line, i))
                    shouldRemove = false;
            } else if (minEmptyLength > line.length) {
                minEmptyLength = line.length;
            }
        });

        if (minIndent == Infinity) {
            minIndent = minEmptyLength;
            ignoreBlankLines = false;
            shouldRemove = false;
        }

        if (insertAtTabStop && minIndent % tabSize != 0)
            minIndent = Math.floor(minIndent / tabSize) * tabSize;

        iter(shouldRemove ? uncomment : comment);
    };

    this.toggleBlockComment = function(state, session, range, cursor) {
        var comment = this.blockComment;
        if (!comment)
            return;
        if (!comment.start && comment[0])
            comment = comment[0];

        var iterator = new TokenIterator(session, cursor.row, cursor.column);
        var token = iterator.getCurrentToken();

        var sel = session.selection;
        var initialRange = session.selection.toOrientedRange();
        var startRow, colDiff;

        if (token && /comment/.test(token.type)) {
            var startRange, endRange;
            while (token && /comment/.test(token.type)) {
                var i = token.value.indexOf(comment.start);
                if (i != -1) {
                    var row = iterator.getCurrentTokenRow();
                    var column = iterator.getCurrentTokenColumn() + i;
                    startRange = new Range(row, column, row, column + comment.start.length);
                    break;
                }
                token = iterator.stepBackward();
            }

            var iterator = new TokenIterator(session, cursor.row, cursor.column);
            var token = iterator.getCurrentToken();
            while (token && /comment/.test(token.type)) {
                var i = token.value.indexOf(comment.end);
                if (i != -1) {
                    var row = iterator.getCurrentTokenRow();
                    var column = iterator.getCurrentTokenColumn() + i;
                    endRange = new Range(row, column, row, column + comment.end.length);
                    break;
                }
                token = iterator.stepForward();
            }
            if (endRange)
                session.remove(endRange);
            if (startRange) {
                session.remove(startRange);
                startRow = startRange.start.row;
                colDiff = -comment.start.length;
            }
        } else {
            colDiff = comment.start.length;
            startRow = range.start.row;
            session.insert(range.end, comment.end);
            session.insert(range.start, comment.start);
        }
        if (initialRange.start.row == startRow)
            initialRange.start.column += colDiff;
        if (initialRange.end.row == startRow)
            initialRange.end.column += colDiff;
        session.selection.fromOrientedRange(initialRange);
    };

    this.getNextLineIndent = function(state, line, tab) {
        return this.$getIndent(line);
    };

    this.checkOutdent = function(state, line, input) {
        return false;
    };

    this.autoOutdent = function(state, doc, row) {
    };

    this.$getIndent = function(line) {
        return line.match(/^\s*/)[0];
    };

    this.createWorker = function(session) {
        return null;
    };

    this.createModeDelegates = function (mapping) {
        this.$embeds = [];
        this.$modes = {};
        for (var i in mapping) {
            if (mapping[i]) {
                this.$embeds.push(i);
                this.$modes[i] = new mapping[i]();
            }
        }

        var delegations = ['toggleBlockComment', 'toggleCommentLines', 'getNextLineIndent', 
            'checkOutdent', 'autoOutdent', 'transformAction', 'getCompletions'];

        for (var i = 0; i < delegations.length; i++) {
            (function(scope) {
              var functionName = delegations[i];
              var defaultHandler = scope[functionName];
              scope[delegations[i]] = function() {
                  return this.$delegator(functionName, arguments, defaultHandler);
              };
            } (this));
        }
    };

    this.$delegator = function(method, args, defaultHandler) {
        var state = args[0];
        if (typeof state != "string")
            state = state[0];
        for (var i = 0; i < this.$embeds.length; i++) {
            if (!this.$modes[this.$embeds[i]]) continue;

            var split = state.split(this.$embeds[i]);
            if (!split[0] && split[1]) {
                args[0] = split[1];
                var mode = this.$modes[this.$embeds[i]];
                return mode[method].apply(mode, args);
            }
        }
        var ret = defaultHandler.apply(this, args);
        return defaultHandler ? ret : undefined;
    };

    this.transformAction = function(state, action, editor, session, param) {
        if (this.$behaviour) {
            var behaviours = this.$behaviour.getBehaviours();
            for (var key in behaviours) {
                if (behaviours[key][action]) {
                    var ret = behaviours[key][action].apply(this, arguments);
                    if (ret) {
                        return ret;
                    }
                }
            }
        }
    };
    
    this.getKeywords = function(append) {
        if (!this.completionKeywords) {
            var rules = this.$tokenizer.rules;
            var completionKeywords = [];
            for (var rule in rules) {
                var ruleItr = rules[rule];
                for (var r = 0, l = ruleItr.length; r < l; r++) {
                    if (typeof ruleItr[r].token === "string") {
                        if (/keyword|support|storage/.test(ruleItr[r].token))
                            completionKeywords.push(ruleItr[r].regex);
                    }
                    else if (typeof ruleItr[r].token === "object") {
                        for (var a = 0, aLength = ruleItr[r].token.length; a < aLength; a++) {    
                            if (/keyword|support|storage/.test(ruleItr[r].token[a])) {
                                var rule = ruleItr[r].regex.match(/\(.+?\)/g)[a];
                                completionKeywords.push(rule.substr(1, rule.length - 2));
                            }
                        }
                    }
                }
            }
            this.completionKeywords = completionKeywords;
        }
        if (!append)
            return this.$keywordList;
        return completionKeywords.concat(this.$keywordList || []);
    };
    
    this.$createKeywordList = function() {
        if (!this.$highlightRules)
            this.getTokenizer();
        return this.$keywordList = this.$highlightRules.$keywordList || [];
    };

    this.getCompletions = function(state, session, pos, prefix) {
        var keywords = this.$keywordList || this.$createKeywordList();
        return keywords.map(function(word) {
            return {
                name: word,
                value: word,
                score: 0,
                meta: "keyword"
            };
        });
    };

    this.$id = "ace/mode/text";
}).call(Mode.prototype);

exports.Mode = Mode;
});

ace.define('ace/range_list', ['require', 'exports', 'module' , 'ace/range'], function(require, exports, module) {

var Range = require("./range").Range;
var comparePoints = Range.comparePoints;

var RangeList = function() {
    this.ranges = [];
};

(function() {
    this.comparePoints = comparePoints;

    this.pointIndex = function(pos, excludeEdges, startIndex) {
        var list = this.ranges;

        for (var i = startIndex || 0; i < list.length; i++) {
            var range = list[i];
            var cmpEnd = comparePoints(pos, range.end);
            if (cmpEnd > 0)
                continue;
            var cmpStart = comparePoints(pos, range.start);
            if (cmpEnd === 0)
                return excludeEdges && cmpStart !== 0 ? -i-2 : i;
            if (cmpStart > 0 || (cmpStart === 0 && !excludeEdges))
                return i;

            return -i-1;
        }
        return -i - 1;
    };

    this.add = function(range) {
        var excludeEdges = !range.isEmpty();
        var startIndex = this.pointIndex(range.start, excludeEdges);
        if (startIndex < 0)
            startIndex = -startIndex - 1;

        var endIndex = this.pointIndex(range.end, excludeEdges, startIndex);

        if (endIndex < 0)
            endIndex = -endIndex - 1;
        else
            endIndex++;
        return this.ranges.splice(startIndex, endIndex - startIndex, range);
    };

    this.addList = function(list) {
        var removed = [];
        for (var i = list.length; i--; ) {
            removed.push.call(removed, this.add(list[i]));
        }
        return removed;
    };

    this.substractPoint = function(pos) {
        var i = this.pointIndex(pos);

        if (i >= 0)
            return this.ranges.splice(i, 1);
    };
    this.merge = function() {
        var removed = [];
        var list = this.ranges;
        
        list = list.sort(function(a, b) {
            return comparePoints(a.start, b.start);
        });
        
        var next = list[0], range;
        for (var i = 1; i < list.length; i++) {
            range = next;
            next = list[i];
            var cmp = comparePoints(range.end, next.start);
            if (cmp < 0)
                continue;

            if (cmp == 0 && !range.isEmpty() && !next.isEmpty())
                continue;

            if (comparePoints(range.end, next.end) < 0) {
                range.end.row = next.end.row;
                range.end.column = next.end.column;
            }

            list.splice(i, 1);
            removed.push(next);
            next = range;
            i--;
        }
        
        this.ranges = list;

        return removed;
    };

    this.contains = function(row, column) {
        return this.pointIndex({row: row, column: column}) >= 0;
    };

    this.containsPoint = function(pos) {
        return this.pointIndex(pos) >= 0;
    };

    this.rangeAtPoint = function(pos) {
        var i = this.pointIndex(pos);
        if (i >= 0)
            return this.ranges[i];
    };


    this.clipRows = function(startRow, endRow) {
        var list = this.ranges;
        if (list[0].start.row > endRow || list[list.length - 1].start.row < startRow)
            return [];

        var startIndex = this.pointIndex({row: startRow, column: 0});
        if (startIndex < 0)
            startIndex = -startIndex - 1;
        var endIndex = this.pointIndex({row: endRow, column: 0}, startIndex);
        if (endIndex < 0)
            endIndex = -endIndex - 1;

        var clipped = [];
        for (var i = startIndex; i < endIndex; i++) {
            clipped.push(list[i]);
        }
        return clipped;
    };

    this.removeAll = function() {
        return this.ranges.splice(0, this.ranges.length);
    };

    this.attach = function(session) {
        if (this.session)
            this.detach();

        this.session = session;
        this.onChange = this.$onChange.bind(this);

        this.session.on('change', this.onChange);
    };

    this.detach = function() {
        if (!this.session)
            return;
        this.session.removeListener('change', this.onChange);
        this.session = null;
    };

    this.$onChange = function(e) {
        var changeRange = e.data.range;
        if (e.data.action[0] == "i"){
            var start = changeRange.start;
            var end = changeRange.end;
        } else {
            var end = changeRange.start;
            var start = changeRange.end;
        }
        var startRow = start.row;
        var endRow = end.row;
        var lineDif = endRow - startRow;

        var colDiff = -start.column + end.column;
        var ranges = this.ranges;

        for (var i = 0, n = ranges.length; i < n; i++) {
            var r = ranges[i];
            if (r.end.row < startRow)
                continue;
            if (r.start.row > startRow)
                break;

            if (r.start.row == startRow && r.start.column >= start.column ) {
                if (r.start.column == start.column && this.$insertRight) {
                } else {
                    r.start.column += colDiff;
                    r.start.row += lineDif;
                }
            }
            if (r.end.row == startRow && r.end.column >= start.column) {
                if (r.end.column == start.column && this.$insertRight) {
                    continue;
                }
                if (r.end.column == start.column && colDiff > 0 && i < n - 1) {                
                    if (r.end.column > r.start.column && r.end.column == ranges[i+1].start.column)
                        r.end.column -= colDiff;
                }
                r.end.column += colDiff;
                r.end.row += lineDif;
            }
        }

        if (lineDif != 0 && i < n) {
            for (; i < n; i++) {
                var r = ranges[i];
                r.start.row += lineDif;
                r.end.row += lineDif;
            }
        }
    };

}).call(RangeList.prototype);

exports.RangeList = RangeList;
});

ace.define('ace/range', ['require', 'exports', 'module' ], function(require, exports, module) {

var comparePoints = function(p1, p2) {
    return p1.row - p2.row || p1.column - p2.column;
};
var Range = function(startRow, startColumn, endRow, endColumn) {
    this.start = {
        row: startRow,
        column: startColumn
    };

    this.end = {
        row: endRow,
        column: endColumn
    };
};

(function() {
    this.isEqual = function(range) {
        return this.start.row === range.start.row &&
            this.end.row === range.end.row &&
            this.start.column === range.start.column &&
            this.end.column === range.end.column;
    };
    this.toString = function() {
        return ("Range: [" + this.start.row + "/" + this.start.column +
            "] -> [" + this.end.row + "/" + this.end.column + "]");
    };

    this.contains = function(row, column) {
        return this.compare(row, column) == 0;
    };
    this.compareRange = function(range) {
        var cmp,
            end = range.end,
            start = range.start;

        cmp = this.compare(end.row, end.column);
        if (cmp == 1) {
            cmp = this.compare(start.row, start.column);
            if (cmp == 1) {
                return 2;
            } else if (cmp == 0) {
                return 1;
            } else {
                return 0;
            }
        } else if (cmp == -1) {
            return -2;
        } else {
            cmp = this.compare(start.row, start.column);
            if (cmp == -1) {
                return -1;
            } else if (cmp == 1) {
                return 42;
            } else {
                return 0;
            }
        }
    };
    this.comparePoint = function(p) {
        return this.compare(p.row, p.column);
    };
    this.containsRange = function(range) {
        return this.comparePoint(range.start) == 0 && this.comparePoint(range.end) == 0;
    };
    this.intersects = function(range) {
        var cmp = this.compareRange(range);
        return (cmp == -1 || cmp == 0 || cmp == 1);
    };
    this.isEnd = function(row, column) {
        return this.end.row == row && this.end.column == column;
    };
    this.isStart = function(row, column) {
        return this.start.row == row && this.start.column == column;
    };
    this.setStart = function(row, column) {
        if (typeof row == "object") {
            this.start.column = row.column;
            this.start.row = row.row;
        } else {
            this.start.row = row;
            this.start.column = column;
        }
    };
    this.setEnd = function(row, column) {
        if (typeof row == "object") {
            this.end.column = row.column;
            this.end.row = row.row;
        } else {
            this.end.row = row;
            this.end.column = column;
        }
    };
    this.inside = function(row, column) {
        if (this.compare(row, column) == 0) {
            if (this.isEnd(row, column) || this.isStart(row, column)) {
                return false;
            } else {
                return true;
            }
        }
        return false;
    };
    this.insideStart = function(row, column) {
        if (this.compare(row, column) == 0) {
            if (this.isEnd(row, column)) {
                return false;
            } else {
                return true;
            }
        }
        return false;
    };
    this.insideEnd = function(row, column) {
        if (this.compare(row, column) == 0) {
            if (this.isStart(row, column)) {
                return false;
            } else {
                return true;
            }
        }
        return false;
    };
    this.compare = function(row, column) {
        if (!this.isMultiLine()) {
            if (row === this.start.row) {
                return column < this.start.column ? -1 : (column > this.end.column ? 1 : 0);
            };
        }

        if (row < this.start.row)
            return -1;

        if (row > this.end.row)
            return 1;

        if (this.start.row === row)
            return column >= this.start.column ? 0 : -1;

        if (this.end.row === row)
            return column <= this.end.column ? 0 : 1;

        return 0;
    };
    this.compareStart = function(row, column) {
        if (this.start.row == row && this.start.column == column) {
            return -1;
        } else {
            return this.compare(row, column);
        }
    };
    this.compareEnd = function(row, column) {
        if (this.end.row == row && this.end.column == column) {
            return 1;
        } else {
            return this.compare(row, column);
        }
    };
    this.compareInside = function(row, column) {
        if (this.end.row == row && this.end.column == column) {
            return 1;
        } else if (this.start.row == row && this.start.column == column) {
            return -1;
        } else {
            return this.compare(row, column);
        }
    };
    this.clipRows = function(firstRow, lastRow) {
        if (this.end.row > lastRow)
            var end = {row: lastRow + 1, column: 0};
        else if (this.end.row < firstRow)
            var end = {row: firstRow, column: 0};

        if (this.start.row > lastRow)
            var start = {row: lastRow + 1, column: 0};
        else if (this.start.row < firstRow)
            var start = {row: firstRow, column: 0};

        return Range.fromPoints(start || this.start, end || this.end);
    };
    this.extend = function(row, column) {
        var cmp = this.compare(row, column);

        if (cmp == 0)
            return this;
        else if (cmp == -1)
            var start = {row: row, column: column};
        else
            var end = {row: row, column: column};

        return Range.fromPoints(start || this.start, end || this.end);
    };

    this.isEmpty = function() {
        return (this.start.row === this.end.row && this.start.column === this.end.column);
    };
    this.isMultiLine = function() {
        return (this.start.row !== this.end.row);
    };
    this.clone = function() {
        return Range.fromPoints(this.start, this.end);
    };
    this.collapseRows = function() {
        if (this.end.column == 0)
            return new Range(this.start.row, 0, Math.max(this.start.row, this.end.row-1), 0)
        else
            return new Range(this.start.row, 0, this.end.row, 0)
    };
    this.toScreenRange = function(session) {
        var screenPosStart = session.documentToScreenPosition(this.start);
        var screenPosEnd = session.documentToScreenPosition(this.end);

        return new Range(
            screenPosStart.row, screenPosStart.column,
            screenPosEnd.row, screenPosEnd.column
        );
    };
    this.moveBy = function(row, column) {
        this.start.row += row;
        this.start.column += column;
        this.end.row += row;
        this.end.column += column;
    };

}).call(Range.prototype);
Range.fromPoints = function(start, end) {
    return new Range(start.row, start.column, end.row, end.column);
};
Range.comparePoints = comparePoints;

Range.comparePoints = function(p1, p2) {
    return p1.row - p2.row || p1.column - p2.column;
};


exports.Range = Range;
});

ace.define('ace/edit_session/bracket_match', ['require', 'exports', 'module' , 'ace/token_iterator', 'ace/range'], function(require, exports, module) {


var TokenIterator = require("../token_iterator").TokenIterator;
var Range = require("../range").Range;


function BracketMatch() {

    this.findMatchingBracket = function(position, chr) {
        if (position.column == 0) return null;

        var charBeforeCursor = chr || this.getLine(position.row).charAt(position.column-1);
        if (charBeforeCursor == "") return null;

        var match = charBeforeCursor.match(/([\(\[\{])|([\)\]\}])/);
        if (!match)
            return null;

        if (match[1])
            return this.$findClosingBracket(match[1], position);
        else
            return this.$findOpeningBracket(match[2], position);
    };
    
    this.getBracketRange = function(pos) {
        var line = this.getLine(pos.row);
        var before = true, range;

        var chr = line.charAt(pos.column-1);
        var match = chr && chr.match(/([\(\[\{])|([\)\]\}])/);
        if (!match) {
            chr = line.charAt(pos.column);
            pos = {row: pos.row, column: pos.column + 1};
            match = chr && chr.match(/([\(\[\{])|([\)\]\}])/);
            before = false;
        }
        if (!match)
            return null;

        if (match[1]) {
            var bracketPos = this.$findClosingBracket(match[1], pos);
            if (!bracketPos)
                return null;
            range = Range.fromPoints(pos, bracketPos);
            if (!before) {
                range.end.column++;
                range.start.column--;
            }
            range.cursor = range.end;
        } else {
            var bracketPos = this.$findOpeningBracket(match[2], pos);
            if (!bracketPos)
                return null;
            range = Range.fromPoints(bracketPos, pos);
            if (!before) {
                range.start.column++;
                range.end.column--;
            }
            range.cursor = range.start;
        }
        
        return range;
    };

    this.$brackets = {
        ")": "(",
        "(": ")",
        "]": "[",
        "[": "]",
        "{": "}",
        "}": "{"
    };

    this.$findOpeningBracket = function(bracket, position, typeRe) {
        var openBracket = this.$brackets[bracket];
        var depth = 1;

        var iterator = new TokenIterator(this, position.row, position.column);
        var token = iterator.getCurrentToken();
        if (!token)
            token = iterator.stepForward();
        if (!token)
            return;
        
         if (!typeRe){
            typeRe = new RegExp(
                "(\\.?" +
                token.type.replace(".", "\\.").replace("rparen", ".paren")
                + ")+"
            );
        }
        var valueIndex = position.column - iterator.getCurrentTokenColumn() - 2;
        var value = token.value;
        
        while (true) {
        
            while (valueIndex >= 0) {
                var chr = value.charAt(valueIndex);
                if (chr == openBracket) {
                    depth -= 1;
                    if (depth == 0) {
                        return {row: iterator.getCurrentTokenRow(),
                            column: valueIndex + iterator.getCurrentTokenColumn()};
                    }
                }
                else if (chr == bracket) {
                    depth += 1;
                }
                valueIndex -= 1;
            }
            do {
                token = iterator.stepBackward();
            } while (token && !typeRe.test(token.type));

            if (token == null)
                break;
                
            value = token.value;
            valueIndex = value.length - 1;
        }
        
        return null;
    };

    this.$findClosingBracket = function(bracket, position, typeRe) {
        var closingBracket = this.$brackets[bracket];
        var depth = 1;

        var iterator = new TokenIterator(this, position.row, position.column);
        var token = iterator.getCurrentToken();
        if (!token)
            token = iterator.stepForward();
        if (!token)
            return;

        if (!typeRe){
            typeRe = new RegExp(
                "(\\.?" +
                token.type.replace(".", "\\.").replace("lparen", ".paren")
                + ")+"
            );
        }
        var valueIndex = position.column - iterator.getCurrentTokenColumn();

        while (true) {

            var value = token.value;
            var valueLength = value.length;
            while (valueIndex < valueLength) {
                var chr = value.charAt(valueIndex);
                if (chr == closingBracket) {
                    depth -= 1;
                    if (depth == 0) {
                        return {row: iterator.getCurrentTokenRow(),
                            column: valueIndex + iterator.getCurrentTokenColumn()};
                    }
                }
                else if (chr == bracket) {
                    depth += 1;
                }
                valueIndex += 1;
            }
            do {
                token = iterator.stepForward();
            } while (token && !typeRe.test(token.type));

            if (token == null)
                break;

            valueIndex = 0;
        }
        
        return null;
    };
}
exports.BracketMatch = BracketMatch;

});

ace.define('ace/selection', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/lang', 'ace/lib/event_emitter', 'ace/range'], function(require, exports, module) {


var oop = require("./lib/oop");
var lang = require("./lib/lang");
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var Range = require("./range").Range;
var Selection = function(session) {
    this.session = session;
    this.doc = session.getDocument();

    this.clearSelection();
    this.lead = this.selectionLead = this.doc.createAnchor(0, 0);
    this.anchor = this.selectionAnchor = this.doc.createAnchor(0, 0);

    var self = this;
    this.lead.on("change", function(e) {
        self._emit("changeCursor");
        if (!self.$isEmpty)
            self._emit("changeSelection");
        if (!self.$keepDesiredColumnOnChange && e.old.column != e.value.column)
            self.$desiredColumn = null;
    });

    this.selectionAnchor.on("change", function() {
        if (!self.$isEmpty)
            self._emit("changeSelection");
    });
};

(function() {

    oop.implement(this, EventEmitter);
    this.isEmpty = function() {
        return (this.$isEmpty || (
            this.anchor.row == this.lead.row &&
            this.anchor.column == this.lead.column
        ));
    };
    this.isMultiLine = function() {
        if (this.isEmpty()) {
            return false;
        }

        return this.getRange().isMultiLine();
    };
    this.getCursor = function() {
        return this.lead.getPosition();
    };
    this.setSelectionAnchor = function(row, column) {
        this.anchor.setPosition(row, column);

        if (this.$isEmpty) {
            this.$isEmpty = false;
            this._emit("changeSelection");
        }
    };
    this.getSelectionAnchor = function() {
        if (this.$isEmpty)
            return this.getSelectionLead()
        else
            return this.anchor.getPosition();
    };
    this.getSelectionLead = function() {
        return this.lead.getPosition();
    };
    this.shiftSelection = function(columns) {
        if (this.$isEmpty) {
            this.moveCursorTo(this.lead.row, this.lead.column + columns);
            return;
        };

        var anchor = this.getSelectionAnchor();
        var lead = this.getSelectionLead();

        var isBackwards = this.isBackwards();

        if (!isBackwards || anchor.column !== 0)
            this.setSelectionAnchor(anchor.row, anchor.column + columns);

        if (isBackwards || lead.column !== 0) {
            this.$moveSelection(function() {
                this.moveCursorTo(lead.row, lead.column + columns);
            });
        }
    };
    this.isBackwards = function() {
        var anchor = this.anchor;
        var lead = this.lead;
        return (anchor.row > lead.row || (anchor.row == lead.row && anchor.column > lead.column));
    };
    this.getRange = function() {
        var anchor = this.anchor;
        var lead = this.lead;

        if (this.isEmpty())
            return Range.fromPoints(lead, lead);

        if (this.isBackwards()) {
            return Range.fromPoints(lead, anchor);
        }
        else {
            return Range.fromPoints(anchor, lead);
        }
    };
    this.clearSelection = function() {
        if (!this.$isEmpty) {
            this.$isEmpty = true;
            this._emit("changeSelection");
        }
    };
    this.selectAll = function() {
        var lastRow = this.doc.getLength() - 1;
        this.setSelectionAnchor(0, 0);
        this.moveCursorTo(lastRow, this.doc.getLine(lastRow).length);
    };
    this.setRange =
    this.setSelectionRange = function(range, reverse) {
        if (reverse) {
            this.setSelectionAnchor(range.end.row, range.end.column);
            this.selectTo(range.start.row, range.start.column);
        } else {
            this.setSelectionAnchor(range.start.row, range.start.column);
            this.selectTo(range.end.row, range.end.column);
        }
        if (this.getRange().isEmpty())
            this.$isEmpty = true;
        this.$desiredColumn = null;
    };

    this.$moveSelection = function(mover) {
        var lead = this.lead;
        if (this.$isEmpty)
            this.setSelectionAnchor(lead.row, lead.column);

        mover.call(this);
    };
    this.selectTo = function(row, column) {
        this.$moveSelection(function() {
            this.moveCursorTo(row, column);
        });
    };
    this.selectToPosition = function(pos) {
        this.$moveSelection(function() {
            this.moveCursorToPosition(pos);
        });
    };
    this.moveTo = function(row, column) {
        this.clearSelection();
        this.moveCursorTo(row, column);
    };
    this.moveToPosition = function(pos) {
        this.clearSelection();
        this.moveCursorToPosition(pos);
    };
    this.selectUp = function() {
        this.$moveSelection(this.moveCursorUp);
    };
    this.selectDown = function() {
        this.$moveSelection(this.moveCursorDown);
    };
    this.selectRight = function() {
        this.$moveSelection(this.moveCursorRight);
    };
    this.selectLeft = function() {
        this.$moveSelection(this.moveCursorLeft);
    };
    this.selectLineStart = function() {
        this.$moveSelection(this.moveCursorLineStart);
    };
    this.selectLineEnd = function() {
        this.$moveSelection(this.moveCursorLineEnd);
    };
    this.selectFileEnd = function() {
        this.$moveSelection(this.moveCursorFileEnd);
    };
    this.selectFileStart = function() {
        this.$moveSelection(this.moveCursorFileStart);
    };
    this.selectWordRight = function() {
        this.$moveSelection(this.moveCursorWordRight);
    };
    this.selectWordLeft = function() {
        this.$moveSelection(this.moveCursorWordLeft);
    };
    this.getWordRange = function(row, column) {
        if (typeof column == "undefined") {
            var cursor = row || this.lead;
            row = cursor.row;
            column = cursor.column;
        }
        return this.session.getWordRange(row, column);
    };
    this.selectWord = function() {
        this.setSelectionRange(this.getWordRange());
    };
    this.selectAWord = function() {
        var cursor = this.getCursor();
        var range = this.session.getAWordRange(cursor.row, cursor.column);
        this.setSelectionRange(range);
    };

    this.getLineRange = function(row, excludeLastChar) {
        var rowStart = typeof row == "number" ? row : this.lead.row;
        var rowEnd;

        var foldLine = this.session.getFoldLine(rowStart);
        if (foldLine) {
            rowStart = foldLine.start.row;
            rowEnd = foldLine.end.row;
        } else {
            rowEnd = rowStart;
        }
        if (excludeLastChar === true)
            return new Range(rowStart, 0, rowEnd, this.session.getLine(rowEnd).length);
        else
            return new Range(rowStart, 0, rowEnd + 1, 0);
    };
    this.selectLine = function() {
        this.setSelectionRange(this.getLineRange());
    };
    this.moveCursorUp = function() {
        this.moveCursorBy(-1, 0);
    };
    this.moveCursorDown = function() {
        this.moveCursorBy(1, 0);
    };
    this.moveCursorLeft = function() {
        var cursor = this.lead.getPosition(),
            fold;

        if (fold = this.session.getFoldAt(cursor.row, cursor.column, -1)) {
            this.moveCursorTo(fold.start.row, fold.start.column);
        } else if (cursor.column == 0) {
            if (cursor.row > 0) {
                this.moveCursorTo(cursor.row - 1, this.doc.getLine(cursor.row - 1).length);
            }
        }
        else {
            var tabSize = this.session.getTabSize();
            if (this.session.isTabStop(cursor) && this.doc.getLine(cursor.row).slice(cursor.column-tabSize, cursor.column).split(" ").length-1 == tabSize)
                this.moveCursorBy(0, -tabSize);
            else
                this.moveCursorBy(0, -1);
        }
    };
    this.moveCursorRight = function() {
        var cursor = this.lead.getPosition(),
            fold;
        if (fold = this.session.getFoldAt(cursor.row, cursor.column, 1)) {
            this.moveCursorTo(fold.end.row, fold.end.column);
        }
        else if (this.lead.column == this.doc.getLine(this.lead.row).length) {
            if (this.lead.row < this.doc.getLength() - 1) {
                this.moveCursorTo(this.lead.row + 1, 0);
            }
        }
        else {
            var tabSize = this.session.getTabSize();
            var cursor = this.lead;
            if (this.session.isTabStop(cursor) && this.doc.getLine(cursor.row).slice(cursor.column, cursor.column+tabSize).split(" ").length-1 == tabSize)
                this.moveCursorBy(0, tabSize);
            else
                this.moveCursorBy(0, 1);
        }
    };
    this.moveCursorLineStart = function() {
        var row = this.lead.row;
        var column = this.lead.column;
        var screenRow = this.session.documentToScreenRow(row, column);
        var firstColumnPosition = this.session.screenToDocumentPosition(screenRow, 0);
        var beforeCursor = this.session.getDisplayLine(
            row, null, firstColumnPosition.row,
            firstColumnPosition.column
        );

        var leadingSpace = beforeCursor.match(/^\s*/);
        if (leadingSpace[0].length != column && !this.session.$useEmacsStyleLineStart)
            firstColumnPosition.column += leadingSpace[0].length;
        this.moveCursorToPosition(firstColumnPosition);
    };
    this.moveCursorLineEnd = function() {
        var lead = this.lead;
        var lineEnd = this.session.getDocumentLastRowColumnPosition(lead.row, lead.column);
        if (this.lead.column == lineEnd.column) {
            var line = this.session.getLine(lineEnd.row);
            if (lineEnd.column == line.length) {
                var textEnd = line.search(/\s+$/);
                if (textEnd > 0)
                    lineEnd.column = textEnd;
            }
        }

        this.moveCursorTo(lineEnd.row, lineEnd.column);
    };
    this.moveCursorFileEnd = function() {
        var row = this.doc.getLength() - 1;
        var column = this.doc.getLine(row).length;
        this.moveCursorTo(row, column);
    };
    this.moveCursorFileStart = function() {
        this.moveCursorTo(0, 0);
    };
    this.moveCursorLongWordRight = function() {
        var row = this.lead.row;
        var column = this.lead.column;
        var line = this.doc.getLine(row);
        var rightOfCursor = line.substring(column);

        var match;
        this.session.nonTokenRe.lastIndex = 0;
        this.session.tokenRe.lastIndex = 0;
        var fold = this.session.getFoldAt(row, column, 1);
        if (fold) {
            this.moveCursorTo(fold.end.row, fold.end.column);
            return;
        }
        if (match = this.session.nonTokenRe.exec(rightOfCursor)) {
            column += this.session.nonTokenRe.lastIndex;
            this.session.nonTokenRe.lastIndex = 0;
            rightOfCursor = line.substring(column);
        }
        if (column >= line.length) {
            this.moveCursorTo(row, line.length);
            this.moveCursorRight();
            if (row < this.doc.getLength() - 1)
                this.moveCursorWordRight();
            return;
        }
        if (match = this.session.tokenRe.exec(rightOfCursor)) {
            column += this.session.tokenRe.lastIndex;
            this.session.tokenRe.lastIndex = 0;
        }

        this.moveCursorTo(row, column);
    };
    this.moveCursorLongWordLeft = function() {
        var row = this.lead.row;
        var column = this.lead.column;
        var fold;
        if (fold = this.session.getFoldAt(row, column, -1)) {
            this.moveCursorTo(fold.start.row, fold.start.column);
            return;
        }

        var str = this.session.getFoldStringAt(row, column, -1);
        if (str == null) {
            str = this.doc.getLine(row).substring(0, column)
        }

        var leftOfCursor = lang.stringReverse(str);
        var match;
        this.session.nonTokenRe.lastIndex = 0;
        this.session.tokenRe.lastIndex = 0;
        if (match = this.session.nonTokenRe.exec(leftOfCursor)) {
            column -= this.session.nonTokenRe.lastIndex;
            leftOfCursor = leftOfCursor.slice(this.session.nonTokenRe.lastIndex);
            this.session.nonTokenRe.lastIndex = 0;
        }
        if (column <= 0) {
            this.moveCursorTo(row, 0);
            this.moveCursorLeft();
            if (row > 0)
                this.moveCursorWordLeft();
            return;
        }
        if (match = this.session.tokenRe.exec(leftOfCursor)) {
            column -= this.session.tokenRe.lastIndex;
            this.session.tokenRe.lastIndex = 0;
        }

        this.moveCursorTo(row, column);
    };

    this.$shortWordEndIndex = function(rightOfCursor) {
        var match, index = 0, ch;
        var whitespaceRe = /\s/;
        var tokenRe = this.session.tokenRe;

        tokenRe.lastIndex = 0;
        if (match = this.session.tokenRe.exec(rightOfCursor)) {
            index = this.session.tokenRe.lastIndex;
        } else {
            while ((ch = rightOfCursor[index]) && whitespaceRe.test(ch))
                index ++;

            if (index < 1) {
                tokenRe.lastIndex = 0;
                 while ((ch = rightOfCursor[index]) && !tokenRe.test(ch)) {
                    tokenRe.lastIndex = 0;
                    index ++;
                    if (whitespaceRe.test(ch)) {
                        if (index > 2) {
                            index--
                            break;
                        } else {
                            while ((ch = rightOfCursor[index]) && whitespaceRe.test(ch))
                                index ++;
                            if (index > 2)
                                break
                        }
                    }
                }
            }
        }
        tokenRe.lastIndex = 0;

        return index;
    };

    this.moveCursorShortWordRight = function() {
        var row = this.lead.row;
        var column = this.lead.column;
        var line = this.doc.getLine(row);
        var rightOfCursor = line.substring(column);

        var fold = this.session.getFoldAt(row, column, 1);
        if (fold)
            return this.moveCursorTo(fold.end.row, fold.end.column);

        if (column == line.length) {
            var l = this.doc.getLength();
            do {
                row++;
                rightOfCursor = this.doc.getLine(row)
            } while (row < l && /^\s*$/.test(rightOfCursor))

            if (!/^\s+/.test(rightOfCursor))
                rightOfCursor = ""
            column = 0;
        }

        var index = this.$shortWordEndIndex(rightOfCursor);

        this.moveCursorTo(row, column + index);
    };

    this.moveCursorShortWordLeft = function() {
        var row = this.lead.row;
        var column = this.lead.column;

        var fold;
        if (fold = this.session.getFoldAt(row, column, -1))
            return this.moveCursorTo(fold.start.row, fold.start.column);

        var line = this.session.getLine(row).substring(0, column);
        if (column == 0) {
            do {
                row--;
                line = this.doc.getLine(row);
            } while (row > 0 && /^\s*$/.test(line))

            column = line.length;
            if (!/\s+$/.test(line))
                line = ""
        }

        var leftOfCursor = lang.stringReverse(line);
        var index = this.$shortWordEndIndex(leftOfCursor);

        return this.moveCursorTo(row, column - index);
    };

    this.moveCursorWordRight = function() {
        if (this.session.$selectLongWords)
            this.moveCursorLongWordRight();
        else
            this.moveCursorShortWordRight();
    };

    this.moveCursorWordLeft = function() {
        if (this.session.$selectLongWords)
            this.moveCursorLongWordLeft();
        else
            this.moveCursorShortWordLeft();
    };
    this.moveCursorBy = function(rows, chars) {
        var screenPos = this.session.documentToScreenPosition(
            this.lead.row,
            this.lead.column
        );

        if (chars === 0) {
            if (this.$desiredColumn)
                screenPos.column = this.$desiredColumn;
            else
                this.$desiredColumn = screenPos.column;
        }

        var docPos = this.session.screenToDocumentPosition(screenPos.row + rows, screenPos.column);
        
        if (rows !== 0 && chars === 0 && docPos.row === this.lead.row && docPos.column === this.lead.column) {
            if (this.session.lineWidgets && this.session.lineWidgets[docPos.row])
                docPos.row++;
        }
        this.moveCursorTo(docPos.row, docPos.column + chars, chars === 0);
    };
    this.moveCursorToPosition = function(position) {
        this.moveCursorTo(position.row, position.column);
    };
    this.moveCursorTo = function(row, column, keepDesiredColumn) {
        var fold = this.session.getFoldAt(row, column, 1);
        if (fold) {
            row = fold.start.row;
            column = fold.start.column;
        }

        this.$keepDesiredColumnOnChange = true;
        this.lead.setPosition(row, column);
        this.$keepDesiredColumnOnChange = false;

        if (!keepDesiredColumn)
            this.$desiredColumn = null;
    };
    this.moveCursorToScreen = function(row, column, keepDesiredColumn) {
        var pos = this.session.screenToDocumentPosition(row, column);
        this.moveCursorTo(pos.row, pos.column, keepDesiredColumn);
    };
    this.detach = function() {
        this.lead.detach();
        this.anchor.detach();
        this.session = this.doc = null;
    }

    this.fromOrientedRange = function(range) {
        this.setSelectionRange(range, range.cursor == range.start);
        this.$desiredColumn = range.desiredColumn || this.$desiredColumn;
    }

    this.toOrientedRange = function(range) {
        var r = this.getRange();
        if (range) {
            range.start.column = r.start.column;
            range.start.row = r.start.row;
            range.end.column = r.end.column;
            range.end.row = r.end.row;
        } else {
            range = r;
        }

        range.cursor = this.isBackwards() ? range.start : range.end;
        range.desiredColumn = this.$desiredColumn;
        return range;
    }

    this.toJSON = function() {
        if (this.rangeCount) {
            var data = this.ranges.map(function(r) {
                var r1 = r.clone();
                r1.isBackwards = r.cursor == r.start;
                return r1;
            });
        } else {
            var data = this.getRange();
            data.isBackwards = this.isBackwards();
        }
        return data;
    };

    this.fromJSON = function(data) {
        if (data.start == undefined) {
            if (this.rangeList) {
                this.toSingleRange(data[0]);
                for (var i = data.length; i--; ) {
                    var r = Range.fromPoints(data[i].start, data[i].end);
                    if (data.isBackwards)
                        r.cursor = r.start;
                    this.addRange(r, true);
                }
                return;
            } else
                data = data[0];
        }
        if (this.rangeList)
            this.toSingleRange(data);
        this.setSelectionRange(data, data.isBackwards);
    };

    this.isEqual = function(data) {
        if ((data.length || this.rangeCount) && data.length != this.rangeCount)
            return false;
        if (!data.length || !this.ranges)
            return this.getRange().isEqual(data);

        for (var i = this.ranges.length; i--; ) {
            if (!this.ranges[i].isEqual(data[i]))
                return false
        }
        return true;
    }

}).call(Selection.prototype);

exports.Selection = Selection;
});

ace.define('ace/search', ['require', 'exports', 'module' , 'ace/lib/lang', 'ace/lib/oop', 'ace/range'], function(require, exports, module) {


var lang = require("./lib/lang");
var oop = require("./lib/oop");
var Range = require("./range").Range;

var Search = function() {
    this.$options = {};
};

(function() {
    this.set = function(options) {
        oop.mixin(this.$options, options);
        return this;
    };
    this.getOptions = function() {
        return lang.copyObject(this.$options);
    };
    this.setOptions = function(options) {
        this.$options = options;
    };
    this.find = function(session) {
        var iterator = this.$matchIterator(session, this.$options);

        if (!iterator)
            return false;

        var firstRange = null;
        iterator.forEach(function(range, row, offset) {
            if (!range.start) {
                var column = range.offset + (offset || 0);
                firstRange = new Range(row, column, row, column+range.length);
            } else
                firstRange = range;
            return true;
        });

        return firstRange;
    };
    this.findAll = function(session) {
        var options = this.$options;
        if (!options.needle)
            return [];
        this.$assembleRegExp(options);

        var range = options.range;
        var lines = range
            ? session.getLines(range.start.row, range.end.row)
            : session.doc.getAllLines();

        var ranges = [];
        var re = options.re;
        if (options.$isMultiLine) {
            var len = re.length;
            var maxRow = lines.length - len;
            var prevRange;
            outer: for (var row = re.offset || 0; row <= maxRow; row++) {
                for (var j = 0; j < len; j++)
                    if (lines[row + j].search(re[j]) == -1)
                        continue outer;
                
                var startLine = lines[row];
                var line = lines[row + len - 1];
                var startIndex = startLine.length - startLine.match(re[0])[0].length;
                var endIndex = line.match(re[len - 1])[0].length;
                
                if (prevRange && prevRange.end.row === row &&
                    prevRange.end.column > startIndex
                ) {
                    continue;
                }
                ranges.push(prevRange = new Range(
                    row, startIndex, row + len - 1, endIndex
                ));
                if (len > 2)
                    row = row + len - 2;
            }
        } else {
            for (var i = 0; i < lines.length; i++) {
                var matches = lang.getMatchOffsets(lines[i], re);
                for (var j = 0; j < matches.length; j++) {
                    var match = matches[j];
                    ranges.push(new Range(i, match.offset, i, match.offset + match.length));
                }
            }
        }

        if (range) {
            var startColumn = range.start.column;
            var endColumn = range.start.column;
            var i = 0, j = ranges.length - 1;
            while (i < j && ranges[i].start.column < startColumn && ranges[i].start.row == range.start.row)
                i++;

            while (i < j && ranges[j].end.column > endColumn && ranges[j].end.row == range.end.row)
                j--;
            
            ranges = ranges.slice(i, j + 1);
            for (i = 0, j = ranges.length; i < j; i++) {
                ranges[i].start.row += range.start.row;
                ranges[i].end.row += range.start.row;
            }
        }

        return ranges;
    };
    this.replace = function(input, replacement) {
        var options = this.$options;

        var re = this.$assembleRegExp(options);
        if (options.$isMultiLine)
            return replacement;

        if (!re)
            return;

        var match = re.exec(input);
        if (!match || match[0].length != input.length)
            return null;
        
        replacement = input.replace(re, replacement);
        if (options.preserveCase) {
            replacement = replacement.split("");
            for (var i = Math.min(input.length, input.length); i--; ) {
                var ch = input[i];
                if (ch && ch.toLowerCase() != ch)
                    replacement[i] = replacement[i].toUpperCase();
                else
                    replacement[i] = replacement[i].toLowerCase();
            }
            replacement = replacement.join("");
        }
        
        return replacement;
    };

    this.$matchIterator = function(session, options) {
        var re = this.$assembleRegExp(options);
        if (!re)
            return false;

        var self = this, callback, backwards = options.backwards;

        if (options.$isMultiLine) {
            var len = re.length;
            var matchIterator = function(line, row, offset) {
                var startIndex = line.search(re[0]);
                if (startIndex == -1)
                    return;
                for (var i = 1; i < len; i++) {
                    line = session.getLine(row + i);
                    if (line.search(re[i]) == -1)
                        return;
                }

                var endIndex = line.match(re[len - 1])[0].length;

                var range = new Range(row, startIndex, row + len - 1, endIndex);
                if (re.offset == 1) {
                    range.start.row--;
                    range.start.column = Number.MAX_VALUE;
                } else if (offset)
                    range.start.column += offset;

                if (callback(range))
                    return true;
            };
        } else if (backwards) {
            var matchIterator = function(line, row, startIndex) {
                var matches = lang.getMatchOffsets(line, re);
                for (var i = matches.length-1; i >= 0; i--)
                    if (callback(matches[i], row, startIndex))
                        return true;
            };
        } else {
            var matchIterator = function(line, row, startIndex) {
                var matches = lang.getMatchOffsets(line, re);
                for (var i = 0; i < matches.length; i++)
                    if (callback(matches[i], row, startIndex))
                        return true;
            };
        }

        return {
            forEach: function(_callback) {
                callback = _callback;
                self.$lineIterator(session, options).forEach(matchIterator);
            }
        };
    };

    this.$assembleRegExp = function(options, $disableFakeMultiline) {
        if (options.needle instanceof RegExp)
            return options.re = options.needle;

        var needle = options.needle;

        if (!options.needle)
            return options.re = false;

        if (!options.regExp)
            needle = lang.escapeRegExp(needle);

        if (options.wholeWord)
            needle = "\\b" + needle + "\\b";

        var modifier = options.caseSensitive ? "g" : "gi";

        options.$isMultiLine = !$disableFakeMultiline && /[\n\r]/.test(needle);
        if (options.$isMultiLine)
            return options.re = this.$assembleMultilineRegExp(needle, modifier);

        try {
            var re = new RegExp(needle, modifier);
        } catch(e) {
            re = false;
        }
        return options.re = re;
    };

    this.$assembleMultilineRegExp = function(needle, modifier) {
        var parts = needle.replace(/\r\n|\r|\n/g, "$\n^").split("\n");
        var re = [];
        for (var i = 0; i < parts.length; i++) try {
            re.push(new RegExp(parts[i], modifier));
        } catch(e) {
            return false;
        }
        if (parts[0] == "") {
            re.shift();
            re.offset = 1;
        } else {
            re.offset = 0;
        }
        return re;
    };

    this.$lineIterator = function(session, options) {
        var backwards = options.backwards == true;
        var skipCurrent = options.skipCurrent != false;

        var range = options.range;
        var start = options.start;
        if (!start)
            start = range ? range[backwards ? "end" : "start"] : session.selection.getRange();
         
        if (start.start)
            start = start[skipCurrent != backwards ? "end" : "start"];

        var firstRow = range ? range.start.row : 0;
        var lastRow = range ? range.end.row : session.getLength() - 1;

        var forEach = backwards ? function(callback) {
                var row = start.row;

                var line = session.getLine(row).substring(0, start.column);
                if (callback(line, row))
                    return;

                for (row--; row >= firstRow; row--)
                    if (callback(session.getLine(row), row))
                        return;

                if (options.wrap == false)
                    return;

                for (row = lastRow, firstRow = start.row; row >= firstRow; row--)
                    if (callback(session.getLine(row), row))
                        return;
            } : function(callback) {
                var row = start.row;

                var line = session.getLine(row).substr(start.column);
                if (callback(line, row, start.column))
                    return;

                for (row = row+1; row <= lastRow; row++)
                    if (callback(session.getLine(row), row))
                        return;

                if (options.wrap == false)
                    return;

                for (row = firstRow, lastRow = start.row; row <= lastRow; row++)
                    if (callback(session.getLine(row), row))
                        return;
            };
        
        return {forEach: forEach};
    };

}).call(Search.prototype);

exports.Search = Search;
});

ace.define('ace/edit_session', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/lang', 'ace/config', 'ace/lib/event_emitter', 'ace/selection', 'ace/mode/text', 'ace/range', 'ace/document', 'ace/background_tokenizer', 'ace/search_highlight', 'ace/edit_session/folding', 'ace/edit_session/bracket_match'], function(require, exports, module) {


var oop = require("./lib/oop");
var lang = require("./lib/lang");
var config = require("./config");
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var Selection = require("./selection").Selection;
var TextMode = require("./mode/text").Mode;
var Range = require("./range").Range;
var Document = require("./document").Document;
var BackgroundTokenizer = require("./background_tokenizer").BackgroundTokenizer;
var SearchHighlight = require("./search_highlight").SearchHighlight;

var EditSession = function(text, mode) {
    this.$breakpoints = [];
    this.$decorations = [];
    this.$frontMarkers = {};
    this.$backMarkers = {};
    this.$markerId = 1;
    this.$undoSelect = true;

    this.$foldData = [];
    this.$foldData.toString = function() {
        return this.join("\n");
    }
    this.on("changeFold", this.onChangeFold.bind(this));
    this.$onChange = this.onChange.bind(this);

    if (typeof text != "object" || !text.getLine)
        text = new Document(text);

    this.setDocument(text);
    this.selection = new Selection(this);

    config.resetOptions(this);
    this.setMode(mode);
    config._signal("session", this);
};


(function() {

    oop.implement(this, EventEmitter);
    this.setDocument = function(doc) {
        if (this.doc)
            this.doc.removeListener("change", this.$onChange);

        this.doc = doc;
        doc.on("change", this.$onChange);

        if (this.bgTokenizer)
            this.bgTokenizer.setDocument(this.getDocument());

        this.resetCaches();
    };
    this.getDocument = function() {
        return this.doc;
    };
    this.$resetRowCache = function(docRow) {
        if (!docRow) {
            this.$docRowCache = [];
            this.$screenRowCache = [];
            return;
        }
        var l = this.$docRowCache.length;
        var i = this.$getRowCacheIndex(this.$docRowCache, docRow) + 1;
        if (l > i) {
            this.$docRowCache.splice(i, l);
            this.$screenRowCache.splice(i, l);
        }
    };

    this.$getRowCacheIndex = function(cacheArray, val) {
        var low = 0;
        var hi = cacheArray.length - 1;

        while (low <= hi) {
            var mid = (low + hi) >> 1;
            var c = cacheArray[mid];

            if (val > c)
                low = mid + 1;
            else if (val < c)
                hi = mid - 1;
            else
                return mid;
        }

        return low -1;
    };

    this.resetCaches = function() {
        this.$modified = true;
        this.$wrapData = [];
        this.$rowLengthCache = [];
        this.$resetRowCache(0);
        if (this.bgTokenizer)
            this.bgTokenizer.start(0);
    };

    this.onChangeFold = function(e) {
        var fold = e.data;
        this.$resetRowCache(fold.start.row);
    };

    this.onChange = function(e) {
        var delta = e.data;
        this.$modified = true;

        this.$resetRowCache(delta.range.start.row);

        var removedFolds = this.$updateInternalDataOnChange(e);
        if (!this.$fromUndo && this.$undoManager && !delta.ignore) {
            this.$deltasDoc.push(delta);
            if (removedFolds && removedFolds.length != 0) {
                this.$deltasFold.push({
                    action: "removeFolds",
                    folds:  removedFolds
                });
            }

            this.$informUndoManager.schedule();
        }

        this.bgTokenizer.$updateOnChange(delta);
        this._signal("change", e);
    };
    this.setValue = function(text) {
        this.doc.setValue(text);
        this.selection.moveTo(0, 0);

        this.$resetRowCache(0);
        this.$deltas = [];
        this.$deltasDoc = [];
        this.$deltasFold = [];
        this.setUndoManager(this.$undoManager);
        this.getUndoManager().reset();
    };
    this.getValue =
    this.toString = function() {
        return this.doc.getValue();
    };
    this.getSelection = function() {
        return this.selection;
    };
    this.getState = function(row) {
        return this.bgTokenizer.getState(row);
    };
    this.getTokens = function(row) {
        return this.bgTokenizer.getTokens(row);
    };
    this.getTokenAt = function(row, column) {
        var tokens = this.bgTokenizer.getTokens(row);
        var token, c = 0;
        if (column == null) {
            i = tokens.length - 1;
            c = this.getLine(row).length;
        } else {
            for (var i = 0; i < tokens.length; i++) {
                c += tokens[i].value.length;
                if (c >= column)
                    break;
            }
        }
        token = tokens[i];
        if (!token)
            return null;
        token.index = i;
        token.start = c - token.value.length;
        return token;
    };
    this.setUndoManager = function(undoManager) {
        this.$undoManager = undoManager;
        this.$deltas = [];
        this.$deltasDoc = [];
        this.$deltasFold = [];

        if (this.$informUndoManager)
            this.$informUndoManager.cancel();

        if (undoManager) {
            var self = this;

            this.$syncInformUndoManager = function() {
                self.$informUndoManager.cancel();

                if (self.$deltasFold.length) {
                    self.$deltas.push({
                        group: "fold",
                        deltas: self.$deltasFold
                    });
                    self.$deltasFold = [];
                }

                if (self.$deltasDoc.length) {
                    self.$deltas.push({
                        group: "doc",
                        deltas: self.$deltasDoc
                    });
                    self.$deltasDoc = [];
                }

                if (self.$deltas.length > 0) {
                    undoManager.execute({
                        action: "aceupdate",
                        args: [self.$deltas, self],
                        merge: self.mergeUndoDeltas
                    });
                }
                self.mergeUndoDeltas = false;
                self.$deltas = [];
            };
            this.$informUndoManager = lang.delayedCall(this.$syncInformUndoManager);
        }
    };
    this.markUndoGroup = function() {
        if (this.$syncInformUndoManager)
            this.$syncInformUndoManager();
    };
    
    this.$defaultUndoManager = {
        undo: function() {},
        redo: function() {},
        reset: function() {}
    };
    this.getUndoManager = function() {
        return this.$undoManager || this.$defaultUndoManager;
    };
    this.getTabString = function() {
        if (this.getUseSoftTabs()) {
            return lang.stringRepeat(" ", this.getTabSize());
        } else {
            return "\t";
        }
    };
    this.setUseSoftTabs = function(val) {
        this.setOption("useSoftTabs", val);
    };
    this.getUseSoftTabs = function() {
        return this.$useSoftTabs && !this.$mode.$indentWithTabs;
    };
    this.setTabSize = function(tabSize) {
        this.setOption("tabSize", tabSize);
    };
    this.getTabSize = function() {
        return this.$tabSize;
    };
    this.isTabStop = function(position) {
        return this.$useSoftTabs && (position.column % this.$tabSize === 0);
    };

    this.$overwrite = false;
    this.setOverwrite = function(overwrite) {
        this.setOption("overwrite", overwrite);
    };
    this.getOverwrite = function() {
        return this.$overwrite;
    };
    this.toggleOverwrite = function() {
        this.setOverwrite(!this.$overwrite);
    };
    this.addGutterDecoration = function(row, className) {
        if (!this.$decorations[row])
            this.$decorations[row] = "";
        this.$decorations[row] += " " + className;
        this._signal("changeBreakpoint", {});
    };
    this.removeGutterDecoration = function(row, className) {
        this.$decorations[row] = (this.$decorations[row] || "").replace(" " + className, "");
        this._signal("changeBreakpoint", {});
    };
    this.getBreakpoints = function() {
        return this.$breakpoints;
    };
    this.setBreakpoints = function(rows) {
        this.$breakpoints = [];
        for (var i=0; i<rows.length; i++) {
            this.$breakpoints[rows[i]] = "ace_breakpoint";
        }
        this._signal("changeBreakpoint", {});
    };
    this.clearBreakpoints = function() {
        this.$breakpoints = [];
        this._signal("changeBreakpoint", {});
    };
    this.setBreakpoint = function(row, className) {
        if (className === undefined)
            className = "ace_breakpoint";
        if (className)
            this.$breakpoints[row] = className;
        else
            delete this.$breakpoints[row];
        this._signal("changeBreakpoint", {});
    };
    this.clearBreakpoint = function(row) {
        delete this.$breakpoints[row];
        this._signal("changeBreakpoint", {});
    };
    this.addMarker = function(range, clazz, type, inFront) {
        var id = this.$markerId++;

        var marker = {
            range : range,
            type : type || "line",
            renderer: typeof type == "function" ? type : null,
            clazz : clazz,
            inFront: !!inFront,
            id: id
        };

        if (inFront) {
            this.$frontMarkers[id] = marker;
            this._signal("changeFrontMarker");
        } else {
            this.$backMarkers[id] = marker;
            this._signal("changeBackMarker");
        }

        return id;
    };
    this.addDynamicMarker = function(marker, inFront) {
        if (!marker.update)
            return;
        var id = this.$markerId++;
        marker.id = id;
        marker.inFront = !!inFront;

        if (inFront) {
            this.$frontMarkers[id] = marker;
            this._signal("changeFrontMarker");
        } else {
            this.$backMarkers[id] = marker;
            this._signal("changeBackMarker");
        }

        return marker;
    };
    this.removeMarker = function(markerId) {
        var marker = this.$frontMarkers[markerId] || this.$backMarkers[markerId];
        if (!marker)
            return;

        var markers = marker.inFront ? this.$frontMarkers : this.$backMarkers;
        if (marker) {
            delete (markers[markerId]);
            this._signal(marker.inFront ? "changeFrontMarker" : "changeBackMarker");
        }
    };
    this.getMarkers = function(inFront) {
        return inFront ? this.$frontMarkers : this.$backMarkers;
    };

    this.highlight = function(re) {
        if (!this.$searchHighlight) {
            var highlight = new SearchHighlight(null, "ace_selected-word", "text");
            this.$searchHighlight = this.addDynamicMarker(highlight);
        }
        this.$searchHighlight.setRegexp(re);
    };
    this.highlightLines = function(startRow, endRow, clazz, inFront) {
        if (typeof endRow != "number") {
            clazz = endRow;
            endRow = startRow;
        }
        if (!clazz)
            clazz = "ace_step";

        var range = new Range(startRow, 0, endRow, Infinity);
        range.id = this.addMarker(range, clazz, "fullLine", inFront);
        return range;
    };
    this.setAnnotations = function(annotations) {
        this.$annotations = annotations;
        this._signal("changeAnnotation", {});
    };
    this.getAnnotations = function() {
        return this.$annotations || [];
    };
    this.clearAnnotations = function() {
        this.setAnnotations([]);
    };
    this.$detectNewLine = function(text) {
        var match = text.match(/^.*?(\r?\n)/m);
        if (match) {
            this.$autoNewLine = match[1];
        } else {
            this.$autoNewLine = "\n";
        }
    };
    this.getWordRange = function(row, column) {
        var line = this.getLine(row);

        var inToken = false;
        if (column > 0)
            inToken = !!line.charAt(column - 1).match(this.tokenRe);

        if (!inToken)
            inToken = !!line.charAt(column).match(this.tokenRe);

        if (inToken)
            var re = this.tokenRe;
        else if (/^\s+$/.test(line.slice(column-1, column+1)))
            var re = /\s/;
        else
            var re = this.nonTokenRe;

        var start = column;
        if (start > 0) {
            do {
                start--;
            }
            while (start >= 0 && line.charAt(start).match(re));
            start++;
        }

        var end = column;
        while (end < line.length && line.charAt(end).match(re)) {
            end++;
        }

        return new Range(row, start, row, end);
    };
    this.getAWordRange = function(row, column) {
        var wordRange = this.getWordRange(row, column);
        var line = this.getLine(wordRange.end.row);

        while (line.charAt(wordRange.end.column).match(/[ \t]/)) {
            wordRange.end.column += 1;
        }
        return wordRange;
    };
    this.setNewLineMode = function(newLineMode) {
        this.doc.setNewLineMode(newLineMode);
    };
    this.getNewLineMode = function() {
        return this.doc.getNewLineMode();
    };
    this.setUseWorker = function(useWorker) { this.setOption("useWorker", useWorker); };
    this.getUseWorker = function() { return this.$useWorker; };
    this.onReloadTokenizer = function(e) {
        var rows = e.data;
        this.bgTokenizer.start(rows.first);
        this._signal("tokenizerUpdate", e);
    };

    this.$modes = {};
    this.$mode = null;
    this.$modeId = null;
    this.setMode = function(mode, cb) {
        if (mode && typeof mode === "object") {
            if (mode.getTokenizer)
                return this.$onChangeMode(mode);
            var options = mode;
            var path = options.path;
        } else {
            path = mode || "ace/mode/text";
        }
        if (!this.$modes["ace/mode/text"])
            this.$modes["ace/mode/text"] = new TextMode();

        if (this.$modes[path] && !options) {
            this.$onChangeMode(this.$modes[path]);
            cb && cb();
            return;
        }
        this.$modeId = path;
        config.loadModule(["mode", path], function(m) {
            if (this.$modeId !== path)
                return cb && cb();
            if (this.$modes[path] && !options)
                return this.$onChangeMode(this.$modes[path]);
            if (m && m.Mode) {
                m = new m.Mode(options);
                if (!options) {
                    this.$modes[path] = m;
                    m.$id = path;
                }
                this.$onChangeMode(m);
                cb && cb();
            }
        }.bind(this));
        if (!this.$mode)
            this.$onChangeMode(this.$modes["ace/mode/text"], true);
    };

    this.$onChangeMode = function(mode, $isPlaceholder) {
        if (!$isPlaceholder)
            this.$modeId = mode.$id;
        if (this.$mode === mode) 
            return;

        this.$mode = mode;

        this.$stopWorker();

        if (this.$useWorker)
            this.$startWorker();

        var tokenizer = mode.getTokenizer();

        if(tokenizer.addEventListener !== undefined) {
            var onReloadTokenizer = this.onReloadTokenizer.bind(this);
            tokenizer.addEventListener("update", onReloadTokenizer);
        }

        if (!this.bgTokenizer) {
            this.bgTokenizer = new BackgroundTokenizer(tokenizer);
            var _self = this;
            this.bgTokenizer.addEventListener("update", function(e) {
                _self._signal("tokenizerUpdate", e);
            });
        } else {
            this.bgTokenizer.setTokenizer(tokenizer);
        }

        this.bgTokenizer.setDocument(this.getDocument());

        this.tokenRe = mode.tokenRe;
        this.nonTokenRe = mode.nonTokenRe;

        
        if (!$isPlaceholder) {
            this.$options.wrapMethod.set.call(this, this.$wrapMethod);
            this.$setFolding(mode.foldingRules);
            this.bgTokenizer.start(0);
            this._emit("changeMode");
        }
    };


    this.$stopWorker = function() {
        if (this.$worker)
            this.$worker.terminate();

        this.$worker = null;
    };

    this.$startWorker = function() {
        if (typeof Worker !== "undefined" && !require.noWorker) {
            try {
                this.$worker = this.$mode.createWorker(this);
            } catch (e) {
                console.log("Could not load worker");
                console.log(e);
                this.$worker = null;
            }
        }
        else
            this.$worker = null;
    };
    this.getMode = function() {
        return this.$mode;
    };

    this.$scrollTop = 0;
    this.setScrollTop = function(scrollTop) {
        if (this.$scrollTop === scrollTop || isNaN(scrollTop))
            return;

        this.$scrollTop = scrollTop;
        this._signal("changeScrollTop", scrollTop);
    };
    this.getScrollTop = function() {
        return this.$scrollTop;
    };

    this.$scrollLeft = 0;
    this.setScrollLeft = function(scrollLeft) {
        if (this.$scrollLeft === scrollLeft || isNaN(scrollLeft))
            return;

        this.$scrollLeft = scrollLeft;
        this._signal("changeScrollLeft", scrollLeft);
    };
    this.getScrollLeft = function() {
        return this.$scrollLeft;
    };
    this.getScreenWidth = function() {
        this.$computeWidth();
        if (this.lineWidgets) 
            return Math.max(this.getLineWidgetMaxWidth(), this.screenWidth);
        return this.screenWidth;
    };
    
    this.getLineWidgetMaxWidth = function() {
        if (this.lineWidgetsWidth != null) return this.lineWidgetsWidth;
        var width = 0;
        this.lineWidgets.forEach(function(w) {
            if (w && w.screenWidth > width)
                width = w.screenWidth;
        });
        return this.lineWidgetWidth = width;
    };

    this.$computeWidth = function(force) {
        if (this.$modified || force) {
            this.$modified = false;

            if (this.$useWrapMode)
                return this.screenWidth = this.$wrapLimit;

            var lines = this.doc.getAllLines();
            var cache = this.$rowLengthCache;
            var longestScreenLine = 0;
            var foldIndex = 0;
            var foldLine = this.$foldData[foldIndex];
            var foldStart = foldLine ? foldLine.start.row : Infinity;
            var len = lines.length;

            for (var i = 0; i < len; i++) {
                if (i > foldStart) {
                    i = foldLine.end.row + 1;
                    if (i >= len)
                        break;
                    foldLine = this.$foldData[foldIndex++];
                    foldStart = foldLine ? foldLine.start.row : Infinity;
                }

                if (cache[i] == null)
                    cache[i] = this.$getStringScreenWidth(lines[i])[0];

                if (cache[i] > longestScreenLine)
                    longestScreenLine = cache[i];
            }
            this.screenWidth = longestScreenLine;
        }
    };
    this.getLine = function(row) {
        return this.doc.getLine(row);
    };
    this.getLines = function(firstRow, lastRow) {
        return this.doc.getLines(firstRow, lastRow);
    };
    this.getLength = function() {
        return this.doc.getLength();
    };
    this.getTextRange = function(range) {
        return this.doc.getTextRange(range || this.selection.getRange());
    };
    this.insert = function(position, text) {
        return this.doc.insert(position, text);
    };
    this.remove = function(range) {
        return this.doc.remove(range);
    };
    this.undoChanges = function(deltas, dontSelect) {
        if (!deltas.length)
            return;

        this.$fromUndo = true;
        var lastUndoRange = null;
        for (var i = deltas.length - 1; i != -1; i--) {
            var delta = deltas[i];
            if (delta.group == "doc") {
                this.doc.revertDeltas(delta.deltas);
                lastUndoRange =
                    this.$getUndoSelection(delta.deltas, true, lastUndoRange);
            } else {
                delta.deltas.forEach(function(foldDelta) {
                    this.addFolds(foldDelta.folds);
                }, this);
            }
        }
        this.$fromUndo = false;
        lastUndoRange &&
            this.$undoSelect &&
            !dontSelect &&
            this.selection.setSelectionRange(lastUndoRange);
        return lastUndoRange;
    };
    this.redoChanges = function(deltas, dontSelect) {
        if (!deltas.length)
            return;

        this.$fromUndo = true;
        var lastUndoRange = null;
        for (var i = 0; i < deltas.length; i++) {
            var delta = deltas[i];
            if (delta.group == "doc") {
                this.doc.applyDeltas(delta.deltas);
                lastUndoRange =
                    this.$getUndoSelection(delta.deltas, false, lastUndoRange);
            }
        }
        this.$fromUndo = false;
        lastUndoRange &&
            this.$undoSelect &&
            !dontSelect &&
            this.selection.setSelectionRange(lastUndoRange);
        return lastUndoRange;
    };
    this.setUndoSelect = function(enable) {
        this.$undoSelect = enable;
    };

    this.$getUndoSelection = function(deltas, isUndo, lastUndoRange) {
        function isInsert(delta) {
            var insert =
                delta.action === "insertText" || delta.action === "insertLines";
            return isUndo ? !insert : insert;
        }

        var delta = deltas[0];
        var range, point;
        var lastDeltaIsInsert = false;
        if (isInsert(delta)) {
            range = Range.fromPoints(delta.range.start, delta.range.end);
            lastDeltaIsInsert = true;
        } else {
            range = Range.fromPoints(delta.range.start, delta.range.start);
            lastDeltaIsInsert = false;
        }

        for (var i = 1; i < deltas.length; i++) {
            delta = deltas[i];
            if (isInsert(delta)) {
                point = delta.range.start;
                if (range.compare(point.row, point.column) == -1) {
                    range.setStart(delta.range.start);
                }
                point = delta.range.end;
                if (range.compare(point.row, point.column) == 1) {
                    range.setEnd(delta.range.end);
                }
                lastDeltaIsInsert = true;
            } else {
                point = delta.range.start;
                if (range.compare(point.row, point.column) == -1) {
                    range =
                        Range.fromPoints(delta.range.start, delta.range.start);
                }
                lastDeltaIsInsert = false;
            }
        }
        if (lastUndoRange != null) {
            if (Range.comparePoints(lastUndoRange.start, range.start) === 0) {
                lastUndoRange.start.column += range.end.column - range.start.column;
                lastUndoRange.end.column += range.end.column - range.start.column;
            }

            var cmp = lastUndoRange.compareRange(range);
            if (cmp == 1) {
                range.setStart(lastUndoRange.start);
            } else if (cmp == -1) {
                range.setEnd(lastUndoRange.end);
            }
        }

        return range;
    };
    this.replace = function(range, text) {
        return this.doc.replace(range, text);
    };
    this.moveText = function(fromRange, toPosition, copy) {
        var text = this.getTextRange(fromRange);
        var folds = this.getFoldsInRange(fromRange);

        var toRange = Range.fromPoints(toPosition, toPosition);
        if (!copy) {
            this.remove(fromRange);
            var rowDiff = fromRange.start.row - fromRange.end.row;
            var collDiff = rowDiff ? -fromRange.end.column : fromRange.start.column - fromRange.end.column;
            if (collDiff) {
                if (toRange.start.row == fromRange.end.row && toRange.start.column > fromRange.end.column)
                    toRange.start.column += collDiff;
                if (toRange.end.row == fromRange.end.row && toRange.end.column > fromRange.end.column)
                    toRange.end.column += collDiff;
            }
            if (rowDiff && toRange.start.row >= fromRange.end.row) {
                toRange.start.row += rowDiff;
                toRange.end.row += rowDiff;
            }
        }

        toRange.end = this.insert(toRange.start, text);
        if (folds.length) {
            var oldStart = fromRange.start;
            var newStart = toRange.start;
            var rowDiff = newStart.row - oldStart.row;
            var collDiff = newStart.column - oldStart.column;
            this.addFolds(folds.map(function(x) {
                x = x.clone();
                if (x.start.row == oldStart.row)
                    x.start.column += collDiff;
                if (x.end.row == oldStart.row)
                    x.end.column += collDiff;
                x.start.row += rowDiff;
                x.end.row += rowDiff;
                return x;
            }));
        }

        return toRange;
    };
    this.indentRows = function(startRow, endRow, indentString) {
        indentString = indentString.replace(/\t/g, this.getTabString());
        for (var row=startRow; row<=endRow; row++)
            this.insert({row: row, column:0}, indentString);
    };
    this.outdentRows = function (range) {
        var rowRange = range.collapseRows();
        var deleteRange = new Range(0, 0, 0, 0);
        var size = this.getTabSize();

        for (var i = rowRange.start.row; i <= rowRange.end.row; ++i) {
            var line = this.getLine(i);

            deleteRange.start.row = i;
            deleteRange.end.row = i;
            for (var j = 0; j < size; ++j)
                if (line.charAt(j) != ' ')
                    break;
            if (j < size && line.charAt(j) == '\t') {
                deleteRange.start.column = j;
                deleteRange.end.column = j + 1;
            } else {
                deleteRange.start.column = 0;
                deleteRange.end.column = j;
            }
            this.remove(deleteRange);
        }
    };

    this.$moveLines = function(firstRow, lastRow, dir) {
        firstRow = this.getRowFoldStart(firstRow);
        lastRow = this.getRowFoldEnd(lastRow);
        if (dir < 0) {
            var row = this.getRowFoldStart(firstRow + dir);
            if (row < 0) return 0;
            var diff = row-firstRow;
        } else if (dir > 0) {
            var row = this.getRowFoldEnd(lastRow + dir);
            if (row > this.doc.getLength()-1) return 0;
            var diff = row-lastRow;
        } else {
            firstRow = this.$clipRowToDocument(firstRow);
            lastRow = this.$clipRowToDocument(lastRow);
            var diff = lastRow - firstRow + 1;
        }

        var range = new Range(firstRow, 0, lastRow, Number.MAX_VALUE);
        var folds = this.getFoldsInRange(range).map(function(x){
            x = x.clone();
            x.start.row += diff;
            x.end.row += diff;
            return x;
        });

        var lines = dir == 0
            ? this.doc.getLines(firstRow, lastRow)
            : this.doc.removeLines(firstRow, lastRow);
        this.doc.insertLines(firstRow+diff, lines);
        folds.length && this.addFolds(folds);
        return diff;
    };
    this.moveLinesUp = function(firstRow, lastRow) {
        return this.$moveLines(firstRow, lastRow, -1);
    };
    this.moveLinesDown = function(firstRow, lastRow) {
        return this.$moveLines(firstRow, lastRow, 1);
    };
    this.duplicateLines = function(firstRow, lastRow) {
        return this.$moveLines(firstRow, lastRow, 0);
    };


    this.$clipRowToDocument = function(row) {
        return Math.max(0, Math.min(row, this.doc.getLength()-1));
    };

    this.$clipColumnToRow = function(row, column) {
        if (column < 0)
            return 0;
        return Math.min(this.doc.getLine(row).length, column);
    };


    this.$clipPositionToDocument = function(row, column) {
        column = Math.max(0, column);

        if (row < 0) {
            row = 0;
            column = 0;
        } else {
            var len = this.doc.getLength();
            if (row >= len) {
                row = len - 1;
                column = this.doc.getLine(len-1).length;
            } else {
                column = Math.min(this.doc.getLine(row).length, column);
            }
        }

        return {
            row: row,
            column: column
        };
    };

    this.$clipRangeToDocument = function(range) {
        if (range.start.row < 0) {
            range.start.row = 0;
            range.start.column = 0;
        } else {
            range.start.column = this.$clipColumnToRow(
                range.start.row,
                range.start.column
            );
        }

        var len = this.doc.getLength() - 1;
        if (range.end.row > len) {
            range.end.row = len;
            range.end.column = this.doc.getLine(len).length;
        } else {
            range.end.column = this.$clipColumnToRow(
                range.end.row,
                range.end.column
            );
        }
        return range;
    };
    this.$wrapLimit = 80;
    this.$useWrapMode = false;
    this.$wrapLimitRange = {
        min : null,
        max : null
    };
    this.setUseWrapMode = function(useWrapMode) {
        if (useWrapMode != this.$useWrapMode) {
            this.$useWrapMode = useWrapMode;
            this.$modified = true;
            this.$resetRowCache(0);
            if (useWrapMode) {
                var len = this.getLength();
                this.$wrapData = Array(len);
                this.$updateWrapData(0, len - 1);
            }

            this._signal("changeWrapMode");
        }
    };
    this.getUseWrapMode = function() {
        return this.$useWrapMode;
    };
    this.setWrapLimitRange = function(min, max) {
        if (this.$wrapLimitRange.min !== min || this.$wrapLimitRange.max !== max) {
            this.$wrapLimitRange = {
                min: min,
                max: max
            };
            this.$modified = true;
            this._signal("changeWrapMode");
        }
    };
    this.adjustWrapLimit = function(desiredLimit, $printMargin) {
        var limits = this.$wrapLimitRange
        if (limits.max < 0)
            limits = {min: $printMargin, max: $printMargin};
        var wrapLimit = this.$constrainWrapLimit(desiredLimit, limits.min, limits.max);
        if (wrapLimit != this.$wrapLimit && wrapLimit > 1) {
            this.$wrapLimit = wrapLimit;
            this.$modified = true;
            if (this.$useWrapMode) {
                this.$updateWrapData(0, this.getLength() - 1);
                this.$resetRowCache(0);
                this._signal("changeWrapLimit");
            }
            return true;
        }
        return false;
    };

    this.$constrainWrapLimit = function(wrapLimit, min, max) {
        if (min)
            wrapLimit = Math.max(min, wrapLimit);

        if (max)
            wrapLimit = Math.min(max, wrapLimit);

        return wrapLimit;
    };
    this.getWrapLimit = function() {
        return this.$wrapLimit;
    };
    this.setWrapLimit = function (limit) {
        this.setWrapLimitRange(limit, limit);
    };
    this.getWrapLimitRange = function() {
        return {
            min : this.$wrapLimitRange.min,
            max : this.$wrapLimitRange.max
        };
    };

    this.$updateInternalDataOnChange = function(e) {
        var useWrapMode = this.$useWrapMode;
        var len;
        var action = e.data.action;
        var firstRow = e.data.range.start.row;
        var lastRow = e.data.range.end.row;
        var start = e.data.range.start;
        var end = e.data.range.end;
        var removedFolds = null;

        if (action.indexOf("Lines") != -1) {
            if (action == "insertLines") {
                lastRow = firstRow + (e.data.lines.length);
            } else {
                lastRow = firstRow;
            }
            len = e.data.lines ? e.data.lines.length : lastRow - firstRow;
        } else {
            len = lastRow - firstRow;
        }

        this.$updating = true;
        if (len != 0) {
            if (action.indexOf("remove") != -1) {
                this[useWrapMode ? "$wrapData" : "$rowLengthCache"].splice(firstRow, len);

                var foldLines = this.$foldData;
                removedFolds = this.getFoldsInRange(e.data.range);
                this.removeFolds(removedFolds);

                var foldLine = this.getFoldLine(end.row);
                var idx = 0;
                if (foldLine) {
                    foldLine.addRemoveChars(end.row, end.column, start.column - end.column);
                    foldLine.shiftRow(-len);

                    var foldLineBefore = this.getFoldLine(firstRow);
                    if (foldLineBefore && foldLineBefore !== foldLine) {
                        foldLineBefore.merge(foldLine);
                        foldLine = foldLineBefore;
                    }
                    idx = foldLines.indexOf(foldLine) + 1;
                }

                for (idx; idx < foldLines.length; idx++) {
                    var foldLine = foldLines[idx];
                    if (foldLine.start.row >= end.row) {
                        foldLine.shiftRow(-len);
                    }
                }

                lastRow = firstRow;
            } else {
                var args = Array(len);
                args.unshift(firstRow, 0);
                var arr = useWrapMode ? this.$wrapData : this.$rowLengthCache
                arr.splice.apply(arr, args);
                var foldLines = this.$foldData;
                var foldLine = this.getFoldLine(firstRow);
                var idx = 0;
                if (foldLine) {
                    var cmp = foldLine.range.compareInside(start.row, start.column)
                    if (cmp == 0) {
                        foldLine = foldLine.split(start.row, start.column);
                        foldLine.shiftRow(len);
                        foldLine.addRemoveChars(
                            lastRow, 0, end.column - start.column);
                    } else
                    if (cmp == -1) {
                        foldLine.addRemoveChars(firstRow, 0, end.column - start.column);
                        foldLine.shiftRow(len);
                    }
                    idx = foldLines.indexOf(foldLine) + 1;
                }

                for (idx; idx < foldLines.length; idx++) {
                    var foldLine = foldLines[idx];
                    if (foldLine.start.row >= firstRow) {
                        foldLine.shiftRow(len);
                    }
                }
            }
        } else {
            len = Math.abs(e.data.range.start.column - e.data.range.end.column);
            if (action.indexOf("remove") != -1) {
                removedFolds = this.getFoldsInRange(e.data.range);
                this.removeFolds(removedFolds);

                len = -len;
            }
            var foldLine = this.getFoldLine(firstRow);
            if (foldLine) {
                foldLine.addRemoveChars(firstRow, start.column, len);
            }
        }

        if (useWrapMode && this.$wrapData.length != this.doc.getLength()) {
            console.error("doc.getLength() and $wrapData.length have to be the same!");
        }
        this.$updating = false;

        if (useWrapMode)
            this.$updateWrapData(firstRow, lastRow);
        else
            this.$updateRowLengthCache(firstRow, lastRow);

        return removedFolds;
    };

    this.$updateRowLengthCache = function(firstRow, lastRow, b) {
        this.$rowLengthCache[firstRow] = null;
        this.$rowLengthCache[lastRow] = null;
    };

    this.$updateWrapData = function(firstRow, lastRow) {
        var lines = this.doc.getAllLines();
        var tabSize = this.getTabSize();
        var wrapData = this.$wrapData;
        var wrapLimit = this.$wrapLimit;
        var tokens;
        var foldLine;

        var row = firstRow;
        lastRow = Math.min(lastRow, lines.length - 1);
        while (row <= lastRow) {
            foldLine = this.getFoldLine(row, foldLine);
            if (!foldLine) {
                tokens = this.$getDisplayTokens(lines[row]);
                wrapData[row] = this.$computeWrapSplits(tokens, wrapLimit, tabSize);
                row ++;
            } else {
                tokens = [];
                foldLine.walk(function(placeholder, row, column, lastColumn) {
                        var walkTokens;
                        if (placeholder != null) {
                            walkTokens = this.$getDisplayTokens(
                                            placeholder, tokens.length);
                            walkTokens[0] = PLACEHOLDER_START;
                            for (var i = 1; i < walkTokens.length; i++) {
                                walkTokens[i] = PLACEHOLDER_BODY;
                            }
                        } else {
                            walkTokens = this.$getDisplayTokens(
                                lines[row].substring(lastColumn, column),
                                tokens.length);
                        }
                        tokens = tokens.concat(walkTokens);
                    }.bind(this),
                    foldLine.end.row,
                    lines[foldLine.end.row].length + 1
                );

                wrapData[foldLine.start.row] = this.$computeWrapSplits(tokens, wrapLimit, tabSize);
                row = foldLine.end.row + 1;
            }
        }
    };
    var CHAR = 1,
        CHAR_EXT = 2,
        PLACEHOLDER_START = 3,
        PLACEHOLDER_BODY =  4,
        PUNCTUATION = 9,
        SPACE = 10,
        TAB = 11,
        TAB_SPACE = 12;


    this.$computeWrapSplits = function(tokens, wrapLimit) {
        if (tokens.length == 0) {
            return [];
        }

        var splits = [];
        var displayLength = tokens.length;
        var lastSplit = 0, lastDocSplit = 0;

        var isCode = this.$wrapAsCode;

        function addSplit(screenPos) {
            var displayed = tokens.slice(lastSplit, screenPos);
            var len = displayed.length;
            displayed.join("").
                replace(/12/g, function() {
                    len -= 1;
                }).
                replace(/2/g, function() {
                    len -= 1;
                });

            lastDocSplit += len;
            splits.push(lastDocSplit);
            lastSplit = screenPos;
        }

        while (displayLength - lastSplit > wrapLimit) {
            var split = lastSplit + wrapLimit;
            if (tokens[split - 1] >= SPACE && tokens[split] >= SPACE) {
                addSplit(split);
                continue;
            }
            if (tokens[split] == PLACEHOLDER_START || tokens[split] == PLACEHOLDER_BODY) {
                for (split; split != lastSplit - 1; split--) {
                    if (tokens[split] == PLACEHOLDER_START) {
                        break;
                    }
                }
                if (split > lastSplit) {
                    addSplit(split);
                    continue;
                }
                split = lastSplit + wrapLimit;
                for (split; split < tokens.length; split++) {
                    if (tokens[split] != PLACEHOLDER_BODY) {
                        break;
                    }
                }
                if (split == tokens.length) {
                    break;  // Breaks the while-loop.
                }
                addSplit(split);
                continue;
            }
            var minSplit = Math.max(split - (isCode ? 10 : wrapLimit-(wrapLimit>>2)), lastSplit - 1);
            while (split > minSplit && tokens[split] < PLACEHOLDER_START) {
                split --;
            }
            if (isCode) {
                while (split > minSplit && tokens[split] < PLACEHOLDER_START) {
                    split --;
                }
                while (split > minSplit && tokens[split] == PUNCTUATION) {
                    split --;
                }
            } else {
                while (split > minSplit && tokens[split] < SPACE) {
                    split --;
                }
            }
            if (split > minSplit) {
                addSplit(++split);
                continue;
            }
            split = lastSplit + wrapLimit;
            addSplit(split);
        }
        return splits;
    };
    this.$getDisplayTokens = function(str, offset) {
        var arr = [];
        var tabSize;
        offset = offset || 0;

        for (var i = 0; i < str.length; i++) {
            var c = str.charCodeAt(i);
            if (c == 9) {
                tabSize = this.getScreenTabSize(arr.length + offset);
                arr.push(TAB);
                for (var n = 1; n < tabSize; n++) {
                    arr.push(TAB_SPACE);
                }
            }
            else if (c == 32) {
                arr.push(SPACE);
            } else if((c > 39 && c < 48) || (c > 57 && c < 64)) {
                arr.push(PUNCTUATION);
            }
            else if (c >= 0x1100 && isFullWidth(c)) {
                arr.push(CHAR, CHAR_EXT);
            } else {
                arr.push(CHAR);
            }
        }
        return arr;
    };
    this.$getStringScreenWidth = function(str, maxScreenColumn, screenColumn) {
        if (maxScreenColumn == 0)
            return [0, 0];
        if (maxScreenColumn == null)
            maxScreenColumn = Infinity;
        screenColumn = screenColumn || 0;

        var c, column;
        for (column = 0; column < str.length; column++) {
            c = str.charCodeAt(column);
            if (c == 9) {
                screenColumn += this.getScreenTabSize(screenColumn);
            }
            else if (c >= 0x1100 && isFullWidth(c)) {
                screenColumn += 2;
            } else {
                screenColumn += 1;
            }
            if (screenColumn > maxScreenColumn) {
                break;
            }
        }

        return [screenColumn, column];
    };

    this.lineWidgets = null;
    this.getRowLength = function(row) {
        if (this.lineWidgets)
            var h = this.lineWidgets[row] && this.lineWidgets[row].rowCount || 0;
        else 
            h = 0
        if (!this.$useWrapMode || !this.$wrapData[row]) {
            return 1 + h;
        } else {
            return this.$wrapData[row].length + 1 + h;
        }
    };
    this.getRowLineCount = function(row) {
        if (!this.$useWrapMode || !this.$wrapData[row]) {
            return 1;
        } else {
            return this.$wrapData[row].length + 1;
        }
    };
    this.getScreenLastRowColumn = function(screenRow) {
        var pos = this.screenToDocumentPosition(screenRow, Number.MAX_VALUE);
        return this.documentToScreenColumn(pos.row, pos.column);
    };
    this.getDocumentLastRowColumn = function(docRow, docColumn) {
        var screenRow = this.documentToScreenRow(docRow, docColumn);
        return this.getScreenLastRowColumn(screenRow);
    };
    this.getDocumentLastRowColumnPosition = function(docRow, docColumn) {
        var screenRow = this.documentToScreenRow(docRow, docColumn);
        return this.screenToDocumentPosition(screenRow, Number.MAX_VALUE / 10);
    };
    this.getRowSplitData = function(row) {
        if (!this.$useWrapMode) {
            return undefined;
        } else {
            return this.$wrapData[row];
        }
    };
    this.getScreenTabSize = function(screenColumn) {
        return this.$tabSize - screenColumn % this.$tabSize;
    };


    this.screenToDocumentRow = function(screenRow, screenColumn) {
        return this.screenToDocumentPosition(screenRow, screenColumn).row;
    };


    this.screenToDocumentColumn = function(screenRow, screenColumn) {
        return this.screenToDocumentPosition(screenRow, screenColumn).column;
    };
    this.screenToDocumentPosition = function(screenRow, screenColumn) {
        if (screenRow < 0)
            return {row: 0, column: 0};

        var line;
        var docRow = 0;
        var docColumn = 0;
        var column;
        var row = 0;
        var rowLength = 0;

        var rowCache = this.$screenRowCache;
        var i = this.$getRowCacheIndex(rowCache, screenRow);
        var l = rowCache.length;
        if (l && i >= 0) {
            var row = rowCache[i];
            var docRow = this.$docRowCache[i];
            var doCache = screenRow > rowCache[l - 1];
        } else {
            var doCache = !l;
        }

        var maxRow = this.getLength() - 1;
        var foldLine = this.getNextFoldLine(docRow);
        var foldStart = foldLine ? foldLine.start.row : Infinity;

        while (row <= screenRow) {
            rowLength = this.getRowLength(docRow);
            if (row + rowLength > screenRow || docRow >= maxRow) {
                break;
            } else {
                row += rowLength;
                docRow++;
                if (docRow > foldStart) {
                    docRow = foldLine.end.row+1;
                    foldLine = this.getNextFoldLine(docRow, foldLine);
                    foldStart = foldLine ? foldLine.start.row : Infinity;
                }
            }

            if (doCache) {
                this.$docRowCache.push(docRow);
                this.$screenRowCache.push(row);
            }
        }

        if (foldLine && foldLine.start.row <= docRow) {
            line = this.getFoldDisplayLine(foldLine);
            docRow = foldLine.start.row;
        } else if (row + rowLength <= screenRow || docRow > maxRow) {
            return {
                row: maxRow,
                column: this.getLine(maxRow).length
            }
        } else {
            line = this.getLine(docRow);
            foldLine = null;
        }

        if (this.$useWrapMode) {
            var splits = this.$wrapData[docRow];
            if (splits) {
                var splitIndex = Math.floor(screenRow - row);
                column = splits[splitIndex];
                if(splitIndex > 0 && splits.length) {
                    docColumn = splits[splitIndex - 1] || splits[splits.length - 1];
                    line = line.substring(docColumn);
                }
            }
        }

        docColumn += this.$getStringScreenWidth(line, screenColumn)[1];
        if (this.$useWrapMode && docColumn >= column)
            docColumn = column - 1;

        if (foldLine)
            return foldLine.idxToPosition(docColumn);

        return {row: docRow, column: docColumn};
    };
    this.documentToScreenPosition = function(docRow, docColumn) {
        if (typeof docColumn === "undefined")
            var pos = this.$clipPositionToDocument(docRow.row, docRow.column);
        else
            pos = this.$clipPositionToDocument(docRow, docColumn);

        docRow = pos.row;
        docColumn = pos.column;

        var screenRow = 0;
        var foldStartRow = null;
        var fold = null;
        fold = this.getFoldAt(docRow, docColumn, 1);
        if (fold) {
            docRow = fold.start.row;
            docColumn = fold.start.column;
        }

        var rowEnd, row = 0;


        var rowCache = this.$docRowCache;
        var i = this.$getRowCacheIndex(rowCache, docRow);
        var l = rowCache.length;
        if (l && i >= 0) {
            var row = rowCache[i];
            var screenRow = this.$screenRowCache[i];
            var doCache = docRow > rowCache[l - 1];
        } else {
            var doCache = !l;
        }

        var foldLine = this.getNextFoldLine(row);
        var foldStart = foldLine ?foldLine.start.row :Infinity;

        while (row < docRow) {
            if (row >= foldStart) {
                rowEnd = foldLine.end.row + 1;
                if (rowEnd > docRow)
                    break;
                foldLine = this.getNextFoldLine(rowEnd, foldLine);
                foldStart = foldLine ?foldLine.start.row :Infinity;
            }
            else {
                rowEnd = row + 1;
            }

            screenRow += this.getRowLength(row);
            row = rowEnd;

            if (doCache) {
                this.$docRowCache.push(row);
                this.$screenRowCache.push(screenRow);
            }
        }
        var textLine = "";
        if (foldLine && row >= foldStart) {
            textLine = this.getFoldDisplayLine(foldLine, docRow, docColumn);
            foldStartRow = foldLine.start.row;
        } else {
            textLine = this.getLine(docRow).substring(0, docColumn);
            foldStartRow = docRow;
        }
        if (this.$useWrapMode) {
            var wrapRow = this.$wrapData[foldStartRow];
            if (wrapRow) {
                var screenRowOffset = 0;
                while (textLine.length >= wrapRow[screenRowOffset]) {
                    screenRow ++;
                    screenRowOffset++;
                }
                textLine = textLine.substring(
                    wrapRow[screenRowOffset - 1] || 0, textLine.length
                );
            }
        }

        return {
            row: screenRow,
            column: this.$getStringScreenWidth(textLine)[0]
        };
    };
    this.documentToScreenColumn = function(row, docColumn) {
        return this.documentToScreenPosition(row, docColumn).column;
    };
    this.documentToScreenRow = function(docRow, docColumn) {
        return this.documentToScreenPosition(docRow, docColumn).row;
    };
    this.getScreenLength = function() {
        var screenRows = 0;
        var fold = null;
        if (!this.$useWrapMode) {
            screenRows = this.getLength();
            var foldData = this.$foldData;
            for (var i = 0; i < foldData.length; i++) {
                fold = foldData[i];
                screenRows -= fold.end.row - fold.start.row;
            }
        } else {
            var lastRow = this.$wrapData.length;
            var row = 0, i = 0;
            var fold = this.$foldData[i++];
            var foldStart = fold ? fold.start.row :Infinity;

            while (row < lastRow) {
                var splits = this.$wrapData[row];
                screenRows += splits ? splits.length + 1 : 1;
                row ++;
                if (row > foldStart) {
                    row = fold.end.row+1;
                    fold = this.$foldData[i++];
                    foldStart = fold ?fold.start.row :Infinity;
                }
            }
        }
        if (this.lineWidgets)
            screenRows += this.$getWidgetScreenLength();

        return screenRows;
    };
    this.$setFontMetrics = function(fm) {
    }
    function isFullWidth(c) {
        if (c < 0x1100)
            return false;
        return c >= 0x1100 && c <= 0x115F ||
               c >= 0x11A3 && c <= 0x11A7 ||
               c >= 0x11FA && c <= 0x11FF ||
               c >= 0x2329 && c <= 0x232A ||
               c >= 0x2E80 && c <= 0x2E99 ||
               c >= 0x2E9B && c <= 0x2EF3 ||
               c >= 0x2F00 && c <= 0x2FD5 ||
               c >= 0x2FF0 && c <= 0x2FFB ||
               c >= 0x3000 && c <= 0x303E ||
               c >= 0x3041 && c <= 0x3096 ||
               c >= 0x3099 && c <= 0x30FF ||
               c >= 0x3105 && c <= 0x312D ||
               c >= 0x3131 && c <= 0x318E ||
               c >= 0x3190 && c <= 0x31BA ||
               c >= 0x31C0 && c <= 0x31E3 ||
               c >= 0x31F0 && c <= 0x321E ||
               c >= 0x3220 && c <= 0x3247 ||
               c >= 0x3250 && c <= 0x32FE ||
               c >= 0x3300 && c <= 0x4DBF ||
               c >= 0x4E00 && c <= 0xA48C ||
               c >= 0xA490 && c <= 0xA4C6 ||
               c >= 0xA960 && c <= 0xA97C ||
               c >= 0xAC00 && c <= 0xD7A3 ||
               c >= 0xD7B0 && c <= 0xD7C6 ||
               c >= 0xD7CB && c <= 0xD7FB ||
               c >= 0xF900 && c <= 0xFAFF ||
               c >= 0xFE10 && c <= 0xFE19 ||
               c >= 0xFE30 && c <= 0xFE52 ||
               c >= 0xFE54 && c <= 0xFE66 ||
               c >= 0xFE68 && c <= 0xFE6B ||
               c >= 0xFF01 && c <= 0xFF60 ||
               c >= 0xFFE0 && c <= 0xFFE6;
    };

}).call(EditSession.prototype);

require("./edit_session/folding").Folding.call(EditSession.prototype);
require("./edit_session/bracket_match").BracketMatch.call(EditSession.prototype);


config.defineOptions(EditSession.prototype, "session", {
    wrap: {
        set: function(value) {
            if (!value || value == "off")
                value = false;
            else if (value == "free")
                value = true;
            else if (value == "printMargin")
                value = -1;
            else if (typeof value == "string")
                value = parseInt(value, 10) || false;

            if (this.$wrap == value)
                return;
            if (!value) {
                this.setUseWrapMode(false);
            } else {
                var col = typeof value == "number" ? value : null;
                this.setWrapLimitRange(col, col);
                this.setUseWrapMode(true);
            }
            this.$wrap = value;
        },
        get: function() {
            if (this.getUseWrapMode()) {
                if (this.$wrap == -1)
                    return "printMargin";
                if (!this.getWrapLimitRange().min)
                    return "free";
                return this.$wrap;
            }
            return "off";
        },
        handlesSet: true
    },    
    wrapMethod: {
        set: function(val) {
            val = val == "auto"
                ? this.$mode.type != "text"
                : val != "text";
            if (val != this.$wrapAsCode) {
                this.$wrapAsCode = val;
                if (this.$useWrapMode) {
                    this.$modified = true;
                    this.$resetRowCache(0);
                    this.$updateWrapData(0, this.getLength() - 1);
                }
            }
        },
        initialValue: "auto"
    },
    firstLineNumber: {
        set: function() {this._signal("changeBreakpoint");},
        initialValue: 1
    },
    useWorker: {
        set: function(useWorker) {
            this.$useWorker = useWorker;

            this.$stopWorker();
            if (useWorker)
                this.$startWorker();
        },
        initialValue: true
    },
    useSoftTabs: {initialValue: true},
    tabSize: {
        set: function(tabSize) {
            if (isNaN(tabSize) || this.$tabSize === tabSize) return;

            this.$modified = true;
            this.$rowLengthCache = [];
            this.$tabSize = tabSize;
            this._signal("changeTabSize");
        },
        initialValue: 4,
        handlesSet: true
    },
    overwrite: {
        set: function(val) {this._signal("changeOverwrite");},
        initialValue: false
    },
    newLineMode: {
        set: function(val) {this.doc.setNewLineMode(val)},
        get: function() {return this.doc.getNewLineMode()},
        handlesSet: true
    },
    mode: {
        set: function(val) { this.setMode(val) },
        get: function() { return this.$modeId }
    }
});

exports.EditSession = EditSession;
});
ace.define('ace/commands/command_manager', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/keyboard/hash_handler', 'ace/lib/event_emitter'], function(require, exports, module) {


var oop = require("../lib/oop");
var HashHandler = require("../keyboard/hash_handler").HashHandler;
var EventEmitter = require("../lib/event_emitter").EventEmitter;

var CommandManager = function(platform, commands) {
    HashHandler.call(this, commands, platform);
    this.byName = this.commands;
    this.setDefaultHandler("exec", function(e) {
        return e.command.exec(e.editor, e.args || {});
    });
};

oop.inherits(CommandManager, HashHandler);

(function() {

    oop.implement(this, EventEmitter);

    this.exec = function(command, editor, args) {
        if (typeof command === 'string')
            command = this.commands[command];

        if (!command)
            return false;

        if (editor && editor.$readOnly && !command.readOnly)
            return false;

        var e = {editor: editor, command: command, args: args};
        var retvalue = this._emit("exec", e);
        this._signal("afterExec", e);

        return retvalue === false ? false : true;
    };

    this.toggleRecording = function(editor) {
        if (this.$inReplay)
            return;

        editor && editor._emit("changeStatus");
        if (this.recording) {
            this.macro.pop();
            this.removeEventListener("exec", this.$addCommandToMacro);

            if (!this.macro.length)
                this.macro = this.oldMacro;

            return this.recording = false;
        }
        if (!this.$addCommandToMacro) {
            this.$addCommandToMacro = function(e) {
                this.macro.push([e.command, e.args]);
            }.bind(this);
        }

        this.oldMacro = this.macro;
        this.macro = [];
        this.on("exec", this.$addCommandToMacro);
        return this.recording = true;
    };

    this.replay = function(editor) {
        if (this.$inReplay || !this.macro)
            return;

        if (this.recording)
            return this.toggleRecording(editor);

        try {
            this.$inReplay = true;
            this.macro.forEach(function(x) {
                if (typeof x == "string")
                    this.exec(x, editor);
                else
                    this.exec(x[0], editor, x[1]);
            }, this);
        } finally {
            this.$inReplay = false;
        }
    };

    this.trimMacro = function(m) {
        return m.map(function(x){
            if (typeof x[0] != "string")
                x[0] = x[0].name;
            if (!x[1])
                x = x[0];
            return x;
        });
    };

}).call(CommandManager.prototype);

exports.CommandManager = CommandManager;

});

ace.define('ace/keyboard/keybinding', ['require', 'exports', 'module' , 'ace/lib/keys', 'ace/lib/event'], function(require, exports, module) {


var keyUtil  = require("../lib/keys");
var event = require("../lib/event");

var KeyBinding = function(editor) {
    this.$editor = editor;
    this.$data = {};
    this.$handlers = [];
    this.setDefaultHandler(editor.commands);
};

(function() {
    this.setDefaultHandler = function(kb) {
        this.removeKeyboardHandler(this.$defaultHandler);
        this.$defaultHandler = kb;
        this.addKeyboardHandler(kb, 0);
        this.$data = {editor: this.$editor};
    };

    this.setKeyboardHandler = function(kb) {
        var h = this.$handlers;
        if (h[h.length - 1] == kb)
            return;

        while (h[h.length - 1] && h[h.length - 1] != this.$defaultHandler)
            this.removeKeyboardHandler(h[h.length - 1]);

        this.addKeyboardHandler(kb, 1);
    };

    this.addKeyboardHandler = function(kb, pos) {
        if (!kb)
            return;
        if (typeof kb == "function" && !kb.handleKeyboard)
            kb.handleKeyboard = kb;
        var i = this.$handlers.indexOf(kb);
        if (i != -1)
            this.$handlers.splice(i, 1);

        if (pos == undefined)
            this.$handlers.push(kb);
        else
            this.$handlers.splice(pos, 0, kb);

        if (i == -1 && kb.attach)
            kb.attach(this.$editor);
    };

    this.removeKeyboardHandler = function(kb) {
        var i = this.$handlers.indexOf(kb);
        if (i == -1)
            return false;
        this.$handlers.splice(i, 1);
        kb.detach && kb.detach(this.$editor);
        return true;
    };

    this.getKeyboardHandler = function() {
        return this.$handlers[this.$handlers.length - 1];
    };

    this.$callKeyboardHandlers = function (hashId, keyString, keyCode, e) {
        var toExecute;
        var success = false;
        var commands = this.$editor.commands;

        for (var i = this.$handlers.length; i--;) {
            toExecute = this.$handlers[i].handleKeyboard(
                this.$data, hashId, keyString, keyCode, e
            );
            if (!toExecute || !toExecute.command)
                continue;
            if (toExecute.command == "null") {
                success = true;
            } else {
                success = commands.exec(toExecute.command, this.$editor, toExecute.args, e);                
            }
            if (success && e && hashId != -1 && 
                toExecute.passEvent != true && toExecute.command.passEvent != true
            ) {
                event.stopEvent(e);
            }
            if (success)
                break;
        }
        return success;
    };

    this.onCommandKey = function(e, hashId, keyCode) {
        var keyString = keyUtil.keyCodeToString(keyCode);
        this.$callKeyboardHandlers(hashId, keyString, keyCode, e);
    };

    this.onTextInput = function(text) {
        var success = this.$callKeyboardHandlers(-1, text);
        if (!success)
            this.$editor.commands.exec("insertstring", this.$editor, text);
    };

}).call(KeyBinding.prototype);

exports.KeyBinding = KeyBinding;
});

ace.define('ace/keyboard/hash_handler', ['require', 'exports', 'module' , 'ace/lib/keys', 'ace/lib/useragent'], function(require, exports, module) {


var keyUtil = require("../lib/keys");
var useragent = require("../lib/useragent");

function HashHandler(config, platform) {
    this.platform = platform || (useragent.isMac ? "mac" : "win");
    this.commands = {};
    this.commandKeyBinding = {};
    if (this.__defineGetter__ && this.__defineSetter__ && typeof console != "undefined" && console.error) {
        var warned = false;
        var warn = function() {
            if (!warned) {
                warned = true;
                console.error("commmandKeyBinding has too many m's. use commandKeyBinding");
            }
        };
        this.__defineGetter__("commmandKeyBinding", function() {
            warn();
            return this.commandKeyBinding;
        });
        this.__defineSetter__("commmandKeyBinding", function(val) {
            warn();
            return this.commandKeyBinding = val;
        });
    } else {
        this.commmandKeyBinding = this.commandKeyBinding;
    }

    this.addCommands(config);
};

(function() {

    this.addCommand = function(command) {
        if (this.commands[command.name])
            this.removeCommand(command);

        this.commands[command.name] = command;

        if (command.bindKey)
            this._buildKeyHash(command);
    };

    this.removeCommand = function(command) {
        var name = (typeof command === 'string' ? command : command.name);
        command = this.commands[name];
        delete this.commands[name];
        var ckb = this.commandKeyBinding;
        for (var hashId in ckb) {
            for (var key in ckb[hashId]) {
                if (ckb[hashId][key] == command)
                    delete ckb[hashId][key];
            }
        }
    };

    this.bindKey = function(key, command) {
        if(!key)
            return;
        if (typeof command == "function") {
            this.addCommand({exec: command, bindKey: key, name: command.name || key});
            return;
        }

        var ckb = this.commandKeyBinding;
        key.split("|").forEach(function(keyPart) {
            var binding = this.parseKeys(keyPart, command);
            var hashId = binding.hashId;
            (ckb[hashId] || (ckb[hashId] = {}))[binding.key] = command;
        }, this);
    };

    this.addCommands = function(commands) {
        commands && Object.keys(commands).forEach(function(name) {
            var command = commands[name];
            if (!command)
                return;
            
            if (typeof command === "string")
                return this.bindKey(command, name);

            if (typeof command === "function")
                command = { exec: command };

            if (typeof command !== "object")
                return;

            if (!command.name)
                command.name = name;

            this.addCommand(command);
        }, this);
    };

    this.removeCommands = function(commands) {
        Object.keys(commands).forEach(function(name) {
            this.removeCommand(commands[name]);
        }, this);
    };

    this.bindKeys = function(keyList) {
        Object.keys(keyList).forEach(function(key) {
            this.bindKey(key, keyList[key]);
        }, this);
    };

    this._buildKeyHash = function(command) {
        var binding = command.bindKey;
        if (!binding)
            return;

        var key = typeof binding == "string" ? binding: binding[this.platform];
        this.bindKey(key, command);
    };
    this.parseKeys = function(keys) {
        if (keys.indexOf(" ") != -1)
            keys = keys.split(/\s+/).pop();

        var parts = keys.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(x){return x});
        var key = parts.pop();

        var keyCode = keyUtil[key];
        if (keyUtil.FUNCTION_KEYS[keyCode])
            key = keyUtil.FUNCTION_KEYS[keyCode].toLowerCase();
        else if (!parts.length)
            return {key: key, hashId: -1};
        else if (parts.length == 1 && parts[0] == "shift")
            return {key: key.toUpperCase(), hashId: -1};

        var hashId = 0;
        for (var i = parts.length; i--;) {
            var modifier = keyUtil.KEY_MODS[parts[i]];
            if (modifier == null) {
                if (typeof console != "undefined")
                console.error("invalid modifier " + parts[i] + " in " + keys);
                return false;
            }
            hashId |= modifier;
        }
        return {key: key, hashId: hashId};
    };

    this.findKeyCommand = function findKeyCommand(hashId, keyString) {
        var ckbr = this.commandKeyBinding;
        return ckbr[hashId] && ckbr[hashId][keyString];
    };

    this.handleKeyboard = function(data, hashId, keyString, keyCode) {
        return {
            command: this.findKeyCommand(hashId, keyString)
        };
    };

}).call(HashHandler.prototype)

exports.HashHandler = HashHandler;
});

ace.define('ace/mouse/fold_handler', ['require', 'exports', 'module' ], function(require, exports, module) {


function FoldHandler(editor) {

    editor.on("click", function(e) {
        var position = e.getDocumentPosition();
        var session = editor.session;
        var fold = session.getFoldAt(position.row, position.column, 1);
        if (fold) {
            if (e.getAccelKey())
                session.removeFold(fold);
            else
                session.expandFold(fold);

            e.stop();
        }
    });

    editor.on("gutterclick", function(e) {
        var gutterRegion = editor.renderer.$gutterLayer.getRegion(e);

        if (gutterRegion == "foldWidgets") {
            var row = e.getDocumentPosition().row;
            var session = editor.session;
            if (session.foldWidgets && session.foldWidgets[row])
                editor.session.onFoldWidgetClick(row, e);
            if (!editor.isFocused())
                editor.focus();
            e.stop();
        }
    });

    editor.on("gutterdblclick", function(e) {
        var gutterRegion = editor.renderer.$gutterLayer.getRegion(e);

        if (gutterRegion == "foldWidgets") {
            var row = e.getDocumentPosition().row;
            var session = editor.session;
            var data = session.getParentFoldRangeData(row, true);
            var range = data.range || data.firstRange;

            if (range) {
                row = range.start.row;
                var fold = session.getFoldAt(row, session.getLine(row).length, 1);

                if (fold) {
                    session.removeFold(fold);
                } else {
                    session.addFold("...", range);
                    editor.renderer.scrollCursorIntoView({row: range.start.row, column: 0});
                }
            }
            e.stop();
        }
    });
}

exports.FoldHandler = FoldHandler;

});

ace.define('ace/commands/default_commands', ['require', 'exports', 'module' , 'ace/lib/lang', 'ace/config'], function(require, exports, module) {


var lang = require("../lib/lang");
var config = require("../config");

function bindKey(win, mac) {
    return {win: win, mac: mac};
}
exports.commands = [{
    name: "showSettingsMenu",
    bindKey: bindKey("Ctrl-,", "Command-,"),
    exec: function(editor) {
        config.loadModule("ace/ext/settings_menu", function(module) {
            module.init(editor);
            editor.showSettingsMenu();
        });
    },
    readOnly: true
}, {
    name: "goToNextError",
    bindKey: bindKey("Alt-E", "Ctrl-E"),
    exec: function(editor) {
        config.loadModule("ace/ext/error_marker", function(module) {
            module.showErrorMarker(editor, 1);
        });
    },
    scrollIntoView: "animate",
    readOnly: true
}, {
    name: "goToPreviousError",
    bindKey: bindKey("Alt-Shift-E", "Ctrl-Shift-E"),
    exec: function(editor) {
        config.loadModule("ace/ext/error_marker", function(module) {
            module.showErrorMarker(editor, -1);
        });
    },
    scrollIntoView: "animate",
    readOnly: true
}, {
    name: "selectall",
    bindKey: bindKey("Ctrl-A", "Command-A"),
    exec: function(editor) { editor.selectAll(); },
    readOnly: true
}, {
    name: "centerselection",
    bindKey: bindKey(null, "Ctrl-L"),
    exec: function(editor) { editor.centerSelection(); },
    readOnly: true
}, {
    name: "gotoline",
    bindKey: bindKey("Ctrl-L", "Command-L"),
    exec: function(editor) {
        var line = parseInt(prompt("Enter line number:"), 10);
        if (!isNaN(line)) {
            editor.gotoLine(line);
        }
    },
    readOnly: true
}, {
    name: "fold",
    bindKey: bindKey("Alt-L|Ctrl-F1", "Command-Alt-L|Command-F1"),
    exec: function(editor) { editor.session.toggleFold(false); },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "unfold",
    bindKey: bindKey("Alt-Shift-L|Ctrl-Shift-F1", "Command-Alt-Shift-L|Command-Shift-F1"),
    exec: function(editor) { editor.session.toggleFold(true); },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "toggleFoldWidget",
    bindKey: bindKey("F2", "F2"),
    exec: function(editor) { editor.session.toggleFoldWidget(); },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "toggleParentFoldWidget",
    bindKey: bindKey("Alt-F2", "Alt-F2"),
    exec: function(editor) { editor.session.toggleFoldWidget(true); },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "foldall",
    bindKey: bindKey("Ctrl-Alt-0", "Ctrl-Command-Option-0"),
    exec: function(editor) { editor.session.foldAll(); },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "foldOther",
    bindKey: bindKey("Alt-0", "Command-Option-0"),
    exec: function(editor) { 
        editor.session.foldAll();
        editor.session.unfold(editor.selection.getAllRanges());
    },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "unfoldall",
    bindKey: bindKey("Alt-Shift-0", "Command-Option-Shift-0"),
    exec: function(editor) { editor.session.unfold(); },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "findnext",
    bindKey: bindKey("Ctrl-K", "Command-G"),
    exec: function(editor) { editor.findNext(); },
    readOnly: true
}, {
    name: "findprevious",
    bindKey: bindKey("Ctrl-Shift-K", "Command-Shift-G"),
    exec: function(editor) { editor.findPrevious(); },
    readOnly: true
}, {
    name: "selectOrFindNext",
    bindKey: bindKey("ALt-K", "Ctrl-G"),
    exec: function(editor) {
        if (editor.selection.isEmpty())
            editor.selection.selectWord();
        else
            editor.findNext(); 
    },
    readOnly: true
}, {
    name: "selectOrFindPrevious",
    bindKey: bindKey("Alt-Shift-K", "Ctrl-Shift-G"),
    exec: function(editor) { 
        if (editor.selection.isEmpty())
            editor.selection.selectWord();
        else
            editor.findPrevious();
    },
    readOnly: true
}, {
    name: "find",
    bindKey: bindKey("Ctrl-F", "Command-F"),
    exec: function(editor) {
        config.loadModule("ace/ext/searchbox", function(e) {e.Search(editor)});
    },
    readOnly: true
}, {
    name: "overwrite",
    bindKey: "Insert",
    exec: function(editor) { editor.toggleOverwrite(); },
    readOnly: true
}, {
    name: "selecttostart",
    bindKey: bindKey("Ctrl-Shift-Home", "Command-Shift-Up"),
    exec: function(editor) { editor.getSelection().selectFileStart(); },
    multiSelectAction: "forEach",
    readOnly: true,
    scrollIntoView: "animate",
    aceCommandGroup: "fileJump"
}, {
    name: "gotostart",
    bindKey: bindKey("Ctrl-Home", "Command-Home|Command-Up"),
    exec: function(editor) { editor.navigateFileStart(); },
    multiSelectAction: "forEach",
    readOnly: true,
    scrollIntoView: "animate",
    aceCommandGroup: "fileJump"
}, {
    name: "selectup",
    bindKey: bindKey("Shift-Up", "Shift-Up"),
    exec: function(editor) { editor.getSelection().selectUp(); },
    multiSelectAction: "forEach",
    readOnly: true
}, {
    name: "golineup",
    bindKey: bindKey("Up", "Up|Ctrl-P"),
    exec: function(editor, args) { editor.navigateUp(args.times); },
    multiSelectAction: "forEach",
    readOnly: true
}, {
    name: "selecttoend",
    bindKey: bindKey("Ctrl-Shift-End", "Command-Shift-Down"),
    exec: function(editor) { editor.getSelection().selectFileEnd(); },
    multiSelectAction: "forEach",
    readOnly: true,
    scrollIntoView: "animate",
    aceCommandGroup: "fileJump"
}, {
    name: "gotoend",
    bindKey: bindKey("Ctrl-End", "Command-End|Command-Down"),
    exec: function(editor) { editor.navigateFileEnd(); },
    multiSelectAction: "forEach",
    readOnly: true,
    scrollIntoView: "animate",
    aceCommandGroup: "fileJump"
}, {
    name: "selectdown",
    bindKey: bindKey("Shift-Down", "Shift-Down"),
    exec: function(editor) { editor.getSelection().selectDown(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "golinedown",
    bindKey: bindKey("Down", "Down|Ctrl-N"),
    exec: function(editor, args) { editor.navigateDown(args.times); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectwordleft",
    bindKey: bindKey("Ctrl-Shift-Left", "Option-Shift-Left"),
    exec: function(editor) { editor.getSelection().selectWordLeft(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotowordleft",
    bindKey: bindKey("Ctrl-Left", "Option-Left"),
    exec: function(editor) { editor.navigateWordLeft(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selecttolinestart",
    bindKey: bindKey("Alt-Shift-Left", "Command-Shift-Left"),
    exec: function(editor) { editor.getSelection().selectLineStart(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotolinestart",
    bindKey: bindKey("Alt-Left|Home", "Command-Left|Home|Ctrl-A"),
    exec: function(editor) { editor.navigateLineStart(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectleft",
    bindKey: bindKey("Shift-Left", "Shift-Left"),
    exec: function(editor) { editor.getSelection().selectLeft(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotoleft",
    bindKey: bindKey("Left", "Left|Ctrl-B"),
    exec: function(editor, args) { editor.navigateLeft(args.times); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectwordright",
    bindKey: bindKey("Ctrl-Shift-Right", "Option-Shift-Right"),
    exec: function(editor) { editor.getSelection().selectWordRight(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotowordright",
    bindKey: bindKey("Ctrl-Right", "Option-Right"),
    exec: function(editor) { editor.navigateWordRight(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selecttolineend",
    bindKey: bindKey("Alt-Shift-Right", "Command-Shift-Right"),
    exec: function(editor) { editor.getSelection().selectLineEnd(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotolineend",
    bindKey: bindKey("Alt-Right|End", "Command-Right|End|Ctrl-E"),
    exec: function(editor) { editor.navigateLineEnd(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectright",
    bindKey: bindKey("Shift-Right", "Shift-Right"),
    exec: function(editor) { editor.getSelection().selectRight(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotoright",
    bindKey: bindKey("Right", "Right|Ctrl-F"),
    exec: function(editor, args) { editor.navigateRight(args.times); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectpagedown",
    bindKey: "Shift-PageDown",
    exec: function(editor) { editor.selectPageDown(); },
    readOnly: true
}, {
    name: "pagedown",
    bindKey: bindKey(null, "Option-PageDown"),
    exec: function(editor) { editor.scrollPageDown(); },
    readOnly: true
}, {
    name: "gotopagedown",
    bindKey: bindKey("PageDown", "PageDown|Ctrl-V"),
    exec: function(editor) { editor.gotoPageDown(); },
    readOnly: true
}, {
    name: "selectpageup",
    bindKey: "Shift-PageUp",
    exec: function(editor) { editor.selectPageUp(); },
    readOnly: true
}, {
    name: "pageup",
    bindKey: bindKey(null, "Option-PageUp"),
    exec: function(editor) { editor.scrollPageUp(); },
    readOnly: true
}, {
    name: "gotopageup",
    bindKey: "PageUp",
    exec: function(editor) { editor.gotoPageUp(); },
    readOnly: true
}, {
    name: "scrollup",
    bindKey: bindKey("Ctrl-Up", null),
    exec: function(e) { e.renderer.scrollBy(0, -2 * e.renderer.layerConfig.lineHeight); },
    readOnly: true
}, {
    name: "scrolldown",
    bindKey: bindKey("Ctrl-Down", null),
    exec: function(e) { e.renderer.scrollBy(0, 2 * e.renderer.layerConfig.lineHeight); },
    readOnly: true
}, {
    name: "selectlinestart",
    bindKey: "Shift-Home",
    exec: function(editor) { editor.getSelection().selectLineStart(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectlineend",
    bindKey: "Shift-End",
    exec: function(editor) { editor.getSelection().selectLineEnd(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "togglerecording",
    bindKey: bindKey("Ctrl-Alt-E", "Command-Option-E"),
    exec: function(editor) { editor.commands.toggleRecording(editor); },
    readOnly: true
}, {
    name: "replaymacro",
    bindKey: bindKey("Ctrl-Shift-E", "Command-Shift-E"),
    exec: function(editor) { editor.commands.replay(editor); },
    readOnly: true
}, {
    name: "jumptomatching",
    bindKey: bindKey("Ctrl-P", "Ctrl-Shift-P"),
    exec: function(editor) { editor.jumpToMatching(); },
    multiSelectAction: "forEach",
    readOnly: true
}, {
    name: "selecttomatching",
    bindKey: bindKey("Ctrl-Shift-P", null),
    exec: function(editor) { editor.jumpToMatching(true); },
    multiSelectAction: "forEach",
    readOnly: true
}, 
{
    name: "cut",
    exec: function(editor) {
        var range = editor.getSelectionRange();
        editor._emit("cut", range);

        if (!editor.selection.isEmpty()) {
            editor.session.remove(range);
            editor.clearSelection();
        }
    },
    scrollIntoView: "cursor",
    multiSelectAction: "forEach"
}, {
    name: "removeline",
    bindKey: bindKey("Ctrl-D", "Command-D"),
    exec: function(editor) { editor.removeLines(); },
    scrollIntoView: "cursor",
    multiSelectAction: "forEachLine"
}, {
    name: "duplicateSelection",
    bindKey: bindKey("Ctrl-Shift-D", "Command-Shift-D"),
    exec: function(editor) { editor.duplicateSelection(); },
    scrollIntoView: "cursor",
    multiSelectAction: "forEach"
}, {
    name: "sortlines",
    bindKey: bindKey("Ctrl-Alt-S", "Command-Alt-S"),
    exec: function(editor) { editor.sortLines(); },
    scrollIntoView: "selection",
    multiSelectAction: "forEachLine"
}, {
    name: "togglecomment",
    bindKey: bindKey("Ctrl-/", "Command-/"),
    exec: function(editor) { editor.toggleCommentLines(); },
    multiSelectAction: "forEachLine",
    scrollIntoView: "selectionPart"
}, {
    name: "toggleBlockComment",
    bindKey: bindKey("Ctrl-Shift-/", "Command-Shift-/"),
    exec: function(editor) { editor.toggleBlockComment(); },
    multiSelectAction: "forEach",
    scrollIntoView: "selectionPart"
}, {
    name: "modifyNumberUp",
    bindKey: bindKey("Ctrl-Shift-Up", "Alt-Shift-Up"),
    exec: function(editor) { editor.modifyNumber(1); },
    multiSelectAction: "forEach"
}, {
    name: "modifyNumberDown",
    bindKey: bindKey("Ctrl-Shift-Down", "Alt-Shift-Down"),
    exec: function(editor) { editor.modifyNumber(-1); },
    multiSelectAction: "forEach"
}, {
    name: "replace",
    bindKey: bindKey("Ctrl-H", "Command-Option-F"),
    exec: function(editor) {
        config.loadModule("ace/ext/searchbox", function(e) {e.Search(editor, true)});
    }
}, {
    name: "undo",
    bindKey: bindKey("Ctrl-Z", "Command-Z"),
    exec: function(editor) { editor.undo(); }
}, {
    name: "redo",
    bindKey: bindKey("Ctrl-Shift-Z|Ctrl-Y", "Command-Shift-Z|Command-Y"),
    exec: function(editor) { editor.redo(); }
}, {
    name: "copylinesup",
    bindKey: bindKey("Alt-Shift-Up", "Command-Option-Up"),
    exec: function(editor) { editor.copyLinesUp(); },
    scrollIntoView: "cursor"
}, {
    name: "movelinesup",
    bindKey: bindKey("Alt-Up", "Option-Up"),
    exec: function(editor) { editor.moveLinesUp(); },
    scrollIntoView: "cursor"
}, {
    name: "copylinesdown",
    bindKey: bindKey("Alt-Shift-Down", "Command-Option-Down"),
    exec: function(editor) { editor.copyLinesDown(); },
    scrollIntoView: "cursor"
}, {
    name: "movelinesdown",
    bindKey: bindKey("Alt-Down", "Option-Down"),
    exec: function(editor) { editor.moveLinesDown(); },
    scrollIntoView: "cursor"
}, {
    name: "del",
    bindKey: bindKey("Delete", "Delete|Ctrl-D|Shift-Delete"),
    exec: function(editor) { editor.remove("right"); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "backspace",
    bindKey: bindKey(
        "Shift-Backspace|Backspace",
        "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"
    ),
    exec: function(editor) { editor.remove("left"); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "cut_or_delete",
    bindKey: bindKey("Shift-Delete", null),
    exec: function(editor) { 
        if (editor.selection.isEmpty()) {
            editor.remove("left");
        } else {
            return false;
        }
    },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removetolinestart",
    bindKey: bindKey("Alt-Backspace", "Command-Backspace"),
    exec: function(editor) { editor.removeToLineStart(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removetolineend",
    bindKey: bindKey("Alt-Delete", "Ctrl-K"),
    exec: function(editor) { editor.removeToLineEnd(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removewordleft",
    bindKey: bindKey("Ctrl-Backspace", "Alt-Backspace|Ctrl-Alt-Backspace"),
    exec: function(editor) { editor.removeWordLeft(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removewordright",
    bindKey: bindKey("Ctrl-Delete", "Alt-Delete"),
    exec: function(editor) { editor.removeWordRight(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "outdent",
    bindKey: bindKey("Shift-Tab", "Shift-Tab"),
    exec: function(editor) { editor.blockOutdent(); },
    multiSelectAction: "forEach",
    scrollIntoView: "selectionPart"
}, {
    name: "indent",
    bindKey: bindKey("Tab", "Tab"),
    exec: function(editor) { editor.indent(); },
    multiSelectAction: "forEach",
    scrollIntoView: "selectionPart"
}, {
    name: "blockoutdent",
    bindKey: bindKey("Ctrl-[", "Ctrl-["),
    exec: function(editor) { editor.blockOutdent(); },
    multiSelectAction: "forEachLine",
    scrollIntoView: "selectionPart"
}, {
    name: "blockindent",
    bindKey: bindKey("Ctrl-]", "Ctrl-]"),
    exec: function(editor) { editor.blockIndent(); },
    multiSelectAction: "forEachLine",
    scrollIntoView: "selectionPart"
}, {
    name: "insertstring",
    exec: function(editor, str) { editor.insert(str); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "inserttext",
    exec: function(editor, args) {
        editor.insert(lang.stringRepeat(args.text  || "", args.times || 1));
    },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "splitline",
    bindKey: bindKey(null, "Ctrl-O"),
    exec: function(editor) { editor.splitLine(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "transposeletters",
    bindKey: bindKey("Ctrl-T", "Ctrl-T"),
    exec: function(editor) { editor.transposeLetters(); },
    multiSelectAction: function(editor) {editor.transposeSelections(1); },
    scrollIntoView: "cursor"
}, {
    name: "touppercase",
    bindKey: bindKey("Ctrl-U", "Ctrl-U"),
    exec: function(editor) { editor.toUpperCase(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "tolowercase",
    bindKey: bindKey("Ctrl-Shift-U", "Ctrl-Shift-U"),
    exec: function(editor) { editor.toLowerCase(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}];

});

ace.define('ace/lib/event_emitter', ['require', 'exports', 'module' ], function(require, exports, module) {


var EventEmitter = {};
var stopPropagation = function() { this.propagationStopped = true; };
var preventDefault = function() { this.defaultPrevented = true; };

EventEmitter._emit =
EventEmitter._dispatchEvent = function(eventName, e) {
    this._eventRegistry || (this._eventRegistry = {});
    this._defaultHandlers || (this._defaultHandlers = {});

    var listeners = this._eventRegistry[eventName] || [];
    var defaultHandler = this._defaultHandlers[eventName];
    if (!listeners.length && !defaultHandler)
        return;

    if (typeof e != "object" || !e)
        e = {};

    if (!e.type)
        e.type = eventName;
    if (!e.stopPropagation)
        e.stopPropagation = stopPropagation;
    if (!e.preventDefault)
        e.preventDefault = preventDefault;

    listeners = listeners.slice();
    for (var i=0; i<listeners.length; i++) {
        listeners[i](e, this);
        if (e.propagationStopped)
            break;
    }
    
    if (defaultHandler && !e.defaultPrevented)
        return defaultHandler(e, this);
};


EventEmitter._signal = function(eventName, e) {
    var listeners = (this._eventRegistry || {})[eventName];
    if (!listeners)
        return;
    listeners = listeners.slice();
    for (var i=0; i<listeners.length; i++)
        listeners[i](e, this);
};

EventEmitter.once = function(eventName, callback) {
    var _self = this;
    callback && this.addEventListener(eventName, function newCallback() {
        _self.removeEventListener(eventName, newCallback);
        callback.apply(null, arguments);
    });
};


EventEmitter.setDefaultHandler = function(eventName, callback) {
    var handlers = this._defaultHandlers
    if (!handlers)
        handlers = this._defaultHandlers = {_disabled_: {}};
    
    if (handlers[eventName]) {
        var old = handlers[eventName];
        var disabled = handlers._disabled_[eventName];
        if (!disabled)
            handlers._disabled_[eventName] = disabled = [];
        disabled.push(old);
        var i = disabled.indexOf(callback);
        if (i != -1) 
            disabled.splice(i, 1);
    }
    handlers[eventName] = callback;
};
EventEmitter.removeDefaultHandler = function(eventName, callback) {
    var handlers = this._defaultHandlers
    if (!handlers)
        return;
    var disabled = handlers._disabled_[eventName];
    
    if (handlers[eventName] == callback) {
        var old = handlers[eventName];
        if (disabled)
            this.setDefaultHandler(eventName, disabled.pop());
    } else if (disabled) {
        var i = disabled.indexOf(callback);
        if (i != -1)
            disabled.splice(i, 1);
    }
};

EventEmitter.on =
EventEmitter.addEventListener = function(eventName, callback, capturing) {
    this._eventRegistry = this._eventRegistry || {};

    var listeners = this._eventRegistry[eventName];
    if (!listeners)
        listeners = this._eventRegistry[eventName] = [];

    if (listeners.indexOf(callback) == -1)
        listeners[capturing ? "unshift" : "push"](callback);
    return callback;
};

EventEmitter.off =
EventEmitter.removeListener =
EventEmitter.removeEventListener = function(eventName, callback) {
    this._eventRegistry = this._eventRegistry || {};

    var listeners = this._eventRegistry[eventName];
    if (!listeners)
        return;

    var index = listeners.indexOf(callback);
    if (index !== -1)
        listeners.splice(index, 1);
};

EventEmitter.removeAllListeners = function(eventName) {
    if (this._eventRegistry) this._eventRegistry[eventName] = [];
};

exports.EventEmitter = EventEmitter;

});

ace.define('ace/undomanager', ['require', 'exports', 'module' ], function(require, exports, module) {
var UndoManager = function() {
    this.reset();
};

(function() {
    this.execute = function(options) {
        var deltas = options.args[0];
        this.$doc  = options.args[1];
        if (options.merge && this.hasUndo()){
            this.dirtyCounter--;
            deltas = this.$undoStack.pop().concat(deltas);
        }
        this.$undoStack.push(deltas);
        this.$redoStack = [];

        if (this.dirtyCounter < 0) {
            this.dirtyCounter = NaN;
        }
        this.dirtyCounter++;
    };
    this.undo = function(dontSelect) {
        var deltas = this.$undoStack.pop();
        var undoSelectionRange = null;
        if (deltas) {
            undoSelectionRange =
                this.$doc.undoChanges(deltas, dontSelect);
            this.$redoStack.push(deltas);
            this.dirtyCounter--;
        }

        return undoSelectionRange;
    };
    this.redo = function(dontSelect) {
        var deltas = this.$redoStack.pop();
        var redoSelectionRange = null;
        if (deltas) {
            redoSelectionRange =
                this.$doc.redoChanges(deltas, dontSelect);
            this.$undoStack.push(deltas);
            this.dirtyCounter++;
        }

        return redoSelectionRange;
    };
    this.reset = function() {
        this.$undoStack = [];
        this.$redoStack = [];
        this.dirtyCounter = 0;
    };
    this.hasUndo = function() {
        return this.$undoStack.length > 0;
    };
    this.hasRedo = function() {
        return this.$redoStack.length > 0;
    };
    this.markClean = function() {
        this.dirtyCounter = 0;
    };
    this.isClean = function() {
        return this.dirtyCounter === 0;
    };

}).call(UndoManager.prototype);

exports.UndoManager = UndoManager;
});
ace.define('ace/lib/net', ['require', 'exports', 'module' , 'ace/lib/dom'], function(require, exports, module) {

var dom = require("./dom");

exports.get = function (url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            callback(xhr.responseText);
        }
    };
    xhr.send(null);
};

exports.loadScript = function(path, callback) {
    var head = dom.getDocumentHead();
    var s = document.createElement('script');

    s.src = path;
    head.appendChild(s);

    s.onload = s.onreadystatechange = function(_, isAbort) {
        if (isAbort || !s.readyState || s.readyState == "loaded" || s.readyState == "complete") {
            s = s.onload = s.onreadystatechange = null;
            if (!isAbort)
                callback();
        }
    };
};

});

ace.define('ace/virtual_renderer', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/dom', 'ace/config', 'ace/layer/gutter', 'ace/layer/marker', 'ace/layer/text', 'ace/layer/cursor', 'ace/scrollbar', 'ace/renderloop', 'ace/layer/font_metrics', 'ace/lib/event_emitter'], function(require, exports, module) {


var oop = require("./lib/oop");
var dom = require("./lib/dom");
var config = require("./config");
var GutterLayer = require("./layer/gutter").Gutter;
var MarkerLayer = require("./layer/marker").Marker;
var TextLayer = require("./layer/text").Text;
var CursorLayer = require("./layer/cursor").Cursor;
var HScrollBar = require("./scrollbar").HScrollBar;
var VScrollBar = require("./scrollbar").VScrollBar;
var RenderLoop = require("./renderloop").RenderLoop;
var FontMetrics = require("./layer/font_metrics").FontMetrics;
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var editorCss = ".ace_editor {\
position: relative;\
overflow: hidden;\
font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;\
font-size: 12px;\
line-height: normal;\
direction: ltr;\
}\
.ace_scroller {\
position: absolute;\
overflow: hidden;\
top: 0;\
bottom: 0;\
background-color: inherit;\
-ms-user-select: none;\
-moz-user-select: none;\
-webkit-user-select: none;\
user-select: none;\
}\
.ace_content {\
position: absolute;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
cursor: text;\
min-width: 100%;\
}\
.ace_dragging, .ace_dragging * {\
cursor: move !important;\
}\
.ace_dragging .ace_scroller:before{\
position: absolute;\
top: 0;\
left: 0;\
right: 0;\
bottom: 0;\
content: '';\
background: rgba(250, 250, 250, 0.01);\
z-index: 1000;\
}\
.ace_dragging.ace_dark .ace_scroller:before{\
background: rgba(0, 0, 0, 0.01);\
}\
.ace_selecting, .ace_selecting * {\
cursor: text !important;\
}\
.ace_gutter {\
position: absolute;\
overflow : hidden;\
width: auto;\
top: 0;\
bottom: 0;\
left: 0;\
cursor: default;\
z-index: 4;\
-ms-user-select: none;\
-moz-user-select: none;\
-webkit-user-select: none;\
user-select: none;\
}\
.ace_gutter-active-line {\
position: absolute;\
left: 0;\
right: 0;\
}\
.ace_scroller.ace_scroll-left {\
box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;\
}\
.ace_gutter-cell {\
padding-left: 19px;\
padding-right: 6px;\
background-repeat: no-repeat;\
}\
.ace_gutter-cell.ace_error {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==\");\
background-repeat: no-repeat;\
background-position: 2px center;\
}\
.ace_gutter-cell.ace_warning {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==\");\
background-position: 2px center;\
}\
.ace_gutter-cell.ace_info {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=\");\
background-position: 2px center;\
}\
.ace_dark .ace_gutter-cell.ace_info {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC\");\
}\
.ace_scrollbar {\
position: absolute;\
right: 0;\
bottom: 0;\
z-index: 6;\
}\
.ace_scrollbar-inner {\
position: absolute;\
cursor: text;\
left: 0;\
top: 0;\
}\
.ace_scrollbar-v{\
overflow-x: hidden;\
overflow-y: scroll;\
top: 0;\
}\
.ace_scrollbar-h {\
overflow-x: scroll;\
overflow-y: hidden;\
left: 0;\
}\
.ace_print-margin {\
position: absolute;\
height: 100%;\
}\
.ace_text-input {\
position: absolute;\
z-index: 0;\
width: 0.5em;\
height: 1em;\
opacity: 0;\
background: transparent;\
-moz-appearance: none;\
appearance: none;\
border: none;\
resize: none;\
outline: none;\
overflow: hidden;\
font: inherit;\
padding: 0 1px;\
margin: 0 -1px;\
text-indent: -1em;\
-ms-user-select: text;\
-moz-user-select: text;\
-webkit-user-select: text;\
user-select: text;\
}\
.ace_text-input.ace_composition {\
background: #f8f8f8;\
color: #111;\
z-index: 1000;\
opacity: 1;\
text-indent: 0;\
}\
.ace_layer {\
z-index: 1;\
position: absolute;\
overflow: hidden;\
white-space: pre;\
height: 100%;\
width: 100%;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
/* setting pointer-events: auto; on node under the mouse, which changes\
during scroll, will break mouse wheel scrolling in Safari */\
pointer-events: none;\
}\
.ace_gutter-layer {\
position: relative;\
width: auto;\
text-align: right;\
pointer-events: auto;\
}\
.ace_text-layer {\
font: inherit !important;\
}\
.ace_cjk {\
display: inline-block;\
text-align: center;\
}\
.ace_cursor-layer {\
z-index: 4;\
}\
.ace_cursor {\
z-index: 4;\
position: absolute;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
border-left: 2px solid\
}\
.ace_slim-cursors .ace_cursor {\
border-left-width: 1px;\
}\
.ace_overwrite-cursors .ace_cursor {\
border-left-width: 0px;\
border-bottom: 1px solid;\
}\
.ace_hidden-cursors .ace_cursor {\
opacity: 0.2;\
}\
.ace_smooth-blinking .ace_cursor {\
-moz-transition: opacity 0.18s;\
-webkit-transition: opacity 0.18s;\
-o-transition: opacity 0.18s;\
-ms-transition: opacity 0.18s;\
transition: opacity 0.18s;\
}\
.ace_editor.ace_multiselect .ace_cursor {\
border-left-width: 1px;\
}\
.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {\
position: absolute;\
z-index: 3;\
}\
.ace_marker-layer .ace_selection {\
position: absolute;\
z-index: 5;\
}\
.ace_marker-layer .ace_bracket {\
position: absolute;\
z-index: 6;\
}\
.ace_marker-layer .ace_active-line {\
position: absolute;\
z-index: 2;\
}\
.ace_marker-layer .ace_selected-word {\
position: absolute;\
z-index: 4;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
}\
.ace_line .ace_fold {\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
display: inline-block;\
height: 11px;\
margin-top: -2px;\
vertical-align: middle;\
background-image:\
url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII=\"),\
url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=\");\
background-repeat: no-repeat, repeat-x;\
background-position: center center, top left;\
color: transparent;\
border: 1px solid black;\
-moz-border-radius: 2px;\
-webkit-border-radius: 2px;\
border-radius: 2px;\
cursor: pointer;\
pointer-events: auto;\
}\
.ace_dark .ace_fold {\
}\
.ace_fold:hover{\
background-image:\
url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII=\"),\
url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC\");\
}\
.ace_tooltip {\
background-color: #FFF;\
background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.1));\
background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));\
border: 1px solid gray;\
border-radius: 1px;\
box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\
color: black;\
display: block;\
max-width: 100%;\
padding: 3px 4px;\
position: fixed;\
z-index: 999999;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
cursor: default;\
white-space: pre;\
word-wrap: break-word;\
line-height: normal;\
font-style: normal;\
font-weight: normal;\
letter-spacing: normal;\
pointer-events: none;\
}\
.ace_folding-enabled > .ace_gutter-cell {\
padding-right: 13px;\
}\
.ace_fold-widget {\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
margin: 0 -12px 0 1px;\
display: none;\
width: 11px;\
vertical-align: top;\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==\");\
background-repeat: no-repeat;\
background-position: center;\
border-radius: 3px;\
border: 1px solid transparent;\
cursor: pointer;\
}\
.ace_folding-enabled .ace_fold-widget {\
display: inline-block;   \
}\
.ace_fold-widget.ace_end {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==\");\
}\
.ace_fold-widget.ace_closed {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==\");\
}\
.ace_fold-widget:hover {\
border: 1px solid rgba(0, 0, 0, 0.3);\
background-color: rgba(255, 255, 255, 0.2);\
-moz-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);\
-webkit-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);\
box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);\
}\
.ace_fold-widget:active {\
border: 1px solid rgba(0, 0, 0, 0.4);\
background-color: rgba(0, 0, 0, 0.05);\
-moz-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);\
-webkit-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);\
box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);\
}\
/**\
* Dark version for fold widgets\
*/\
.ace_dark .ace_fold-widget {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC\");\
}\
.ace_dark .ace_fold-widget.ace_end {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==\");\
}\
.ace_dark .ace_fold-widget.ace_closed {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==\");\
}\
.ace_dark .ace_fold-widget:hover {\
box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);\
background-color: rgba(255, 255, 255, 0.1);\
}\
.ace_dark .ace_fold-widget:active {\
-moz-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);\
-webkit-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);\
box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);\
}\
.ace_fold-widget.ace_invalid {\
background-color: #FFB4B4;\
border-color: #DE5555;\
}\
.ace_fade-fold-widgets .ace_fold-widget {\
-moz-transition: opacity 0.4s ease 0.05s;\
-webkit-transition: opacity 0.4s ease 0.05s;\
-o-transition: opacity 0.4s ease 0.05s;\
-ms-transition: opacity 0.4s ease 0.05s;\
transition: opacity 0.4s ease 0.05s;\
opacity: 0;\
}\
.ace_fade-fold-widgets:hover .ace_fold-widget {\
-moz-transition: opacity 0.05s ease 0.05s;\
-webkit-transition: opacity 0.05s ease 0.05s;\
-o-transition: opacity 0.05s ease 0.05s;\
-ms-transition: opacity 0.05s ease 0.05s;\
transition: opacity 0.05s ease 0.05s;\
opacity:1;\
}\
.ace_underline {\
text-decoration: underline;\
}\
.ace_bold {\
font-weight: bold;\
}\
.ace_nobold .ace_bold {\
font-weight: normal;\
}\
.ace_italic {\
font-style: italic;\
}\
.ace_error-marker {\
background-color: rgba(255, 0, 0,0.2);\
position: absolute;\
z-index: 9;\
}\
.ace_highlight-marker {\
background-color: rgba(255, 255, 0,0.2);\
position: absolute;\
z-index: 8;\
}\
";

dom.importCssString(editorCss, "ace_editor");

var VirtualRenderer = function(container, theme) {
    var _self = this;

    this.container = container || dom.createElement("div");
    this.$keepTextAreaAtCursor = true;

    dom.addCssClass(this.container, "ace_editor");

    this.setTheme(theme);

    this.$gutter = dom.createElement("div");
    this.$gutter.className = "ace_gutter";
    this.container.appendChild(this.$gutter);

    this.scroller = dom.createElement("div");
    this.scroller.className = "ace_scroller";
    this.container.appendChild(this.scroller);

    this.content = dom.createElement("div");
    this.content.className = "ace_content";
    this.scroller.appendChild(this.content);

    this.$gutterLayer = new GutterLayer(this.$gutter);
    this.$gutterLayer.on("changeGutterWidth", this.onGutterResize.bind(this));

    this.$markerBack = new MarkerLayer(this.content);

    var textLayer = this.$textLayer = new TextLayer(this.content);
    this.canvas = textLayer.element;

    this.$markerFront = new MarkerLayer(this.content);

    this.$cursorLayer = new CursorLayer(this.content);
    this.$horizScroll = false;
    this.$vScroll = false;

    this.scrollBar = 
    this.scrollBarV = new VScrollBar(this.container, this);
    this.scrollBarH = new HScrollBar(this.container, this);
    this.scrollBarV.addEventListener("scroll", function(e) {
        if (!_self.$scrollAnimation)
            _self.session.setScrollTop(e.data - _self.scrollMargin.top);
    });
    this.scrollBarH.addEventListener("scroll", function(e) {
        if (!_self.$scrollAnimation)
            _self.session.setScrollLeft(e.data - _self.scrollMargin.left);
    });

    this.scrollTop = 0;
    this.scrollLeft = 0;

    this.cursorPos = {
        row : 0,
        column : 0
    };

    this.$fontMetrics = new FontMetrics(this.container, 500);
    this.$textLayer.$setFontMetrics(this.$fontMetrics);
    this.$textLayer.addEventListener("changeCharacterSize", function(e) {
        _self.updateCharacterSize();
        _self.onResize(true, _self.gutterWidth, _self.$size.width, _self.$size.height);
        _self._signal("changeCharacterSize", e);
    });

    this.$size = {
        width: 0,
        height: 0,
        scrollerHeight: 0,
        scrollerWidth: 0,
        $dirty: true
    };

    this.layerConfig = {
        width : 1,
        padding : 0,
        firstRow : 0,
        firstRowScreen: 0,
        lastRow : 0,
        lineHeight : 0,
        characterWidth : 0,
        minHeight : 1,
        maxHeight : 1,
        offset : 0,
        height : 1,
        gutterOffset: 1
    };
    
    this.scrollMargin = {
        left: 0,
        right: 0,
        top: 0,
        bottom: 0,
        v: 0,
        h: 0
    };

    this.$loop = new RenderLoop(
        this.$renderChanges.bind(this),
        this.container.ownerDocument.defaultView
    );
    this.$loop.schedule(this.CHANGE_FULL);

    this.updateCharacterSize();
    this.setPadding(4);
    config.resetOptions(this);
    config._emit("renderer", this);
};

(function() {

    this.CHANGE_CURSOR = 1;
    this.CHANGE_MARKER = 2;
    this.CHANGE_GUTTER = 4;
    this.CHANGE_SCROLL = 8;
    this.CHANGE_LINES = 16;
    this.CHANGE_TEXT = 32;
    this.CHANGE_SIZE = 64;
    this.CHANGE_MARKER_BACK = 128;
    this.CHANGE_MARKER_FRONT = 256;
    this.CHANGE_FULL = 512;
    this.CHANGE_H_SCROLL = 1024;

    oop.implement(this, EventEmitter);

    this.updateCharacterSize = function() {
        if (this.$textLayer.allowBoldFonts != this.$allowBoldFonts) {
            this.$allowBoldFonts = this.$textLayer.allowBoldFonts;
            this.setStyle("ace_nobold", !this.$allowBoldFonts);
        }

        this.layerConfig.characterWidth =
        this.characterWidth = this.$textLayer.getCharacterWidth();
        this.layerConfig.lineHeight =
        this.lineHeight = this.$textLayer.getLineHeight();
        this.$updatePrintMargin();
    };
    this.setSession = function(session) {
        if (this.session)
            this.session.doc.off("changeNewLineMode", this.onChangeNewLineMode);
            
        this.session = session;
        if (!session)
            return;
            
        if (this.scrollMargin.top && session.getScrollTop() <= 0)
            session.setScrollTop(-this.scrollMargin.top);

        this.$cursorLayer.setSession(session);
        this.$markerBack.setSession(session);
        this.$markerFront.setSession(session);
        this.$gutterLayer.setSession(session);
        this.$textLayer.setSession(session);
        this.$loop.schedule(this.CHANGE_FULL);
        this.session.$setFontMetrics(this.$fontMetrics);
        
        this.onChangeNewLineMode = this.onChangeNewLineMode.bind(this);
        this.onChangeNewLineMode()
        this.session.doc.on("changeNewLineMode", this.onChangeNewLineMode);
    };
    this.updateLines = function(firstRow, lastRow) {
        if (lastRow === undefined)
            lastRow = Infinity;

        if (!this.$changedLines) {
            this.$changedLines = {
                firstRow: firstRow,
                lastRow: lastRow
            };
        }
        else {
            if (this.$changedLines.firstRow > firstRow)
                this.$changedLines.firstRow = firstRow;

            if (this.$changedLines.lastRow < lastRow)
                this.$changedLines.lastRow = lastRow;
        }

        if (this.$changedLines.firstRow > this.layerConfig.lastRow ||
            this.$changedLines.lastRow < this.layerConfig.firstRow)
            return;
        this.$loop.schedule(this.CHANGE_LINES);
    };

    this.onChangeNewLineMode = function() {
        this.$loop.schedule(this.CHANGE_TEXT);
        this.$textLayer.$updateEolChar();
    };
    
    this.onChangeTabSize = function() {
        this.$loop.schedule(this.CHANGE_TEXT | this.CHANGE_MARKER);
        this.$textLayer.onChangeTabSize();
    };
    this.updateText = function() {
        this.$loop.schedule(this.CHANGE_TEXT);
    };
    this.updateFull = function(force) {
        if (force)
            this.$renderChanges(this.CHANGE_FULL, true);
        else
            this.$loop.schedule(this.CHANGE_FULL);
    };
    this.updateFontSize = function() {
        this.$textLayer.checkForSizeChanges();
    };

    this.$changes = 0;
    this.$updateSizeAsync = function() {
        if (this.$loop.pending)
            this.$size.$dirty = true;
        else
            this.onResize();
    };
    this.onResize = function(force, gutterWidth, width, height) {
        if (this.resizing > 2)
            return;
        else if (this.resizing > 0)
            this.resizing++;
        else
            this.resizing = force ? 1 : 0;
        var el = this.container;
        if (!height)
            height = el.clientHeight || el.scrollHeight;
        if (!width)
            width = el.clientWidth || el.scrollWidth;
        var changes = this.$updateCachedSize(force, gutterWidth, width, height);
        
        if (!this.$size.scrollerHeight || (!width && !height))
            return this.resizing = 0;

        if (force)
            this.$gutterLayer.$padding = null;

        if (force)
            this.$renderChanges(changes | this.$changes, true);
        else
            this.$loop.schedule(changes | this.$changes);

        if (this.resizing)
            this.resizing = 0;
    };
    
    this.$updateCachedSize = function(force, gutterWidth, width, height) {
        height -= (this.$extraHeight || 0);
        var changes = 0;
        var size = this.$size;
        var oldSize = {
            width: size.width,
            height: size.height,
            scrollerHeight: size.scrollerHeight,
            scrollerWidth: size.scrollerWidth
        };
        if (height && (force || size.height != height)) {
            size.height = height;
            changes |= this.CHANGE_SIZE;

            size.scrollerHeight = size.height;
            if (this.$horizScroll)
                size.scrollerHeight -= this.scrollBarH.getHeight();
            this.scrollBarV.element.style.bottom = this.scrollBarH.getHeight() + "px";

            changes = changes | this.CHANGE_SCROLL;
        }

        if (width && (force || size.width != width)) {
            changes |= this.CHANGE_SIZE;
            size.width = width;
            
            if (gutterWidth == null)
                gutterWidth = this.$showGutter ? this.$gutter.offsetWidth : 0;
            
            this.gutterWidth = gutterWidth;
            
            this.scrollBarH.element.style.left = 
            this.scroller.style.left = gutterWidth + "px";
            size.scrollerWidth = Math.max(0, width - gutterWidth - this.scrollBarV.getWidth());           
            
            this.scrollBarH.element.style.right = 
            this.scroller.style.right = this.scrollBarV.getWidth() + "px";
            this.scroller.style.bottom = this.scrollBarH.getHeight() + "px";

            if (this.session && this.session.getUseWrapMode() && this.adjustWrapLimit() || force)
                changes |= this.CHANGE_FULL;
        }
        
        size.$dirty = !width || !height;

        if (changes)
            this._signal("resize", oldSize);

        return changes;
    };

    this.onGutterResize = function() {
        var gutterWidth = this.$showGutter ? this.$gutter.offsetWidth : 0;
        if (gutterWidth != this.gutterWidth)
            this.$changes |= this.$updateCachedSize(true, gutterWidth, this.$size.width, this.$size.height);

        if (this.session.getUseWrapMode() && this.adjustWrapLimit()) {
            this.$loop.schedule(this.CHANGE_FULL);
        } else if (this.$size.$dirty) {
            this.$loop.schedule(this.CHANGE_FULL);
        } else {
            this.$computeLayerConfig();
            this.$loop.schedule(this.CHANGE_MARKER);
        }
    };
    this.adjustWrapLimit = function() {
        var availableWidth = this.$size.scrollerWidth - this.$padding * 2;
        var limit = Math.floor(availableWidth / this.characterWidth);
        return this.session.adjustWrapLimit(limit, this.$showPrintMargin && this.$printMarginColumn);
    };
    this.setAnimatedScroll = function(shouldAnimate){
        this.setOption("animatedScroll", shouldAnimate);
    };
    this.getAnimatedScroll = function() {
        return this.$animatedScroll;
    };
    this.setShowInvisibles = function(showInvisibles) {
        this.setOption("showInvisibles", showInvisibles);
    };
    this.getShowInvisibles = function() {
        return this.getOption("showInvisibles");
    };
    this.getDisplayIndentGuides = function() {
        return this.getOption("displayIndentGuides");
    };

    this.setDisplayIndentGuides = function(display) {
        this.setOption("displayIndentGuides", display);
    };
    this.setShowPrintMargin = function(showPrintMargin) {
        this.setOption("showPrintMargin", showPrintMargin);
    };
    this.getShowPrintMargin = function() {
        return this.getOption("showPrintMargin");
    };
    this.setPrintMarginColumn = function(showPrintMargin) {
        this.setOption("printMarginColumn", showPrintMargin);
    };
    this.getPrintMarginColumn = function() {
        return this.getOption("printMarginColumn");
    };
    this.getShowGutter = function(){
        return this.getOption("showGutter");
    };
    this.setShowGutter = function(show){
        return this.setOption("showGutter", show);
    };

    this.getFadeFoldWidgets = function(){
        return this.getOption("fadeFoldWidgets")
    };

    this.setFadeFoldWidgets = function(show) {
        this.setOption("fadeFoldWidgets", show);
    };

    this.setHighlightGutterLine = function(shouldHighlight) {
        this.setOption("highlightGutterLine", shouldHighlight);
    };

    this.getHighlightGutterLine = function() {
        return this.getOption("highlightGutterLine");
    };

    this.$updateGutterLineHighlight = function() {
        var pos = this.$cursorLayer.$pixelPos;
        var height = this.layerConfig.lineHeight;
        if (this.session.getUseWrapMode()) {
            var cursor = this.session.selection.getCursor();
            cursor.column = 0;
            pos = this.$cursorLayer.getPixelPosition(cursor, true);
            height *= this.session.getRowLength(cursor.row);
        }
        this.$gutterLineHighlight.style.top = pos.top - this.layerConfig.offset + "px";
        this.$gutterLineHighlight.style.height = height + "px";
    };

    this.$updatePrintMargin = function() {
        if (!this.$showPrintMargin && !this.$printMarginEl)
            return;

        if (!this.$printMarginEl) {
            var containerEl = dom.createElement("div");
            containerEl.className = "ace_layer ace_print-margin-layer";
            this.$printMarginEl = dom.createElement("div");
            this.$printMarginEl.className = "ace_print-margin";
            containerEl.appendChild(this.$printMarginEl);
            this.content.insertBefore(containerEl, this.content.firstChild);
        }

        var style = this.$printMarginEl.style;
        style.left = ((this.characterWidth * this.$printMarginColumn) + this.$padding) + "px";
        style.visibility = this.$showPrintMargin ? "visible" : "hidden";
        
        if (this.session && this.session.$wrap == -1)
            this.adjustWrapLimit();
    };
    this.getContainerElement = function() {
        return this.container;
    };
    this.getMouseEventTarget = function() {
        return this.content;
    };
    this.getTextAreaContainer = function() {
        return this.container;
    };
    this.$moveTextAreaToCursor = function() {
        if (!this.$keepTextAreaAtCursor)
            return;
        var config = this.layerConfig;
        var posTop = this.$cursorLayer.$pixelPos.top;
        var posLeft = this.$cursorLayer.$pixelPos.left;
        posTop -= config.offset;

        var h = this.lineHeight;
        if (posTop < 0 || posTop > config.height - h)
            return;

        var w = this.characterWidth;
        if (this.$composition) {
            var val = this.textarea.value.replace(/^\x01+/, "");
            w *= (this.session.$getStringScreenWidth(val)[0]+2);
            h += 2;
            posTop -= 1;
        }
        posLeft -= this.scrollLeft;
        if (posLeft > this.$size.scrollerWidth - w)
            posLeft = this.$size.scrollerWidth - w;

        posLeft -= this.scrollBar.width;

        this.textarea.style.height = h + "px";
        this.textarea.style.width = w + "px";
        this.textarea.style.right = Math.max(0, this.$size.scrollerWidth - posLeft - w) + "px";
        this.textarea.style.bottom = Math.max(0, this.$size.height - posTop - h) + "px";
    };
    this.getFirstVisibleRow = function() {
        return this.layerConfig.firstRow;
    };
    this.getFirstFullyVisibleRow = function() {
        return this.layerConfig.firstRow + (this.layerConfig.offset === 0 ? 0 : 1);
    };
    this.getLastFullyVisibleRow = function() {
        var flint = Math.floor((this.layerConfig.height + this.layerConfig.offset) / this.layerConfig.lineHeight);
        return this.layerConfig.firstRow - 1 + flint;
    };
    this.getLastVisibleRow = function() {
        return this.layerConfig.lastRow;
    };

    this.$padding = null;
    this.setPadding = function(padding) {
        this.$padding = padding;
        this.$textLayer.setPadding(padding);
        this.$cursorLayer.setPadding(padding);
        this.$markerFront.setPadding(padding);
        this.$markerBack.setPadding(padding);
        this.$loop.schedule(this.CHANGE_FULL);
        this.$updatePrintMargin();
    };
    
    this.setScrollMargin = function(top, bottom, left, right) {
        var sm = this.scrollMargin;
        sm.top = top|0;
        sm.bottom = bottom|0;
        sm.right = right|0;
        sm.left = left|0;
        sm.v = sm.top + sm.bottom;
        sm.h = sm.left + sm.right;
        if (sm.top && this.scrollTop <= 0 && this.session)
            this.session.setScrollTop(-sm.top);
        this.updateFull();
    };
    this.getHScrollBarAlwaysVisible = function() {
        return this.$hScrollBarAlwaysVisible;
    };
    this.setHScrollBarAlwaysVisible = function(alwaysVisible) {
        this.setOption("hScrollBarAlwaysVisible", alwaysVisible);
    };
    this.getVScrollBarAlwaysVisible = function() {
        return this.$hScrollBarAlwaysVisible;
    };
    this.setVScrollBarAlwaysVisible = function(alwaysVisible) {
        this.setOption("vScrollBarAlwaysVisible", alwaysVisible);
    };

    this.$updateScrollBarV = function() {
        this.scrollBarV.setScrollHeight(this.layerConfig.maxHeight + this.scrollMargin.v);
        this.scrollBarV.setScrollTop(this.scrollTop + this.scrollMargin.top);
    };
    this.$updateScrollBarH = function() {
        this.scrollBarH.setScrollWidth(this.layerConfig.width + 2 * this.$padding + this.scrollMargin.h);
        this.scrollBarH.setScrollLeft(this.scrollLeft + this.scrollMargin.left);
    };
    
    this.$frozen = false;
    this.freeze = function() {
        this.$frozen = true;
    };
    
    this.unfreeze = function() {
        this.$frozen = false;
    };

    this.$renderChanges = function(changes, force) {
        if (this.$changes) {
            changes |= this.$changes;
            this.$changes = 0;
        }
        if ((!this.session || !this.container.offsetWidth || this.$frozen) || (!changes && !force)) {
            this.$changes |= changes;
            return; 
        } 
        if (this.$size.$dirty) {
            this.$changes |= changes;
            return this.onResize(true);
        }
        if (!this.lineHeight) {
            this.$textLayer.checkForSizeChanges();
        }
        
        this._signal("beforeRender");
        var config = this.layerConfig;
        if (changes & this.CHANGE_FULL ||
            changes & this.CHANGE_SIZE ||
            changes & this.CHANGE_TEXT ||
            changes & this.CHANGE_LINES ||
            changes & this.CHANGE_SCROLL ||
            changes & this.CHANGE_H_SCROLL
        ) {
            changes |= this.$computeLayerConfig();
            config = this.layerConfig;
            this.$updateScrollBarV();
            if (changes & this.CHANGE_H_SCROLL)
                this.$updateScrollBarH();
            this.$gutterLayer.element.style.marginTop = (-config.offset) + "px";
            this.content.style.marginTop = (-config.offset) + "px";
            this.content.style.width = config.width + 2 * this.$padding + "px";
            this.content.style.height = config.minHeight + "px";
        }
        if (changes & this.CHANGE_H_SCROLL) {
            this.content.style.marginLeft = -this.scrollLeft + "px";
            this.scroller.className = this.scrollLeft <= 0 ? "ace_scroller" : "ace_scroller ace_scroll-left";
        }
        if (changes & this.CHANGE_FULL) {
            this.$textLayer.update(config);
            if (this.$showGutter)
                this.$gutterLayer.update(config);
            this.$markerBack.update(config);
            this.$markerFront.update(config);
            this.$cursorLayer.update(config);
            this.$moveTextAreaToCursor();
            this.$highlightGutterLine && this.$updateGutterLineHighlight();
            this._signal("afterRender");
            return;
        }
        if (changes & this.CHANGE_SCROLL) {
            if (changes & this.CHANGE_TEXT || changes & this.CHANGE_LINES)
                this.$textLayer.update(config);
            else
                this.$textLayer.scrollLines(config);

            if (this.$showGutter)
                this.$gutterLayer.update(config);
            this.$markerBack.update(config);
            this.$markerFront.update(config);
            this.$cursorLayer.update(config);
            this.$highlightGutterLine && this.$updateGutterLineHighlight();
            this.$moveTextAreaToCursor();
            this._signal("afterRender");
            return;
        }

        if (changes & this.CHANGE_TEXT) {
            this.$textLayer.update(config);
            if (this.$showGutter)
                this.$gutterLayer.update(config);
        }
        else if (changes & this.CHANGE_LINES) {
            if (this.$updateLines() || (changes & this.CHANGE_GUTTER) && this.$showGutter)
                this.$gutterLayer.update(config);
        }
        else if (changes & this.CHANGE_TEXT || changes & this.CHANGE_GUTTER) {
            if (this.$showGutter)
                this.$gutterLayer.update(config);
        }

        if (changes & this.CHANGE_CURSOR) {
            this.$cursorLayer.update(config);
            this.$moveTextAreaToCursor();
            this.$highlightGutterLine && this.$updateGutterLineHighlight();
        }

        if (changes & (this.CHANGE_MARKER | this.CHANGE_MARKER_FRONT)) {
            this.$markerFront.update(config);
        }

        if (changes & (this.CHANGE_MARKER | this.CHANGE_MARKER_BACK)) {
            this.$markerBack.update(config);
        }

        this._signal("afterRender");
    };

    
    this.$autosize = function() {
        var height = this.session.getScreenLength() * this.lineHeight;
        var maxHeight = this.$maxLines * this.lineHeight;
        var desiredHeight = Math.max(
            (this.$minLines||1) * this.lineHeight,
            Math.min(maxHeight, height)
        ) + this.scrollMargin.v + (this.$extraHeight || 0);
        var vScroll = height > maxHeight;
        
        if (desiredHeight != this.desiredHeight ||
            this.$size.height != this.desiredHeight || vScroll != this.$vScroll) {
            if (vScroll != this.$vScroll) {
                this.$vScroll = vScroll;
                this.scrollBarV.setVisible(vScroll);
            }
            
            var w = this.container.clientWidth;
            this.container.style.height = desiredHeight + "px";
            this.$updateCachedSize(true, this.$gutterWidth, w, desiredHeight);
            this.desiredHeight = desiredHeight;
        }
    };
    
    this.$computeLayerConfig = function() {
        if (this.$maxLines && this.lineHeight > 1)
            this.$autosize();

        var session = this.session;
        var size = this.$size;
        
        var hideScrollbars = size.height <= 2 * this.lineHeight;
        var screenLines = this.session.getScreenLength();
        var maxHeight = screenLines * this.lineHeight;

        var offset = this.scrollTop % this.lineHeight;
        var minHeight = size.scrollerHeight + this.lineHeight;

        var longestLine = this.$getLongestLine();
        
        var horizScroll = !hideScrollbars && (this.$hScrollBarAlwaysVisible ||
            size.scrollerWidth - longestLine - 2 * this.$padding < 0);

        var hScrollChanged = this.$horizScroll !== horizScroll;
        if (hScrollChanged) {
            this.$horizScroll = horizScroll;
            this.scrollBarH.setVisible(horizScroll);
        }
        
        if (!this.$maxLines && this.$scrollPastEnd) {
            if (this.scrollTop > maxHeight - size.scrollerHeight)
                maxHeight += Math.min(
                    (size.scrollerHeight - this.lineHeight) * this.$scrollPastEnd,
                    this.scrollTop - maxHeight + size.scrollerHeight
                );
        }
        
        var vScroll = !hideScrollbars && (this.$vScrollBarAlwaysVisible ||
            size.scrollerHeight - maxHeight < 0);
        var vScrollChanged = this.$vScroll !== vScroll;
        if (vScrollChanged) {
            this.$vScroll = vScroll;
            this.scrollBarV.setVisible(vScroll);
        }
        
        this.session.setScrollTop(Math.max(-this.scrollMargin.top,
            Math.min(this.scrollTop, maxHeight - size.scrollerHeight + this.scrollMargin.bottom)));

        this.session.setScrollLeft(Math.max(-this.scrollMargin.left, Math.min(this.scrollLeft, 
            longestLine + 2 * this.$padding - size.scrollerWidth + this.scrollMargin.right)));

        var lineCount = Math.ceil(minHeight / this.lineHeight) - 1;
        var firstRow = Math.max(0, Math.round((this.scrollTop - offset) / this.lineHeight));
        var lastRow = firstRow + lineCount;
        var firstRowScreen, firstRowHeight;
        var lineHeight = this.lineHeight;
        firstRow = session.screenToDocumentRow(firstRow, 0);
        var foldLine = session.getFoldLine(firstRow);
        if (foldLine) {
            firstRow = foldLine.start.row;
        }

        firstRowScreen = session.documentToScreenRow(firstRow, 0);
        firstRowHeight = session.getRowLength(firstRow) * lineHeight;

        lastRow = Math.min(session.screenToDocumentRow(lastRow, 0), session.getLength() - 1);
        minHeight = size.scrollerHeight + session.getRowLength(lastRow) * lineHeight +
                                                firstRowHeight;

        offset = this.scrollTop - firstRowScreen * lineHeight;

        var changes = 0;
        if (this.layerConfig.width != longestLine) 
            changes = this.CHANGE_H_SCROLL;
        if (hScrollChanged || vScrollChanged) {
            changes = this.$updateCachedSize(true, this.gutterWidth, size.width, size.height);
            this._signal("scrollbarVisibilityChanged");
            if (vScrollChanged)
                longestLine = this.$getLongestLine();
        }
        
        this.layerConfig = {
            width : longestLine,
            padding : this.$padding,
            firstRow : firstRow,
            firstRowScreen: firstRowScreen,
            lastRow : lastRow,
            lineHeight : lineHeight,
            characterWidth : this.characterWidth,
            minHeight : minHeight,
            maxHeight : maxHeight,
            offset : offset,
            gutterOffset : Math.max(0, Math.ceil((offset + size.height - size.scrollerHeight) / lineHeight)),
            height : this.$size.scrollerHeight
        };

        return changes;
    };

    this.$updateLines = function() {
        var firstRow = this.$changedLines.firstRow;
        var lastRow = this.$changedLines.lastRow;
        this.$changedLines = null;

        var layerConfig = this.layerConfig;

        if (firstRow > layerConfig.lastRow + 1) { return; }
        if (lastRow < layerConfig.firstRow) { return; }
        if (lastRow === Infinity) {
            if (this.$showGutter)
                this.$gutterLayer.update(layerConfig);
            this.$textLayer.update(layerConfig);
            return;
        }
        this.$textLayer.updateLines(layerConfig, firstRow, lastRow);
        return true;
    };

    this.$getLongestLine = function() {
        var charCount = this.session.getScreenWidth();
        if (this.showInvisibles && !this.session.$useWrapMode)
            charCount += 1;

        return Math.max(this.$size.scrollerWidth - 2 * this.$padding, Math.round(charCount * this.characterWidth));
    };
    this.updateFrontMarkers = function() {
        this.$markerFront.setMarkers(this.session.getMarkers(true));
        this.$loop.schedule(this.CHANGE_MARKER_FRONT);
    };
    this.updateBackMarkers = function() {
        this.$markerBack.setMarkers(this.session.getMarkers());
        this.$loop.schedule(this.CHANGE_MARKER_BACK);
    };
    this.addGutterDecoration = function(row, className){
        this.$gutterLayer.addGutterDecoration(row, className);
    };
    this.removeGutterDecoration = function(row, className){
        this.$gutterLayer.removeGutterDecoration(row, className);
    };
    this.updateBreakpoints = function(rows) {
        this.$loop.schedule(this.CHANGE_GUTTER);
    };
    this.setAnnotations = function(annotations) {
        this.$gutterLayer.setAnnotations(annotations);
        this.$loop.schedule(this.CHANGE_GUTTER);
    };
    this.updateCursor = function() {
        this.$loop.schedule(this.CHANGE_CURSOR);
    };
    this.hideCursor = function() {
        this.$cursorLayer.hideCursor();
    };
    this.showCursor = function() {
        this.$cursorLayer.showCursor();
    };

    this.scrollSelectionIntoView = function(anchor, lead, offset) {
        this.scrollCursorIntoView(anchor, offset);
        this.scrollCursorIntoView(lead, offset);
    };
    this.scrollCursorIntoView = function(cursor, offset, $viewMargin) {
        if (this.$size.scrollerHeight === 0)
            return;

        var pos = this.$cursorLayer.getPixelPosition(cursor);

        var left = pos.left;
        var top = pos.top;
        
        var topMargin = $viewMargin && $viewMargin.top || 0;
        var bottomMargin = $viewMargin && $viewMargin.bottom || 0;
        
        var scrollTop = this.$scrollAnimation ? this.session.getScrollTop() : this.scrollTop;
        
        if (scrollTop + topMargin > top) {
            if (offset)
                top -= offset * this.$size.scrollerHeight;
            if (top === 0)
                top = -this.scrollMargin.top;
            this.session.setScrollTop(top);
        } else if (scrollTop + this.$size.scrollerHeight - bottomMargin < top + this.lineHeight) {
            if (offset)
                top += offset * this.$size.scrollerHeight;
            this.session.setScrollTop(top + this.lineHeight - this.$size.scrollerHeight);
        }

        var scrollLeft = this.scrollLeft;

        if (scrollLeft > left) {
            if (left < this.$padding + 2 * this.layerConfig.characterWidth)
                left = -this.scrollMargin.left;
            this.session.setScrollLeft(left);
        } else if (scrollLeft + this.$size.scrollerWidth < left + this.characterWidth) {
            this.session.setScrollLeft(Math.round(left + this.characterWidth - this.$size.scrollerWidth));
        } else if (scrollLeft <= this.$padding && left - scrollLeft < this.characterWidth) {
            this.session.setScrollLeft(0);
        }
    };
    this.getScrollTop = function() {
        return this.session.getScrollTop();
    };
    this.getScrollLeft = function() {
        return this.session.getScrollLeft();
    };
    this.getScrollTopRow = function() {
        return this.scrollTop / this.lineHeight;
    };
    this.getScrollBottomRow = function() {
        return Math.max(0, Math.floor((this.scrollTop + this.$size.scrollerHeight) / this.lineHeight) - 1);
    };
    this.scrollToRow = function(row) {
        this.session.setScrollTop(row * this.lineHeight);
    };

    this.alignCursor = function(cursor, alignment) {
        if (typeof cursor == "number")
            cursor = {row: cursor, column: 0};

        var pos = this.$cursorLayer.getPixelPosition(cursor);
        var h = this.$size.scrollerHeight - this.lineHeight;
        var offset = pos.top - h * (alignment || 0);

        this.session.setScrollTop(offset);
        return offset;
    };

    this.STEPS = 8;
    this.$calcSteps = function(fromValue, toValue){
        var i = 0;
        var l = this.STEPS;
        var steps = [];

        var func  = function(t, x_min, dx) {
            return dx * (Math.pow(t - 1, 3) + 1) + x_min;
        };

        for (i = 0; i < l; ++i)
            steps.push(func(i / this.STEPS, fromValue, toValue - fromValue));

        return steps;
    };
    this.scrollToLine = function(line, center, animate, callback) {
        var pos = this.$cursorLayer.getPixelPosition({row: line, column: 0});
        var offset = pos.top;
        if (center)
            offset -= this.$size.scrollerHeight / 2;

        var initialScroll = this.scrollTop;
        this.session.setScrollTop(offset);
        if (animate !== false)
            this.animateScrolling(initialScroll, callback);
    };

    this.animateScrolling = function(fromValue, callback) {
        var toValue = this.scrollTop;
        if (!this.$animatedScroll)
            return;
        var _self = this;
        
        if (fromValue == toValue)
            return;
        
        if (this.$scrollAnimation) {
            var oldSteps = this.$scrollAnimation.steps;
            if (oldSteps.length) {
                fromValue = oldSteps[0];
                if (fromValue == toValue)
                    return;
            }
        }
        
        var steps = _self.$calcSteps(fromValue, toValue);
        this.$scrollAnimation = {from: fromValue, to: toValue, steps: steps};

        clearInterval(this.$timer);

        _self.session.setScrollTop(steps.shift());
        _self.session.$scrollTop = toValue;
        this.$timer = setInterval(function() {
            if (steps.length) {
                _self.session.setScrollTop(steps.shift());
                _self.session.$scrollTop = toValue;
            } else if (toValue != null) {
                _self.session.$scrollTop = -1;
                _self.session.setScrollTop(toValue);
                toValue = null;
            } else {
                _self.$timer = clearInterval(_self.$timer);
                _self.$scrollAnimation = null;
                callback && callback();
            }
        }, 10);
    };
    this.scrollToY = function(scrollTop) {
        if (this.scrollTop !== scrollTop) {
            this.$loop.schedule(this.CHANGE_SCROLL);
            this.scrollTop = scrollTop;
        }
    };
    this.scrollToX = function(scrollLeft) {
        if (this.scrollLeft !== scrollLeft)
            this.scrollLeft = scrollLeft;
        this.$loop.schedule(this.CHANGE_H_SCROLL);
    };
    this.scrollTo = function(x, y) {
        this.session.setScrollTop(y);
        this.session.setScrollLeft(y);
    };
    this.scrollBy = function(deltaX, deltaY) {
        deltaY && this.session.setScrollTop(this.session.getScrollTop() + deltaY);
        deltaX && this.session.setScrollLeft(this.session.getScrollLeft() + deltaX);
    };
    this.isScrollableBy = function(deltaX, deltaY) {
        if (deltaY < 0 && this.session.getScrollTop() >= 1 - this.scrollMargin.top)
           return true;
        if (deltaY > 0 && this.session.getScrollTop() + this.$size.scrollerHeight
            - this.layerConfig.maxHeight - (this.$size.scrollerHeight - this.lineHeight) * this.$scrollPastEnd
            < -1 + this.scrollMargin.bottom)
           return true;
        if (deltaX < 0 && this.session.getScrollLeft() >= 1 - this.scrollMargin.left)
            return true;
        if (deltaX > 0 && this.session.getScrollLeft() + this.$size.scrollerWidth
            - this.layerConfig.width < -1 + this.scrollMargin.right)
           return true;
    };

    this.pixelToScreenCoordinates = function(x, y) {
        var canvasPos = this.scroller.getBoundingClientRect();

        var offset = (x + this.scrollLeft - canvasPos.left - this.$padding) / this.characterWidth;
        var row = Math.floor((y + this.scrollTop - canvasPos.top) / this.lineHeight);
        var col = Math.round(offset);

        return {row: row, column: col, side: offset - col > 0 ? 1 : -1};
    };

    this.screenToTextCoordinates = function(x, y) {
        var canvasPos = this.scroller.getBoundingClientRect();

        var col = Math.round(
            (x + this.scrollLeft - canvasPos.left - this.$padding) / this.characterWidth
        );

        var row = (y + this.scrollTop - canvasPos.top) / this.lineHeight;

        return this.session.screenToDocumentPosition(row, Math.max(col, 0));
    };
    this.textToScreenCoordinates = function(row, column) {
        var canvasPos = this.scroller.getBoundingClientRect();
        var pos = this.session.documentToScreenPosition(row, column);

        var x = this.$padding + Math.round(pos.column * this.characterWidth);
        var y = pos.row * this.lineHeight;

        return {
            pageX: canvasPos.left + x - this.scrollLeft,
            pageY: canvasPos.top + y - this.scrollTop
        };
    };
    this.visualizeFocus = function() {
        dom.addCssClass(this.container, "ace_focus");
    };
    this.visualizeBlur = function() {
        dom.removeCssClass(this.container, "ace_focus");
    };
    this.showComposition = function(position) {
        if (!this.$composition)
            this.$composition = {
                keepTextAreaAtCursor: this.$keepTextAreaAtCursor,
                cssText: this.textarea.style.cssText
            };

        this.$keepTextAreaAtCursor = true;
        dom.addCssClass(this.textarea, "ace_composition");
        this.textarea.style.cssText = "";
        this.$moveTextAreaToCursor();
    };
    this.setCompositionText = function(text) {
        this.$moveTextAreaToCursor();
    };
    this.hideComposition = function() {
        if (!this.$composition)
            return;

        dom.removeCssClass(this.textarea, "ace_composition");
        this.$keepTextAreaAtCursor = this.$composition.keepTextAreaAtCursor;
        this.textarea.style.cssText = this.$composition.cssText;
        this.$composition = null;
    };
    this.setTheme = function(theme, cb) {
        var _self = this;
        this.$themeId = theme;
        _self._dispatchEvent('themeChange',{theme:theme});

        if (!theme || typeof theme == "string") {
            var moduleName = theme || this.$options.theme.initialValue;
            config.loadModule(["theme", moduleName], afterLoad);
        } else {
            afterLoad(theme);
        }

        function afterLoad(module) {
            if (_self.$themeId != theme)
                return cb && cb();
            if (!module.cssClass)
                return;
            dom.importCssString(
                module.cssText,
                module.cssClass,
                _self.container.ownerDocument
            );

            if (_self.theme)
                dom.removeCssClass(_self.container, _self.theme.cssClass);

            var padding = "padding" in module ? module.padding 
                : "padding" in (_self.theme || {}) ? 4 : _self.$padding;
            if (_self.$padding && padding != _self.$padding)
                _self.setPadding(padding);
            _self.$theme = module.cssClass;

            _self.theme = module;
            dom.addCssClass(_self.container, module.cssClass);
            dom.setCssClass(_self.container, "ace_dark", module.isDark);
            if (_self.$size) {
                _self.$size.width = 0;
                _self.$updateSizeAsync();
            }

            _self._dispatchEvent('themeLoaded', {theme:module});
            cb && cb();
        }
    };
    this.getTheme = function() {
        return this.$themeId;
    };
    this.setStyle = function(style, include) {
        dom.setCssClass(this.container, style, include !== false);
    };
    this.unsetStyle = function(style) {
        dom.removeCssClass(this.container, style);
    };
    
    this.setCursorStyle = function(style) {
        if (this.content.style.cursor != style)
            this.content.style.cursor = style;
    };
    this.setMouseCursor = function(cursorStyle) {
        this.content.style.cursor = cursorStyle;
    };
    this.destroy = function() {
        this.$textLayer.destroy();
        this.$cursorLayer.destroy();
    };

}).call(VirtualRenderer.prototype);


config.defineOptions(VirtualRenderer.prototype, "renderer", {
    animatedScroll: {initialValue: false},
    showInvisibles: {
        set: function(value) {
            if (this.$textLayer.setShowInvisibles(value))
                this.$loop.schedule(this.CHANGE_TEXT);
        },
        initialValue: false
    },
    showPrintMargin: {
        set: function() { this.$updatePrintMargin(); },
        initialValue: true
    },
    printMarginColumn: {
        set: function() { this.$updatePrintMargin(); },
        initialValue: 80
    },
    printMargin: {
        set: function(val) {
            if (typeof val == "number")
                this.$printMarginColumn = val;
            this.$showPrintMargin = !!val;
            this.$updatePrintMargin();
        },
        get: function() {
            return this.$showPrintMargin && this.$printMarginColumn; 
        }
    },
    showGutter: {
        set: function(show){
            this.$gutter.style.display = show ? "block" : "none";
            this.$loop.schedule(this.CHANGE_FULL);
            this.onGutterResize();
        },
        initialValue: true
    },
    fadeFoldWidgets: {
        set: function(show) {
            dom.setCssClass(this.$gutter, "ace_fade-fold-widgets", show);
        },
        initialValue: false
    },
    showFoldWidgets: {
        set: function(show) {this.$gutterLayer.setShowFoldWidgets(show)},
        initialValue: true
    },
    showLineNumbers: {
        set: function(show) {
            this.$gutterLayer.setShowLineNumbers(show);
            this.$loop.schedule(this.CHANGE_GUTTER);
        },
        initialValue: true
    },
    displayIndentGuides: {
        set: function(show) {
            if (this.$textLayer.setDisplayIndentGuides(show))
                this.$loop.schedule(this.CHANGE_TEXT);
        },
        initialValue: true
    },
    highlightGutterLine: {
        set: function(shouldHighlight) {
            if (!this.$gutterLineHighlight) {
                this.$gutterLineHighlight = dom.createElement("div");
                this.$gutterLineHighlight.className = "ace_gutter-active-line";
                this.$gutter.appendChild(this.$gutterLineHighlight);
                return;
            }

            this.$gutterLineHighlight.style.display = shouldHighlight ? "" : "none";
            if (this.$cursorLayer.$pixelPos)
                this.$updateGutterLineHighlight();
        },
        initialValue: false,
        value: true
    },
    hScrollBarAlwaysVisible: {
        set: function(val) {
            if (!this.$hScrollBarAlwaysVisible || !this.$horizScroll)
                this.$loop.schedule(this.CHANGE_SCROLL);
        },
        initialValue: false
    },
    vScrollBarAlwaysVisible: {
        set: function(val) {
            if (!this.$vScrollBarAlwaysVisible || !this.$vScroll)
                this.$loop.schedule(this.CHANGE_SCROLL);
        },
        initialValue: false
    },
    fontSize:  {
        set: function(size) {
            if (typeof size == "number")
                size = size + "px";
            this.container.style.fontSize = size;
            this.updateFontSize();
        },
        initialValue: 12
    },
    fontFamily: {
        set: function(name) {
            this.container.style.fontFamily = name;
            this.updateFontSize();
        }
    },
    maxLines: {
        set: function(val) {
            this.updateFull();
        }
    },
    minLines: {
        set: function(val) {
            this.updateFull();
        }
    },
    scrollPastEnd: {
        set: function(val) {
            val = +val || 0;
            if (this.$scrollPastEnd == val)
                return;
            this.$scrollPastEnd = val;
            this.$loop.schedule(this.CHANGE_SCROLL);
        },
        initialValue: 0,
        handlesSet: true
    },
    fixedWidthGutter: {
        set: function(val) {
            this.$gutterLayer.$fixedWidth = !!val;
            this.$loop.schedule(this.CHANGE_GUTTER);
        }
    },
    theme: {
        set: function(val) { this.setTheme(val) },
        get: function() { return this.$themeId || this.theme; },
        initialValue: "./theme/textmate",
        handlesSet: true
    }
});

exports.VirtualRenderer = VirtualRenderer;
});

ace.define('ace/config', ['require', 'exports', 'module' , 'ace/lib/lang', 'ace/lib/oop', 'ace/lib/net', 'ace/lib/event_emitter'], function(require, exports, module) {
"no use strict";

var lang = require("./lib/lang");
var oop = require("./lib/oop");
var net = require("./lib/net");
var EventEmitter = require("./lib/event_emitter").EventEmitter;

var global = (function() {
    return this;
})();

var options = {
    packaged: false,
    workerPath: null,
    modePath: null,
    themePath: null,
    basePath: "",
    suffix: ".js",
    $moduleUrls: {}
};

exports.get = function(key) {
    if (!options.hasOwnProperty(key))
        throw new Error("Unknown config key: " + key);

    return options[key];
};

exports.set = function(key, value) {
    if (!options.hasOwnProperty(key))
        throw new Error("Unknown config key: " + key);

    options[key] = value;
};

exports.all = function() {
    return lang.copyObject(options);
};
oop.implement(exports, EventEmitter);

exports.moduleUrl = function(name, component) {
    if (options.$moduleUrls[name])
        return options.$moduleUrls[name];

    var parts = name.split("/");
    component = component || parts[parts.length - 2] || "";
    var sep = component == "snippets" ? "/" : "-";
    var base = parts[parts.length - 1];    
    if (sep == "-") {
        var re = new RegExp("^" + component + "[\\-_]|[\\-_]" + component + "$", "g");
        base = base.replace(re, "");
    }

    if ((!base || base == component) && parts.length > 1)
        base = parts[parts.length - 2];
    var path = options[component + "Path"];
    if (path == null) {
        path = options.basePath;
    } else if (sep == "/") {
        component = sep = "";
    }
    if (path && path.slice(-1) != "/")
        path += "/";
    return path + component + sep + base + this.get("suffix");
};

exports.setModuleUrl = function(name, subst) {
    return options.$moduleUrls[name] = subst;
};

exports.$loading = {};
exports.loadModule = function(moduleName, onLoad) {
    var module, moduleType;
    if (Array.isArray(moduleName)) {
        moduleType = moduleName[0];
        moduleName = moduleName[1];
    }

    try {
        module = require(moduleName);
    } catch (e) {}
    if (module && !exports.$loading[moduleName])
        return onLoad && onLoad(module);

    if (!exports.$loading[moduleName])
        exports.$loading[moduleName] = [];

    exports.$loading[moduleName].push(onLoad);

    if (exports.$loading[moduleName].length > 1)
        return;

    var afterLoad = function() {
        require([moduleName], function(module) {
            exports._emit("load.module", {name: moduleName, module: module});
            var listeners = exports.$loading[moduleName];
            exports.$loading[moduleName] = null;
            listeners.forEach(function(onLoad) {
                onLoad && onLoad(module);
            });
        });
    };

    if (!exports.get("packaged"))
        return afterLoad();
    net.loadScript(exports.moduleUrl(moduleName, moduleType), afterLoad);
};
init(true);function init(packaged) {

    options.packaged = packaged || require.packaged || module.packaged || (global.define && define.packaged);

    if (!global.document)
        return "";

    var scriptOptions = {};
    var scriptUrl = "";

    var scripts = document.getElementsByTagName("script");
    for (var i=0; i<scripts.length; i++) {
        var script = scripts[i];

        var src = script.src || script.getAttribute("src");
        if (!src)
            continue;

        var attributes = script.attributes;
        for (var j=0, l=attributes.length; j < l; j++) {
            var attr = attributes[j];
            if (attr.name.indexOf("data-ace-") === 0) {
                scriptOptions[deHyphenate(attr.name.replace(/^data-ace-/, ""))] = attr.value;
            }
        }

        var m = src.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);
        if (m)
            scriptUrl = m[1];
    }

    if (scriptUrl) {
        scriptOptions.base = scriptOptions.base || scriptUrl;
        scriptOptions.packaged = true;
    }

    scriptOptions.basePath = scriptOptions.base;
    scriptOptions.workerPath = scriptOptions.workerPath || scriptOptions.base;
    scriptOptions.modePath = scriptOptions.modePath || scriptOptions.base;
    scriptOptions.themePath = scriptOptions.themePath || scriptOptions.base;
    delete scriptOptions.base;

    for (var key in scriptOptions)
        if (typeof scriptOptions[key] !== "undefined")
            exports.set(key, scriptOptions[key]);
};

exports.init = init;

function deHyphenate(str) {
    return str.replace(/-(.)/g, function(m, m1) { return m1.toUpperCase(); });
}

var optionsProvider = {
    setOptions: function(optList) {
        Object.keys(optList).forEach(function(key) {
            this.setOption(key, optList[key]);
        }, this);
    },
    getOptions: function(optionNames) {
        var result = {};
        if (!optionNames) {
            optionNames = Object.keys(this.$options);
        } else if (!Array.isArray(optionNames)) {
            result = optionNames;
            optionNames = Object.keys(result);
        }
        optionNames.forEach(function(key) {
            result[key] = this.getOption(key);
        }, this);
        return result;
    },
    setOption: function(name, value) {
        if (this["$" + name] === value)
            return;
        var opt = this.$options[name];
        if (!opt) {
            if (typeof console != "undefined" && console.warn)
                console.warn('misspelled option "' + name + '"');
            return undefined;
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].setOption(name, value);

        if (!opt.handlesSet)
            this["$" + name] = value;
        if (opt && opt.set)
            opt.set.call(this, value);
    },
    getOption: function(name) {
        var opt = this.$options[name];
        if (!opt) {
            if (typeof console != "undefined" && console.warn)
                console.warn('misspelled option "' + name + '"');
            return undefined;
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].getOption(name);
        return opt && opt.get ? opt.get.call(this) : this["$" + name];
    }
};

var defaultOptions = {};
exports.defineOptions = function(obj, path, options) {
    if (!obj.$options)
        defaultOptions[path] = obj.$options = {};

    Object.keys(options).forEach(function(key) {
        var opt = options[key];
        if (typeof opt == "string")
            opt = {forwardTo: opt};

        opt.name || (opt.name = key);
        obj.$options[opt.name] = opt;
        if ("initialValue" in opt)
            obj["$" + opt.name] = opt.initialValue;
    });
    oop.implement(obj, optionsProvider);

    return this;
};

exports.resetOptions = function(obj) {
    Object.keys(obj.$options).forEach(function(key) {
        var opt = obj.$options[key];
        if ("value" in opt)
            obj.setOption(key, opt.value);
    });
};

exports.setDefaultValue = function(path, name, value) {
    var opts = defaultOptions[path] || (defaultOptions[path] = {});
    if (opts[name]) {
        if (opts.forwardTo)
            exports.setDefaultValue(opts.forwardTo, name, value);
        else
            opts[name].value = value;
    }
};

exports.setDefaultValues = function(path, optionHash) {
    Object.keys(optionHash).forEach(function(key) {
        exports.setDefaultValue(path, key, optionHash[key]);
    });
};

});

ace.define('ace/layer/gutter', ['require', 'exports', 'module' , 'ace/lib/dom', 'ace/lib/oop', 'ace/lib/lang', 'ace/lib/event_emitter'], function(require, exports, module) {


var dom = require("../lib/dom");
var oop = require("../lib/oop");
var lang = require("../lib/lang");
var EventEmitter = require("../lib/event_emitter").EventEmitter;

var Gutter = function(parentEl) {
    this.element = dom.createElement("div");
    this.element.className = "ace_layer ace_gutter-layer";
    parentEl.appendChild(this.element);
    this.setShowFoldWidgets(this.$showFoldWidgets);
    
    this.gutterWidth = 0;

    this.$annotations = [];
    this.$updateAnnotations = this.$updateAnnotations.bind(this);

    this.$cells = [];
};

(function() {

    oop.implement(this, EventEmitter);

    this.setSession = function(session) {
        if (this.session)
            this.session.removeEventListener("change", this.$updateAnnotations);
        this.session = session;
        session.on("change", this.$updateAnnotations);
    };

    this.addGutterDecoration = function(row, className){
        if (window.console)
            console.warn && console.warn("deprecated use session.addGutterDecoration");
        this.session.addGutterDecoration(row, className);
    };

    this.removeGutterDecoration = function(row, className){
        if (window.console)
            console.warn && console.warn("deprecated use session.removeGutterDecoration");
        this.session.removeGutterDecoration(row, className);
    };

    this.setAnnotations = function(annotations) {
        this.$annotations = [];
        for (var i = 0; i < annotations.length; i++) {
            var annotation = annotations[i];
            var row = annotation.row;
            var rowInfo = this.$annotations[row];
            if (!rowInfo)
                rowInfo = this.$annotations[row] = {text: []};
           
            var annoText = annotation.text;
            annoText = annoText ? lang.escapeHTML(annoText) : annotation.html || "";

            if (rowInfo.text.indexOf(annoText) === -1)
                rowInfo.text.push(annoText);

            var type = annotation.type;
            if (type == "error")
                rowInfo.className = " ace_error";
            else if (type == "warning" && rowInfo.className != " ace_error")
                rowInfo.className = " ace_warning";
            else if (type == "info" && (!rowInfo.className))
                rowInfo.className = " ace_info";
        }
    };

    this.$updateAnnotations = function (e) {
        if (!this.$annotations.length)
            return;
        var delta = e.data;
        var range = delta.range;
        var firstRow = range.start.row;
        var len = range.end.row - firstRow;
        if (len === 0) {
        } else if (delta.action == "removeText" || delta.action == "removeLines") {
            this.$annotations.splice(firstRow, len + 1, null);
        } else {
            var args = new Array(len + 1);
            args.unshift(firstRow, 1);
            this.$annotations.splice.apply(this.$annotations, args);
        }
    };

    this.update = function(config) {
        var session = this.session;
        var firstRow = config.firstRow;
        var lastRow = Math.min(config.lastRow + config.gutterOffset,  // needed to compensate for hor scollbar
            session.getLength() - 1);
        var fold = session.getNextFoldLine(firstRow);
        var foldStart = fold ? fold.start.row : Infinity;
        var foldWidgets = this.$showFoldWidgets && session.foldWidgets;
        var breakpoints = session.$breakpoints;
        var decorations = session.$decorations;
        var firstLineNumber = session.$firstLineNumber;
        var lastLineNumber = 0;
        
        var gutterRenderer = session.gutterRenderer || this.$renderer;

        var cell = null;
        var index = -1;
        var row = firstRow;
        while (true) {
            if (row > foldStart) {
                row = fold.end.row + 1;
                fold = session.getNextFoldLine(row, fold);
                foldStart = fold ? fold.start.row : Infinity;
            }
            if (row > lastRow) {
                while (this.$cells.length > index + 1) {
                    cell = this.$cells.pop();
                    this.element.removeChild(cell.element);
                }
                break;
            }

            cell = this.$cells[++index];
            if (!cell) {
                cell = {element: null, textNode: null, foldWidget: null};
                cell.element = dom.createElement("div");
                cell.textNode = document.createTextNode('');
                cell.element.appendChild(cell.textNode);
                this.element.appendChild(cell.element);
                this.$cells[index] = cell;
            }

            var className = "ace_gutter-cell ";
            if (breakpoints[row])
                className += breakpoints[row];
            if (decorations[row])
                className += decorations[row];
            if (this.$annotations[row])
                className += this.$annotations[row].className;
            if (cell.element.className != className)
                cell.element.className = className;

            var height = session.getRowLength(row) * config.lineHeight + "px";
            if (height != cell.element.style.height)
                cell.element.style.height = height;

            if (foldWidgets) {
                var c = foldWidgets[row];
                if (c == null)
                    c = foldWidgets[row] = session.getFoldWidget(row);
            }

            if (c) {
                if (!cell.foldWidget) {
                    cell.foldWidget = dom.createElement("span");
                    cell.element.appendChild(cell.foldWidget);
                }
                var className = "ace_fold-widget ace_" + c;
                if (c == "start" && row == foldStart && row < fold.end.row)
                    className += " ace_closed";
                else
                    className += " ace_open";
                if (cell.foldWidget.className != className)
                    cell.foldWidget.className = className;

                var height = config.lineHeight + "px";
                if (cell.foldWidget.style.height != height)
                    cell.foldWidget.style.height = height;
            } else {
                if (cell.foldWidget) {
                    cell.element.removeChild(cell.foldWidget);
                    cell.foldWidget = null;
                }
            }
            
            var text = lastLineNumber = gutterRenderer
                ? gutterRenderer.getText(session, row)
                : row + firstLineNumber;
            if (text != cell.textNode.data)
                cell.textNode.data = text;

            row++;
        }

        this.element.style.height = config.minHeight + "px";

        if (this.$fixedWidth || session.$useWrapMode)
            lastLineNumber = session.getLength() + firstLineNumber;

        var gutterWidth = gutterRenderer 
            ? gutterRenderer.getWidth(session, lastLineNumber, config)
            : lastLineNumber.toString().length * config.characterWidth;
        
        var padding = this.$padding || this.$computePadding();
        gutterWidth += padding.left + padding.right;
        if (gutterWidth !== this.gutterWidth && !isNaN(gutterWidth)) {
            this.gutterWidth = gutterWidth;
            this.element.style.width = Math.ceil(this.gutterWidth) + "px";
            this._emit("changeGutterWidth", gutterWidth);
        }
    };

    this.$fixedWidth = false;
    
    this.$showLineNumbers = true;
    this.$renderer = "";
    this.setShowLineNumbers = function(show) {
        this.$renderer = !show && {
            getWidth: function() {return ""},
            getText: function() {return ""}
        };
    };
    
    this.getShowLineNumbers = function() {
        return this.$showLineNumbers;
    };
    
    this.$showFoldWidgets = true;
    this.setShowFoldWidgets = function(show) {
        if (show)
            dom.addCssClass(this.element, "ace_folding-enabled");
        else
            dom.removeCssClass(this.element, "ace_folding-enabled");

        this.$showFoldWidgets = show;
        this.$padding = null;
    };
    
    this.getShowFoldWidgets = function() {
        return this.$showFoldWidgets;
    };

    this.$computePadding = function() {
        if (!this.element.firstChild)
            return {left: 0, right: 0};
        var style = dom.computedStyle(this.element.firstChild);
        this.$padding = {};
        this.$padding.left = parseInt(style.paddingLeft) + 1 || 0;
        this.$padding.right = parseInt(style.paddingRight) || 0;
        return this.$padding;
    };

    this.getRegion = function(point) {
        var padding = this.$padding || this.$computePadding();
        var rect = this.element.getBoundingClientRect();
        if (point.x < padding.left + rect.left)
            return "markers";
        if (this.$showFoldWidgets && point.x > rect.right - padding.right)
            return "foldWidgets";
    };

}).call(Gutter.prototype);

exports.Gutter = Gutter;

});

ace.define('ace/mouse/dragdrop_handler', ['require', 'exports', 'module' , 'ace/lib/dom', 'ace/lib/event', 'ace/lib/useragent'], function(require, exports, module) {


var dom = require("../lib/dom");
var event = require("../lib/event");
var useragent = require("../lib/useragent");

var AUTOSCROLL_DELAY = 200;
var SCROLL_CURSOR_DELAY = 200;
var SCROLL_CURSOR_HYSTERESIS = 5;

function DragdropHandler(mouseHandler) {

    var editor = mouseHandler.editor;

    var blankImage = dom.createElement("img");
    blankImage.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
    if (useragent.isOpera)
        blankImage.style.cssText = "width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;";

    var exports = ["dragWait", "dragWaitEnd", "startDrag", "dragReadyEnd", "onMouseDrag"];

     exports.forEach(function(x) {
         mouseHandler[x] = this[x];
    }, this);
    editor.addEventListener("mousedown", this.onMouseDown.bind(mouseHandler));


    var mouseTarget = editor.container;
    var dragSelectionMarker, x, y;
    var timerId, range;
    var dragCursor, counter = 0;
    var dragOperation;
    var isInternal;
    var autoScrollStartTime;
    var cursorMovedTime;
    var cursorPointOnCaretMoved;

    this.onDragStart = function(e) {
        if (this.cancelDrag || !mouseTarget.draggable) {
            var self = this;
            setTimeout(function(){
                self.startSelect();
                self.captureMouse(e);
            }, 0);
            return e.preventDefault();
        }
        range = editor.getSelectionRange();

        var dataTransfer = e.dataTransfer;
        dataTransfer.effectAllowed = editor.getReadOnly() ? "copy" : "copyMove";
        if (useragent.isOpera) {
            editor.container.appendChild(blankImage);
            blankImage._top = blankImage.offsetTop;
        }
        dataTransfer.setDragImage && dataTransfer.setDragImage(blankImage, 0, 0);
        if (useragent.isOpera) {
            editor.container.removeChild(blankImage);
        }
        dataTransfer.clearData();
        dataTransfer.setData("Text", editor.session.getTextRange());

        isInternal = true;
        this.setState("drag");
    };

    this.onDragEnd = function(e) {
        mouseTarget.draggable = false;
        isInternal = false;
        this.setState(null);
        if (!editor.getReadOnly()) {
            var dropEffect = e.dataTransfer.dropEffect;
            if (!dragOperation && dropEffect == "move")
                editor.session.remove(editor.getSelectionRange());
            editor.renderer.$cursorLayer.setBlinking(true);
        }
        this.editor.unsetStyle("ace_dragging");
    };

    this.onDragEnter = function(e) {
        if (editor.getReadOnly() || !canAccept(e.dataTransfer))
            return;
        if (!dragSelectionMarker)
            addDragMarker();
        counter++;
        e.dataTransfer.dropEffect = dragOperation = getDropEffect(e);
        return event.preventDefault(e);
    };

    this.onDragOver = function(e) {
        if (editor.getReadOnly() || !canAccept(e.dataTransfer))
            return;
        if (!dragSelectionMarker) {
            addDragMarker();
            counter++;
        }
        if (onMouseMoveTimer !== null)
            onMouseMoveTimer = null;
        x = e.clientX;
        y = e.clientY;

        e.dataTransfer.dropEffect = dragOperation = getDropEffect(e);
        return event.preventDefault(e);
    };

    this.onDragLeave = function(e) {
        counter--;
        if (counter <= 0 && dragSelectionMarker) {
            clearDragMarker();
            dragOperation = null;
            return event.preventDefault(e);
        }
    };

    this.onDrop = function(e) {
        if (!dragSelectionMarker)
            return;
        var dataTransfer = e.dataTransfer;
        if (isInternal) {
            switch (dragOperation) {
                case "move":
                    if (range.contains(dragCursor.row, dragCursor.column)) {
                        range = {
                            start: dragCursor,
                            end: dragCursor
                        };
                    } else {
                        range = editor.moveText(range, dragCursor);
                    }
                    break;
                case "copy":
                    range = editor.moveText(range, dragCursor, true);
                    break;
            }
        } else {
            var dropData = dataTransfer.getData('Text');
            range = {
                start: dragCursor,
                end: editor.session.insert(dragCursor, dropData)
            };
            editor.focus();
            dragOperation = null;
        }
        clearDragMarker();
        return event.preventDefault(e);
    };

    event.addListener(mouseTarget, "dragstart", this.onDragStart.bind(mouseHandler));
    event.addListener(mouseTarget, "dragend", this.onDragEnd.bind(mouseHandler));
    event.addListener(mouseTarget, "dragenter", this.onDragEnter.bind(mouseHandler));
    event.addListener(mouseTarget, "dragover", this.onDragOver.bind(mouseHandler));
    event.addListener(mouseTarget, "dragleave", this.onDragLeave.bind(mouseHandler));
    event.addListener(mouseTarget, "drop", this.onDrop.bind(mouseHandler));

    function scrollCursorIntoView(cursor, prevCursor) {
        var now = Date.now();
        var vMovement = !prevCursor || cursor.row != prevCursor.row;
        var hMovement = !prevCursor || cursor.column != prevCursor.column;
        if (!cursorMovedTime || vMovement || hMovement) {
            editor.$blockScrolling += 1;
            editor.moveCursorToPosition(cursor);
            editor.$blockScrolling -= 1;
            cursorMovedTime = now;
            cursorPointOnCaretMoved = {x: x, y: y};
        } else {
            var distance = calcDistance(cursorPointOnCaretMoved.x, cursorPointOnCaretMoved.y, x, y);
            if (distance > SCROLL_CURSOR_HYSTERESIS) {
                cursorMovedTime = null;
            } else if (now - cursorMovedTime >= SCROLL_CURSOR_DELAY) {
                editor.renderer.scrollCursorIntoView();
                cursorMovedTime = null;
            }
        }
    }

    function autoScroll(cursor, prevCursor) {
        var now = Date.now();
        var lineHeight = editor.renderer.layerConfig.lineHeight;
        var characterWidth = editor.renderer.layerConfig.characterWidth;
        var editorRect = editor.renderer.scroller.getBoundingClientRect();
        var offsets = {
           x: {
               left: x - editorRect.left,
               right: editorRect.right - x
           },
           y: {
               top: y - editorRect.top,
               bottom: editorRect.bottom - y
           }
        };
        var nearestXOffset = Math.min(offsets.x.left, offsets.x.right);
        var nearestYOffset = Math.min(offsets.y.top, offsets.y.bottom);
        var scrollCursor = {row: cursor.row, column: cursor.column};
        if (nearestXOffset / characterWidth <= 2) {
            scrollCursor.column += (offsets.x.left < offsets.x.right ? -3 : +2);
        }
        if (nearestYOffset / lineHeight <= 1) {
            scrollCursor.row += (offsets.y.top < offsets.y.bottom ? -1 : +1);
        }
        var vScroll = cursor.row != scrollCursor.row;
        var hScroll = cursor.column != scrollCursor.column;
        var vMovement = !prevCursor || cursor.row != prevCursor.row;
        if (vScroll || (hScroll && !vMovement)) {
            if (!autoScrollStartTime)
                autoScrollStartTime = now;
            else if (now - autoScrollStartTime >= AUTOSCROLL_DELAY)
                editor.renderer.scrollCursorIntoView(scrollCursor);
        } else {
            autoScrollStartTime = null;
        }
    }

    function onDragInterval() {
        var prevCursor = dragCursor;
        dragCursor = editor.renderer.screenToTextCoordinates(x, y);
        scrollCursorIntoView(dragCursor, prevCursor);
        autoScroll(dragCursor, prevCursor);
    }

    function addDragMarker() {
        range = editor.selection.toOrientedRange();
        dragSelectionMarker = editor.session.addMarker(range, "ace_selection", editor.getSelectionStyle());
        editor.clearSelection();
        if (editor.isFocused())
            editor.renderer.$cursorLayer.setBlinking(false);
        clearInterval(timerId);
        timerId = setInterval(onDragInterval, 20);
        counter = 0;
        event.addListener(document, "mousemove", onMouseMove);
    }

    function clearDragMarker() {
        clearInterval(timerId);
        editor.session.removeMarker(dragSelectionMarker);
        dragSelectionMarker = null;
        editor.$blockScrolling += 1;
        editor.selection.fromOrientedRange(range);
        editor.$blockScrolling -= 1;
        if (editor.isFocused() && !isInternal)
            editor.renderer.$cursorLayer.setBlinking(!editor.getReadOnly());
        range = null;
        counter = 0;
        autoScrollStartTime = null;
        cursorMovedTime = null;
        event.removeListener(document, "mousemove", onMouseMove);
    }
    var onMouseMoveTimer = null;
    function onMouseMove() {
        if (onMouseMoveTimer == null) {
            onMouseMoveTimer = setTimeout(function() {
                if (onMouseMoveTimer != null && dragSelectionMarker)
                    clearDragMarker();
            }, 20);
        }
    }

    function canAccept(dataTransfer) {
        var types = dataTransfer.types;
        return !types || Array.prototype.some.call(types, function(type) {
            return type == 'text/plain' || type == 'Text';
        });
    }

    function getDropEffect(e) {
        var copyAllowed = ['copy', 'copymove', 'all', 'uninitialized'];
        var moveAllowed = ['move', 'copymove', 'linkmove', 'all', 'uninitialized'];

        var copyModifierState = useragent.isMac ? e.altKey : e.ctrlKey;
        var effectAllowed = "uninitialized";
        try {
            effectAllowed = e.dataTransfer.effectAllowed.toLowerCase();
        } catch (e) {}
        var dropEffect = "none";

        if (copyModifierState && copyAllowed.indexOf(effectAllowed) >= 0)
            dropEffect = "copy";
        else if (moveAllowed.indexOf(effectAllowed) >= 0)
            dropEffect = "move";
        else if (copyAllowed.indexOf(effectAllowed) >= 0)
            dropEffect = "copy";

        return dropEffect;
    }
}

(function() {

    this.dragWait = function() {
        var interval = Date.now() - this.mousedownEvent.time;
        if (interval > this.editor.getDragDelay())
            this.startDrag();
    };

    this.dragWaitEnd = function() {
        var target = this.editor.container;
        target.draggable = false;
        this.startSelect(this.mousedownEvent.getDocumentPosition());
        this.selectEnd();
    };

    this.dragReadyEnd = function(e) {
        this.editor.renderer.$cursorLayer.setBlinking(!this.editor.getReadOnly());
        this.editor.unsetStyle("ace_dragging");
        this.dragWaitEnd();
    };

    this.startDrag = function(){
        this.cancelDrag = false;
        var target = this.editor.container;
        target.draggable = true;
        this.editor.renderer.$cursorLayer.setBlinking(false);
        this.editor.setStyle("ace_dragging");
        this.setState("dragReady");
    };

    this.onMouseDrag = function(e) {
        var target = this.editor.container;
        if (useragent.isIE && this.state == "dragReady") {
            var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);
            if (distance > 3)
                target.dragDrop();
        }
        if (this.state === "dragWait") {
            var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);
            if (distance > 0) {
                target.draggable = false;
                this.startSelect(this.mousedownEvent.getDocumentPosition());
            }
        }
    };

    this.onMouseDown = function(e) {
        if (!this.$dragEnabled)
            return;
        this.mousedownEvent = e;
        var editor = this.editor;

        var inSelection = e.inSelection();
        var button = e.getButton();
        var clickCount = e.domEvent.detail || 1;
        if (clickCount === 1 && button === 0 && inSelection) {
            if (e.editor.inMultiSelectMode && (e.getAccelKey() || e.getShiftKey()))
                return;
            this.mousedownEvent.time = Date.now();
            var eventTarget = e.domEvent.target || e.domEvent.srcElement;
            if ("unselectable" in eventTarget)
                eventTarget.unselectable = "on";
            if (editor.getDragDelay()) {
                if (useragent.isWebKit) {
                    this.cancelDrag = true;
                    var mouseTarget = editor.container;
                    mouseTarget.draggable = true;
                }
                this.setState("dragWait");
            } else {
                this.startDrag();
            }
            this.captureMouse(e, this.onMouseDrag.bind(this));
            e.defaultPrevented = true;
        }
    };

}).call(DragdropHandler.prototype);


function calcDistance(ax, ay, bx, by) {
    return Math.sqrt(Math.pow(bx - ax, 2) + Math.pow(by - ay, 2));
}

exports.DragdropHandler = DragdropHandler;

});

ace.define('ace/layer/marker', ['require', 'exports', 'module' , 'ace/range', 'ace/lib/dom'], function(require, exports, module) {


var Range = require("../range").Range;
var dom = require("../lib/dom");

var Marker = function(parentEl) {
    this.element = dom.createElement("div");
    this.element.className = "ace_layer ace_marker-layer";
    parentEl.appendChild(this.element);
};

(function() {

    this.$padding = 0;

    this.setPadding = function(padding) {
        this.$padding = padding;
    };
    this.setSession = function(session) {
        this.session = session;
    };
    
    this.setMarkers = function(markers) {
        this.markers = markers;
    };

    this.update = function(config) {
        var config = config || this.config;
        if (!config)
            return;

        this.config = config;


        var html = [];
        for (var key in this.markers) {
            var marker = this.markers[key];

            if (!marker.range) {
                marker.update(html, this, this.session, config);
                continue;
            }

            var range = marker.range.clipRows(config.firstRow, config.lastRow);
            if (range.isEmpty()) continue;

            range = range.toScreenRange(this.session);
            if (marker.renderer) {
                var top = this.$getTop(range.start.row, config);
                var left = this.$padding + range.start.column * config.characterWidth;
                marker.renderer(html, range, left, top, config);
            } else if (marker.type == "fullLine") {
                this.drawFullLineMarker(html, range, marker.clazz, config);
            } else if (marker.type == "screenLine") {
                this.drawScreenLineMarker(html, range, marker.clazz, config);
            } else if (range.isMultiLine()) {
                if (marker.type == "text")
                    this.drawTextMarker(html, range, marker.clazz, config);
                else
                    this.drawMultiLineMarker(html, range, marker.clazz, config);
            } else {
                this.drawSingleLineMarker(html, range, marker.clazz + " ace_start", config);
            }
        }
        this.element = dom.setInnerHtml(this.element, html.join(""));
    };

    this.$getTop = function(row, layerConfig) {
        return (row - layerConfig.firstRowScreen) * layerConfig.lineHeight;
    };
    this.drawTextMarker = function(stringBuilder, range, clazz, layerConfig, extraStyle) {
        var row = range.start.row;

        var lineRange = new Range(
            row, range.start.column,
            row, this.session.getScreenLastRowColumn(row)
        );
        this.drawSingleLineMarker(stringBuilder, lineRange, clazz + " ace_start", layerConfig, 1, extraStyle);
        row = range.end.row;
        lineRange = new Range(row, 0, row, range.end.column);
        this.drawSingleLineMarker(stringBuilder, lineRange, clazz, layerConfig, 0, extraStyle);

        for (row = range.start.row + 1; row < range.end.row; row++) {
            lineRange.start.row = row;
            lineRange.end.row = row;
            lineRange.end.column = this.session.getScreenLastRowColumn(row);
            this.drawSingleLineMarker(stringBuilder, lineRange, clazz, layerConfig, 1, extraStyle);
        }
    };
    this.drawMultiLineMarker = function(stringBuilder, range, clazz, config, extraStyle) {
        var padding = this.$padding;
        var height = config.lineHeight;
        var top = this.$getTop(range.start.row, config);
        var left = padding + range.start.column * config.characterWidth;
        extraStyle = extraStyle || "";

        stringBuilder.push(
            "<div class='", clazz, " ace_start' style='",
            "height:", height, "px;",
            "right:0;",
            "top:", top, "px;",
            "left:", left, "px;", extraStyle, "'></div>"
        );
        top = this.$getTop(range.end.row, config);
        var width = range.end.column * config.characterWidth;

        stringBuilder.push(
            "<div class='", clazz, "' style='",
            "height:", height, "px;",
            "width:", width, "px;",
            "top:", top, "px;",
            "left:", padding, "px;", extraStyle, "'></div>"
        );
        height = (range.end.row - range.start.row - 1) * config.lineHeight;
        if (height < 0)
            return;
        top = this.$getTop(range.start.row + 1, config);

        stringBuilder.push(
            "<div class='", clazz, "' style='",
            "height:", height, "px;",
            "right:0;",
            "top:", top, "px;",
            "left:", padding, "px;", extraStyle, "'></div>"
        );
    };
    this.drawSingleLineMarker = function(stringBuilder, range, clazz, config, extraLength, extraStyle) {
        var height = config.lineHeight;
        var width = (range.end.column + (extraLength || 0) - range.start.column) * config.characterWidth;

        var top = this.$getTop(range.start.row, config);
        var left = this.$padding + range.start.column * config.characterWidth;

        stringBuilder.push(
            "<div class='", clazz, "' style='",
            "height:", height, "px;",
            "width:", width, "px;",
            "top:", top, "px;",
            "left:", left, "px;", extraStyle || "", "'></div>"
        );
    };

    this.drawFullLineMarker = function(stringBuilder, range, clazz, config, extraStyle) {
        var top = this.$getTop(range.start.row, config);
        var height = config.lineHeight;
        if (range.start.row != range.end.row)
            height += this.$getTop(range.end.row, config) - top;

        stringBuilder.push(
            "<div class='", clazz, "' style='",
            "height:", height, "px;",
            "top:", top, "px;",
            "left:0;right:0;", extraStyle || "", "'></div>"
        );
    };
    
    this.drawScreenLineMarker = function(stringBuilder, range, clazz, config, extraStyle) {
        var top = this.$getTop(range.start.row, config);
        var height = config.lineHeight;

        stringBuilder.push(
            "<div class='", clazz, "' style='",
            "height:", height, "px;",
            "top:", top, "px;",
            "left:0;right:0;", extraStyle || "", "'></div>"
        );
    };

}).call(Marker.prototype);

exports.Marker = Marker;

});

ace.define('ace/mouse/mouse_event', ['require', 'exports', 'module' , 'ace/lib/event', 'ace/lib/useragent'], function(require, exports, module) {


var event = require("../lib/event");
var useragent = require("../lib/useragent");
var MouseEvent = exports.MouseEvent = function(domEvent, editor) {
    this.domEvent = domEvent;
    this.editor = editor;
    
    this.x = this.clientX = domEvent.clientX;
    this.y = this.clientY = domEvent.clientY;

    this.$pos = null;
    this.$inSelection = null;
    
    this.propagationStopped = false;
    this.defaultPrevented = false;
};

(function() {  
    
    this.stopPropagation = function() {
        event.stopPropagation(this.domEvent);
        this.propagationStopped = true;
    };
    
    this.preventDefault = function() {
        event.preventDefault(this.domEvent);
        this.defaultPrevented = true;
    };
    
    this.stop = function() {
        this.stopPropagation();
        this.preventDefault();
    };
    this.getDocumentPosition = function() {
        if (this.$pos)
            return this.$pos;
        
        this.$pos = this.editor.renderer.screenToTextCoordinates(this.clientX, this.clientY);
        return this.$pos;
    };
    this.inSelection = function() {
        if (this.$inSelection !== null)
            return this.$inSelection;
            
        var editor = this.editor;
        

        var selectionRange = editor.getSelectionRange();
        if (selectionRange.isEmpty())
            this.$inSelection = false;
        else {
            var pos = this.getDocumentPosition();
            this.$inSelection = selectionRange.contains(pos.row, pos.column);
        }

        return this.$inSelection;
    };
    this.getButton = function() {
        return event.getButton(this.domEvent);
    };
    this.getShiftKey = function() {
        return this.domEvent.shiftKey;
    };
    
    this.getAccelKey = useragent.isMac
        ? function() { return this.domEvent.metaKey; }
        : function() { return this.domEvent.ctrlKey; };
    
}).call(MouseEvent.prototype);

});

ace.define('ace/layer/text', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/dom', 'ace/lib/lang', 'ace/lib/useragent', 'ace/lib/event_emitter'], function(require, exports, module) {


var oop = require("../lib/oop");
var dom = require("../lib/dom");
var lang = require("../lib/lang");
var useragent = require("../lib/useragent");
var EventEmitter = require("../lib/event_emitter").EventEmitter;

var Text = function(parentEl) {
    this.element = dom.createElement("div");
    this.element.className = "ace_layer ace_text-layer";
    parentEl.appendChild(this.element);
    this.$updateEolChar = this.$updateEolChar.bind(this);
};

(function() {

    oop.implement(this, EventEmitter);

    this.EOF_CHAR = "\xB6";
    this.EOL_CHAR_LF = "\xAC";
    this.EOL_CHAR_CRLF = "\xa4";
    this.EOL_CHAR = this.EOL_CHAR_LF;
    this.TAB_CHAR = "\u2192"; //"\u21E5";
    this.SPACE_CHAR = "\xB7";
    this.$padding = 0;

    this.$updateEolChar = function() {
        var EOL_CHAR = this.session.doc.getNewLineCharacter() == "\n"
           ? this.EOL_CHAR_LF
           : this.EOL_CHAR_CRLF;
        if (this.EOL_CHAR != EOL_CHAR) {
            this.EOL_CHAR = EOL_CHAR;
            return true;
        }
    }

    this.setPadding = function(padding) {
        this.$padding = padding;
        this.element.style.padding = "0 " + padding + "px";
    };

    this.getLineHeight = function() {
        return this.$fontMetrics.$characterSize.height || 0;
    };

    this.getCharacterWidth = function() {
        return this.$fontMetrics.$characterSize.width || 0;
    };
    
    this.$setFontMetrics = function(measure) {
        this.$fontMetrics = measure;
        this.$fontMetrics.on("changeCharacterSize", function(e) {
            this._signal("changeCharacterSize", e);
        }.bind(this));
        this.$pollSizeChanges();
    }

    this.checkForSizeChanges = function() {
        this.$fontMetrics.checkForSizeChanges();
    };
    this.$pollSizeChanges = function() {
        return this.$pollSizeChangesTimer = this.$fontMetrics.$pollSizeChanges();
    };
    this.setSession = function(session) {
        this.session = session;
        this.$computeTabString();
    };

    this.showInvisibles = false;
    this.setShowInvisibles = function(showInvisibles) {
        if (this.showInvisibles == showInvisibles)
            return false;

        this.showInvisibles = showInvisibles;
        this.$computeTabString();
        return true;
    };

    this.displayIndentGuides = true;
    this.setDisplayIndentGuides = function(display) {
        if (this.displayIndentGuides == display)
            return false;

        this.displayIndentGuides = display;
        this.$computeTabString();
        return true;
    };

    this.$tabStrings = [];
    this.onChangeTabSize =
    this.$computeTabString = function() {
        var tabSize = this.session.getTabSize();
        this.tabSize = tabSize;
        var tabStr = this.$tabStrings = [0];
        for (var i = 1; i < tabSize + 1; i++) {
            if (this.showInvisibles) {
                tabStr.push("<span class='ace_invisible'>"
                    + this.TAB_CHAR
                    + lang.stringRepeat("\xa0", i - 1)
                    + "</span>");
            } else {
                tabStr.push(lang.stringRepeat("\xa0", i));
            }
        }
        if (this.displayIndentGuides) {
            this.$indentGuideRe =  /\s\S| \t|\t |\s$/;
            var className = "ace_indent-guide";
            if (this.showInvisibles) {
                className += " ace_invisible";
                var spaceContent = lang.stringRepeat(this.SPACE_CHAR, this.tabSize);
                var tabContent = this.TAB_CHAR + lang.stringRepeat("\xa0", this.tabSize - 1);
            } else{
                var spaceContent = lang.stringRepeat("\xa0", this.tabSize);
                var tabContent = spaceContent;
            }

            this.$tabStrings[" "] = "<span class='" + className + "'>" + spaceContent + "</span>";
            this.$tabStrings["\t"] = "<span class='" + className + "'>" + tabContent + "</span>";
        }
    };

    this.updateLines = function(config, firstRow, lastRow) {
        if (this.config.lastRow != config.lastRow ||
            this.config.firstRow != config.firstRow) {
            this.scrollLines(config);
        }
        this.config = config;

        var first = Math.max(firstRow, config.firstRow);
        var last = Math.min(lastRow, config.lastRow);

        var lineElements = this.element.childNodes;
        var lineElementsIdx = 0;

        for (var row = config.firstRow; row < first; row++) {
            var foldLine = this.session.getFoldLine(row);
            if (foldLine) {
                if (foldLine.containsRow(first)) {
                    first = foldLine.start.row;
                    break;
                } else {
                    row = foldLine.end.row;
                }
            }
            lineElementsIdx ++;
        }

        var row = first;
        var foldLine = this.session.getNextFoldLine(row);
        var foldStart = foldLine ? foldLine.start.row : Infinity;

        while (true) {
            if (row > foldStart) {
                row = foldLine.end.row+1;
                foldLine = this.session.getNextFoldLine(row, foldLine);
                foldStart = foldLine ? foldLine.start.row :Infinity;
            }
            if (row > last)
                break;

            var lineElement = lineElements[lineElementsIdx++];
            if (lineElement) {
                var html = [];
                this.$renderLine(
                    html, row, !this.$useLineGroups(), row == foldStart ? foldLine : false
                );
                lineElement.style.height = config.lineHeight * this.session.getRowLength(row) + "px";
                dom.setInnerHtml(lineElement, html.join(""));
            }
            row++;
        }
    };

    this.scrollLines = function(config) {
        var oldConfig = this.config;
        this.config = config;

        if (!oldConfig || oldConfig.lastRow < config.firstRow)
            return this.update(config);

        if (config.lastRow < oldConfig.firstRow)
            return this.update(config);

        var el = this.element;
        if (oldConfig.firstRow < config.firstRow)
            for (var row=this.session.getFoldedRowCount(oldConfig.firstRow, config.firstRow - 1); row>0; row--)
                el.removeChild(el.firstChild);

        if (oldConfig.lastRow > config.lastRow)
            for (var row=this.session.getFoldedRowCount(config.lastRow + 1, oldConfig.lastRow); row>0; row--)
                el.removeChild(el.lastChild);

        if (config.firstRow < oldConfig.firstRow) {
            var fragment = this.$renderLinesFragment(config, config.firstRow, oldConfig.firstRow - 1);
            if (el.firstChild)
                el.insertBefore(fragment, el.firstChild);
            else
                el.appendChild(fragment);
        }

        if (config.lastRow > oldConfig.lastRow) {
            var fragment = this.$renderLinesFragment(config, oldConfig.lastRow + 1, config.lastRow);
            el.appendChild(fragment);
        }
    };

    this.$renderLinesFragment = function(config, firstRow, lastRow) {
        var fragment = this.element.ownerDocument.createDocumentFragment();
        var row = firstRow;
        var foldLine = this.session.getNextFoldLine(row);
        var foldStart = foldLine ? foldLine.start.row : Infinity;

        while (true) {
            if (row > foldStart) {
                row = foldLine.end.row+1;
                foldLine = this.session.getNextFoldLine(row, foldLine);
                foldStart = foldLine ? foldLine.start.row : Infinity;
            }
            if (row > lastRow)
                break;

            var container = dom.createElement("div");

            var html = [];
            this.$renderLine(html, row, false, row == foldStart ? foldLine : false);
            container.innerHTML = html.join("");
            if (this.$useLineGroups()) {
                container.className = 'ace_line_group';
                fragment.appendChild(container);
                container.style.height = config.lineHeight * this.session.getRowLength(row) + "px";

            } else {
                while(container.firstChild)
                    fragment.appendChild(container.firstChild);
            }

            row++;
        }
        return fragment;
    };

    this.update = function(config) {
        this.config = config;

        var html = [];
        var firstRow = config.firstRow, lastRow = config.lastRow;

        var row = firstRow;
        var foldLine = this.session.getNextFoldLine(row);
        var foldStart = foldLine ? foldLine.start.row : Infinity;

        while (true) {
            if (row > foldStart) {
                row = foldLine.end.row+1;
                foldLine = this.session.getNextFoldLine(row, foldLine);
                foldStart = foldLine ? foldLine.start.row :Infinity;
            }
            if (row > lastRow)
                break;

            if (this.$useLineGroups())
                html.push("<div class='ace_line_group' style='height:", config.lineHeight*this.session.getRowLength(row), "px'>")

            this.$renderLine(html, row, false, row == foldStart ? foldLine : false);

            if (this.$useLineGroups())
                html.push("</div>"); // end the line group

            row++;
        }
        this.element = dom.setInnerHtml(this.element, html.join(""));
    };

    this.$textToken = {
        "text": true,
        "rparen": true,
        "lparen": true
    };

    this.$renderToken = function(stringBuilder, screenColumn, token, value) {
        var self = this;
        var replaceReg = /\t|&|<|( +)|([\x00-\x1f\x80-\xa0\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\u3000\uFEFF])|[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]/g;
        var replaceFunc = function(c, a, b, tabIdx, idx4) {
            if (a) {
                return self.showInvisibles ?
                    "<span class='ace_invisible'>" + lang.stringRepeat(self.SPACE_CHAR, c.length) + "</span>" :
                    lang.stringRepeat("\xa0", c.length);
            } else if (c == "&") {
                return "&#38;";
            } else if (c == "<") {
                return "&#60;";
            } else if (c == "\t") {
                var tabSize = self.session.getScreenTabSize(screenColumn + tabIdx);
                screenColumn += tabSize - 1;
                return self.$tabStrings[tabSize];
            } else if (c == "\u3000") {
                var classToUse = self.showInvisibles ? "ace_cjk ace_invisible" : "ace_cjk";
                var space = self.showInvisibles ? self.SPACE_CHAR : "";
                screenColumn += 1;
                return "<span class='" + classToUse + "' style='width:" +
                    (self.config.characterWidth * 2) +
                    "px'>" + space + "</span>";
            } else if (b) {
                return "<span class='ace_invisible ace_invalid'>" + self.SPACE_CHAR + "</span>";
            } else {
                screenColumn += 1;
                return "<span class='ace_cjk' style='width:" +
                    (self.config.characterWidth * 2) +
                    "px'>" + c + "</span>";
            }
        };

        var output = value.replace(replaceReg, replaceFunc);

        if (!this.$textToken[token.type]) {
            var classes = "ace_" + token.type.replace(/\./g, " ace_");
            var style = "";
            if (token.type == "fold")
                style = " style='width:" + (token.value.length * this.config.characterWidth) + "px;' ";
            stringBuilder.push("<span class='", classes, "'", style, ">", output, "</span>");
        }
        else {
            stringBuilder.push(output);
        }
        return screenColumn + value.length;
    };

    this.renderIndentGuide = function(stringBuilder, value, max) {
        var cols = value.search(this.$indentGuideRe);
        if (cols <= 0 || cols >= max)
            return value;
        if (value[0] == " ") {
            cols -= cols % this.tabSize;
            stringBuilder.push(lang.stringRepeat(this.$tabStrings[" "], cols/this.tabSize));
            return value.substr(cols);
        } else if (value[0] == "\t") {
            stringBuilder.push(lang.stringRepeat(this.$tabStrings["\t"], cols));
            return value.substr(cols);
        }
        return value;
    };

    this.$renderWrappedLine = function(stringBuilder, tokens, splits, onlyContents) {
        var chars = 0;
        var split = 0;
        var splitChars = splits[0];
        var screenColumn = 0;

        for (var i = 0; i < tokens.length; i++) {
            var token = tokens[i];
            var value = token.value;
            if (i == 0 && this.displayIndentGuides) {
                chars = value.length;
                value = this.renderIndentGuide(stringBuilder, value, splitChars);
                if (!value)
                    continue;
                chars -= value.length;
            }

            if (chars + value.length < splitChars) {
                screenColumn = this.$renderToken(stringBuilder, screenColumn, token, value);
                chars += value.length;
            } else {
                while (chars + value.length >= splitChars) {
                    screenColumn = this.$renderToken(
                        stringBuilder, screenColumn,
                        token, value.substring(0, splitChars - chars)
                    );
                    value = value.substring(splitChars - chars);
                    chars = splitChars;

                    if (!onlyContents) {
                        stringBuilder.push("</div>",
                            "<div class='ace_line' style='height:",
                            this.config.lineHeight, "px'>"
                        );
                    }

                    split ++;
                    screenColumn = 0;
                    splitChars = splits[split] || Number.MAX_VALUE;
                }
                if (value.length != 0) {
                    chars += value.length;
                    screenColumn = this.$renderToken(
                        stringBuilder, screenColumn, token, value
                    );
                }
            }
        }
    };

    this.$renderSimpleLine = function(stringBuilder, tokens) {
        var screenColumn = 0;
        var token = tokens[0];
        var value = token.value;
        if (this.displayIndentGuides)
            value = this.renderIndentGuide(stringBuilder, value);
        if (value)
            screenColumn = this.$renderToken(stringBuilder, screenColumn, token, value);
        for (var i = 1; i < tokens.length; i++) {
            token = tokens[i];
            value = token.value;
            screenColumn = this.$renderToken(stringBuilder, screenColumn, token, value);
        }
    };
    this.$renderLine = function(stringBuilder, row, onlyContents, foldLine) {
        if (!foldLine && foldLine != false)
            foldLine = this.session.getFoldLine(row);

        if (foldLine)
            var tokens = this.$getFoldLineTokens(row, foldLine);
        else
            var tokens = this.session.getTokens(row);


        if (!onlyContents) {
            stringBuilder.push(
                "<div class='ace_line' style='height:", 
                    this.config.lineHeight * (
                        this.$useLineGroups() ? 1 :this.session.getRowLength(row)
                    ), "px'>"
            );
        }

        if (tokens.length) {
            var splits = this.session.getRowSplitData(row);
            if (splits && splits.length)
                this.$renderWrappedLine(stringBuilder, tokens, splits, onlyContents);
            else
                this.$renderSimpleLine(stringBuilder, tokens);
        }

        if (this.showInvisibles) {
            if (foldLine)
                row = foldLine.end.row

            stringBuilder.push(
                "<span class='ace_invisible'>",
                row == this.session.getLength() - 1 ? this.EOF_CHAR : this.EOL_CHAR,
                "</span>"
            );
        }
        if (!onlyContents)
            stringBuilder.push("</div>");
    };

    this.$getFoldLineTokens = function(row, foldLine) {
        var session = this.session;
        var renderTokens = [];

        function addTokens(tokens, from, to) {
            var idx = 0, col = 0;
            while ((col + tokens[idx].value.length) < from) {
                col += tokens[idx].value.length;
                idx++;

                if (idx == tokens.length)
                    return;
            }
            if (col != from) {
                var value = tokens[idx].value.substring(from - col);
                if (value.length > (to - from))
                    value = value.substring(0, to - from);

                renderTokens.push({
                    type: tokens[idx].type,
                    value: value
                });

                col = from + value.length;
                idx += 1;
            }

            while (col < to && idx < tokens.length) {
                var value = tokens[idx].value;
                if (value.length + col > to) {
                    renderTokens.push({
                        type: tokens[idx].type,
                        value: value.substring(0, to - col)
                    });
                } else
                    renderTokens.push(tokens[idx]);
                col += value.length;
                idx += 1;
            }
        }

        var tokens = session.getTokens(row);
        foldLine.walk(function(placeholder, row, column, lastColumn, isNewRow) {
            if (placeholder != null) {
                renderTokens.push({
                    type: "fold",
                    value: placeholder
                });
            } else {
                if (isNewRow)
                    tokens = session.getTokens(row);

                if (tokens.length)
                    addTokens(tokens, lastColumn, column);
            }
        }, foldLine.end.row, this.session.getLine(foldLine.end.row).length);

        return renderTokens;
    };

    this.$useLineGroups = function() {
        return this.session.getUseWrapMode();
    };

    this.destroy = function() {
        clearInterval(this.$pollSizeChangesTimer);
        if (this.$measureNode)
            this.$measureNode.parentNode.removeChild(this.$measureNode);
        delete this.$measureNode;
    };

}).call(Text.prototype);

exports.Text = Text;

});

ace.define('ace/tooltip', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/dom'], function(require, exports, module) {


var oop = require("./lib/oop");
var dom = require("./lib/dom");
function Tooltip (parentNode) {
    this.isOpen = false;
    this.$element = null;
    this.$parentNode = parentNode;
}

(function() {
    this.$init = function() {
        this.$element = dom.createElement("div");
        this.$element.className = "ace_tooltip";
        this.$element.style.display = "none";
        this.$parentNode.appendChild(this.$element);
        return this.$element;
    };
    this.getElement = function() {
        return this.$element || this.$init();
    };
    this.setText = function(text) {
        dom.setInnerText(this.getElement(), text);
    };
    this.setHtml = function(html) {
        this.getElement().innerHTML = html;
    };
    this.setPosition = function(x, y) {
        this.getElement().style.left = x + "px";
        this.getElement().style.top = y + "px";
    };
    this.setClassName = function(className) {
        dom.addCssClass(this.getElement(), className);
    };
    this.show = function(text, x, y) {
        if (text != null)
            this.setText(text);
        if (x != null && y != null)
            this.setPosition(x, y);
        if (!this.isOpen) {
            this.getElement().style.display = "block";
            this.isOpen = true;
        }
    };

    this.hide = function() {
        if (this.isOpen) {
            this.getElement().style.display = "none";
            this.isOpen = false;
        }
    };
    this.getHeight = function() {
        return this.getElement().offsetHeight;
    };
    this.getWidth = function() {
        return this.getElement().offsetWidth;
    };

}).call(Tooltip.prototype);

exports.Tooltip = Tooltip;
});

ace.define('ace/layer/cursor', ['require', 'exports', 'module' , 'ace/lib/dom'], function(require, exports, module) {


var dom = require("../lib/dom");
var IE8;

var Cursor = function(parentEl) {
    this.element = dom.createElement("div");
    this.element.className = "ace_layer ace_cursor-layer";
    parentEl.appendChild(this.element);
    
    if (IE8 === undefined)
        IE8 = "opacity" in this.element;

    this.isVisible = false;
    this.isBlinking = true;
    this.blinkInterval = 1000;
    this.smoothBlinking = false;

    this.cursors = [];
    this.cursor = this.addCursor();
    dom.addCssClass(this.element, "ace_hidden-cursors");
    this.$updateCursors = this.$updateVisibility.bind(this);
};

(function() {
    
    this.$updateVisibility = function(val) {
        var cursors = this.cursors;
        for (var i = cursors.length; i--; )
            cursors[i].style.visibility = val ? "" : "hidden";
    };
    this.$updateOpacity = function(val) {
        var cursors = this.cursors;
        for (var i = cursors.length; i--; )
            cursors[i].style.opacity = val ? "" : "0";
    };
    

    this.$padding = 0;
    this.setPadding = function(padding) {
        this.$padding = padding;
    };

    this.setSession = function(session) {
        this.session = session;
    };

    this.setBlinking = function(blinking) {
        if (blinking != this.isBlinking){
            this.isBlinking = blinking;
            this.restartTimer();
        }
    };

    this.setBlinkInterval = function(blinkInterval) {
        if (blinkInterval != this.blinkInterval){
            this.blinkInterval = blinkInterval;
            this.restartTimer();
        }
    };

    this.setSmoothBlinking = function(smoothBlinking) {
        if (smoothBlinking != this.smoothBlinking && !IE8) {
            this.smoothBlinking = smoothBlinking;
            dom.setCssClass(this.element, "ace_smooth-blinking", smoothBlinking);
            this.$updateCursors(true);
            this.$updateCursors = (smoothBlinking 
                ? this.$updateOpacity
                : this.$updateVisibility).bind(this);
            this.restartTimer();
        }
    };

    this.addCursor = function() {
        var el = dom.createElement("div");
        el.className = "ace_cursor";
        this.element.appendChild(el);
        this.cursors.push(el);
        return el;
    };

    this.removeCursor = function() {
        if (this.cursors.length > 1) {
            var el = this.cursors.pop();
            el.parentNode.removeChild(el);
            return el;
        }
    };

    this.hideCursor = function() {
        this.isVisible = false;
        dom.addCssClass(this.element, "ace_hidden-cursors");
        this.restartTimer();
    };

    this.showCursor = function() {
        this.isVisible = true;
        dom.removeCssClass(this.element, "ace_hidden-cursors");
        this.restartTimer();
    };

    this.restartTimer = function() {
        var update = this.$updateCursors;
        clearInterval(this.intervalId);
        clearTimeout(this.timeoutId);
        if (this.smoothBlinking) {
            dom.removeCssClass(this.element, "ace_smooth-blinking");
        }
        
        update(true);

        if (!this.isBlinking || !this.blinkInterval || !this.isVisible)
            return;

        if (this.smoothBlinking) {
            setTimeout(function(){
                dom.addCssClass(this.element, "ace_smooth-blinking");
            }.bind(this));
        }
        
        var blink = function(){
            this.timeoutId = setTimeout(function() {
                update(false);
            }, 0.6 * this.blinkInterval);
        }.bind(this);

        this.intervalId = setInterval(function() {
            update(true);
            blink();
        }, this.blinkInterval);

        blink();
    };

    this.getPixelPosition = function(position, onScreen) {
        if (!this.config || !this.session)
            return {left : 0, top : 0};

        if (!position)
            position = this.session.selection.getCursor();
        var pos = this.session.documentToScreenPosition(position);
        var cursorLeft = this.$padding + pos.column * this.config.characterWidth;
        var cursorTop = (pos.row - (onScreen ? this.config.firstRowScreen : 0)) *
            this.config.lineHeight;

        return {left : cursorLeft, top : cursorTop};
    };

    this.update = function(config) {
        this.config = config;

        var selections = this.session.$selectionMarkers;
        var i = 0, cursorIndex = 0;

        if (selections === undefined || selections.length === 0){
            selections = [{cursor: null}];
        }

        for (var i = 0, n = selections.length; i < n; i++) {
            var pixelPos = this.getPixelPosition(selections[i].cursor, true);
            if ((pixelPos.top > config.height + config.offset ||
                 pixelPos.top < 0) && i > 1) {
                continue;
            }

            var style = (this.cursors[cursorIndex++] || this.addCursor()).style;

            style.left = pixelPos.left + "px";
            style.top = pixelPos.top + "px";
            style.width = config.characterWidth + "px";
            style.height = config.lineHeight + "px";
        }
        while (this.cursors.length > cursorIndex)
            this.removeCursor();

        var overwrite = this.session.getOverwrite();
        this.$setOverwrite(overwrite);
        this.$pixelPos = pixelPos;
        this.restartTimer();
    };

    this.$setOverwrite = function(overwrite) {
        if (overwrite != this.overwrite) {
            this.overwrite = overwrite;
            if (overwrite)
                dom.addCssClass(this.element, "ace_overwrite-cursors");
            else
                dom.removeCssClass(this.element, "ace_overwrite-cursors");
        }
    };

    this.destroy = function() {
        clearInterval(this.intervalId);
        clearTimeout(this.timeoutId);
    };

}).call(Cursor.prototype);

exports.Cursor = Cursor;

});

ace.define('ace/mouse/default_gutter_handler', ['require', 'exports', 'module' , 'ace/lib/dom', 'ace/lib/oop', 'ace/lib/event', 'ace/tooltip'], function(require, exports, module) {

var dom = require("../lib/dom");
var oop = require("../lib/oop");
var event = require("../lib/event");
var Tooltip = require("../tooltip").Tooltip;

function GutterHandler(mouseHandler) {
    var editor = mouseHandler.editor;
    var gutter = editor.renderer.$gutterLayer;
    var tooltip = new GutterTooltip(editor.container);

    mouseHandler.editor.setDefaultHandler("guttermousedown", function(e) {
        if (!editor.isFocused() || e.getButton() != 0)
            return;
        var gutterRegion = gutter.getRegion(e);

        if (gutterRegion == "foldWidgets")
            return;

        var row = e.getDocumentPosition().row;
        var selection = editor.session.selection;

        if (e.getShiftKey())
            selection.selectTo(row, 0);
        else {
            if (e.domEvent.detail == 2) {
                editor.selectAll();
                return e.preventDefault();
            }
            mouseHandler.$clickSelection = editor.selection.getLineRange(row);
        }
        mouseHandler.setState("selectByLines");
        mouseHandler.captureMouse(e);
        return e.preventDefault();
    });


    var tooltipTimeout, mouseEvent, tooltipAnnotation;

    function showTooltip() {
        var row = mouseEvent.getDocumentPosition().row;
        var annotation = gutter.$annotations[row];
        if (!annotation)
            return hideTooltip();

        var maxRow = editor.session.getLength();
        if (row == maxRow) {
            var screenRow = editor.renderer.pixelToScreenCoordinates(0, mouseEvent.y).row;
            var pos = mouseEvent.$pos;
            if (screenRow > editor.session.documentToScreenRow(pos.row, pos.column))
                return hideTooltip();
        }

        if (tooltipAnnotation == annotation)
            return;
        tooltipAnnotation = annotation.text.join("<br/>");

        tooltip.setHtml(tooltipAnnotation);
        tooltip.show();
        editor.on("mousewheel", hideTooltip);

        if (mouseHandler.$tooltipFollowsMouse) {
            moveTooltip(mouseEvent);
        } else {
            var gutterElement = gutter.$cells[row].element;
            var rect = gutterElement.getBoundingClientRect();
            var style = tooltip.getElement().style;
            style.left = rect.right + "px";
            style.top = rect.bottom + "px";
        }
    }

    function hideTooltip() {
        if (tooltipTimeout)
            tooltipTimeout = clearTimeout(tooltipTimeout);
        if (tooltipAnnotation) {
            tooltip.hide();
            tooltipAnnotation = null;
            editor.removeEventListener("mousewheel", hideTooltip);
        }
    }

    function moveTooltip(e) {
        tooltip.setPosition(e.x, e.y);
    }

    mouseHandler.editor.setDefaultHandler("guttermousemove", function(e) {
        var target = e.domEvent.target || e.domEvent.srcElement;
        if (dom.hasCssClass(target, "ace_fold-widget"))
            return hideTooltip();

        if (tooltipAnnotation && mouseHandler.$tooltipFollowsMouse)
            moveTooltip(e);

        mouseEvent = e;
        if (tooltipTimeout)
            return;
        tooltipTimeout = setTimeout(function() {
            tooltipTimeout = null;
            if (mouseEvent && !mouseHandler.isMousePressed)
                showTooltip();
            else
                hideTooltip();
        }, 50);
    });

    event.addListener(editor.renderer.$gutter, "mouseout", function(e) {
        mouseEvent = null;
        if (!tooltipAnnotation || tooltipTimeout)
            return;

        tooltipTimeout = setTimeout(function() {
            tooltipTimeout = null;
            hideTooltip();
        }, 50);
    });
    
    editor.on("changeSession", hideTooltip);
}

function GutterTooltip(parentNode) {
    Tooltip.call(this, parentNode);
}

oop.inherits(GutterTooltip, Tooltip);

(function(){
    this.setPosition = function(x, y) {
        var windowWidth = window.innerWidth || document.documentElement.clientWidth;
        var windowHeight = window.innerHeight || document.documentElement.clientHeight;
        var width = this.getWidth();
        var height = this.getHeight();
        x += 15;
        y += 15;
        if (x + width > windowWidth) {
            x -= (x + width) - windowWidth;
        }
        if (y + height > windowHeight) {
            y -= 20 + height;
        }
        Tooltip.prototype.setPosition.call(this, x, y);
    };

}).call(GutterTooltip.prototype);



exports.GutterHandler = GutterHandler;

});

ace.define('ace/scrollbar', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/dom', 'ace/lib/event', 'ace/lib/event_emitter'], function(require, exports, module) {


var oop = require("./lib/oop");
var dom = require("./lib/dom");
var event = require("./lib/event");
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var ScrollBar = function(parent) {
    this.element = dom.createElement("div");
    this.element.className = "ace_scrollbar ace_scrollbar" + this.classSuffix;

    this.inner = dom.createElement("div");
    this.inner.className = "ace_scrollbar-inner";
    this.element.appendChild(this.inner);

    parent.appendChild(this.element);

    this.setVisible(false);
    this.skipEvent = false;

    event.addListener(this.element, "scroll", this.onScroll.bind(this));
    event.addListener(this.element, "mousedown", event.preventDefault);
};

(function() {
    oop.implement(this, EventEmitter);

    this.setVisible = function(isVisible) {
        this.element.style.display = isVisible ? "" : "none";
        this.isVisible = isVisible;
    };
}).call(ScrollBar.prototype);
var VScrollBar = function(parent, renderer) {
    ScrollBar.call(this, parent);
    this.scrollTop = 0;
    renderer.$scrollbarWidth = 
    this.width = dom.scrollbarWidth(parent.ownerDocument);
    this.inner.style.width =
    this.element.style.width = (this.width || 15) + 5 + "px";
};

oop.inherits(VScrollBar, ScrollBar);

(function() {

    this.classSuffix = '-v';
    this.onScroll = function() {
        if (!this.skipEvent) {
            this.scrollTop = this.element.scrollTop;
            this._emit("scroll", {data: this.scrollTop});
        }
        this.skipEvent = false;
    };
    this.getWidth = function() {
        return this.isVisible ? this.width : 0;
    };
    this.setHeight = function(height) {
        this.element.style.height = height + "px";
    };
    this.setInnerHeight = function(height) {
        this.inner.style.height = height + "px";
    };
    this.setScrollHeight = function(height) {
        this.inner.style.height = height + "px";
    };
    this.setScrollTop = function(scrollTop) {
        if (this.scrollTop != scrollTop) {
            this.skipEvent = true;
            this.scrollTop = this.element.scrollTop = scrollTop;
        }
    };

}).call(VScrollBar.prototype);
var HScrollBar = function(parent, renderer) {
    ScrollBar.call(this, parent);
    this.scrollLeft = 0;
    this.height = renderer.$scrollbarWidth;
    this.inner.style.height =
    this.element.style.height = (this.height || 15) + 5 + "px";
};

oop.inherits(HScrollBar, ScrollBar);

(function() {

    this.classSuffix = '-h';
    this.onScroll = function() {
        if (!this.skipEvent) {
            this.scrollLeft = this.element.scrollLeft;
            this._emit("scroll", {data: this.scrollLeft});
        }
        this.skipEvent = false;
    };
    this.getHeight = function() {
        return this.isVisible ? this.height : 0;
    };
    this.setWidth = function(width) {
        this.element.style.width = width + "px";
    };
    this.setInnerWidth = function(width) {
        this.inner.style.width = width + "px";
    };
    this.setScrollWidth = function(width) {
        this.inner.style.width = width + "px";
    };
    this.setScrollLeft = function(scrollLeft) {
        if (this.scrollLeft != scrollLeft) {
            this.skipEvent = true;
            this.scrollLeft = this.element.scrollLeft = scrollLeft;
        }
    };

}).call(HScrollBar.prototype);


exports.ScrollBar = VScrollBar; // backward compatibility
exports.ScrollBarV = VScrollBar; // backward compatibility
exports.ScrollBarH = HScrollBar; // backward compatibility

exports.VScrollBar = VScrollBar;
exports.HScrollBar = HScrollBar;
});

ace.define('ace/mouse/default_handlers', ['require', 'exports', 'module' , 'ace/lib/dom', 'ace/lib/event', 'ace/lib/useragent'], function(require, exports, module) {


var dom = require("../lib/dom");
var event = require("../lib/event");
var useragent = require("../lib/useragent");

var DRAG_OFFSET = 0; // pixels

function DefaultHandlers(mouseHandler) {
    mouseHandler.$clickSelection = null;

    var editor = mouseHandler.editor;
    editor.setDefaultHandler("mousedown", this.onMouseDown.bind(mouseHandler));
    editor.setDefaultHandler("dblclick", this.onDoubleClick.bind(mouseHandler));
    editor.setDefaultHandler("tripleclick", this.onTripleClick.bind(mouseHandler));
    editor.setDefaultHandler("quadclick", this.onQuadClick.bind(mouseHandler));
    editor.setDefaultHandler("mousewheel", this.onMouseWheel.bind(mouseHandler));

    var exports = ["select", "startSelect", "selectEnd", "selectAllEnd", "selectByWordsEnd",
        "selectByLinesEnd", "dragWait", "dragWaitEnd", "focusWait"];

    exports.forEach(function(x) {
        mouseHandler[x] = this[x];
    }, this);

    mouseHandler.selectByLines = this.extendSelectionBy.bind(mouseHandler, "getLineRange");
    mouseHandler.selectByWords = this.extendSelectionBy.bind(mouseHandler, "getWordRange");
}

(function() {

    this.onMouseDown = function(ev) {
        var inSelection = ev.inSelection();
        var pos = ev.getDocumentPosition();
        this.mousedownEvent = ev;
        var editor = this.editor;

        var button = ev.getButton();
        if (button !== 0) {
            var selectionRange = editor.getSelectionRange();
            var selectionEmpty = selectionRange.isEmpty();

            if (selectionEmpty) {
                editor.selection.moveToPosition(pos);
            }
            editor.textInput.onContextMenu(ev.domEvent);
            return; // stopping event here breaks contextmenu on ff mac
        }
        if (inSelection && !editor.isFocused()) {
            editor.focus();
            if (this.$focusTimout && !this.$clickSelection && !editor.inMultiSelectMode) {
                this.mousedownEvent.time = Date.now();
                this.setState("focusWait");
                this.captureMouse(ev);
                return;
            }
        }

        this.captureMouse(ev);
        if (!inSelection || this.$clickSelection || ev.getShiftKey() || editor.inMultiSelectMode) {
            this.startSelect(pos);
        } else if (inSelection) {
            this.mousedownEvent.time = Date.now();
            this.startSelect(pos);
        }
        return ev.preventDefault();
    };

    this.startSelect = function(pos) {
        pos = pos || this.editor.renderer.screenToTextCoordinates(this.x, this.y);
        var editor = this.editor;
        var shiftPressed = this.mousedownEvent.getShiftKey();
        if (shiftPressed) {
            editor.selection.selectToPosition(pos);
        }
        else if (!this.$clickSelection) {
            editor.selection.moveToPosition(pos);
        }
        if (editor.renderer.scroller.setCapture) {
            editor.renderer.scroller.setCapture();
        }
        editor.setStyle("ace_selecting");
        this.setState("select");
    };

    this.select = function() {
        var anchor, editor = this.editor;
        var cursor = editor.renderer.screenToTextCoordinates(this.x, this.y);

        if (this.$clickSelection) {
            var cmp = this.$clickSelection.comparePoint(cursor);

            if (cmp == -1) {
                anchor = this.$clickSelection.end;
            } else if (cmp == 1) {
                anchor = this.$clickSelection.start;
            } else {
                var orientedRange = calcRangeOrientation(this.$clickSelection, cursor);
                cursor = orientedRange.cursor;
                anchor = orientedRange.anchor;
            }
            editor.selection.setSelectionAnchor(anchor.row, anchor.column);
        }
        editor.selection.selectToPosition(cursor);

        editor.renderer.scrollCursorIntoView();
    };

    this.extendSelectionBy = function(unitName) {
        var anchor, editor = this.editor;
        var cursor = editor.renderer.screenToTextCoordinates(this.x, this.y);
        var range = editor.selection[unitName](cursor.row, cursor.column);

        if (this.$clickSelection) {
            var cmpStart = this.$clickSelection.comparePoint(range.start);
            var cmpEnd = this.$clickSelection.comparePoint(range.end);

            if (cmpStart == -1 && cmpEnd <= 0) {
                anchor = this.$clickSelection.end;
                if (range.end.row != cursor.row || range.end.column != cursor.column)
                    cursor = range.start;
            } else if (cmpEnd == 1 && cmpStart >= 0) {
                anchor = this.$clickSelection.start;
                if (range.start.row != cursor.row || range.start.column != cursor.column)
                    cursor = range.end;
            } else if (cmpStart == -1 && cmpEnd == 1) {
                cursor = range.end;
                anchor = range.start;
            } else {
                var orientedRange = calcRangeOrientation(this.$clickSelection, cursor);
                cursor = orientedRange.cursor;
                anchor = orientedRange.anchor;
            }
            editor.selection.setSelectionAnchor(anchor.row, anchor.column);
        }
        editor.selection.selectToPosition(cursor);

        editor.renderer.scrollCursorIntoView();
    };

    this.selectEnd =
    this.selectAllEnd =
    this.selectByWordsEnd =
    this.selectByLinesEnd = function() {
        this.editor.unsetStyle("ace_selecting");
        if (this.editor.renderer.scroller.releaseCapture) {
            this.editor.renderer.scroller.releaseCapture();
        }
    };

    this.focusWait = function() {
        var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);
        var time = Date.now();

        if (distance > DRAG_OFFSET || time - this.mousedownEvent.time > this.$focusTimout)
            this.startSelect(this.mousedownEvent.getDocumentPosition());
    };

    this.onDoubleClick = function(ev) {
        var pos = ev.getDocumentPosition();
        var editor = this.editor;
        var session = editor.session;

        var range = session.getBracketRange(pos);
        if (range) {
            if (range.isEmpty()) {
                range.start.column--;
                range.end.column++;
            }
            this.setState("select");
        } else {
            range = editor.selection.getWordRange(pos.row, pos.column);
            this.setState("selectByWords");
        }
        this.$clickSelection = range;
        this[this.state] && this[this.state](ev);
    };

    this.onTripleClick = function(ev) {
        var pos = ev.getDocumentPosition();
        var editor = this.editor;

        this.setState("selectByLines");
        this.$clickSelection = editor.selection.getLineRange(pos.row);
        this[this.state] && this[this.state](ev);
    };

    this.onQuadClick = function(ev) {
        var editor = this.editor;

        editor.selectAll();
        this.$clickSelection = editor.getSelectionRange();
        this.setState("selectAll");
    };

    this.onMouseWheel = function(ev) {
        if (ev.getAccelKey())
            return;
        if (ev.getShiftKey() && ev.wheelY && !ev.wheelX) {
            ev.wheelX = ev.wheelY;
            ev.wheelY = 0;
        }

        var t = ev.domEvent.timeStamp;
        var dt = t - (this.$lastScrollTime||0);
        
        var editor = this.editor;
        var isScrolable = editor.renderer.isScrollableBy(ev.wheelX * ev.speed, ev.wheelY * ev.speed);
        if (isScrolable || dt < 200) {
            this.$lastScrollTime = t;
            editor.renderer.scrollBy(ev.wheelX * ev.speed, ev.wheelY * ev.speed);
            return ev.stop();
        }
    };

}).call(DefaultHandlers.prototype);

exports.DefaultHandlers = DefaultHandlers;

function calcDistance(ax, ay, bx, by) {
    return Math.sqrt(Math.pow(bx - ax, 2) + Math.pow(by - ay, 2));
}

function calcRangeOrientation(range, cursor) {
    if (range.start.row == range.end.row)
        var cmp = 2 * cursor.column - range.start.column - range.end.column;
    else if (range.start.row == range.end.row - 1 && !range.start.column && !range.end.column)
        var cmp = cursor.column - 4;
    else
        var cmp = 2 * cursor.row - range.start.row - range.end.row;

    if (cmp < 0)
        return {cursor: range.start, anchor: range.end};
    else
        return {cursor: range.end, anchor: range.start};
}

});

ace.define('ace/renderloop', ['require', 'exports', 'module' , 'ace/lib/event'], function(require, exports, module) {


var event = require("./lib/event");


var RenderLoop = function(onRender, win) {
    this.onRender = onRender;
    this.pending = false;
    this.changes = 0;
    this.window = win || window;
};

(function() {


    this.schedule = function(change) {
        this.changes = this.changes | change;
        if (!this.pending && this.changes) {
            this.pending = true;
            var _self = this;
            event.nextFrame(function() {
                _self.pending = false;
                var changes;
                while (changes = _self.changes) {
                    _self.changes = 0;
                    _self.onRender(changes);
                }
            }, this.window);
        }
    };

}).call(RenderLoop.prototype);

exports.RenderLoop = RenderLoop;
});

ace.define('ace/mouse/mouse_handler', ['require', 'exports', 'module' , 'ace/lib/event', 'ace/lib/useragent', 'ace/mouse/default_handlers', 'ace/mouse/default_gutter_handler', 'ace/mouse/mouse_event', 'ace/mouse/dragdrop_handler', 'ace/config'], function(require, exports, module) {


var event = require("../lib/event");
var useragent = require("../lib/useragent");
var DefaultHandlers = require("./default_handlers").DefaultHandlers;
var DefaultGutterHandler = require("./default_gutter_handler").GutterHandler;
var MouseEvent = require("./mouse_event").MouseEvent;
var DragdropHandler = require("./dragdrop_handler").DragdropHandler;
var config = require("../config");

var MouseHandler = function(editor) {
    this.editor = editor;

    new DefaultHandlers(this);
    new DefaultGutterHandler(this);
    new DragdropHandler(this);

    var mouseTarget = editor.renderer.getMouseEventTarget();
    event.addListener(mouseTarget, "click", this.onMouseEvent.bind(this, "click"));
    event.addListener(mouseTarget, "mousemove", this.onMouseMove.bind(this, "mousemove"));
    event.addMultiMouseDownListener(mouseTarget, [300, 300, 250], this, "onMouseEvent");
    if (editor.renderer.scrollBarV) {
        event.addMultiMouseDownListener(editor.renderer.scrollBarV.inner, [300, 300, 250], this, "onMouseEvent");
        event.addMultiMouseDownListener(editor.renderer.scrollBarH.inner, [300, 300, 250], this, "onMouseEvent");
    }
    event.addMouseWheelListener(editor.container, this.onMouseWheel.bind(this, "mousewheel"));

    var gutterEl = editor.renderer.$gutter;
    event.addListener(gutterEl, "mousedown", this.onMouseEvent.bind(this, "guttermousedown"));
    event.addListener(gutterEl, "click", this.onMouseEvent.bind(this, "gutterclick"));
    event.addListener(gutterEl, "dblclick", this.onMouseEvent.bind(this, "gutterdblclick"));
    event.addListener(gutterEl, "mousemove", this.onMouseEvent.bind(this, "guttermousemove"));

    event.addListener(mouseTarget, "mousedown", function(e) {
        editor.focus();
    });

    event.addListener(gutterEl, "mousedown", function(e) {
        editor.focus();
        return event.preventDefault(e);
    });
};

(function() {
    this.onMouseEvent = function(name, e) {
        this.editor._emit(name, new MouseEvent(e, this.editor));
    };

    this.onMouseMove = function(name, e) {
        var listeners = this.editor._eventRegistry && this.editor._eventRegistry.mousemove;
        if (!listeners || !listeners.length)
            return;

        this.editor._emit(name, new MouseEvent(e, this.editor));
    };

    this.onMouseWheel = function(name, e) {
        var mouseEvent = new MouseEvent(e, this.editor);
        mouseEvent.speed = this.$scrollSpeed * 2;
        mouseEvent.wheelX = e.wheelX;
        mouseEvent.wheelY = e.wheelY;

        this.editor._emit(name, mouseEvent);
    };

    this.setState = function(state) {
        this.state = state;
    };

    this.captureMouse = function(ev, mouseMoveHandler) {
        this.x = ev.x;
        this.y = ev.y;

        this.isMousePressed = true;
        var renderer = this.editor.renderer;
        if (renderer.$keepTextAreaAtCursor)
            renderer.$keepTextAreaAtCursor = null;

        var self = this;
        var onMouseMove = function(e) {
            self.x = e.clientX;
            self.y = e.clientY;
            mouseMoveHandler && mouseMoveHandler(e);
            self.mouseEvent = new MouseEvent(e, self.editor);
            self.$mouseMoved = true;
        };

        var onCaptureEnd = function(e) {
            clearInterval(timerId);
            onCaptureInterval();
            self[self.state + "End"] && self[self.state + "End"](e);
            self.$clickSelection = null;
            if (renderer.$keepTextAreaAtCursor == null) {
                renderer.$keepTextAreaAtCursor = true;
                renderer.$moveTextAreaToCursor();
            }
            self.isMousePressed = false;
            self.$onCaptureMouseMove = self.releaseMouse = null;
            self.onMouseEvent("mouseup", e);
        };

        var onCaptureInterval = function() {
            self[self.state] && self[self.state]();
            self.$mouseMoved = false;
        };

        if (useragent.isOldIE && ev.domEvent.type == "dblclick") {
            return setTimeout(function() {onCaptureEnd(ev);});
        }

        self.$onCaptureMouseMove = onMouseMove;
        self.releaseMouse = event.capture(this.editor.container, onMouseMove, onCaptureEnd);
        var timerId = setInterval(onCaptureInterval, 20);
    };
    this.releaseMouse = null;
}).call(MouseHandler.prototype);

config.defineOptions(MouseHandler.prototype, "mouseHandler", {
    scrollSpeed: {initialValue: 2},
    dragDelay: {initialValue: 150},
    dragEnabled: {initialValue: true},
    focusTimout: {initialValue: 0},
    tooltipFollowsMouse: {initialValue: true}
});


exports.MouseHandler = MouseHandler;
});

ace.define('ace/layer/font_metrics', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/dom', 'ace/lib/lang', 'ace/lib/event_emitter'], function(require, exports, module) {

var oop = require("../lib/oop");
var dom = require("../lib/dom");
var lang = require("../lib/lang");
var EventEmitter = require("../lib/event_emitter").EventEmitter;

var CHAR_COUNT = 0;

var FontMetrics = exports.FontMetrics = function(parentEl, interval) {
    this.el = dom.createElement("div");
    this.$setMeasureNodeStyles(this.el.style, true);
    
    this.$main = dom.createElement("div");
    this.$setMeasureNodeStyles(this.$main.style);
    
    this.$measureNode = dom.createElement("div");
    this.$setMeasureNodeStyles(this.$measureNode.style);
    
    
    this.el.appendChild(this.$main);
    this.el.appendChild(this.$measureNode);
    parentEl.appendChild(this.el);
    
    if (!CHAR_COUNT)
        this.$testFractionalRect();
    this.$measureNode.textContent = lang.stringRepeat("X", CHAR_COUNT);
    
    this.$characterSize = {width: 0, height: 0};
    this.checkForSizeChanges();
};

(function() {

    oop.implement(this, EventEmitter);
        
    this.$characterSize = {width: 0, height: 0};
    
    this.$testFractionalRect = function() {
        var el = dom.createElement("div");
        this.$setMeasureNodeStyles(el.style);
        el.style.width = "0.2px";
        document.documentElement.appendChild(el);
        var w = el.getBoundingClientRect().width;
        if (w > 0 && w < 1)
            CHAR_COUNT = 1;
        else
            CHAR_COUNT = 100;
        el.parentNode.removeChild(el);
    };
    
    this.$setMeasureNodeStyles = function(style, isRoot) {
        style.width = style.height = "auto";
        style.left = style.top = "-100px";
        style.visibility = "hidden";
        style.position = "fixed";
        style.whiteSpace = "pre";
        style.font = "inherit";
        style.overflow = isRoot ? "hidden" : "visible";
    };

    this.checkForSizeChanges = function() {
        var size = this.$measureSizes();
        if (size && (this.$characterSize.width !== size.width || this.$characterSize.height !== size.height)) {
            this.$measureNode.style.fontWeight = "bold";
            var boldSize = this.$measureSizes();
            this.$measureNode.style.fontWeight = "";
            this.$characterSize = size;
            this.charSizes = Object.create(null);
            this.allowBoldFonts = boldSize && boldSize.width === size.width && boldSize.height === size.height;
            this._emit("changeCharacterSize", {data: size});
        }
    };

    this.$pollSizeChanges = function() {
        if (this.$pollSizeChangesTimer)
            return this.$pollSizeChangesTimer;
        var self = this;
        return this.$pollSizeChangesTimer = setInterval(function() {
            self.checkForSizeChanges();
        }, 500);
    };
    
    this.setPolling = function(val) {
        if (val) {
            this.$pollSizeChanges();
        } else {
            if (this.$pollSizeChangesTimer)
                this.$pollSizeChangesTimer;
        }
    };

    this.$measureSizes = function() {
        var rect = this.$measureNode.getBoundingClientRect();
        var size = {
            height: rect.height,
            width: rect.width / CHAR_COUNT
        };
        if (size.width === 0 || size.height === 0)
            return null;
        return size;
    };

    this.$measureCharWidth = function(ch) {
        this.$main.textContent = lang.stringRepeat(ch, CHAR_COUNT);
        var rect = this.$main.getBoundingClientRect();
        return rect.width / CHAR_COUNT;
    };
    
    this.getCharacterWidth = function(ch) {
        var w = this.charSizes[ch];
        if (w === undefined) {
            this.charSizes[ch] = this.$measureCharWidth(ch) / this.$characterSize.width;
        }
        return w;
    };

    this.destroy = function() {
        clearInterval(this.$pollSizeChangesTimer);
        if (this.el && this.el.parentNode)
            this.el.parentNode.removeChild(this.el);
    };

}).call(FontMetrics.prototype);

});

ace.define('ace/keyboard/textinput', ['require', 'exports', 'module' , 'ace/lib/event', 'ace/lib/useragent', 'ace/lib/dom', 'ace/lib/lang'], function(require, exports, module) {


var event = require("../lib/event");
var useragent = require("../lib/useragent");
var dom = require("../lib/dom");
var lang = require("../lib/lang");
var BROKEN_SETDATA = useragent.isChrome < 18;

var TextInput = function(parentNode, host) {
    var text = dom.createElement("textarea");
    text.className = "ace_text-input";

    if (useragent.isTouchPad)
        text.setAttribute("x-palm-disable-auto-cap", true);

    text.wrap = "off";
    text.autocorrect = "off";
    text.autocapitalize = "off";
    text.spellcheck = false;

    text.style.opacity = "0";
    parentNode.insertBefore(text, parentNode.firstChild);

    var PLACEHOLDER = "\x01\x01";

    var cut = false;
    var copied = false;
    var pasted = false;
    var inComposition = false;
    var tempStyle = '';
    var isSelectionEmpty = true;
    try { var isFocused = document.activeElement === text; } catch(e) {}
    
    event.addListener(text, "blur", function() {
        host.onBlur();
        isFocused = false;
    });
    event.addListener(text, "focus", function() {
        isFocused = true;
        host.onFocus();
        resetSelection();
    });
    this.focus = function() { text.focus(); };
    this.blur = function() { text.blur(); };
    this.isFocused = function() {
        return isFocused;
    };
    var syncSelection = lang.delayedCall(function() {
        isFocused && resetSelection(isSelectionEmpty);
    });
    var syncValue = lang.delayedCall(function() {
         if (!inComposition) {
            text.value = PLACEHOLDER;
            isFocused && resetSelection();
         }
    });

    function resetSelection(isEmpty) {
        if (inComposition)
            return;
        if (inputHandler) {
            selectionStart = 0;
            selectionEnd = isEmpty ? 0 : text.value.length - 1;
        } else {
            var selectionStart = isEmpty ? 2 : 1;
            var selectionEnd = 2;
        }
        try {
            text.setSelectionRange(selectionStart, selectionEnd);
        } catch(e){}
    }

    function resetValue() {
        if (inComposition)
            return;
        text.value = PLACEHOLDER;
        if (useragent.isWebKit)
            syncValue.schedule();
    }

    useragent.isWebKit || host.addEventListener('changeSelection', function() {
        if (host.selection.isEmpty() != isSelectionEmpty) {
            isSelectionEmpty = !isSelectionEmpty;
            syncSelection.schedule();
        }
    });

    resetValue();
    if (isFocused)
        host.onFocus();


    var isAllSelected = function(text) {
        return text.selectionStart === 0 && text.selectionEnd === text.value.length;
    };
    if (!text.setSelectionRange && text.createTextRange) {
        text.setSelectionRange = function(selectionStart, selectionEnd) {
            var range = this.createTextRange();
            range.collapse(true);
            range.moveStart('character', selectionStart);
            range.moveEnd('character', selectionEnd);
            range.select();
        };
        isAllSelected = function(text) {
            try {
                var range = text.ownerDocument.selection.createRange();
            }catch(e) {}
            if (!range || range.parentElement() != text) return false;
                return range.text == text.value;
        }
    }
    if (useragent.isOldIE) {
        var inPropertyChange = false;
        var onPropertyChange = function(e){
            if (inPropertyChange)
                return;
            var data = text.value;
            if (inComposition || !data || data == PLACEHOLDER)
                return;
            if (e && data == PLACEHOLDER[0])
                return syncProperty.schedule();

            sendText(data);
            inPropertyChange = true;
            resetValue();
            inPropertyChange = false;
        };
        var syncProperty = lang.delayedCall(onPropertyChange);
        event.addListener(text, "propertychange", onPropertyChange);

        var keytable = { 13:1, 27:1 };
        event.addListener(text, "keyup", function (e) {
            if (inComposition && (!text.value || keytable[e.keyCode]))
                setTimeout(onCompositionEnd, 0);
            if ((text.value.charCodeAt(0)||0) < 129) {
                return syncProperty.call();
            }
            inComposition ? onCompositionUpdate() : onCompositionStart();
        });
        event.addListener(text, "keydown", function (e) {
            syncProperty.schedule(50);
        });
    }

    var onSelect = function(e) {
        if (cut) {
            cut = false;
        } else if (copied) {
            copied = false;
        } else if (isAllSelected(text)) {
            host.selectAll();
            resetSelection();
        } else if (inputHandler) {
            resetSelection(host.selection.isEmpty());
        }
    };

    var inputHandler = null;
    this.setInputHandler = function(cb) {inputHandler = cb};
    this.getInputHandler = function() {return inputHandler};
    var afterContextMenu = false;
    
    var sendText = function(data) {
        if (inputHandler) {
            data = inputHandler(data);
            inputHandler = null;
        }
        if (pasted) {
            resetSelection();
            if (data)
                host.onPaste(data);
            pasted = false;
        } else if (data == PLACEHOLDER.charAt(0)) {
            if (afterContextMenu)
                host.execCommand("del", {source: "ace"});
            else // some versions of android do not fire keydown when pressing backspace
                host.execCommand("backspace", {source: "ace"});
        } else {
            if (data.substring(0, 2) == PLACEHOLDER)
                data = data.substr(2);
            else if (data.charAt(0) == PLACEHOLDER.charAt(0))
                data = data.substr(1);
            else if (data.charAt(data.length - 1) == PLACEHOLDER.charAt(0))
                data = data.slice(0, -1);
            if (data.charAt(data.length - 1) == PLACEHOLDER.charAt(0))
                data = data.slice(0, -1);
            
            if (data)
                host.onTextInput(data);
        }
        if (afterContextMenu)
            afterContextMenu = false;
    };
    var onInput = function(e) {
        if (inComposition)
            return;
        var data = text.value;
        sendText(data);
        resetValue();
    };

    var onCut = function(e) {
        var data = host.getCopyText();
        if (!data) {
            event.preventDefault(e);
            return;
        }

        var clipboardData = e.clipboardData || window.clipboardData;

        if (clipboardData && !BROKEN_SETDATA) {
            var supported = clipboardData.setData("Text", data);
            if (supported) {
                host.onCut();
                event.preventDefault(e);
            }
        }

        if (!supported) {
            cut = true;
            text.value = data;
            text.select();
            setTimeout(function(){
                cut = false;
                resetValue();
                resetSelection();
                host.onCut();
            });
        }
    };

    var onCopy = function(e) {
        var data = host.getCopyText();
        if (!data) {
            event.preventDefault(e);
            return;
        }

        var clipboardData = e.clipboardData || window.clipboardData;
        if (clipboardData && !BROKEN_SETDATA) {
            var supported = clipboardData.setData("Text", data);
            if (supported) {
                host.onCopy();
                event.preventDefault(e);
            }
        }
        if (!supported) {
            copied = true;
            text.value = data;
            text.select();
            setTimeout(function(){
                copied = false;
                resetValue();
                resetSelection();
                host.onCopy();
            });
        }
    };

    var onPaste = function(e) {
        var clipboardData = e.clipboardData || window.clipboardData;

        if (clipboardData) {
            var data = clipboardData.getData("Text");
            if (data)
                host.onPaste(data);
            if (useragent.isIE)
                setTimeout(resetSelection);
            event.preventDefault(e);
        }
        else {
            text.value = "";
            pasted = true;
        }
    };

    event.addCommandKeyListener(text, host.onCommandKey.bind(host));

    event.addListener(text, "select", onSelect);

    event.addListener(text, "input", onInput);

    event.addListener(text, "cut", onCut);
    event.addListener(text, "copy", onCopy);
    event.addListener(text, "paste", onPaste);
    if (!('oncut' in text) || !('oncopy' in text) || !('onpaste' in text)){
        event.addListener(parentNode, "keydown", function(e) {
            if ((useragent.isMac && !e.metaKey) || !e.ctrlKey)
            return;

            switch (e.keyCode) {
                case 67:
                    onCopy(e);
                    break;
                case 86:
                    onPaste(e);
                    break;
                case 88:
                    onCut(e);
                    break;
            }
        });
    }
    var onCompositionStart = function(e) {
        if (inComposition || !host.onCompositionStart) return;
        inComposition = {};
        host.onCompositionStart();
        setTimeout(onCompositionUpdate, 0);
        host.on("mousedown", onCompositionEnd);
        if (!host.selection.isEmpty()) {
            host.insert("");
            host.session.markUndoGroup();
            host.selection.clearSelection();
        }
        host.session.markUndoGroup();
    };

    var onCompositionUpdate = function() {
        if (!inComposition || !host.onCompositionUpdate) return;
        var val = text.value.replace(/\x01/g, "");
        if (inComposition.lastValue === val) return;
        
        host.onCompositionUpdate(val);
        if (inComposition.lastValue)
            host.undo();
        inComposition.lastValue = val;
        if (inComposition.lastValue) {
            var r = host.selection.getRange();
            host.insert(inComposition.lastValue);
            host.session.markUndoGroup();
            inComposition.range = host.selection.getRange();
            host.selection.setRange(r);
            host.selection.clearSelection();
        }
    };

    var onCompositionEnd = function(e) {
        if (!host.onCompositionEnd) return;
        var c = inComposition;
        inComposition = false;
        var timer = setTimeout(function() {
            timer = null;
            var str = text.value.replace(/\x01/g, "");
            if (inComposition)
                return
            else if (str == c.lastValue)
                resetValue();
            else if (!c.lastValue && str) {
                resetValue();
                sendText(str);
            }
        });
        inputHandler = function compositionInputHandler(str) {
            if (timer)
                clearTimeout(timer);
            str = str.replace(/\x01/g, "");
            if (str == c.lastValue)
                return "";
            if (c.lastValue && timer)
                host.undo();
            return str;
        };
        host.onCompositionEnd();
        host.removeListener("mousedown", onCompositionEnd);
        if (e.type == "compositionend" && c.range) {
            host.selection.setRange(c.range);
        }
    };
    
    

    var syncComposition = lang.delayedCall(onCompositionUpdate, 50);

    event.addListener(text, "compositionstart", onCompositionStart);
    if (useragent.isGecko) {
        event.addListener(text, "text", function(){syncComposition.schedule()});
    } else {
        event.addListener(text, "keyup", function(){syncComposition.schedule()});
        event.addListener(text, "keydown", function(){syncComposition.schedule()});
    }
    event.addListener(text, "compositionend", onCompositionEnd);

    this.getElement = function() {
        return text;
    };

    this.setReadOnly = function(readOnly) {
       text.readOnly = readOnly;
    };

    this.onContextMenu = function(e) {
        afterContextMenu = true;
        if (!tempStyle)
            tempStyle = text.style.cssText;

        text.style.cssText = "z-index:100000;" + (useragent.isIE ? "opacity:0.1;" : "");

        resetSelection(host.selection.isEmpty());
        host._emit("nativecontextmenu", {target: host, domEvent: e});
        var rect = host.container.getBoundingClientRect();
        var style = dom.computedStyle(host.container);
        var top = rect.top + (parseInt(style.borderTopWidth) || 0);
        var left = rect.left + (parseInt(rect.borderLeftWidth) || 0);
        var maxTop = rect.bottom - top - text.clientHeight;
        var move = function(e) {
            text.style.left = e.clientX - left - 2 + "px";
            text.style.top = Math.min(e.clientY - top - 2, maxTop) + "px";
        }; 
        move(e);

        if (e.type != "mousedown")
            return;

        if (host.renderer.$keepTextAreaAtCursor)
            host.renderer.$keepTextAreaAtCursor = null;
        if (useragent.isWin)
            event.capture(host.container, move, onContextMenuClose);
    };

    this.onContextMenuClose = onContextMenuClose;
    function onContextMenuClose() {
        setTimeout(function () {
            if (tempStyle) {
                text.style.cssText = tempStyle;
                tempStyle = '';
            }
            if (host.renderer.$keepTextAreaAtCursor == null) {
                host.renderer.$keepTextAreaAtCursor = true;
                host.renderer.$moveTextAreaToCursor();
            }
        }, 0);
    }
    if (!useragent.isGecko || useragent.isMac) {
        var onContextMenu = function(e) {
            host.textInput.onContextMenu(e);
            onContextMenuClose();
        };
        event.addListener(host.renderer.scroller, "contextmenu", onContextMenu);
        event.addListener(text, "contextmenu", onContextMenu);
    }
};

exports.TextInput = TextInput;
});

ace.define('ace/lib/lang', ['require', 'exports', 'module' ], function(require, exports, module) {


exports.last = function(a) {
    return a[a.length - 1];
};

exports.stringReverse = function(string) {
    return string.split("").reverse().join("");
};

exports.stringRepeat = function (string, count) {
    var result = '';
    while (count > 0) {
        if (count & 1)
            result += string;

        if (count >>= 1)
            string += string;
    }
    return result;
};

var trimBeginRegexp = /^\s\s*/;
var trimEndRegexp = /\s\s*$/;

exports.stringTrimLeft = function (string) {
    return string.replace(trimBeginRegexp, '');
};

exports.stringTrimRight = function (string) {
    return string.replace(trimEndRegexp, '');
};

exports.copyObject = function(obj) {
    var copy = {};
    for (var key in obj) {
        copy[key] = obj[key];
    }
    return copy;
};

exports.copyArray = function(array){
    var copy = [];
    for (var i=0, l=array.length; i<l; i++) {
        if (array[i] && typeof array[i] == "object")
            copy[i] = this.copyObject( array[i] );
        else 
            copy[i] = array[i];
    }
    return copy;
};

exports.deepCopy = function (obj) {
    if (typeof obj !== "object" || !obj)
        return obj;
    var cons = obj.constructor;
    if (cons === RegExp)
        return obj;
    
    var copy = cons();
    for (var key in obj) {
        if (typeof obj[key] === "object") {
            copy[key] = exports.deepCopy(obj[key]);
        } else {
            copy[key] = obj[key];
        }
    }
    return copy;
};

exports.arrayToMap = function(arr) {
    var map = {};
    for (var i=0; i<arr.length; i++) {
        map[arr[i]] = 1;
    }
    return map;

};

exports.createMap = function(props) {
    var map = Object.create(null);
    for (var i in props) {
        map[i] = props[i];
    }
    return map;
};
exports.arrayRemove = function(array, value) {
  for (var i = 0; i <= array.length; i++) {
    if (value === array[i]) {
      array.splice(i, 1);
    }
  }
};

exports.escapeRegExp = function(str) {
    return str.replace(/([.*+?^${}()|[\]\/\\])/g, '\\$1');
};

exports.escapeHTML = function(str) {
    return str.replace(/&/g, "&#38;").replace(/"/g, "&#34;").replace(/'/g, "&#39;").replace(/</g, "&#60;");
};

exports.getMatchOffsets = function(string, regExp) {
    var matches = [];

    string.replace(regExp, function(str) {
        matches.push({
            offset: arguments[arguments.length-2],
            length: str.length
        });
    });

    return matches;
};
exports.deferredCall = function(fcn) {

    var timer = null;
    var callback = function() {
        timer = null;
        fcn();
    };

    var deferred = function(timeout) {
        deferred.cancel();
        timer = setTimeout(callback, timeout || 0);
        return deferred;
    };

    deferred.schedule = deferred;

    deferred.call = function() {
        this.cancel();
        fcn();
        return deferred;
    };

    deferred.cancel = function() {
        clearTimeout(timer);
        timer = null;
        return deferred;
    };
    
    deferred.isPending = function() {
        return timer;
    };

    return deferred;
};


exports.delayedCall = function(fcn, defaultTimeout) {
    var timer = null;
    var callback = function() {
        timer = null;
        fcn();
    };

    var _self = function(timeout) {
        if (timer == null)
            timer = setTimeout(callback, timeout || defaultTimeout);
    };

    _self.delay = function(timeout) {
        timer && clearTimeout(timer);
        timer = setTimeout(callback, timeout || defaultTimeout);
    };
    _self.schedule = _self;

    _self.call = function() {
        this.cancel();
        fcn();
    };

    _self.cancel = function() {
        timer && clearTimeout(timer);
        timer = null;
    };

    _self.isPending = function() {
        return timer;
    };

    return _self;
};
});

ace.define('ace/multi_select', ['require', 'exports', 'module' , 'ace/range_list', 'ace/range', 'ace/selection', 'ace/mouse/multi_select_handler', 'ace/lib/event', 'ace/lib/lang', 'ace/commands/multi_select_commands', 'ace/search', 'ace/edit_session', 'ace/editor', 'ace/config'], function(require, exports, module) {

var RangeList = require("./range_list").RangeList;
var Range = require("./range").Range;
var Selection = require("./selection").Selection;
var onMouseDown = require("./mouse/multi_select_handler").onMouseDown;
var event = require("./lib/event");
var lang = require("./lib/lang");
var commands = require("./commands/multi_select_commands");
exports.commands = commands.defaultCommands.concat(commands.multiSelectCommands);
var Search = require("./search").Search;
var search = new Search();

function find(session, needle, dir) {
    search.$options.wrap = true;
    search.$options.needle = needle;
    search.$options.backwards = dir == -1;
    return search.find(session);
}
var EditSession = require("./edit_session").EditSession;
(function() {
    this.getSelectionMarkers = function() {
        return this.$selectionMarkers;
    };
}).call(EditSession.prototype);
(function() {
    this.ranges = null;
    this.rangeList = null;
    this.addRange = function(range, $blockChangeEvents) {
        if (!range)
            return;

        if (!this.inMultiSelectMode && this.rangeCount == 0) {
            var oldRange = this.toOrientedRange();
            this.rangeList.add(oldRange);
            this.rangeList.add(range);
            if (this.rangeList.ranges.length != 2) {
                this.rangeList.removeAll();
                return $blockChangeEvents || this.fromOrientedRange(range);
            }
            this.rangeList.removeAll();
            this.rangeList.add(oldRange);
            this.$onAddRange(oldRange);
        }

        if (!range.cursor)
            range.cursor = range.end;

        var removed = this.rangeList.add(range);

        this.$onAddRange(range);

        if (removed.length)
            this.$onRemoveRange(removed);

        if (this.rangeCount > 1 && !this.inMultiSelectMode) {
            this._signal("multiSelect");
            this.inMultiSelectMode = true;
            this.session.$undoSelect = false;
            this.rangeList.attach(this.session);
        }

        return $blockChangeEvents || this.fromOrientedRange(range);
    };

    this.toSingleRange = function(range) {
        range = range || this.ranges[0];
        var removed = this.rangeList.removeAll();
        if (removed.length)
            this.$onRemoveRange(removed);

        range && this.fromOrientedRange(range);
    };
    this.substractPoint = function(pos) {
        var removed = this.rangeList.substractPoint(pos);
        if (removed) {
            this.$onRemoveRange(removed);
            return removed[0];
        }
    };
    this.mergeOverlappingRanges = function() {
        var removed = this.rangeList.merge();
        if (removed.length)
            this.$onRemoveRange(removed);
        else if(this.ranges[0])
            this.fromOrientedRange(this.ranges[0]);
    };

    this.$onAddRange = function(range) {
        this.rangeCount = this.rangeList.ranges.length;
        this.ranges.unshift(range);
        this._signal("addRange", {range: range});
    };

    this.$onRemoveRange = function(removed) {
        this.rangeCount = this.rangeList.ranges.length;
        if (this.rangeCount == 1 && this.inMultiSelectMode) {
            var lastRange = this.rangeList.ranges.pop();
            removed.push(lastRange);
            this.rangeCount = 0;
        }

        for (var i = removed.length; i--; ) {
            var index = this.ranges.indexOf(removed[i]);
            this.ranges.splice(index, 1);
        }

        this._signal("removeRange", {ranges: removed});

        if (this.rangeCount == 0 && this.inMultiSelectMode) {
            this.inMultiSelectMode = false;
            this._signal("singleSelect");
            this.session.$undoSelect = true;
            this.rangeList.detach(this.session);
        }

        lastRange = lastRange || this.ranges[0];
        if (lastRange && !lastRange.isEqual(this.getRange()))
            this.fromOrientedRange(lastRange);
    };
    this.$initRangeList = function() {
        if (this.rangeList)
            return;

        this.rangeList = new RangeList();
        this.ranges = [];
        this.rangeCount = 0;
    };
    this.getAllRanges = function() {
        return this.rangeCount ? this.rangeList.ranges.concat() : [this.getRange()];
    };

    this.splitIntoLines = function () {
        if (this.rangeCount > 1) {
            var ranges = this.rangeList.ranges;
            var lastRange = ranges[ranges.length - 1];
            var range = Range.fromPoints(ranges[0].start, lastRange.end);

            this.toSingleRange();
            this.setSelectionRange(range, lastRange.cursor == lastRange.start);
        } else {
            var range = this.getRange();
            var isBackwards = this.isBackwards();
            var startRow = range.start.row;
            var endRow = range.end.row;
            if (startRow == endRow) {
                if (isBackwards)
                    var start = range.end, end = range.start;
                else
                    var start = range.start, end = range.end;
                
                this.addRange(Range.fromPoints(end, end));
                this.addRange(Range.fromPoints(start, start));
                return;
            }

            var rectSel = [];
            var r = this.getLineRange(startRow, true);
            r.start.column = range.start.column;
            rectSel.push(r);

            for (var i = startRow + 1; i < endRow; i++)
                rectSel.push(this.getLineRange(i, true));

            r = this.getLineRange(endRow, true);
            r.end.column = range.end.column;
            rectSel.push(r);

            rectSel.forEach(this.addRange, this);
        }
    };
    this.toggleBlockSelection = function () {
        if (this.rangeCount > 1) {
            var ranges = this.rangeList.ranges;
            var lastRange = ranges[ranges.length - 1];
            var range = Range.fromPoints(ranges[0].start, lastRange.end);

            this.toSingleRange();
            this.setSelectionRange(range, lastRange.cursor == lastRange.start);
        } else {
            var cursor = this.session.documentToScreenPosition(this.selectionLead);
            var anchor = this.session.documentToScreenPosition(this.selectionAnchor);

            var rectSel = this.rectangularRangeBlock(cursor, anchor);
            rectSel.forEach(this.addRange, this);
        }
    };
    this.rectangularRangeBlock = function(screenCursor, screenAnchor, includeEmptyLines) {
        var rectSel = [];

        var xBackwards = screenCursor.column < screenAnchor.column;
        if (xBackwards) {
            var startColumn = screenCursor.column;
            var endColumn = screenAnchor.column;
        } else {
            var startColumn = screenAnchor.column;
            var endColumn = screenCursor.column;
        }

        var yBackwards = screenCursor.row < screenAnchor.row;
        if (yBackwards) {
            var startRow = screenCursor.row;
            var endRow = screenAnchor.row;
        } else {
            var startRow = screenAnchor.row;
            var endRow = screenCursor.row;
        }

        if (startColumn < 0)
            startColumn = 0;
        if (startRow < 0)
            startRow = 0;

        if (startRow == endRow)
            includeEmptyLines = true;

        for (var row = startRow; row <= endRow; row++) {
            var range = Range.fromPoints(
                this.session.screenToDocumentPosition(row, startColumn),
                this.session.screenToDocumentPosition(row, endColumn)
            );
            if (range.isEmpty()) {
                if (docEnd && isSamePoint(range.end, docEnd))
                    break;
                var docEnd = range.end;
            }
            range.cursor = xBackwards ? range.start : range.end;
            rectSel.push(range);
        }

        if (yBackwards)
            rectSel.reverse();

        if (!includeEmptyLines) {
            var end = rectSel.length - 1;
            while (rectSel[end].isEmpty() && end > 0)
                end--;
            if (end > 0) {
                var start = 0;
                while (rectSel[start].isEmpty())
                    start++;
            }
            for (var i = end; i >= start; i--) {
                if (rectSel[i].isEmpty())
                    rectSel.splice(i, 1);
            }
        }

        return rectSel;
    };
}).call(Selection.prototype);
var Editor = require("./editor").Editor;
(function() {
    this.updateSelectionMarkers = function() {
        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
    };
    this.addSelectionMarker = function(orientedRange) {
        if (!orientedRange.cursor)
            orientedRange.cursor = orientedRange.end;

        var style = this.getSelectionStyle();
        orientedRange.marker = this.session.addMarker(orientedRange, "ace_selection", style);

        this.session.$selectionMarkers.push(orientedRange);
        this.session.selectionMarkerCount = this.session.$selectionMarkers.length;
        return orientedRange;
    };
    this.removeSelectionMarker = function(range) {
        if (!range.marker)
            return;
        this.session.removeMarker(range.marker);
        var index = this.session.$selectionMarkers.indexOf(range);
        if (index != -1)
            this.session.$selectionMarkers.splice(index, 1);
        this.session.selectionMarkerCount = this.session.$selectionMarkers.length;
    };

    this.removeSelectionMarkers = function(ranges) {
        var markerList = this.session.$selectionMarkers;
        for (var i = ranges.length; i--; ) {
            var range = ranges[i];
            if (!range.marker)
                continue;
            this.session.removeMarker(range.marker);
            var index = markerList.indexOf(range);
            if (index != -1)
                markerList.splice(index, 1);
        }
        this.session.selectionMarkerCount = markerList.length;
    };

    this.$onAddRange = function(e) {
        this.addSelectionMarker(e.range);
        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
    };

    this.$onRemoveRange = function(e) {
        this.removeSelectionMarkers(e.ranges);
        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
    };

    this.$onMultiSelect = function(e) {
        if (this.inMultiSelectMode)
            return;
        this.inMultiSelectMode = true;

        this.setStyle("ace_multiselect");
        this.keyBinding.addKeyboardHandler(commands.keyboardHandler);
        this.commands.setDefaultHandler("exec", this.$onMultiSelectExec);

        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
    };

    this.$onSingleSelect = function(e) {
        if (this.session.multiSelect.inVirtualMode)
            return;
        this.inMultiSelectMode = false;

        this.unsetStyle("ace_multiselect");
        this.keyBinding.removeKeyboardHandler(commands.keyboardHandler);

        this.commands.removeDefaultHandler("exec", this.$onMultiSelectExec);
        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
        this._emit("changeSelection");
    };

    this.$onMultiSelectExec = function(e) {
        var command = e.command;
        var editor = e.editor;
        if (!editor.multiSelect)
            return;
        if (!command.multiSelectAction) {
            var result = command.exec(editor, e.args || {});
            editor.multiSelect.addRange(editor.multiSelect.toOrientedRange());
            editor.multiSelect.mergeOverlappingRanges();
        } else if (command.multiSelectAction == "forEach") {
            result = editor.forEachSelection(command, e.args);
        } else if (command.multiSelectAction == "forEachLine") {
            result = editor.forEachSelection(command, e.args, true);
        } else if (command.multiSelectAction == "single") {
            editor.exitMultiSelectMode();
            result = command.exec(editor, e.args || {});
        } else {
            result = command.multiSelectAction(editor, e.args || {});
        }
        return result;
    }; 
    this.forEachSelection = function(cmd, args, $byLines) {
        if (this.inVirtualSelectionMode)
            return;

        var session = this.session;
        var selection = this.selection;
        var rangeList = selection.rangeList;
        var result;
        
        var reg = selection._eventRegistry;
        selection._eventRegistry = {};

        var tmpSel = new Selection(session);
        this.inVirtualSelectionMode = true;
        for (var i = rangeList.ranges.length; i--;) {
            if ($byLines) {
                while (i > 0 && rangeList.ranges[i].start.row == rangeList.ranges[i - 1].end.row)
                    i--;
            }
            tmpSel.fromOrientedRange(rangeList.ranges[i]);
            tmpSel.id = rangeList.ranges[i].marker;
            this.selection = session.selection = tmpSel;
            var cmdResult = cmd.exec(this, args || {});
            if (result !== undefined)
                result = cmdResult;
            tmpSel.toOrientedRange(rangeList.ranges[i]);
        }
        tmpSel.detach();

        this.selection = session.selection = selection;
        this.inVirtualSelectionMode = false;
        selection._eventRegistry = reg;
        selection.mergeOverlappingRanges();
        
        var anim = this.renderer.$scrollAnimation;
        this.onCursorChange();
        this.onSelectionChange();
        if (anim && anim.from == anim.to)
            this.renderer.animateScrolling(anim.from);
        
        return result;
    };
    this.exitMultiSelectMode = function() {
        if (!this.inMultiSelectMode || this.inVirtualSelectionMode)
            return;
        this.multiSelect.toSingleRange();
    };

    this.getSelectedText = function() {
        var text = "";
        if (this.inMultiSelectMode && !this.inVirtualSelectionMode) {
            var ranges = this.multiSelect.rangeList.ranges;
            var buf = [];
            for (var i = 0; i < ranges.length; i++) {
                buf.push(this.session.getTextRange(ranges[i]));
            }
            var nl = this.session.getDocument().getNewLineCharacter();
            text = buf.join(nl);
            if (text.length == (buf.length - 1) * nl.length)
                text = "";
        } else if (!this.selection.isEmpty()) {
            text = this.session.getTextRange(this.getSelectionRange());
        }
        return text;
    };
    this.onPaste = function(text) {
        if (this.$readOnly)
            return;


        var e = {text: text};
        this._signal("paste", e);
        text = e.text;
        if (!this.inMultiSelectMode || this.inVirtualSelectionMode)
            return this.insert(text);

        var lines = text.split(/\r\n|\r|\n/);
        var ranges = this.selection.rangeList.ranges;

        if (lines.length > ranges.length || lines.length < 2 || !lines[1])
            return this.commands.exec("insertstring", this, text);

        for (var i = ranges.length; i--;) {
            var range = ranges[i];
            if (!range.isEmpty())
                this.session.remove(range);

            this.session.insert(range.start, lines[i]);
        }
    };
    this.findAll = function(needle, options, additive) {
        options = options || {};
        options.needle = needle || options.needle;
        this.$search.set(options);

        var ranges = this.$search.findAll(this.session);
        if (!ranges.length)
            return 0;

        this.$blockScrolling += 1;
        var selection = this.multiSelect;

        if (!additive)
            selection.toSingleRange(ranges[0]);

        for (var i = ranges.length; i--; )
            selection.addRange(ranges[i], true);

        this.$blockScrolling -= 1;

        return ranges.length;
    };
    this.selectMoreLines = function(dir, skip) {
        var range = this.selection.toOrientedRange();
        var isBackwards = range.cursor == range.end;

        var screenLead = this.session.documentToScreenPosition(range.cursor);
        if (this.selection.$desiredColumn)
            screenLead.column = this.selection.$desiredColumn;

        var lead = this.session.screenToDocumentPosition(screenLead.row + dir, screenLead.column);

        if (!range.isEmpty()) {
            var screenAnchor = this.session.documentToScreenPosition(isBackwards ? range.end : range.start);
            var anchor = this.session.screenToDocumentPosition(screenAnchor.row + dir, screenAnchor.column);
        } else {
            var anchor = lead;
        }

        if (isBackwards) {
            var newRange = Range.fromPoints(lead, anchor);
            newRange.cursor = newRange.start;
        } else {
            var newRange = Range.fromPoints(anchor, lead);
            newRange.cursor = newRange.end;
        }

        newRange.desiredColumn = screenLead.column;
        if (!this.selection.inMultiSelectMode) {
            this.selection.addRange(range);
        } else {
            if (skip)
                var toRemove = range.cursor;
        }

        this.selection.addRange(newRange);
        if (toRemove)
            this.selection.substractPoint(toRemove);
    };
    this.transposeSelections = function(dir) {
        var session = this.session;
        var sel = session.multiSelect;
        var all = sel.ranges;

        for (var i = all.length; i--; ) {
            var range = all[i];
            if (range.isEmpty()) {
                var tmp = session.getWordRange(range.start.row, range.start.column);
                range.start.row = tmp.start.row;
                range.start.column = tmp.start.column;
                range.end.row = tmp.end.row;
                range.end.column = tmp.end.column;
            }
        }
        sel.mergeOverlappingRanges();

        var words = [];
        for (var i = all.length; i--; ) {
            var range = all[i];
            words.unshift(session.getTextRange(range));
        }

        if (dir < 0)
            words.unshift(words.pop());
        else
            words.push(words.shift());

        for (var i = all.length; i--; ) {
            var range = all[i];
            var tmp = range.clone();
            session.replace(range, words[i]);
            range.start.row = tmp.start.row;
            range.start.column = tmp.start.column;
        }
    };
    this.selectMore = function(dir, skip) {
        var session = this.session;
        var sel = session.multiSelect;

        var range = sel.toOrientedRange();
        if (range.isEmpty()) {
            range = session.getWordRange(range.start.row, range.start.column);
            range.cursor = dir == -1 ? range.start : range.end;
            this.multiSelect.addRange(range);
        }
        var needle = session.getTextRange(range);

        var newRange = find(session, needle, dir);
        if (newRange) {
            newRange.cursor = dir == -1 ? newRange.start : newRange.end;
            this.$blockScrolling += 1;
            this.session.unfold(newRange);
            this.multiSelect.addRange(newRange);
            this.$blockScrolling -= 1;
            this.renderer.scrollCursorIntoView(null, 0.5);
        }
        if (skip)
            this.multiSelect.substractPoint(range.cursor);
    };
    this.alignCursors = function() {
        var session = this.session;
        var sel = session.multiSelect;
        var ranges = sel.ranges;

        if (!ranges.length) {
            var range = this.selection.getRange();
            var fr = range.start.row, lr = range.end.row;
            var guessRange = fr == lr;
            if (guessRange) {
                var max = this.session.getLength();
                var line;
                do {
                    line = this.session.getLine(lr);
                } while (/[=:]/.test(line) && ++lr < max);
                do {
                    line = this.session.getLine(fr);
                } while (/[=:]/.test(line) && --fr > 0);
                
                if (fr < 0) fr = 0;
                if (lr >= max) lr = max - 1;
            }
            var lines = this.session.doc.removeLines(fr, lr);
            lines = this.$reAlignText(lines, guessRange);
            this.session.doc.insert({row: fr, column: 0}, lines.join("\n") + "\n");
            if (!guessRange) {
                range.start.column = 0;
                range.end.column = lines[lines.length - 1].length;
            }
            this.selection.setRange(range);
        } else {
            var row = -1;
            var sameRowRanges = ranges.filter(function(r) {
                if (r.cursor.row == row)
                    return true;
                row = r.cursor.row;
            });
            sel.$onRemoveRange(sameRowRanges);

            var maxCol = 0;
            var minSpace = Infinity;
            var spaceOffsets = ranges.map(function(r) {
                var p = r.cursor;
                var line = session.getLine(p.row);
                var spaceOffset = line.substr(p.column).search(/\S/g);
                if (spaceOffset == -1)
                    spaceOffset = 0;

                if (p.column > maxCol)
                    maxCol = p.column;
                if (spaceOffset < minSpace)
                    minSpace = spaceOffset;
                return spaceOffset;
            });
            ranges.forEach(function(r, i) {
                var p = r.cursor;
                var l = maxCol - p.column;
                var d = spaceOffsets[i] - minSpace;
                if (l > d)
                    session.insert(p, lang.stringRepeat(" ", l - d));
                else
                    session.remove(new Range(p.row, p.column, p.row, p.column - l + d));

                r.start.column = r.end.column = maxCol;
                r.start.row = r.end.row = p.row;
                r.cursor = r.end;
            });
            sel.fromOrientedRange(ranges[0]);
            this.renderer.updateCursor();
            this.renderer.updateBackMarkers();
        }
    };

    this.$reAlignText = function(lines, forceLeft) {
        var isLeftAligned = true, isRightAligned = true;
        var startW, textW, endW;

        return lines.map(function(line) {
            var m = line.match(/(\s*)(.*?)(\s*)([=:].*)/);
            if (!m)
                return [line];

            if (startW == null) {
                startW = m[1].length;
                textW = m[2].length;
                endW = m[3].length;
                return m;
            }

            if (startW + textW + endW != m[1].length + m[2].length + m[3].length)
                isRightAligned = false;
            if (startW != m[1].length)
                isLeftAligned = false;

            if (startW > m[1].length)
                startW = m[1].length;
            if (textW < m[2].length)
                textW = m[2].length;
            if (endW > m[3].length)
                endW = m[3].length;

            return m;
        }).map(forceLeft ? alignLeft :
            isLeftAligned ? isRightAligned ? alignRight : alignLeft : unAlign);

        function spaces(n) {
            return lang.stringRepeat(" ", n);
        }

        function alignLeft(m) {
            return !m[2] ? m[0] : spaces(startW) + m[2]
                + spaces(textW - m[2].length + endW)
                + m[4].replace(/^([=:])\s+/, "$1 ")
        }
        function alignRight(m) {
            return !m[2] ? m[0] : spaces(startW + textW - m[2].length) + m[2]
                + spaces(endW, " ")
                + m[4].replace(/^([=:])\s+/, "$1 ")
        }
        function unAlign(m) {
            return !m[2] ? m[0] : spaces(startW) + m[2]
                + spaces(endW)
                + m[4].replace(/^([=:])\s+/, "$1 ")
        }
    }
}).call(Editor.prototype);


function isSamePoint(p1, p2) {
    return p1.row == p2.row && p1.column == p2.column;
}
exports.onSessionChange = function(e) {
    var session = e.session;
    if (!session.multiSelect) {
        session.$selectionMarkers = [];
        session.selection.$initRangeList();
        session.multiSelect = session.selection;
    }
    this.multiSelect = session.multiSelect;

    var oldSession = e.oldSession;
    if (oldSession) {
        oldSession.multiSelect.removeEventListener("addRange", this.$onAddRange);
        oldSession.multiSelect.removeEventListener("removeRange", this.$onRemoveRange);
        oldSession.multiSelect.removeEventListener("multiSelect", this.$onMultiSelect);
        oldSession.multiSelect.removeEventListener("singleSelect", this.$onSingleSelect);
    }

    session.multiSelect.on("addRange", this.$onAddRange);
    session.multiSelect.on("removeRange", this.$onRemoveRange);
    session.multiSelect.on("multiSelect", this.$onMultiSelect);
    session.multiSelect.on("singleSelect", this.$onSingleSelect);

    if (this.inMultiSelectMode != session.selection.inMultiSelectMode) {
        if (session.selection.inMultiSelectMode)
            this.$onMultiSelect();
        else
            this.$onSingleSelect();
    }
};
function MultiSelect(editor) {
    if (editor.$multiselectOnSessionChange)
        return;
    editor.$onAddRange = editor.$onAddRange.bind(editor);
    editor.$onRemoveRange = editor.$onRemoveRange.bind(editor);
    editor.$onMultiSelect = editor.$onMultiSelect.bind(editor);
    editor.$onSingleSelect = editor.$onSingleSelect.bind(editor);
    editor.$multiselectOnSessionChange = exports.onSessionChange.bind(editor);

    editor.$multiselectOnSessionChange(editor);
    editor.on("changeSession", editor.$multiselectOnSessionChange);

    editor.on("mousedown", onMouseDown);
    editor.commands.addCommands(commands.defaultCommands);

    addAltCursorListeners(editor);
}

function addAltCursorListeners(editor){
    var el = editor.textInput.getElement();
    var altCursor = false;
    event.addListener(el, "keydown", function(e) {
        if (e.keyCode == 18 && !(e.ctrlKey || e.shiftKey || e.metaKey)) {
            if (!altCursor) {
                editor.renderer.setMouseCursor("crosshair");
                altCursor = true;
            }
        } else if (altCursor) {
            reset();
        }
    });

    event.addListener(el, "keyup", reset);
    event.addListener(el, "blur", reset);
    function reset(e) {
        if (altCursor) {
            editor.renderer.setMouseCursor("");
            altCursor = false;
        }
    }
}

exports.MultiSelect = MultiSelect;


require("./config").defineOptions(Editor.prototype, "editor", {
    enableMultiselect: {
        set: function(val) {
            MultiSelect(this);
            if (val) {
                this.on("changeSession", this.$multiselectOnSessionChange);
                this.on("mousedown", onMouseDown);
            } else {
                this.off("changeSession", this.$multiselectOnSessionChange);
                this.off("mousedown", onMouseDown);
            }
        },
        value: true
    }
})



});

ace.define('ace/editor', ['require', 'exports', 'module' , 'ace/lib/fixoldbrowsers', 'ace/lib/oop', 'ace/lib/dom', 'ace/lib/lang', 'ace/lib/useragent', 'ace/keyboard/textinput', 'ace/mouse/mouse_handler', 'ace/mouse/fold_handler', 'ace/keyboard/keybinding', 'ace/edit_session', 'ace/search', 'ace/range', 'ace/lib/event_emitter', 'ace/commands/command_manager', 'ace/commands/default_commands', 'ace/config'], function(require, exports, module) {


require("./lib/fixoldbrowsers");

var oop = require("./lib/oop");
var dom = require("./lib/dom");
var lang = require("./lib/lang");
var useragent = require("./lib/useragent");
var TextInput = require("./keyboard/textinput").TextInput;
var MouseHandler = require("./mouse/mouse_handler").MouseHandler;
var FoldHandler = require("./mouse/fold_handler").FoldHandler;
var KeyBinding = require("./keyboard/keybinding").KeyBinding;
var EditSession = require("./edit_session").EditSession;
var Search = require("./search").Search;
var Range = require("./range").Range;
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var CommandManager = require("./commands/command_manager").CommandManager;
var defaultCommands = require("./commands/default_commands").commands;
var config = require("./config");
var Editor = function(renderer, session) {
    var container = renderer.getContainerElement();
    this.container = container;
    this.renderer = renderer;

    this.commands = new CommandManager(useragent.isMac ? "mac" : "win", defaultCommands);
    this.textInput  = new TextInput(renderer.getTextAreaContainer(), this);
    this.renderer.textarea = this.textInput.getElement();
    this.keyBinding = new KeyBinding(this);
    this.$mouseHandler = new MouseHandler(this);
    new FoldHandler(this);

    this.$blockScrolling = 0;
    this.$search = new Search().set({
        wrap: true
    });

    this.$historyTracker = this.$historyTracker.bind(this);
    this.commands.on("exec", this.$historyTracker);

    this.$initOperationListeners();
    
    this._$emitInputEvent = lang.delayedCall(function() {
        this._signal("input", {});
        this.session.bgTokenizer && this.session.bgTokenizer.scheduleStart();
    }.bind(this));
    
    this.on("change", function(_, _self) {
        _self._$emitInputEvent.schedule(31);
    });

    this.setSession(session || new EditSession(""));
    config.resetOptions(this);
    config._signal("editor", this);
};

(function(){

    oop.implement(this, EventEmitter);

    this.$initOperationListeners = function() {
        function last(a) {return a[a.length - 1]}

        this.selections = [];
        this.commands.on("exec", function(e) {
            this.startOperation(e);

            var command = e.command;
            if (command.aceCommandGroup == "fileJump") {
                var prev = this.prevOp;
                if (!prev || prev.command.aceCommandGroup != "fileJump") {
                    this.lastFileJumpPos = last(this.selections);
                }
            } else {
                this.lastFileJumpPos = null;
            }
        }.bind(this), true);

        this.commands.on("afterExec", function(e) {
            var command = e.command;

            if (command.aceCommandGroup == "fileJump") {
                if (this.lastFileJumpPos && !this.curOp.selectionChanged) {
                    this.selection.fromJSON(this.lastFileJumpPos);
                }
            }
            this.endOperation(e);
        }.bind(this), true);

        this.$opResetTimer = lang.delayedCall(this.endOperation.bind(this));

        this.on("change", function() {
            this.curOp || this.startOperation();
            this.curOp.docChanged = true;
        }.bind(this), true);

        this.on("changeSelection", function() {
            this.curOp || this.startOperation();
            this.curOp.selectionChanged = true;
        }.bind(this), true);
    };

    this.curOp = null;
    this.prevOp = {};
    this.startOperation = function(commadEvent) {
        if (this.curOp) {
            if (!commadEvent || this.curOp.command)
                return;
            this.prevOp = this.curOp;
        }
        if (!commadEvent) {
            this.previousCommand = null;
            commadEvent = {};
        }

        this.$opResetTimer.schedule();
        this.curOp = {
            command: commadEvent.command || {},
            args: commadEvent.args,
            scrollTop: this.renderer.scrollTop
        };
        
        var command = this.curOp.command;
        if (command && command.scrollIntoView)
            this.$blockScrolling++;

        this.selections.push(this.selection.toJSON());
    };

    this.endOperation = function() {
        if (this.curOp) {
            var command = this.curOp.command;
            if (command && command.scrollIntoView) {
                this.$blockScrolling--;
                switch (command.scrollIntoView) {
                    case "center":
                        this.renderer.scrollCursorIntoView(null, 0.5);
                        break;
                    case "animate":
                    case "cursor":
                        this.renderer.scrollCursorIntoView();
                        break;
                    case "selectionPart":
                        var range = this.selection.getRange();
                        var config = this.renderer.layerConfig;
                        if (range.start.row >= config.lastRow || range.end.row <= config.firstRow) {
                            this.renderer.scrollSelectionIntoView(this.selection.anchor, this.selection.lead);
                        }
                        break;
                    default:
                        break;
                }
                if (command.scrollIntoView == "animate")
                    this.renderer.animateScrolling(this.curOp.scrollTop);
            }
            
            this.prevOp = this.curOp;
            this.curOp = null;
        }
    };

    this.$historyTracker = function(e) {
        if (!this.$mergeUndoDeltas)
            return;


        var prev = this.prevOp;
        var mergeableCommands = ["backspace", "del", "insertstring"];
        var shouldMerge = prev.command && (e.command.name == prev.command.name);
        if (e.command.name == "insertstring") {
            var text = e.args;
            if (this.mergeNextCommand === undefined)
                this.mergeNextCommand = true;

            shouldMerge = shouldMerge
                && this.mergeNextCommand // previous command allows to coalesce with
                && (!/\s/.test(text) || /\s/.test(prev.args)); // previous insertion was of same type

            this.mergeNextCommand = true;
        } else {
            shouldMerge = shouldMerge
                && mergeableCommands.indexOf(e.command.name) !== -1; // the command is mergeable
        }

        if (
            this.$mergeUndoDeltas != "always"
            && Date.now() - this.sequenceStartTime > 2000
        ) {
            shouldMerge = false; // the sequence is too long
        }

        if (shouldMerge)
            this.session.mergeUndoDeltas = true;
        else if (mergeableCommands.indexOf(e.command.name) !== -1)
            this.sequenceStartTime = Date.now();
    };
    this.setKeyboardHandler = function(keyboardHandler) {
        if (!keyboardHandler) {
            this.keyBinding.setKeyboardHandler(null);
        } else if (typeof keyboardHandler === "string") {
            this.$keybindingId = keyboardHandler;
            var _self = this;
            config.loadModule(["keybinding", keyboardHandler], function(module) {
                if (_self.$keybindingId == keyboardHandler)
                    _self.keyBinding.setKeyboardHandler(module && module.handler);
            });
        } else {
            this.$keybindingId = null;
            this.keyBinding.setKeyboardHandler(keyboardHandler);
        }
    };
    this.getKeyboardHandler = function() {
        return this.keyBinding.getKeyboardHandler();
    };
    this.setSession = function(session) {
        if (this.session == session)
            return;

        var oldSession = this.session;
        if (oldSession) {
            this.session.removeEventListener("change", this.$onDocumentChange);
            this.session.removeEventListener("changeMode", this.$onChangeMode);
            this.session.removeEventListener("tokenizerUpdate", this.$onTokenizerUpdate);
            this.session.removeEventListener("changeTabSize", this.$onChangeTabSize);
            this.session.removeEventListener("changeWrapLimit", this.$onChangeWrapLimit);
            this.session.removeEventListener("changeWrapMode", this.$onChangeWrapMode);
            this.session.removeEventListener("onChangeFold", this.$onChangeFold);
            this.session.removeEventListener("changeFrontMarker", this.$onChangeFrontMarker);
            this.session.removeEventListener("changeBackMarker", this.$onChangeBackMarker);
            this.session.removeEventListener("changeBreakpoint", this.$onChangeBreakpoint);
            this.session.removeEventListener("changeAnnotation", this.$onChangeAnnotation);
            this.session.removeEventListener("changeOverwrite", this.$onCursorChange);
            this.session.removeEventListener("changeScrollTop", this.$onScrollTopChange);
            this.session.removeEventListener("changeScrollLeft", this.$onScrollLeftChange);

            var selection = this.session.getSelection();
            selection.removeEventListener("changeCursor", this.$onCursorChange);
            selection.removeEventListener("changeSelection", this.$onSelectionChange);
        }

        this.session = session;
        if (session) {
            this.$onDocumentChange = this.onDocumentChange.bind(this);
            session.addEventListener("change", this.$onDocumentChange);
            this.renderer.setSession(session);
    
            this.$onChangeMode = this.onChangeMode.bind(this);
            session.addEventListener("changeMode", this.$onChangeMode);
    
            this.$onTokenizerUpdate = this.onTokenizerUpdate.bind(this);
            session.addEventListener("tokenizerUpdate", this.$onTokenizerUpdate);
    
            this.$onChangeTabSize = this.renderer.onChangeTabSize.bind(this.renderer);
            session.addEventListener("changeTabSize", this.$onChangeTabSize);
    
            this.$onChangeWrapLimit = this.onChangeWrapLimit.bind(this);
            session.addEventListener("changeWrapLimit", this.$onChangeWrapLimit);
    
            this.$onChangeWrapMode = this.onChangeWrapMode.bind(this);
            session.addEventListener("changeWrapMode", this.$onChangeWrapMode);
    
            this.$onChangeFold = this.onChangeFold.bind(this);
            session.addEventListener("changeFold", this.$onChangeFold);
    
            this.$onChangeFrontMarker = this.onChangeFrontMarker.bind(this);
            this.session.addEventListener("changeFrontMarker", this.$onChangeFrontMarker);
    
            this.$onChangeBackMarker = this.onChangeBackMarker.bind(this);
            this.session.addEventListener("changeBackMarker", this.$onChangeBackMarker);
    
            this.$onChangeBreakpoint = this.onChangeBreakpoint.bind(this);
            this.session.addEventListener("changeBreakpoint", this.$onChangeBreakpoint);
    
            this.$onChangeAnnotation = this.onChangeAnnotation.bind(this);
            this.session.addEventListener("changeAnnotation", this.$onChangeAnnotation);
    
            this.$onCursorChange = this.onCursorChange.bind(this);
            this.session.addEventListener("changeOverwrite", this.$onCursorChange);
    
            this.$onScrollTopChange = this.onScrollTopChange.bind(this);
            this.session.addEventListener("changeScrollTop", this.$onScrollTopChange);
    
            this.$onScrollLeftChange = this.onScrollLeftChange.bind(this);
            this.session.addEventListener("changeScrollLeft", this.$onScrollLeftChange);
    
            this.selection = session.getSelection();
            this.selection.addEventListener("changeCursor", this.$onCursorChange);
    
            this.$onSelectionChange = this.onSelectionChange.bind(this);
            this.selection.addEventListener("changeSelection", this.$onSelectionChange);
    
            this.onChangeMode();
    
            this.$blockScrolling += 1;
            this.onCursorChange();
            this.$blockScrolling -= 1;
    
            this.onScrollTopChange();
            this.onScrollLeftChange();
            this.onSelectionChange();
            this.onChangeFrontMarker();
            this.onChangeBackMarker();
            this.onChangeBreakpoint();
            this.onChangeAnnotation();
            this.session.getUseWrapMode() && this.renderer.adjustWrapLimit();
            this.renderer.updateFull();
        }

        this._signal("changeSession", {
            session: session,
            oldSession: oldSession
        });
        
        oldSession && oldSession._signal("changeEditor", {oldEditor: this});
        session && session._signal("changeEditor", {editor: this});
    };
    this.getSession = function() {
        return this.session;
    };
    this.setValue = function(val, cursorPos) {
        this.session.doc.setValue(val);

        if (!cursorPos)
            this.selectAll();
        else if (cursorPos == 1)
            this.navigateFileEnd();
        else if (cursorPos == -1)
            this.navigateFileStart();

        return val;
    };
    this.getValue = function() {
        return this.session.getValue();
    };
    this.getSelection = function() {
        return this.selection;
    };
    this.resize = function(force) {
        this.renderer.onResize(force);
    };
    this.setTheme = function(theme, cb) {
        this.renderer.setTheme(theme, cb);
    };
    this.getTheme = function() {
        return this.renderer.getTheme();
    };
    this.setStyle = function(style) {
        this.renderer.setStyle(style);
    };
    this.unsetStyle = function(style) {
        this.renderer.unsetStyle(style);
    };
    this.getFontSize = function () {
        return this.getOption("fontSize") ||
           dom.computedStyle(this.container, "fontSize");
    };
    this.setFontSize = function(size) {
        this.setOption("fontSize", size);
    };

    this.$highlightBrackets = function() {
        if (this.session.$bracketHighlight) {
            this.session.removeMarker(this.session.$bracketHighlight);
            this.session.$bracketHighlight = null;
        }

        if (this.$highlightPending) {
            return;
        }
        var self = this;
        this.$highlightPending = true;
        setTimeout(function() {
            self.$highlightPending = false;

            var pos = self.session.findMatchingBracket(self.getCursorPosition());
            if (pos) {
                var range = new Range(pos.row, pos.column, pos.row, pos.column+1);
            } else if (self.session.$mode.getMatching) {
                var range = self.session.$mode.getMatching(self.session);
            }
            if (range)
                self.session.$bracketHighlight = self.session.addMarker(range, "ace_bracket", "text");
        }, 50);
    };
    this.focus = function() {
        var _self = this;
        setTimeout(function() {
            _self.textInput.focus();
        });
        this.textInput.focus();
    };
    this.isFocused = function() {
        return this.textInput.isFocused();
    };
    this.blur = function() {
        this.textInput.blur();
    };
    this.onFocus = function() {
        if (this.$isFocused)
            return;
        this.$isFocused = true;
        this.renderer.showCursor();
        this.renderer.visualizeFocus();
        this._emit("focus");
    };
    this.onBlur = function() {
        if (!this.$isFocused)
            return;
        this.$isFocused = false;
        this.renderer.hideCursor();
        this.renderer.visualizeBlur();
        this._emit("blur");
    };

    this.$cursorChange = function() {
        this.renderer.updateCursor();
    };
    this.onDocumentChange = function(e) {
        var delta = e.data;
        var range = delta.range;
        var lastRow;

        if (range.start.row == range.end.row && delta.action != "insertLines" && delta.action != "removeLines")
            lastRow = range.end.row;
        else
            lastRow = Infinity;
        this.renderer.updateLines(range.start.row, lastRow);

        this._signal("change", e);
        this.$cursorChange();
    };

    this.onTokenizerUpdate = function(e) {
        var rows = e.data;
        this.renderer.updateLines(rows.first, rows.last);
    };


    this.onScrollTopChange = function() {
        this.renderer.scrollToY(this.session.getScrollTop());
    };

    this.onScrollLeftChange = function() {
        this.renderer.scrollToX(this.session.getScrollLeft());
    };
    this.onCursorChange = function() {
        this.$cursorChange();

        if (!this.$blockScrolling) {
            this.renderer.scrollCursorIntoView();
        }

        this.$highlightBrackets();
        this.$updateHighlightActiveLine();
        this._signal("changeSelection");
    };

    this.$updateHighlightActiveLine = function() {
        var session = this.getSession();

        var highlight;
        if (this.$highlightActiveLine) {
            if ((this.$selectionStyle != "line" || !this.selection.isMultiLine()))
                highlight = this.getCursorPosition();
            if (this.renderer.$maxLines && this.session.getLength() === 1 && !(this.renderer.$minLines > 1))
                highlight = false;
        }

        if (session.$highlightLineMarker && !highlight) {
            session.removeMarker(session.$highlightLineMarker.id);
            session.$highlightLineMarker = null;
        } else if (!session.$highlightLineMarker && highlight) {
            var range = new Range(highlight.row, highlight.column, highlight.row, Infinity);
            range.id = session.addMarker(range, "ace_active-line", "screenLine");
            session.$highlightLineMarker = range;
        } else if (highlight) {
            session.$highlightLineMarker.start.row = highlight.row;
            session.$highlightLineMarker.end.row = highlight.row;
            session.$highlightLineMarker.start.column = highlight.column;
            session._signal("changeBackMarker");
        }
    };

    this.onSelectionChange = function(e) {
        var session = this.session;

        if (session.$selectionMarker) {
            session.removeMarker(session.$selectionMarker);
        }
        session.$selectionMarker = null;

        if (!this.selection.isEmpty()) {
            var range = this.selection.getRange();
            var style = this.getSelectionStyle();
            session.$selectionMarker = session.addMarker(range, "ace_selection", style);
        } else {
            this.$updateHighlightActiveLine();
        }

        var re = this.$highlightSelectedWord && this.$getSelectionHighLightRegexp();
        this.session.highlight(re);

        this._signal("changeSelection");
    };

    this.$getSelectionHighLightRegexp = function() {
        var session = this.session;

        var selection = this.getSelectionRange();
        if (selection.isEmpty() || selection.isMultiLine())
            return;

        var startOuter = selection.start.column - 1;
        var endOuter = selection.end.column + 1;
        var line = session.getLine(selection.start.row);
        var lineCols = line.length;
        var needle = line.substring(Math.max(startOuter, 0),
                                    Math.min(endOuter, lineCols));
        if ((startOuter >= 0 && /^[\w\d]/.test(needle)) ||
            (endOuter <= lineCols && /[\w\d]$/.test(needle)))
            return;

        needle = line.substring(selection.start.column, selection.end.column);
        if (!/^[\w\d]+$/.test(needle))
            return;

        var re = this.$search.$assembleRegExp({
            wholeWord: true,
            caseSensitive: true,
            needle: needle
        });

        return re;
    };


    this.onChangeFrontMarker = function() {
        this.renderer.updateFrontMarkers();
    };

    this.onChangeBackMarker = function() {
        this.renderer.updateBackMarkers();
    };


    this.onChangeBreakpoint = function() {
        this.renderer.updateBreakpoints();
    };

    this.onChangeAnnotation = function() {
        this.renderer.setAnnotations(this.session.getAnnotations());
    };


    this.onChangeMode = function(e) {
        this.renderer.updateText();
        this._emit("changeMode", e);
    };


    this.onChangeWrapLimit = function() {
        this.renderer.updateFull();
    };

    this.onChangeWrapMode = function() {
        this.renderer.onResize(true);
    };


    this.onChangeFold = function() {
        this.$updateHighlightActiveLine();
        this.renderer.updateFull();
    };
    this.getSelectedText = function() {
        return this.session.getTextRange(this.getSelectionRange());
    };
    this.getCopyText = function() {
        var text = this.getSelectedText();
        this._signal("copy", text);
        return text;
    };
    this.onCopy = function() {
        this.commands.exec("copy", this);
    };
    this.onCut = function() {
        this.commands.exec("cut", this);
    };
    this.onPaste = function(text) {
        if (this.$readOnly)
            return;
        var e = {text: text};
        this._signal("paste", e);
        this.insert(e.text, true);
    };


    this.execCommand = function(command, args) {
        this.commands.exec(command, this, args);
    };
    this.insert = function(text, pasted) {
        var session = this.session;
        var mode = session.getMode();
        var cursor = this.getCursorPosition();

        if (this.getBehavioursEnabled() && !pasted) {
            var transform = mode.transformAction(session.getState(cursor.row), 'insertion', this, session, text);
            if (transform) {
                if (text !== transform.text) {
                    this.session.mergeUndoDeltas = false;
                    this.$mergeNextCommand = false;
                }
                text = transform.text;

            }
        }
        
        if (text == "\t")
            text = this.session.getTabString();
        if (!this.selection.isEmpty()) {
            var range = this.getSelectionRange();
            cursor = this.session.remove(range);
            this.clearSelection();
        }
        else if (this.session.getOverwrite()) {
            var range = new Range.fromPoints(cursor, cursor);
            range.end.column += text.length;
            this.session.remove(range);
        }

        if (text == "\n" || text == "\r\n") {
            var line = session.getLine(cursor.row);
            if (cursor.column > line.search(/\S|$/)) {
                var d = line.substr(cursor.column).search(/\S|$/);
                session.doc.removeInLine(cursor.row, cursor.column, cursor.column + d);
            }
        }
        this.clearSelection();

        var start = cursor.column;
        var lineState = session.getState(cursor.row);
        var line = session.getLine(cursor.row);
        var shouldOutdent = mode.checkOutdent(lineState, line, text);
        var end = session.insert(cursor, text);

        if (transform && transform.selection) {
            if (transform.selection.length == 2) { // Transform relative to the current column
                this.selection.setSelectionRange(
                    new Range(cursor.row, start + transform.selection[0],
                              cursor.row, start + transform.selection[1]));
            } else { // Transform relative to the current row.
                this.selection.setSelectionRange(
                    new Range(cursor.row + transform.selection[0],
                              transform.selection[1],
                              cursor.row + transform.selection[2],
                              transform.selection[3]));
            }
        }

        if (session.getDocument().isNewLine(text)) {
            var lineIndent = mode.getNextLineIndent(lineState, line.slice(0, cursor.column), session.getTabString());

            session.insert({row: cursor.row+1, column: 0}, lineIndent);
        }
        if (shouldOutdent)
            mode.autoOutdent(lineState, session, cursor.row);
    };

    this.onTextInput = function(text) {
        this.keyBinding.onTextInput(text);
    };

    this.onCommandKey = function(e, hashId, keyCode) {
        this.keyBinding.onCommandKey(e, hashId, keyCode);
    };
    this.setOverwrite = function(overwrite) {
        this.session.setOverwrite(overwrite);
    };
    this.getOverwrite = function() {
        return this.session.getOverwrite();
    };
    this.toggleOverwrite = function() {
        this.session.toggleOverwrite();
    };
    this.setScrollSpeed = function(speed) {
        this.setOption("scrollSpeed", speed);
    };
    this.getScrollSpeed = function() {
        return this.getOption("scrollSpeed");
    };
    this.setDragDelay = function(dragDelay) {
        this.setOption("dragDelay", dragDelay);
    };
    this.getDragDelay = function() {
        return this.getOption("dragDelay");
    };
    this.setSelectionStyle = function(val) {
        this.setOption("selectionStyle", val);
    };
    this.getSelectionStyle = function() {
        return this.getOption("selectionStyle");
    };
    this.setHighlightActiveLine = function(shouldHighlight) {
        this.setOption("highlightActiveLine", shouldHighlight);
    };
    this.getHighlightActiveLine = function() {
        return this.getOption("highlightActiveLine");
    };
    this.setHighlightGutterLine = function(shouldHighlight) {
        this.setOption("highlightGutterLine", shouldHighlight);
    };

    this.getHighlightGutterLine = function() {
        return this.getOption("highlightGutterLine");
    };
    this.setHighlightSelectedWord = function(shouldHighlight) {
        this.setOption("highlightSelectedWord", shouldHighlight);
    };
    this.getHighlightSelectedWord = function() {
        return this.$highlightSelectedWord;
    };

    this.setAnimatedScroll = function(shouldAnimate){
        this.renderer.setAnimatedScroll(shouldAnimate);
    };

    this.getAnimatedScroll = function(){
        return this.renderer.getAnimatedScroll();
    };
    this.setShowInvisibles = function(showInvisibles) {
        this.renderer.setShowInvisibles(showInvisibles);
    };
    this.getShowInvisibles = function() {
        return this.renderer.getShowInvisibles();
    };

    this.setDisplayIndentGuides = function(display) {
        this.renderer.setDisplayIndentGuides(display);
    };

    this.getDisplayIndentGuides = function() {
        return this.renderer.getDisplayIndentGuides();
    };
    this.setShowPrintMargin = function(showPrintMargin) {
        this.renderer.setShowPrintMargin(showPrintMargin);
    };
    this.getShowPrintMargin = function() {
        return this.renderer.getShowPrintMargin();
    };
    this.setPrintMarginColumn = function(showPrintMargin) {
        this.renderer.setPrintMarginColumn(showPrintMargin);
    };
    this.getPrintMarginColumn = function() {
        return this.renderer.getPrintMarginColumn();
    };
    this.setReadOnly = function(readOnly) {
        this.setOption("readOnly", readOnly);
    };
    this.getReadOnly = function() {
        return this.getOption("readOnly");
    };
    this.setBehavioursEnabled = function (enabled) {
        this.setOption("behavioursEnabled", enabled);
    };
    this.getBehavioursEnabled = function () {
        return this.getOption("behavioursEnabled");
    };
    this.setWrapBehavioursEnabled = function (enabled) {
        this.setOption("wrapBehavioursEnabled", enabled);
    };
    this.getWrapBehavioursEnabled = function () {
        return this.getOption("wrapBehavioursEnabled");
    };
    this.setShowFoldWidgets = function(show) {
        this.setOption("showFoldWidgets", show);

    };
    this.getShowFoldWidgets = function() {
        return this.getOption("showFoldWidgets");
    };

    this.setFadeFoldWidgets = function(fade) {
        this.setOption("fadeFoldWidgets", fade);
    };

    this.getFadeFoldWidgets = function() {
        return this.getOption("fadeFoldWidgets");
    };
    this.remove = function(dir) {
        if (this.selection.isEmpty()){
            if (dir == "left")
                this.selection.selectLeft();
            else
                this.selection.selectRight();
        }

        var range = this.getSelectionRange();
        if (this.getBehavioursEnabled()) {
            var session = this.session;
            var state = session.getState(range.start.row);
            var new_range = session.getMode().transformAction(state, 'deletion', this, session, range);

            if (range.end.column === 0) {
                var text = session.getTextRange(range);
                if (text[text.length - 1] == "\n") {
                    var line = session.getLine(range.end.row);
                    if (/^\s+$/.test(line)) {
                        range.end.column = line.length;
                    }
                }
            }
            if (new_range)
                range = new_range;
        }

        this.session.remove(range);
        this.clearSelection();
    };
    this.removeWordRight = function() {
        if (this.selection.isEmpty())
            this.selection.selectWordRight();

        this.session.remove(this.getSelectionRange());
        this.clearSelection();
    };
    this.removeWordLeft = function() {
        if (this.selection.isEmpty())
            this.selection.selectWordLeft();

        this.session.remove(this.getSelectionRange());
        this.clearSelection();
    };
    this.removeToLineStart = function() {
        if (this.selection.isEmpty())
            this.selection.selectLineStart();

        this.session.remove(this.getSelectionRange());
        this.clearSelection();
    };
    this.removeToLineEnd = function() {
        if (this.selection.isEmpty())
            this.selection.selectLineEnd();

        var range = this.getSelectionRange();
        if (range.start.column == range.end.column && range.start.row == range.end.row) {
            range.end.column = 0;
            range.end.row++;
        }

        this.session.remove(range);
        this.clearSelection();
    };
    this.splitLine = function() {
        if (!this.selection.isEmpty()) {
            this.session.remove(this.getSelectionRange());
            this.clearSelection();
        }

        var cursor = this.getCursorPosition();
        this.insert("\n");
        this.moveCursorToPosition(cursor);
    };
    this.transposeLetters = function() {
        if (!this.selection.isEmpty()) {
            return;
        }

        var cursor = this.getCursorPosition();
        var column = cursor.column;
        if (column === 0)
            return;

        var line = this.session.getLine(cursor.row);
        var swap, range;
        if (column < line.length) {
            swap = line.charAt(column) + line.charAt(column-1);
            range = new Range(cursor.row, column-1, cursor.row, column+1);
        }
        else {
            swap = line.charAt(column-1) + line.charAt(column-2);
            range = new Range(cursor.row, column-2, cursor.row, column);
        }
        this.session.replace(range, swap);
    };
    this.toLowerCase = function() {
        var originalRange = this.getSelectionRange();
        if (this.selection.isEmpty()) {
            this.selection.selectWord();
        }

        var range = this.getSelectionRange();
        var text = this.session.getTextRange(range);
        this.session.replace(range, text.toLowerCase());
        this.selection.setSelectionRange(originalRange);
    };
    this.toUpperCase = function() {
        var originalRange = this.getSelectionRange();
        if (this.selection.isEmpty()) {
            this.selection.selectWord();
        }

        var range = this.getSelectionRange();
        var text = this.session.getTextRange(range);
        this.session.replace(range, text.toUpperCase());
        this.selection.setSelectionRange(originalRange);
    };
    this.indent = function() {
        var session = this.session;
        var range = this.getSelectionRange();

        if (range.start.row < range.end.row) {
            var rows = this.$getSelectedRows();
            session.indentRows(rows.first, rows.last, "\t");
            return;
        } else if (range.start.column < range.end.column) {
            var text = session.getTextRange(range);
            if (!/^\s+$/.test(text)) {
                var rows = this.$getSelectedRows();
                session.indentRows(rows.first, rows.last, "\t");
                return;
            }
        }
        
        var line = session.getLine(range.start.row);
        var position = range.start;
        var size = session.getTabSize();
        var column = session.documentToScreenColumn(position.row, position.column);

        if (this.session.getUseSoftTabs()) {
            var count = (size - column % size);
            var indentString = lang.stringRepeat(" ", count);
        } else {
            var count = column % size;
            while (line[range.start.column] == " " && count) {
                range.start.column--;
                count--;
            }
            this.selection.setSelectionRange(range);
            indentString = "\t";
        }
        return this.insert(indentString);
    };
    this.blockIndent = function() {
        var rows = this.$getSelectedRows();
        this.session.indentRows(rows.first, rows.last, "\t");
    };
    this.blockOutdent = function() {
        var selection = this.session.getSelection();
        this.session.outdentRows(selection.getRange());
    };
    this.sortLines = function() {
        var rows = this.$getSelectedRows();
        var session = this.session;

        var lines = [];
        for (i = rows.first; i <= rows.last; i++)
            lines.push(session.getLine(i));

        lines.sort(function(a, b) {
            if (a.toLowerCase() < b.toLowerCase()) return -1;
            if (a.toLowerCase() > b.toLowerCase()) return 1;
            return 0;
        });

        var deleteRange = new Range(0, 0, 0, 0);
        for (var i = rows.first; i <= rows.last; i++) {
            var line = session.getLine(i);
            deleteRange.start.row = i;
            deleteRange.end.row = i;
            deleteRange.end.column = line.length;
            session.replace(deleteRange, lines[i-rows.first]);
        }
    };
    this.toggleCommentLines = function() {
        var state = this.session.getState(this.getCursorPosition().row);
        var rows = this.$getSelectedRows();
        this.session.getMode().toggleCommentLines(state, this.session, rows.first, rows.last);
    };

    this.toggleBlockComment = function() {
        var cursor = this.getCursorPosition();
        var state = this.session.getState(cursor.row);
        var range = this.getSelectionRange();
        this.session.getMode().toggleBlockComment(state, this.session, range, cursor);
    };
    this.getNumberAt = function(row, column) {
        var _numberRx = /[\-]?[0-9]+(?:\.[0-9]+)?/g;
        _numberRx.lastIndex = 0;

        var s = this.session.getLine(row);
        while (_numberRx.lastIndex < column) {
            var m = _numberRx.exec(s);
            if(m.index <= column && m.index+m[0].length >= column){
                var number = {
                    value: m[0],
                    start: m.index,
                    end: m.index+m[0].length
                };
                return number;
            }
        }
        return null;
    };
    this.modifyNumber = function(amount) {
        var row = this.selection.getCursor().row;
        var column = this.selection.getCursor().column;
        var charRange = new Range(row, column-1, row, column);

        var c = this.session.getTextRange(charRange);
        if (!isNaN(parseFloat(c)) && isFinite(c)) {
            var nr = this.getNumberAt(row, column);
            if (nr) {
                var fp = nr.value.indexOf(".") >= 0 ? nr.start + nr.value.indexOf(".") + 1 : nr.end;
                var decimals = nr.start + nr.value.length - fp;

                var t = parseFloat(nr.value);
                t *= Math.pow(10, decimals);


                if(fp !== nr.end && column < fp){
                    amount *= Math.pow(10, nr.end - column - 1);
                } else {
                    amount *= Math.pow(10, nr.end - column);
                }

                t += amount;
                t /= Math.pow(10, decimals);
                var nnr = t.toFixed(decimals);
                var replaceRange = new Range(row, nr.start, row, nr.end);
                this.session.replace(replaceRange, nnr);
                this.moveCursorTo(row, Math.max(nr.start +1, column + nnr.length - nr.value.length));

            }
        }
    };
    this.removeLines = function() {
        var rows = this.$getSelectedRows();
        var range;
        if (rows.first === 0 || rows.last+1 < this.session.getLength())
            range = new Range(rows.first, 0, rows.last+1, 0);
        else
            range = new Range(
                rows.first-1, this.session.getLine(rows.first-1).length,
                rows.last, this.session.getLine(rows.last).length
            );
        this.session.remove(range);
        this.clearSelection();
    };

    this.duplicateSelection = function() {
        var sel = this.selection;
        var doc = this.session;
        var range = sel.getRange();
        var reverse = sel.isBackwards();
        if (range.isEmpty()) {
            var row = range.start.row;
            doc.duplicateLines(row, row);
        } else {
            var point = reverse ? range.start : range.end;
            var endPoint = doc.insert(point, doc.getTextRange(range), false);
            range.start = point;
            range.end = endPoint;

            sel.setSelectionRange(range, reverse);
        }
    };
    this.moveLinesDown = function() {
        this.$moveLines(function(firstRow, lastRow) {
            return this.session.moveLinesDown(firstRow, lastRow);
        });
    };
    this.moveLinesUp = function() {
        this.$moveLines(function(firstRow, lastRow) {
            return this.session.moveLinesUp(firstRow, lastRow);
        });
    };
    this.moveText = function(range, toPosition, copy) {
        return this.session.moveText(range, toPosition, copy);
    };
    this.copyLinesUp = function() {
        this.$moveLines(function(firstRow, lastRow) {
            this.session.duplicateLines(firstRow, lastRow);
            return 0;
        });
    };
    this.copyLinesDown = function() {
        this.$moveLines(function(firstRow, lastRow) {
            return this.session.duplicateLines(firstRow, lastRow);
        });
    };
    this.$moveLines = function(mover) {
        var selection = this.selection;
        if (!selection.inMultiSelectMode || this.inVirtualSelectionMode) {
            var range = selection.toOrientedRange();
            var rows = this.$getSelectedRows(range);
            var linesMoved = mover.call(this, rows.first, rows.last);
            range.moveBy(linesMoved, 0);
            selection.fromOrientedRange(range);
        } else {
            var ranges = selection.rangeList.ranges;
            selection.rangeList.detach(this.session);

            for (var i = ranges.length; i--; ) {
                var rangeIndex = i;
                var rows = ranges[i].collapseRows();
                var last = rows.end.row;
                var first = rows.start.row;
                while (i--) {
                    rows = ranges[i].collapseRows();
                    if (first - rows.end.row <= 1)
                        first = rows.end.row;
                    else
                        break;
                }
                i++;

                var linesMoved = mover.call(this, first, last);
                while (rangeIndex >= i) {
                    ranges[rangeIndex].moveBy(linesMoved, 0);
                    rangeIndex--;
                }
            }
            selection.fromOrientedRange(selection.ranges[0]);
            selection.rangeList.attach(this.session);
        }
    };
    this.$getSelectedRows = function() {
        var range = this.getSelectionRange().collapseRows();

        return {
            first: this.session.getRowFoldStart(range.start.row),
            last: this.session.getRowFoldEnd(range.end.row)
        };
    };

    this.onCompositionStart = function(text) {
        this.renderer.showComposition(this.getCursorPosition());
    };

    this.onCompositionUpdate = function(text) {
        this.renderer.setCompositionText(text);
    };

    this.onCompositionEnd = function() {
        this.renderer.hideComposition();
    };
    this.getFirstVisibleRow = function() {
        return this.renderer.getFirstVisibleRow();
    };
    this.getLastVisibleRow = function() {
        return this.renderer.getLastVisibleRow();
    };
    this.isRowVisible = function(row) {
        return (row >= this.getFirstVisibleRow() && row <= this.getLastVisibleRow());
    };
    this.isRowFullyVisible = function(row) {
        return (row >= this.renderer.getFirstFullyVisibleRow() && row <= this.renderer.getLastFullyVisibleRow());
    };
    this.$getVisibleRowCount = function() {
        return this.renderer.getScrollBottomRow() - this.renderer.getScrollTopRow() + 1;
    };

    this.$moveByPage = function(dir, select) {
        var renderer = this.renderer;
        var config = this.renderer.layerConfig;
        var rows = dir * Math.floor(config.height / config.lineHeight);

        this.$blockScrolling++;
        if (select === true) {
            this.selection.$moveSelection(function(){
                this.moveCursorBy(rows, 0);
            });
        } else if (select === false) {
            this.selection.moveCursorBy(rows, 0);
            this.selection.clearSelection();
        }
        this.$blockScrolling--;

        var scrollTop = renderer.scrollTop;

        renderer.scrollBy(0, rows * config.lineHeight);
        if (select != null)
            renderer.scrollCursorIntoView(null, 0.5);

        renderer.animateScrolling(scrollTop);
    };
    this.selectPageDown = function() {
        this.$moveByPage(1, true);
    };
    this.selectPageUp = function() {
        this.$moveByPage(-1, true);
    };
    this.gotoPageDown = function() {
       this.$moveByPage(1, false);
    };
    this.gotoPageUp = function() {
        this.$moveByPage(-1, false);
    };
    this.scrollPageDown = function() {
        this.$moveByPage(1);
    };
    this.scrollPageUp = function() {
        this.$moveByPage(-1);
    };
    this.scrollToRow = function(row) {
        this.renderer.scrollToRow(row);
    };
    this.scrollToLine = function(line, center, animate, callback) {
        this.renderer.scrollToLine(line, center, animate, callback);
    };
    this.centerSelection = function() {
        var range = this.getSelectionRange();
        var pos = {
            row: Math.floor(range.start.row + (range.end.row - range.start.row) / 2),
            column: Math.floor(range.start.column + (range.end.column - range.start.column) / 2)
        };
        this.renderer.alignCursor(pos, 0.5);
    };
    this.getCursorPosition = function() {
        return this.selection.getCursor();
    };
    this.getCursorPositionScreen = function() {
        return this.session.documentToScreenPosition(this.getCursorPosition());
    };
    this.getSelectionRange = function() {
        return this.selection.getRange();
    };
    this.selectAll = function() {
        this.$blockScrolling += 1;
        this.selection.selectAll();
        this.$blockScrolling -= 1;
    };
    this.clearSelection = function() {
        this.selection.clearSelection();
    };
    this.moveCursorTo = function(row, column) {
        this.selection.moveCursorTo(row, column);
    };
    this.moveCursorToPosition = function(pos) {
        this.selection.moveCursorToPosition(pos);
    };
    this.jumpToMatching = function(select) {
        var cursor = this.getCursorPosition();

        var range = this.session.getBracketRange(cursor);
        if (!range) {
            range = this.find({
                needle: /[{}()\[\]]/g,
                preventScroll:true,
                start: {row: cursor.row, column: cursor.column - 1}
            });
            if (!range)
                return;
            var pos = range.start;
            if (pos.row == cursor.row && Math.abs(pos.column - cursor.column) < 2)
                range = this.session.getBracketRange(pos);
        }

        pos = range && range.cursor || pos;
        if (pos) {
            if (select) {
                if (range && range.isEqual(this.getSelectionRange()))
                    this.clearSelection();
                else
                    this.selection.selectTo(pos.row, pos.column);
            } else {
                this.selection.moveTo(pos.row, pos.column);
            }
        }
    };
    this.gotoLine = function(lineNumber, column, animate) {
        this.selection.clearSelection();
        this.session.unfold({row: lineNumber - 1, column: column || 0});

        this.$blockScrolling += 1;
        this.exitMultiSelectMode && this.exitMultiSelectMode();
        this.moveCursorTo(lineNumber - 1, column || 0);
        this.$blockScrolling -= 1;

        if (!this.isRowFullyVisible(lineNumber - 1))
            this.scrollToLine(lineNumber - 1, true, animate);
    };
    this.navigateTo = function(row, column) {
        this.selection.moveTo(row, column);
    };
    this.navigateUp = function(times) {
        if (this.selection.isMultiLine() && !this.selection.isBackwards()) {
            var selectionStart = this.selection.anchor.getPosition();
            return this.moveCursorToPosition(selectionStart);
        }
        this.selection.clearSelection();
        this.selection.moveCursorBy(-times || -1, 0);
    };
    this.navigateDown = function(times) {
        if (this.selection.isMultiLine() && this.selection.isBackwards()) {
            var selectionEnd = this.selection.anchor.getPosition();
            return this.moveCursorToPosition(selectionEnd);
        }
        this.selection.clearSelection();
        this.selection.moveCursorBy(times || 1, 0);
    };
    this.navigateLeft = function(times) {
        if (!this.selection.isEmpty()) {
            var selectionStart = this.getSelectionRange().start;
            this.moveCursorToPosition(selectionStart);
        }
        else {
            times = times || 1;
            while (times--) {
                this.selection.moveCursorLeft();
            }
        }
        this.clearSelection();
    };
    this.navigateRight = function(times) {
        if (!this.selection.isEmpty()) {
            var selectionEnd = this.getSelectionRange().end;
            this.moveCursorToPosition(selectionEnd);
        }
        else {
            times = times || 1;
            while (times--) {
                this.selection.moveCursorRight();
            }
        }
        this.clearSelection();
    };
    this.navigateLineStart = function() {
        this.selection.moveCursorLineStart();
        this.clearSelection();
    };
    this.navigateLineEnd = function() {
        this.selection.moveCursorLineEnd();
        this.clearSelection();
    };
    this.navigateFileEnd = function() {
        this.selection.moveCursorFileEnd();
        this.clearSelection();
    };
    this.navigateFileStart = function() {
        this.selection.moveCursorFileStart();
        this.clearSelection();
    };
    this.navigateWordRight = function() {
        this.selection.moveCursorWordRight();
        this.clearSelection();
    };
    this.navigateWordLeft = function() {
        this.selection.moveCursorWordLeft();
        this.clearSelection();
    };
    this.replace = function(replacement, options) {
        if (options)
            this.$search.set(options);

        var range = this.$search.find(this.session);
        var replaced = 0;
        if (!range)
            return replaced;

        if (this.$tryReplace(range, replacement)) {
            replaced = 1;
        }
        if (range !== null) {
            this.selection.setSelectionRange(range);
            this.renderer.scrollSelectionIntoView(range.start, range.end);
        }

        return replaced;
    };
    this.replaceAll = function(replacement, options) {
        if (options) {
            this.$search.set(options);
        }

        var ranges = this.$search.findAll(this.session);
        var replaced = 0;
        if (!ranges.length)
            return replaced;

        this.$blockScrolling += 1;

        var selection = this.getSelectionRange();
        this.selection.moveTo(0, 0);

        for (var i = ranges.length - 1; i >= 0; --i) {
            if(this.$tryReplace(ranges[i], replacement)) {
                replaced++;
            }
        }

        this.selection.setSelectionRange(selection);
        this.$blockScrolling -= 1;

        return replaced;
    };

    this.$tryReplace = function(range, replacement) {
        var input = this.session.getTextRange(range);
        replacement = this.$search.replace(input, replacement);
        if (replacement !== null) {
            range.end = this.session.replace(range, replacement);
            return range;
        } else {
            return null;
        }
    };
    this.getLastSearchOptions = function() {
        return this.$search.getOptions();
    };
    this.find = function(needle, options, animate) {
        if (!options)
            options = {};

        if (typeof needle == "string" || needle instanceof RegExp)
            options.needle = needle;
        else if (typeof needle == "object")
            oop.mixin(options, needle);

        var range = this.selection.getRange();
        if (options.needle == null) {
            needle = this.session.getTextRange(range)
                || this.$search.$options.needle;
            if (!needle) {
                range = this.session.getWordRange(range.start.row, range.start.column);
                needle = this.session.getTextRange(range);
            }
            this.$search.set({needle: needle});
        }

        this.$search.set(options);
        if (!options.start)
            this.$search.set({start: range});

        var newRange = this.$search.find(this.session);
        if (options.preventScroll)
            return newRange;
        if (newRange) {
            this.revealRange(newRange, animate);
            return newRange;
        }
        if (options.backwards)
            range.start = range.end;
        else
            range.end = range.start;
        this.selection.setRange(range);
    };
    this.findNext = function(options, animate) {
        this.find({skipCurrent: true, backwards: false}, options, animate);
    };
    this.findPrevious = function(options, animate) {
        this.find(options, {skipCurrent: true, backwards: true}, animate);
    };

    this.revealRange = function(range, animate) {
        this.$blockScrolling += 1;
        this.session.unfold(range);
        this.selection.setSelectionRange(range);
        this.$blockScrolling -= 1;

        var scrollTop = this.renderer.scrollTop;
        this.renderer.scrollSelectionIntoView(range.start, range.end, 0.5);
        if (animate !== false)
            this.renderer.animateScrolling(scrollTop);
    };
    this.undo = function() {
        this.$blockScrolling++;
        this.session.getUndoManager().undo();
        this.$blockScrolling--;
        this.renderer.scrollCursorIntoView(null, 0.5);
    };
    this.redo = function() {
        this.$blockScrolling++;
        this.session.getUndoManager().redo();
        this.$blockScrolling--;
        this.renderer.scrollCursorIntoView(null, 0.5);
    };
    this.destroy = function() {
        this.renderer.destroy();
        this._signal("destroy", this);
    };
    this.setAutoScrollEditorIntoView = function(enable) {
        if (!enable)
            return;
        var rect;
        var self = this;
        var shouldScroll = false;
        if (!this.$scrollAnchor)
            this.$scrollAnchor = document.createElement("div");
        var scrollAnchor = this.$scrollAnchor;
        scrollAnchor.style.cssText = "position:absolute";
        this.container.insertBefore(scrollAnchor, this.container.firstChild);
        var onChangeSelection = this.on("changeSelection", function() {
            shouldScroll = true;
        });
        var onBeforeRender = this.renderer.on("beforeRender", function() {
            if (shouldScroll)
                rect = self.renderer.container.getBoundingClientRect();
        });
        var onAfterRender = this.renderer.on("afterRender", function() {
            if (shouldScroll && rect && self.isFocused()) {
                var renderer = self.renderer;
                var pos = renderer.$cursorLayer.$pixelPos;
                var config = renderer.layerConfig;
                var top = pos.top - config.offset;
                if (pos.top >= 0 && top + rect.top < 0) {
                    shouldScroll = true;
                } else if (pos.top < config.height &&
                    pos.top + rect.top + config.lineHeight > window.innerHeight) {
                    shouldScroll = false;
                } else {
                    shouldScroll = null;
                }
                if (shouldScroll != null) {
                    scrollAnchor.style.top = top + "px";
                    scrollAnchor.style.left = pos.left + "px";
                    scrollAnchor.style.height = config.lineHeight + "px";
                    scrollAnchor.scrollIntoView(shouldScroll);
                }
                shouldScroll = rect = null;
            }
        });
        this.setAutoScrollEditorIntoView = function(enable) {
            if (enable)
                return;
            delete this.setAutoScrollEditorIntoView;
            this.removeEventListener("changeSelection", onChangeSelection);
            this.renderer.removeEventListener("afterRender", onAfterRender);
            this.renderer.removeEventListener("beforeRender", onBeforeRender);
        };
    };


    this.$resetCursorStyle = function() {
        var style = this.$cursorStyle || "ace";
        var cursorLayer = this.renderer.$cursorLayer;
        if (!cursorLayer)
            return;
        cursorLayer.setSmoothBlinking(style == "smooth");
        cursorLayer.isBlinking = !this.$readOnly && style != "wide";
    };

}).call(Editor.prototype);



config.defineOptions(Editor.prototype, "editor", {
    selectionStyle: {
        set: function(style) {
            this.onSelectionChange();
            this._signal("changeSelectionStyle", {data: style});
        },
        initialValue: "line"
    },
    highlightActiveLine: {
        set: function() {this.$updateHighlightActiveLine();},
        initialValue: true
    },
    highlightSelectedWord: {
        set: function(shouldHighlight) {this.$onSelectionChange();},
        initialValue: true
    },
    readOnly: {
        set: function(readOnly) {
            this.textInput.setReadOnly(readOnly); 
            this.$resetCursorStyle(); 
        },
        initialValue: false
    },
    cursorStyle: {
        set: function(val) { this.$resetCursorStyle(); },
        values: ["ace", "slim", "smooth", "wide"],
        initialValue: "ace"
    },
    mergeUndoDeltas: {
        values: [false, true, "always"],
        initialValue: true
    },
    behavioursEnabled: {initialValue: true},
    wrapBehavioursEnabled: {initialValue: true},
    autoScrollEditorIntoView: {
        set: function(val) {this.setAutoScrollEditorIntoView(val)}
    },

    hScrollBarAlwaysVisible: "renderer",
    vScrollBarAlwaysVisible: "renderer",
    highlightGutterLine: "renderer",
    animatedScroll: "renderer",
    showInvisibles: "renderer",
    showPrintMargin: "renderer",
    printMarginColumn: "renderer",
    printMargin: "renderer",
    fadeFoldWidgets: "renderer",
    showFoldWidgets: "renderer",
    showLineNumbers: "renderer",
    showGutter: "renderer",
    displayIndentGuides: "renderer",
    fontSize: "renderer",
    fontFamily: "renderer",
    maxLines: "renderer",
    minLines: "renderer",
    scrollPastEnd: "renderer",
    fixedWidthGutter: "renderer",
    theme: "renderer",

    scrollSpeed: "$mouseHandler",
    dragDelay: "$mouseHandler",
    dragEnabled: "$mouseHandler",
    focusTimout: "$mouseHandler",
    tooltipFollowsMouse: "$mouseHandler",

    firstLineNumber: "session",
    overwrite: "session",
    newLineMode: "session",
    useWorker: "session",
    useSoftTabs: "session",
    tabSize: "session",
    wrap: "session",
    foldStyle: "session",
    mode: "session"
});

exports.Editor = Editor;
});

ace.define('ace/mouse/multi_select_handler', ['require', 'exports', 'module' , 'ace/lib/event'], function(require, exports, module) {

var event = require("../lib/event");
function isSamePoint(p1, p2) {
    return p1.row == p2.row && p1.column == p2.column;
}

function onMouseDown(e) {
    var ev = e.domEvent;
    var alt = ev.altKey;
    var shift = ev.shiftKey;
    var ctrl = e.getAccelKey();
    var button = e.getButton();

    if (e.editor.inMultiSelectMode && button == 2) {
        e.editor.textInput.onContextMenu(e.domEvent);
        return;
    }
    
    if (!ctrl && !alt) {
        if (button === 0 && e.editor.inMultiSelectMode)
            e.editor.exitMultiSelectMode();
        return;
    }

    var editor = e.editor;
    var selection = editor.selection;
    var isMultiSelect = editor.inMultiSelectMode;
    var pos = e.getDocumentPosition();
    var cursor = selection.getCursor();
    var inSelection = e.inSelection() || (selection.isEmpty() && isSamePoint(pos, cursor));


    var mouseX = e.x, mouseY = e.y;
    var onMouseSelection = function(e) {
        mouseX = e.clientX;
        mouseY = e.clientY;
    };

    var blockSelect = function() {
        var newCursor = editor.renderer.pixelToScreenCoordinates(mouseX, mouseY);
        var cursor = session.screenToDocumentPosition(newCursor.row, newCursor.column);

        if (isSamePoint(screenCursor, newCursor)
            && isSamePoint(cursor, selection.selectionLead))
            return;
        screenCursor = newCursor;

        editor.selection.moveToPosition(cursor);
        editor.renderer.scrollCursorIntoView();

        editor.removeSelectionMarkers(rectSel);
        rectSel = selection.rectangularRangeBlock(screenCursor, screenAnchor);
        rectSel.forEach(editor.addSelectionMarker, editor);
        editor.updateSelectionMarkers();
    };
    
    var session = editor.session;
    var screenAnchor = editor.renderer.pixelToScreenCoordinates(mouseX, mouseY);
    var screenCursor = screenAnchor;

    

    if (ctrl && !alt && !shift && button === 0) {
        if (!isMultiSelect && inSelection)
            return; // dragging

        if (!isMultiSelect) {
            var range = selection.toOrientedRange();
            editor.addSelectionMarker(range);
        }

        var oldRange = selection.rangeList.rangeAtPoint(pos);
        
        editor.$blockScrolling++;
        editor.once("mouseup", function() {
            var tmpSel = selection.toOrientedRange();

            if (oldRange && tmpSel.isEmpty() && isSamePoint(oldRange.cursor, tmpSel.cursor))
                selection.substractPoint(tmpSel.cursor);
            else {
                if (range) {
                    editor.removeSelectionMarker(range);
                    selection.addRange(range);
                }
                selection.addRange(tmpSel);
            }
            editor.$blockScrolling--;
        });

    } else if (alt && button === 0) {
        e.stop();

        if (isMultiSelect && !ctrl)
            selection.toSingleRange();
        else if (!isMultiSelect && ctrl)
            selection.addRange();

        var rectSel = [];
        if (shift) {
            screenAnchor = session.documentToScreenPosition(selection.lead);
            blockSelect();
        } else {
            selection.moveToPosition(pos);
        }


        var onMouseSelectionEnd = function(e) {
            clearInterval(timerId);
            editor.removeSelectionMarkers(rectSel);
            for (var i = 0; i < rectSel.length; i++)
                selection.addRange(rectSel[i]);
        };

        var onSelectionInterval = blockSelect;

        event.capture(editor.container, onMouseSelection, onMouseSelectionEnd);
        var timerId = setInterval(function() {onSelectionInterval();}, 20);

        return e.preventDefault();
    }
}


exports.onMouseDown = onMouseDown;

});

ace.define('ace/lib/useragent', ['require', 'exports', 'module' ], function(require, exports, module) {
exports.OS = {
    LINUX: "LINUX",
    MAC: "MAC",
    WINDOWS: "WINDOWS"
};
exports.getOS = function() {
    if (exports.isMac) {
        return exports.OS.MAC;
    } else if (exports.isLinux) {
        return exports.OS.LINUX;
    } else {
        return exports.OS.WINDOWS;
    }
};
if (typeof navigator != "object")
    return;

var os = (navigator.platform.match(/mac|win|linux/i) || ["other"])[0].toLowerCase();
var ua = navigator.userAgent;
exports.isWin = (os == "win");
exports.isMac = (os == "mac");
exports.isLinux = (os == "linux");
exports.isIE = 
    (navigator.appName == "Microsoft Internet Explorer" || navigator.appName.indexOf("MSAppHost") >= 0)
    && parseFloat(navigator.userAgent.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:|MSIE )([0-9]+[\.0-9]+)/)[1]);
    
exports.isOldIE = exports.isIE && exports.isIE < 9;
exports.isGecko = exports.isMozilla = window.controllers && window.navigator.product === "Gecko";
exports.isOldGecko = exports.isGecko && parseInt((navigator.userAgent.match(/rv\:(\d+)/)||[])[1], 10) < 4;
exports.isOpera = window.opera && Object.prototype.toString.call(window.opera) == "[object Opera]";
exports.isWebKit = parseFloat(ua.split("WebKit/")[1]) || undefined;

exports.isChrome = parseFloat(ua.split(" Chrome/")[1]) || undefined;

exports.isAIR = ua.indexOf("AdobeAIR") >= 0;

exports.isIPad = ua.indexOf("iPad") >= 0;

exports.isTouchPad = ua.indexOf("TouchPad") >= 0;

});

ace.define('ace/commands/multi_select_commands', ['require', 'exports', 'module' , 'ace/keyboard/hash_handler'], function(require, exports, module) {
exports.defaultCommands = [{
    name: "addCursorAbove",
    exec: function(editor) { editor.selectMoreLines(-1); },
    bindKey: {win: "Ctrl-Alt-Up", mac: "Ctrl-Alt-Up"},
    readonly: true
}, {
    name: "addCursorBelow",
    exec: function(editor) { editor.selectMoreLines(1); },
    bindKey: {win: "Ctrl-Alt-Down", mac: "Ctrl-Alt-Down"},
    readonly: true
}, {
    name: "addCursorAboveSkipCurrent",
    exec: function(editor) { editor.selectMoreLines(-1, true); },
    bindKey: {win: "Ctrl-Alt-Shift-Up", mac: "Ctrl-Alt-Shift-Up"},
    readonly: true
}, {
    name: "addCursorBelowSkipCurrent",
    exec: function(editor) { editor.selectMoreLines(1, true); },
    bindKey: {win: "Ctrl-Alt-Shift-Down", mac: "Ctrl-Alt-Shift-Down"},
    readonly: true
}, {
    name: "selectMoreBefore",
    exec: function(editor) { editor.selectMore(-1); },
    bindKey: {win: "Ctrl-Alt-Left", mac: "Ctrl-Alt-Left"},
    readonly: true
}, {
    name: "selectMoreAfter",
    exec: function(editor) { editor.selectMore(1); },
    bindKey: {win: "Ctrl-Alt-Right", mac: "Ctrl-Alt-Right"},
    readonly: true
}, {
    name: "selectNextBefore",
    exec: function(editor) { editor.selectMore(-1, true); },
    bindKey: {win: "Ctrl-Alt-Shift-Left", mac: "Ctrl-Alt-Shift-Left"},
    readonly: true
}, {
    name: "selectNextAfter",
    exec: function(editor) { editor.selectMore(1, true); },
    bindKey: {win: "Ctrl-Alt-Shift-Right", mac: "Ctrl-Alt-Shift-Right"},
    readonly: true
}, {
    name: "splitIntoLines",
    exec: function(editor) { editor.multiSelect.splitIntoLines(); },
    bindKey: {win: "Ctrl-Alt-L", mac: "Ctrl-Alt-L"},
    readonly: true
}, {
    name: "alignCursors",
    exec: function(editor) { editor.alignCursors(); },
    bindKey: {win: "Ctrl-Alt-A", mac: "Ctrl-Alt-A"}
}];
exports.multiSelectCommands = [{
    name: "singleSelection",
    bindKey: "esc",
    exec: function(editor) { editor.exitMultiSelectMode(); },
    readonly: true,
    isAvailable: function(editor) {return editor && editor.inMultiSelectMode}
}];

var HashHandler = require("../keyboard/hash_handler").HashHandler;
exports.keyboardHandler = new HashHandler(exports.multiSelectCommands);

});

ace.define('ace/lib/oop', ['require', 'exports', 'module' ], function(require, exports, module) {


exports.inherits = function(ctor, superCtor) {
    ctor.super_ = superCtor;
    ctor.prototype = Object.create(superCtor.prototype, {
        constructor: {
            value: ctor,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
};

exports.mixin = function(obj, mixin) {
    for (var key in mixin) {
        obj[key] = mixin[key];
    }
    return obj;
};

exports.implement = function(proto, mixin) {
    exports.mixin(proto, mixin);
};

});

ace.define('ace/worker/worker_client', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/event_emitter', 'ace/config'], function(require, exports, module) {


var oop = require("../lib/oop");
var EventEmitter = require("../lib/event_emitter").EventEmitter;
var config = require("../config");

var WorkerClient = function(topLevelNamespaces, mod, classname, workerUrl) {
    this.$sendDeltaQueue = this.$sendDeltaQueue.bind(this);
    this.changeListener = this.changeListener.bind(this);
    this.onMessage = this.onMessage.bind(this);
    if (require.nameToUrl && !require.toUrl)
        require.toUrl = require.nameToUrl;
    
    if (config.get("packaged") || !require.toUrl) {
        workerUrl = workerUrl || config.moduleUrl(mod, "worker");
    } else {
        var normalizePath = this.$normalizePath;
        workerUrl = workerUrl || normalizePath(require.toUrl("ace/worker/worker.js", null, "_"));

        var tlns = {};
        topLevelNamespaces.forEach(function(ns) {
            tlns[ns] = normalizePath(require.toUrl(ns, null, "_").replace(/(\.js)?(\?.*)?$/, ""));
        });
    }

    try {
        this.$worker = new Worker(workerUrl);
    } catch(e) {
        if (e instanceof window.DOMException) {
            var blob = this.$workerBlob(workerUrl);
            var URL = window.URL || window.webkitURL;
            var blobURL = URL.createObjectURL(blob);

            this.$worker = new Worker(blobURL);
            URL.revokeObjectURL(blobURL);
        } else {
            throw e;
        }
    }
    this.$worker.postMessage({
        init : true,
        tlns : tlns,
        module : mod,
        classname : classname
    });

    this.callbackId = 1;
    this.callbacks = {};

    this.$worker.onmessage = this.onMessage;
};

(function(){

    oop.implement(this, EventEmitter);

    this.onMessage = function(e) {
        var msg = e.data;
        switch(msg.type) {
            case "log":
                window.console && console.log && console.log.apply(console, msg.data);
                break;

            case "event":
                this._signal(msg.name, {data: msg.data});
                break;

            case "call":
                var callback = this.callbacks[msg.id];
                if (callback) {
                    callback(msg.data);
                    delete this.callbacks[msg.id];
                }
                break;
        }
    };

    this.$normalizePath = function(path) {
        if (!location.host) // needed for file:// protocol
            return path;
        path = path.replace(/^[a-z]+:\/\/[^\/]+/, ""); // Remove domain name and rebuild it
        path = location.protocol + "//" + location.host
            + (path.charAt(0) == "/" ? "" : location.pathname.replace(/\/[^\/]*$/, ""))
            + "/" + path.replace(/^[\/]+/, "");
        return path;
    };

    this.terminate = function() {
        this._signal("terminate", {});
        this.deltaQueue = null;
        this.$worker.terminate();
        this.$worker = null;
        this.$doc.removeEventListener("change", this.changeListener);
        this.$doc = null;
    };

    this.send = function(cmd, args) {
        this.$worker.postMessage({command: cmd, args: args});
    };

    this.call = function(cmd, args, callback) {
        if (callback) {
            var id = this.callbackId++;
            this.callbacks[id] = callback;
            args.push(id);
        }
        this.send(cmd, args);
    };

    this.emit = function(event, data) {
        try {
            this.$worker.postMessage({event: event, data: {data: data.data}});
        }
        catch(ex) {}
    };

    this.attachToDocument = function(doc) {
        if(this.$doc)
            this.terminate();

        this.$doc = doc;
        this.call("setValue", [doc.getValue()]);
        doc.on("change", this.changeListener);
    };

    this.changeListener = function(e) {
        if (!this.deltaQueue) {
            this.deltaQueue = [e.data];
            setTimeout(this.$sendDeltaQueue, 0);
        } else
            this.deltaQueue.push(e.data);
    };

    this.$sendDeltaQueue = function() {
        var q = this.deltaQueue;
        if (!q) return;
        this.deltaQueue = null;
        if (q.length > 20 && q.length > this.$doc.getLength() >> 1) {
            this.call("setValue", [this.$doc.getValue()]);
        } else
            this.emit("change", {data: q});
    };

    this.$workerBlob = function(workerUrl) {
        var script = "importScripts('" + workerUrl + "');";
        try {
            return new Blob([script], {"type": "application/javascript"});
        } catch (e) { // Backwards-compatibility
            var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;
            var blobBuilder = new BlobBuilder();
            blobBuilder.append(script);
            return blobBuilder.getBlob("application/javascript");
        }
    };

}).call(WorkerClient.prototype);


var UIWorkerClient = function(topLevelNamespaces, mod, classname) {
    this.$sendDeltaQueue = this.$sendDeltaQueue.bind(this);
    this.changeListener = this.changeListener.bind(this);
    this.callbackId = 1;
    this.callbacks = {};
    this.messageBuffer = [];

    var main = null;
    var emitSync = false;
    var sender = Object.create(EventEmitter);
    var _self = this;

    this.$worker = {};
    this.$worker.terminate = function() {};
    this.$worker.postMessage = function(e) {
        _self.messageBuffer.push(e);
        if (main) {
            if (emitSync)
                setTimeout(processNext);
            else
                processNext();
        }
    };
    this.setEmitSync = function(val) { emitSync = val };

    var processNext = function() {
        var msg = _self.messageBuffer.shift();
        if (msg.command)
            main[msg.command].apply(main, msg.args);
        else if (msg.event)
            sender._signal(msg.event, msg.data);
    };

    sender.postMessage = function(msg) {
        _self.onMessage({data: msg});
    };
    sender.callback = function(data, callbackId) {
        this.postMessage({type: "call", id: callbackId, data: data});
    };
    sender.emit = function(name, data) {
        this.postMessage({type: "event", name: name, data: data});
    };

    config.loadModule(["worker", mod], function(Main) {
        main = new Main[classname](sender);
        while (_self.messageBuffer.length)
            processNext();
    });
};

UIWorkerClient.prototype = WorkerClient.prototype;

exports.UIWorkerClient = UIWorkerClient;
exports.WorkerClient = WorkerClient;

});

ace.define('ace/lib/keys', ['require', 'exports', 'module' , 'ace/lib/oop'], function(require, exports, module) {


var oop = require("./oop");
var Keys = (function() {
    var ret = {
        MODIFIER_KEYS: {
            16: 'Shift', 17: 'Ctrl', 18: 'Alt', 224: 'Meta'
        },

        KEY_MODS: {
            "ctrl": 1, "alt": 2, "option" : 2, "shift": 4,
            "super": 8, "meta": 8, "command": 8, "cmd": 8
        },

        FUNCTION_KEYS : {
            8  : "Backspace",
            9  : "Tab",
            13 : "Return",
            19 : "Pause",
            27 : "Esc",
            32 : "Space",
            33 : "PageUp",
            34 : "PageDown",
            35 : "End",
            36 : "Home",
            37 : "Left",
            38 : "Up",
            39 : "Right",
            40 : "Down",
            44 : "Print",
            45 : "Insert",
            46 : "Delete",
            96 : "Numpad0",
            97 : "Numpad1",
            98 : "Numpad2",
            99 : "Numpad3",
            100: "Numpad4",
            101: "Numpad5",
            102: "Numpad6",
            103: "Numpad7",
            104: "Numpad8",
            105: "Numpad9",
            '-13': "NumpadEnter",
            112: "F1",
            113: "F2",
            114: "F3",
            115: "F4",
            116: "F5",
            117: "F6",
            118: "F7",
            119: "F8",
            120: "F9",
            121: "F10",
            122: "F11",
            123: "F12",
            144: "Numlock",
            145: "Scrolllock"
        },

        PRINTABLE_KEYS: {
           32: ' ',  48: '0',  49: '1',  50: '2',  51: '3',  52: '4', 53:  '5',
           54: '6',  55: '7',  56: '8',  57: '9',  59: ';',  61: '=', 65:  'a',
           66: 'b',  67: 'c',  68: 'd',  69: 'e',  70: 'f',  71: 'g', 72:  'h',
           73: 'i',  74: 'j',  75: 'k',  76: 'l',  77: 'm',  78: 'n', 79:  'o',
           80: 'p',  81: 'q',  82: 'r',  83: 's',  84: 't',  85: 'u', 86:  'v',
           87: 'w',  88: 'x',  89: 'y',  90: 'z', 107: '+', 109: '-', 110: '.',
          188: ',', 190: '.', 191: '/', 192: '`', 219: '[', 220: '\\',
          221: ']', 222: '\''
        }
    };
    var name, i;
    for (i in ret.FUNCTION_KEYS) {
        name = ret.FUNCTION_KEYS[i].toLowerCase();
        ret[name] = parseInt(i, 10);
    }
    for (i in ret.PRINTABLE_KEYS) {
        name = ret.PRINTABLE_KEYS[i].toLowerCase();
        ret[name] = parseInt(i, 10);
    }
    oop.mixin(ret, ret.MODIFIER_KEYS);
    oop.mixin(ret, ret.PRINTABLE_KEYS);
    oop.mixin(ret, ret.FUNCTION_KEYS);
    ret.enter = ret["return"];
    ret.escape = ret.esc;
    ret.del = ret["delete"];
    ret[173] = '-';
    
    (function() {
        var mods = ["cmd", "ctrl", "alt", "shift"];
        for (var i = Math.pow(2, mods.length); i--;) {
            ret.KEY_MODS[i] = mods.filter(function(x) {
                return i & ret.KEY_MODS[x];
            }).join("-") + "-";
        }
    })();

    return ret;
})();
oop.mixin(exports, Keys);

exports.keyCodeToString = function(keyCode) {
    return (Keys[keyCode] || String.fromCharCode(keyCode)).toLowerCase();
};

});
ace.define('ace/placeholder', ['require', 'exports', 'module' , 'ace/range', 'ace/lib/event_emitter', 'ace/lib/oop'], function(require, exports, module) {


var Range = require("./range").Range;
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var oop = require("./lib/oop");

var PlaceHolder = function(session, length, pos, others, mainClass, othersClass) {
    var _self = this;
    this.length = length;
    this.session = session;
    this.doc = session.getDocument();
    this.mainClass = mainClass;
    this.othersClass = othersClass;
    this.$onUpdate = this.onUpdate.bind(this);
    this.doc.on("change", this.$onUpdate);
    this.$others = others;
    
    this.$onCursorChange = function() {
        setTimeout(function() {
            _self.onCursorChange();
        });
    };
    
    this.$pos = pos;
    var undoStack = session.getUndoManager().$undoStack || session.getUndoManager().$undostack || {length: -1};
    this.$undoStackDepth =  undoStack.length;
    this.setup();

    session.selection.on("changeCursor", this.$onCursorChange);
};

(function() {

    oop.implement(this, EventEmitter);
    this.setup = function() {
        var _self = this;
        var doc = this.doc;
        var session = this.session;
        var pos = this.$pos;

        this.pos = doc.createAnchor(pos.row, pos.column);
        this.markerId = session.addMarker(new Range(pos.row, pos.column, pos.row, pos.column + this.length), this.mainClass, null, false);
        this.pos.on("change", function(event) {
            session.removeMarker(_self.markerId);
            _self.markerId = session.addMarker(new Range(event.value.row, event.value.column, event.value.row, event.value.column+_self.length), _self.mainClass, null, false);
        });
        this.others = [];
        this.$others.forEach(function(other) {
            var anchor = doc.createAnchor(other.row, other.column);
            _self.others.push(anchor);
        });
        session.setUndoSelect(false);
    };
    this.showOtherMarkers = function() {
        if(this.othersActive) return;
        var session = this.session;
        var _self = this;
        this.othersActive = true;
        this.others.forEach(function(anchor) {
            anchor.markerId = session.addMarker(new Range(anchor.row, anchor.column, anchor.row, anchor.column+_self.length), _self.othersClass, null, false);
            anchor.on("change", function(event) {
                session.removeMarker(anchor.markerId);
                anchor.markerId = session.addMarker(new Range(event.value.row, event.value.column, event.value.row, event.value.column+_self.length), _self.othersClass, null, false);
            });
        });
    };
    this.hideOtherMarkers = function() {
        if(!this.othersActive) return;
        this.othersActive = false;
        for (var i = 0; i < this.others.length; i++) {
            this.session.removeMarker(this.others[i].markerId);
        }
    };
    this.onUpdate = function(event) {
        var delta = event.data;
        var range = delta.range;
        if(range.start.row !== range.end.row) return;
        if(range.start.row !== this.pos.row) return;
        if (this.$updating) return;
        this.$updating = true;
        var lengthDiff = delta.action === "insertText" ? range.end.column - range.start.column : range.start.column - range.end.column;
        
        if(range.start.column >= this.pos.column && range.start.column <= this.pos.column + this.length + 1) {
            var distanceFromStart = range.start.column - this.pos.column;
            this.length += lengthDiff;
            if(!this.session.$fromUndo) {
                if(delta.action === "insertText") {
                    for (var i = this.others.length - 1; i >= 0; i--) {
                        var otherPos = this.others[i];
                        var newPos = {row: otherPos.row, column: otherPos.column + distanceFromStart};
                        if(otherPos.row === range.start.row && range.start.column < otherPos.column)
                            newPos.column += lengthDiff;
                        this.doc.insert(newPos, delta.text);
                    }
                } else if(delta.action === "removeText") {
                    for (var i = this.others.length - 1; i >= 0; i--) {
                        var otherPos = this.others[i];
                        var newPos = {row: otherPos.row, column: otherPos.column + distanceFromStart};
                        if(otherPos.row === range.start.row && range.start.column < otherPos.column)
                            newPos.column += lengthDiff;
                        this.doc.remove(new Range(newPos.row, newPos.column, newPos.row, newPos.column - lengthDiff));
                    }
                }
                if(range.start.column === this.pos.column && delta.action === "insertText") {
                    setTimeout(function() {
                        this.pos.setPosition(this.pos.row, this.pos.column - lengthDiff);
                        for (var i = 0; i < this.others.length; i++) {
                            var other = this.others[i];
                            var newPos = {row: other.row, column: other.column - lengthDiff};
                            if(other.row === range.start.row && range.start.column < other.column)
                                newPos.column += lengthDiff;
                            other.setPosition(newPos.row, newPos.column);
                        }
                    }.bind(this), 0);
                }
                else if(range.start.column === this.pos.column && delta.action === "removeText") {
                    setTimeout(function() {
                        for (var i = 0; i < this.others.length; i++) {
                            var other = this.others[i];
                            if(other.row === range.start.row && range.start.column < other.column) {
                                other.setPosition(other.row, other.column - lengthDiff);
                            }
                        }
                    }.bind(this), 0);
                }
            }
            this.pos._emit("change", {value: this.pos});
            for (var i = 0; i < this.others.length; i++) {
                this.others[i]._emit("change", {value: this.others[i]});
            }
        }
        this.$updating = false;
    };

    this.onCursorChange = function(event) {
        if (this.$updating) return;
        var pos = this.session.selection.getCursor();
        if(pos.row === this.pos.row && pos.column >= this.pos.column && pos.column <= this.pos.column + this.length) {
            this.showOtherMarkers();
            this._emit("cursorEnter", event);
        } else {
            this.hideOtherMarkers();
            this._emit("cursorLeave", event);
        }
    };    
    this.detach = function() {
        this.session.removeMarker(this.markerId);
        this.hideOtherMarkers();
        this.doc.removeEventListener("change", this.$onUpdate);
        this.session.selection.removeEventListener("changeCursor", this.$onCursorChange);
        this.pos.detach();
        for (var i = 0; i < this.others.length; i++) {
            this.others[i].detach();
        }
        this.session.setUndoSelect(true);
    };
    this.cancel = function() {
        if(this.$undoStackDepth === -1)
            throw Error("Canceling placeholders only supported with undo manager attached to session.");
        var undoManager = this.session.getUndoManager();
        var undosRequired = (undoManager.$undoStack || undoManager.$undostack).length - this.$undoStackDepth;
        for (var i = 0; i < undosRequired; i++) {
            undoManager.undo(true);
        }
    };
}).call(PlaceHolder.prototype);


exports.PlaceHolder = PlaceHolder;
});

ace.define('ace/lib/event', ['require', 'exports', 'module' , 'ace/lib/keys', 'ace/lib/useragent'], function(require, exports, module) {


var keys = require("./keys");
var useragent = require("./useragent");

exports.addListener = function(elem, type, callback) {
    if (elem.addEventListener) {
        return elem.addEventListener(type, callback, false);
    }
    if (elem.attachEvent) {
        var wrapper = function() {
            callback.call(elem, window.event);
        };
        callback._wrapper = wrapper;
        elem.attachEvent("on" + type, wrapper);
    }
};

exports.removeListener = function(elem, type, callback) {
    if (elem.removeEventListener) {
        return elem.removeEventListener(type, callback, false);
    }
    if (elem.detachEvent) {
        elem.detachEvent("on" + type, callback._wrapper || callback);
    }
};
exports.stopEvent = function(e) {
    exports.stopPropagation(e);
    exports.preventDefault(e);
    return false;
};

exports.stopPropagation = function(e) {
    if (e.stopPropagation)
        e.stopPropagation();
    else
        e.cancelBubble = true;
};

exports.preventDefault = function(e) {
    if (e.preventDefault)
        e.preventDefault();
    else
        e.returnValue = false;
};
exports.getButton = function(e) {
    if (e.type == "dblclick")
        return 0;
    if (e.type == "contextmenu" || (e.ctrlKey && useragent.isMac))
        return 2;
    if (e.preventDefault) {
        return e.button;
    }
    else {
        return {1:0, 2:2, 4:1}[e.button];
    }
};

exports.capture = function(el, eventHandler, releaseCaptureHandler) {
    function onMouseUp(e) {
        eventHandler && eventHandler(e);
        releaseCaptureHandler && releaseCaptureHandler(e);

        exports.removeListener(document, "mousemove", eventHandler, true);
        exports.removeListener(document, "mouseup", onMouseUp, true);
        exports.removeListener(document, "dragstart", onMouseUp, true);
    }

    exports.addListener(document, "mousemove", eventHandler, true);
    exports.addListener(document, "mouseup", onMouseUp, true);
    exports.addListener(document, "dragstart", onMouseUp, true);
    
    return onMouseUp;
};

exports.addMouseWheelListener = function(el, callback) {
    if ("onmousewheel" in el) {
        exports.addListener(el, "mousewheel", function(e) {
            var factor = 8;
            if (e.wheelDeltaX !== undefined) {
                e.wheelX = -e.wheelDeltaX / factor;
                e.wheelY = -e.wheelDeltaY / factor;
            } else {
                e.wheelX = 0;
                e.wheelY = -e.wheelDelta / factor;
            }
            callback(e);
        });
    } else if ("onwheel" in el) {
        exports.addListener(el, "wheel",  function(e) {
            var factor = 0.35;
            switch (e.deltaMode) {
                case e.DOM_DELTA_PIXEL:
                    e.wheelX = e.deltaX * factor || 0;
                    e.wheelY = e.deltaY * factor || 0;
                    break;
                case e.DOM_DELTA_LINE:
                case e.DOM_DELTA_PAGE:
                    e.wheelX = (e.deltaX || 0) * 5;
                    e.wheelY = (e.deltaY || 0) * 5;
                    break;
            }
            
            callback(e);
        });
    } else {
        exports.addListener(el, "DOMMouseScroll", function(e) {
            if (e.axis && e.axis == e.HORIZONTAL_AXIS) {
                e.wheelX = (e.detail || 0) * 5;
                e.wheelY = 0;
            } else {
                e.wheelX = 0;
                e.wheelY = (e.detail || 0) * 5;
            }
            callback(e);
        });
    }
};

exports.addMultiMouseDownListener = function(el, timeouts, eventHandler, callbackName) {
    var clicks = 0;
    var startX, startY, timer;
    var eventNames = {
        2: "dblclick",
        3: "tripleclick",
        4: "quadclick"
    };

    exports.addListener(el, "mousedown", function(e) {
        if (exports.getButton(e) !== 0) {
            clicks = 0;
        } else if (e.detail > 1) {
            clicks++;
            if (clicks > 4)
                clicks = 1;
        } else {
            clicks = 1;
        }
        if (useragent.isIE) {
            var isNewClick = Math.abs(e.clientX - startX) > 5 || Math.abs(e.clientY - startY) > 5;
            if (isNewClick) {
                clicks = 1;
            }
            if (clicks == 1) {
                startX = e.clientX;
                startY = e.clientY;
            }
        }

        eventHandler[callbackName]("mousedown", e);

        if (clicks > 4)
            clicks = 0;
        else if (clicks > 1)
            return eventHandler[callbackName](eventNames[clicks], e);
    });

    if (useragent.isOldIE) {
        exports.addListener(el, "dblclick", function(e) {
            clicks = 2;
            if (timer)
                clearTimeout(timer);
            timer = setTimeout(function() {timer = null}, timeouts[clicks - 1] || 600);
            eventHandler[callbackName]("mousedown", e);
            eventHandler[callbackName](eventNames[clicks], e);
        });
    }
};

var getModifierHash = useragent.isMac && useragent.isOpera && !("KeyboardEvent" in window)
    ? function(e) {
        return 0 | (e.metaKey ? 1 : 0) | (e.altKey ? 2 : 0) | (e.shiftKey ? 4 : 0) | (e.ctrlKey ? 8 : 0);
    }
    : function(e) {
        return 0 | (e.ctrlKey ? 1 : 0) | (e.altKey ? 2 : 0) | (e.shiftKey ? 4 : 0) | (e.metaKey ? 8 : 0);
    };

exports.getModifierString = function(e) {
    return keys.KEY_MODS[getModifierHash(e)];
};

function normalizeCommandKeys(callback, e, keyCode) {
    var hashId = getModifierHash(e);

    if (!useragent.isMac && pressedKeys) {
        if (pressedKeys[91] || pressedKeys[92])
            hashId |= 8;
        if (pressedKeys.altGr) {
            if ((3 & hashId) != 3)
                pressedKeys.altGr = 0;
            else
                return;
        }
        if (keyCode === 18 || keyCode === 17) {
            var location = e.location || e.keyLocation;
            if (keyCode === 17 && location === 1) {
                ts = e.timeStamp;
            } else if (keyCode === 18 && hashId === 3 && location === 2) {
                var dt = -ts;
                ts = e.timeStamp;
                dt += ts;
                if (dt < 3)
                    pressedKeys.altGr = true;
            }
        }
    }
    
    if (keyCode in keys.MODIFIER_KEYS) {
        switch (keys.MODIFIER_KEYS[keyCode]) {
            case "Alt":
                hashId = 2;
                break;
            case "Shift":
                hashId = 4;
                break;
            case "Ctrl":
                hashId = 1;
                break;
            default:
                hashId = 8;
                break;
        }
        keyCode = -1;
    }

    if (hashId & 8 && (keyCode === 91 || keyCode === 93)) {
        keyCode = -1;
    }
    
    if (!hashId && keyCode === 13) {
        if (e.location || e.keyLocation === 3) {
            callback(e, hashId, -keyCode);
            if (e.defaultPrevented)
                return;
        }
    }
    if (!hashId && !(keyCode in keys.FUNCTION_KEYS) && !(keyCode in keys.PRINTABLE_KEYS)) {
        return false;
    }
    
    return callback(e, hashId, keyCode);
}

var pressedKeys = null;
var ts = 0;
exports.addCommandKeyListener = function(el, callback) {
    var addListener = exports.addListener;
    if (useragent.isOldGecko || (useragent.isOpera && !("KeyboardEvent" in window))) {
        var lastKeyDownKeyCode = null;
        addListener(el, "keydown", function(e) {
            lastKeyDownKeyCode = e.keyCode;
        });
        addListener(el, "keypress", function(e) {
            return normalizeCommandKeys(callback, e, lastKeyDownKeyCode);
        });
    } else {
        var lastDefaultPrevented = null;

        addListener(el, "keydown", function(e) {
            pressedKeys[e.keyCode] = true;
            var result = normalizeCommandKeys(callback, e, e.keyCode);
            lastDefaultPrevented = e.defaultPrevented;
            return result;
        });

        addListener(el, "keypress", function(e) {
            if (lastDefaultPrevented && (e.ctrlKey || e.altKey || e.shiftKey || e.metaKey)) {
                exports.stopEvent(e);
                lastDefaultPrevented = null;
            }
        });

        addListener(el, "keyup", function(e) {
            pressedKeys[e.keyCode] = null;
        });

        if (!pressedKeys) {
            pressedKeys = Object.create(null);
            addListener(window, "focus", function(e) {
                pressedKeys = Object.create(null);
            });
        }
    }
};

if (window.postMessage && !useragent.isOldIE) {
    var postMessageId = 1;
    exports.nextTick = function(callback, win) {
        win = win || window;
        var messageName = "zero-timeout-message-" + postMessageId;
        exports.addListener(win, "message", function listener(e) {
            if (e.data == messageName) {
                exports.stopPropagation(e);
                exports.removeListener(win, "message", listener);
                callback();
            }
        });
        win.postMessage(messageName, "*");
    };
}


exports.nextFrame = window.requestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    window.oRequestAnimationFrame;

if (exports.nextFrame)
    exports.nextFrame = exports.nextFrame.bind(window);
else
    exports.nextFrame = function(callback) {
        setTimeout(callback, 17);
    };
});

ace.define('ace/mode/folding/fold_mode', ['require', 'exports', 'module' , 'ace/range'], function(require, exports, module) {


var Range = require("../../range").Range;

var FoldMode = exports.FoldMode = function() {};

(function() {

    this.foldingStartMarker = null;
    this.foldingStopMarker = null;
    this.getFoldWidget = function(session, foldStyle, row) {
        var line = session.getLine(row);
        if (this.foldingStartMarker.test(line))
            return "start";
        if (foldStyle == "markbeginend"
                && this.foldingStopMarker
                && this.foldingStopMarker.test(line))
            return "end";
        return "";
    };

    this.getFoldWidgetRange = function(session, foldStyle, row) {
        return null;
    };

    this.indentationBlock = function(session, row, column) {
        var re = /\S/;
        var line = session.getLine(row);
        var startLevel = line.search(re);
        if (startLevel == -1)
            return;

        var startColumn = column || line.length;
        var maxRow = session.getLength();
        var startRow = row;
        var endRow = row;

        while (++row < maxRow) {
            var level = session.getLine(row).search(re);

            if (level == -1)
                continue;

            if (level <= startLevel)
                break;

            endRow = row;
        }

        if (endRow > startRow) {
            var endColumn = session.getLine(endRow).length;
            return new Range(startRow, startColumn, endRow, endColumn);
        }
    };

    this.openingBracketBlock = function(session, bracket, row, column, typeRe) {
        var start = {row: row, column: column + 1};
        var end = session.$findClosingBracket(bracket, start, typeRe);
        if (!end)
            return;

        var fw = session.foldWidgets[end.row];
        if (fw == null)
            fw = session.getFoldWidget(end.row);

        if (fw == "start" && end.row > start.row) {
            end.row --;
            end.column = session.getLine(end.row).length;
        }
        return Range.fromPoints(start, end);
    };

    this.closingBracketBlock = function(session, bracket, row, column, typeRe) {
        var end = {row: row, column: column};
        var start = session.$findOpeningBracket(bracket, end);

        if (!start)
            return;

        start.column++;
        end.column--;

        return  Range.fromPoints(start, end);
    };
}).call(FoldMode.prototype);

});

ace.define('ace/lib/dom', ['require', 'exports', 'module' ], function(require, exports, module) {


if (typeof document == "undefined")
    return;

var XHTML_NS = "http://www.w3.org/1999/xhtml";

exports.getDocumentHead = function(doc) {
    if (!doc)
        doc = document;
    return doc.head || doc.getElementsByTagName("head")[0] || doc.documentElement;
}

exports.createElement = function(tag, ns) {
    return document.createElementNS ?
           document.createElementNS(ns || XHTML_NS, tag) :
           document.createElement(tag);
};

exports.hasCssClass = function(el, name) {
    var classes = el.className.split(/\s+/g);
    return classes.indexOf(name) !== -1;
};
exports.addCssClass = function(el, name) {
    if (!exports.hasCssClass(el, name)) {
        el.className += " " + name;
    }
};
exports.removeCssClass = function(el, name) {
    var classes = el.className.split(/\s+/g);
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        classes.splice(index, 1);
    }
    el.className = classes.join(" ");
};

exports.toggleCssClass = function(el, name) {
    var classes = el.className.split(/\s+/g), add = true;
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        add = false;
        classes.splice(index, 1);
    }
    if(add)
        classes.push(name);

    el.className = classes.join(" ");
    return add;
};
exports.setCssClass = function(node, className, include) {
    if (include) {
        exports.addCssClass(node, className);
    } else {
        exports.removeCssClass(node, className);
    }
};

exports.hasCssString = function(id, doc) {
    var index = 0, sheets;
    doc = doc || document;

    if (doc.createStyleSheet && (sheets = doc.styleSheets)) {
        while (index < sheets.length)
            if (sheets[index++].owningElement.id === id) return true;
    } else if ((sheets = doc.getElementsByTagName("style"))) {
        while (index < sheets.length)
            if (sheets[index++].id === id) return true;
    }

    return false;
};

exports.importCssString = function importCssString(cssText, id, doc) {
    doc = doc || document;
    if (id && exports.hasCssString(id, doc))
        return null;
    
    var style;
    
    if (doc.createStyleSheet) {
        style = doc.createStyleSheet();
        style.cssText = cssText;
        if (id)
            style.owningElement.id = id;
    } else {
        style = doc.createElementNS
            ? doc.createElementNS(XHTML_NS, "style")
            : doc.createElement("style");

        style.appendChild(doc.createTextNode(cssText));
        if (id)
            style.id = id;

        exports.getDocumentHead(doc).appendChild(style);
    }
};

exports.importCssStylsheet = function(uri, doc) {
    if (doc.createStyleSheet) {
        doc.createStyleSheet(uri);
    } else {
        var link = exports.createElement('link');
        link.rel = 'stylesheet';
        link.href = uri;

        exports.getDocumentHead(doc).appendChild(link);
    }
};

exports.getInnerWidth = function(element) {
    return (
        parseInt(exports.computedStyle(element, "paddingLeft"), 10) +
        parseInt(exports.computedStyle(element, "paddingRight"), 10) + 
        element.clientWidth
    );
};

exports.getInnerHeight = function(element) {
    return (
        parseInt(exports.computedStyle(element, "paddingTop"), 10) +
        parseInt(exports.computedStyle(element, "paddingBottom"), 10) +
        element.clientHeight
    );
};

if (window.pageYOffset !== undefined) {
    exports.getPageScrollTop = function() {
        return window.pageYOffset;
    };

    exports.getPageScrollLeft = function() {
        return window.pageXOffset;
    };
}
else {
    exports.getPageScrollTop = function() {
        return document.body.scrollTop;
    };

    exports.getPageScrollLeft = function() {
        return document.body.scrollLeft;
    };
}

if (window.getComputedStyle)
    exports.computedStyle = function(element, style) {
        if (style)
            return (window.getComputedStyle(element, "") || {})[style] || "";
        return window.getComputedStyle(element, "") || {};
    };
else
    exports.computedStyle = function(element, style) {
        if (style)
            return element.currentStyle[style];
        return element.currentStyle;
    };

exports.scrollbarWidth = function(document) {
    var inner = exports.createElement("ace_inner");
    inner.style.width = "100%";
    inner.style.minWidth = "0px";
    inner.style.height = "200px";
    inner.style.display = "block";

    var outer = exports.createElement("ace_outer");
    var style = outer.style;

    style.position = "absolute";
    style.left = "-10000px";
    style.overflow = "hidden";
    style.width = "200px";
    style.minWidth = "0px";
    style.height = "150px";
    style.display = "block";

    outer.appendChild(inner);

    var body = document.documentElement;
    body.appendChild(outer);

    var noScrollbar = inner.offsetWidth;

    style.overflow = "scroll";
    var withScrollbar = inner.offsetWidth;

    if (noScrollbar == withScrollbar) {
        withScrollbar = outer.clientWidth;
    }

    body.removeChild(outer);

    return noScrollbar-withScrollbar;
};
exports.setInnerHtml = function(el, innerHtml) {
    var element = el.cloneNode(false);//document.createElement("div");
    element.innerHTML = innerHtml;
    el.parentNode.replaceChild(element, el);
    return element;
};

if ("textContent" in document.documentElement) {
    exports.setInnerText = function(el, innerText) {
        el.textContent = innerText;
    };

    exports.getInnerText = function(el) {
        return el.textContent;
    };
}
else {
    exports.setInnerText = function(el, innerText) {
        el.innerText = innerText;
    };

    exports.getInnerText = function(el) {
        return el.innerText;
    };
}

exports.getParentWindow = function(document) {
    return document.defaultView || document.parentWindow;
};

});

ace.define('ace/theme/textmate', ['require', 'exports', 'module' , 'ace/lib/dom'], function(require, exports, module) {


exports.isDark = false;
exports.cssClass = "ace-tm";
exports.cssText = ".ace-tm .ace_gutter {\
background: #f0f0f0;\
color: #333;\
}\
.ace-tm .ace_print-margin {\
width: 1px;\
background: #e8e8e8;\
}\
.ace-tm .ace_fold {\
background-color: #6B72E6;\
}\
.ace-tm {\
background-color: #FFFFFF;\
color: black;\
}\
.ace-tm .ace_cursor {\
color: black;\
}\
.ace-tm .ace_invisible {\
color: rgb(191, 191, 191);\
}\
.ace-tm .ace_storage,\
.ace-tm .ace_keyword {\
color: blue;\
}\
.ace-tm .ace_constant {\
color: rgb(197, 6, 11);\
}\
.ace-tm .ace_constant.ace_buildin {\
color: rgb(88, 72, 246);\
}\
.ace-tm .ace_constant.ace_language {\
color: rgb(88, 92, 246);\
}\
.ace-tm .ace_constant.ace_library {\
color: rgb(6, 150, 14);\
}\
.ace-tm .ace_invalid {\
background-color: rgba(255, 0, 0, 0.1);\
color: red;\
}\
.ace-tm .ace_support.ace_function {\
color: rgb(60, 76, 114);\
}\
.ace-tm .ace_support.ace_constant {\
color: rgb(6, 150, 14);\
}\
.ace-tm .ace_support.ace_type,\
.ace-tm .ace_support.ace_class {\
color: rgb(109, 121, 222);\
}\
.ace-tm .ace_keyword.ace_operator {\
color: rgb(104, 118, 135);\
}\
.ace-tm .ace_string {\
color: rgb(3, 106, 7);\
}\
.ace-tm .ace_comment {\
color: rgb(76, 136, 107);\
}\
.ace-tm .ace_comment.ace_doc {\
color: rgb(0, 102, 255);\
}\
.ace-tm .ace_comment.ace_doc.ace_tag {\
color: rgb(128, 159, 191);\
}\
.ace-tm .ace_constant.ace_numeric {\
color: rgb(0, 0, 205);\
}\
.ace-tm .ace_variable {\
color: rgb(49, 132, 149);\
}\
.ace-tm .ace_xml-pe {\
color: rgb(104, 104, 91);\
}\
.ace-tm .ace_entity.ace_name.ace_function {\
color: #0000A2;\
}\
.ace-tm .ace_heading {\
color: rgb(12, 7, 255);\
}\
.ace-tm .ace_list {\
color:rgb(185, 6, 144);\
}\
.ace-tm .ace_meta.ace_tag {\
color:rgb(0, 22, 142);\
}\
.ace-tm .ace_string.ace_regex {\
color: rgb(255, 0, 0)\
}\
.ace-tm .ace_marker-layer .ace_selection {\
background: rgb(181, 213, 255);\
}\
.ace-tm.ace_multiselect .ace_selection.ace_start {\
box-shadow: 0 0 3px 0px white;\
border-radius: 2px;\
}\
.ace-tm .ace_marker-layer .ace_step {\
background: rgb(252, 255, 0);\
}\
.ace-tm .ace_marker-layer .ace_stack {\
background: rgb(164, 229, 101);\
}\
.ace-tm .ace_marker-layer .ace_bracket {\
margin: -1px 0 0 -1px;\
border: 1px solid rgb(192, 192, 192);\
}\
.ace-tm .ace_marker-layer .ace_active-line {\
background: rgba(0, 0, 0, 0.07);\
}\
.ace-tm .ace_gutter-active-line {\
background-color : #dcdcdc;\
}\
.ace-tm .ace_marker-layer .ace_selected-word {\
background: rgb(250, 250, 255);\
border: 1px solid rgb(200, 200, 250);\
}\
.ace-tm .ace_indent-guide {\
background: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==\") right repeat-y;\
}\
";

var dom = require("../lib/dom");
dom.importCssString(exports.cssText, exports.cssClass);
});

ace.define('ace/lib/es5-shim', ['require', 'exports', 'module' ], function(require, exports, module) {

function Empty() {}

if (!Function.prototype.bind) {
    Function.prototype.bind = function bind(that) { // .length is 1
        var target = this;
        if (typeof target != "function") {
            throw new TypeError("Function.prototype.bind called on incompatible " + target);
        }
        var args = slice.call(arguments, 1); // for normal call
        var bound = function () {

            if (this instanceof bound) {

                var result = target.apply(
                    this,
                    args.concat(slice.call(arguments))
                );
                if (Object(result) === result) {
                    return result;
                }
                return this;

            } else {
                return target.apply(
                    that,
                    args.concat(slice.call(arguments))
                );

            }

        };
        if(target.prototype) {
            Empty.prototype = target.prototype;
            bound.prototype = new Empty();
            Empty.prototype = null;
        }
        return bound;
    };
}
var call = Function.prototype.call;
var prototypeOfArray = Array.prototype;
var prototypeOfObject = Object.prototype;
var slice = prototypeOfArray.slice;
var _toString = call.bind(prototypeOfObject.toString);
var owns = call.bind(prototypeOfObject.hasOwnProperty);
var defineGetter;
var defineSetter;
var lookupGetter;
var lookupSetter;
var supportsAccessors;
if ((supportsAccessors = owns(prototypeOfObject, "__defineGetter__"))) {
    defineGetter = call.bind(prototypeOfObject.__defineGetter__);
    defineSetter = call.bind(prototypeOfObject.__defineSetter__);
    lookupGetter = call.bind(prototypeOfObject.__lookupGetter__);
    lookupSetter = call.bind(prototypeOfObject.__lookupSetter__);
}
if ([1,2].splice(0).length != 2) {
    if(function() { // test IE < 9 to splice bug - see issue #138
        function makeArray(l) {
            var a = new Array(l+2);
            a[0] = a[1] = 0;
            return a;
        }
        var array = [], lengthBefore;
        
        array.splice.apply(array, makeArray(20));
        array.splice.apply(array, makeArray(26));

        lengthBefore = array.length; //46
        array.splice(5, 0, "XXX"); // add one element

        lengthBefore + 1 == array.length

        if (lengthBefore + 1 == array.length) {
            return true;// has right splice implementation without bugs
        }
    }()) {//IE 6/7
        var array_splice = Array.prototype.splice;
        Array.prototype.splice = function(start, deleteCount) {
            if (!arguments.length) {
                return [];
            } else {
                return array_splice.apply(this, [
                    start === void 0 ? 0 : start,
                    deleteCount === void 0 ? (this.length - start) : deleteCount
                ].concat(slice.call(arguments, 2)))
            }
        };
    } else {//IE8
        Array.prototype.splice = function(pos, removeCount){
            var length = this.length;
            if (pos > 0) {
                if (pos > length)
                    pos = length;
            } else if (pos == void 0) {
                pos = 0;
            } else if (pos < 0) {
                pos = Math.max(length + pos, 0);
            }

            if (!(pos+removeCount < length))
                removeCount = length - pos;

            var removed = this.slice(pos, pos+removeCount);
            var insert = slice.call(arguments, 2);
            var add = insert.length;            
            if (pos === length) {
                if (add) {
                    this.push.apply(this, insert);
                }
            } else {
                var remove = Math.min(removeCount, length - pos);
                var tailOldPos = pos + remove;
                var tailNewPos = tailOldPos + add - remove;
                var tailCount = length - tailOldPos;
                var lengthAfterRemove = length - remove;

                if (tailNewPos < tailOldPos) { // case A
                    for (var i = 0; i < tailCount; ++i) {
                        this[tailNewPos+i] = this[tailOldPos+i];
                    }
                } else if (tailNewPos > tailOldPos) { // case B
                    for (i = tailCount; i--; ) {
                        this[tailNewPos+i] = this[tailOldPos+i];
                    }
                } // else, add == remove (nothing to do)

                if (add && pos === lengthAfterRemove) {
                    this.length = lengthAfterRemove; // truncate array
                    this.push.apply(this, insert);
                } else {
                    this.length = lengthAfterRemove + add; // reserves space
                    for (i = 0; i < add; ++i) {
                        this[pos+i] = insert[i];
                    }
                }
            }
            return removed;
        };
    }
}
if (!Array.isArray) {
    Array.isArray = function isArray(obj) {
        return _toString(obj) == "[object Array]";
    };
}
var boxedString = Object("a"),
    splitString = boxedString[0] != "a" || !(0 in boxedString);

if (!Array.prototype.forEach) {
    Array.prototype.forEach = function forEach(fun /*, thisp*/) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            thisp = arguments[1],
            i = -1,
            length = self.length >>> 0;
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(); // TODO message
        }

        while (++i < length) {
            if (i in self) {
                fun.call(thisp, self[i], i, object);
            }
        }
    };
}
if (!Array.prototype.map) {
    Array.prototype.map = function map(fun /*, thisp*/) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0,
            result = Array(length),
            thisp = arguments[1];
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }

        for (var i = 0; i < length; i++) {
            if (i in self)
                result[i] = fun.call(thisp, self[i], i, object);
        }
        return result;
    };
}
if (!Array.prototype.filter) {
    Array.prototype.filter = function filter(fun /*, thisp */) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                    object,
            length = self.length >>> 0,
            result = [],
            value,
            thisp = arguments[1];
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }

        for (var i = 0; i < length; i++) {
            if (i in self) {
                value = self[i];
                if (fun.call(thisp, value, i, object)) {
                    result.push(value);
                }
            }
        }
        return result;
    };
}
if (!Array.prototype.every) {
    Array.prototype.every = function every(fun /*, thisp */) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0,
            thisp = arguments[1];
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }

        for (var i = 0; i < length; i++) {
            if (i in self && !fun.call(thisp, self[i], i, object)) {
                return false;
            }
        }
        return true;
    };
}
if (!Array.prototype.some) {
    Array.prototype.some = function some(fun /*, thisp */) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0,
            thisp = arguments[1];
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }

        for (var i = 0; i < length; i++) {
            if (i in self && fun.call(thisp, self[i], i, object)) {
                return true;
            }
        }
        return false;
    };
}
if (!Array.prototype.reduce) {
    Array.prototype.reduce = function reduce(fun /*, initial*/) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0;
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }
        if (!length && arguments.length == 1) {
            throw new TypeError("reduce of empty array with no initial value");
        }

        var i = 0;
        var result;
        if (arguments.length >= 2) {
            result = arguments[1];
        } else {
            do {
                if (i in self) {
                    result = self[i++];
                    break;
                }
                if (++i >= length) {
                    throw new TypeError("reduce of empty array with no initial value");
                }
            } while (true);
        }

        for (; i < length; i++) {
            if (i in self) {
                result = fun.call(void 0, result, self[i], i, object);
            }
        }

        return result;
    };
}
if (!Array.prototype.reduceRight) {
    Array.prototype.reduceRight = function reduceRight(fun /*, initial*/) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0;
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }
        if (!length && arguments.length == 1) {
            throw new TypeError("reduceRight of empty array with no initial value");
        }

        var result, i = length - 1;
        if (arguments.length >= 2) {
            result = arguments[1];
        } else {
            do {
                if (i in self) {
                    result = self[i--];
                    break;
                }
                if (--i < 0) {
                    throw new TypeError("reduceRight of empty array with no initial value");
                }
            } while (true);
        }

        do {
            if (i in this) {
                result = fun.call(void 0, result, self[i], i, object);
            }
        } while (i--);

        return result;
    };
}
if (!Array.prototype.indexOf || ([0, 1].indexOf(1, 2) != -1)) {
    Array.prototype.indexOf = function indexOf(sought /*, fromIndex */ ) {
        var self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                toObject(this),
            length = self.length >>> 0;

        if (!length) {
            return -1;
        }

        var i = 0;
        if (arguments.length > 1) {
            i = toInteger(arguments[1]);
        }
        i = i >= 0 ? i : Math.max(0, length + i);
        for (; i < length; i++) {
            if (i in self && self[i] === sought) {
                return i;
            }
        }
        return -1;
    };
}
if (!Array.prototype.lastIndexOf || ([0, 1].lastIndexOf(0, -3) != -1)) {
    Array.prototype.lastIndexOf = function lastIndexOf(sought /*, fromIndex */) {
        var self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                toObject(this),
            length = self.length >>> 0;

        if (!length) {
            return -1;
        }
        var i = length - 1;
        if (arguments.length > 1) {
            i = Math.min(i, toInteger(arguments[1]));
        }
        i = i >= 0 ? i : length - Math.abs(i);
        for (; i >= 0; i--) {
            if (i in self && sought === self[i]) {
                return i;
            }
        }
        return -1;
    };
}
if (!Object.getPrototypeOf) {
    Object.getPrototypeOf = function getPrototypeOf(object) {
        return object.__proto__ || (
            object.constructor ?
            object.constructor.prototype :
            prototypeOfObject
        );
    };
}
if (!Object.getOwnPropertyDescriptor) {
    var ERR_NON_OBJECT = "Object.getOwnPropertyDescriptor called on a " +
                         "non-object: ";
    Object.getOwnPropertyDescriptor = function getOwnPropertyDescriptor(object, property) {
        if ((typeof object != "object" && typeof object != "function") || object === null)
            throw new TypeError(ERR_NON_OBJECT + object);
        if (!owns(object, property))
            return;

        var descriptor, getter, setter;
        descriptor =  { enumerable: true, configurable: true };
        if (supportsAccessors) {
            var prototype = object.__proto__;
            object.__proto__ = prototypeOfObject;

            var getter = lookupGetter(object, property);
            var setter = lookupSetter(object, property);
            object.__proto__ = prototype;

            if (getter || setter) {
                if (getter) descriptor.get = getter;
                if (setter) descriptor.set = setter;
                return descriptor;
            }
        }
        descriptor.value = object[property];
        return descriptor;
    };
}
if (!Object.getOwnPropertyNames) {
    Object.getOwnPropertyNames = function getOwnPropertyNames(object) {
        return Object.keys(object);
    };
}
if (!Object.create) {
    var createEmpty;
    if (Object.prototype.__proto__ === null) {
        createEmpty = function () {
            return { "__proto__": null };
        };
    } else {
        createEmpty = function () {
            var empty = {};
            for (var i in empty)
                empty[i] = null;
            empty.constructor =
            empty.hasOwnProperty =
            empty.propertyIsEnumerable =
            empty.isPrototypeOf =
            empty.toLocaleString =
            empty.toString =
            empty.valueOf =
            empty.__proto__ = null;
            return empty;
        }
    }

    Object.create = function create(prototype, properties) {
        var object;
        if (prototype === null) {
            object = createEmpty();
        } else {
            if (typeof prototype != "object")
                throw new TypeError("typeof prototype["+(typeof prototype)+"] != 'object'");
            var Type = function () {};
            Type.prototype = prototype;
            object = new Type();
            object.__proto__ = prototype;
        }
        if (properties !== void 0)
            Object.defineProperties(object, properties);
        return object;
    };
}

function doesDefinePropertyWork(object) {
    try {
        Object.defineProperty(object, "sentinel", {});
        return "sentinel" in object;
    } catch (exception) {
    }
}
if (Object.defineProperty) {
    var definePropertyWorksOnObject = doesDefinePropertyWork({});
    var definePropertyWorksOnDom = typeof document == "undefined" ||
        doesDefinePropertyWork(document.createElement("div"));
    if (!definePropertyWorksOnObject || !definePropertyWorksOnDom) {
        var definePropertyFallback = Object.defineProperty;
    }
}

if (!Object.defineProperty || definePropertyFallback) {
    var ERR_NON_OBJECT_DESCRIPTOR = "Property description must be an object: ";
    var ERR_NON_OBJECT_TARGET = "Object.defineProperty called on non-object: "
    var ERR_ACCESSORS_NOT_SUPPORTED = "getters & setters can not be defined " +
                                      "on this javascript engine";

    Object.defineProperty = function defineProperty(object, property, descriptor) {
        if ((typeof object != "object" && typeof object != "function") || object === null)
            throw new TypeError(ERR_NON_OBJECT_TARGET + object);
        if ((typeof descriptor != "object" && typeof descriptor != "function") || descriptor === null)
            throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR + descriptor);
        if (definePropertyFallback) {
            try {
                return definePropertyFallback.call(Object, object, property, descriptor);
            } catch (exception) {
            }
        }
        if (owns(descriptor, "value")) {

            if (supportsAccessors && (lookupGetter(object, property) ||
                                      lookupSetter(object, property)))
            {
                var prototype = object.__proto__;
                object.__proto__ = prototypeOfObject;
                delete object[property];
                object[property] = descriptor.value;
                object.__proto__ = prototype;
            } else {
                object[property] = descriptor.value;
            }
        } else {
            if (!supportsAccessors)
                throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);
            if (owns(descriptor, "get"))
                defineGetter(object, property, descriptor.get);
            if (owns(descriptor, "set"))
                defineSetter(object, property, descriptor.set);
        }

        return object;
    };
}
if (!Object.defineProperties) {
    Object.defineProperties = function defineProperties(object, properties) {
        for (var property in properties) {
            if (owns(properties, property))
                Object.defineProperty(object, property, properties[property]);
        }
        return object;
    };
}
if (!Object.seal) {
    Object.seal = function seal(object) {
        return object;
    };
}
if (!Object.freeze) {
    Object.freeze = function freeze(object) {
        return object;
    };
}
try {
    Object.freeze(function () {});
} catch (exception) {
    Object.freeze = (function freeze(freezeObject) {
        return function freeze(object) {
            if (typeof object == "function") {
                return object;
            } else {
                return freezeObject(object);
            }
        };
    })(Object.freeze);
}
if (!Object.preventExtensions) {
    Object.preventExtensions = function preventExtensions(object) {
        return object;
    };
}
if (!Object.isSealed) {
    Object.isSealed = function isSealed(object) {
        return false;
    };
}
if (!Object.isFrozen) {
    Object.isFrozen = function isFrozen(object) {
        return false;
    };
}
if (!Object.isExtensible) {
    Object.isExtensible = function isExtensible(object) {
        if (Object(object) === object) {
            throw new TypeError(); // TODO message
        }
        var name = '';
        while (owns(object, name)) {
            name += '?';
        }
        object[name] = true;
        var returnValue = owns(object, name);
        delete object[name];
        return returnValue;
    };
}
if (!Object.keys) {
    var hasDontEnumBug = true,
        dontEnums = [
            "toString",
            "toLocaleString",
            "valueOf",
            "hasOwnProperty",
            "isPrototypeOf",
            "propertyIsEnumerable",
            "constructor"
        ],
        dontEnumsLength = dontEnums.length;

    for (var key in {"toString": null}) {
        hasDontEnumBug = false;
    }

    Object.keys = function keys(object) {

        if (
            (typeof object != "object" && typeof object != "function") ||
            object === null
        ) {
            throw new TypeError("Object.keys called on a non-object");
        }

        var keys = [];
        for (var name in object) {
            if (owns(object, name)) {
                keys.push(name);
            }
        }

        if (hasDontEnumBug) {
            for (var i = 0, ii = dontEnumsLength; i < ii; i++) {
                var dontEnum = dontEnums[i];
                if (owns(object, dontEnum)) {
                    keys.push(dontEnum);
                }
            }
        }
        return keys;
    };

}
if (!Date.now) {
    Date.now = function now() {
        return new Date().getTime();
    };
}
var ws = "\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003" +
    "\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028" +
    "\u2029\uFEFF";
if (!String.prototype.trim || ws.trim()) {
    ws = "[" + ws + "]";
    var trimBeginRegexp = new RegExp("^" + ws + ws + "*"),
        trimEndRegexp = new RegExp(ws + ws + "*$");
    String.prototype.trim = function trim() {
        return String(this).replace(trimBeginRegexp, "").replace(trimEndRegexp, "");
    };
}

function toInteger(n) {
    n = +n;
    if (n !== n) { // isNaN
        n = 0;
    } else if (n !== 0 && n !== (1/0) && n !== -(1/0)) {
        n = (n > 0 || -1) * Math.floor(Math.abs(n));
    }
    return n;
}

function isPrimitive(input) {
    var type = typeof input;
    return (
        input === null ||
        type === "undefined" ||
        type === "boolean" ||
        type === "number" ||
        type === "string"
    );
}

function toPrimitive(input) {
    var val, valueOf, toString;
    if (isPrimitive(input)) {
        return input;
    }
    valueOf = input.valueOf;
    if (typeof valueOf === "function") {
        val = valueOf.call(input);
        if (isPrimitive(val)) {
            return val;
        }
    }
    toString = input.toString;
    if (typeof toString === "function") {
        val = toString.call(input);
        if (isPrimitive(val)) {
            return val;
        }
    }
    throw new TypeError();
}
var toObject = function (o) {
    if (o == null) { // this matches both null and undefined
        throw new TypeError("can't convert "+o+" to object");
    }
    return Object(o);
};

});
 
ace.define('ace/lib/regexp', ['require', 'exports', 'module' ], function(require, exports, module) {

    var real = {
            exec: RegExp.prototype.exec,
            test: RegExp.prototype.test,
            match: String.prototype.match,
            replace: String.prototype.replace,
            split: String.prototype.split
        },
        compliantExecNpcg = real.exec.call(/()??/, "")[1] === undefined, // check `exec` handling of nonparticipating capturing groups
        compliantLastIndexIncrement = function () {
            var x = /^/g;
            real.test.call(x, "");
            return !x.lastIndex;
        }();

    if (compliantLastIndexIncrement && compliantExecNpcg)
        return;
    RegExp.prototype.exec = function (str) {
        var match = real.exec.apply(this, arguments),
            name, r2;
        if ( typeof(str) == 'string' && match) {
            if (!compliantExecNpcg && match.length > 1 && indexOf(match, "") > -1) {
                r2 = RegExp(this.source, real.replace.call(getNativeFlags(this), "g", ""));
                real.replace.call(str.slice(match.index), r2, function () {
                    for (var i = 1; i < arguments.length - 2; i++) {
                        if (arguments[i] === undefined)
                            match[i] = undefined;
                    }
                });
            }
            if (this._xregexp && this._xregexp.captureNames) {
                for (var i = 1; i < match.length; i++) {
                    name = this._xregexp.captureNames[i - 1];
                    if (name)
                       match[name] = match[i];
                }
            }
            if (!compliantLastIndexIncrement && this.global && !match[0].length && (this.lastIndex > match.index))
                this.lastIndex--;
        }
        return match;
    };
    if (!compliantLastIndexIncrement) {
        RegExp.prototype.test = function (str) {
            var match = real.exec.call(this, str);
            if (match && this.global && !match[0].length && (this.lastIndex > match.index))
                this.lastIndex--;
            return !!match;
        };
    }

    function getNativeFlags (regex) {
        return (regex.global     ? "g" : "") +
               (regex.ignoreCase ? "i" : "") +
               (regex.multiline  ? "m" : "") +
               (regex.extended   ? "x" : "") + // Proposed for ES4; included in AS3
               (regex.sticky     ? "y" : "");
    }

    function indexOf (array, item, from) {
        if (Array.prototype.indexOf) // Use the native array method if available
            return array.indexOf(item, from);
        for (var i = from || 0; i < array.length; i++) {
            if (array[i] === item)
                return i;
        }
        return -1;
    }

});

ace.define('ace/ext/error_marker', ['require', 'exports', 'module' , 'ace/line_widgets', 'ace/lib/dom', 'ace/range'], function(require, exports, module) {

var LineWidgets = require("ace/line_widgets").LineWidgets;
var dom = require("ace/lib/dom");
var Range = require("ace/range").Range;

function binarySearch(array, needle, comparator) {
    var first = 0;
    var last = array.length - 1;

    while (first <= last) {
        var mid = (first + last) >> 1;
        var c = comparator(needle, array[mid]);
        if (c > 0)
            first = mid + 1;
        else if (c < 0)
            last = mid - 1;
        else
            return mid;
    }
    return -(first + 1);
}

function findAnnotations(session, row, dir) {
    var annotations = session.getAnnotations().sort(Range.comparePoints);
    if (!annotations.length)
        return;
    
    var i = binarySearch(annotations, {row: row, column: -1}, Range.comparePoints);
    if (i < 0)
        i = -i - 1;
    
    if (i >= annotations.length - 1)
        i = dir > 0 ? 0 : annotations.length - 1;
    else if (i === 0 && dir < 0)
        i = annotations.length - 1;
    
    var annotation = annotations[i];
    if (!annotation || !dir)
        return;

    if (annotation.row === row) {
        do {
            annotation = annotations[i += dir];
        } while (annotation && annotation.row === row);
        if (!annotation)
            return annotations.slice();
    }
    
    
    var matched = [];
    row = annotation.row;
    do {
        matched[dir < 0 ? "unshift" : "push"](annotation);
        annotation = annotations[i += dir];
    } while (annotation && annotation.row == row);
    return matched.length && matched;
}

exports.showErrorMarker = function(editor, dir) {
    var session = editor.session;
    if (!session.widgetManager) {
        session.widgetManager = new LineWidgets(session);
        session.widgetManager.attach(editor);
    }
    
    var pos = editor.getCursorPosition();
    var row = pos.row;
    var oldWidget = session.lineWidgets && session.lineWidgets[row];
    if (oldWidget) {
        oldWidget.destroy();
    } else {
        row -= dir;
    }
    var annotations = findAnnotations(session, row, dir);
    var gutterAnno;
    if (annotations) {
        var annotation = annotations[0];
        pos.column = (annotation.pos && typeof annotation.column != "number"
            ? annotation.pos.sc
            : annotation.column) || 0;
        pos.row = annotation.row;
        gutterAnno = editor.renderer.$gutterLayer.$annotations[pos.row];
    } else if (oldWidget) {
        return;
    } else {
        gutterAnno = {
            text: ["Looks good!"],
            className: "ace_ok"
        };
    }
    editor.session.unfold(pos.row);
    editor.selection.moveToPosition(pos);
    
    var w = {
        row: pos.row, 
        fixedWidth: true,
        coverGutter: true,
        el: dom.createElement("div")
    };
    var el = w.el.appendChild(dom.createElement("div"));
    var arrow = w.el.appendChild(dom.createElement("div"));
    arrow.className = "error_widget_arrow " + gutterAnno.className;
    
    var left = editor.renderer.$cursorLayer
        .getPixelPosition(pos).left;
    arrow.style.left = left + editor.renderer.gutterWidth - 5 + "px";
    
    w.el.className = "error_widget_wrapper";
    el.className = "error_widget " + gutterAnno.className;
    el.innerHTML = gutterAnno.text.join("<br>");
    
    el.appendChild(dom.createElement("div"));
    
    var kb = function(_, hashId, keyString) {
        if (hashId === 0 && (keyString === "esc" || keyString === "return")) {
            w.destroy();
            return {command: "null"};
        }
    };
    
    w.destroy = function() {
        if (editor.$mouseHandler.isMousePressed)
            return;
        editor.keyBinding.removeKeyboardHandler(kb);
        session.widgetManager.removeLineWidget(w);
        editor.off("changeSelection", w.destroy);
        editor.off("changeSession", w.destroy);
        editor.off("mouseup", w.destroy);
        editor.off("change", w.destroy);
    };
    
    editor.keyBinding.addKeyboardHandler(kb);
    editor.on("changeSelection", w.destroy);
    editor.on("changeSession", w.destroy);
    editor.on("mouseup", w.destroy);
    editor.on("change", w.destroy);
    
    editor.session.widgetManager.addLineWidget(w);
    
    w.el.onmousedown = editor.focus.bind(editor);
    
    editor.renderer.scrollCursorIntoView(null, 0.5, {bottom: w.el.offsetHeight});
};


dom.importCssString("\
    .error_widget_wrapper {\
        background: inherit;\
        color: inherit;\
        border:none\
    }\
    .error_widget {\
        border-top: solid 2px;\
        border-bottom: solid 2px;\
        margin: 5px 0;\
        padding: 10px 40px;\
        white-space: pre-wrap;\
    }\
    .error_widget.ace_error, .error_widget_arrow.ace_error{\
        border-color: #ff5a5a\
    }\
    .error_widget.ace_warning, .error_widget_arrow.ace_warning{\
        border-color: #F1D817\
    }\
    .error_widget.ace_info, .error_widget_arrow.ace_info{\
        border-color: #5a5a5a\
    }\
    .error_widget.ace_ok, .error_widget_arrow.ace_ok{\
        border-color: #5aaa5a\
    }\
    .error_widget_arrow {\
        position: absolute;\
        border: solid 5px;\
        border-top-color: transparent!important;\
        border-right-color: transparent!important;\
        border-left-color: transparent!important;\
        top: -5px;\
    }\
", "");

});// vim:set ts=4 sts=4 sw=4 st:

ace.define('ace/lib/fixoldbrowsers', ['require', 'exports', 'module' , 'ace/lib/regexp', 'ace/lib/es5-shim'], function(require, exports, module) {


require("./regexp");
require("./es5-shim");

});

ace.define('ace/line_widgets', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/dom', 'ace/range'], function(require, exports, module) {


var oop = require("./lib/oop");
var dom = require("./lib/dom");
var Range = require("./range").Range;


function LineWidgets(session) {
    this.session = session;
    this.session.widgetManager = this;
    this.session.getRowLength = this.getRowLength;
    this.session.$getWidgetScreenLength = this.$getWidgetScreenLength;
    this.updateOnChange = this.updateOnChange.bind(this);
    this.renderWidgets = this.renderWidgets.bind(this);
    this.measureWidgets = this.measureWidgets.bind(this);
    this.session._changedWidgets = [];
    this.detach = this.detach.bind(this);
    
    this.session.on("change", this.updateOnChange);
}

(function() {
    this.getRowLength = function(row) {
        var h;
        if (this.lineWidgets)
            h = this.lineWidgets[row] && this.lineWidgets[row].rowCount || 0;
        else 
            h = 0;
        if (!this.$useWrapMode || !this.$wrapData[row]) {
            return 1 + h;
        } else {
            return this.$wrapData[row].length + 1 + h;
        }
    };

    this.$getWidgetScreenLength = function() {
        var screenRows = 0;
        this.lineWidgets.forEach(function(w){
            if (w && w.rowCount)
                screenRows +=w.rowCount;
        });
        return screenRows;
    };    
    
    this.attach = function(editor) {
        if (editor.widgetManager && editor.widgetManager != this)
            editor.widgetManager.detach();

        if (this.editor == editor)
            return;

        this.detach();
        this.editor = editor;
        
        this.editor.on("changeSession", this.detach);
        
        editor.widgetManager = this;

        editor.setOption("enableLineWidgets", true);
        editor.renderer.on("beforeRender", this.measureWidgets);
        editor.renderer.on("afterRender", this.renderWidgets);
    };
    this.detach = function(e) {
        if (e && e.session == this.session)
            return; // sometimes attach can be called before setSession
        var editor = this.editor;
        if (!editor)
            return;

        editor.off("changeSession", this.detach);
        
        this.editor = null;
        editor.widgetManager = null;
        
        editor.renderer.off("beforeRender", this.measureWidgets);
        editor.renderer.off("afterRender", this.renderWidgets);
        var lineWidgets = this.session.lineWidgets;
        lineWidgets && lineWidgets.forEach(function(w) {
            if (w && w.el && w.el.parentNode) {
                w._inDocument = false;
                w.el.parentNode.removeChild(w.el);
            }
        });
    };

    this.updateOnChange = function(e) {
        var lineWidgets = this.session.lineWidgets;
        if (!lineWidgets) return;
            
        var delta = e.data;
        var range = delta.range;
        var startRow = range.start.row;
        var len = range.end.row - startRow;

        if (len === 0) {
        } else if (delta.action == "removeText" || delta.action == "removeLines") {
            var removed = lineWidgets.splice(startRow + 1, len);
            removed.forEach(function(w) {
                w && this.removeLineWidget(w);
            }, this);
            this.$updateRows();
        } else {
            var args = new Array(len);
            args.unshift(startRow, 0);
            lineWidgets.splice.apply(lineWidgets, args);
            this.$updateRows();
        }
    };
    
    this.$updateRows = function() {
        var lineWidgets = this.session.lineWidgets;
        if (!lineWidgets) return;
        var noWidgets = true;
        lineWidgets.forEach(function(w, i) {
            if (w) {
                noWidgets = false;
                w.row = i;
            }
        });
        if (noWidgets)
            this.session.lineWidgets = null;
    };

    this.addLineWidget = function(w) {
        if (!this.session.lineWidgets)
            this.session.lineWidgets = new Array(this.session.getLength());
        
        this.session.lineWidgets[w.row] = w;
        
        var renderer = this.editor.renderer;
        if (w.html && !w.el) {
            w.el = dom.createElement("div");
            w.el.innerHTML = w.html;
        }
        if (w.el) {
            dom.addCssClass(w.el, "ace_lineWidgetContainer");
            w.el.style.position = "absolute";
            w.el.style.zIndex = 5;
            renderer.container.appendChild(w.el);
            w._inDocument = true;
        }
        
        if (!w.coverGutter) {
            w.el.style.zIndex = 3;
        }
        if (!w.pixelHeight) {
            w.pixelHeight = w.el.offsetHeight;
        }
        if (w.rowCount == null)
            w.rowCount = w.pixelHeight / renderer.layerConfig.lineHeight;
        
        this.session._emit("changeFold", {data:{start:{row: w.row}}});
        
        this.$updateRows();
        this.renderWidgets(null, renderer);
        return w;
    };
    
    this.removeLineWidget = function(w) {
        w._inDocument = false;
        if (w.el && w.el.parentNode)
            w.el.parentNode.removeChild(w.el);
        if (w.editor && w.editor.destroy) try {
            w.editor.destroy();
        } catch(e){}
        if (this.session.lineWidgets)
            this.session.lineWidgets[w.row] = undefined;
        this.session._emit("changeFold", {data:{start:{row: w.row}}});
        this.$updateRows();
    };
    
    this.onWidgetChanged = function(w) {
        this.session._changedWidgets.push(w);
        this.editor && this.editor.renderer.updateFull();
    };
    
    this.measureWidgets = function(e, renderer) {
        var changedWidgets = this.session._changedWidgets;
        var config = renderer.layerConfig;
        
        if (!changedWidgets || !changedWidgets.length) return;
        var min = Infinity;
        for (var i = 0; i < changedWidgets.length; i++) {
            var w = changedWidgets[i];
            if (!w._inDocument) {
                w._inDocument = true;
                renderer.container.appendChild(w.el);
            }
            
            w.h = w.el.offsetHeight;
            
            if (!w.fixedWidth) {
                w.w = w.el.offsetWidth;
                w.screenWidth = Math.ceil(w.w / config.characterWidth);
            }
            
            var rowCount = w.h / config.lineHeight;
            if (w.coverLine) {
                rowCount -= this.session.getRowLineCount(w.row);
                if (rowCount < 0)
                    rowCount = 0;
            }
            if (w.rowCount != rowCount) {
                w.rowCount = rowCount;
                if (w.row < min)
                    min = w.row;
            }
        }
        if (min != Infinity) {
            this.session._emit("changeFold", {data:{start:{row: min}}});
            this.session.lineWidgetWidth = null;
        }
        this.session._changedWidgets = [];
    };
    
    this.renderWidgets = function(e, renderer) {
        var config = renderer.layerConfig;
        var lineWidgets = this.session.lineWidgets;
        if (!lineWidgets)
            return;
        var first = Math.min(this.firstRow, config.firstRow);
        var last = Math.max(this.lastRow, config.lastRow, lineWidgets.length);
        
        while (first > 0 && !lineWidgets[first])
            first--;
        
        this.firstRow = config.firstRow;
        this.lastRow = config.lastRow;

        renderer.$cursorLayer.config = config;
        for (var i = first; i <= last; i++) {
            var w = lineWidgets[i];
            if (!w || !w.el) continue;

            if (!w._inDocument) {
                w._inDocument = true;
                renderer.container.appendChild(w.el);
            }
            var top = renderer.$cursorLayer.getPixelPosition({row: i, column:0}, true).top;
            if (!w.coverLine)
                top += config.lineHeight * this.session.getRowLineCount(w.row);
            w.el.style.top = top - config.offset + "px";
            
            var left = w.coverGutter ? 0 : renderer.gutterWidth;
            if (!w.fixedWidth)
                left -= renderer.scrollLeft;
            w.el.style.left = left + "px";

            if (w.fixedWidth) {
                w.el.style.right = renderer.scrollBar.getWidth() + "px";
            } else {
                w.el.style.right = "";
            }
        }
    };
    
}).call(LineWidgets.prototype);


exports.LineWidgets = LineWidgets;

});

ace.define('ace/document', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/lib/event_emitter', 'ace/range', 'ace/anchor'], function(require, exports, module) {


var oop = require("./lib/oop");
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var Range = require("./range").Range;
var Anchor = require("./anchor").Anchor;

var Document = function(text) {
    this.$lines = [];
    if (text.length === 0) {
        this.$lines = [""];
    } else if (Array.isArray(text)) {
        this._insertLines(0, text);
    } else {
        this.insert({row: 0, column:0}, text);
    }
};

(function() {

    oop.implement(this, EventEmitter);
    this.setValue = function(text) {
        var len = this.getLength();
        this.remove(new Range(0, 0, len, this.getLine(len-1).length));
        this.insert({row: 0, column:0}, text);
    };
    this.getValue = function() {
        return this.getAllLines().join(this.getNewLineCharacter());
    };
    this.createAnchor = function(row, column) {
        return new Anchor(this, row, column);
    };
    if ("aaa".split(/a/).length === 0)
        this.$split = function(text) {
            return text.replace(/\r\n|\r/g, "\n").split("\n");
        };
    else
        this.$split = function(text) {
            return text.split(/\r\n|\r|\n/);
        };


    this.$detectNewLine = function(text) {
        var match = text.match(/^.*?(\r\n|\r|\n)/m);
        this.$autoNewLine = match ? match[1] : "\n";
        this._signal("changeNewLineMode");
    };
    this.getNewLineCharacter = function() {
        switch (this.$newLineMode) {
          case "windows":
            return "\r\n";
          case "unix":
            return "\n";
          default:
            return this.$autoNewLine || "\n";
        }
    };

    this.$autoNewLine = "";
    this.$newLineMode = "auto";
    this.setNewLineMode = function(newLineMode) {
        if (this.$newLineMode === newLineMode)
            return;

        this.$newLineMode = newLineMode;
        this._signal("changeNewLineMode");
    };
    this.getNewLineMode = function() {
        return this.$newLineMode;
    };
    this.isNewLine = function(text) {
        return (text == "\r\n" || text == "\r" || text == "\n");
    };
    this.getLine = function(row) {
        return this.$lines[row] || "";
    };
    this.getLines = function(firstRow, lastRow) {
        return this.$lines.slice(firstRow, lastRow + 1);
    };
    this.getAllLines = function() {
        return this.getLines(0, this.getLength());
    };
    this.getLength = function() {
        return this.$lines.length;
    };
    this.getTextRange = function(range) {
        if (range.start.row == range.end.row) {
            return this.getLine(range.start.row)
                .substring(range.start.column, range.end.column);
        }
        var lines = this.getLines(range.start.row, range.end.row);
        lines[0] = (lines[0] || "").substring(range.start.column);
        var l = lines.length - 1;
        if (range.end.row - range.start.row == l)
            lines[l] = lines[l].substring(0, range.end.column);
        return lines.join(this.getNewLineCharacter());
    };

    this.$clipPosition = function(position) {
        var length = this.getLength();
        if (position.row >= length) {
            position.row = Math.max(0, length - 1);
            position.column = this.getLine(length-1).length;
        } else if (position.row < 0)
            position.row = 0;
        return position;
    };
    this.insert = function(position, text) {
        if (!text || text.length === 0)
            return position;

        position = this.$clipPosition(position);
        if (this.getLength() <= 1)
            this.$detectNewLine(text);

        var lines = this.$split(text);
        var firstLine = lines.splice(0, 1)[0];
        var lastLine = lines.length == 0 ? null : lines.splice(lines.length - 1, 1)[0];

        position = this.insertInLine(position, firstLine);
        if (lastLine !== null) {
            position = this.insertNewLine(position); // terminate first line
            position = this._insertLines(position.row, lines);
            position = this.insertInLine(position, lastLine || "");
        }
        return position;
    };
    this.insertLines = function(row, lines) {
        if (row >= this.getLength())
            return this.insert({row: row, column: 0}, "\n" + lines.join("\n"));
        return this._insertLines(Math.max(row, 0), lines);
    };
    this._insertLines = function(row, lines) {
        if (lines.length == 0)
            return {row: row, column: 0};
        while (lines.length > 0xF000) {
            var end = this._insertLines(row, lines.slice(0, 0xF000));
            lines = lines.slice(0xF000);
            row = end.row;
        }

        var args = [row, 0];
        args.push.apply(args, lines);
        this.$lines.splice.apply(this.$lines, args);

        var range = new Range(row, 0, row + lines.length, 0);
        var delta = {
            action: "insertLines",
            range: range,
            lines: lines
        };
        this._signal("change", { data: delta });
        return range.end;
    };
    this.insertNewLine = function(position) {
        position = this.$clipPosition(position);
        var line = this.$lines[position.row] || "";

        this.$lines[position.row] = line.substring(0, position.column);
        this.$lines.splice(position.row + 1, 0, line.substring(position.column, line.length));

        var end = {
            row : position.row + 1,
            column : 0
        };

        var delta = {
            action: "insertText",
            range: Range.fromPoints(position, end),
            text: this.getNewLineCharacter()
        };
        this._signal("change", { data: delta });

        return end;
    };
    this.insertInLine = function(position, text) {
        if (text.length == 0)
            return position;

        var line = this.$lines[position.row] || "";

        this.$lines[position.row] = line.substring(0, position.column) + text
                + line.substring(position.column);

        var end = {
            row : position.row,
            column : position.column + text.length
        };

        var delta = {
            action: "insertText",
            range: Range.fromPoints(position, end),
            text: text
        };
        this._signal("change", { data: delta });

        return end;
    };
    this.remove = function(range) {
        if (!(range instanceof Range))
            range = Range.fromPoints(range.start, range.end);
        range.start = this.$clipPosition(range.start);
        range.end = this.$clipPosition(range.end);

        if (range.isEmpty())
            return range.start;

        var firstRow = range.start.row;
        var lastRow = range.end.row;

        if (range.isMultiLine()) {
            var firstFullRow = range.start.column == 0 ? firstRow : firstRow + 1;
            var lastFullRow = lastRow - 1;

            if (range.end.column > 0)
                this.removeInLine(lastRow, 0, range.end.column);

            if (lastFullRow >= firstFullRow)
                this._removeLines(firstFullRow, lastFullRow);

            if (firstFullRow != firstRow) {
                this.removeInLine(firstRow, range.start.column, this.getLine(firstRow).length);
                this.removeNewLine(range.start.row);
            }
        }
        else {
            this.removeInLine(firstRow, range.start.column, range.end.column);
        }
        return range.start;
    };
    this.removeInLine = function(row, startColumn, endColumn) {
        if (startColumn == endColumn)
            return;

        var range = new Range(row, startColumn, row, endColumn);
        var line = this.getLine(row);
        var removed = line.substring(startColumn, endColumn);
        var newLine = line.substring(0, startColumn) + line.substring(endColumn, line.length);
        this.$lines.splice(row, 1, newLine);

        var delta = {
            action: "removeText",
            range: range,
            text: removed
        };
        this._signal("change", { data: delta });
        return range.start;
    };
    this.removeLines = function(firstRow, lastRow) {
        if (firstRow < 0 || lastRow >= this.getLength())
            return this.remove(new Range(firstRow, 0, lastRow + 1, 0));
        return this._removeLines(firstRow, lastRow);
    };

    this._removeLines = function(firstRow, lastRow) {
        var range = new Range(firstRow, 0, lastRow + 1, 0);
        var removed = this.$lines.splice(firstRow, lastRow - firstRow + 1);

        var delta = {
            action: "removeLines",
            range: range,
            nl: this.getNewLineCharacter(),
            lines: removed
        };
        this._signal("change", { data: delta });
        return removed;
    };
    this.removeNewLine = function(row) {
        var firstLine = this.getLine(row);
        var secondLine = this.getLine(row+1);

        var range = new Range(row, firstLine.length, row+1, 0);
        var line = firstLine + secondLine;

        this.$lines.splice(row, 2, line);

        var delta = {
            action: "removeText",
            range: range,
            text: this.getNewLineCharacter()
        };
        this._signal("change", { data: delta });
    };
    this.replace = function(range, text) {
        if (!(range instanceof Range))
            range = Range.fromPoints(range.start, range.end);
        if (text.length == 0 && range.isEmpty())
            return range.start;
        if (text == this.getTextRange(range))
            return range.end;

        this.remove(range);
        if (text) {
            var end = this.insert(range.start, text);
        }
        else {
            end = range.start;
        }

        return end;
    };
    this.applyDeltas = function(deltas) {
        for (var i=0; i<deltas.length; i++) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);

            if (delta.action == "insertLines")
                this.insertLines(range.start.row, delta.lines);
            else if (delta.action == "insertText")
                this.insert(range.start, delta.text);
            else if (delta.action == "removeLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "removeText")
                this.remove(range);
        }
    };
    this.revertDeltas = function(deltas) {
        for (var i=deltas.length-1; i>=0; i--) {
            var delta = deltas[i];

            var range = Range.fromPoints(delta.range.start, delta.range.end);

            if (delta.action == "insertLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "insertText")
                this.remove(range);
            else if (delta.action == "removeLines")
                this._insertLines(range.start.row, delta.lines);
            else if (delta.action == "removeText")
                this.insert(range.start, delta.text);
        }
    };
    this.indexToPosition = function(index, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        for (var i = startRow || 0, l = lines.length; i < l; i++) {
            index -= lines[i].length + newlineLength;
            if (index < 0)
                return {row: i, column: index + lines[i].length + newlineLength};
        }
        return {row: l-1, column: lines[l-1].length};
    };
    this.positionToIndex = function(pos, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        var index = 0;
        var row = Math.min(pos.row, lines.length);
        for (var i = startRow || 0; i < row; ++i)
            index += lines[i].length + newlineLength;

        return index + pos.column;
    };

}).call(Document.prototype);

exports.Document = Document;
});
;
            (function() {
                ace.require(["ace/ace"], function(a) {
                    a && a.config.init(true);
                    if (!window.ace)
                        window.ace = a;
                    for (var key in a) if (a.hasOwnProperty(key))
                        ace[key] = a[key];
                });
            })();
        ;
;
/* module-key = 'bamboo.web.resources:aceEditor', location = '/bower/ace-builds/mode-sh.js' */
/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

ace.define('ace/mode/sh', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/mode/text', 'ace/tokenizer', 'ace/mode/sh_highlight_rules', 'ace/range', 'ace/mode/folding/cstyle'], function(require, exports, module) {


var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var Tokenizer = require("../tokenizer").Tokenizer;
var ShHighlightRules = require("./sh_highlight_rules").ShHighlightRules;
var Range = require("../range").Range;
var CStyleFoldMode = require("./folding/cstyle").FoldMode;

var Mode = function() {
    this.HighlightRules = ShHighlightRules;
    this.foldingRules = new CStyleFoldMode();
};
oop.inherits(Mode, TextMode);

(function() {

   
    this.lineCommentStart = "#";

    this.getNextLineIndent = function(state, line, tab) {
        var indent = this.$getIndent(line);

        var tokenizedLine = this.getTokenizer().getLineTokens(line, state);
        var tokens = tokenizedLine.tokens;

        if (tokens.length && tokens[tokens.length-1].type == "comment") {
            return indent;
        }

        if (state == "start") {
            var match = line.match(/^.*[\{\(\[\:]\s*$/);
            if (match) {
                indent += tab;
            }
        }

        return indent;
    };

    var outdents = {
        "pass": 1,
        "return": 1,
        "raise": 1,
        "break": 1,
        "continue": 1
    };

    this.checkOutdent = function(state, line, input) {
        if (input !== "\r\n" && input !== "\r" && input !== "\n")
            return false;

        var tokens = this.getTokenizer().getLineTokens(line.trim(), state).tokens;

        if (!tokens)
            return false;
        do {
            var last = tokens.pop();
        } while (last && (last.type == "comment" || (last.type == "text" && last.value.match(/^\s+$/))));

        if (!last)
            return false;

        return (last.type == "keyword" && outdents[last.value]);
    };

    this.autoOutdent = function(state, doc, row) {

        row += 1;
        var indent = this.$getIndent(doc.getLine(row));
        var tab = doc.getTabString();
        if (indent.slice(-tab.length) == tab)
            doc.remove(new Range(row, indent.length-tab.length, row, indent.length));
    };

    this.$id = "ace/mode/sh";
}).call(Mode.prototype);

exports.Mode = Mode;
});

ace.define('ace/mode/sh_highlight_rules', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/mode/text_highlight_rules'], function(require, exports, module) {


var oop = require("../lib/oop");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;

var reservedKeywords = exports.reservedKeywords = (
        '!|{|}|case|do|done|elif|else|'+
        'esac|fi|for|if|in|then|until|while|'+
        '&|;|export|local|read|typeset|unset|'+
        'elif|select|set'
    );

var languageConstructs = exports.languageConstructs = (
    '[|]|alias|bg|bind|break|builtin|'+
     'cd|command|compgen|complete|continue|'+
     'dirs|disown|echo|enable|eval|exec|'+
     'exit|fc|fg|getopts|hash|help|history|'+
     'jobs|kill|let|logout|popd|printf|pushd|'+
     'pwd|return|set|shift|shopt|source|'+
     'suspend|test|times|trap|type|ulimit|'+
     'umask|unalias|wait'
);

var ShHighlightRules = function() {
    var keywordMapper = this.createKeywordMapper({
        "keyword": reservedKeywords,
        "support.function.builtin": languageConstructs,
        "invalid.deprecated": "debugger"
    }, "identifier");

    var integer = "(?:(?:[1-9]\\d*)|(?:0))";

    var fraction = "(?:\\.\\d+)";
    var intPart = "(?:\\d+)";
    var pointFloat = "(?:(?:" + intPart + "?" + fraction + ")|(?:" + intPart + "\\.))";
    var exponentFloat = "(?:(?:" + pointFloat + "|" +  intPart + ")" + ")";
    var floatNumber = "(?:" + exponentFloat + "|" + pointFloat + ")";
    var fileDescriptor = "(?:&" + intPart + ")";

    var variableName = "[a-zA-Z][a-zA-Z0-9_]*";
    var variable = "(?:(?:\\$" + variableName + ")|(?:" + variableName + "=))";

    var builtinVariable = "(?:\\$(?:SHLVL|\\$|\\!|\\?))";

    var func = "(?:" + variableName + "\\s*\\(\\))";

    this.$rules = {
        "start" : [{
            token : "constant",
            regex : /\\./
        }, {
            token : ["text", "comment"],
            regex : /(^|\s)(#.*)$/
        }, {
            token : "string",
            regex : '"',
            push : [{
                token : "constant.language.escape",
                regex : /\\(?:[$abeEfnrtv\\'"]|x[a-fA-F\d]{1,2}|u[a-fA-F\d]{4}([a-fA-F\d]{4})?|c.|\d{1,3})/
            }, {
                token : "constant",
                regex : /\$\w+/
            }, {
                token : "string",
                regex : '"',
                next: "pop"
            }, {
                defaultToken: "string"
            }]
        }, {
            token : "variable.language",
            regex : builtinVariable
        }, {
            token : "variable",
            regex : variable
        }, {
            token : "support.function",
            regex : func
        }, {
            token : "support.function",
            regex : fileDescriptor
        }, {
            token : "string",           // ' string
            start : "'", end : "'"
        }, {
            token : "constant.numeric", // float
            regex : floatNumber
        }, {
            token : "constant.numeric", // integer
            regex : integer + "\\b"
        }, {
            token : keywordMapper,
            regex : "[a-zA-Z_$][a-zA-Z0-9_$]*\\b"
        }, {
            token : "keyword.operator",
            regex : "\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|~|<|>|<=|=>|=|!="
        }, {
            token : "paren.lparen",
            regex : "[\\[\\(\\{]"
        }, {
            token : "paren.rparen",
            regex : "[\\]\\)\\}]"
        } ]
    };
    
    this.normalizeRules();
};

oop.inherits(ShHighlightRules, TextHighlightRules);

exports.ShHighlightRules = ShHighlightRules;
});

ace.define('ace/mode/folding/cstyle', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/range', 'ace/mode/folding/fold_mode'], function(require, exports, module) {


var oop = require("../../lib/oop");
var Range = require("../../range").Range;
var BaseFoldMode = require("./fold_mode").FoldMode;

var FoldMode = exports.FoldMode = function(commentRegex) {
    if (commentRegex) {
        this.foldingStartMarker = new RegExp(
            this.foldingStartMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.start)
        );
        this.foldingStopMarker = new RegExp(
            this.foldingStopMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.end)
        );
    }
};
oop.inherits(FoldMode, BaseFoldMode);

(function() {

    this.foldingStartMarker = /(\{|\[)[^\}\]]*$|^\s*(\/\*)/;
    this.foldingStopMarker = /^[^\[\{]*(\}|\])|^[\s\*]*(\*\/)/;

    this.getFoldWidgetRange = function(session, foldStyle, row, forceMultiline) {
        var line = session.getLine(row);
        var match = line.match(this.foldingStartMarker);
        if (match) {
            var i = match.index;

            if (match[1])
                return this.openingBracketBlock(session, match[1], row, i);
                
            var range = session.getCommentFoldRange(row, i + match[0].length, 1);
            
            if (range && !range.isMultiLine()) {
                if (forceMultiline) {
                    range = this.getSectionRange(session, row);
                } else if (foldStyle != "all")
                    range = null;
            }
            
            return range;
        }

        if (foldStyle === "markbegin")
            return;

        var match = line.match(this.foldingStopMarker);
        if (match) {
            var i = match.index + match[0].length;

            if (match[1])
                return this.closingBracketBlock(session, match[1], row, i);

            return session.getCommentFoldRange(row, i, -1);
        }
    };
    
    this.getSectionRange = function(session, row) {
        var line = session.getLine(row);
        var startIndent = line.search(/\S/);
        var startRow = row;
        var startColumn = line.length;
        row = row + 1;
        var endRow = row;
        var maxRow = session.getLength();
        while (++row < maxRow) {
            line = session.getLine(row);
            var indent = line.search(/\S/);
            if (indent === -1)
                continue;
            if  (startIndent > indent)
                break;
            var subRange = this.getFoldWidgetRange(session, "all", row);
            
            if (subRange) {
                if (subRange.start.row <= startRow) {
                    break;
                } else if (subRange.isMultiLine()) {
                    row = subRange.end.row;
                } else if (startIndent == indent) {
                    break;
                }
            }
            endRow = row;
        }
        
        return new Range(startRow, startColumn, endRow, session.getLine(endRow).length);
    };

}).call(FoldMode.prototype);

});
;
;
/* module-key = 'bamboo.web.resources:aceEditor', location = '/bower/ace-builds/mode-powershell.js' */
ace.define('ace/mode/powershell', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/mode/text', 'ace/tokenizer', 'ace/mode/powershell_highlight_rules', 'ace/mode/matching_brace_outdent', 'ace/mode/behaviour/cstyle', 'ace/mode/folding/cstyle'], function(require, exports, module) {


var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var Tokenizer = require("../tokenizer").Tokenizer;
var PowershellHighlightRules = require("./powershell_highlight_rules").PowershellHighlightRules;
var MatchingBraceOutdent = require("./matching_brace_outdent").MatchingBraceOutdent;
var CstyleBehaviour = require("./behaviour/cstyle").CstyleBehaviour;
var CStyleFoldMode = require("./folding/cstyle").FoldMode;

var Mode = function() {
    this.HighlightRules = PowershellHighlightRules;
    this.$outdent = new MatchingBraceOutdent();
    this.$behaviour = new CstyleBehaviour();
    this.foldingRules = new CStyleFoldMode({start: "^\\s*(<#)", end: "^[#\\s]>\\s*$"});
};
oop.inherits(Mode, TextMode);

(function() {

    this.lineCommentStart = "#";
    this.blockComment = {start: "<#", end: "#>"};
    
    this.getNextLineIndent = function(state, line, tab) {
        var indent = this.$getIndent(line);

        var tokenizedLine = this.getTokenizer().getLineTokens(line, state);
        var tokens = tokenizedLine.tokens;

        if (tokens.length && tokens[tokens.length-1].type == "comment") {
            return indent;
        }
      
        if (state == "start") {
            var match = line.match(/^.*[\{\(\[]\s*$/);
            if (match) {
                indent += tab;
            }
        }

        return indent;
    };

    this.checkOutdent = function(state, line, input) {
        return this.$outdent.checkOutdent(line, input);
    };

    this.autoOutdent = function(state, doc, row) {
        this.$outdent.autoOutdent(doc, row);
    };


    this.createWorker = function(session) {
        return null;
    };

    this.$id = "ace/mode/powershell";
}).call(Mode.prototype);

exports.Mode = Mode;
});
ace.define('ace/mode/powershell_highlight_rules', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/mode/text_highlight_rules'], function(require, exports, module) {


var oop = require("../lib/oop");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;

var PowershellHighlightRules = function() {

    var keywords = (
      "function|if|else|elseif|switch|while|default|for|do|until|break|continue|" +
       "foreach|return|filter|in|trap|throw|param|begin|process|end"
    );

    var builtinFunctions = (
      "Get-Alias|Import-Alias|New-Alias|Set-Alias|Get-AuthenticodeSignature|Set-AuthenticodeSignature|" +
       "Set-Location|Get-ChildItem|Clear-Item|Get-Command|Measure-Command|Trace-Command|" +
       "Add-Computer|Checkpoint-Computer|Remove-Computer|Restart-Computer|Restore-Computer|Stop-Computer|" +
       "Reset-ComputerMachinePassword|Test-ComputerSecureChannel|Add-Content|Get-Content|Set-Content|Clear-Content|" +
       "Get-Command|Invoke-Command|Enable-ComputerRestore|Disable-ComputerRestore|Get-ComputerRestorePoint|Test-Connection|" +
       "ConvertFrom-CSV|ConvertTo-CSV|ConvertTo-Html|ConvertTo-Xml|ConvertFrom-SecureString|ConvertTo-SecureString|" +
       "Copy-Item|Export-Counter|Get-Counter|Import-Counter|Get-Credential|Get-Culture|" +
       "Get-ChildItem|Get-Date|Set-Date|Remove-Item|Compare-Object|Get-Event|" +
       "Get-WinEvent|New-Event|Remove-Event|Unregister-Event|Wait-Event|Clear-EventLog|" +
       "Get-Eventlog|Limit-EventLog|New-Eventlog|Remove-EventLog|Show-EventLog|Write-EventLog|" +
       "Get-EventSubscriber|Register-EngineEvent|Register-ObjectEvent|Register-WmiEvent|Get-ExecutionPolicy|Set-ExecutionPolicy|" +
       "Export-Alias|Export-Clixml|Export-Console|Export-Csv|ForEach-Object|Format-Custom|" +
       "Format-List|Format-Table|Format-Wide|Export-FormatData|Get-FormatData|Get-Item|" +
       "Get-ChildItem|Get-Help|Add-History|Clear-History|Get-History|Invoke-History|" +
       "Get-Host|Read-Host|Write-Host|Get-HotFix|Import-Clixml|Import-Csv|" +
       "Invoke-Command|Invoke-Expression|Get-Item|Invoke-Item|New-Item|Remove-Item|" +
       "Set-Item|Clear-ItemProperty|Copy-ItemProperty|Get-ItemProperty|Move-ItemProperty|New-ItemProperty|" +
       "Remove-ItemProperty|Rename-ItemProperty|Set-ItemProperty|Get-Job|Receive-Job|Remove-Job|" +
       "Start-Job|Stop-Job|Wait-Job|Stop-Process|Update-List|Get-Location|" +
       "Pop-Location|Push-Location|Set-Location|Send-MailMessage|Add-Member|Get-Member|" +
       "Move-Item|Compare-Object|Group-Object|Measure-Object|New-Object|Select-Object|" +
       "Sort-Object|Where-Object|Out-Default|Out-File|Out-GridView|Out-Host|" +
       "Out-Null|Out-Printer|Out-String|Convert-Path|Join-Path|Resolve-Path|" +
       "Split-Path|Test-Path|Get-Pfxcertificate|Pop-Location|Push-Location|Get-Process|" +
       "Start-Process|Stop-Process|Wait-Process|Enable-PSBreakpoint|Disable-PSBreakpoint|Get-PSBreakpoint|" +
       "Set-PSBreakpoint|Remove-PSBreakpoint|Get-PSDrive|New-PSDrive|Remove-PSDrive|Get-PSProvider|" +
       "Set-PSdebug|Enter-PSSession|Exit-PSSession|Export-PSSession|Get-PSSession|Import-PSSession|" +
       "New-PSSession|Remove-PSSession|Disable-PSSessionConfiguration|Enable-PSSessionConfiguration|Get-PSSessionConfiguration|Register-PSSessionConfiguration|" +
       "Set-PSSessionConfiguration|Unregister-PSSessionConfiguration|New-PSSessionOption|Add-PsSnapIn|Get-PsSnapin|Remove-PSSnapin|" +
       "Get-Random|Read-Host|Remove-Item|Rename-Item|Rename-ItemProperty|Select-Object|" +
       "Select-XML|Send-MailMessage|Get-Service|New-Service|Restart-Service|Resume-Service|" +
       "Set-Service|Start-Service|Stop-Service|Suspend-Service|Sort-Object|Start-Sleep|" +
       "ConvertFrom-StringData|Select-String|Tee-Object|New-Timespan|Trace-Command|Get-Tracesource|" +
       "Set-Tracesource|Start-Transaction|Complete-Transaction|Get-Transaction|Use-Transaction|Undo-Transaction|" +
       "Start-Transcript|Stop-Transcript|Add-Type|Update-TypeData|Get-Uiculture|Get-Unique|" +
       "Update-Formatdata|Update-Typedata|Clear-Variable|Get-Variable|New-Variable|Remove-Variable|" +
       "Set-Variable|New-WebServiceProxy|Where-Object|Write-Debug|Write-Error|Write-Host|" +
       "Write-Output|Write-Progress|Write-Verbose|Write-Warning|Set-WmiInstance|Invoke-WmiMethod|" +
       "Get-WmiObject|Remove-WmiObject|Connect-WSMan|Disconnect-WSMan|Test-WSMan|Invoke-WSManAction|" +
       "Disable-WSManCredSSP|Enable-WSManCredSSP|Get-WSManCredSSP|New-WSManInstance|Get-WSManInstance|Set-WSManInstance|" +
       "Remove-WSManInstance|Set-WSManQuickConfig|New-WSManSessionOption"
       );

    var keywordMapper = this.createKeywordMapper({
        "support.function": builtinFunctions,
        "keyword": keywords
    }, "identifier");

    var binaryOperatorsRe = "eq|ne|ge|gt|lt|le|like|notlike|match|notmatch|replace|contains|notcontains|" +
                            "ieq|ine|ige|igt|ile|ilt|ilike|inotlike|imatch|inotmatch|ireplace|icontains|inotcontains|" +
                            "is|isnot|as|" +
                            "and|or|band|bor|not";

    this.$rules = {
        "start" : [
            {
                token : "comment",
                regex : "#.*$"
            }, {
                token : "comment.start",
                regex : "<#",
                next : "comment"
            }, {
                token : "string", // single line
                regex : '["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'
            }, {
                token : "string", // single line
                regex : "['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"
            }, {
                token : "constant.numeric", // hex
                regex : "0[xX][0-9a-fA-F]+\\b"
            }, {
                token : "constant.numeric", // float
                regex : "[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"
            }, {
                token : "constant.language.boolean",
                regex : "[$](?:[Tt]rue|[Ff]alse)\\b"
            }, {
                token : "constant.language",
                regex : "[$][Nn]ull\\b"
            }, {
                token : "variable.instance",
                regex : "[$][a-zA-Z][a-zA-Z0-9_]*\\b"
            }, {
                token : keywordMapper,
                regex : "[a-zA-Z_$][a-zA-Z0-9_$\\-]*\\b"
            }, {
                token : "keyword.operator",
                regex : "\\-(?:" + binaryOperatorsRe + ")"
            }, {
                token : "keyword.operator",
                regex : "&|\\*|\\+|\\-|\\=|\\+=|\\-="
            }, {
                token : "lparen",
                regex : "[[({]"
            }, {
                token : "rparen",
                regex : "[\\])}]"
            }, {
                token : "text",
                regex : "\\s+"
            }
        ],
        "comment" : [
            {
                token : "comment.end",
                regex : "#>",
                next : "start"
            }, {
                token : "doc.comment.tag",
                regex : "^\\.\\w+"
            }, {
                token : "comment",
                regex : "\\w+"
            }, {
                token : "comment",
                regex : "."
            }
        ]
    };
};

oop.inherits(PowershellHighlightRules, TextHighlightRules);

exports.PowershellHighlightRules = PowershellHighlightRules;
});

ace.define('ace/mode/matching_brace_outdent', ['require', 'exports', 'module' , 'ace/range'], function(require, exports, module) {


var Range = require("../range").Range;

var MatchingBraceOutdent = function() {};

(function() {

    this.checkOutdent = function(line, input) {
        if (! /^\s+$/.test(line))
            return false;

        return /^\s*\}/.test(input);
    };

    this.autoOutdent = function(doc, row) {
        var line = doc.getLine(row);
        var match = line.match(/^(\s*\})/);

        if (!match) return 0;

        var column = match[1].length;
        var openBracePos = doc.findMatchingBracket({row: row, column: column});

        if (!openBracePos || openBracePos.row == row) return 0;

        var indent = this.$getIndent(doc.getLine(openBracePos.row));
        doc.replace(new Range(row, 0, row, column-1), indent);
    };

    this.$getIndent = function(line) {
        return line.match(/^\s*/)[0];
    };

}).call(MatchingBraceOutdent.prototype);

exports.MatchingBraceOutdent = MatchingBraceOutdent;
});

ace.define('ace/mode/behaviour/cstyle', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/mode/behaviour', 'ace/token_iterator', 'ace/lib/lang'], function(require, exports, module) {


var oop = require("../../lib/oop");
var Behaviour = require("../behaviour").Behaviour;
var TokenIterator = require("../../token_iterator").TokenIterator;
var lang = require("../../lib/lang");

var SAFE_INSERT_IN_TOKENS =
    ["text", "paren.rparen", "punctuation.operator"];
var SAFE_INSERT_BEFORE_TOKENS =
    ["text", "paren.rparen", "punctuation.operator", "comment"];

var context;
var contextCache = {}
var initContext = function(editor) {
    var id = -1;
    if (editor.multiSelect) {
        id = editor.selection.id;
        if (contextCache.rangeCount != editor.multiSelect.rangeCount)
            contextCache = {rangeCount: editor.multiSelect.rangeCount};
    }
    if (contextCache[id])
        return context = contextCache[id];
    context = contextCache[id] = {
        autoInsertedBrackets: 0,
        autoInsertedRow: -1,
        autoInsertedLineEnd: "",
        maybeInsertedBrackets: 0,
        maybeInsertedRow: -1,
        maybeInsertedLineStart: "",
        maybeInsertedLineEnd: ""
    };
};

var CstyleBehaviour = function() {
    this.add("braces", "insertion", function(state, action, editor, session, text) {
        var cursor = editor.getCursorPosition();
        var line = session.doc.getLine(cursor.row);
        if (text == '{') {
            initContext(editor);
            var selection = editor.getSelectionRange();
            var selected = session.doc.getTextRange(selection);
            if (selected !== "" && selected !== "{" && editor.getWrapBehavioursEnabled()) {
                return {
                    text: '{' + selected + '}',
                    selection: false
                };
            } else if (CstyleBehaviour.isSaneInsertion(editor, session)) {
                if (/[\]\}\)]/.test(line[cursor.column]) || editor.inMultiSelectMode) {
                    CstyleBehaviour.recordAutoInsert(editor, session, "}");
                    return {
                        text: '{}',
                        selection: [1, 1]
                    };
                } else {
                    CstyleBehaviour.recordMaybeInsert(editor, session, "{");
                    return {
                        text: '{',
                        selection: [1, 1]
                    };
                }
            }
        } else if (text == '}') {
            initContext(editor);
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar == '}') {
                var matching = session.$findOpeningBracket('}', {column: cursor.column + 1, row: cursor.row});
                if (matching !== null && CstyleBehaviour.isAutoInsertedClosing(cursor, line, text)) {
                    CstyleBehaviour.popAutoInsertedClosing();
                    return {
                        text: '',
                        selection: [1, 1]
                    };
                }
            }
        } else if (text == "\n" || text == "\r\n") {
            initContext(editor);
            var closing = "";
            if (CstyleBehaviour.isMaybeInsertedClosing(cursor, line)) {
                closing = lang.stringRepeat("}", context.maybeInsertedBrackets);
                CstyleBehaviour.clearMaybeInsertedClosing();
            }
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar === '}') {
                var openBracePos = session.findMatchingBracket({row: cursor.row, column: cursor.column+1}, '}');
                if (!openBracePos)
                     return null;
                var next_indent = this.$getIndent(session.getLine(openBracePos.row));
            } else if (closing) {
                var next_indent = this.$getIndent(line);
            } else {
                CstyleBehaviour.clearMaybeInsertedClosing();
                return;
            }
            var indent = next_indent + session.getTabString();

            return {
                text: '\n' + indent + '\n' + next_indent + closing,
                selection: [1, indent.length, 1, indent.length]
            };
        } else {
            CstyleBehaviour.clearMaybeInsertedClosing();
        }
    });

    this.add("braces", "deletion", function(state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && selected == '{') {
            initContext(editor);
            var line = session.doc.getLine(range.start.row);
            var rightChar = line.substring(range.end.column, range.end.column + 1);
            if (rightChar == '}') {
                range.end.column++;
                return range;
            } else {
                context.maybeInsertedBrackets--;
            }
        }
    });

    this.add("parens", "insertion", function(state, action, editor, session, text) {
        if (text == '(') {
            initContext(editor);
            var selection = editor.getSelectionRange();
            var selected = session.doc.getTextRange(selection);
            if (selected !== "" && editor.getWrapBehavioursEnabled()) {
                return {
                    text: '(' + selected + ')',
                    selection: false
                };
            } else if (CstyleBehaviour.isSaneInsertion(editor, session)) {
                CstyleBehaviour.recordAutoInsert(editor, session, ")");
                return {
                    text: '()',
                    selection: [1, 1]
                };
            }
        } else if (text == ')') {
            initContext(editor);
            var cursor = editor.getCursorPosition();
            var line = session.doc.getLine(cursor.row);
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar == ')') {
                var matching = session.$findOpeningBracket(')', {column: cursor.column + 1, row: cursor.row});
                if (matching !== null && CstyleBehaviour.isAutoInsertedClosing(cursor, line, text)) {
                    CstyleBehaviour.popAutoInsertedClosing();
                    return {
                        text: '',
                        selection: [1, 1]
                    };
                }
            }
        }
    });

    this.add("parens", "deletion", function(state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && selected == '(') {
            initContext(editor);
            var line = session.doc.getLine(range.start.row);
            var rightChar = line.substring(range.start.column + 1, range.start.column + 2);
            if (rightChar == ')') {
                range.end.column++;
                return range;
            }
        }
    });

    this.add("brackets", "insertion", function(state, action, editor, session, text) {
        if (text == '[') {
            initContext(editor);
            var selection = editor.getSelectionRange();
            var selected = session.doc.getTextRange(selection);
            if (selected !== "" && editor.getWrapBehavioursEnabled()) {
                return {
                    text: '[' + selected + ']',
                    selection: false
                };
            } else if (CstyleBehaviour.isSaneInsertion(editor, session)) {
                CstyleBehaviour.recordAutoInsert(editor, session, "]");
                return {
                    text: '[]',
                    selection: [1, 1]
                };
            }
        } else if (text == ']') {
            initContext(editor);
            var cursor = editor.getCursorPosition();
            var line = session.doc.getLine(cursor.row);
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar == ']') {
                var matching = session.$findOpeningBracket(']', {column: cursor.column + 1, row: cursor.row});
                if (matching !== null && CstyleBehaviour.isAutoInsertedClosing(cursor, line, text)) {
                    CstyleBehaviour.popAutoInsertedClosing();
                    return {
                        text: '',
                        selection: [1, 1]
                    };
                }
            }
        }
    });

    this.add("brackets", "deletion", function(state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && selected == '[') {
            initContext(editor);
            var line = session.doc.getLine(range.start.row);
            var rightChar = line.substring(range.start.column + 1, range.start.column + 2);
            if (rightChar == ']') {
                range.end.column++;
                return range;
            }
        }
    });

    this.add("string_dquotes", "insertion", function(state, action, editor, session, text) {
        if (text == '"' || text == "'") {
            initContext(editor);
            var quote = text;
            var selection = editor.getSelectionRange();
            var selected = session.doc.getTextRange(selection);
            if (selected !== "" && selected !== "'" && selected != '"' && editor.getWrapBehavioursEnabled()) {
                return {
                    text: quote + selected + quote,
                    selection: false
                };
            } else {
                var cursor = editor.getCursorPosition();
                var line = session.doc.getLine(cursor.row);
                var leftChar = line.substring(cursor.column-1, cursor.column);
                if (leftChar == '\\') {
                    return null;
                }
                var tokens = session.getTokens(selection.start.row);
                var col = 0, token;
                var quotepos = -1; // Track whether we're inside an open quote.

                for (var x = 0; x < tokens.length; x++) {
                    token = tokens[x];
                    if (token.type == "string") {
                      quotepos = -1;
                    } else if (quotepos < 0) {
                      quotepos = token.value.indexOf(quote);
                    }
                    if ((token.value.length + col) > selection.start.column) {
                        break;
                    }
                    col += tokens[x].value.length;
                }
                if (!token || (quotepos < 0 && token.type !== "comment" && (token.type !== "string" || ((selection.start.column !== token.value.length+col-1) && token.value.lastIndexOf(quote) === token.value.length-1)))) {
                    if (!CstyleBehaviour.isSaneInsertion(editor, session))
                        return;
                    return {
                        text: quote + quote,
                        selection: [1,1]
                    };
                } else if (token && token.type === "string") {
                    var rightChar = line.substring(cursor.column, cursor.column + 1);
                    if (rightChar == quote) {
                        return {
                            text: '',
                            selection: [1, 1]
                        };
                    }
                }
            }
        }
    });

    this.add("string_dquotes", "deletion", function(state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && (selected == '"' || selected == "'")) {
            initContext(editor);
            var line = session.doc.getLine(range.start.row);
            var rightChar = line.substring(range.start.column + 1, range.start.column + 2);
            if (rightChar == selected) {
                range.end.column++;
                return range;
            }
        }
    });

};

    
CstyleBehaviour.isSaneInsertion = function(editor, session) {
    var cursor = editor.getCursorPosition();
    var iterator = new TokenIterator(session, cursor.row, cursor.column);
    if (!this.$matchTokenType(iterator.getCurrentToken() || "text", SAFE_INSERT_IN_TOKENS)) {
        var iterator2 = new TokenIterator(session, cursor.row, cursor.column + 1);
        if (!this.$matchTokenType(iterator2.getCurrentToken() || "text", SAFE_INSERT_IN_TOKENS))
            return false;
    }
    iterator.stepForward();
    return iterator.getCurrentTokenRow() !== cursor.row ||
        this.$matchTokenType(iterator.getCurrentToken() || "text", SAFE_INSERT_BEFORE_TOKENS);
};

CstyleBehaviour.$matchTokenType = function(token, types) {
    return types.indexOf(token.type || token) > -1;
};

CstyleBehaviour.recordAutoInsert = function(editor, session, bracket) {
    var cursor = editor.getCursorPosition();
    var line = session.doc.getLine(cursor.row);
    if (!this.isAutoInsertedClosing(cursor, line, context.autoInsertedLineEnd[0]))
        context.autoInsertedBrackets = 0;
    context.autoInsertedRow = cursor.row;
    context.autoInsertedLineEnd = bracket + line.substr(cursor.column);
    context.autoInsertedBrackets++;
};

CstyleBehaviour.recordMaybeInsert = function(editor, session, bracket) {
    var cursor = editor.getCursorPosition();
    var line = session.doc.getLine(cursor.row);
    if (!this.isMaybeInsertedClosing(cursor, line))
        context.maybeInsertedBrackets = 0;
    context.maybeInsertedRow = cursor.row;
    context.maybeInsertedLineStart = line.substr(0, cursor.column) + bracket;
    context.maybeInsertedLineEnd = line.substr(cursor.column);
    context.maybeInsertedBrackets++;
};

CstyleBehaviour.isAutoInsertedClosing = function(cursor, line, bracket) {
    return context.autoInsertedBrackets > 0 &&
        cursor.row === context.autoInsertedRow &&
        bracket === context.autoInsertedLineEnd[0] &&
        line.substr(cursor.column) === context.autoInsertedLineEnd;
};

CstyleBehaviour.isMaybeInsertedClosing = function(cursor, line) {
    return context.maybeInsertedBrackets > 0 &&
        cursor.row === context.maybeInsertedRow &&
        line.substr(cursor.column) === context.maybeInsertedLineEnd &&
        line.substr(0, cursor.column) == context.maybeInsertedLineStart;
};

CstyleBehaviour.popAutoInsertedClosing = function() {
    context.autoInsertedLineEnd = context.autoInsertedLineEnd.substr(1);
    context.autoInsertedBrackets--;
};

CstyleBehaviour.clearMaybeInsertedClosing = function() {
    if (context) {
        context.maybeInsertedBrackets = 0;
        context.maybeInsertedRow = -1;
    }
};



oop.inherits(CstyleBehaviour, Behaviour);

exports.CstyleBehaviour = CstyleBehaviour;
});

ace.define('ace/mode/folding/cstyle', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/range', 'ace/mode/folding/fold_mode'], function(require, exports, module) {


var oop = require("../../lib/oop");
var Range = require("../../range").Range;
var BaseFoldMode = require("./fold_mode").FoldMode;

var FoldMode = exports.FoldMode = function(commentRegex) {
    if (commentRegex) {
        this.foldingStartMarker = new RegExp(
            this.foldingStartMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.start)
        );
        this.foldingStopMarker = new RegExp(
            this.foldingStopMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.end)
        );
    }
};
oop.inherits(FoldMode, BaseFoldMode);

(function() {

    this.foldingStartMarker = /(\{|\[)[^\}\]]*$|^\s*(\/\*)/;
    this.foldingStopMarker = /^[^\[\{]*(\}|\])|^[\s\*]*(\*\/)/;

    this.getFoldWidgetRange = function(session, foldStyle, row, forceMultiline) {
        var line = session.getLine(row);
        var match = line.match(this.foldingStartMarker);
        if (match) {
            var i = match.index;

            if (match[1])
                return this.openingBracketBlock(session, match[1], row, i);
                
            var range = session.getCommentFoldRange(row, i + match[0].length, 1);
            
            if (range && !range.isMultiLine()) {
                if (forceMultiline) {
                    range = this.getSectionRange(session, row);
                } else if (foldStyle != "all")
                    range = null;
            }
            
            return range;
        }

        if (foldStyle === "markbegin")
            return;

        var match = line.match(this.foldingStopMarker);
        if (match) {
            var i = match.index + match[0].length;

            if (match[1])
                return this.closingBracketBlock(session, match[1], row, i);

            return session.getCommentFoldRange(row, i, -1);
        }
    };
    
    this.getSectionRange = function(session, row) {
        var line = session.getLine(row);
        var startIndent = line.search(/\S/);
        var startRow = row;
        var startColumn = line.length;
        row = row + 1;
        var endRow = row;
        var maxRow = session.getLength();
        while (++row < maxRow) {
            line = session.getLine(row);
            var indent = line.search(/\S/);
            if (indent === -1)
                continue;
            if  (startIndent > indent)
                break;
            var subRange = this.getFoldWidgetRange(session, "all", row);
            
            if (subRange) {
                if (subRange.start.row <= startRow) {
                    break;
                } else if (subRange.isMultiLine()) {
                    row = subRange.end.row;
                } else if (startIndent == indent) {
                    break;
                }
            }
            endRow = row;
        }
        
        return new Range(startRow, startColumn, endRow, session.getLine(endRow).length);
    };

}).call(FoldMode.prototype);

});
;
;
/* module-key = 'bamboo.web.resources:aceEditor', location = '/bower/ace-builds/mode-yaml.js' */
/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

ace.define('ace/mode/yaml', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/mode/text', 'ace/tokenizer', 'ace/mode/yaml_highlight_rules', 'ace/mode/matching_brace_outdent', 'ace/mode/folding/coffee'], function(require, exports, module) {


var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var Tokenizer = require("../tokenizer").Tokenizer;
var YamlHighlightRules = require("./yaml_highlight_rules").YamlHighlightRules;
var MatchingBraceOutdent = require("./matching_brace_outdent").MatchingBraceOutdent;
var FoldMode = require("./folding/coffee").FoldMode;

var Mode = function() {
    this.HighlightRules = YamlHighlightRules;
    this.$outdent = new MatchingBraceOutdent();
    this.foldingRules = new FoldMode();
};
oop.inherits(Mode, TextMode);

(function() {

    this.lineCommentStart = "#";
    
    this.getNextLineIndent = function(state, line, tab) {
        var indent = this.$getIndent(line);

        if (state == "start") {
            var match = line.match(/^.*[\{\(\[]\s*$/);
            if (match) {
                indent += tab;
            }
        }

        return indent;
    };

    this.checkOutdent = function(state, line, input) {
        return this.$outdent.checkOutdent(line, input);
    };

    this.autoOutdent = function(state, doc, row) {
        this.$outdent.autoOutdent(doc, row);
    };


    this.$id = "ace/mode/yaml";
}).call(Mode.prototype);

exports.Mode = Mode;

});

ace.define('ace/mode/yaml_highlight_rules', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/mode/text_highlight_rules'], function(require, exports, module) {


var oop = require("../lib/oop");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;

var YamlHighlightRules = function() {
    this.$rules = {
        "start" : [
            {
                token : "comment",
                regex : "#.*$"
            }, {
                token : "list.markup",
                regex : /^(?:-{3}|\.{3})\s*(?=#|$)/     
            },  {
                token : "list.markup",
                regex : /^\s*[\-?](?:$|\s)/     
            }, {
                token: "constant",
                regex: "!![\\w//]+"
            }, {
                token: "constant.language",
                regex: "[&\\*][a-zA-Z0-9-_]+"
            }, {
                token: ["meta.tag", "keyword"],
                regex: /^(\s*\w.*?)(\:(?:\s+|$))/
            },{
                token: ["meta.tag", "keyword"],
                regex: /(\w+?)(\s*\:(?:\s+|$))/
            }, {
                token : "keyword.operator",
                regex : "<<\\w*:\\w*"
            }, {
                token : "keyword.operator",
                regex : "-\\s*(?=[{])"
            }, {
                token : "string", // single line
                regex : '["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'
            }, {
                token : "string", // multi line string start
                regex : '[|>][-+\\d\\s]*$',
                next : "qqstring"
            }, {
                token : "string", // single quoted string
                regex : "['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"
            }, {
                token : "constant.numeric", // float
                regex : /[+\-]?[\d_]+(?:(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?\b/
            }, {
                token : "constant.numeric", // other number
                regex : /[+\-]?\.inf\b|NaN\b|0x[\dA-Fa-f_]+|0b[10_]+/
            }, {
                token : "constant.language.boolean",
                regex : "(?:true|false|TRUE|FALSE|True|False|yes|no)\\b"
            }, {
                token : "paren.lparen",
                regex : "[[({]"
            }, {
                token : "paren.rparen",
                regex : "[\\])}]"
            }
        ],
        "qqstring" : [
            {
                token : "string",
                regex : '(?=(?:(?:\\\\.)|(?:[^:]))*?:)',
                next : "start"
            }, {
                token : "string",
                regex : '.+'
            }
        ]};

};

oop.inherits(YamlHighlightRules, TextHighlightRules);

exports.YamlHighlightRules = YamlHighlightRules;
});

ace.define('ace/mode/matching_brace_outdent', ['require', 'exports', 'module' , 'ace/range'], function(require, exports, module) {


var Range = require("../range").Range;

var MatchingBraceOutdent = function() {};

(function() {

    this.checkOutdent = function(line, input) {
        if (! /^\s+$/.test(line))
            return false;

        return /^\s*\}/.test(input);
    };

    this.autoOutdent = function(doc, row) {
        var line = doc.getLine(row);
        var match = line.match(/^(\s*\})/);

        if (!match) return 0;

        var column = match[1].length;
        var openBracePos = doc.findMatchingBracket({row: row, column: column});

        if (!openBracePos || openBracePos.row == row) return 0;

        var indent = this.$getIndent(doc.getLine(openBracePos.row));
        doc.replace(new Range(row, 0, row, column-1), indent);
    };

    this.$getIndent = function(line) {
        return line.match(/^\s*/)[0];
    };

}).call(MatchingBraceOutdent.prototype);

exports.MatchingBraceOutdent = MatchingBraceOutdent;
});

ace.define('ace/mode/folding/coffee', ['require', 'exports', 'module' , 'ace/lib/oop', 'ace/mode/folding/fold_mode', 'ace/range'], function(require, exports, module) {


var oop = require("../../lib/oop");
var BaseFoldMode = require("./fold_mode").FoldMode;
var Range = require("../../range").Range;

var FoldMode = exports.FoldMode = function() {};
oop.inherits(FoldMode, BaseFoldMode);

(function() {

    this.getFoldWidgetRange = function(session, foldStyle, row) {
        var range = this.indentationBlock(session, row);
        if (range)
            return range;

        var re = /\S/;
        var line = session.getLine(row);
        var startLevel = line.search(re);
        if (startLevel == -1 || line[startLevel] != "#")
            return;

        var startColumn = line.length;
        var maxRow = session.getLength();
        var startRow = row;
        var endRow = row;

        while (++row < maxRow) {
            line = session.getLine(row);
            var level = line.search(re);

            if (level == -1)
                continue;

            if (line[level] != "#")
                break;

            endRow = row;
        }

        if (endRow > startRow) {
            var endColumn = session.getLine(endRow).length;
            return new Range(startRow, startColumn, endRow, endColumn);
        }
    };
    this.getFoldWidget = function(session, foldStyle, row) {
        var line = session.getLine(row);
        var indent = line.search(/\S/);
        var next = session.getLine(row + 1);
        var prev = session.getLine(row - 1);
        var prevIndent = prev.search(/\S/);
        var nextIndent = next.search(/\S/);

        if (indent == -1) {
            session.foldWidgets[row - 1] = prevIndent!= -1 && prevIndent < nextIndent ? "start" : "";
            return "";
        }
        if (prevIndent == -1) {
            if (indent == nextIndent && line[indent] == "#" && next[indent] == "#") {
                session.foldWidgets[row - 1] = "";
                session.foldWidgets[row + 1] = "";
                return "start";
            }
        } else if (prevIndent == indent && line[indent] == "#" && prev[indent] == "#") {
            if (session.getLine(row - 2).search(/\S/) == -1) {
                session.foldWidgets[row - 1] = "start";
                session.foldWidgets[row + 1] = "";
                return "";
            }
        }

        if (prevIndent!= -1 && prevIndent < indent)
            session.foldWidgets[row - 1] = "start";
        else
            session.foldWidgets[row - 1] = "";

        if (indent < nextIndent)
            return "start";
        else
            return "";
    };

}).call(FoldMode.prototype);

});
;
;
/* module-key = 'bamboo.deployments:linked-deployment-shortcut', location = '/feature/plan/linked-deployment/linked-deployment-shortcut.soy' */
// This file was automatically generated from linked-deployment-shortcut.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace feature.plan.linkedDeployment.
 */

if (typeof feature == 'undefined') { var feature = {}; }
if (typeof feature.plan == 'undefined') { feature.plan = {}; }
if (typeof feature.plan.linkedDeployment == 'undefined') { feature.plan.linkedDeployment = {}; }


feature.plan.linkedDeployment.linkedDeploymentHeaderDropdown = function(opt_data, opt_ignored) {
  return '' + ((opt_data.hasLinkedDeployments) ? aui.buttons.buttons({content: '' + aui.buttons.button({text: '', tagName: 'a', iconType: 'aui', iconClass: 'aui-icon-small aui-iconfont-deploy', extraAttributes: {title: "Related deployment projects", 'data-plan-key': opt_data.immutablePlan.planKey.key}, extraClasses: 'linked-deployments-menu'})}) + feature.plan.linkedDeployment.linkedDeploymentDialogTriggerHandler(null) : '');
};
if (goog.DEBUG) {
  feature.plan.linkedDeployment.linkedDeploymentHeaderDropdown.soyTemplateName = 'feature.plan.linkedDeployment.linkedDeploymentHeaderDropdown';
}


feature.plan.linkedDeployment.linkedDeploymentDialogTriggerHandler = function(opt_data, opt_ignored) {
  return '<script type="text/javascript">require([\'jquery\', \'feature/linked-deployment-shortcut\'], function($, linkedDeploymentShortcut){$(function () {linkedDeploymentShortcut.init({triggerSelector: ".linked-deployments-menu", relatedProjectsUrl: "' + soy.$$escapeHtml("" + '/rest/api/latest/deploy/project/forPlan?planKey=') + '", dialogContentTemplate: feature.plan.linkedDeployment.linkedDeploymentDialogContent});});});<\/script>';
};
if (goog.DEBUG) {
  feature.plan.linkedDeployment.linkedDeploymentDialogTriggerHandler.soyTemplateName = 'feature.plan.linkedDeployment.linkedDeploymentDialogTriggerHandler';
}


feature.plan.linkedDeployment.linkedDeploymentDashboardDropdown = function(opt_data, opt_ignored) {
  return '' + ((opt_data.hasLinkedDeployments) ? '<a class="linked-deployments-menu" title="' + soy.$$escapeHtml("Related deployment projects") + '" data-plan-key=' + soy.$$escapeHtml(opt_data.immutablePlan.planKey.key) + ' href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.immutablePlan.planKey.key) + '/deployments">' + widget.icons.fontIcon({type: 'deploy'}) + '</a>' : '');
};
if (goog.DEBUG) {
  feature.plan.linkedDeployment.linkedDeploymentDashboardDropdown.soyTemplateName = 'feature.plan.linkedDeployment.linkedDeploymentDashboardDropdown';
}


feature.plan.linkedDeployment.linkedDeploymentDialogContent = function(opt_data, opt_ignored) {
  var output = '<div class="linked-deployments-content"><h3>' + soy.$$escapeHtml("Related deployment projects") + '</h3>';
  if (opt_data.linkedDeploymentProjects && opt_data.linkedDeploymentProjects.length > 0) {
    output += soy.$$escapeHtml("This build plan supplies artifacts for the following deployment projects:") + '<ul>';
    var deploymentProjectList42 = opt_data.linkedDeploymentProjects;
    var deploymentProjectListLen42 = deploymentProjectList42.length;
    for (var deploymentProjectIndex42 = 0; deploymentProjectIndex42 < deploymentProjectListLen42; deploymentProjectIndex42++) {
      var deploymentProjectData42 = deploymentProjectList42[deploymentProjectIndex42];
      output += '<li><a href="' + soy.$$escapeHtml("") + '/deploy/viewDeploymentProjectEnvironments.action?id=' + soy.$$escapeHtml(deploymentProjectData42.id) + '">' + soy.$$escapeHtml(deploymentProjectData42.name) + '</a></li>';
    }
    output += '</ul>';
  } else {
    output += '<p>' + soy.$$escapeHtml("There are no deployment projects linked to this build plan") + '</p>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  feature.plan.linkedDeployment.linkedDeploymentDialogContent.soyTemplateName = 'feature.plan.linkedDeployment.linkedDeploymentDialogContent';
}
;
;
/* module-key = 'bamboo.deployments:linked-deployment-shortcut', location = '/feature/plan/linked-deployment/linked-deployment-shortcut.js' */
define('feature/linked-deployment-shortcut', [
    'jquery',
    'underscore',
    'widget/generate-error-messages',
    'util/ajax'
], function(
    $,
    _,
    generateErrorMessages,
    ajax
) {

    'use strict';

    var linkedDeploymentShortcut = (function() {
        var defaults = {
            triggerSelector: null,
            relatedProjectsUrl: null,
            dialogContentTemplate: null
        },
        options;

        return {
            init: function(options) {
                $.extend(true, defaults, options);

                var configuration = {
                    width: 250,
                    offsetX: -10,
                    arrowOffsetX: 0
                };

                AJS.InlineDialog($(options.triggerSelector), 'deployment-shortcut-dialog',
                    function($container, trigger, showPopup) {
                        var planKey = $(trigger).data('planKey');
                        $container.html(widget.icons.icon({type: 'loading'}));

                        ajax({
                            url: options.relatedProjectsUrl + planKey,
                            data: { decorator: 'nothing', confirm: true },
                            dataType: 'json',
                            contentType: 'application/json',
                            cache: false
                        }).success(function(data) {
                            var content = options.dialogContentTemplate({ linkedDeploymentProjects: data});
                            $container.empty().append(content);
                        }).error(function(jqXHR, textStatus, errorThrown) {
                            var $message = generateErrorMessages(jqXHR, textStatus, errorThrown);
                            if (!$message) {
                                $message = $('<p/>').append("Unable to retrieve related deployments from Bamboo");
                            }
                            $container.empty().append($message);
                        });

                        showPopup();
                        return false;
                    },
                    configuration
                );
            }
        };
    }());

    return linkedDeploymentShortcut;
});
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/layout/base/base.soy' */
// This file was automatically generated from base.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.layout.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.layout == 'undefined') { bamboo.layout = {}; }


bamboo.layout.base = function(opt_data, opt_ignored) {
  var output = '<section id="content" role="main">' + ((opt_data.headerImageContent && opt_data.headerImageContent != '' || opt_data.headerMainContent && opt_data.headerMainContent != '' || opt_data.headerActionsContent && opt_data.headerActionsContent != '' || opt_data.headerActionsButtons && opt_data.headerActionsButtons != '') ? aui.page.pageHeader({content: '' + ((opt_data.headerImageContent && opt_data.headerImageContent != '') ? aui.page.pageHeaderImage({content: opt_data.headerImageContent}) : '') + ((opt_data.headerMainContent && opt_data.headerMainContent != '') ? aui.page.pageHeaderMain({content: opt_data.headerMainContent}) : '') + ((opt_data.headerActionsContent && opt_data.headerActionsContent != '' || opt_data.headerActionsButtons && opt_data.headerActionsButtons != '') ? aui.page.pageHeaderActions({content: '' + ((opt_data.headerActionsContent && opt_data.headerActionsContent != '') ? soy.$$filterNoAutoescape(opt_data.headerActionsContent) : '') + ((opt_data.headerActionsButtons && opt_data.headerActionsButtons != '') ? aui.buttons.buttons({extraClasses: 'aui-dropdown2-trigger-group', content: opt_data.headerActionsButtons}) : '')}) : '')}) : '') + ((opt_data.headerExtraContent && opt_data.headerExtraContent != '') ? '<div class="bamboo-page-header-extra">' + soy.$$filterNoAutoescape(opt_data.headerExtraContent) + '</div>' : '') + ((opt_data.navItems && opt_data.navItems.length) ? bamboo.widget.nav.horizontal({items: opt_data.navItems}) : '');
  var param40 = '' + ((opt_data.pageNavContent && opt_data.pageNavContent != '') ? aui.page.pagePanelNav({extraClasses: opt_data.pageNavClass, content: opt_data.pageNavContent}) : '') + ((opt_data.pageItemContent && opt_data.pageItemContent != '') ? aui.page.pagePanelItem({extraClasses: opt_data.pageItemClass, content: opt_data.pageItemContent}) : '') + aui.page.pagePanelContent({content: opt_data.content, extraClasses: opt_data.contentClass});
  if (opt_data.pageSidebarContent && opt_data.pageSidebarContent != '' || opt_data.pageHelpPanels && opt_data.pageHelpPanels.length) {
    var param56 = '' + ((opt_data.pageSidebarContent && opt_data.pageSidebarContent != '') ? soy.$$filterNoAutoescape(opt_data.pageSidebarContent) : '');
    if (opt_data.pageHelpPanels && opt_data.pageHelpPanels.length) {
      var pageHelpPanelList63 = opt_data.pageHelpPanels;
      var pageHelpPanelListLen63 = pageHelpPanelList63.length;
      for (var pageHelpPanelIndex63 = 0; pageHelpPanelIndex63 < pageHelpPanelListLen63; pageHelpPanelIndex63++) {
        var pageHelpPanelData63 = pageHelpPanelList63[pageHelpPanelIndex63];
        param56 += bamboo.widget.help.panel(pageHelpPanelData63);
      }
    }
    param40 += aui.page.pagePanelSidebar({content: param56});
  }
  output += aui.page.pagePanel({extraClasses: opt_data.pagePanelClass, content: param40});
  output += ((opt_data.pageFooterContent && opt_data.pageFooterContent != '') ? '<footer class="bamboo-page-footer">' + soy.$$filterNoAutoescape(opt_data.pageFooterContent) + '</footer>' : '') + '</section>';
  return output;
};
if (goog.DEBUG) {
  bamboo.layout.base.soyTemplateName = 'bamboo.layout.base';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/layout/focused/focused.soy' */
// This file was automatically generated from focused.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.layout.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.layout == 'undefined') { bamboo.layout = {}; }


bamboo.layout.focused = function(opt_data, opt_ignored) {
  return '' + bamboo.layout.base(soy.$$augmentMap(opt_data, {headerActionsContent: '' + ((opt_data.progressTrackerSteps && opt_data.progressTrackerSteps.length) ? aui.progressTracker.progressTracker({isInverted: true, steps: opt_data.progressTrackerSteps}) : '')}));
};
if (goog.DEBUG) {
  bamboo.layout.focused.soyTemplateName = 'bamboo.layout.focused';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/layout/dashboard/dashboard.soy' */
// This file was automatically generated from dashboard.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.layout.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.layout == 'undefined') { bamboo.layout = {}; }


bamboo.layout.dashboard = function(opt_data, opt_ignored) {
  return '' + bamboo.layout.base(soy.$$augmentMap(opt_data, {headerMainContent: '<h1 id="dashboard-instance-name">' + soy.$$escapeHtml("Build Dashboard") + '</h1>'}));
};
if (goog.DEBUG) {
  bamboo.layout.dashboard.soyTemplateName = 'bamboo.layout.dashboard';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/layout/plan/plan.soy' */
// This file was automatically generated from plan.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.layout.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.layout == 'undefined') { bamboo.layout = {}; }


bamboo.layout.plan = function(opt_data, opt_ignored) {
  return '' + bamboo.layout.base(soy.$$augmentMap(opt_data, {headerActionsContent: '' + ((opt_data.planStatusHistory) ? bamboo.widget.planStatusHistory.container(opt_data.planStatusHistory) : '') + ((opt_data.headerActionsContent) ? soy.$$filterNoAutoescape(opt_data.headerActionsContent) : '')}));
};
if (goog.DEBUG) {
  bamboo.layout.plan.soyTemplateName = 'bamboo.layout.plan';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/layout/project/project.soy' */
// This file was automatically generated from project.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.layout.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.layout == 'undefined') { bamboo.layout = {}; }


bamboo.layout.projectActions = function(opt_data, opt_ignored) {
  var output = '' + aui.buttons.buttons({content: '' + aui.buttons.button({text: ' ' + "Project wallboard", tagName: 'a', iconClass: 'icon icon-wallboard', iconType: 'custom', extraAttributes: {href: "" + '/telemetry.action?filter=project&projectKey=' + opt_data.projectKey}})}) + aui.buttons.buttons({content: '' + aui.buttons.button({text: ' ', tagName: 'a', iconClass: 'aui-icon-small aui-iconfont-more', iconType: 'aui', dropdown2Target: 'buildConfigurationActions'})});
  var dropdownApplinks__soy19 = {label: "Application links", href: '/plugins/servlet/applinks/listEntityLinks/com.atlassian.applinks.api.application.bamboo.BambooProjectEntityType/' + opt_data.projectKey, type: 'configure'};
  output += aui.dropdown2.contents({id: 'buildConfigurationActions', extraClasses: 'aui-style-default', content: '' + aui.dropdown2.section({content: '' + ((opt_data.hasEditPermission) ? bamboo.layout.projectActionsLinks({items: [dropdownApplinks__soy19, {label: "Edit project name", href: '/project/admin/config/editProjectName.action?projectKey=' + opt_data.projectKey, class: 'edit-project-name', type: 'edit'}]}) : bamboo.layout.projectActionsLinks({items: [dropdownApplinks__soy19]}))})});
  return output;
};
if (goog.DEBUG) {
  bamboo.layout.projectActions.soyTemplateName = 'bamboo.layout.projectActions';
}


bamboo.layout.projectActionsLinks = function(opt_data, opt_ignored) {
  var output = '<ul>';
  var itemList35 = opt_data.items;
  var itemListLen35 = itemList35.length;
  for (var itemIndex35 = 0; itemIndex35 < itemListLen35; itemIndex35++) {
    var itemData35 = itemList35[itemIndex35];
    output += '<li><a class="ui-icon-container ' + ((itemData35['class']) ? soy.$$escapeHtml(itemData35['class']) : '') + '" href="' + soy.$$escapeHtml("" + itemData35.href) + '">' + widget.icons.fontIcon({type: itemData35.type}) + ' ' + soy.$$escapeHtml(itemData35.label) + '</a></li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  bamboo.layout.projectActionsLinks.soyTemplateName = 'bamboo.layout.projectActionsLinks';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/page/admin/overview.soy' */
// This file was automatically generated from overview.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.page.admin.overview.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.page == 'undefined') { bamboo.page = {}; }
if (typeof bamboo.page.admin == 'undefined') { bamboo.page.admin = {}; }
if (typeof bamboo.page.admin.overview == 'undefined') { bamboo.page.admin.overview = {}; }


bamboo.page.admin.overview.overview = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '';
  var viewServerCapabilities__soy3 = "" + '/admin/agent/configureSharedLocalCapabilities.action';
  output += bamboo.page.admin.overview.welcomeItems({content: '' + bamboo.page.admin.overview.welcomeItem({content: AJS.format("\x3ca href\x3d\x22{0}\x22\x3eChange information\x3c/a\x3e you supplied when Bamboo was installed.","" + '/admin/globalConfiguration.action')}) + ((opt_data.hasGlobalAdminPermission) ? ((! opt_data.hasBuilders && ! opt_data.hasJdks) ? bamboo.page.admin.overview.welcomeItem({content: AJS.format("Bamboo has failed to detect any \x3ca href\x3d\x22{0}\x22\x3eexecutables or JDK\x27\x27s\x3c/a\x3e available on your Bamboo server.  You will need to manually \x3ca href\x3d\x22{0}\x22\x3econfigure\x3c/a\x3e at least one executable (such as Ant, Maven, Maven 2 or scripts) before you can run any plans.",viewServerCapabilities__soy3)}) : (! opt_data.hasBuilders) ? bamboo.page.admin.overview.welcomeItem({content: AJS.format("Bamboo has detected a \x3ca href\x3d\x22{0}\x22\x3eJDK\x3c/a\x3e on your Bamboo server, but has failed to detect any \x3ca href\x3d\x22{0}\x22\x3eexecutables\x3c/a\x3e.  You need to manually \x3ca href\x3d\x22{0}\x22\x3econfigure\x3c/a\x3e at least one executable (such as Ant, Maven, Maven 2 or scripts) before you can run any plans.",viewServerCapabilities__soy3)}) : (! opt_data.hasJdks) ? bamboo.page.admin.overview.welcomeItem({content: AJS.format("Bamboo has detected \x3ca href\x3d\x22{0}\x22\x3e{1,choice,1#one executable|1\x3c{1} executables}\x3c/a\x3e on your server, but has failed to detect a \x3ca href\x3d\x22{0}\x22\x3eJDK\x3c/a\x3e.  You may need to manually \x3ca href\x3d\x22{0}\x22\x3econfigure\x3c/a\x3e these before you can run any plans.",viewServerCapabilities__soy3,opt_data.buildersSize ? opt_data.buildersSize : 0)}) : bamboo.page.admin.overview.welcomeItem({content: AJS.format("Bamboo has detected a \x3ca href\x3d\x22{0}\x22\x3eJDK\x3c/a\x3e and  \x3ca href\x3d\x22{0}\x22\x3e{1,choice,1#one executable|1\x3c{1} executables}\x3c/a\x3e on your server.  You may wish to \x3ca href\x3d\x22{0}\x22\x3eedit\x3c/a\x3e these or configure others.",viewServerCapabilities__soy3,opt_data.buildersSize ? opt_data.buildersSize : 0)})) + ((! opt_data.isOnDemandInstance) ? bamboo.page.admin.overview.welcomeItem({content: AJS.format("Let Bamboo know about your \x3ca href\x3d\x22{0}\x22\x3eemail server\x3c/a\x3e and \x3ca href\x3d\x22{1}\x22\x3einstant messaging server\x3c/a\x3e for build notifications.","" + '/admin/viewMailServer.action',"" + '/admin/instantmessagingserver/viewInstantMessagingServer.action')}) : '') : '') + ((! opt_data.isOnDemandInstance) ? (! opt_data.isAllowedRemoteAgents) ? bamboo.page.admin.overview.welcomeItem({content: AJS.format("Configure your \x3ca href\x3d\x22{0}\x22\x3elocal agents\x3c/a\x3e and their capabilities.","" + '/admin/agent/configureAgents!doDefault.action')}) : (opt_data.canManageElasticBamboo) ? bamboo.page.admin.overview.welcomeItem({content: AJS.format("Configure your \x3ca href\x3d\x22{0}\x22\x3eagents and their capabilities\x3c/a\x3e or set up \x3ca href\x3d\x22{1}\x22\x3eElastic Bamboo\x3c/a\x3e to get your builds running in the Amazon Elastic Compute Cloud (EC2).","" + '/admin/agent/configureAgents!doDefault.action',"" + '/admin/elastic/viewElasticConfig.action')}) : bamboo.page.admin.overview.welcomeItem({content: AJS.format("Configure your \x3ca href\x3d\x22{0}\x22\x3eagents and their capabilities\x3c/a\x3e.","" + '/admin/agent/configureAgents!doDefault.action')}) : (opt_data.canManageElasticBamboo) ? bamboo.page.admin.overview.welcomeItem({content: AJS.format("Set up \x3ca href\x3d\x22{0}\x22\x3eElastic Bamboo\x3c/a\x3e to get your builds running in the Amazon Elastic Compute Cloud (EC2).","" + '/admin/elastic/viewElasticConfig.action')}) : '') + ((! opt_data.isOnDemandInstance) ? bamboo.page.admin.overview.welcomeItem({content: AJS.format("Add more \x3ca href\x3d\x22{0}\x22\x3eusers\x3c/a\x3e, \x3ca href\x3d\x22{1}\x22\x3egroups\x3c/a\x3e and \x3ca href\x3d\x22{2}\x22\x3emanage permissions\x3c/a\x3e.","" + '/admin/user/viewUsers.action',"" + '/admin/group/viewGroups.action',"" + '/admin/viewGlobalPermissions.action')}) : '') + bamboo.page.admin.overview.welcomeItem({content: AJS.format("\x3ca href\x3d\x22{0}\x22\x3eSet build expiry\x3c/a\x3e, \x3ca href\x3d\x22{1}\x22\x3edelete plans\x3c/a\x3e or \x3ca href\x3d\x22{2}\x22\x3eedit plan permissions\x3c/a\x3e.","" + '/admin/buildExpiry!doRead.action',"" + '/admin/deleteBuilds.action',"" + '/admin/chooseBuildsToBulkEditPermissions.action')})});
  return output;
};
if (goog.DEBUG) {
  bamboo.page.admin.overview.overview.soyTemplateName = 'bamboo.page.admin.overview.overview';
}


bamboo.page.admin.overview.welcomeItems = function(opt_data, opt_ignored) {
  return '' + ((opt_data.content != '') ? '<ul>' + soy.$$filterNoAutoescape(opt_data.content) + '</ul>' : '');
};
if (goog.DEBUG) {
  bamboo.page.admin.overview.welcomeItems.soyTemplateName = 'bamboo.page.admin.overview.welcomeItems';
}


bamboo.page.admin.overview.welcomeItem = function(opt_data, opt_ignored) {
  return '<li>' + soy.$$filterNoAutoescape(opt_data.content) + '</li>';
};
if (goog.DEBUG) {
  bamboo.page.admin.overview.welcomeItem.soyTemplateName = 'bamboo.page.admin.overview.welcomeItem';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/feature/jira-issue-list/jira-issue-list.soy' */
// This file was automatically generated from jira-issue-list.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.jiraIssueList.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.jiraIssueList == 'undefined') { bamboo.feature.jiraIssueList = {}; }


bamboo.feature.jiraIssueList.jiraIssueList = function(opt_data, opt_ignored) {
  var output = '<table class="aui jira-issues' + ((opt_data.loading) ? ' loading' : '') + '"><thead><tr><th colspan="2" class="issue">Issue</th><th class="description">Description</th>' + ((! opt_data.hideStatus) ? '<th class="status">Status</th>' : '') + '</tr></thead>' + ((opt_data.issuesCount > opt_data.maxIssues) ? '<tfoot><tr><td colspan="' + soy.$$escapeHtml(opt_data.hideStatus ? 3 : 4) + '"><a href="' + soy.$$escapeHtml(opt_data.jiraTabUrl) + '">' + soy.$$escapeHtml(opt_data.issuesCount - opt_data.maxIssues + ' more issue' + (opt_data.issuesCount - opt_data.maxIssues > 1 ? 's' : '')) + '&hellip;</a></td></tr></tfoot>' : '') + '<tbody>';
  var issueList22 = opt_data.issues;
  var issueListLen22 = issueList22.length;
  for (var issueIndex22 = 0; issueIndex22 < issueListLen22; issueIndex22++) {
    var issueData22 = issueList22[issueIndex22];
    output += (issueData22.url && issueData22.url.href && issueData22.key && issueData22.summary) ? bamboo.feature.jiraIssueList.jiraIssueListItem({key: issueData22.key, url: issueData22.url, summary: issueData22.summary, issueType: issueData22.issueType ? issueData22.issueType : opt_data.defaultIssueType, iconUrl: issueData22.iconUrl ? issueData22.iconUrl : opt_data.defaultIssueIconUrl, status: issueData22.status, statusClass: issueData22.statusClass, hideStatus: opt_data.hideStatus}) : bamboo.feature.jiraIssueList.jiraIssueListItemNoConnection({key: issueData22.issueKey ? issueData22.issueKey : issueData22.key, hideStatus: opt_data.hideStatus});
  }
  output += '</tbody></table>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.jiraIssueList.soyTemplateName = 'bamboo.feature.jiraIssueList.jiraIssueList';
}


bamboo.feature.jiraIssueList.jiraIssueListItem = function(opt_data, opt_ignored) {
  return '<tr data-issue-key="' + opt_data.key + '"><td class="type"><a href="' + soy.$$escapeHtml(opt_data.url.href) + '" title="' + soy.$$escapeHtml("View this issue") + '"><img src="' + soy.$$escapeHtml(opt_data.iconUrl) + '" alt="' + soy.$$escapeHtml(opt_data.issueType) + '" /></a></td><td class="key"><a href="' + soy.$$escapeHtml(opt_data.url.href) + '">' + opt_data.key + '</a></td><td class="description">' + soy.$$escapeHtml(opt_data.summary) + '</td>' + ((! opt_data.hideStatus) ? '<td class="status"><span class="status-lozenge lozenge-subtle' + ((opt_data.statusClass) ? ' status-' + opt_data.statusClass : '') + '" title="' + soy.$$escapeHtml(opt_data.status) + '">' + soy.$$escapeHtml(opt_data.status) + '</span></td>' : '') + '</tr>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.jiraIssueListItem.soyTemplateName = 'bamboo.feature.jiraIssueList.jiraIssueListItem';
}


bamboo.feature.jiraIssueList.jiraIssueListItemNoConnection = function(opt_data, opt_ignored) {
  return '<tr><td class="type">' + widget.icons.icon({type: 'jiraissue-unknown', text: 'Unknown Issue Type', showTitle: true}) + '</td><td class="key">' + soy.$$escapeHtml(opt_data.key) + '</td><td' + ((! opt_data.hideStatus) ? ' colspan="2"' : '') + ' class="details-error"><span>' + soy.$$escapeHtml("Could not obtain issue details from JIRA") + '</span></td></tr>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.jiraIssueListItemNoConnection.soyTemplateName = 'bamboo.feature.jiraIssueList.jiraIssueListItemNoConnection';
}


bamboo.feature.jiraIssueList.singleIssue = function(opt_data, opt_ignored) {
  return '<span class="jira-issue"' + ((opt_data.key) ? ' data-key="' + opt_data.key + '"' : '') + '><a href="' + ((opt_data.url.href) ? soy.$$escapeHtml(opt_data.url.href) : soy.$$escapeHtml(opt_data.url)) + '" title="' + soy.$$escapeHtml("View this issue") + ' (' + soy.$$escapeHtml(opt_data.issueType) + ')" style="background-image: url(' + soy.$$escapeHtml(opt_data.iconUrl) + ');">' + soy.$$escapeHtml(opt_data.key) + '</a><span class="description">' + soy.$$escapeHtml(opt_data.summary) + '</span><span class="status-lozenge">' + soy.$$escapeHtml(opt_data.status) + '</span></span>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.singleIssue.soyTemplateName = 'bamboo.feature.jiraIssueList.singleIssue';
}


bamboo.feature.jiraIssueList.singleIssueLoading = function(opt_data, opt_ignored) {
  return '<span class="single-issue-loading"><a' + ((opt_data.keyLink) ? ' href="' + soy.$$escapeHtml(opt_data.keyLink) + '"' : '') + '>' + opt_data.key + '</a></span>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.singleIssueLoading.soyTemplateName = 'bamboo.feature.jiraIssueList.singleIssueLoading';
}


bamboo.feature.jiraIssueList.singleIssueOAuth = function(opt_data, opt_ignored) {
  return '' + bamboo.feature.jiraIssueList.singleIssueRetrievalError({key: opt_data.key, keyLink: opt_data.keyLink, errorDetails: '' + bamboo.feature.jiraIssueList.linkedIssueOAuth({authenticationRedirectUrl: opt_data.authenticationRedirectUrl, authenticationInstanceName: opt_data.authenticationInstanceName, reason: 'to see issue details'})});
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.singleIssueOAuth.soyTemplateName = 'bamboo.feature.jiraIssueList.singleIssueOAuth';
}


bamboo.feature.jiraIssueList.singleIssueRetrievalError = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<span class="single-issue-retrieval-error"' + ((opt_data.key) ? ' data-key="' + opt_data.key + '"' : '') + '>' + ((opt_data.key) ? '<a' + ((opt_data.keyLink) ? ' href="' + soy.$$escapeHtml(opt_data.keyLink) + '"' : '') + '>' + opt_data.key + '</a>' : '') + '<span class="error-message' + ((! opt_data.errorDetails) ? ' unspecified' : '') + '">' + ((opt_data.errorDetails) ? soy.$$filterNoAutoescape(opt_data.errorDetails) : soy.$$escapeHtml("Could not obtain issue details from JIRA")) + '</span></span>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.singleIssueRetrievalError.soyTemplateName = 'bamboo.feature.jiraIssueList.singleIssueRetrievalError';
}


bamboo.feature.jiraIssueList.linkedIssueOAuth = function(opt_data, opt_ignored) {
  return '<a class="oauth-init" href="' + soy.$$escapeHtml(opt_data.authenticationRedirectUrl) + '">Authenticate</a> ' + ((opt_data.authenticationInstanceName) ? ' with ' + soy.$$escapeHtml(opt_data.authenticationInstanceName) : '') + ' ' + soy.$$escapeHtml(opt_data.reason);
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.linkedIssueOAuth.soyTemplateName = 'bamboo.feature.jiraIssueList.linkedIssueOAuth';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/feature/comments/comments.soy' */
// This file was automatically generated from comments.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.comments.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.comments == 'undefined') { bamboo.feature.comments = {}; }


bamboo.feature.comments.commentList = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.comments.length > 0) {
    output += ((opt_data.showTopLevelHeading) ? '<h2>' + soy.$$escapeHtml("Comments") + '</h2>' : '') + '<ol>';
    var commentList11 = opt_data.comments;
    var commentListLen11 = commentList11.length;
    for (var commentIndex11 = 0; commentIndex11 < commentListLen11; commentIndex11++) {
      var commentData11 = commentList11[commentIndex11];
      output += bamboo.feature.comments.commentListItem({id: commentData11.id, comment: commentData11.comment, lastModificationDate: commentData11.lastModificationDate, prettyLastModificationDate: commentData11.prettyLastModificationDate, avatar: commentData11.avatar, user: commentData11.user, userDisplayName: commentData11.userDisplayName, showOperations: opt_data.showOperations, headingLevel: opt_data.headingLevel ? opt_data.headingLevel : 'h3', result: commentData11.result});
    }
    output += '</ol>';
  }
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.comments.commentList.soyTemplateName = 'bamboo.feature.comments.commentList';
}


bamboo.feature.comments.commentListItem = function(opt_data, opt_ignored) {
  return '<li><img src="' + soy.$$escapeHtml(opt_data.avatar ? opt_data.avatar : "" + '/images/icons/useravatar.png') + '" class="avatar"><' + soy.$$escapeHtml(opt_data.headingLevel ? opt_data.headingLevel : 'h3') + '>' + ((opt_data.user) ? '<a href="' + soy.$$escapeHtml("" + '/browse/user/' + opt_data.user.name) + '">' + soy.$$escapeHtml(opt_data.userDisplayName) + '</a>' : soy.$$escapeHtml("Anonymous user")) + '</' + soy.$$escapeHtml(opt_data.headingLevel ? opt_data.headingLevel : 'h3') + '><p>' + soy.$$filterNoAutoescape(opt_data.comment) + '</p>' + ((opt_data.showOperations) ? '<div class="ops">' + ((opt_data.result) ? '<a class="delete mutative" href="' + soy.$$escapeHtml("" + '/build/ajax/deleteComment.action?commentId=' + opt_data.id + '&buildKey=' + opt_data.result.buildKey + '&buildNumber=' + opt_data.result.buildNumber) + '" title="' + soy.$$escapeHtml("Permanently delete this comment?") + '">' + soy.$$escapeHtml("Delete") + '</a>' : '<a class="delete mutative" href="' + soy.$$escapeHtml("" + '/deploy/deleteComment.action?commentId=' + opt_data.id) + '" title="' + soy.$$escapeHtml("Permanently delete this comment?") + '">' + soy.$$escapeHtml("Delete") + '</a>') + '</div>' : '') + '<time datetime="' + soy.$$escapeHtml(opt_data.lastModificationDate) + '" title="' + soy.$$escapeHtml(opt_data.lastModificationDate) + '">' + soy.$$escapeHtml(AJS.format("about {0} ago",opt_data.prettyLastModificationDate)) + '</time></li>';
};
if (goog.DEBUG) {
  bamboo.feature.comments.commentListItem.soyTemplateName = 'bamboo.feature.comments.commentListItem';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/feature/variables/variables.soy' */
// This file was automatically generated from variables.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.variables.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.variables == 'undefined') { bamboo.feature.variables = {}; }


bamboo.feature.variables.variablesTable = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var param28 = '' + ((! opt_data.hideAddHeader) ? '<tr class="add-variable"><td>' + bamboo.feature.variables.selectOrInput({id: 'variableKey', options: opt_data.availableVariables}) + '</td><td>' + bamboo.feature.variables.selectOrInput({id: 'variableValue', value: opt_data.firstAvailableVariable}) + '</td><td class="operations">' + aui.form.submit({text: "Add", id: ''}) + '</td></tr>' : '');
  if (opt_data.variables) {
    var variableList46 = opt_data.variables;
    var variableListLen46 = variableList46.length;
    for (var variableIndex46 = 0; variableIndex46 < variableListLen46; variableIndex46++) {
      var variableData46 = variableList46[variableIndex46];
      param28 += bamboo.feature.variables.variablesTableRow(soy.$$augmentMap(variableData46, {inlineEdit: opt_data.inlineEdit, availableVariables: opt_data.availableVariables, deleteVariableUrl: opt_data.deleteVariableUrl}));
    }
  }
  var output = '' + aui.table({extraClasses: 'variables-list', columnsContent: '<colgroup><col width="30%" /><col width="*" /><col width="60" /></colgroup>', theadContent: '<tr><th>' + soy.$$escapeHtml("Variable name") + '</th><th>' + soy.$$escapeHtml("Value") + '</th><th class="operations"><span class="assistive">' + soy.$$escapeHtml("Operations") + '</span></th></tr>', tfootContent: '' + ((opt_data.showOverrideFooter) ? '<tr>' + ((opt_data.userCanOverrideVariables) ? '<td colspan="3"><a class="aui-button aui-button-link aui-style variables-override">' + soy.$$escapeHtml("Override a variable") + '</a></td>' : '<td colspan="3"><span class="variables-override">' + soy.$$escapeHtml("Build variables override is forbidden") + '</span></td>') + '</tr>' : ''), content: param28});
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.variables.variablesTable.soyTemplateName = 'bamboo.feature.variables.variablesTable';
}


bamboo.feature.variables.variablesTableRow = function(opt_data, opt_ignored) {
  return '<tr data-variable-id="' + soy.$$escapeHtml(opt_data.id) + '"><td>' + ((opt_data.inlineEdit) ? bamboo.feature.variables.inPlaceEditField({id: 'key_' + opt_data.id, value: opt_data.key, options: opt_data.availableVariables}) : bamboo.feature.variables.selectOrInput({id: 'key_' + opt_data.id, value: opt_data.key, options: opt_data.availableVariables})) + '</td><td>' + ((opt_data.inlineEdit) ? bamboo.feature.variables.inPlaceEditField({id: 'value_' + opt_data.id, value: opt_data.value}) : bamboo.feature.variables.selectOrInput({id: 'value_' + opt_data.id, value: opt_data.key})) + '</td><td class="operations"><a id="deleteVariable_' + soy.$$escapeHtml(opt_data.id) + '" class="delete-variable"' + ((opt_data.deleteVariableUrl) ? ' href="' + soy.$$escapeHtml(opt_data.deleteVariableUrl) + '"' : '') + ' title="' + soy.$$escapeHtml("Delete") + '" tabindex="-1">' + aui.icons.icon({icon: 'remove', useIconFont: true, accessibilityText: "Delete", extraAttributes: {title: "Delete"}}) + '</a></td></tr>';
};
if (goog.DEBUG) {
  bamboo.feature.variables.variablesTableRow.soyTemplateName = 'bamboo.feature.variables.variablesTableRow';
}


bamboo.feature.variables.inPlaceEditField = function(opt_data, opt_ignored) {
  return '<span class="inline-edit-view"' + ((! opt_data.readonly) ? ' tabindex="0"' : '') + ' id="key_' + soy.$$escapeHtml(opt_data.id) + '">' + soy.$$escapeHtml(opt_data.value) + '</span>' + ((opt_data.readonly) ? aui.form.input({type: 'hidden', name: opt_data.id, value: opt_data.value}) : bamboo.feature.variables.selectOrInput(soy.$$augmentMap(opt_data, {extraClasses: 'inline-edit-field'})));
};
if (goog.DEBUG) {
  bamboo.feature.variables.inPlaceEditField.soyTemplateName = 'bamboo.feature.variables.inPlaceEditField';
}


bamboo.feature.variables.selectOrInput = function(opt_data, opt_ignored) {
  return '' + ((opt_data.options) ? bamboo.feature.variables.select({name: opt_data.id, options: opt_data.options, extraClasses: opt_data.extraClasses}) : aui.form.input({type: 'text', name: opt_data.id, value: opt_data.value, extraClasses: opt_data.extraClasses, extraAttributes: {autocomplete: 'off'}}));
};
if (goog.DEBUG) {
  bamboo.feature.variables.selectOrInput.soyTemplateName = 'bamboo.feature.variables.selectOrInput';
}


bamboo.feature.variables.passwordConfirmaton = function(opt_data, opt_ignored) {
  return '' + aui.message.warning({titleContent: "variables.password.dialog.title", content: '<p>' + soy.$$escapeHtml("variables.password.dialog.description") + '</p>'});
};
if (goog.DEBUG) {
  bamboo.feature.variables.passwordConfirmaton.soyTemplateName = 'bamboo.feature.variables.passwordConfirmaton';
}


bamboo.feature.variables.deleteConfirmaton = function(opt_data, opt_ignored) {
  return '' + aui.message.warning({titleContent: "Warning", content: '<p>' + soy.$$escapeHtml("You are about to delete the selected variable. Are you sure you want to continue?") + '</p>'});
};
if (goog.DEBUG) {
  bamboo.feature.variables.deleteConfirmaton.soyTemplateName = 'bamboo.feature.variables.deleteConfirmaton';
}


bamboo.feature.variables.select = function(opt_data, opt_ignored) {
  var output = '<select' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' name="' + ((opt_data.name) ? soy.$$escapeHtml(opt_data.name) : soy.$$escapeHtml(opt_data.id)) + '" class="' + soy.$$escapeHtml(opt_data.isMultiple ? 'multi-select' : 'select') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.size) ? ' size="' + soy.$$escapeHtml(opt_data.size) + '"' : '') + ((opt_data.isDisabled) ? ' disabled' : '') + ((opt_data.isMultiple) ? ' multiple' : '') + aui.renderExtraAttributes(opt_data) + '>';
  var optionList172 = opt_data.options;
  var optionListLen172 = optionList172.length;
  for (var optionIndex172 = 0; optionIndex172 < optionListLen172; optionIndex172++) {
    var optionData172 = optionList172[optionIndex172];
    output += bamboo.feature.variables.optionOrOptgroup(optionData172);
  }
  output += '</select>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.variables.select.soyTemplateName = 'bamboo.feature.variables.select';
}


bamboo.feature.variables.optionOrOptgroup = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.options) {
    output += '<optgroup label="' + soy.$$escapeHtml(opt_data.text) + '"' + aui.renderExtraAttributes(opt_data) + '>';
    var optionList184 = opt_data.options;
    var optionListLen184 = optionList184.length;
    for (var optionIndex184 = 0; optionIndex184 < optionListLen184; optionIndex184++) {
      var optionData184 = optionList184[optionIndex184];
      output += bamboo.feature.variables.optionOrOptgroup(optionData184);
    }
    output += '</optgroup>';
  } else {
    output += '<option value="' + soy.$$escapeHtml(opt_data.value) + '"' + aui.renderExtraAttributes(opt_data) + ((opt_data.selected) ? ' selected' : '') + '>' + soy.$$escapeHtml(opt_data.text) + '</option>';
  }
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.variables.optionOrOptgroup.soyTemplateName = 'bamboo.feature.variables.optionOrOptgroup';
}


bamboo.feature.variables.overrideText = function(opt_data, opt_ignored) {
  return '' + ((opt_data.variable) ? '<div class="variable-override-text">' + ((opt_data.variable.variableType == 'PLAN') ? soy.$$escapeHtml("Overrides plan value:") + ' ' + soy.$$escapeHtml(opt_data.variable.value) : soy.$$escapeHtml("Overrides global value:") + ' ' + soy.$$escapeHtml(opt_data.variable.value)) + '</div>' : '');
};
if (goog.DEBUG) {
  bamboo.feature.variables.overrideText.soyTemplateName = 'bamboo.feature.variables.overrideText';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/feature/dashboard/welcome-mat/welcome-mat.soy' */
// This file was automatically generated from welcome-mat.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.dashboard.welcomeMat.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.dashboard == 'undefined') { bamboo.feature.dashboard = {}; }
if (typeof bamboo.feature.dashboard.welcomeMat == 'undefined') { bamboo.feature.dashboard.welcomeMat = {}; }


bamboo.feature.dashboard.welcomeMat.welcomeMat = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + bamboo.feature.dashboard.welcomeMat.welcomeMessage({showCreate: opt_data.hasGlobalCreatePermission || opt_data.hasAdminPermission, showImport: opt_data.hasAdminPermission, showLogin: ! opt_data.hasUser, showSignup: ! opt_data.hasUser, showSetupEC2: opt_data.canManageElasticBamboo && opt_data.isEc2ConfigurationWarningRequired, showContactAdmin: opt_data.hasUser && (! opt_data.hasAdminPermission && ! opt_data.hasGlobalCreatePermission || ! opt_data.canManageElasticBamboo && opt_data.isEc2ConfigurationWarningRequired), showOnDemandContent: opt_data.isOnDemandInstance, content: '' + ((opt_data.hasUser) ? (opt_data.isEc2ConfigurationWarningRequired && (opt_data.canManageElasticBamboo || opt_data.hasGlobalCreatePermission)) ? (opt_data.canManageElasticBamboo) ? aui.message.info({titleContent: "Amazon Elastic Cloud (EC2) configuration required", content: '<p>' + soy.$$filterNoAutoescape(AJS.format("Bamboo Cloud uses the \x3ca href\x3d\x22{0}\x22\x3eAmazon Elastic Compute Cloud (EC2)\x3c/a\x3e to run builds, which you must configure before creating any plans.",'http://confluence.atlassian.com/display/BAMBOO/About+Elastic+Bamboo')) + '</p>'}) : (opt_data.hasGlobalCreatePermission) ? aui.message.info({titleContent: "Amazon Elastic Cloud (EC2) configuration required", content: '<p>' + soy.$$filterNoAutoescape(AJS.format("Bamboo Cloud uses the \x3ca href\x3d\x22{0}\x22\x3eAmazon Elastic Cloud (EC2)\x3c/a\x3e to run builds, which must be configured before creating any plans. Please \x3ca href\x3d\x22{1}\x22\x3econtact an administrator\x3c/a\x3e to have them set up Elastic Bamboo.",'http://confluence.atlassian.com/display/BAMBOO/About+Elastic+Bamboo',"" + '/viewAdministrators.action')) + '</p>'}) : '' : (! (opt_data.hasAdminPermission || opt_data.hasGlobalCreatePermission)) ? aui.message.info({titleContent: "Not authorised to configure plans", content: '<p>' + soy.$$filterNoAutoescape(AJS.format("There are currently no builds configured in Bamboo. You do not have the correct privileges to set up a build. Please \x3ca href\x3d\x22{0}\x22\x3econtact an administrator\x3c/a\x3e for further assistance.","" + '/viewAdministrators.action')) + '</p>'}) : '' : '')});
};
if (goog.DEBUG) {
  bamboo.feature.dashboard.welcomeMat.welcomeMat.soyTemplateName = 'bamboo.feature.dashboard.welcomeMat.welcomeMat';
}


bamboo.feature.dashboard.welcomeMat.welcomeMessage = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div class="welcome-message build"><div class="welcome-content"><h2 class="welcome-title">' + soy.$$escapeHtml("Let\x27s get building!") + '</h2><div class="welcome-blurb"><p>' + ((opt_data.showOnDemandContent) ? soy.$$escapeHtml("It\x27s time to create your first build plan.") : soy.$$escapeHtml("Now that the installation and the setup of Bamboo is complete, it\x27s time to create your first build plan.")) + '</p><p>' + soy.$$escapeHtml("Build plans hold all the instructions to build, test and assemble your software. Whenever you make a change to your code, Bamboo triggers your build plan and notifies you of the result.") + '</p>' + ((opt_data.content && opt_data.content != '') ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</div>' + ((opt_data.showSetupEC2 || opt_data.showContactAdmin || opt_data.showCreate || opt_data.showImport || opt_data.showLogin || opt_data.showSignup) ? aui.toolbar2.toolbar2({extraClasses: 'welcome-actions', content: '' + aui.toolbar2.item({item: 'primary', content: '' + ((opt_data.showSetupEC2) ? aui.buttons.button({text: "Configure Elastic Bamboo", type: 'primary', tagName: 'a', extraClasses: 'aui-style', extraAttributes: {href: "" + '/admin/elastic/viewElasticConfig.action'}}) : (opt_data.showContactAdmin) ? aui.buttons.button({text: "Contact administrator", type: 'primary', tagName: 'a', extraClasses: 'aui-style', extraAttributes: {href: "" + '/viewAdministrators.action'}}) : '') + ((opt_data.showCreate || opt_data.showImport) ? (opt_data.showCreate) ? aui.buttons.button({text: "Create your first build plan", type: opt_data.showSetupEC2 || opt_data.showContactAdmin ? '' : 'primary', tagName: 'a', id: 'create-a-plan', isDisabled: opt_data.showSetupEC2 || opt_data.showContactAdmin, extraClasses: 'aui-style', extraAttributes: opt_data.showSetupEC2 || opt_data.showContactAdmin ? [] : {href: "" + '/build/admin/create/newPlan.action'}}) : '' : (opt_data.showLogin || opt_data.showSignup) ? ((opt_data.showLogin) ? aui.buttons.button({text: "Log in", type: 'primary', tagName: 'a', extraClasses: 'aui-style', extraAttributes: {href: "" + '/userlogin!doDefault.action'}}) : '') + ((opt_data.showSignup) ? aui.buttons.button({text: "Sign up", tagName: 'a', extraClasses: 'aui-style', extraAttributes: {href: "" + '/signupUser!doDefault.action'}}) : '') : '')})}) : '') + '</div></div>';
};
if (goog.DEBUG) {
  bamboo.feature.dashboard.welcomeMat.welcomeMessage.soyTemplateName = 'bamboo.feature.dashboard.welcomeMat.welcomeMessage';
}


bamboo.feature.dashboard.welcomeMat.welcomeMessageDeploy = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div class="welcome-message deployment"><div class="welcome-content"><h2 class="welcome-title">' + soy.$$escapeHtml("Ready, steady, deploy!") + ' </h2><div class="welcome-blurb">' + soy.$$filterNoAutoescape("\x3cp\x3eWith Bamboo deployments you can track your code from a JIRA issue, through testing in a build, all the way to deployment. Deployments allow you to: \x3cul\x3e\x3cli\x3eSnapshot your artifacts from any successful build into a release\x3c/li\x3e \x3cli\x3eDeploy, rollback and promote releases to environments\x3c/li\x3e \x3cli\x3eTrack what, when and who deployed releases to your environments\x3c/li\x3e \x3c/ul\x3e\x3c/p\x3e") + ((opt_data.hasBuilds) ? '<p>' + soy.$$escapeHtml("To get started, create a deployment project and link it to your build plan now!") + ((opt_data.hasGlobalCreatePermission) ? '<p>' + aui.buttons.button({text: "Create my first deployment project", type: 'primary', tagName: 'a', extraAttributes: {href: "" + '/deploy/config/newDeploymentProjectDetails.action'}}) + '</p>' : '') + '</p>' : '<p>' + soy.$$filterNoAutoescape(AJS.format("Before you can get started with deployments you need to \x3ca href\x3d\x22{0}\x22\x3ecreate a build plan\x3c/a\x3e that has some artifacts.","" + '/build/admin/create/newPlan.action')) + '</p>') + '</div></div></div><div class="infographic"><h2>' + soy.$$escapeHtml("How do deployments work?") + '</h2><img src="' + soy.$$escapeHtml("") + '/images/infographic/bamboo-deploy.png" /><div class="artifactText"><h3>' + soy.$$escapeHtml("Artifacts") + '</h3>' + soy.$$escapeHtml("Create deployable artifacts with build plans, just like always. Any artifacts you wish to deploy with Bamboo need to be \x22shared\x22.") + '</div><div class="versionText"><h3>' + soy.$$escapeHtml("Release") + '</h3>' + soy.$$escapeHtml("Any artifacts that have been tested to your satisfaction using a plan can be used to create a release. Bamboo preserves metadata related to your release, such as the JIRA issues and commits included. This allows for tracking changes across environments, easy traceability when troubleshooting, and creating powerful reports.") + '</div><div class="environmentText"><h3>' + soy.$$escapeHtml("Environments") + '</h3>' + soy.$$escapeHtml("Define environments in Bamboo to reflect the development, testing and production environments in your IT infrastructure. At any point in time, you\xe2\x80\x99ll be able to see which version of a release is running in each environment, when and who deployed it and what release it replaced.") + '</div></div>';
};
if (goog.DEBUG) {
  bamboo.feature.dashboard.welcomeMat.welcomeMessageDeploy.soyTemplateName = 'bamboo.feature.dashboard.welcomeMat.welcomeMessageDeploy';
}


bamboo.feature.dashboard.welcomeMat.importOptionsItem = function(opt_data, opt_ignored) {
  return '<li><a' + ((opt_data.href) ? ' href="' + soy.$$escapeHtml(opt_data.href) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.text) + '</a></li>';
};
if (goog.DEBUG) {
  bamboo.feature.dashboard.welcomeMat.importOptionsItem.soyTemplateName = 'bamboo.feature.dashboard.welcomeMat.importOptionsItem';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/icons.soy' */
// This file was automatically generated from icons.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.icons.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.icons == 'undefined') { widget.icons = {}; }


widget.icons.icon = function(opt_data, opt_ignored) {
  return '<span class="icon icon-' + soy.$$escapeHtml(opt_data.type) + '"' + ((opt_data.text && opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '') + '>' + ((opt_data.text) ? '<span>' + soy.$$escapeHtml(opt_data.text) + '</span>' : '') + '</span>';
};
if (goog.DEBUG) {
  widget.icons.icon.soyTemplateName = 'widget.icons.icon';
}


widget.icons.fontIcon = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-' + soy.$$escapeHtml(opt_data.type) + '"' + ((opt_data.text && opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '') + '>' + ((opt_data.text) ? '<span>' + soy.$$escapeHtml(opt_data.text) + '</span>' : '') + '</span>';
};
if (goog.DEBUG) {
  widget.icons.fontIcon.soyTemplateName = 'widget.icons.fontIcon';
}


widget.icons.auiFontLink = function(opt_data, opt_ignored) {
  return '<a ' + ((opt_data.text) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '" ' : '') + 'href="' + soy.$$escapeHtml("" + opt_data.relativeUrl) + '"><span class="aui-icon aui-icon-small aui-iconfont-' + soy.$$escapeHtml(opt_data.iconType) + '">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + '</span></a>';
};
if (goog.DEBUG) {
  widget.icons.auiFontLink.soyTemplateName = 'widget.icons.auiFontLink';
}


widget.icons.statusIcon = function(opt_data, opt_ignored) {
  return '' + ((opt_data.status == 'approve' || opt_data.status == 'project-success' || opt_data.status == 'Successful' || opt_data.status == 'SUCCESS' || opt_data.status == 'successful') ? widget.icons.fontIcon(soy.$$augmentMap(opt_data, {type: 'approve', text: opt_data.text, showTitle: opt_data.text ? true : false})) : (opt_data.status == 'error' || opt_data.status == 'project-fail' || opt_data.status == 'Failed' || opt_data.status == 'FAILED' || opt_data.status == 'failed') ? widget.icons.fontIcon(soy.$$augmentMap(opt_data, {type: 'error', text: opt_data.text, showTitle: opt_data.text ? true : false})) : (opt_data.status == 'task-cancelled' || opt_data.status == 'NotBuilt' || opt_data.status == 'notbuilt' || opt_data.status == 'NOT_BUILT' || opt_data.status == 'Unknown' || opt_data.status == 'UNKNOWN' || opt_data.status == 'unknown') ? widget.icons.fontIcon({type: 'devtools-task-cancelled', text: opt_data.text, showTitle: opt_data.text ? true : false}) : (opt_data.status == 'task-in-progress' || opt_data.status == 'Pending' || opt_data.status == 'PENDING' || opt_data.status == 'pending' || opt_data.status == 'Queued' || opt_data.status == 'QUEUED' || opt_data.status == 'queued') ? widget.icons.fontIcon(soy.$$augmentMap(opt_data, {type: 'devtools-task-in-progress', text: opt_data.text, showTitle: opt_data.text ? true : false})) : (opt_data.status == 'task-disabled' || opt_data.status == 'disabled' || opt_data.status == 'project-none' || opt_data.status == 'NeverExecuted' || opt_data.status == 'skipped' || opt_data.status == 'Suspended') ? widget.icons.fontIcon(soy.$$augmentMap(opt_data, {type: 'devtools-task-disabled', text: opt_data.text, showTitle: opt_data.text ? true : false})) : widget.icons.icon({type: opt_data.status + (opt_data.reversed ? ' icon-reversed' : ''), text: opt_data.text, showTitle: opt_data.text ? true : false}));
};
if (goog.DEBUG) {
  widget.icons.statusIcon.soyTemplateName = 'widget.icons.statusIcon';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/lozenges.soy' */
// This file was automatically generated from lozenges.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.lozenges.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.lozenges == 'undefined') { widget.lozenges = {}; }


widget.lozenges.lozenge = function(opt_data, opt_ignored) {
  return '<span class="lozenge lozenge-' + soy.$$escapeHtml(opt_data.colour ? opt_data.colour : 'default') + soy.$$escapeHtml(opt_data.subtle ? ' lozenge-subtle' : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$escapeHtml(opt_data.text) + '</span>';
};
if (goog.DEBUG) {
  widget.lozenges.lozenge.soyTemplateName = 'widget.lozenges.lozenge';
}


widget.lozenges.auilozenge = function(opt_data, opt_ignored) {
  return '<span class="aui-lozenge aui-lozenge-' + soy.$$escapeHtml(opt_data.colour ? opt_data.colour : 'default') + soy.$$escapeHtml(opt_data.subtle ? ' aui-lozenge-subtle' : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$escapeHtml(opt_data.text) + '</span>';
};
if (goog.DEBUG) {
  widget.lozenges.auilozenge.soyTemplateName = 'widget.lozenges.auilozenge';
}


widget.lozenges.branch = function(opt_data, opt_ignored) {
  return '<span class="' + ((opt_data.cssClass) ? soy.$$escapeHtml(opt_data.cssClass) : 'lozenge-newline') + '">' + ((opt_data.label) ? '<span class="inline-label">' + soy.$$escapeHtml(opt_data.label) + '</span> ' : '') + '<span class="lozenge branch-lozenge monospace" title="' + soy.$$escapeHtml(opt_data.planBranchName) + '"><span class="branch">' + aui.icons.icon({icon: 'devtools-branch-small', useIconFont: true}) + '<span class="name">' + soy.$$escapeHtml(opt_data.planBranchName) + '</span></span></span></span>';
};
if (goog.DEBUG) {
  widget.lozenges.branch.soyTemplateName = 'widget.lozenges.branch';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/status/status.soy' */
// This file was automatically generated from status.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.status.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.status == 'undefined') { widget.status = {}; }


widget.status.deploymentResultStatusLozenge = function(opt_data, opt_ignored) {
  var output = '';
  var colour__soy3 = '';
  if (opt_data.lifeCycleState == 'FINISHED') {
    switch (opt_data.deploymentState) {
      case 'UNKNOWN':
        colour__soy3 += 'current';
        break;
      case 'SUCCESS':
        colour__soy3 += 'success';
        break;
      case 'FAILED':
        colour__soy3 += 'error';
        break;
    }
  } else {
    switch (opt_data.lifeCycleState) {
      case 'PENDING':
        colour__soy3 += 'complete';
        break;
      case 'QUEUED':
        colour__soy3 += 'complete';
        break;
      case 'IN_PROGRESS':
        colour__soy3 += 'complete';
        break;
      case 'NOT_BUILT':
        colour__soy3 += 'current';
        break;
    }
  }
  var text__soy23 = '';
  if (opt_data.lifeCycleState == 'FINISHED') {
    switch (opt_data.deploymentState) {
      case 'UNKNOWN':
        text__soy23 += 'Unknown';
        break;
      case 'SUCCESS':
        text__soy23 += 'Success';
        break;
      case 'FAILED':
        text__soy23 += 'Failed';
        break;
    }
  } else {
    switch (opt_data.lifeCycleState) {
      case 'PENDING':
        text__soy23 += 'Queued';
        break;
      case 'QUEUED':
        text__soy23 += 'Queued';
        break;
      case 'IN_PROGRESS':
        text__soy23 += 'In Progress';
        break;
      case 'NOT_BUILT':
        text__soy23 += 'Not Built';
        break;
    }
  }
  output += widget.lozenges.auilozenge({colour: colour__soy3, text: text__soy23, subtle: opt_data.subtle});
  return output;
};
if (goog.DEBUG) {
  widget.status.deploymentResultStatusLozenge.soyTemplateName = 'widget.status.deploymentResultStatusLozenge';
}


widget.status.buildResultStatusIcon = function(opt_data, opt_ignored) {
  var output = '';
  var class__soy48 = '' + widget.status.buildResultStatusClass(opt_data);
  output += widget.icons.statusIcon({status: class__soy48});
  return output;
};
if (goog.DEBUG) {
  widget.status.buildResultStatusIcon.soyTemplateName = 'widget.status.buildResultStatusIcon';
}


widget.status.buildResultStatusClass = function(opt_data, opt_ignored) {
  return '' + ((opt_data.resultSummary.continuable && opt_data.resultSummary.successful) ? 'SuccessfulPartial' : (opt_data.resultSummary.notRunYet) ? 'NotRunYet' : (opt_data.resultSummary.finished) ? soy.$$escapeHtml(opt_data.resultSummary.buildState) : soy.$$escapeHtml(opt_data.resultSummary.lifeCycleState));
};
if (goog.DEBUG) {
  widget.status.buildResultStatusClass.soyTemplateName = 'widget.status.buildResultStatusClass';
}


widget.status.statusRibbon = function(opt_data, opt_ignored) {
  var output = '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="status-ribbon' + aui.renderExtraClasses(opt_data) + '" data-statuses="' + soy.$$escapeHtml(opt_data.statuses.length) + '"' + aui.renderExtraAttributes(opt_data) + '><div class="status-ribbon-inner">';
  var statusList77 = opt_data.statuses;
  var statusListLen77 = statusList77.length;
  for (var statusIndex77 = 0; statusIndex77 < statusListLen77; statusIndex77++) {
    var statusData77 = statusList77[statusIndex77];
    output += widget.status.statusRibbonItem(statusData77);
  }
  output += '</div>' + ((opt_data.progressbarContent) ? '<div class="status-ribbon-progress-bar">' + soy.$$filterNoAutoescape(opt_data.progressbarContent) + '</div>' : '') + '</div>';
  return output;
};
if (goog.DEBUG) {
  widget.status.statusRibbon.soyTemplateName = 'widget.status.statusRibbon';
}


widget.status.statusRibbonItem = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="status-ribbon-status ' + soy.$$escapeHtml(opt_data.state) + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><' + soy.$$escapeHtml(opt_data.headingTagName ? opt_data.headingTagName : 'h2') + ' class="status-ribbon-status-heading">' + widget.icons.statusIcon({status: opt_data.state, reversed: true}) + ' ' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.headingTagName ? opt_data.headingTagName : 'h2') + '></div>';
};
if (goog.DEBUG) {
  widget.status.statusRibbonItem.soyTemplateName = 'widget.status.statusRibbonItem';
}


widget.status.deploymentVersionStatus = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.deploymentVersionState && opt_data.deploymentVersionState != 'UNKNOWN') ? widget.lozenges.auilozenge({colour: '' + ((opt_data.deploymentVersionState == 'BROKEN' || opt_data.deploymentVersionState == 'INCOMPLETE') ? 'error' : 'success'), text: opt_data.deploymentVersionState, subtle: opt_data.subtle, extraClasses: 'version-lozenge'}) : '');
};
if (goog.DEBUG) {
  widget.status.deploymentVersionStatus.soyTemplateName = 'widget.status.deploymentVersionStatus';
}


widget.status.deploymentVersionStatusInfo = function(opt_data, opt_ignored) {
  return '' + ((opt_data.deploymentVersionState == 'APPROVED' || opt_data.deploymentVersionState == 'BROKEN') ? '<div class="detailed-version-info-container reviewed-user-avatar">' + aui.avatar.avatar({size: 'small', avatarImageUrl: opt_data.avatar ? opt_data.avatar : "" + '/images/icons/useravatar.png', accessibilityText: opt_data.userName ? opt_data.userName : "Anonymous user", title: opt_data.displayName ? opt_data.displayName : "Anonymous user", badgeContent: '' + ((opt_data.deploymentVersionState == 'BROKEN') ? '<span class="badge reviewed broken"></span>' : (opt_data.deploymentVersionState == 'APPROVED') ? '<span class="badge reviewed approved"></span>' : '')}) + '<script>AJS.$(".aui-avatar-inner > img").tooltip({gravity: \'n\'});<\/script></div>' : '');
};
if (goog.DEBUG) {
  widget.status.deploymentVersionStatusInfo.soyTemplateName = 'widget.status.deploymentVersionStatusInfo';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/agent.soy' */
// This file was automatically generated from agent.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.agent.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.agent == 'undefined') { widget.agent = {}; }


widget.agent.renderAgentNameLink = function(opt_data, opt_ignored) {
  return '' + ((opt_data.type == 'ELASTIC') ? (true) ? '<a href="' + soy.$$escapeHtml("" + '/admin/elastic/manageElasticInstances.action') + '">' + widget.icons.icon({type: 'elastic', text: '(elastic)', showTitle: true}) + '</a>' : widget.icons.icon({type: 'elastic', text: '(elastic)', showTitle: true}) : '') + ((opt_data.showAdminLink) ? '<a href="' + soy.$$escapeHtml("" + '/admin/agent/viewAgent.action?agentId=' + opt_data.id) + '">' + soy.$$escapeHtml(opt_data.name) + '</a>' : '<a href="' + soy.$$escapeHtml("" + '/agent/viewAgent.action?agentId=' + opt_data.id) + '">' + soy.$$escapeHtml(opt_data.name) + '</a>');
};
if (goog.DEBUG) {
  widget.agent.renderAgentNameLink.soyTemplateName = 'widget.agent.renderAgentNameLink';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/plan.soy' */
// This file was automatically generated from plan.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.plan.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.plan == 'undefined') { widget.plan = {}; }


widget.plan.renderPlanNameLink = function(opt_data, opt_ignored) {
  return '<a href="' + ((opt_data.url) ? soy.$$escapeHtml(opt_data.url) : soy.$$escapeHtml("" + '/browse/' + opt_data.plan.key)) + '" ' + ((opt_data.plan.description) ? 'title="' + soy.$$escapeHtml(opt_data.plan.description) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.plan.project.name) + ' &rsaquo; ' + ((opt_data.plan.master) ? soy.$$escapeHtml(opt_data.plan.master.buildName) + ' &rsaquo; ' + aui.icons.icon({icon: 'devtools-branch-small', useIconFont: true}) + ' ' : '') + soy.$$escapeHtml(opt_data.plan.buildName) + '</a>';
};
if (goog.DEBUG) {
  widget.plan.renderPlanNameLink.soyTemplateName = 'widget.plan.renderPlanNameLink';
}


widget.plan.renderPlanNameLinkWithoutBranch = function(opt_data, opt_ignored) {
  return '<a href="' + ((opt_data.url) ? soy.$$escapeHtml(opt_data.url) : soy.$$escapeHtml("" + '/browse/' + opt_data.plan.key)) + '" ' + ((opt_data.plan.description) ? 'title="' + soy.$$escapeHtml(opt_data.plan.description) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.plan.project.name) + ' &rsaquo; ' + ((opt_data.plan.master) ? soy.$$escapeHtml(opt_data.plan.master.buildName) : soy.$$escapeHtml(opt_data.plan.buildName)) + '</a>';
};
if (goog.DEBUG) {
  widget.plan.renderPlanNameLinkWithoutBranch.soyTemplateName = 'widget.plan.renderPlanNameLinkWithoutBranch';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/buildresult.soy' */
// This file was automatically generated from buildresult.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.buildresult.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.buildresult == 'undefined') { widget.buildresult = {}; }


widget.buildresult.resultStatusAndLink = function(opt_data, opt_ignored) {
  var output = '' + widget.status.buildResultStatusIcon(opt_data);
  var resultClass__soy5 = '' + widget.status.buildResultStatusClass(opt_data);
  output += ' <a href="' + soy.$$escapeHtml("" + '/browse/' + opt_data.resultSummary.planResultKey.key) + '" class="' + soy.$$escapeHtml(resultClass__soy5) + '">' + soy.$$escapeHtml('#' + opt_data.resultSummary.planResultKey.resultNumber) + '</a>';
  return output;
};
if (goog.DEBUG) {
  widget.buildresult.resultStatusAndLink.soyTemplateName = 'widget.buildresult.resultStatusAndLink';
}


widget.buildresult.resultStatus = function(opt_data, opt_ignored) {
  var output = '' + widget.status.buildResultStatusIcon(opt_data);
  var resultClass__soy18 = '' + widget.status.buildResultStatusClass(opt_data);
  output += ' <span class="' + soy.$$escapeHtml(resultClass__soy18) + '">' + soy.$$escapeHtml('#' + opt_data.resultSummary.planResultKey.resultNumber) + '</span>';
  return output;
};
if (goog.DEBUG) {
  widget.buildresult.resultStatus.soyTemplateName = 'widget.buildresult.resultStatus';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/autocomplete-controls/bamboo/plandependencies/plan-dependency.soy' */
// This file was automatically generated from plan-dependency.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.autocomplete.planDependency.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.autocomplete == 'undefined') { bamboo.widget.autocomplete = {}; }
if (typeof bamboo.widget.autocomplete.planDependency == 'undefined') { bamboo.widget.autocomplete.planDependency = {}; }


bamboo.widget.autocomplete.planDependency.list = function(opt_data, opt_ignored) {
  var output = '<ul class="' + soy.$$escapeHtml(opt_data.dependencies.length == 0 ? 'empty' : '') + aui.renderExtraClasses(opt_data) + '">';
  var dependencyList7 = opt_data.dependencies;
  var dependencyListLen7 = dependencyList7.length;
  for (var dependencyIndex7 = 0; dependencyIndex7 < dependencyListLen7; dependencyIndex7++) {
    var dependencyData7 = dependencyList7[dependencyIndex7];
    var plan__soy8 = opt_data.isParent ? dependencyData7.childPlan : dependencyData7.parentPlan;
    output += '<li data-id="' + soy.$$escapeHtml(plan__soy8.key) + '">' + bamboo.widget.autocomplete.planDependency.item({id: plan__soy8.key, projectName: plan__soy8.project.name, planName: plan__soy8.buildName, isEditable: dependencyData7.editable, isReadOnly: opt_data.isReadOnly}) + '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.planDependency.list.soyTemplateName = 'bamboo.widget.autocomplete.planDependency.list';
}


bamboo.widget.autocomplete.planDependency.item = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml("" + '/chain/admin/config/editChainDependencies.action?buildKey=' + opt_data.id) + '">' + soy.$$escapeHtml(opt_data.projectName) + ((opt_data.planName) ? ' &rsaquo; ' + soy.$$escapeHtml(opt_data.planName) : '') + '</a>' + ((! (opt_data.isEditable == false)) ? (! opt_data.isReadOnly) ? '<a class="remove"></a><input type="hidden" name="childPlanKeys" value="' + soy.$$escapeHtml(opt_data.id) + '" />' : '' : widget.lozenges.lozenge({text: "Generated", subtle: true, extraClasses: 'dependencies-generated'}));
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.planDependency.item.soyTemplateName = 'bamboo.widget.autocomplete.planDependency.item';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/autocomplete-controls/bamboo/projectfilter/project-filter.soy' */
// This file was automatically generated from project-filter.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.autocomplete.projectFilter.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.autocomplete == 'undefined') { bamboo.widget.autocomplete = {}; }
if (typeof bamboo.widget.autocomplete.projectFilter == 'undefined') { bamboo.widget.autocomplete.projectFilter = {}; }


bamboo.widget.autocomplete.projectFilter.list = function(opt_data, opt_ignored) {
  var output = '<ul class="' + soy.$$escapeHtml(opt_data.projects.length == 0 ? 'empty' : '') + aui.renderExtraClasses(opt_data) + '">';
  var projectList7 = opt_data.projects;
  var projectListLen7 = projectList7.length;
  for (var projectIndex7 = 0; projectIndex7 < projectListLen7; projectIndex7++) {
    var projectData7 = projectList7[projectIndex7];
    output += '<li data-id="' + soy.$$escapeHtml(projectData7.id) + '">' + bamboo.widget.autocomplete.projectFilter.item({id: projectData7.id, projectName: projectData7.name}) + '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.projectFilter.list.soyTemplateName = 'bamboo.widget.autocomplete.projectFilter.list';
}


bamboo.widget.autocomplete.projectFilter.item = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml("" + '/browse/' + opt_data.id) + '">' + soy.$$escapeHtml(opt_data.projectName) + '</a><a class="remove"></a><input type="hidden" name="selectedProjectKeys" value="' + soy.$$escapeHtml(opt_data.id) + '" />';
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.projectFilter.item.soyTemplateName = 'bamboo.widget.autocomplete.projectFilter.item';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/autocomplete-controls/bamboo/variables/variable-multiselect.soy' */
// This file was automatically generated from variable-multiselect.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.autocomplete.variableSelect.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.autocomplete == 'undefined') { bamboo.widget.autocomplete = {}; }
if (typeof bamboo.widget.autocomplete.variableSelect == 'undefined') { bamboo.widget.autocomplete.variableSelect = {}; }


bamboo.widget.autocomplete.variableSelect.list = function(opt_data, opt_ignored) {
  var output = '<ul class="' + soy.$$escapeHtml(opt_data.variablesToAutoIncrement.length == 0 ? 'empty' : '') + aui.renderExtraClasses(opt_data) + '">';
  var variableList7 = opt_data.variablesToAutoIncrement;
  var variableListLen7 = variableList7.length;
  for (var variableIndex7 = 0; variableIndex7 < variableListLen7; variableIndex7++) {
    var variableData7 = variableList7[variableIndex7];
    output += '<li data-id="' + soy.$$escapeHtml(variableData7.key) + '">' + bamboo.widget.autocomplete.variableSelect.item(variableData7) + '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.variableSelect.list.soyTemplateName = 'bamboo.widget.autocomplete.variableSelect.list';
}


bamboo.widget.autocomplete.variableSelect.item = function(opt_data, opt_ignored) {
  return soy.$$escapeHtml(opt_data.key) + '<a class="remove"></a><input type="hidden" name="variablesToAutoIncrement" value="' + soy.$$escapeHtml(opt_data.key) + '" />';
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.variableSelect.item.soyTemplateName = 'bamboo.widget.autocomplete.variableSelect.item';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/plan-status-history/plan-status-history.soy' */
// This file was automatically generated from plan-status-history.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.planStatusHistory.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.planStatusHistory == 'undefined') { bamboo.widget.planStatusHistory = {}; }


bamboo.widget.planStatusHistory.container = function(opt_data, opt_ignored) {
  return '<div id="' + soy.$$escapeHtml(opt_data.id) + '"></div><script type="text/javascript">require([\'jquery\', \'widget/plan-status-history\'], function($, PlanStatusHistory){return new PlanStatusHistory({el: $(\'#' + soy.$$escapeHtml(opt_data.id) + '\'), planKey: \'' + soy.$$escapeHtml(opt_data.planKey) + '\', buildNumber: ' + soy.$$escapeHtml(opt_data.currentBuildNumber ? opt_data.currentBuildNumber : 'null') + ', bootstrap: ' + soy.$$filterNoAutoescape(opt_data.bootstrap) + ', returnUrl: \'' + soy.$$filterNoAutoescape(opt_data.returnUrl) + '\', keyToNavigate: \'' + soy.$$escapeHtml(opt_data.keyToNavigate) + '\', firstBuildNumber: ' + soy.$$escapeHtml(opt_data.firstBuildNumber ? opt_data.firstBuildNumber : 'null') + ', lastBuildNumber: ' + soy.$$escapeHtml(opt_data.lastBuildNumber ? opt_data.lastBuildNumber : 'null') + '});});<\/script>';
};
if (goog.DEBUG) {
  bamboo.widget.planStatusHistory.container.soyTemplateName = 'bamboo.widget.planStatusHistory.container';
}


bamboo.widget.planStatusHistory.navigator = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.builds.length > 0) {
    output += aui.icons.icon({icon: 'wait', useIconFont: false, size: 'small', extraClasses: 'spinner previous'}) + ((opt_data.minVisibleBuildNumber && opt_data.minVisibleBuildNumber > opt_data.firstBuildNumber) ? '<a class="button previous" title="' + soy.$$escapeHtml("Previous build result") + '" accesskey="' + soy.$$escapeHtml("P") + '">' + aui.icons.icon({icon: 'down', useIconFont: true, size: 'small', extraClasses: 'left'}) + '</a>' : '<span class="button previous disabled">' + aui.icons.icon({icon: 'down', useIconFont: true, size: 'small', extraClasses: 'left'}) + '</span>') + '<ol>';
    var buildList54 = opt_data.builds;
    var buildListLen54 = buildList54.length;
    for (var buildIndex54 = 0; buildIndex54 < buildListLen54; buildIndex54++) {
      var buildData54 = buildList54[buildIndex54];
      output += bamboo.widget.planStatusHistory.item(soy.$$augmentMap(buildData54, {href: "" + (opt_data.currentBuildNumber ? '/build/result/gotoBuildResult.action?buildKey=' + opt_data.keyToNavigate + '&buildNumber=' + buildData54.buildNumber + '&returnUrl=' + opt_data.returnUrl : '/browse/' + buildData54.planKey + '-' + buildData54.buildNumber), isCurrent: opt_data.currentBuildNumber && opt_data.currentBuildNumber == buildData54.buildNumber}));
    }
    output += '</ol>' + ((opt_data.showRightArrow) ? '<a class="button next" title="' + soy.$$escapeHtml("Next build result") + '" accesskey="' + soy.$$escapeHtml("N") + '">' + aui.icons.icon({icon: 'up', useIconFont: true, size: 'small', extraClasses: 'right'}) + '</a>' : '<span class="button next disabled">' + aui.icons.icon({icon: 'up', useIconFont: true, size: 'small', extraClasses: 'right'}) + '</span>') + aui.icons.icon({icon: 'wait', useIconFont: false, size: 'small', extraClasses: 'spinner next'});
  } else {
    output += '<p>' + soy.$$escapeHtml("Status history data not available") + '</p>';
  }
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.planStatusHistory.navigator.soyTemplateName = 'bamboo.widget.planStatusHistory.navigator';
}


bamboo.widget.planStatusHistory.buildDialog = function(opt_data, opt_ignored) {
  return '<div>' + widget.icons.statusIcon({status: opt_data.buildStatus, text: '#' + opt_data.buildNumber + ' (' + opt_data.buildStatusDescription + ')'}) + '<strong>#' + soy.$$escapeHtml(opt_data.buildNumber) + '</strong>' + ((opt_data.onceOff) ? widget.lozenges.lozenge({color: 'complete', text: "Custom revision"}) : '') + ((opt_data.rebuild) ? widget.lozenges.lozenge({color: 'moved', text: "Rebuild"}) : '') + ((opt_data.customBuild) ? widget.lozenges.lozenge({color: 'current', text: "Custom build"}) : '') + '<p>' + soy.$$filterNoAutoescape(opt_data.triggerHtml) + '</p>' + ((opt_data.hasFailed) ? ((opt_data.existingFailuresText) ? '<p>' + soy.$$escapeHtml(opt_data.existingFailuresText) + '</p>' : '') + ((opt_data.newFailuresText) ? '<p>' + soy.$$escapeHtml(opt_data.newFailuresText) + '</p>' : '') + ((! (opt_data.existingFailuresText || opt_data.newFailuresText)) ? '<p>' + soy.$$escapeHtml("0 tests failed") + '</p>' : '') : '') + '</div>';
};
if (goog.DEBUG) {
  bamboo.widget.planStatusHistory.buildDialog.soyTemplateName = 'bamboo.widget.planStatusHistory.buildDialog';
}


bamboo.widget.planStatusHistory.item = function(opt_data, opt_ignored) {
  return '<li class="' + soy.$$escapeHtml(opt_data.buildStatus) + ((opt_data.isCurrent) ? ' current' : '') + ' animated' + aui.renderExtraClasses(opt_data) + '" data-build-number="' + soy.$$escapeHtml(opt_data.buildNumber) + '" data-trigger="' + soy.$$escapeHtml(opt_data.trigger) + '" data-new-failed-test-case-count="' + soy.$$escapeHtml(opt_data.newFailedTestCaseCount) + '" data-existing-failed-test-case-count="' + soy.$$escapeHtml(opt_data.existingFailedTestCaseCount) + '" data-rebuild="' + soy.$$escapeHtml(opt_data.rebuild) + '" data-once-off="' + soy.$$escapeHtml(opt_data.onceOff) + '" data-custom-build="' + soy.$$escapeHtml(opt_data.customBuild) + '" ><a href="' + soy.$$escapeHtml(opt_data.href) + '">' + widget.icons.statusIcon({status: opt_data.buildStatus, text: '#' + opt_data.buildNumber + ' (' + opt_data.buildStatusDescription + ')'}) + '</a></li>';
};
if (goog.DEBUG) {
  bamboo.widget.planStatusHistory.item.soyTemplateName = 'bamboo.widget.planStatusHistory.item';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/nav/nav.soy' */
// This file was automatically generated from nav.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.nav.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.nav == 'undefined') { bamboo.widget.nav = {}; }


bamboo.widget.nav.horizontal = function(opt_data, opt_ignored) {
  var output = '<nav class="aui-navgroup aui-navgroup-horizontal"><div class="aui-navgroup-inner"><div class="aui-navgroup-primary"><ul class="aui-nav">';
  var itemList4 = opt_data.items;
  var itemListLen4 = itemList4.length;
  for (var itemIndex4 = 0; itemIndex4 < itemListLen4; itemIndex4++) {
    var itemData4 = itemList4[itemIndex4];
    output += bamboo.widget.nav.navItem(itemData4);
  }
  output += '</ul></div></div></nav>';
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.nav.horizontal.soyTemplateName = 'bamboo.widget.nav.horizontal';
}


bamboo.widget.nav.navItem = function(opt_data, opt_ignored) {
  return '<li' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="' + ((opt_data.isSelected) ? 'aui-nav-selected' : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><a' + ((opt_data.href) ? ' href="' + soy.$$escapeHtml(opt_data.href) + '"' : '') + ((opt_data.linkId) ? ' id="' + soy.$$escapeHtml(opt_data.linkId) + '"' : '') + ' class="' + aui.renderExtraClasses(opt_data) + '">' + soy.$$filterNoAutoescape(opt_data.content) + ((opt_data.badge && opt_data.badge.text) ? ' ' + aui.badges.badge(opt_data.badge) : '') + '</a></li>';
};
if (goog.DEBUG) {
  bamboo.widget.nav.navItem.soyTemplateName = 'bamboo.widget.nav.navItem';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/nav/tabs.soy' */
// This file was automatically generated from tabs.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.nav.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.nav == 'undefined') { bamboo.widget.nav = {}; }


bamboo.widget.nav.tabs = function(opt_data, opt_ignored) {
  var output = '<nav class="aui-tabs horizontal-tabs "><ul class="tabs-menu">';
  var itemList4 = opt_data.items;
  var itemListLen4 = itemList4.length;
  for (var itemIndex4 = 0; itemIndex4 < itemListLen4; itemIndex4++) {
    var itemData4 = itemList4[itemIndex4];
    output += bamboo.widget.nav.tab(itemData4);
  }
  output += '</ul></nav>';
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.nav.tabs.soyTemplateName = 'bamboo.widget.nav.tabs';
}


bamboo.widget.nav.tab = function(opt_data, opt_ignored) {
  return '<li ' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="menu-item' + ((opt_data.isSelected) ? ' active-tab' + aui.renderExtraClasses(opt_data) + '"' : ' ' + aui.renderExtraClasses(soy.$$augmentMap(opt_data, {isFullAttr: true})) + '"') + aui.renderExtraAttributes(opt_data) + '><a' + ((opt_data.href) ? ' href="' + soy.$$escapeHtml(opt_data.href) + '"' : '') + ((opt_data.linkId) ? ' id="' + soy.$$escapeHtml(opt_data.linkId) + '"' : '') + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</a></li>';
};
if (goog.DEBUG) {
  bamboo.widget.nav.tab.soyTemplateName = 'bamboo.widget.nav.tab';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/nav/bread-crumb.soy' */
// This file was automatically generated from bread-crumb.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.nav.breadcrumb.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.nav == 'undefined') { bamboo.widget.nav = {}; }
if (typeof bamboo.widget.nav.breadcrumb == 'undefined') { bamboo.widget.nav.breadcrumb = {}; }


bamboo.widget.nav.breadcrumb.crumbContainer = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<ol ' + ((opt_data.id) ? 'id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-nav aui-nav-breadcrumbs">';
  if (opt_data.parentCrumbs && opt_data.parentCrumbs.length > 0) {
    var crumbList12 = opt_data.parentCrumbs;
    var crumbListLen12 = crumbList12.length;
    for (var crumbIndex12 = 0; crumbIndex12 < crumbListLen12; crumbIndex12++) {
      var crumbData12 = crumbList12[crumbIndex12];
      output += bamboo.widget.nav.breadcrumb.showParentCrumb(crumbData12);
    }
  }
  output += ((opt_data.currentCrumb) ? bamboo.widget.nav.breadcrumb.showCurrentCrumb(opt_data.currentCrumb) : '') + '</ol>';
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.nav.breadcrumb.crumbContainer.soyTemplateName = 'bamboo.widget.nav.breadcrumb.crumbContainer';
}


bamboo.widget.nav.breadcrumb.showParentCrumb = function(opt_data, opt_ignored) {
  return '<li' + aui.renderExtraClasses(soy.$$augmentMap(opt_data, {isFullAttr: true})) + '><a href="' + soy.$$escapeHtml(opt_data.link) + '"' + ((opt_data.id) ? ' id="breadcrumb:' + soy.$$escapeHtml(opt_data.id) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.text) + '</a></li>';
};
if (goog.DEBUG) {
  bamboo.widget.nav.breadcrumb.showParentCrumb.soyTemplateName = 'bamboo.widget.nav.breadcrumb.showParentCrumb';
}


bamboo.widget.nav.breadcrumb.showCurrentCrumb = function(opt_data, opt_ignored) {
  return '<li class="aui-nav-selected' + aui.renderExtraClasses(opt_data) + '">' + soy.$$escapeHtml(opt_data.text) + '</li>';
};
if (goog.DEBUG) {
  bamboo.widget.nav.breadcrumb.showCurrentCrumb.soyTemplateName = 'bamboo.widget.nav.breadcrumb.showCurrentCrumb';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/help/help.soy' */
// This file was automatically generated from help.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.help.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.help == 'undefined') { bamboo.widget.help = {}; }


bamboo.widget.help.panel = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.link ? 'a' : 'div') + ' class="help-panel' + ((opt_data.type) ? ' help-panel-' + soy.$$escapeHtml(opt_data.type) : '') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.link) ? ' href="' + soy.$$escapeHtml(opt_data.link) + '"' : '') + aui.renderExtraAttributes(opt_data) + '><strong class="help-panel-title">' + soy.$$escapeHtml(opt_data.title) + '</strong><div class="help-panel-content">' + soy.$$filterNoAutoescape(opt_data.content) + '</div></' + soy.$$escapeHtml(opt_data.link ? 'a' : 'div') + '>';
};
if (goog.DEBUG) {
  bamboo.widget.help.panel.soyTemplateName = 'bamboo.widget.help.panel';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/time/time.soy' */
// This file was automatically generated from time.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.time.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.time == 'undefined') { bamboo.widget.time = {}; }


bamboo.widget.time.timestamp = function(opt_data, opt_ignored) {
  return '' + bamboo.widget.time.time(soy.$$augmentMap(opt_data, {content: opt_data.format ? BAMBOO.Time.format(opt_data.datetime, opt_data.format) : BAMBOO.Time.format(opt_data.datetime, 'short')}));
};
if (goog.DEBUG) {
  bamboo.widget.time.timestamp.soyTemplateName = 'bamboo.widget.time.timestamp';
}


bamboo.widget.time.relative = function(opt_data, opt_ignored) {
  return '' + bamboo.widget.time.time(soy.$$augmentMap(opt_data, {content: opt_data.format ? BAMBOO.Time.format(opt_data.datetime, opt_data.format + 'Age') : BAMBOO.Time.format(opt_data.datetime, 'shortAge')}));
};
if (goog.DEBUG) {
  bamboo.widget.time.relative.soyTemplateName = 'bamboo.widget.time.relative';
}


bamboo.widget.time.time = function(opt_data, opt_ignored) {
  return '<time datetime="' + soy.$$escapeHtml(BAMBOO.Time.format(opt_data.datetime, 'timestamp')) + '" title="' + soy.$$escapeHtml(BAMBOO.Time.format(opt_data.datetime, 'full')) + '"' + aui.renderExtraClasses(soy.$$augmentMap(opt_data, {isFullAttr: true})) + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</time>';
};
if (goog.DEBUG) {
  bamboo.widget.time.time.soyTemplateName = 'bamboo.widget.time.time';
}
;
;
/* module-key = 'bamboo.web.resources:server-soy-templates', location = '/widget/tooltip/tooltip.soy' */
// This file was automatically generated from tooltip.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.tooltip.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.tooltip == 'undefined') { bamboo.widget.tooltip = {}; }


bamboo.widget.tooltip.tooltip = function(opt_data, opt_ignored) {
  return '<script type="text/javascript">require([\'aui\', \'jquery\', \'underscore\'], function(AJS, $, _){var $element = $(\'' + soy.$$escapeHtml(opt_data.trigger) + '\'); AJS.InlineDialog( $element, undefined' + ((opt_data.url) ? ',\'' + soy.$$escapeHtml("") + soy.$$escapeJsString(opt_data.url) + '\'' : ',function(content, trigger, showPopup){content .css({padding: \'20px\'}) .html(_.unescape(\'' + soy.$$escapeHtml(opt_data.content) + '\')); showPopup(); return false;}') + ',{' + ((opt_data.width) ? ' width: ' + soy.$$escapeHtml(opt_data.width) + ' ' : '') + ((opt_data.showDelay) ? ' ' + ((opt_data.width) ? ',' : '') + ' showDelay: ' + soy.$$escapeHtml(opt_data.showDelay) : '') + ((opt_data.width || opt_data.showDelay) ? ',' : '') + ' onHover: true});' + ((opt_data.addMarker) ? '$element.addClass(\'tooltip-marker\');' : '') + '});<\/script>';
};
if (goog.DEBUG) {
  bamboo.widget.tooltip.tooltip.soyTemplateName = 'bamboo.widget.tooltip.tooltip';
}
;
;
/* module-key = 'bamboo.deployments:deployments-main', location = '/layout/deployment/deployment.soy' */
// This file was automatically generated from deployment.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.layout.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.layout == 'undefined') { bamboo.layout = {}; }


bamboo.layout.deployment = function(opt_data, opt_ignored) {
  return '' + bamboo.layout.base(soy.$$augmentMap(opt_data, {headerMainContent: '' + ((opt_data.parentCrumbs) ? bamboo.widget.nav.breadcrumb.crumbContainer(opt_data) : '') + ((opt_data.headerText) ? '<h1>' + soy.$$escapeHtml(opt_data.headerText) + '</h1>' : (opt_data.headerContent) ? soy.$$filterNoAutoescape(opt_data.headerContent) : ''), headerExtraContent: '' + ((opt_data.deploymentProject && opt_data.deploymentProject.description) ? '<div class="deployment-project-description">' + soy.$$escapeHtml(opt_data.deploymentProject.description) + '</div>' : '') + ((opt_data.headerExtraContent) ? soy.$$filterNoAutoescape(opt_data.headerExtraContent) : '')}));
};
if (goog.DEBUG) {
  bamboo.layout.deployment.soyTemplateName = 'bamboo.layout.deployment';
}
;
;
/* module-key = 'bamboo.deployments:deployments-main', location = '/layout/deployment/deployment.js' */
/* Don't put anything in here unless you have permission from JASON.
 Please use specific js files for each individual page and/or feature */

(function (BAMBOO)
{
    BAMBOO.DEPLOYMENT = {};

}(window.BAMBOO = (window.BAMBOO || {})));

AJS.$(function(){
    AJS.$("span.branch-lozenge, span.icon-deploy-success, span.icon-deploy-fail, span.aui-icon-deploy-success, span.aui-icon-deploy-fail").tooltip({gravity: 'n'});
});;
;
/* module-key = 'bamboo.deployments:deployments-main', location = '/widget/aui-override.soy' */
// This file was automatically generated from aui-override.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.override.aui.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.override == 'undefined') { widget.override = {}; }
if (typeof widget.override.aui == 'undefined') { widget.override.aui = {}; }


widget.override.aui.badgeButton = function(opt_data, opt_ignored) {
  return '' + ((opt_data.href) ? '<a href="' + soy.$$escapeHtml(opt_data.href) + '"' + widget.override.aui.badgeButtonAttributes(opt_data) + '>' + widget.override.aui.badgeButtonIcon(opt_data) + soy.$$escapeHtml(opt_data.text) + '</a>' : (opt_data.tagName == 'input') ? '<input type="' + soy.$$escapeHtml(opt_data.inputType ? opt_data.inputType : 'button') + '" ' + widget.override.aui.badgeButtonAttributes(opt_data) + ' value="' + soy.$$escapeHtml(opt_data.text) + '" />' : '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'button') + widget.override.aui.badgeButtonAttributes(opt_data) + '>' + widget.override.aui.badgeButtonIcon(opt_data) + soy.$$escapeHtml(opt_data.text) + ' <span class="aui-badge">' + soy.$$escapeHtml(opt_data.badgeText) + '</span></' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'button') + '>');
};
if (goog.DEBUG) {
  widget.override.aui.badgeButton.soyTemplateName = 'widget.override.aui.badgeButton';
}


widget.override.aui.badgeButtonAttributes = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-button' + ((opt_data.dropdown2Target) ? ' aui-dropdown2-trigger' : '');
  switch (opt_data.type) {
    case 'primary':
      output += ' aui-button-primary';
      break;
    case 'link':
      output += ' aui-button-link';
      break;
    case 'subtle':
      output += ' aui-button-subtle';
      break;
  }
  output += aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + ((opt_data.isPressed) ? ' aria-pressed="' + soy.$$escapeHtml(opt_data.isPressed) + '"' : '') + ((opt_data.isDisabled) ? ' aria-disabled="' + soy.$$escapeHtml(opt_data.isDisabled) + '"' + ((opt_data.isDisabled == true) ? (opt_data.tagName == 'button' || opt_data.tagName == 'input') ? ' disabled="disabled" ' : '' : '') : '') + ((opt_data.dropdown2Target) ? ' aria-owns="' + soy.$$escapeHtml(opt_data.dropdown2Target) + '" aria-haspopup="true"' : '') + ((opt_data.tagName == 'a') ? ' tabindex="0"' : '');
  return output;
};
if (goog.DEBUG) {
  widget.override.aui.badgeButtonAttributes.soyTemplateName = 'widget.override.aui.badgeButtonAttributes';
}


widget.override.aui.badgeButtonIcon = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.iconType) ? '<span class="' + ((opt_data.iconType == 'aui') ? 'aui-icon' : '') + ((opt_data.iconClass) ? ' ' + soy.$$escapeHtml(opt_data.iconClass) : '') + '">' + ((opt_data.iconText) ? soy.$$escapeHtml(opt_data.iconText) : '') + '</span>' : '');
};
if (goog.DEBUG) {
  widget.override.aui.badgeButtonIcon.soyTemplateName = 'widget.override.aui.badgeButtonIcon';
}
;
;
/* module-key = 'bamboo.deployments:deployments-main', location = '/widget/deployment/version.soy' */
// This file was automatically generated from version.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.deployment.version.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.deployment == 'undefined') { bamboo.widget.deployment = {}; }
if (typeof bamboo.widget.deployment.version == 'undefined') { bamboo.widget.deployment.version = {}; }


bamboo.widget.deployment.version.versionInfo = function(opt_data, opt_ignored) {
  return '' + ((opt_data.version) ? ((opt_data.showVersionStatus && opt_data.version.versionStatus) ? '<div class="release-info">' + bamboo.widget.deployment.version.name(opt_data.version) + '</div>' : bamboo.widget.deployment.version.name(opt_data.version)) + ((opt_data.showBranch) ? ' ' + bamboo.widget.deployment.version.branch(opt_data.version) : '') + ((opt_data.showVersionStatus && opt_data.version.versionStatus) ? ' ' + widget.status.deploymentVersionStatusInfo({avatar: opt_data.version.versionStatus.gravatarUrl, userName: opt_data.version.versionStatus.userName, displayName: opt_data.version.versionStatus.displayName, deploymentVersionState: opt_data.version.versionStatus.versionState}) : '') : '');
};
if (goog.DEBUG) {
  bamboo.widget.deployment.version.versionInfo.soyTemplateName = 'bamboo.widget.deployment.version.versionInfo';
}


bamboo.widget.deployment.version.name = function(opt_data, opt_ignored) {
  return '<a class="release-name" href="' + soy.$$escapeHtml("") + '/deploy/viewDeploymentVersion.action?versionId=' + soy.$$escapeHtml(opt_data.id) + '">' + soy.$$escapeHtml(opt_data.name) + '</a>';
};
if (goog.DEBUG) {
  bamboo.widget.deployment.version.name.soyTemplateName = 'bamboo.widget.deployment.version.name';
}


bamboo.widget.deployment.version.branch = function(opt_data, opt_ignored) {
  return '<span class="lozenge-newline">' + ((opt_data.label) ? '<span class="inline-label">' + soy.$$escapeHtml(opt_data.label) + '</span> ' : '') + '<span class="lozenge branch-lozenge monospace" title="' + soy.$$escapeHtml(opt_data.planBranchName) + '"><span class="branch">' + aui.icons.icon({icon: 'devtools-branch-small', useIconFont: true}) + '<span class="name">' + soy.$$escapeHtml(opt_data.planBranchName) + '</span></span></span></span>';
};
if (goog.DEBUG) {
  bamboo.widget.deployment.version.branch.soyTemplateName = 'bamboo.widget.deployment.version.branch';
}
;
;
/* module-key = 'bamboo.deployments:result-features', location = '/feature/deployment/result/deployment-result-details.soy' */
// This file was automatically generated from deployment-result-details.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.deployment.result.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.deployment == 'undefined') { bamboo.feature.deployment = {}; }
if (typeof bamboo.feature.deployment.result == 'undefined') { bamboo.feature.deployment.result = {}; }


bamboo.feature.deployment.result.finishedTimeOrDuration = function(opt_data, opt_ignored) {
  var output = '';
  var resultUrl__soy3 = '' + soy.$$escapeHtml("" + '/deploy/viewDeploymentResult.action?deploymentResultId=' + opt_data.id);
  output += (opt_data.finishedDate) ? bamboo.widget.time.timestamp({datetime: opt_data.finishedDate, format: 'full'}) : (opt_data.lifeCycleState == 'PENDING' && opt_data.startedDate) ? (opt_data.hideLink) ? soy.$$filterNoAutoescape(AJS.format("Waiting for {0}",BAMBOO.Time.elapsedTime(opt_data.startedDate))) : soy.$$filterNoAutoescape(AJS.format("\x3ca href\x3d\x22{0}\x22\x3eWaiting for\x3c/a\x3e {1}",resultUrl__soy3,BAMBOO.Time.elapsedTime(opt_data.startedDate))) : (opt_data.lifeCycleState == 'QUEUED' && opt_data.queuedDate) ? (opt_data.hideLink) ? soy.$$filterNoAutoescape(AJS.format("Waiting for {0}",BAMBOO.Time.elapsedTime(opt_data.queuedDate))) : soy.$$filterNoAutoescape(AJS.format("\x3ca href\x3d\x22{0}\x22\x3eWaiting for\x3c/a\x3e {1}",resultUrl__soy3,BAMBOO.Time.elapsedTime(opt_data.queuedDate))) : (opt_data.lifeCycleState == 'IN_PROGRESS' && opt_data.executedDate) ? (opt_data.hideLink) ? soy.$$filterNoAutoescape(AJS.format("Deploying for {0}",BAMBOO.Time.elapsedTime(opt_data.executedDate))) : soy.$$filterNoAutoescape(AJS.format("\x3ca href\x3d\x22{0}\x22\x3eDeploying for\x3c/a\x3e {1}",resultUrl__soy3,BAMBOO.Time.elapsedTime(opt_data.executedDate))) : '';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.deployment.result.finishedTimeOrDuration.soyTemplateName = 'bamboo.feature.deployment.result.finishedTimeOrDuration';
}


bamboo.feature.deployment.result.environmentState = function(opt_data, opt_ignored) {
  return '' + ((opt_data.deploymentResult.lifeCycleState == 'PENDING' || opt_data.deploymentResult.lifeCycleState == 'QUEUED') ? widget.icons.statusIcon({status: 'pending'}) : (opt_data.deploymentResult.lifeCycleState == 'IN_PROGRESS') ? widget.icons.icon({type: 'building'}) : (opt_data.deploymentResult.lifeCycleState == 'FINISHED') ? (opt_data.deploymentResult.deploymentState == 'FAILED') ? widget.icons.fontIcon({type: 'deploy-fail', text: '' + ((opt_data.isLatestResult) ? soy.$$escapeHtml("The last deployment on this environment failed. This environment is currently broken.") : soy.$$escapeHtml("Deploying the release on this environment failed.")), showTitle: 'true'}) : (opt_data.deploymentResult.deploymentState == 'SUCCESS') ? widget.icons.fontIcon({type: 'deploy-success', text: '' + ((opt_data.isLatestResult) ? soy.$$escapeHtml("The last deployment on this environment was successful.") : soy.$$escapeHtml("Deploying the release on this environment was successful.")), showTitle: 'true'}) : widget.icons.icon({type: 'deploy-unknown'}) : widget.icons.icon({type: 'deploy-unknown'})) + bamboo.feature.deployment.result.detailsLink(opt_data);
};
if (goog.DEBUG) {
  bamboo.feature.deployment.result.environmentState.soyTemplateName = 'bamboo.feature.deployment.result.environmentState';
}


bamboo.feature.deployment.result.detailsLink = function(opt_data, opt_ignored) {
  return '' + ((opt_data.showDetailsLinkAlways || opt_data.deploymentResult.lifeCycleState == 'PENDING' || opt_data.deploymentResult.lifeCycleState == 'QUEUED' || opt_data.deploymentResult.lifeCycleState == 'IN_PROGRESS' || opt_data.deploymentResult.lifeCycleState == 'FINISHED' && opt_data.deploymentResult.deploymentState == 'FAILED') ? '<a class="result-details-link" href="' + soy.$$escapeHtml("" + '/deploy/viewDeploymentResult.action?deploymentResultId=' + opt_data.deploymentResult.id) + '" data-version-id="' + soy.$$escapeHtml(opt_data.deploymentResult.id) + '" data-version-name="' + soy.$$escapeHtml(opt_data.deploymentResult.deploymentVersionName) + '" >' + soy.$$escapeHtml("Logs") + '</a>' : '');
};
if (goog.DEBUG) {
  bamboo.feature.deployment.result.detailsLink.soyTemplateName = 'bamboo.feature.deployment.result.detailsLink';
}


bamboo.feature.deployment.result.nowAt = function(opt_data, opt_ignored) {
  var output = '';
  var versionLink__soy85 = '' + bamboo.feature.deployment.result.version(soy.$$augmentMap(opt_data.deploymentResult, {hideLozenge: true}));
  var timestamp__soy88 = '' + ((opt_data.deploymentResult.finishedDate) ? 'Deployed ' : '') + bamboo.feature.deployment.result.finishedTimeOrDuration(opt_data.deploymentResult);
  output += '<span id="' + soy.$$escapeHtml('nowAtResult_' + opt_data.deploymentResult.id) + '" class="environment-now-at">' + soy.$$filterNoAutoescape(AJS.format("now at {0}",versionLink__soy85)) + '</span>' + bamboo.widget.tooltip.tooltip({trigger: '#nowAtResult_' + opt_data.deploymentResult.id, content: timestamp__soy88, showDelay: 200});
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.deployment.result.nowAt.soyTemplateName = 'bamboo.feature.deployment.result.nowAt';
}


bamboo.feature.deployment.result.version = function(opt_data, opt_ignored) {
  return '' + ((opt_data.deploymentVersion) ? bamboo.widget.deployment.version.versionInfo({version: opt_data.deploymentVersion, showBranch: opt_data.showBranch, showVersionStatus: ! opt_data.hideLozenge}) : '<span title="' + soy.$$escapeHtml(AJS.format("Release {0} has been deleted",opt_data.deploymentVersionName)) + '">' + soy.$$escapeHtml(opt_data.deploymentVersionName) + '</span>');
};
if (goog.DEBUG) {
  bamboo.feature.deployment.result.version.soyTemplateName = 'bamboo.feature.deployment.result.version';
}


bamboo.feature.deployment.result.versionStatusLozenge = function(opt_data, opt_ignored) {
  return '' + ((opt_data.environmentStatus.deploymentResult) ? (opt_data.environmentStatus.latestResult) ? widget.lozenges.auilozenge({colour: 'default', text: "REPLACED"}) : widget.status.deploymentResultStatusLozenge({lifeCycleState: opt_data.environmentStatus.deploymentResult.lifeCycleState, deploymentState: opt_data.environmentStatus.deploymentResult.deploymentState}) : (opt_data.environmentStatus.latestResult && opt_data.environmentStatus.latestResult.deploymentVersion && opt_data.environmentStatus.latestResult.deploymentVersion.creationDate - opt_data.deploymentVersion.creationDate > 0) ? widget.lozenges.auilozenge({colour: 'default', text: "SKIPPED"}) : (opt_data.neverDeployedText) ? soy.$$escapeHtml(opt_data.neverDeployedText) : soy.$$escapeHtml("Never deployed"));
};
if (goog.DEBUG) {
  bamboo.feature.deployment.result.versionStatusLozenge.soyTemplateName = 'bamboo.feature.deployment.result.versionStatusLozenge';
}
;
;
/* module-key = 'bamboo.deployments:related-deployments', location = '/feature/deployment/build/related-deployment-list.soy' */
// This file was automatically generated from related-deployment-list.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.deployment.build.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.deployment == 'undefined') { bamboo.feature.deployment = {}; }
if (typeof bamboo.feature.deployment.build == 'undefined') { bamboo.feature.deployment.build = {}; }


bamboo.feature.deployment.build.relatedDeployments = function(opt_data, opt_ignored) {
  var output = '<div id="' + soy.$$escapeHtml(opt_data.id) + '" class="dashboard-project">';
  if (opt_data.projectsWithEnvironmentStatuses && opt_data.projectsWithEnvironmentStatuses.length > 0) {
    var projectWithEnvironmentStatusesList8 = opt_data.projectsWithEnvironmentStatuses;
    var projectWithEnvironmentStatusesListLen8 = projectWithEnvironmentStatusesList8.length;
    for (var projectWithEnvironmentStatusesIndex8 = 0; projectWithEnvironmentStatusesIndex8 < projectWithEnvironmentStatusesListLen8; projectWithEnvironmentStatusesIndex8++) {
      var projectWithEnvironmentStatusesData8 = projectWithEnvironmentStatusesList8[projectWithEnvironmentStatusesIndex8];
      output += '<table class="aui"><colgroup><col width="18%"/><col width="20%"/><col width="15%"/><col width="10%"/><col width="15%"/><col width="8%"/><col width="15%"/><col width="70px"/></colgroup><thead><tr><th>' + soy.$$escapeHtml("Deployment project") + '</th><th>' + soy.$$escapeHtml("Environment") + '</th><th>' + soy.$$escapeHtml("Release") + '</th><th>' + soy.$$escapeHtml("Release branch") + '</th><th>' + soy.$$escapeHtml("Build result used") + '</th><th>' + soy.$$escapeHtml("Result") + '</th><th>' + soy.$$escapeHtml("Completed") + '</th><th>' + soy.$$escapeHtml("Actions") + '</th></tr></thead><tbody>';
      if (projectWithEnvironmentStatusesData8.environmentStatuses && projectWithEnvironmentStatusesData8.environmentStatuses.length > 0) {
        var environmentStatusList28 = projectWithEnvironmentStatusesData8.environmentStatuses;
        var environmentStatusListLen28 = environmentStatusList28.length;
        for (var environmentStatusIndex28 = 0; environmentStatusIndex28 < environmentStatusListLen28; environmentStatusIndex28++) {
          var environmentStatusData28 = environmentStatusList28[environmentStatusIndex28];
          output += '<tr class="' + ((environmentStatusIndex28 == 0) ? 'first' : '') + ' ' + ((environmentStatusIndex28 == environmentStatusListLen28 - 1) ? 'last' : '') + ' ' + ((environmentStatusData28.deploymentResult && environmentStatusData28.deploymentResult.lifeCycleState == 'FINISHED' && environmentStatusData28.deploymentResult.deploymentState == 'FAILED') ? 'error' : '') + '"><td class="deployment">' + ((environmentStatusIndex28 == 0) ? '<a class="deployment-project-name" href="' + soy.$$escapeHtml("" + '/deploy/viewDeploymentProjectEnvironments.action?id=' + projectWithEnvironmentStatusesData8.deploymentProject.id) + '"' + ((projectWithEnvironmentStatusesData8.deploymentProject.description) ? 'title="' + soy.$$escapeHtml(projectWithEnvironmentStatusesData8.deploymentProject.description) + '"' : '') + '>' + soy.$$escapeHtml(projectWithEnvironmentStatusesData8.deploymentProject.name) + '</a>' : '') + '</td>' + bamboo.feature.deployment.build.environment(soy.$$augmentMap(environmentStatusData28, {currentUrl: opt_data.currentUrl, relatedVersions: opt_data.relatedVersions})) + '</tr>';
        }
      } else {
        output += '<tr class="first"><td class="deployment"><a class="deployment-project-name" href="' + soy.$$escapeHtml("" + '/deploy/viewDeploymentProjectEnvironments.action?id=' + projectWithEnvironmentStatusesData8.deploymentProject.id) + '">' + soy.$$escapeHtml(projectWithEnvironmentStatusesData8.deploymentProject.name) + '</a></td><td colspan="7" class="empty-text">' + soy.$$escapeHtml("No environments found.") + ((projectWithEnvironmentStatusesData8.deploymentProject.operations.canEdit) ? ' ' + soy.$$filterNoAutoescape(AJS.format("\x3ca href\x3d\x22{0}\x22\x3eCreate a new environment\x3c/a\x3e to start tracking your deployments.","" + '/deploy/config/createEnvironment.action?deploymentProjectId=' + projectWithEnvironmentStatusesData8.deploymentProject.id + '&returnUrl=' + opt_data.currentUrl)) : '') + '</td></tr>';
      }
      output += '</tbody></table>';
    }
  } else {
    output += '<p>' + soy.$$filterNoAutoescape("\x3cp\x3eWith Bamboo deployments you can track your code from a JIRA issue, through testing in a build, all the way to deployment. Deployments allow you to: \x3cul\x3e\x3cli\x3eSnapshot your artifacts from any successful build into a release\x3c/li\x3e \x3cli\x3eDeploy, rollback and promote releases to environments\x3c/li\x3e \x3cli\x3eTrack what, when and who deployed releases to your environments\x3c/li\x3e \x3c/ul\x3e\x3c/p\x3e") + '</p>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.deployment.build.relatedDeployments.soyTemplateName = 'bamboo.feature.deployment.build.relatedDeployments';
}


bamboo.feature.deployment.build.relatedBuilds = function(opt_data, opt_ignored) {
  return '' + ((opt_data.relatedPlanResults.length) ? widget.buildresult.resultStatusAndLink({resultSummary: opt_data.relatedPlanResults[0]}) + ((opt_data.relatedPlanResults.length > 1) ? ' ' + soy.$$escapeHtml(AJS.format("and {0} {0,choice,1# other|1\x3c others}",opt_data.relatedPlanResults.length - 1)) : '') : '');
};
if (goog.DEBUG) {
  bamboo.feature.deployment.build.relatedBuilds.soyTemplateName = 'bamboo.feature.deployment.build.relatedBuilds';
}


bamboo.feature.deployment.build.environment = function(opt_data, opt_ignored) {
  var output = '<td><a href="' + soy.$$escapeHtml("" + '/deploy/viewEnvironment.action?id=' + opt_data.environment.id) + '">' + soy.$$escapeHtml(opt_data.environment.name) + '</a></td>';
  if (opt_data.deploymentResult) {
    output += '<td>' + bamboo.feature.deployment.result.version({deploymentVersion: opt_data.deploymentResult.deploymentVersion, deploymentVersionName: opt_data.deploymentResult.deploymentVersionName, subtle: true}) + '</td><td>' + ((opt_data.deploymentResult.deploymentVersion) ? widget.lozenges.branch(opt_data.deploymentResult.deploymentVersion) : '') + '</td><td>';
    var relatedVersionList109 = opt_data.relatedVersions;
    var relatedVersionListLen109 = relatedVersionList109.length;
    for (var relatedVersionIndex109 = 0; relatedVersionIndex109 < relatedVersionListLen109; relatedVersionIndex109++) {
      var relatedVersionData109 = relatedVersionList109[relatedVersionIndex109];
      output += (relatedVersionData109.deploymentVersion.id == opt_data.deploymentResult.deploymentVersion.id) ? bamboo.feature.deployment.build.relatedBuilds(relatedVersionData109) : '';
    }
    output += '</td><td>' + bamboo.feature.deployment.result.environmentState({deploymentResult: opt_data.deploymentResult, showDetailsLinkAlways: true, isLatestResult: true}) + '</td><td>' + bamboo.feature.deployment.result.finishedTimeOrDuration(soy.$$augmentMap(opt_data.deploymentResult, {hideLink: true})) + '</td>';
  } else {
    output += '<td colspan="3">&nbsp;</td><td colspan="2" class="empty-text">' + soy.$$escapeHtml("Never deployed") + '</td>';
  }
  output += '<td>' + ((opt_data.environment.operations.allowedToExecute) ? ((opt_data.environment.operations.canExecute) ? '<a href="' + soy.$$escapeHtml("" + '/deploy/selectVersionForExecute.action?environmentId=' + opt_data.environment.id + '&returnUrl=' + opt_data.currentUrl) + '" title="' + soy.$$escapeHtml("Deploy") + '">' + widget.icons.fontIcon({type: 'deploy', text: "Deploy"}) + '</a>' : '<span class="operation-disabled">' + widget.icons.fontIcon({type: 'deploy', text: opt_data.environment.operations.cantExecuteReason, showTitle: true}) + '</span>') + ' ' : '') + ((opt_data.environment.operations.canEdit) ? widget.icons.auiFontLink({iconType: 'edit', relativeUrl: '/deploy/config/configureDeploymentProject.action?id=' + opt_data.environment.deploymentProjectId + '&environmentId=' + opt_data.environment.id + '&returnUrl=' + opt_data.currentUrl, text: "Edit environment"}) : '') + '</td>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.deployment.build.environment.soyTemplateName = 'bamboo.feature.deployment.build.environment';
}


bamboo.feature.deployment.build.relatedVersions = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.buildState == 'SUCCESS') {
    output += '<div class="related-versions"><h2>' + soy.$$escapeHtml("Included in deployment project") + '</h2>';
    var returnUrl__soy162 = '/browse/' + opt_data.planResultKey.key;
    var deploymentProjectWithEnvironmentStatusesList163 = opt_data.relatedDeployments;
    var deploymentProjectWithEnvironmentStatusesListLen163 = deploymentProjectWithEnvironmentStatusesList163.length;
    for (var deploymentProjectWithEnvironmentStatusesIndex163 = 0; deploymentProjectWithEnvironmentStatusesIndex163 < deploymentProjectWithEnvironmentStatusesListLen163; deploymentProjectWithEnvironmentStatusesIndex163++) {
      var deploymentProjectWithEnvironmentStatusesData163 = deploymentProjectWithEnvironmentStatusesList163[deploymentProjectWithEnvironmentStatusesIndex163];
      output += '<div class="related-version">';
      var deploymentProject__soy165 = deploymentProjectWithEnvironmentStatusesData163.deploymentProject;
      var relatedVersion__soy166 = deploymentProjectWithEnvironmentStatusesData163.relatedVersion;
      var futureVersion__soy167 = deploymentProjectWithEnvironmentStatusesData163.futureVersion;
      var futureVersionResult__soy168 = deploymentProjectWithEnvironmentStatusesData163.futureVersionResult;
      output += '<span class="project-name"><a href="' + soy.$$escapeHtml("" + '/deploy/viewDeploymentProjectEnvironments.action?id=' + deploymentProject__soy165.id) + '">' + soy.$$escapeHtml(deploymentProject__soy165.name) + '</a>' + ((relatedVersion__soy166) ? ' &rsaquo; ' + soy.$$escapeHtml("Release:") + ' <a href="' + soy.$$escapeHtml("" + '/deploy/viewDeploymentVersion.action?versionId=' + relatedVersion__soy166.id) + '">' + soy.$$escapeHtml(relatedVersion__soy166.name) + '</a>' : '') + '</span>';
      if (relatedVersion__soy166) {
        if (deploymentProjectWithEnvironmentStatusesData163.environmentStatuses && deploymentProjectWithEnvironmentStatusesData163.environmentStatuses.length > 0) {
          output += '<table class="aui"><thead><tr><th>' + soy.$$escapeHtml("Environment") + '</th><th>' + soy.$$escapeHtml("Status") + '</th><th></th><th>' + soy.$$escapeHtml("Actions") + '</th></tr></thead><tbody>';
          var environmentStatusList195 = deploymentProjectWithEnvironmentStatusesData163.environmentStatuses;
          var environmentStatusListLen195 = environmentStatusList195.length;
          for (var environmentStatusIndex195 = 0; environmentStatusIndex195 < environmentStatusListLen195; environmentStatusIndex195++) {
            var environmentStatusData195 = environmentStatusList195[environmentStatusIndex195];
            var environment__soy196 = environmentStatusData195.environment;
            var deploymentResult__soy197 = environmentStatusData195.deploymentResult;
            output += '<tr><td><a href="' + soy.$$escapeHtml("" + '/deploy/viewEnvironment.action?id=' + environment__soy196.id) + '">' + soy.$$escapeHtml(environment__soy196.name) + '</a></td><td>' + bamboo.feature.deployment.result.versionStatusLozenge({environmentStatus: environmentStatusData195, deploymentVersion: relatedVersion__soy166, neverDeployedText: "not deployed yet"}) + ((environmentStatusData195.deploymentResult && ! environmentStatusData195.latestResult) ? bamboo.feature.deployment.result.detailsLink({deploymentResult: environmentStatusData195.deploymentResult}) : '') + '</td><td>' + ((environmentStatusData195.latestResult) ? bamboo.feature.deployment.result.nowAt({deploymentResult: environmentStatusData195.latestResult}) : '') + '</td><td class="operations">' + ((environmentStatusData195.environment.operations.allowedToExecute && environmentStatusData195.environment.operations.canExecute) ? (! environmentStatusData195.deploymentResult && ! environmentStatusData195.latestResult || environmentStatusData195.deploymentResult && ! environmentStatusData195.latestResult && environmentStatusData195.deploymentResult.deploymentState == 'FAILED' || environmentStatusData195.latestResult && ! environmentStatusData195.latestResult.deploymentVersion || environmentStatusData195.latestResult && environmentStatusData195.latestResult.deploymentVersion.creationDate - relatedVersion__soy166.creationDate < 0) ? '<a href="' + soy.$$escapeHtml("" + '/deploy/selectVersionForExecute.action?environmentId=' + environment__soy196.id) + soy.$$escapeHtml('&versionId=' + relatedVersion__soy166.id) + soy.$$escapeHtml('&returnUrl=' + returnUrl__soy162) + '">' + widget.icons.fontIcon({type: 'deploy', text: "deploy now"}) + '</a>' : '' : '') + '</td></tr>';
          }
          output += '</tbody></table>';
        } else {
          output += '<p>' + soy.$$escapeHtml("No environments found.") + '</p>';
        }
      } else if (futureVersion__soy167) {
        output += '<p>' + soy.$$escapeHtml("No release with the artifacts of this build exists.") + '<br/>' + soy.$$escapeHtml("The next release containing these commits is release") + ' <a href="' + soy.$$escapeHtml("" + '/deploy/viewDeploymentVersion.action?versionId=' + futureVersion__soy167.id) + '">' + soy.$$escapeHtml(futureVersion__soy167.name) + '</a>' + ((futureVersionResult__soy168) ? ' ' + soy.$$escapeHtml("created from build") + ' ' + widget.buildresult.resultStatusAndLink({resultSummary: futureVersionResult__soy168}) : '');
      } else {
        output += '<p>' + soy.$$escapeHtml("No release with the artifacts of this build exists yet.") + '</p>' + ((deploymentProject__soy165.operations.allowedToCreateVersion) ? aui.buttons.button({tagName: 'a', text: "Create release", id: 'create-new-version-' + deploymentProject__soy165.id, extraAttributes: {href: "" + '/deploy/createDeploymentVersion.action?deploymentProjectId=' + deploymentProject__soy165.id + '&planKey=' + opt_data.planResultKey.planKey.key + '&buildNumber=' + opt_data.planResultKey.buildNumber + '&returnUrl=' + returnUrl__soy162, title: "Create a new release version"}, extraClasses: 'brs-create-version-button'}) : '');
      }
      output += '</div>';
    }
    output += '</div>';
  }
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.deployment.build.relatedVersions.soyTemplateName = 'bamboo.feature.deployment.build.relatedVersions';
}
;
;
/* module-key = 'bamboo.deployments:related-plan', location = '/feature/deployment/build/related-plan.soy' */
// This file was automatically generated from related-plan.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.deployment.build.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.deployment == 'undefined') { bamboo.feature.deployment = {}; }
if (typeof bamboo.feature.deployment.build == 'undefined') { bamboo.feature.deployment.build = {}; }


bamboo.feature.deployment.build.showRelatedPlanDetails = function(opt_data, opt_ignored) {
  var output = '<dl class="details-list"><dt>' + soy.$$escapeHtml("Source build plan") + '</dt><dd>' + ((opt_data.relatedPlan) ? widget.plan.renderPlanNameLink({plan: opt_data.relatedPlan}) : soy.$$escapeHtml("No plan is linked to this project, it has probably been deleted. Please update the project configuration before deploying a release.")) + '</dd>';
  if (opt_data.relatedPlan) {
    output += '<dt class="artifacts">' + soy.$$escapeHtml("Available artifacts") + '</dt><dd class="artifacts">';
    if (opt_data.deploymentProjectItems && opt_data.deploymentProjectItems.length) {
      var itemList20 = opt_data.deploymentProjectItems;
      var itemListLen20 = itemList20.length;
      for (var itemIndex20 = 0; itemIndex20 < itemListLen20; itemIndex20++) {
        var itemData20 = itemList20[itemIndex20];
        output += soy.$$escapeHtml(itemData20.name) + ((! (itemIndex20 == itemListLen20 - 1) && opt_data.deploymentProjectItems.length > 1) ? ', ' : '');
      }
    } else {
      var emptyText__soy27 = '' + soy.$$filterNoAutoescape(AJS.format("No \x3cstrong\x3eshared\x3c/strong\x3e artifacts found for related plan. Please \x3ca href\x3d\x22{0}\x22\x3econfigure the build plan\x3c/a\x3e to publish shared artifacts.","" + '/browse/' + opt_data.relatedPlan.planKey.key + '/config'));
      output += aui.message.warning({content: emptyText__soy27});
    }
    output += '</dd>';
  }
  output += '</dl>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.deployment.build.showRelatedPlanDetails.soyTemplateName = 'bamboo.feature.deployment.build.showRelatedPlanDetails';
}
;
;
/* module-key = 'bamboo.web.resources:feature-expiry', location = '/feature/expiry/expiry.js' */
define('feature/expiry-checkbox-tree', [
    'jquery',
    'underscore',
    'brace'
], function(
    $,
    _,
    Brace
) {

    'use strict';

    var ExpiryCheckboxTree = Brace.View.extend({
        $block: null,
        $triggers: [],
        initialize: function(options) {
            this.params = options.params || {};

            if (this.params.blockSelector) {
                this.$block = $(this.params.blockSelector);
            }

            var $parent = $(this.params.parentSelector),
                    $children = $(this.params.childrenSelector);

            this.$triggers = $children.add($parent);

            if ($parent.is(':checked')) {
                checkboxTree.cascadeToChildren($parent, $children, checkboxTree.DISABLE_CHILDREN_ON_PARENT_CHECKED);
            }

            $parent.on('change', _.bind(function() {
                checkboxTree.cascadeToChildren($parent, $children, checkboxTree.DISABLE_CHILDREN_ON_PARENT_CHECKED);
                this.changeBlockVisibility();
            }, this));

            $children.on('change', _.bind(this.changeBlockVisibility, this));

            this.changeBlockVisibility();
        },

        changeBlockVisibility: function() {
            if (!this.$block) {
                return;
            }

            var isBlockVisible = this.$triggers.is(':checked');
            this.$block.toggle(isBlockVisible);
        }
    });

    return ExpiryCheckboxTree;
});
;
;
/* module-key = 'com.atlassian.auiplugin:aui-flag', location = '/js/aui/flag.js' */
(function(e){define("aui/flag",[],function(){return e(AJS,AJS.$,AJS.template)})})(function(e,c,h){function g(a){var b=c('<span class="aui-icon icon-close" role="button" tabindex="0"></span>');b.click(function(){f(a)});b.keypress(function(b){if(b.which===e.keyCode.ENTER||b.which===e.keyCode.SPACE)f(a),b.preventDefault()});return a.find(".aui-message").append(b)[0]}function f(a){a=a.get(0);a.setAttribute("aria-hidden","true");a.dispatchEvent(new CustomEvent("aui-flag-close",{bubbles:!0}));return a}
var i={body:"",close:"manual",title:"",type:"info"};return function(a){var a=c.extend({},i,a),b,d=a,d=h('<div class="aui-flag"><div class="aui-message aui-message-{type} {type} {closeable} shadowed"><p class="title"><strong>{title}</strong></p>{body}<\!-- .aui-message --\></div></div>').fill({"body:html":d.body||"",closeable:"never"===d.close?"":"closeable",title:d.title||"",type:d.type}).toString();b=c(d);b[0].close=function(){f(b)};"auto"===a.close?(g(b),b.find(".aui-message").addClass("aui-will-close"),
setTimeout(function(){b[0].close()},5E3)):"manual"===a.close&&g(b);c("#aui-flag-container").find(".aui-flag").get().forEach(function(a){a.getAttribute("aria-hidden")==="true"&&c(a).remove()});a=c("#aui-flag-container");a.length||(a=c('<div id="aui-flag-container"></div>'),c("body").prepend(a));b.appendTo(a);e._internal.animation.recomputeStyle(b);return b.attr("aria-hidden","false")[0]}});;
;
/* module-key = 'bamboo.web.resources:history-js', location = '/bower/history.js/jquery.history.js' */
/**
 * History.js jQuery Adapter
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */

// Closure
(function(window,undefined){
	"use strict";

	// Localise Globals
	var
		History = window.History = window.History||{},
		jQuery = window.jQuery;

	// Check Existence
	if ( typeof History.Adapter !== 'undefined' ) {
		throw new Error('History.js Adapter has already been loaded...');
	}

	// Add the Adapter
	History.Adapter = {
		/**
		 * History.Adapter.bind(el,event,callback)
		 * @param {Element|string} el
		 * @param {string} event - custom and standard events
		 * @param {function} callback
		 * @return {void}
		 */
		bind: function(el,event,callback){
			jQuery(el).bind(event,callback);
		},

		/**
		 * History.Adapter.trigger(el,event)
		 * @param {Element|string} el
		 * @param {string} event - custom and standard events
		 * @param {Object=} extra - a object of extra event data (optional)
		 * @return {void}
		 */
		trigger: function(el,event,extra){
			jQuery(el).trigger(event,extra);
		},

		/**
		 * History.Adapter.extractEventData(key,event,extra)
		 * @param {string} key - key for the event data to extract
		 * @param {string} event - custom and standard events
		 * @param {Object=} extra - a object of extra event data (optional)
		 * @return {mixed}
		 */
		extractEventData: function(key,event,extra){
			// jQuery Native then jQuery Custom
			var result = (event && event.originalEvent && event.originalEvent[key]) || (extra && extra[key]) || undefined;

			// Return
			return result;
		},

		/**
		 * History.Adapter.onDomLoad(callback)
		 * @param {function} callback
		 * @return {void}
		 */
		onDomLoad: function(callback) {
			jQuery(callback);
		}
	};

	// Try and Initialise History
	if ( typeof History.init !== 'undefined' ) {
		History.init();
	}

})(window);

/**
 * History.js Core
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */

(function(window,undefined){
	"use strict";

	// ========================================================================
	// Initialise

	// Localise Globals
	var
		console = window.console||undefined, // Prevent a JSLint complain
		document = window.document, // Make sure we are using the correct document
		navigator = window.navigator, // Make sure we are using the correct navigator
		sessionStorage = window.sessionStorage||false, // sessionStorage
		setTimeout = window.setTimeout,
		clearTimeout = window.clearTimeout,
		setInterval = window.setInterval,
		clearInterval = window.clearInterval,
		JSON = window.JSON,
		alert = window.alert,
		History = window.History = window.History||{}, // Public History Object
		history = window.history; // Old History Object

	try {
		sessionStorage.setItem('TEST', '1');
		sessionStorage.removeItem('TEST');
	} catch(e) {
		sessionStorage = false;
	}

	// MooTools Compatibility
	JSON.stringify = JSON.stringify||JSON.encode;
	JSON.parse = JSON.parse||JSON.decode;

	// Check Existence
	if ( typeof History.init !== 'undefined' ) {
		throw new Error('History.js Core has already been loaded...');
	}

	// Initialise History
	History.init = function(options){
		// Check Load Status of Adapter
		if ( typeof History.Adapter === 'undefined' ) {
			return false;
		}

		// Check Load Status of Core
		if ( typeof History.initCore !== 'undefined' ) {
			History.initCore();
		}

		// Check Load Status of HTML4 Support
		if ( typeof History.initHtml4 !== 'undefined' ) {
			History.initHtml4();
		}

		// Return true
		return true;
	};


	// ========================================================================
	// Initialise Core

	// Initialise Core
	History.initCore = function(options){
		// Initialise
		if ( typeof History.initCore.initialized !== 'undefined' ) {
			// Already Loaded
			return false;
		}
		else {
			History.initCore.initialized = true;
		}


		// ====================================================================
		// Options

		/**
		 * History.options
		 * Configurable options
		 */
		History.options = History.options||{};

		/**
		 * History.options.hashChangeInterval
		 * How long should the interval be before hashchange checks
		 */
		History.options.hashChangeInterval = History.options.hashChangeInterval || 100;

		/**
		 * History.options.safariPollInterval
		 * How long should the interval be before safari poll checks
		 */
		History.options.safariPollInterval = History.options.safariPollInterval || 500;

		/**
		 * History.options.doubleCheckInterval
		 * How long should the interval be before we perform a double check
		 */
		History.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;

		/**
		 * History.options.disableSuid
		 * Force History not to append suid
		 */
		History.options.disableSuid = History.options.disableSuid || false;

		/**
		 * History.options.storeInterval
		 * How long should we wait between store calls
		 */
		History.options.storeInterval = History.options.storeInterval || 1000;

		/**
		 * History.options.busyDelay
		 * How long should we wait between busy events
		 */
		History.options.busyDelay = History.options.busyDelay || 250;

		/**
		 * History.options.debug
		 * If true will enable debug messages to be logged
		 */
		History.options.debug = History.options.debug || false;

		/**
		 * History.options.initialTitle
		 * What is the title of the initial state
		 */
		History.options.initialTitle = History.options.initialTitle || document.title;

		/**
		 * History.options.html4Mode
		 * If true, will force HTMl4 mode (hashtags)
		 */
		History.options.html4Mode = History.options.html4Mode || false;

		/**
		 * History.options.delayInit
		 * Want to override default options and call init manually.
		 */
		History.options.delayInit = History.options.delayInit || false;


		// ====================================================================
		// Interval record

		/**
		 * History.intervalList
		 * List of intervals set, to be cleared when document is unloaded.
		 */
		History.intervalList = [];

		/**
		 * History.clearAllIntervals
		 * Clears all setInterval instances.
		 */
		History.clearAllIntervals = function(){
			var i, il = History.intervalList;
			if (typeof il !== "undefined" && il !== null) {
				for (i = 0; i < il.length; i++) {
					clearInterval(il[i]);
				}
				History.intervalList = null;
			}
		};


		// ====================================================================
		// Debug

		/**
		 * History.debug(message,...)
		 * Logs the passed arguments if debug enabled
		 */
		History.debug = function(){
			if ( (History.options.debug||false) ) {
				History.log.apply(History,arguments);
			}
		};

		/**
		 * History.log(message,...)
		 * Logs the passed arguments
		 */
		History.log = function(){
			// Prepare
			var
				consoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),
				textarea = document.getElementById('log'),
				message,
				i,n,
				args,arg
				;

			// Write to Console
			if ( consoleExists ) {
				args = Array.prototype.slice.call(arguments);
				message = args.shift();
				if ( typeof console.debug !== 'undefined' ) {
					console.debug.apply(console,[message,args]);
				}
				else {
					console.log.apply(console,[message,args]);
				}
			}
			else {
				message = ("\n"+arguments[0]+"\n");
			}

			// Write to log
			for ( i=1,n=arguments.length; i<n; ++i ) {
				arg = arguments[i];
				if ( typeof arg === 'object' && typeof JSON !== 'undefined' ) {
					try {
						arg = JSON.stringify(arg);
					}
					catch ( Exception ) {
						// Recursive Object
					}
				}
				message += "\n"+arg+"\n";
			}

			// Textarea
			if ( textarea ) {
				textarea.value += message+"\n-----\n";
				textarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;
			}
			// No Textarea, No Console
			else if ( !consoleExists ) {
				alert(message);
			}

			// Return true
			return true;
		};


		// ====================================================================
		// Emulated Status

		/**
		 * History.getInternetExplorerMajorVersion()
		 * Get's the major version of Internet Explorer
		 * @return {integer}
		 * @license Public Domain
		 * @author Benjamin Arthur Lupton <contact@balupton.com>
		 * @author James Padolsey <https://gist.github.com/527683>
		 */
		History.getInternetExplorerMajorVersion = function(){
			var result = History.getInternetExplorerMajorVersion.cached =
					(typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')
				?	History.getInternetExplorerMajorVersion.cached
				:	(function(){
						var v = 3,
								div = document.createElement('div'),
								all = div.getElementsByTagName('i');
						while ( (div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0] ) {}
						return (v > 4) ? v : false;
					})()
				;
			return result;
		};

		/**
		 * History.isInternetExplorer()
		 * Are we using Internet Explorer?
		 * @return {boolean}
		 * @license Public Domain
		 * @author Benjamin Arthur Lupton <contact@balupton.com>
		 */
		History.isInternetExplorer = function(){
			var result =
				History.isInternetExplorer.cached =
				(typeof History.isInternetExplorer.cached !== 'undefined')
					?	History.isInternetExplorer.cached
					:	Boolean(History.getInternetExplorerMajorVersion())
				;
			return result;
		};

		/**
		 * History.emulated
		 * Which features require emulating?
		 */

		if (History.options.html4Mode) {
			History.emulated = {
				pushState : true,
				hashChange: true
			};
		}

		else {

			History.emulated = {
				pushState: !Boolean(
					window.history && window.history.pushState && window.history.replaceState
					&& !(
						(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */
						|| (/AppleWebKit\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */
					)
				),
				hashChange: Boolean(
					!(('onhashchange' in window) || ('onhashchange' in document))
					||
					(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)
				)
			};
		}

		/**
		 * History.enabled
		 * Is History enabled?
		 */
		History.enabled = !History.emulated.pushState;

		/**
		 * History.bugs
		 * Which bugs are present
		 */
		History.bugs = {
			/**
			 * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call
			 * https://bugs.webkit.org/show_bug.cgi?id=56249
			 */
			setHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

			/**
			 * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions
			 * https://bugs.webkit.org/show_bug.cgi?id=42940
			 */
			safariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

			/**
			 * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)
			 */
			ieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),

			/**
			 * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event
			 */
			hashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)
		};

		/**
		 * History.isEmptyObject(obj)
		 * Checks to see if the Object is Empty
		 * @param {Object} obj
		 * @return {boolean}
		 */
		History.isEmptyObject = function(obj) {
			for ( var name in obj ) {
				if ( obj.hasOwnProperty(name) ) {
					return false;
				}
			}
			return true;
		};

		/**
		 * History.cloneObject(obj)
		 * Clones a object and eliminate all references to the original contexts
		 * @param {Object} obj
		 * @return {Object}
		 */
		History.cloneObject = function(obj) {
			var hash,newObj;
			if ( obj ) {
				hash = JSON.stringify(obj);
				newObj = JSON.parse(hash);
			}
			else {
				newObj = {};
			}
			return newObj;
		};


		// ====================================================================
		// URL Helpers

		/**
		 * History.getRootUrl()
		 * Turns "http://mysite.com/dir/page.html?asd" into "http://mysite.com"
		 * @return {String} rootUrl
		 */
		History.getRootUrl = function(){
			// Create
			var rootUrl = document.location.protocol+'//'+(document.location.hostname||document.location.host);
			if ( document.location.port||false ) {
				rootUrl += ':'+document.location.port;
			}
			rootUrl += '/';

			// Return
			return rootUrl;
		};

		/**
		 * History.getBaseHref()
		 * Fetches the `href` attribute of the `<base href="...">` element if it exists
		 * @return {String} baseHref
		 */
		History.getBaseHref = function(){
			// Create
			var
				baseElements = document.getElementsByTagName('base'),
				baseElement = null,
				baseHref = '';

			// Test for Base Element
			if ( baseElements.length === 1 ) {
				// Prepare for Base Element
				baseElement = baseElements[0];
				baseHref = baseElement.href.replace(/[^\/]+$/,'');
			}

			// Adjust trailing slash
			baseHref = baseHref.replace(/\/+$/,'');
			if ( baseHref ) baseHref += '/';

			// Return
			return baseHref;
		};

		/**
		 * History.getBaseUrl()
		 * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)
		 * @return {String} baseUrl
		 */
		History.getBaseUrl = function(){
			// Create
			var baseUrl = History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();

			// Return
			return baseUrl;
		};

		/**
		 * History.getPageUrl()
		 * Fetches the URL of the current page
		 * @return {String} pageUrl
		 */
		History.getPageUrl = function(){
			// Fetch
			var
				State = History.getState(false,false),
				stateUrl = (State||{}).url||History.getLocationHref(),
				pageUrl;

			// Create
			pageUrl = stateUrl.replace(/\/+$/,'').replace(/[^\/]+$/,function(part,index,string){
				return (/\./).test(part) ? part : part+'/';
			});

			// Return
			return pageUrl;
		};

		/**
		 * History.getBasePageUrl()
		 * Fetches the Url of the directory of the current page
		 * @return {String} basePageUrl
		 */
		History.getBasePageUrl = function(){
			// Create
			var basePageUrl = (History.getLocationHref()).replace(/[#\?].*/,'').replace(/[^\/]+$/,function(part,index,string){
				return (/[^\/]$/).test(part) ? '' : part;
			}).replace(/\/+$/,'')+'/';

			// Return
			return basePageUrl;
		};

		/**
		 * History.getFullUrl(url)
		 * Ensures that we have an absolute URL and not a relative URL
		 * @param {string} url
		 * @param {Boolean} allowBaseHref
		 * @return {string} fullUrl
		 */
		History.getFullUrl = function(url,allowBaseHref){
			// Prepare
			var fullUrl = url, firstChar = url.substring(0,1);
			allowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;

			// Check
			if ( /[a-z]+\:\/\//.test(url) ) {
				// Full URL
			}
			else if ( firstChar === '/' ) {
				// Root URL
				fullUrl = History.getRootUrl()+url.replace(/^\/+/,'');
			}
			else if ( firstChar === '#' ) {
				// Anchor URL
				fullUrl = History.getPageUrl().replace(/#.*/,'')+url;
			}
			else if ( firstChar === '?' ) {
				// Query URL
				fullUrl = History.getPageUrl().replace(/[\?#].*/,'')+url;
			}
			else {
				// Relative URL
				if ( allowBaseHref ) {
					fullUrl = History.getBaseUrl()+url.replace(/^(\.\/)+/,'');
				} else {
					fullUrl = History.getBasePageUrl()+url.replace(/^(\.\/)+/,'');
				}
				// We have an if condition above as we do not want hashes
				// which are relative to the baseHref in our URLs
				// as if the baseHref changes, then all our bookmarks
				// would now point to different locations
				// whereas the basePageUrl will always stay the same
			}

			// Return
			return fullUrl.replace(/\#$/,'');
		};

		/**
		 * History.getShortUrl(url)
		 * Ensures that we have a relative URL and not a absolute URL
		 * @param {string} url
		 * @return {string} url
		 */
		History.getShortUrl = function(url){
			// Prepare
			var shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();

			// Trim baseUrl
			if ( History.emulated.pushState ) {
				// We are in a if statement as when pushState is not emulated
				// The actual url these short urls are relative to can change
				// So within the same session, we the url may end up somewhere different
				shortUrl = shortUrl.replace(baseUrl,'');
			}

			// Trim rootUrl
			shortUrl = shortUrl.replace(rootUrl,'/');

			// Ensure we can still detect it as a state
			if ( History.isTraditionalAnchor(shortUrl) ) {
				shortUrl = './'+shortUrl;
			}

			// Clean It
			shortUrl = shortUrl.replace(/^(\.\/)+/g,'./').replace(/\#$/,'');

			// Return
			return shortUrl;
		};

		/**
		 * History.getLocationHref(document)
		 * Returns a normalized version of document.location.href
		 * accounting for browser inconsistencies, etc.
		 *
		 * This URL will be URI-encoded and will include the hash
		 *
		 * @param {object} document
		 * @return {string} url
		 */
		History.getLocationHref = function(doc) {
			doc = doc || document;

			// most of the time, this will be true
			if (doc.URL === doc.location.href)
				return doc.location.href;

			// some versions of webkit URI-decode document.location.href
			// but they leave document.URL in an encoded state
			if (doc.location.href === decodeURIComponent(doc.URL))
				return doc.URL;

			// FF 3.6 only updates document.URL when a page is reloaded
			// document.location.href is updated correctly
			if (doc.location.hash && decodeURIComponent(doc.location.href.replace(/^[^#]+/, "")) === doc.location.hash)
				return doc.location.href;

			if (doc.URL.indexOf('#') == -1 && doc.location.href.indexOf('#') != -1)
				return doc.location.href;
			
			return doc.URL || doc.location.href;
		};


		// ====================================================================
		// State Storage

		/**
		 * History.store
		 * The store for all session specific data
		 */
		History.store = {};

		/**
		 * History.idToState
		 * 1-1: State ID to State Object
		 */
		History.idToState = History.idToState||{};

		/**
		 * History.stateToId
		 * 1-1: State String to State ID
		 */
		History.stateToId = History.stateToId||{};

		/**
		 * History.urlToId
		 * 1-1: State URL to State ID
		 */
		History.urlToId = History.urlToId||{};

		/**
		 * History.storedStates
		 * Store the states in an array
		 */
		History.storedStates = History.storedStates||[];

		/**
		 * History.savedStates
		 * Saved the states in an array
		 */
		History.savedStates = History.savedStates||[];

		/**
		 * History.noramlizeStore()
		 * Noramlize the store by adding necessary values
		 */
		History.normalizeStore = function(){
			History.store.idToState = History.store.idToState||{};
			History.store.urlToId = History.store.urlToId||{};
			History.store.stateToId = History.store.stateToId||{};
		};

		/**
		 * History.getState()
		 * Get an object containing the data, title and url of the current state
		 * @param {Boolean} friendly
		 * @param {Boolean} create
		 * @return {Object} State
		 */
		History.getState = function(friendly,create){
			// Prepare
			if ( typeof friendly === 'undefined' ) { friendly = true; }
			if ( typeof create === 'undefined' ) { create = true; }

			// Fetch
			var State = History.getLastSavedState();

			// Create
			if ( !State && create ) {
				State = History.createStateObject();
			}

			// Adjust
			if ( friendly ) {
				State = History.cloneObject(State);
				State.url = State.cleanUrl||State.url;
			}

			// Return
			return State;
		};

		/**
		 * History.getIdByState(State)
		 * Gets a ID for a State
		 * @param {State} newState
		 * @return {String} id
		 */
		History.getIdByState = function(newState){

			// Fetch ID
			var id = History.extractId(newState.url),
				str;

			if ( !id ) {
				// Find ID via State String
				str = History.getStateString(newState);
				if ( typeof History.stateToId[str] !== 'undefined' ) {
					id = History.stateToId[str];
				}
				else if ( typeof History.store.stateToId[str] !== 'undefined' ) {
					id = History.store.stateToId[str];
				}
				else {
					// Generate a new ID
					while ( true ) {
						id = (new Date()).getTime() + String(Math.random()).replace(/\D/g,'');
						if ( typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined' ) {
							break;
						}
					}

					// Apply the new State to the ID
					History.stateToId[str] = id;
					History.idToState[id] = newState;
				}
			}

			// Return ID
			return id;
		};

		/**
		 * History.normalizeState(State)
		 * Expands a State Object
		 * @param {object} State
		 * @return {object}
		 */
		History.normalizeState = function(oldState){
			// Variables
			var newState, dataNotEmpty;

			// Prepare
			if ( !oldState || (typeof oldState !== 'object') ) {
				oldState = {};
			}

			// Check
			if ( typeof oldState.normalized !== 'undefined' ) {
				return oldState;
			}

			// Adjust
			if ( !oldState.data || (typeof oldState.data !== 'object') ) {
				oldState.data = {};
			}

			// ----------------------------------------------------------------

			// Create
			newState = {};
			newState.normalized = true;
			newState.title = oldState.title||'';
			newState.url = History.getFullUrl(oldState.url?oldState.url:(History.getLocationHref()));
			newState.hash = History.getShortUrl(newState.url);
			newState.data = History.cloneObject(oldState.data);

			// Fetch ID
			newState.id = History.getIdByState(newState);

			// ----------------------------------------------------------------

			// Clean the URL
			newState.cleanUrl = newState.url.replace(/\??\&_suid.*/,'');
			newState.url = newState.cleanUrl;

			// Check to see if we have more than just a url
			dataNotEmpty = !History.isEmptyObject(newState.data);

			// Apply
			if ( (newState.title || dataNotEmpty) && History.options.disableSuid !== true ) {
				// Add ID to Hash
				newState.hash = History.getShortUrl(newState.url).replace(/\??\&_suid.*/,'');
				if ( !/\?/.test(newState.hash) ) {
					newState.hash += '?';
				}
				newState.hash += '&_suid='+newState.id;
			}

			// Create the Hashed URL
			newState.hashedUrl = History.getFullUrl(newState.hash);

			// ----------------------------------------------------------------

			// Update the URL if we have a duplicate
			if ( (History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState) ) {
				newState.url = newState.hashedUrl;
			}

			// ----------------------------------------------------------------

			// Return
			return newState;
		};

		/**
		 * History.createStateObject(data,title,url)
		 * Creates a object based on the data, title and url state params
		 * @param {object} data
		 * @param {string} title
		 * @param {string} url
		 * @return {object}
		 */
		History.createStateObject = function(data,title,url){
			// Hashify
			var State = {
				'data': data,
				'title': title,
				'url': url
			};

			// Expand the State
			State = History.normalizeState(State);

			// Return object
			return State;
		};

		/**
		 * History.getStateById(id)
		 * Get a state by it's UID
		 * @param {String} id
		 */
		History.getStateById = function(id){
			// Prepare
			id = String(id);

			// Retrieve
			var State = History.idToState[id] || History.store.idToState[id] || undefined;

			// Return State
			return State;
		};

		/**
		 * Get a State's String
		 * @param {State} passedState
		 */
		History.getStateString = function(passedState){
			// Prepare
			var State, cleanedState, str;

			// Fetch
			State = History.normalizeState(passedState);

			// Clean
			cleanedState = {
				data: State.data,
				title: passedState.title,
				url: passedState.url
			};

			// Fetch
			str = JSON.stringify(cleanedState);

			// Return
			return str;
		};

		/**
		 * Get a State's ID
		 * @param {State} passedState
		 * @return {String} id
		 */
		History.getStateId = function(passedState){
			// Prepare
			var State, id;

			// Fetch
			State = History.normalizeState(passedState);

			// Fetch
			id = State.id;

			// Return
			return id;
		};

		/**
		 * History.getHashByState(State)
		 * Creates a Hash for the State Object
		 * @param {State} passedState
		 * @return {String} hash
		 */
		History.getHashByState = function(passedState){
			// Prepare
			var State, hash;

			// Fetch
			State = History.normalizeState(passedState);

			// Hash
			hash = State.hash;

			// Return
			return hash;
		};

		/**
		 * History.extractId(url_or_hash)
		 * Get a State ID by it's URL or Hash
		 * @param {string} url_or_hash
		 * @return {string} id
		 */
		History.extractId = function ( url_or_hash ) {
			// Prepare
			var id,parts,url, tmp;

			// Extract
			
			// If the URL has a #, use the id from before the #
			if (url_or_hash.indexOf('#') != -1)
			{
				tmp = url_or_hash.split("#")[0];
			}
			else
			{
				tmp = url_or_hash;
			}
			
			parts = /(.*)\&_suid=([0-9]+)$/.exec(tmp);
			url = parts ? (parts[1]||url_or_hash) : url_or_hash;
			id = parts ? String(parts[2]||'') : '';

			// Return
			return id||false;
		};

		/**
		 * History.isTraditionalAnchor
		 * Checks to see if the url is a traditional anchor or not
		 * @param {String} url_or_hash
		 * @return {Boolean}
		 */
		History.isTraditionalAnchor = function(url_or_hash){
			// Check
			var isTraditional = !(/[\/\?\.]/.test(url_or_hash));

			// Return
			return isTraditional;
		};

		/**
		 * History.extractState
		 * Get a State by it's URL or Hash
		 * @param {String} url_or_hash
		 * @return {State|null}
		 */
		History.extractState = function(url_or_hash,create){
			// Prepare
			var State = null, id, url;
			create = create||false;

			// Fetch SUID
			id = History.extractId(url_or_hash);
			if ( id ) {
				State = History.getStateById(id);
			}

			// Fetch SUID returned no State
			if ( !State ) {
				// Fetch URL
				url = History.getFullUrl(url_or_hash);

				// Check URL
				id = History.getIdByUrl(url)||false;
				if ( id ) {
					State = History.getStateById(id);
				}

				// Create State
				if ( !State && create && !History.isTraditionalAnchor(url_or_hash) ) {
					State = History.createStateObject(null,null,url);
				}
			}

			// Return
			return State;
		};

		/**
		 * History.getIdByUrl()
		 * Get a State ID by a State URL
		 */
		History.getIdByUrl = function(url){
			// Fetch
			var id = History.urlToId[url] || History.store.urlToId[url] || undefined;

			// Return
			return id;
		};

		/**
		 * History.getLastSavedState()
		 * Get an object containing the data, title and url of the current state
		 * @return {Object} State
		 */
		History.getLastSavedState = function(){
			return History.savedStates[History.savedStates.length-1]||undefined;
		};

		/**
		 * History.getLastStoredState()
		 * Get an object containing the data, title and url of the current state
		 * @return {Object} State
		 */
		History.getLastStoredState = function(){
			return History.storedStates[History.storedStates.length-1]||undefined;
		};

		/**
		 * History.hasUrlDuplicate
		 * Checks if a Url will have a url conflict
		 * @param {Object} newState
		 * @return {Boolean} hasDuplicate
		 */
		History.hasUrlDuplicate = function(newState) {
			// Prepare
			var hasDuplicate = false,
				oldState;

			// Fetch
			oldState = History.extractState(newState.url);

			// Check
			hasDuplicate = oldState && oldState.id !== newState.id;

			// Return
			return hasDuplicate;
		};

		/**
		 * History.storeState
		 * Store a State
		 * @param {Object} newState
		 * @return {Object} newState
		 */
		History.storeState = function(newState){
			// Store the State
			History.urlToId[newState.url] = newState.id;

			// Push the State
			History.storedStates.push(History.cloneObject(newState));

			// Return newState
			return newState;
		};

		/**
		 * History.isLastSavedState(newState)
		 * Tests to see if the state is the last state
		 * @param {Object} newState
		 * @return {boolean} isLast
		 */
		History.isLastSavedState = function(newState){
			// Prepare
			var isLast = false,
				newId, oldState, oldId;

			// Check
			if ( History.savedStates.length ) {
				newId = newState.id;
				oldState = History.getLastSavedState();
				oldId = oldState.id;

				// Check
				isLast = (newId === oldId);
			}

			// Return
			return isLast;
		};

		/**
		 * History.saveState
		 * Push a State
		 * @param {Object} newState
		 * @return {boolean} changed
		 */
		History.saveState = function(newState){
			// Check Hash
			if ( History.isLastSavedState(newState) ) {
				return false;
			}

			// Push the State
			History.savedStates.push(History.cloneObject(newState));

			// Return true
			return true;
		};

		/**
		 * History.getStateByIndex()
		 * Gets a state by the index
		 * @param {integer} index
		 * @return {Object}
		 */
		History.getStateByIndex = function(index){
			// Prepare
			var State = null;

			// Handle
			if ( typeof index === 'undefined' ) {
				// Get the last inserted
				State = History.savedStates[History.savedStates.length-1];
			}
			else if ( index < 0 ) {
				// Get from the end
				State = History.savedStates[History.savedStates.length+index];
			}
			else {
				// Get from the beginning
				State = History.savedStates[index];
			}

			// Return State
			return State;
		};
		
		/**
		 * History.getCurrentIndex()
		 * Gets the current index
		 * @return (integer)
		*/
		History.getCurrentIndex = function(){
			// Prepare
			var index = null;
			
			// No states saved
			if(History.savedStates.length < 1) {
				index = 0;
			}
			else {
				index = History.savedStates.length-1;
			}
			return index;
		};

		// ====================================================================
		// Hash Helpers

		/**
		 * History.getHash()
		 * @param {Location=} location
		 * Gets the current document hash
		 * Note: unlike location.hash, this is guaranteed to return the escaped hash in all browsers
		 * @return {string}
		 */
		History.getHash = function(doc){
			var url = History.getLocationHref(doc),
				hash;
			hash = History.getHashByUrl(url);
			return hash;
		};

		/**
		 * History.unescapeHash()
		 * normalize and Unescape a Hash
		 * @param {String} hash
		 * @return {string}
		 */
		History.unescapeHash = function(hash){
			// Prepare
			var result = History.normalizeHash(hash);

			// Unescape hash
			result = decodeURIComponent(result);

			// Return result
			return result;
		};

		/**
		 * History.normalizeHash()
		 * normalize a hash across browsers
		 * @return {string}
		 */
		History.normalizeHash = function(hash){
			// Prepare
			var result = hash.replace(/[^#]*#/,'').replace(/#.*/, '');

			// Return result
			return result;
		};

		/**
		 * History.setHash(hash)
		 * Sets the document hash
		 * @param {string} hash
		 * @return {History}
		 */
		History.setHash = function(hash,queue){
			// Prepare
			var State, pageUrl;

			// Handle Queueing
			if ( queue !== false && History.busy() ) {
				// Wait + Push to Queue
				//History.debug('History.setHash: we must wait', arguments);
				History.pushQueue({
					scope: History,
					callback: History.setHash,
					args: arguments,
					queue: queue
				});
				return false;
			}

			// Log
			//History.debug('History.setHash: called',hash);

			// Make Busy + Continue
			History.busy(true);

			// Check if hash is a state
			State = History.extractState(hash,true);
			if ( State && !History.emulated.pushState ) {
				// Hash is a state so skip the setHash
				//History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);

				// PushState
				History.pushState(State.data,State.title,State.url,false);
			}
			else if ( History.getHash() !== hash ) {
				// Hash is a proper hash, so apply it

				// Handle browser bugs
				if ( History.bugs.setHash ) {
					// Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249

					// Fetch the base page
					pageUrl = History.getPageUrl();

					// Safari hash apply
					History.pushState(null,null,pageUrl+'#'+hash,false);
				}
				else {
					// Normal hash apply
					document.location.hash = hash;
				}
			}

			// Chain
			return History;
		};

		/**
		 * History.escape()
		 * normalize and Escape a Hash
		 * @return {string}
		 */
		History.escapeHash = function(hash){
			// Prepare
			var result = History.normalizeHash(hash);

			// Escape hash
			result = window.encodeURIComponent(result);

			// IE6 Escape Bug
			if ( !History.bugs.hashEscape ) {
				// Restore common parts
				result = result
					.replace(/\%21/g,'!')
					.replace(/\%26/g,'&')
					.replace(/\%3D/g,'=')
					.replace(/\%3F/g,'?');
			}

			// Return result
			return result;
		};

		/**
		 * History.getHashByUrl(url)
		 * Extracts the Hash from a URL
		 * @param {string} url
		 * @return {string} url
		 */
		History.getHashByUrl = function(url){
			// Extract the hash
			var hash = String(url)
				.replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')
				;

			// Unescape hash
			hash = History.unescapeHash(hash);

			// Return hash
			return hash;
		};

		/**
		 * History.setTitle(title)
		 * Applies the title to the document
		 * @param {State} newState
		 * @return {Boolean}
		 */
		History.setTitle = function(newState){
			// Prepare
			var title = newState.title,
				firstState;

			// Initial
			if ( !title ) {
				firstState = History.getStateByIndex(0);
				if ( firstState && firstState.url === newState.url ) {
					title = firstState.title||History.options.initialTitle;
				}
			}

			// Apply
			try {
				document.getElementsByTagName('title')[0].innerHTML = title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');
			}
			catch ( Exception ) { }
			document.title = title;

			// Chain
			return History;
		};


		// ====================================================================
		// Queueing

		/**
		 * History.queues
		 * The list of queues to use
		 * First In, First Out
		 */
		History.queues = [];

		/**
		 * History.busy(value)
		 * @param {boolean} value [optional]
		 * @return {boolean} busy
		 */
		History.busy = function(value){
			// Apply
			if ( typeof value !== 'undefined' ) {
				//History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);
				History.busy.flag = value;
			}
			// Default
			else if ( typeof History.busy.flag === 'undefined' ) {
				History.busy.flag = false;
			}

			// Queue
			if ( !History.busy.flag ) {
				// Execute the next item in the queue
				clearTimeout(History.busy.timeout);
				var fireNext = function(){
					var i, queue, item;
					if ( History.busy.flag ) return;
					for ( i=History.queues.length-1; i >= 0; --i ) {
						queue = History.queues[i];
						if ( queue.length === 0 ) continue;
						item = queue.shift();
						History.fireQueueItem(item);
						History.busy.timeout = setTimeout(fireNext,History.options.busyDelay);
					}
				};
				History.busy.timeout = setTimeout(fireNext,History.options.busyDelay);
			}

			// Return
			return History.busy.flag;
		};

		/**
		 * History.busy.flag
		 */
		History.busy.flag = false;

		/**
		 * History.fireQueueItem(item)
		 * Fire a Queue Item
		 * @param {Object} item
		 * @return {Mixed} result
		 */
		History.fireQueueItem = function(item){
			return item.callback.apply(item.scope||History,item.args||[]);
		};

		/**
		 * History.pushQueue(callback,args)
		 * Add an item to the queue
		 * @param {Object} item [scope,callback,args,queue]
		 */
		History.pushQueue = function(item){
			// Prepare the queue
			History.queues[item.queue||0] = History.queues[item.queue||0]||[];

			// Add to the queue
			History.queues[item.queue||0].push(item);

			// Chain
			return History;
		};

		/**
		 * History.queue (item,queue), (func,queue), (func), (item)
		 * Either firs the item now if not busy, or adds it to the queue
		 */
		History.queue = function(item,queue){
			// Prepare
			if ( typeof item === 'function' ) {
				item = {
					callback: item
				};
			}
			if ( typeof queue !== 'undefined' ) {
				item.queue = queue;
			}

			// Handle
			if ( History.busy() ) {
				History.pushQueue(item);
			} else {
				History.fireQueueItem(item);
			}

			// Chain
			return History;
		};

		/**
		 * History.clearQueue()
		 * Clears the Queue
		 */
		History.clearQueue = function(){
			History.busy.flag = false;
			History.queues = [];
			return History;
		};


		// ====================================================================
		// IE Bug Fix

		/**
		 * History.stateChanged
		 * States whether or not the state has changed since the last double check was initialised
		 */
		History.stateChanged = false;

		/**
		 * History.doubleChecker
		 * Contains the timeout used for the double checks
		 */
		History.doubleChecker = false;

		/**
		 * History.doubleCheckComplete()
		 * Complete a double check
		 * @return {History}
		 */
		History.doubleCheckComplete = function(){
			// Update
			History.stateChanged = true;

			// Clear
			History.doubleCheckClear();

			// Chain
			return History;
		};

		/**
		 * History.doubleCheckClear()
		 * Clear a double check
		 * @return {History}
		 */
		History.doubleCheckClear = function(){
			// Clear
			if ( History.doubleChecker ) {
				clearTimeout(History.doubleChecker);
				History.doubleChecker = false;
			}

			// Chain
			return History;
		};

		/**
		 * History.doubleCheck()
		 * Create a double check
		 * @return {History}
		 */
		History.doubleCheck = function(tryAgain){
			// Reset
			History.stateChanged = false;
			History.doubleCheckClear();

			// Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)
			// Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940
			if ( History.bugs.ieDoubleCheck ) {
				// Apply Check
				History.doubleChecker = setTimeout(
					function(){
						History.doubleCheckClear();
						if ( !History.stateChanged ) {
							//History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);
							// Re-Attempt
							tryAgain();
						}
						return true;
					},
					History.options.doubleCheckInterval
				);
			}

			// Chain
			return History;
		};


		// ====================================================================
		// Safari Bug Fix

		/**
		 * History.safariStatePoll()
		 * Poll the current state
		 * @return {History}
		 */
		History.safariStatePoll = function(){
			// Poll the URL

			// Get the Last State which has the new URL
			var
				urlState = History.extractState(History.getLocationHref()),
				newState;

			// Check for a difference
			if ( !History.isLastSavedState(urlState) ) {
				newState = urlState;
			}
			else {
				return;
			}

			// Check if we have a state with that url
			// If not create it
			if ( !newState ) {
				//History.debug('History.safariStatePoll: new');
				newState = History.createStateObject();
			}

			// Apply the New State
			//History.debug('History.safariStatePoll: trigger');
			History.Adapter.trigger(window,'popstate');

			// Chain
			return History;
		};


		// ====================================================================
		// State Aliases

		/**
		 * History.back(queue)
		 * Send the browser history back one item
		 * @param {Integer} queue [optional]
		 */
		History.back = function(queue){
			//History.debug('History.back: called', arguments);

			// Handle Queueing
			if ( queue !== false && History.busy() ) {
				// Wait + Push to Queue
				//History.debug('History.back: we must wait', arguments);
				History.pushQueue({
					scope: History,
					callback: History.back,
					args: arguments,
					queue: queue
				});
				return false;
			}

			// Make Busy + Continue
			History.busy(true);

			// Fix certain browser bugs that prevent the state from changing
			History.doubleCheck(function(){
				History.back(false);
			});

			// Go back
			history.go(-1);

			// End back closure
			return true;
		};

		/**
		 * History.forward(queue)
		 * Send the browser history forward one item
		 * @param {Integer} queue [optional]
		 */
		History.forward = function(queue){
			//History.debug('History.forward: called', arguments);

			// Handle Queueing
			if ( queue !== false && History.busy() ) {
				// Wait + Push to Queue
				//History.debug('History.forward: we must wait', arguments);
				History.pushQueue({
					scope: History,
					callback: History.forward,
					args: arguments,
					queue: queue
				});
				return false;
			}

			// Make Busy + Continue
			History.busy(true);

			// Fix certain browser bugs that prevent the state from changing
			History.doubleCheck(function(){
				History.forward(false);
			});

			// Go forward
			history.go(1);

			// End forward closure
			return true;
		};

		/**
		 * History.go(index,queue)
		 * Send the browser history back or forward index times
		 * @param {Integer} queue [optional]
		 */
		History.go = function(index,queue){
			//History.debug('History.go: called', arguments);

			// Prepare
			var i;

			// Handle
			if ( index > 0 ) {
				// Forward
				for ( i=1; i<=index; ++i ) {
					History.forward(queue);
				}
			}
			else if ( index < 0 ) {
				// Backward
				for ( i=-1; i>=index; --i ) {
					History.back(queue);
				}
			}
			else {
				throw new Error('History.go: History.go requires a positive or negative integer passed.');
			}

			// Chain
			return History;
		};


		// ====================================================================
		// HTML5 State Support

		// Non-Native pushState Implementation
		if ( History.emulated.pushState ) {
			/*
			 * Provide Skeleton for HTML4 Browsers
			 */

			// Prepare
			var emptyFunction = function(){};
			History.pushState = History.pushState||emptyFunction;
			History.replaceState = History.replaceState||emptyFunction;
		} // History.emulated.pushState

		// Native pushState Implementation
		else {
			/*
			 * Use native HTML5 History API Implementation
			 */

			/**
			 * History.onPopState(event,extra)
			 * Refresh the Current State
			 */
			History.onPopState = function(event,extra){
				// Prepare
				var stateId = false, newState = false, currentHash, currentState;

				// Reset the double check
				History.doubleCheckComplete();

				// Check for a Hash, and handle apporiatly
				currentHash = History.getHash();
				if ( currentHash ) {
					// Expand Hash
					currentState = History.extractState(currentHash||History.getLocationHref(),true);
					if ( currentState ) {
						// We were able to parse it, it must be a State!
						// Let's forward to replaceState
						//History.debug('History.onPopState: state anchor', currentHash, currentState);
						History.replaceState(currentState.data, currentState.title, currentState.url, false);
					}
					else {
						// Traditional Anchor
						//History.debug('History.onPopState: traditional anchor', currentHash);
						History.Adapter.trigger(window,'anchorchange');
						History.busy(false);
					}

					// We don't care for hashes
					History.expectedStateId = false;
					return false;
				}

				// Ensure
				stateId = History.Adapter.extractEventData('state',event,extra) || false;

				// Fetch State
				if ( stateId ) {
					// Vanilla: Back/forward button was used
					newState = History.getStateById(stateId);
				}
				else if ( History.expectedStateId ) {
					// Vanilla: A new state was pushed, and popstate was called manually
					newState = History.getStateById(History.expectedStateId);
				}
				else {
					// Initial State
					newState = History.extractState(History.getLocationHref());
				}

				// The State did not exist in our store
				if ( !newState ) {
					// Regenerate the State
					newState = History.createStateObject(null,null,History.getLocationHref());
				}

				// Clean
				History.expectedStateId = false;

				// Check if we are the same state
				if ( History.isLastSavedState(newState) ) {
					// There has been no change (just the page's hash has finally propagated)
					//History.debug('History.onPopState: no change', newState, History.savedStates);
					History.busy(false);
					return false;
				}

				// Store the State
				History.storeState(newState);
				History.saveState(newState);

				// Force update of the title
				History.setTitle(newState);

				// Fire Our Event
				History.Adapter.trigger(window,'statechange');
				History.busy(false);

				// Return true
				return true;
			};
			History.Adapter.bind(window,'popstate',History.onPopState);

			/**
			 * History.pushState(data,title,url)
			 * Add a new State to the history object, become it, and trigger onpopstate
			 * We have to trigger for HTML4 compatibility
			 * @param {object} data
			 * @param {string} title
			 * @param {string} url
			 * @return {true}
			 */
			History.pushState = function(data,title,url,queue){
				//History.debug('History.pushState: called', arguments);

				// Check the State
				if ( History.getHashByUrl(url) && History.emulated.pushState ) {
					throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
				}

				// Handle Queueing
				if ( queue !== false && History.busy() ) {
					// Wait + Push to Queue
					//History.debug('History.pushState: we must wait', arguments);
					History.pushQueue({
						scope: History,
						callback: History.pushState,
						args: arguments,
						queue: queue
					});
					return false;
				}

				// Make Busy + Continue
				History.busy(true);

				// Create the newState
				var newState = History.createStateObject(data,title,url);

				// Check it
				if ( History.isLastSavedState(newState) ) {
					// Won't be a change
					History.busy(false);
				}
				else {
					// Store the newState
					History.storeState(newState);
					History.expectedStateId = newState.id;

					// Push the newState
					history.pushState(newState.id,newState.title,newState.url);

					// Fire HTML5 Event
					History.Adapter.trigger(window,'popstate');
				}

				// End pushState closure
				return true;
			};

			/**
			 * History.replaceState(data,title,url)
			 * Replace the State and trigger onpopstate
			 * We have to trigger for HTML4 compatibility
			 * @param {object} data
			 * @param {string} title
			 * @param {string} url
			 * @return {true}
			 */
			History.replaceState = function(data,title,url,queue){
				//History.debug('History.replaceState: called', arguments);

				// Check the State
				if ( History.getHashByUrl(url) && History.emulated.pushState ) {
					throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
				}

				// Handle Queueing
				if ( queue !== false && History.busy() ) {
					// Wait + Push to Queue
					//History.debug('History.replaceState: we must wait', arguments);
					History.pushQueue({
						scope: History,
						callback: History.replaceState,
						args: arguments,
						queue: queue
					});
					return false;
				}

				// Make Busy + Continue
				History.busy(true);

				// Create the newState
				var newState = History.createStateObject(data,title,url);

				// Check it
				if ( History.isLastSavedState(newState) ) {
					// Won't be a change
					History.busy(false);
				}
				else {
					// Store the newState
					History.storeState(newState);
					History.expectedStateId = newState.id;

					// Push the newState
					history.replaceState(newState.id,newState.title,newState.url);

					// Fire HTML5 Event
					History.Adapter.trigger(window,'popstate');
				}

				// End replaceState closure
				return true;
			};

		} // !History.emulated.pushState


		// ====================================================================
		// Initialise

		/**
		 * Load the Store
		 */
		if ( sessionStorage ) {
			// Fetch
			try {
				History.store = JSON.parse(sessionStorage.getItem('History.store'))||{};
			}
			catch ( err ) {
				History.store = {};
			}

			// Normalize
			History.normalizeStore();
		}
		else {
			// Default Load
			History.store = {};
			History.normalizeStore();
		}

		/**
		 * Clear Intervals on exit to prevent memory leaks
		 */
		History.Adapter.bind(window,"unload",History.clearAllIntervals);

		/**
		 * Create the initial State
		 */
		History.saveState(History.storeState(History.extractState(History.getLocationHref(),true)));

		/**
		 * Bind for Saving Store
		 */
		if ( sessionStorage ) {
			// When the page is closed
			History.onUnload = function(){
				// Prepare
				var	currentStore, item, currentStoreString;

				// Fetch
				try {
					currentStore = JSON.parse(sessionStorage.getItem('History.store'))||{};
				}
				catch ( err ) {
					currentStore = {};
				}

				// Ensure
				currentStore.idToState = currentStore.idToState || {};
				currentStore.urlToId = currentStore.urlToId || {};
				currentStore.stateToId = currentStore.stateToId || {};

				// Sync
				for ( item in History.idToState ) {
					if ( !History.idToState.hasOwnProperty(item) ) {
						continue;
					}
					currentStore.idToState[item] = History.idToState[item];
				}
				for ( item in History.urlToId ) {
					if ( !History.urlToId.hasOwnProperty(item) ) {
						continue;
					}
					currentStore.urlToId[item] = History.urlToId[item];
				}
				for ( item in History.stateToId ) {
					if ( !History.stateToId.hasOwnProperty(item) ) {
						continue;
					}
					currentStore.stateToId[item] = History.stateToId[item];
				}

				// Update
				History.store = currentStore;
				History.normalizeStore();

				// In Safari, going into Private Browsing mode causes the
				// Session Storage object to still exist but if you try and use
				// or set any property/function of it it throws the exception
				// "QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to
				// add something to storage that exceeded the quota." infinitely
				// every second.
				currentStoreString = JSON.stringify(currentStore);
				try {
					// Store
					sessionStorage.setItem('History.store', currentStoreString);
				}
				catch (e) {
					if (e.code === DOMException.QUOTA_EXCEEDED_ERR) {
						if (sessionStorage.length) {
							// Workaround for a bug seen on iPads. Sometimes the quota exceeded error comes up and simply
							// removing/resetting the storage can work.
							sessionStorage.removeItem('History.store');
							sessionStorage.setItem('History.store', currentStoreString);
						} else {
							// Otherwise, we're probably private browsing in Safari, so we'll ignore the exception.
						}
					} else {
						throw e;
					}
				}
			};

			// For Internet Explorer
			History.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));

			// For Other Browsers
			History.Adapter.bind(window,'beforeunload',History.onUnload);
			History.Adapter.bind(window,'unload',History.onUnload);

			// Both are enabled for consistency
		}

		// Non-Native pushState Implementation
		if ( !History.emulated.pushState ) {
			// Be aware, the following is only for native pushState implementations
			// If you are wanting to include something for all browsers
			// Then include it above this if block

			/**
			 * Setup Safari Fix
			 */
			if ( History.bugs.safariPoll ) {
				History.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));
			}

			/**
			 * Ensure Cross Browser Compatibility
			 */
			if ( navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName||'') === 'Mozilla' ) {
				/**
				 * Fix Safari HashChange Issue
				 */

				// Setup Alias
				History.Adapter.bind(window,'hashchange',function(){
					History.Adapter.trigger(window,'popstate');
				});

				// Initialise Alias
				if ( History.getHash() ) {
					History.Adapter.onDomLoad(function(){
						History.Adapter.trigger(window,'hashchange');
					});
				}
			}

		} // !History.emulated.pushState


	}; // History.initCore

	// Try to Initialise History
	if (!History.options || !History.options.delayInit) {
		History.init();
	}

})(window);
;
;
/* module-key = 'bamboo.web.resources:history-xhr', location = '/scripts/history-xhr.js' */
(function (window, undefined) {
    var History = window.History,
        $ = window.jQuery,
        document = window.document;

    if (!History.enabled) {
        return false;
    }

    $(function () {
        var $tabsContainer = $('.aui-tabs.aui-tabs-disabled,.aui-navgroup-horizontal'),
            isHorizontalNav = $tabsContainer.hasClass('aui-navgroup-horizontal'),
            $content = (
                isHorizontalNav ?
                $tabsContainer.nextAll('.aui-page-panel:first').find('.aui-page-panel-content').filter(':first') :
                $tabsContainer.children('.tabs-pane').filter(':first')
            ),
            $links = (
                isHorizontalNav ?
                $tabsContainer.find('.aui-navgroup-primary:first .aui-nav') :
                $tabsContainer.children('.tabs-menu')
            ),
            activeClass = (isHorizontalNav ? 'aui-nav-selected' : 'active-tab'),
            $planNavigator = $('#plan-navigator'),
            $plan,
            $jobs,
            planKey,
            activeJobKey,
            request,
            contextPath = AJS.contextPath() || '',
            listenForPotentialTabLinksInContent = function () {
                var $tab = $(this);

                $content.delegate('a[href="' + $tab.attr('href') + '"]', 'click', function (e) {
                    // Continue as normal for cmd clicks etc
                    if (e.which == 2 || e.metaKey) { return true; }

                    e.preventDefault();
                    $tab.click();
                });
            };

        // If not a tabbed page don't do any history manipulation
        if (!$tabsContainer.length || $tabsContainer.hasClass('history-xhr-disabled')) {
            return false;
        }

        // Get active tab on page load and store that data against this history entry
        History.replaceState({
            tabId: BAMBOO.escapeIdToJQuerySelector($links.find('.' + activeClass).children('a').attr('id'))
        }, document.title, null);

        if ($planNavigator.length) {
            $plan = $planNavigator.find('> ol');
            planKey = $plan.data('planKey');
            $jobs = $planNavigator.find('> ol ul > li');
            activeJobKey = $jobs.filter('.active').data('jobKey');
        }

        $links.find('a:not(.history-xhr-disabled)').click(function (e) {
            var $this = $(this),
                url = $this.attr('href'),
                title = $this.attr('title') || null;

            // Continue as normal for cmd clicks etc
            if (e.which == 2 || e.metaKey) { return true; }

            History.pushState({ tabId: BAMBOO.escapeIdToJQuerySelector($this.attr('id')) }, title, url);
            e.preventDefault();
        }).each(listenForPotentialTabLinksInContent);

        $(window).bind('statechange', function () {
            var State = History.getState(),
                url = State.url,
                tabId = State.data.tabId,
                $tab = $('#' + tabId);

            if (request && request.readyState < 4) {
                request.abort();
            }

            $tabsContainer.addClass('loading');
            $tab.parent().addClass(activeClass).siblings().removeClass(activeClass);

            $(document).trigger('statechange.historyxhr', [ url ]);

            if ($planNavigator.length) {
                // Update urls in plan navigator
                if (activeJobKey) {
                    // Update job urls
                    $jobs.each(function () {
                        var $li = $(this),
                            $a = $li.children('a').last(),
                            jobKey = $li.data('jobKey');

                        $a.attr('href', (jobKey == activeJobKey ? url : url.replace(activeJobKey, jobKey)));
                    });
                } else {
                    // Update plan url
                    // $plan.children('a').attr('href', url);
                }
            }
            
            request = $.ajax({
                cache: false,
                url: url,
                beforeSend: function (jqXHR) {
                    jqXHR.setRequestHeader('X-History-XHR', true);
                },
                success: function (data, textStatus, jqXHR) {
                    var title, planURL, jobURL;

                    // If no data is returned, or an entire web page, go directly to that page for normal error handling
                    if (!$.trim(data) || /<html/i.test(data)) {
                        return window.location = url;
                    }

                    $content.html(data);

                    title = jqXHR.getResponseHeader('X-Page-Title') || $.trim($content.find('title,.document-title').remove().filter(':first').text());
                    if (title) {
                        document.title = title;
                        try {
                            document.getElementsByTagName('title')[0].innerHTML = document.title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');
                        }
                        catch ( Exception ) { }
                    }

                    planURL = jqXHR.getResponseHeader('X-Plan-URL');
                    jobURL = jqXHR.getResponseHeader('X-Job-URL');
                    if ($planNavigator.length) {
                        if (activeJobKey && planURL) {
                            // Update plan url (url is returned with current job key, replace it with the plan key)
                            // $plan.children('a').attr('href', contextPath + planURL.replace(activeJobKey, planKey));
                        } else if (!activeJobKey && jobURL) {
                            // Update job urls (url is returned with plan key, replace it with the appropriate job key)
                            $jobs.each(function () {
                                var $li = $(this),
                                    $a = $li.children('a').last(),
                                    jobKey = $li.data('jobKey');

                                $a.attr('href', contextPath + jobURL.replace(planKey, jobKey));
                            });
                        }
                    }

                    $tabsContainer.removeClass('loading');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    if (textStatus != 'abort') {
                        return window.location = url;
                    }
                }
            });
        });
    });
})(window);;
;
/* module-key = 'bamboo.web.resources:page-visibility', location = '/widget/page-visibility-manager.js' */
define('widget/page-visibility-manager', [
    'jquery',
    'underscore'
], function(
    $,
    _
) {

    'use strict';

    var pageVisibilityManager = (function() {
        var visibilityStatePropertyName, visibilityChangeEventName;
        var HIDDEN = 'hidden',
            VISIBLE = 'visible',
            atlvisibilitychange = 'atlvisibilitychange';

        function setVisibilityValue(value) {
            $(document).attr('atlHidden', value);
        }

        if (typeof document.hidden !== 'undefined') {
            visibilityChangeEventName = 'visibilitychange';
            visibilityStatePropertyName = 'visibilityState';
        } else if (typeof document.mozHidden !== 'undefined') {
            visibilityChangeEventName = 'mozvisibilitychange';
            visibilityStatePropertyName = 'mozVisibilityState';
        } else if (typeof document.msHidden !== 'undefined') {
            visibilityChangeEventName = 'msvisibilitychange';
            visibilityStatePropertyName = 'msVisibilityState';
        } else if (typeof document.webkitHidden !== 'undefined') {
            visibilityChangeEventName = 'webkitvisibilitychange';
            visibilityStatePropertyName = 'webkitVisibilityState';
        } else {
            visibilityChangeEventName = atlvisibilitychange;
            visibilityStatePropertyName = 'atlVisibilityState';
            if (document.createEvent) {
                var event = document.createEvent('Event');
                event.initEvent(visibilityChangeEventName, false, false);
                $(window).focus(function() {
                    setVisibilityValue(VISIBLE);
                    document.dispatchEvent(event);
                });

                $(window).blur(function() {
                    setVisibilityValue(HIDDEN);
                    document.dispatchEvent(event);
                });
            }
        }

        var syncAtlHiddenValue = function() {
            setVisibilityValue(document[visibilityStatePropertyName]);
        };
        if (visibilityChangeEventName != atlvisibilitychange) {
            syncAtlHiddenValue();
            $(document).on(visibilityChangeEventName, syncAtlHiddenValue);
        } else {
            if (document.hasFocus) {
                setVisibilityValue(document.hasFocus() ? VISIBLE : HIDDEN);
            } else {
                setVisibilityValue(VISIBLE);
            }
        }

        return {
            HIDDEN: HIDDEN,
            VISIBLE: VISIBLE,
            isPageVisible: function() {
                return $(document).attr('atlHidden') == VISIBLE;
            },
            addVisibilityChangeEventListener: function(handler) {
                $(document).on(visibilityChangeEventName, handler);
            }
        }
    }());

    return pageVisibilityManager;
});
;
;
/* module-key = 'bamboo.web.resources:plan-status-history', location = '/widget/result-summary/result-summary.js' */
define('widget/result-summary', [
    'underscore',
    'backbone'
], function(
    _,
    Backbone
) {

    'use strict';

    var ResultSummary = Backbone.Model.extend({
        idAttribute: 'buildNumber'
    });


    return ResultSummary;
});
;
;
/* module-key = 'bamboo.web.resources:plan-status-history', location = '/widget/result-summaries/result-summaries.js' */
define('widget/result-summaries', [
    'underscore',
    'backbone',
    'widget/result-summary'
], function(
    _,
    Backbone,
    ResultSummary
) {

    'use strict';

    var ResultSummaries = Backbone.Collection.extend({
        model: ResultSummary,
        initialize: function(models, options) {
            options || (options = {});
            this.planKey = options.planKey;
        },
        url: function() {
            return AJS.contextPath() + '/ajax/planStatusHistoryNeighbouringSummaries.action?planKey=' + this.planKey;
        },
        parse: function(response) {
            return response.navigableSummaries;
        },
        comparator: function(model) {
            return model.id;
        },
        getMinimumBuildNumber: function() {
            return this.length > 0 ? this.at(0).id : null;
        },
        getIndexOfBuildNumber: function(buildNumber) {
            var model = this.get(buildNumber);
            if (model) {
                return this.indexOf(model);
            } else {
                return -1;
            }
        },
        getMaximumBuildNumber: function() {
            if (this.length == 0) {
                return null;
            }

            return this.last().id;
        },
        purgeActiveBuilds: function() {
            this.remove(this.filter(function(model) {
                return model.attributes.active;
            }));
        },
        getPreviousBuildNumber: function(buildNumber) {
            var i = this.getIndexOfBuildNumber(buildNumber);
            if (i > 0) {
                return this.at(i-1).id;
            }
            return null;
        },
        getNextBuildNumber: function(buildNumber) {
            var i = this.getIndexOfBuildNumber(buildNumber);
            if (i >= 0 && i < this.length - 1) {
                return this.at(i+1).id;
            }
            return null;
        }
    });

    return ResultSummaries;
});
;
;
/* module-key = 'bamboo.web.resources:plan-status-history', location = '/widget/plan-status-history/plan-status-history.soy' */
// This file was automatically generated from plan-status-history.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.planStatusHistory.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.planStatusHistory == 'undefined') { bamboo.widget.planStatusHistory = {}; }


bamboo.widget.planStatusHistory.container = function(opt_data, opt_ignored) {
  return '<div id="' + soy.$$escapeHtml(opt_data.id) + '"></div><script type="text/javascript">require([\'jquery\', \'widget/plan-status-history\'], function($, PlanStatusHistory){return new PlanStatusHistory({el: $(\'#' + soy.$$escapeHtml(opt_data.id) + '\'), planKey: \'' + soy.$$escapeHtml(opt_data.planKey) + '\', buildNumber: ' + soy.$$escapeHtml(opt_data.currentBuildNumber ? opt_data.currentBuildNumber : 'null') + ', bootstrap: ' + soy.$$filterNoAutoescape(opt_data.bootstrap) + ', returnUrl: \'' + soy.$$filterNoAutoescape(opt_data.returnUrl) + '\', keyToNavigate: \'' + soy.$$escapeHtml(opt_data.keyToNavigate) + '\', firstBuildNumber: ' + soy.$$escapeHtml(opt_data.firstBuildNumber ? opt_data.firstBuildNumber : 'null') + ', lastBuildNumber: ' + soy.$$escapeHtml(opt_data.lastBuildNumber ? opt_data.lastBuildNumber : 'null') + '});});<\/script>';
};
if (goog.DEBUG) {
  bamboo.widget.planStatusHistory.container.soyTemplateName = 'bamboo.widget.planStatusHistory.container';
}


bamboo.widget.planStatusHistory.navigator = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.builds.length > 0) {
    output += aui.icons.icon({icon: 'wait', useIconFont: false, size: 'small', extraClasses: 'spinner previous'}) + ((opt_data.minVisibleBuildNumber && opt_data.minVisibleBuildNumber > opt_data.firstBuildNumber) ? '<a class="button previous" title="' + soy.$$escapeHtml("Previous build result") + '" accesskey="' + soy.$$escapeHtml("P") + '">' + aui.icons.icon({icon: 'down', useIconFont: true, size: 'small', extraClasses: 'left'}) + '</a>' : '<span class="button previous disabled">' + aui.icons.icon({icon: 'down', useIconFont: true, size: 'small', extraClasses: 'left'}) + '</span>') + '<ol>';
    var buildList54 = opt_data.builds;
    var buildListLen54 = buildList54.length;
    for (var buildIndex54 = 0; buildIndex54 < buildListLen54; buildIndex54++) {
      var buildData54 = buildList54[buildIndex54];
      output += bamboo.widget.planStatusHistory.item(soy.$$augmentMap(buildData54, {href: "" + (opt_data.currentBuildNumber ? '/build/result/gotoBuildResult.action?buildKey=' + opt_data.keyToNavigate + '&buildNumber=' + buildData54.buildNumber + '&returnUrl=' + opt_data.returnUrl : '/browse/' + buildData54.planKey + '-' + buildData54.buildNumber), isCurrent: opt_data.currentBuildNumber && opt_data.currentBuildNumber == buildData54.buildNumber}));
    }
    output += '</ol>' + ((opt_data.showRightArrow) ? '<a class="button next" title="' + soy.$$escapeHtml("Next build result") + '" accesskey="' + soy.$$escapeHtml("N") + '">' + aui.icons.icon({icon: 'up', useIconFont: true, size: 'small', extraClasses: 'right'}) + '</a>' : '<span class="button next disabled">' + aui.icons.icon({icon: 'up', useIconFont: true, size: 'small', extraClasses: 'right'}) + '</span>') + aui.icons.icon({icon: 'wait', useIconFont: false, size: 'small', extraClasses: 'spinner next'});
  } else {
    output += '<p>' + soy.$$escapeHtml("Status history data not available") + '</p>';
  }
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.planStatusHistory.navigator.soyTemplateName = 'bamboo.widget.planStatusHistory.navigator';
}


bamboo.widget.planStatusHistory.buildDialog = function(opt_data, opt_ignored) {
  return '<div>' + widget.icons.statusIcon({status: opt_data.buildStatus, text: '#' + opt_data.buildNumber + ' (' + opt_data.buildStatusDescription + ')'}) + '<strong>#' + soy.$$escapeHtml(opt_data.buildNumber) + '</strong>' + ((opt_data.onceOff) ? widget.lozenges.lozenge({color: 'complete', text: "Custom revision"}) : '') + ((opt_data.rebuild) ? widget.lozenges.lozenge({color: 'moved', text: "Rebuild"}) : '') + ((opt_data.customBuild) ? widget.lozenges.lozenge({color: 'current', text: "Custom build"}) : '') + '<p>' + soy.$$filterNoAutoescape(opt_data.triggerHtml) + '</p>' + ((opt_data.hasFailed) ? ((opt_data.existingFailuresText) ? '<p>' + soy.$$escapeHtml(opt_data.existingFailuresText) + '</p>' : '') + ((opt_data.newFailuresText) ? '<p>' + soy.$$escapeHtml(opt_data.newFailuresText) + '</p>' : '') + ((! (opt_data.existingFailuresText || opt_data.newFailuresText)) ? '<p>' + soy.$$escapeHtml("0 tests failed") + '</p>' : '') : '') + '</div>';
};
if (goog.DEBUG) {
  bamboo.widget.planStatusHistory.buildDialog.soyTemplateName = 'bamboo.widget.planStatusHistory.buildDialog';
}


bamboo.widget.planStatusHistory.item = function(opt_data, opt_ignored) {
  return '<li class="' + soy.$$escapeHtml(opt_data.buildStatus) + ((opt_data.isCurrent) ? ' current' : '') + ' animated' + aui.renderExtraClasses(opt_data) + '" data-build-number="' + soy.$$escapeHtml(opt_data.buildNumber) + '" data-trigger="' + soy.$$escapeHtml(opt_data.trigger) + '" data-new-failed-test-case-count="' + soy.$$escapeHtml(opt_data.newFailedTestCaseCount) + '" data-existing-failed-test-case-count="' + soy.$$escapeHtml(opt_data.existingFailedTestCaseCount) + '" data-rebuild="' + soy.$$escapeHtml(opt_data.rebuild) + '" data-once-off="' + soy.$$escapeHtml(opt_data.onceOff) + '" data-custom-build="' + soy.$$escapeHtml(opt_data.customBuild) + '" ><a href="' + soy.$$escapeHtml(opt_data.href) + '">' + widget.icons.statusIcon({status: opt_data.buildStatus, text: '#' + opt_data.buildNumber + ' (' + opt_data.buildStatusDescription + ')'}) + '</a></li>';
};
if (goog.DEBUG) {
  bamboo.widget.planStatusHistory.item.soyTemplateName = 'bamboo.widget.planStatusHistory.item';
}
;
;
/* module-key = 'bamboo.web.resources:plan-status-history', location = '/widget/plan-status-history/plan-status-history.js' */
define('widget/plan-status-history', [
    'jquery',
    'underscore',
    'backbone',
    'widget/result-summary',
    'widget/result-summaries',
    'widget/page-visibility-manager'
], function(
    $,
    _,
    Backbone,
    ResultSummary,
    ResultSummaries,
    pageVisibilityManager
) {

    'use strict';

    var MAX_WINDOW_SIZE = 10; // synchronised with PlanStatusHistoryAction#MAX_RESULTS
    var SCROLL_BEFORE = "before";
    var SCROLL_AFTER = "after";

    var PlanStatusHistory = Backbone.View.extend({
        id: 'plan-status-history',
        events: {
            "click a.previous": "clickPreviousButton",
            "click a.next": "clickNextButton"
        },
        getShowRightArrow: function() {
            if (this.collection.length == 0) {
                return null;
            }
            return this.maxVisibleBuildNumber && this.maxVisibleBuildNumber < this._lastBuildNumber;
        },
        initialize: function(options) {
            _.extend(this, options || (options = {}));
            this.buildNumber = options.buildNumber;
            this.returnUrl = options.returnUrl || '';
            this.keyToNavigate = options.keyToNavigate;
            this._firstBuildNumber = options.firstBuildNumber;
            this._lastBuildNumber = options.lastBuildNumber;
            this._updateTimeoutSuccess = options.updateTimeoutSuccess || 15000;
            this._updateTimeoutFailure = options.updateTimeoutFailure || 20000;
            this.collection = new ResultSummaries(options.bootstrap || [], {
                planKey: options.planKey
            });
            this.minVisibleBuildNumber = this.collection.getMinimumBuildNumber();
            this.maxVisibleBuildNumber = this.collection.getMaximumBuildNumber();
            this.showRightArrow = this.getShowRightArrow();
            $(document).on('statechange.historyxhr', _.bind(this.updateReturnUrls, this));
            this.scheduleNextUpdate();

            this._inlineDialog = AJS.InlineDialog(
                '#' + this.$el.attr('id') + ' li > *', 'plan-status-history-info',
                _.bind(this.showInlineDialog, this),
                {
                    onHover: true,
                    fadeTime: 50,
                    hideDelay: 50,
                    showDelay: 0,
                    useLiveEvents: true,
                    container: '#content'
                }
            );

            pageVisibilityManager.addVisibilityChangeEventListener(_.bind(this.onPageVisibilityChange, this));
            this.render();
        },
        render: function(scrollDirection) {
            if (!scrollDirection) {
                this._renderBuilds();
            } else {
                this._renderBuildsWithAnimation(scrollDirection);
            }
            return this;
        },
        _showSpinner: function(buttonClass) {
            var id = this.$el.attr('id');
            var $spinner = $('#' + id + ' .spinner' + buttonClass);
            var $button = $('#' + id + ' .button' + buttonClass);
            $button.hide();
            $spinner.show();
        },
        _hideSpinner: function(buttonClass) {
            var id = this.$el.attr('id');
            var $spinner = $('#' + id + ' .spinner' + buttonClass);
            var $button = $('#' + id + ' .button' + buttonClass);
            $spinner.hide();
            $button.show();
        },
        _renderBuilds: function () {
            this.$el.html(bamboo.widget.planStatusHistory.navigator({
                builds: this.getBuildsToRender(),
                currentBuildNumber: this.buildNumber,
                firstBuildNumber: this._firstBuildNumber,
                minVisibleBuildNumber: this.minVisibleBuildNumber,
                maxVisibleBuildNumber: this.maxVisibleBuildNumber,
                showRightArrow: this.getShowRightArrow(),
                keyToNavigate: this.keyToNavigate,
                returnUrl: this.returnUrl
            }));
        },
        _renderBuildsWithAnimation: function (scrollDirection) {
            var $firstLi = this.$el.find('li.animated:first');
            var buildElementWidth = $firstLi.width();
            var translateX = "0";

            if (scrollDirection == SCROLL_BEFORE) {
                translateX = "translateX(" + buildElementWidth + "px)";
            } else if (scrollDirection == SCROLL_AFTER) {
                translateX = "translateX(-" + buildElementWidth + "px)";
            }

            this.$el.find("li.animated").css({
                "transform": translateX,
                "-moz-transform": translateX,
                "-webkit-transform": translateX,
                "-ms-transform": translateX
            });

            _.delay(_.bind(this._renderBuilds, this), 250); // delay must be matched with transition duration in CSS
        },
        getBuildsToRender: function() {
            var buildsToRender = this.collection.toJSON();
            var minVisibleBuildNumber = this.minVisibleBuildNumber;
            var maxVisibleBuildNumber = this.maxVisibleBuildNumber;
            buildsToRender = _.filter(buildsToRender, function(build) {
                return (build.buildNumber >= minVisibleBuildNumber &&  build.buildNumber <= maxVisibleBuildNumber);
            });
            return buildsToRender;
        },
        update: function(options) {
            var data = {};
            options = options || {};
            if (options.buildNumber) {
                data.buildNumber = options.buildNumber;
            } else if (this.buildNumber) {
                data.buildNumber = this.buildNumber;
            }
            if (options.scanDirection) {
                data.scanDirection = options.scanDirection;
            }

            return this.collection.fetch({
                cache: false,
                dataType: 'json',
                data: data,
                remove: false
            })
                    .done(_.bind(this.updateBuildNumberDetails, this))
                    .done(_.bind(this.render, this, options.scanDirection))
                    .always(_.bind(this.recordLastUpdateTime, this))
                    .always(_.bind(this.scheduleNextUpdate, this));
        },
        updateBuildNumberDetails: function() {
            var lastBuildNumber = (this.collection.length ? this.collection.last().id : null);
            if (lastBuildNumber > this._lastBuildNumber) {
                this._lastBuildNumber = lastBuildNumber;
            }
        },
        recordLastUpdateTime: function() {
            this._lastUpdateTime = new Date();
        },
        cancelNextUpdate: function() {
            clearTimeout(this._timeout);
        },
        scheduleNextUpdate: function(jqXHR) {
            this.cancelNextUpdate();
            if (!pageVisibilityManager.isPageVisible()) {
                return;
            }
            var delayBeforeUpdate = ((typeof jqXHR === 'undefined' || jqXHR.status == 'OK')
                ? this._updateTimeoutSuccess
                : this._updateTimeoutFailure);
            if (this._lastUpdateTime) {
                delayBeforeUpdate -= (new Date().getTime() - this._lastUpdateTime.getTime());
                if (delayBeforeUpdate < 0) {
                    delayBeforeUpdate = 0;
                }
            }
            this._timeout = setTimeout(_.bind(this.update, this), delayBeforeUpdate);
        },
        updateReturnUrls: function(event, newReturnUrl) {
            this.returnUrl = encodeURIComponent(this.cleanReturnUrl(newReturnUrl));
            this.render();
        },
        cleanReturnUrl: function(url) {
            var a = document.createElement('a');
            a.href = url;
            return (AJS.contextPath().length ? a.pathname.replace(AJS.contextPath(), '') : a.pathname) + a.search;
        },
        onPageVisibilityChange: function() {
            if (pageVisibilityManager.isPageVisible()) {
                this.scheduleNextUpdate();
            } else {
                this.cancelNextUpdate();
            }
        },
        clickPreviousButton: function (event) {
            event.preventDefault();
            var scrollDirection = SCROLL_BEFORE;

            if (this.minVisibleBuildNumber === this._firstBuildNumber) {
                return;
            }

            this.cancelNextUpdate();

            var needsFetch = this.needsFetchOnScroll(scrollDirection);

            var oldMinVisibleBuildNumber = this.minVisibleBuildNumber;
            var oldMaxVisibleBuildNumber = this.maxVisibleBuildNumber;
            this.minVisibleBuildNumber = this.collection.getPreviousBuildNumber(oldMinVisibleBuildNumber);
            this.maxVisibleBuildNumber = this.collection.getPreviousBuildNumber(oldMaxVisibleBuildNumber);
            if (this.minVisibleBuildNumber === null) {
                this.minVisibleBuildNumber = oldMinVisibleBuildNumber - 1;
                this.maxVisibleBuildNumber = oldMaxVisibleBuildNumber - 1;
            }

            if (needsFetch) {
                this._showSpinner('.previous');
                this.update({
                    buildNumber: oldMinVisibleBuildNumber,
                    scanDirection: "before"
                }).always(_.bind(this._hideSpinner, this, '.previous'));
            } else {
                this.render(scrollDirection);
                this.scheduleNextUpdate();
            }
        },
        clickNextButton: function (event) {
            event.preventDefault();
            var scrollDirection = SCROLL_AFTER;

            if (this.maxVisibleBuildNumber === this._lastBuildNumber) {
                return;
            }

            this.cancelNextUpdate();

            var needsFetch = this.needsFetchOnScroll(scrollDirection);

            var oldMinVisibleBuildNumber = this.minVisibleBuildNumber;
            var oldMaxVisibleBuildNumber = this.maxVisibleBuildNumber;
            this.minVisibleBuildNumber = this.collection.getNextBuildNumber(oldMinVisibleBuildNumber);
            this.maxVisibleBuildNumber = this.collection.getNextBuildNumber(oldMaxVisibleBuildNumber);
            if (this.maxVisibleBuildNumber === null) {
                this.minVisibleBuildNumber = oldMinVisibleBuildNumber + 1;
                this.maxVisibleBuildNumber = oldMaxVisibleBuildNumber + 1;
            }

            if (needsFetch) {
                this._showSpinner('.next');
                this.update({
                    buildNumber: oldMaxVisibleBuildNumber,
                    scanDirection: "after"
                }).always(_.bind(this._hideSpinner, this, '.next'));
            } else {
                this.render(scrollDirection);
                this.scheduleNextUpdate();
            }
        },
        needsFetchOnScroll: function(scrollDirection) {
            // do we have enough data to render straight away?
            if (scrollDirection === SCROLL_BEFORE) {
                // if our minimum visible build is not first or second in the collection, then yes.
                return (this.collection.getIndexOfBuildNumber(this.minVisibleBuildNumber) < 2);
            } else {
                // if our maximum visible build is not last or second last in the collection, then yes.
                var boundary = this.collection.length - 2;
                return (this.collection.getIndexOfBuildNumber(this.maxVisibleBuildNumber) >= boundary);
            }
        },
        showInlineDialog: function(contents, trigger, doShowPopup) {
            var $li = $(trigger).parent(),
                buildNumber = $li.data('buildNumber'),
                buildModel = this.collection.get(buildNumber),
                attributes = _.clone(buildModel.attributes);

            var hasFailed = attributes.buildStatus === 'Failed',
                existingFailuresText = null,
                newFailuresText = null;
            
            if (hasFailed) {
                var existingFailures = attributes.existingFailedTestCaseCount,
                    newFailures = attributes.newFailedTestCaseCount;
                if (existingFailures > 0) {
                    existingFailuresText = AJS.format("{0} existing {0,choice,1#test|1\u003ctests} failed", existingFailures)
                }
                if (newFailures > 0) {
                    newFailuresText = AJS.format("{0} new {0,choice,1#test|1\u003ctests} failed", newFailures)
                }
            }

            _.extend(attributes, {
                hasFailed: hasFailed,
                existingFailuresText: existingFailuresText,
                newFailuresText: newFailuresText,
                triggerHtml: attributes.trigger
            });

            if (this._inlineDialog.data('buildNumber') != buildNumber) {
                contents.html(bamboo.widget.planStatusHistory.buildDialog(attributes));
                this._inlineDialog.refresh();
                this._inlineDialog.data('buildNumber', buildNumber);
            }
            
            doShowPopup();
        }
    });

    return PlanStatusHistory;
});
;
;
/* module-key = 'bamboo.web.resources:serverstate', location = '/scripts/serverstate.js' */
BAMBOO.ADMIN = (BAMBOO.ADMIN || {});
BAMBOO.ADMIN.SERVERSTATE = {};

BAMBOO.ADMIN.SERVER_STATUS_UPDATED_EVENT = "serverStatusChangedEvent";
BAMBOO.ADMIN.SERVER_STATUS_POLLING_EVENT = "serverStatusPollingEvent";
BAMBOO.ADMIN.SERVER_STATUS_ACTION_EVENT = "serverStatusActionEvent";

BAMBOO.ADMIN.STATUS_RUNNING = "RUNNING";
BAMBOO.ADMIN.STATUS_PAUSED = "PAUSED";
BAMBOO.ADMIN.STATUS_PAUSING = "PAUSING";
BAMBOO.ADMIN.STATUS_POLLING = "POLLING";
BAMBOO.ADMIN.STATUS_ERROR = "ERROR";
BAMBOO.ADMIN.STATUS_PREPARING_FOR_RESTART = "PREPARING_FOR_RESTART";
BAMBOO.ADMIN.STATUS_READY_FOR_RESTART = "READY_FOR_RESTART";

BAMBOO.ADMIN.ACTION_PAUSE = "ACTION_PAUSE";
BAMBOO.ADMIN.ACTION_RESUME = "ACTION_RESUME";

BAMBOO.ADMIN.SERVERSTATE.serverStateUpdater = (function ($) {
    var defaults = {
            statusUrl: AJS.contextPath() + "/rest/api/latest/server",
            pauseUrl: AJS.contextPath() + "/rest/api/latest/server/pause",
            resumeUrl: AJS.contextPath() + "/rest/api/latest/server/resume"
        },
        options,
        serverState,
        $statusElement,
        doPoll = true,
        doRequest = function (type, url) {
            statusPolling();
            $.ajax({
                type: type,
                url: url,
                cache: false,
                dataType: "json",
                success: function (json) {
                    if (json && json.state) {
                        updateStatus(json, null);
                    } else {
                        updateStatus({state: BAMBOO.ADMIN.STATUS_ERROR}, null);
                    }
                },
                error: function (request, textStatus, errorThrown) {
                    updateStatus({state: BAMBOO.ADMIN.STATUS_ERROR}, textStatus + ": " + errorThrown);
                }
            });
        },
        update = function () {
            doRequest("GET", options.statusUrl);
        },
        statusPolling = function () {
            $statusElement.attr("data-server-state", BAMBOO.ADMIN.STATUS_POLLING);
            $statusElement.trigger(BAMBOO.ADMIN.SERVER_STATUS_POLLING_EVENT);
        },
        updateStatus = function (newState, additionalInfo) {
            var oldState = serverState;
            serverState = newState;
            $statusElement.attr("data-server-state", newState.state);
            if (additionalInfo) {
                $statusElement.attr("data-additional-info", additionalInfo);
            } else {
                $statusElement.removeAttr("data-additional-info");
            }
            $statusElement.trigger(BAMBOO.ADMIN.SERVER_STATUS_UPDATED_EVENT, [oldState, serverState, additionalInfo]);
        },
        pollInterval = function () {
            if (serverState && (serverState.state == BAMBOO.ADMIN.STATUS_RUNNING || serverState.state == BAMBOO.ADMIN.STATUS_PAUSED || serverState.state == BAMBOO.ADMIN.STATUS_ERROR)) {
                return 30000;
            } else {
                return 5000;
            }
        },
        poll = function (interval) {
            setTimeout(function () {
                if (doPoll) {
                    update();
                    poll(pollInterval());
                }
            }, interval);
        };

    return {
        init: function (opts) {
            options = $.extend(true, defaults, opts);
            $(function ($){
                $statusElement = $("<input id='bamboo-server-status' type='hidden'>").appendTo("body");
                if (doPoll) {
                    update();
                    poll(pollInterval());
                }
            });
        },

        pause: function () {
            $statusElement.trigger(BAMBOO.ADMIN.SERVER_STATUS_ACTION_EVENT, BAMBOO.ADMIN.ACTION_PAUSE);
            doRequest("POST", options.pauseUrl);
            poll(1000);
        },

        resume: function () {
            $statusElement.trigger(BAMBOO.ADMIN.SERVER_STATUS_ACTION_EVENT, BAMBOO.ADMIN.ACTION_RESUME);
            doRequest("POST", options.resumeUrl);
        },

        onServerStatusPolling: function (callback) {
            $statusElement.bind(BAMBOO.ADMIN.SERVER_STATUS_POLLING_EVENT, callback);
        },

        onServerStatusUpdated: function (callback) {
            $statusElement.bind(BAMBOO.ADMIN.SERVER_STATUS_UPDATED_EVENT, callback);
        },

        onServerStatusAction: function (callback) {
            $statusElement.bind(BAMBOO.ADMIN.SERVER_STATUS_ACTION_EVENT, callback);
        },

        stopPolling: function () {
            doPoll = false;
        }
    }
})(AJS.$);

BAMBOO.ADMIN.SERVERSTATE.serverState = (function ($) {
    var defaults = {
            control: null,
            statusInfo: null,
            button: null,
            pausedMessage: "The server is \u003cstrong\u003epaused\u003c/strong\u003e. No builds will be run or queued.",
            pausedButtonLabel: "Resume server",
            pausingMessage: "The server is \u003cstrong\u003epausing\u003c/strong\u003e. No builds will be queued. All currently building plans will finish but requests for new builds is not allowed.",
            pausingButtonLabel: "Cancel pause",
            reindexInProgressMessage: "The server is being reindexed. Not all data might be available at the moment.",
            preparingForRestartMessage: "The server is \u003cstrong\u003epreparing for restart\u003c/strong\u003e. No builds will be queued.",
            readyForRestartMessage: "The server is \u003cstrong\u003eready for restart\u003c/strong\u003e. No builds will be queued.",
            serverRunningCallback: null,
            pollError: "Server could not be contacted and its state is unknown. Please reload the page",
            reloadPage: "Reload"
        },
        options,
        lifecycleState,
        $control,
        $button,
        $statusInfo,
        updateStatus = function (event, oldState, newState) {
            if (lifecycleState) {
                $control.removeClass("server-status-" + lifecycleState.toLowerCase());
            }
            lifecycleState = newState.state;
            $control.addClass("server-status-" + lifecycleState.toLowerCase());

            var oldLifecycleState = oldState ? oldState.state : undefined;

            if (lifecycleState == BAMBOO.ADMIN.STATUS_RUNNING) {
                if (oldLifecycleState != BAMBOO.ADMIN.STATUS_RUNNING && options.serverRunningCallback) {
                    options.serverRunningCallback();
                }
                if (newState.reindexInProgress) {
                    $statusInfo.html(options.reindexInProgressMessage);
                    $button.hide();
                    $control.show();
                } else {
                    $control.hide();
                }
                return;
            } else if (lifecycleState == BAMBOO.ADMIN.STATUS_ERROR) {
                if (oldLifecycleState == BAMBOO.ADMIN.STATUS_PAUSED || oldLifecycleState == BAMBOO.ADMIN.STATUS_PAUSING) {
                    if ($button && $button.length) {
                        $button.text(options.reloadPage).click(function () {
                            window.location.reload();
                        });
                    }
                    $statusInfo.html(options.pollError);
                    $control.show();
                } else if (oldLifecycleState != BAMBOO.ADMIN.STATUS_ERROR) {
                    $control.hide();
                }
                return;
            } else {
                $control.show();
            }

            if (lifecycleState == BAMBOO.ADMIN.STATUS_PAUSED || lifecycleState == BAMBOO.ADMIN.STATUS_PAUSING) {
                if ($button && $button.length) {
                    $button.show();
                }
            } else if (lifecycleState == BAMBOO.ADMIN.STATUS_PREPARING_FOR_RESTART || lifecycleState == BAMBOO.ADMIN.STATUS_READY_FOR_RESTART) {
                if ($button && $button.length) {
                    $button.hide();
                }
            }

            if (lifecycleState == BAMBOO.ADMIN.STATUS_PAUSING) {
                if ($button && $button.length) {
                    $button.text(options.pausingButtonLabel);
                }
                $statusInfo.html(options.pausingMessage);
            } else if (lifecycleState == BAMBOO.ADMIN.STATUS_PAUSED) {
                if ($button && $button.length) {
                    $button.text(options.pausedButtonLabel);
                }
                $statusInfo.html(options.pausedMessage);
            } else if (lifecycleState == BAMBOO.ADMIN.STATUS_PREPARING_FOR_RESTART) {
                $statusInfo.html(options.preparingForRestartMessage);
            } else if (lifecycleState == BAMBOO.ADMIN.STATUS_READY_FOR_RESTART) {
                $statusInfo.html(options.readyForRestartMessage);
            }
        };

    return {
        init: function (opts) {
            options = $.extend(true, defaults, opts);

            $(function () {
                $control = $(options.control);
                $statusInfo = $(options.statusInfo, $control);
                $button = $(options.button, $control);

                if ($button && $button.length) {
                    $button.click(BAMBOO.ADMIN.SERVERSTATE.serverStateUpdater.resume);
                }
                BAMBOO.ADMIN.SERVERSTATE.serverStateUpdater.onServerStatusUpdated(updateStatus);
            });
        }
    }
})(AJS.$);
;
;
/* module-key = 'bamboo.web.resources:jirajs', location = '/scripts/jira/inheritance.js' */

// Inspired by base2 and Prototype
(function(){

begetObject = function (obj)
{
    var f = function()
    {};
    f.prototype = obj;
    return new f();
};
    

  var initializing = false, fnTest = /xyz/.test(function(){xyz;}) ? /\b_super\b/ : /.*/;

  // The base Class implementation (does nothing)
  this.Class = function(){};

  // Create a new Class that inherits from this class
  Class.extend = function() {

      var prop;

      var _super = this.prototype;

    if (arguments.length > 1) {

        var interfaces = AJS.$.makeArray(arguments);

        prop = interfaces.pop();

        var completeInterface;

        AJS.$.each(interfaces, function (i, inter) {
            if (completeInterface) {
                completeInterface = completeInterface.extend(inter);
            } else {
                completeInterface = inter;
            }
        });

        return completeInterface.extend(this.prototype).extend(prop);

    } else {
        prop = arguments[0];
    }


    // Instantiate a base class (but only create the instance,
    // don't run the init constructor)
    initializing = true;
    var prototype = new this();
    initializing = false;

    // Copy the properties over onto the new prototype
    for (var name in prop) {
      // Check if we're overwriting an existing function

        if (prototype[name] = typeof prop[name] == "function" &&
        typeof _super[name] == "function" && fnTest.test(prop[name])) {
            prototype[name] = (function(name, fn){
              return function() {
                var tmp = this._super;

                // Add a new ._super() method that is the same method
                // but on the super-class
                this._super = _super[name];

                // The method only need to be bound temporarily, so we
                // remove it when we're done executing
                var ret = fn.apply(this, arguments);
                this._super = tmp;

                return ret;
              };
            })(name, prop[name]);
        } else if (typeof _super[name] === "object") {
            var newObj = begetObject(prop[name]);

            AJS.$.each(_super[name], function (name, obj) {
                if (!newObj[name]) {
                    newObj[name] = obj;
                } else if (typeof newObj[name] === "object") {
                    var newSubObj = begetObject(newObj[name]);
                    AJS.$.each(obj, function (subName, subObj) {
                        if (!newSubObj[subName]) {
                            newSubObj[subName] = subObj;
                        }
                    });
                    newObj[name] = newSubObj;
                }
            });

            prototype[name] = newObj;
        } else {
            prototype[name] = prop[name];
        }
    }

    // The dummy class constructor
    function Class() {
      // All construction is actually done in the init method
      if ( !initializing && this.init )
        this.init.apply(this, arguments);
    }

    // Populate our constructed prototype object
    Class.prototype = prototype;

    // Enforce the constructor to be what we expect
    Class.constructor = Class;

    // And make this class extendable
    Class.extend = arguments.callee;

    return Class;
  };
})();

var Interface = Class.extend({});;
;
/* module-key = 'bamboo.web.resources:jirajs', location = '/scripts/jira/autocomplete.js' */
/**
 * Ajax autocomplete
 *
 * @module jira.widget.autocomplete
 * @author Scott Harwood
 * @requires jQuery > v1.2, jira.widget.fauxSelect
 * @since 4.0
 *
 */


AJS.namespace("jira.widget.autocomplete");

/**
 * Designed for prototypial inheritance !!Abstract only
 * @abstract autocomplete
 */
jira.widget.autocomplete = function() {

    var inFocus;

    /**
     * Calls a callback after specified delay
     * @method {private} delay
     * @param {Number} l - length of delay in <em>seconds</em>
     * @param {Function} callback - function to call after delay
     */
    var delay = function(callback,l) {
        if (delay.t) {
            clearTimeout(delay.t);
            delay.t = undefined;
        }
        delay.t = setTimeout(callback, l * 1000);
    };

    var INVALID_KEYS = {
          9: true,
         13: true,
         14: true,
         25: true,
         27: true,
         38: true,
         40: true,
        224: true
    };

    return {

        /**
        * Checks whether a saved version (cached) of the request exists, if not performs a request and saves response,
        * then dispatches saved response to <em>renderSuggestions</em> method.
        *
        * @method {public} dispatcher
        */
        dispatcher: function() {},


        /**
         * Gets cached response
         *
         * @method {public} getSavedResponse
         * @param {String} val
         * @returns {Object}
         */
        getSavedResponse: function() {},

        /**
         * Saves response
         *
         * @method {public} saveResponse
         * @param {String} val
         * @param {Object} response
         */
        saveResponse: function() {},

        /**
         * Called to render suggestions. Used to define interface only.
         * Rendering is difficult to make generic, best to leave this to extending prototypes.
         *
         * @method {public} renderSuggestions
         * @param {Object} res - results object
         */
        renderSuggestions: function() {},

        /**
         * Disables autocomplete. Useful for shared inputs.
         * i.e The selection of a radio button may disable the instance
         * @method {Public} disable
         */
        disable: function() {
            this.disabled = true;
        },

        /**
         * Enables autocomplete. Useful for shared inputs.
         * i.e The selection of a radio button may disable the instance
         * @method {Public} enable
         */
        enable: function() {
            this.disabled = false;
        },

        /**
         * Sets instance variables from options object
         * to do: make function create getters and setters
         * @method {public} set
         * @param {Object} options
         */
        set: function(options) {
            for (var name in options) {
                // safeguard to stop looping up the inheritance chain
                if (options.hasOwnProperty(name)) {
                    this[name] = options[name];
                }
            }
        },

        /**
         * Adds value to input field
         * @method {public} completeField
         * @param {String} value
         */
        completeField: function(value) {
            if (value) {
                this.field.val(value).focus();
            }
        },

        /**
         * Returns the text from the start of the field up to the end of
         * the position where suggestions are generated from.
         */
        textToSuggestionCursorPosition: function () {
            return this.field.val();
        },


        /**
         * Allows users to navigate/select suggestions using the keyboard
         * @method {public} addSuggestionControls
         */
         addSuggestionControls: function(suggestionNodes) {

            // reference to this for closures
            var that = this;

            /**
             * Make sure the index is within the threshold
             * Looks ugly! Has to be a better way.
             * @method {private} evaluateIndex
             * @param {Integer} idx
             * @param {Integer} max
             * @return {Integer} valid threshold
             */
            var evaluateIndex = function(idx, max) {
                var minBoundary = (that.autoSelectFirst === false) ? -1 : 0;
                if (that.allowArrowCarousel) {
                    if (idx > max) {
                        return minBoundary;
                    } else if (idx < minBoundary) {
                        return max;
                    } else {
                        return idx;
                    }
                }
                else {
                    if (idx > max) {
                        return max;
                    } else if (idx < minBoundary) {
                        that.responseContainer.scrollTop(0);
                        return minBoundary;
                    } else {
                        return idx;
                    }
                }
            };

            /**
             * Highlights focused node and removes highlight from previous.
             * Actual highlight styles to come from css, adding and removing classes here.
             * @method {private} setActive
             * @param {Integer} idx - Index of node to be highlighted
             */
            var setActive = function(idx) {

                    // if nothing is selected, select the first suggestion
                    if (that.selectedIndex !== undefined && that.selectedIndex > -1) {
                        that.suggestionNodes[that.selectedIndex][0].removeClass("active");
                    }
                    that.selectedIndex = evaluateIndex(idx, that.suggestionNodes.length-1);
                    if (that.selectedIndex > -1) {
                        that.suggestionNodes[that.selectedIndex][0].addClass("active");
                    }
            };

             /**
              * Checks to see if there is actually a suggestion in focus before attempting to use it
              * @method {private} evaluateIfActive
              * @returns {boolean}
              */
             var evaluateIfActive = function() {
                return that.suggestionNodes && that.suggestionNodes[that.selectedIndex] &&
                       that.suggestionNodes[that.selectedIndex][0].hasClass("active");
             };


            /**
             * When the responseContainer (dropdown) is visible listen for keyboard events
             * that represent focus or selection.
             * @method {private} keyPressHandler
             * @param {Object} e - event object
             */
            var keyPressHandler = function(e) {
                // only use keyboard events if dropdown is visible
                if (that.responseContainer.is(":visible")) {
                    // if enter key is pressed check that there is a node selected, then hide dropdown and complete field
                    if (e.keyCode === 13) {
                        if (evaluateIfActive() && !that.pendingRequest) {
                            that.completeField(that.suggestionNodes[that.selectedIndex][1]);
                        }
                        e.preventDefault();
                    }
                }
            };

            /**
            * sets focus on suggestion nodes using the "up" and "down" arrows
            * These events need to be fired on mouseup as modifier keys don't register on keypress
            * @method {private} keyUpHandler
            * @param {Object} e - event object
            */
            var keyboardNavigateHandler = function(e) {

                // only use keyboard events if dropdown is visible
                if (that.responseContainer.is(":visible")) {

                    // keep cursor inside input field
                    if (that.field[0] !== document.activeElement){
                        that.field.focus();
                    }
                    // move selection down when down arrow is pressed
                    if (e.keyCode === 40) {
                        setActive(that.selectedIndex + 1);
                        if (that.selectedIndex >= 0) {
                            // move selection up when up arrow is pressed
                            var containerHeight = that.responseContainer.height();
                            var bottom = that.suggestionNodes[that.selectedIndex][0].position().top + that.suggestionNodes[that.selectedIndex][0].outerHeight() ;

                            if (bottom - containerHeight > 0){
                                that.responseContainer.scrollTop(that.responseContainer.scrollTop() + bottom - containerHeight + 2);
                            }
                        } else {
                            that.responseContainer.scrollTop(0);
                        }
                        e.preventDefault();
                    } else if (e.keyCode === 38) {
                        setActive(that.selectedIndex-1);
                        if (that.selectedIndex >= 0) {
                            // if tab key is pressed check that there is a node selected, then hide dropdown and complete field
                            var top = that.suggestionNodes[that.selectedIndex][0].position().top;
                            if (top < 0){
                                that.responseContainer.scrollTop(that.responseContainer.scrollTop() + top - 2);
                            }
                        }
                        e.preventDefault();
                    } else if (e.keyCode === 9) {
                        if (evaluateIfActive()) {
                            that.completeField(that.suggestionNodes[that.selectedIndex][1]);
                            e.preventDefault();
                        } else {
                            that.dropdownController.hideDropdown();
                        }
                    }
                }
            };

            if (suggestionNodes.length) {

                this.selectedIndex = 0;
                this.suggestionNodes = suggestionNodes;

                for (var i=0; i < that.suggestionNodes.length; i++) {
                    var eventData = { instance: this, index: i };
                    this.suggestionNodes[i][0]
                        .bind("mouseover", eventData, activate)
                        .bind("mouseout", eventData, deactivate)
                        .bind("click", eventData, complete);
                }

                // make sure we don't bind more than once
                if (!this.keyboardHandlerBinded) {
                    jQuery(this.field).keypress(keyPressHandler);
                    if (jQuery.browser.mozilla) {
                        jQuery(this.field).keypress(keyboardNavigateHandler);
                    } else {
                        jQuery(this.field).keydown(keyboardNavigateHandler);
                    }
                    this.keyboardHandlerBinded = true;
                }

                // automatically select the first in the list
                if(that.autoSelectFirst === false) {
                    setActive(-1);
                } else {
                    setActive(0);
                }

                // sets the autocomplete singleton infocus var to this instance
                // is used to toggle event propagation. In short, the instance that it is set to will not hide the
                // dropdown each time you click the input field
                inFocus = this;
            }

            function activate(event) {
                if (that.dropdownController.displayed) {
                    setActive(event.data.index);
                }
            }
            function deactivate(event) {
                if (event.data.index === 0) {
                    that.selectedIndex = -1;
                }
                jQuery(this).removeClass("active");
            }
            function complete(event) {
                that.completeField(that.suggestionNodes[event.data.index][1]);
            }
        },


        /**
         * Uses jquery empty command, this is VERY important as it unassigns handlers
         * used for mouseover, click events which expose an opportunity for memory leaks
         * @method {public} clearResponseContainer
         */
        clearResponseContainer: function() {
            this.responseContainer.empty();
            this.suggestionNodes = undefined;
        },

        /**
         * function {Privileged} delay
         * @param response
         */
        delay: delay,

        /**
         * Builds HTML container for suggestions.
         * Positions container top position to be that of the field height
         * @method {public} buildResponseContainer
         */
        buildResponseContainer: function() {
            var inputParent = this.field.parent().addClass('atlassian-autocomplete');
            this.responseContainer = jQuery(document.createElement("div"));
            this.responseContainer
                .addClass("suggestions")
                .css({top: this.field.outerHeight() + "px"})
                .appendTo(inputParent);
        },

        /**
         * Validates the keypress by making sure the field value is beyond the set threshold and the key was either an
         * up or down arrow
         * @method {public} keyUpHandler
         * @param {Object} e - event object
         */
        keyUpHandler: (function () {
            var isIe8 = jQuery.browser.msie && jQuery.browser.version == 8;
            function callback() {
                if (!this.responseContainer) {
                    this.buildResponseContainer();
                }
                // send value to dispatcher to check if we have already got the response or if we need to go
                // back to the server
                this.dispatcher(this.field.val());
            }

            return function (e) {
                // only initialises once the field length is past set length
                if (this.field.val().length >= this.minQueryLength) {
                    // don't do anything if the key pressed is "enter" or "down" or "up" or "right" "left"
                    if (!(e.keyCode in INVALID_KEYS) || (this.responseContainer && !this.responseContainer.is(":visible") && (e.keyCode == 38 || e.keyCode == 40))) {
                        if (isIe8) {
                            // Performance workaround for IE8 (but not IE7): excessive DOM manipulation (JRADEV-3142)
                            delay(jQuery.proxy(callback, this), 0.200);
                        } else {
                            callback.call(this);
                        }
                    }
                }
                return e;
            };
        })(),

        /**
         * Adds in methods via AOP to handle multiple selections
         * @method {Public} addMultiSelectAdvice
         */
        addMultiSelectAdvice: function(delim) {

            // reference to this for closures
            var that = this;

            /**
             * Alerts user if value already exists
             * @method {private} alertUserValueAlreadyExists
             * @param {String} val - value that already exists, will be displayed in message to user.
             */
            var alertUserValueAlreadyExists = function(val) {

                // check if there is an existing alert before adding another
                if (!alertUserValueAlreadyExists.isAlerting) {

                    alertUserValueAlreadyExists.isAlerting = true;

                    // create alert node and append it to the input field's parent, fade it in then out with a short
                    // delay in between.
                    //TODO: JRA-1800 - Needs i18n!  
                    var userAlert = jQuery(document.createElement("div"))
                    .css({"float": "left", display: "none"})
                    .addClass("warningBox")
                    .html("Oops! You have already entered the value <em>" + val + "</em>" )
                    .appendTo(that.field.parent())
                    .show("fast", function(){
                        // display message for 4 seconds before fading out
                        that.delay(function(){
                            userAlert.hide("fast",function(){
                                // removes element from dom
                                userAlert.remove();
                                alertUserValueAlreadyExists.isAlerting = false;
                            });
                        }, 4);
                    });
                }
            };

          // rather than request the entire field return the last comma seperated value
            jQuery.aop.before({target: this, method: "dispatcher"}, function(innvocation){
                // matches everything after last comma
                var val = this.field.val();
                innvocation[0] = jQuery.trim(val.slice(val.lastIndexOf(delim) + 1));
                return innvocation;
            });

            // rather than replacing this field just append the new value
            jQuery.aop.before({target: this, method: "completeField"}, function(args){
                var valueToAdd = args[0],
                // create array of values
                untrimmedVals = this.field.val().split(delim);
                // trim the values in the array so we avoid extra spaces being appended to the usernames - see JRA-20657
                var trimmedVals = jQuery(untrimmedVals).map(function() {
                        return jQuery.trim(this);
                   }).get();
                // check if the value to append already exists. If it does then call alert to to tell user and sets
                // the last value to "". The value to add will either appear:
                // 1) at the start of the string
                // 2) after some whitespace; or
                // 3) directly after the delimiter
                // It is assumed that the value is delimited by the delimiter character surrounded by any number of spaces.
                if (!this.allowDuplicates && new RegExp("(?:^|[\\s" + delim + "])" + valueToAdd + "\\s*" + delim).test(this.field.val())) {
                    alertUserValueAlreadyExists(valueToAdd);
                    trimmedVals[trimmedVals.length-1] = "";
                } else {
                    // add the new value to the end of the array and then an empty value so we
                    // can get an extra delimiter at the end of the joined string
                    trimmedVals[trimmedVals.length-1] = valueToAdd;
                    trimmedVals[trimmedVals.length] = "";
                }

                // join the array of values with the delimiter plus an extra space to make the list of values readable
                args[0] = trimmedVals.join(delim.replace(/([^\s]$)/,"$1 "));

                return args;
            });
        },


        /**
         * Adds and manages state of dropdown control
         * @method {Public} addDropdownAdvice
         */
        addDropdownAdvice: function() {
            var that = this;

            // add dropdown functionality to response container
            jQuery.aop.after({target: this, method: "buildResponseContainer"}, function(args){
                this.dropdownController = jira.widget.dropdown.Autocomplete({target: this, method: "renderSuggestions"}, this.responseContainer);

                if (AJS.$.browser.msie) { // We need to remove this class for IE as it has position relative which causes content further down the dom to show through the suggestions
                    jQuery.aop.before({ target: this.dropdownController, method: "displayDropdown" }, function () {
                        that.field.parent().addClass("atlassian-autocomplete");
                    });

                    jQuery.aop.after({ target: this.dropdownController, method: "hideDropdown" }, function () {
                        that.field.parent().removeClass("atlassian-autocomplete");
                    });
                }

                return args;
            });

            // display dropdown afer suggestions are updated
            jQuery.aop.after({target: this, method: "renderSuggestions"}, function(args){
                if (args && args.length > 0) {
                    this.dropdownController.displayDropdown();
                } else {
                    this.dropdownController.hideDropdown();
                }
                return args;
            });

            // hide dropdown after suggestion value is applied to field
            jQuery.aop.after({target: this, method: "completeField"}, function(args){
                this.dropdownController.hideDropdown();
                return args;
            });

            jQuery.aop.after({target: this, method: "keyUpHandler"}, function(e) {
                // only initialises once the field length is past set length
                if ((!(this.field.val().length >= this.minQueryLength) || e.keyCode === 27)
                        && this.dropdownController && this.dropdownController.displayed) {
                    this.dropdownController.hideDropdown();
                    if (e.keyCode === 27) {
                        e.stopPropagation();
                    }
                }
                return e;
            });
        },

        /**
         * Initialises autocomplete by setting options, and assigning event handler to input field.
         * @method {public} init
         * @param {Object} options
         */
        init: function(options) {
            var that = this;
            this.set(options);
            this.field = this.field || jQuery("#" + this.fieldID);
             // turn off browser default autocomplete
            this.field.attr("autocomplete","off")
            .keyup(function(e){
                if (!that.disabled) {
                    that.keyUpHandler(e);
                }
            })
            .keydown(function (e) {
                var ESC_KEY = 27;
                // do not clear field in IE
                if (e.keyCode === ESC_KEY && that.responseContainer && that.responseContainer.is(":visible")) {
                    e.preventDefault();
                }
            })
            // this will stop the dropdown with the suggestions hiding whenever you click the field
            .click(function(e){
                if (inFocus === that) {
                    e.stopPropagation();
                }
            });

            this.addDropdownAdvice();

            if (options.delimChar) {
                this.addMultiSelectAdvice(options.delimChar);
            }
        }
    };

}();


/**
 * Designed for prototypial inheritance !!Abstract only
 * @abstract REST
 */
jira.widget.autocomplete.REST = function() {

    // prototypial inheritance (http://javascript.crockford.com/prototypal.html)
    var that = begetObject(jira.widget.autocomplete);

   /**
    * Checks whether a saved version (cached) of the request exists, if not performs a request and saves response,
    * then dispatches saved response to <em>renderSuggestions</em> method.
    * @method {public} dispatcher
    * @param {String} reqFieldVal
    */
    that.dispatcher = function(reqFieldVal) {

        // reference to "this" for use in closures
         var that = this;

         if (reqFieldVal.length < this.minQueryLength) {
             return;
         }

         if (!this.getSavedResponse(reqFieldVal)) {



            // Add a delay so that we don't go the server for every keypress,
            // some people type fast and may have already typed an entire word by the time the server comes
            // back with a response

            this.delay(function(){

                that.pendingRequest = true;

                var params = that.getAjaxParams();
                params.data.query = reqFieldVal;
                params.success = function(data){
                    // for use later so we don't have to go back to the server for the same query
                    that.saveResponse(reqFieldVal, data);
                    // creates html elements from JSON object
                    that.responseContainer.scrollTop(0);
                    that.renderSuggestions(data);
                };

                params.complete = function () {
                    that.pendingRequest = false;
                };

                AJS.$.ajax(params);

            }, that.queryDelay);

        } else {
            that.renderSuggestions(that.getSavedResponse(reqFieldVal));
            that.responseContainer.scrollTop(0);
        }
    };


    that.getAjaxParams = function(){};

    /**
     * Gets cached response from <em>requested</em> object
     * @method {public} getSavedResponse
     * @param {String} val
     * @returns {Object}
     */
    that.getSavedResponse = function(val) {
        if (!this.requested) {
            this.requested = {};
        }
        return this.requested[val];
    };

    /**
     * Saves response to <em>requested</em> object
     * @method {public} saveResponse
     * @param {String} val
     * @param {Object} response
     */
    that.saveResponse = function(val, response) {
        if (typeof val === "string" && typeof response === "object") {
            if (!this.requested) {
                this.requested = {};
            }
            this.requested[val] = response;
        }
    };

    return that;

}();

/**
 * User picker - converted from YUI based autocomplete. There is some code in here that probably isn't necessary,
 * if removed though selenium tests would need to be re-written.
 * @constructer Users
 * @param options
 * @returns {Object}
 */
jira.widget.autocomplete.Users = function(options) {

    // prototypial inheritance (http://javascript.crockford.com/prototypal.html)
    var that = begetObject(jira.widget.autocomplete.REST);

    that.getAjaxParams = function(){
        return {
            url: contextPath + "/rest/api/1.0/users/picker",
            data: {
                fieldName: options.fieldID
            },
            dataType: "json",
            type: "GET"
        };
    };

    /**
     * Create html elements from JSON object
     * @method renderSuggestions
     * @param {Object} response - JSON object
     * @returns {Array} Multidimensional array, one column being the html element and the other being its
     * corresponding complete value.
     */
    that.renderSuggestions = function(response) {


        var resultsContainer, suggestionNodes = [];

        // remove previous results
        this.clearResponseContainer();


        if (response && response.users && response.users.length > 0) {

            resultsContainer = jQuery("<ul/>").appendTo(this.responseContainer);

            jQuery(response.users).each(function() {

                // add html element and corresponding complete value  to sugestionNodes Array
                suggestionNodes.push([jQuery("<li/>")
                .html(this.html)
                .appendTo(resultsContainer), this.name]);

            });
        }

        if (response.footer) {
            this.responseContainer.append(jQuery("<div/>")
            .addClass("yui-ac-ft")
            .html(response.footer)
            .css("display","block"));
        }

        if (suggestionNodes.length > 0) {
            that.addSuggestionControls(suggestionNodes);
            AJS.$('.atlassian-autocomplete div.yad, .atlassian-autocomplete .labels li').textOverflow('&#x2026;',true);
        }

        return suggestionNodes;

    };

    // Use autocomplete only once the field has at least 2 characters
    options.minQueryLength = 2;

    // wait 1/4 of after someone starts typing before going to server
    options.queryDelay = 0.25;

    that.init(options);

    return that;

};

/**
 * @constructor Issues
 * @param options
 */
jira.widget.autocomplete.Issues = function(options) {

    // prototypial inheritance (http://javascript.crockford.com/prototypal.html)
    var that = begetObject(jira.widget.autocomplete.REST);


    that.getAjaxParams = function(){
        return {
            url: contextPath + "/rest/api/1.0/issues/picker",
            data: options.ajaxData,
            dataType: "json",
            type: "GET"
        };
    };

    /**
     * @method renderSuggestions
     * @param {Object} response
     */
    that.renderSuggestions = function(response) {

        var resultsContainer, suggestionNodes = [];

        // remove previous results
        this.clearResponseContainer();

        if (response && response.sections && response.sections.length > 0) {

            resultsContainer = AJS.$("<ul/>").appendTo(this.responseContainer);

            AJS.$(response.sections).each(function() {
                var section = this;
                var subSection = AJS.$("<div/>").attr("id", options.fieldID + "_s_" + section.id).addClass("yag").text(section.label);
                if (section.sub){
                    subSection.append(AJS.$("<span/>").addClass("yagt").text("(" + section.sub + ")"));
                }
                resultsContainer.append(AJS.$("<li/>").append(subSection).mouseover(function(){
                        AJS.$(this).addClass("active");
                    }).mouseout(function(){
                        AJS.$(this).removeClass("active");
                    })
                );

                if (section.msg){
                    // add message node
                    var msg = AJS.$("<div/>").attr("id", options.fieldID + "_i_" + section.id + "_n").addClass("yad").text(section.msg);
                    resultsContainer.append(AJS.$("<li/>").append(msg).mouseover(function(){
                            AJS.$(this).addClass("active");
                        }).mouseout(function(){
                            AJS.$(this).removeClass("active");
                        })
                    );
                }

                if (section.issues && section.issues.length > 0){
                    AJS.$(section.issues).each(function(){
                        // add issue
                        var imgUrl;
                        if (/^http/.test(this.img)){
                            imgUrl = this.img;
                        } else {
                            imgUrl =  contextPath + this.img;
                        }
                        var issueNode = AJS.$("<li/>").append(
                            AJS.$("<div/>").attr("id", options.fieldID + "_i_" + section.id + "_" + this.key).addClass("yad").append(
                                AJS.$("<table/>").addClass("yat").attr({
                                    cellpadding: "0",
                                    cellspacing: "0"
                                }).append(
                                    AJS.$("<tr/>").append(
                                        AJS.$("<td/>").append(
                                            AJS.$("<img/>").attr("src", imgUrl)
                                        )
                                    ).append(
                                         AJS.$("<td/>").append(
                                            AJS.$("<div/>").addClass("yak").html(this.keyHtml)
                                        )
                                    ).append(
                                         AJS.$("<td/>").css("width", "100%").html(this.summary)
                                    )
                                )
                            )
                        );

                        resultsContainer.append(issueNode);
                        suggestionNodes.push([issueNode, this.key]);
                    });                    
                }
            });

            that.addSuggestionControls(suggestionNodes);

            return suggestionNodes;

        }
    };
    options.minQueryLength = 1;
    options.queryDelay = 0.25;

    that.init(options);

    return that;

};

jira.widget.autocomplete.Users.init = function(parent){
    AJS.$("fieldset.user-picker-params", parent).each(function(){
        var params = AJS.parseOptionsFromFieldset(AJS.$(this)),
            field = (params.fieldId || params.fieldName),
            $container = AJS.$("#" + field + "_container");


        $container.find("a.popup-trigger").click(function(e){
            var url = contextPath,
                vWinUsers;

            e.preventDefault();

            if (!params.formName)
            {
                params.formName = $container.find("#" + field).parents("form").attr("name");
            }

            if (params.actionToOpen) {
                url = url + params.actionToOpen;
            } else {
                url = url + '/secure/popups/UserPickerBrowser.jspa';
            }
            url += '?formName=' + params.formName + '&';
            url += 'multiSelect=' + params.multiSelect + '&';
            url += 'element=' + field;

            vWinUsers = window.open(url, 'UserPicker', 'status=yes,resizable=yes,top=100,left=200,width=580,height=750,scrollbars=yes');
            vWinUsers.opener = self;
            vWinUsers.focus();
        });


        if (params.userPickerEnabled === true ){
            jira.widget.autocomplete.Users({
                field: parent ? parent.find("#" + field) : null,
                fieldID: field,
                delimChar: params.multiSelect === false ? undefined : ",",
                ajaxData: {
                    fieldName: params.fieldName
                }
            });
        }
    });
};
AJS.$(document).bind("dialogContentReady", function(e, dialog){
    jira.widget.autocomplete.Users.init(dialog.get$popupContent());
});

jira.widget.autocomplete.Issues.init = function(){

    AJS.namespace("jira.issuepicker");

    AJS.$("fieldset.issue-picker-params").each(function(){
        var params = AJS.parseOptionsFromFieldset(AJS.$(this)),
            $container = AJS.$("#" + params.fieldId + "-container").add("#" + params.fieldName + "_container");

        $container.find("a.popup-trigger").click(function(e){
            var url = contextPath + '/secure/popups/IssuePicker.jspa?';
            url += 'currentIssue=' + params.currentIssueKey + '&';
            url += 'singleSelectOnly=' + params.singleSelectOnly + '&';
            url += 'showSubTasks=' + params.showSubTasks + '&';
            url += 'showSubTasksParent=' + params.showSubTaskParent;
            if (params.currentProjectId && params.currentProjectId != "")
            {
                url += '&selectedProjectId=' + params.currentProjectId;
            }

            /**
             * Provide a callback to the window for execution when the user selects an issue. This implies that only one
             * popup can be displayed at a time.
             * 
             * @param keysMap the issue keys selected.
             */
            jira.issuepicker.callback = function(keysMap){
                var $formElement, keys = [];

                keysMap = JSON.parse(keysMap);

                if (params.fieldId && keys) {
                    $formElement = AJS.$("#" + params.fieldId);
                    if ($formElement){
                        AJS.$.each(keysMap, function () {
                            keys.push(this.value);
                        });
                        $formElement.val(keys.join(", "));
                    }
                }
            };

            var vWinUsers = window.open(url, 'IssueSelectorPopup', 'status=no,resizable=yes,top=100,left=200,width=620,height=500,scrollbars=yes,resizable');
            vWinUsers.opener = self;
            vWinUsers.focus();
            e.preventDefault();
        });

        if (!params.fieldId) {
            params.fieldId = params.fieldName;
        }
        
        if (params.issuePickerEnabled === true){
            jira.widget.autocomplete.Issues({
                fieldID: params.fieldId,
                delimChar: params.singleSelectOnly === true ? undefined : ",",
                ajaxData: params
            });
        }
    });
};
AJS.$(function(){
    jira.widget.autocomplete.Users.init();
    jira.widget.autocomplete.Issues.init();
});

AJS.$(function(){
    AJS.$("fieldset.user-searcher-params").each(function(){
        var params = AJS.parseOptionsFromFieldset(AJS.$(this)),
            $container = AJS.$("#" + params.fieldId + "_container");

        if (params.userPickerEnabled === true){
            var autocompleter = jira.widget.autocomplete.Users({
                fieldID: params.fieldId,
                delimChar: params.multiSelect === true ? "," : undefined,
                ajaxData: {
                    fieldName: params.fieldName
                }
            });
        }

        var setupFields = function(related){
            var field = AJS.$("#" + params.fieldId);
            var userImage = AJS.$("#" + params.fieldId + "Image");
            var groupImage = AJS.$("#" + params.fieldId + "GroupImage");
            var fieldDesc = AJS.$("#" + params.fieldId + "_desc");
            if (related === "select.list.none"){
                field.val("").attr("disabled", "true");
                userImage.hide();
                groupImage.hide();
                fieldDesc.hide();
            } else{
                field.removeAttr("disabled");
                if (related === "select.list.group"){
                    userImage.hide();
                    groupImage.show();
                    if (params.userPickerEnabled === true){
                        autocompleter.disable();
                        fieldDesc.hide();
                    }
                } else {
                    userImage.show();
                    groupImage.hide();
                    if (params.userPickerEnabled === true){
                        autocompleter.enable();
                        fieldDesc.show();
                    }
                }
            }
        };

        AJS.$("#" + params.userSelect).change(function(){
            var related = AJS.$(this).find("option:selected").attr("rel");
            setupFields(related);
        }).find("option:selected").each(function(){
            setupFields(AJS.$(this).attr("rel"));
        });

        $container.find("a.user-popup-trigger").click(function(e){
            var url = contextPath + '/secure/popups/UserPickerBrowser.jspa?';
            url += 'formName=' + params.formName + '&';
            url += 'multiSelect=' + params.multiSelect + '&';
            url += 'element=' + params.fieldId;

            var vWinUsers = window.open(url, 'UserPicker', 'status=yes,resizable=yes,top=100,left=200,width=580,height=750,scrollbars=yes');
            vWinUsers.opener = self;
            vWinUsers.focus();
            e.preventDefault();
        });

        $container.find("a.group-popup-trigger").click(function(e){
            var url = contextPath + '/secure/popups/GroupPickerBrowser.jspa?';
            url += 'formName=' + params.formName + '&';
            url += 'multiSelect=' + params.multiSelect + '&';
            url += 'element=' + params.fieldId;

            var vWinUsers = window.open(url, 'GroupPicker', 'status=yes,resizable=yes,top=100,left=200,width=580,height=750,scrollbars=yes');
            vWinUsers.opener = self;
            vWinUsers.focus();
            e.preventDefault();
        });
    });
});;
;
/* module-key = 'bamboo.web.resources:jirajs', location = '/scripts/jira/dropdown.js' */
/**
 * Creates a dropdown list from a JSON obect
 * @module dropdown
 * @author Scott Harwood
 * @requires jQuery > v1.2
 */


AJS.namespace("jira.widget.dropdown");

/**
 * @abstract dropdown
 */
jira.widget.dropdown = function() {

    // private

    var instances = [];

    return {

        // public

        /**
         * Adds this instance to private var <em>instances</em>
         * This reference can be used to access all instances
         * @function {public} addInstance
         */
        addInstance: function() {
            instances.push(this);
        },


        /**
         * Calls the hideList method on all instances of <em>dropdown</em>
         * @function {public} hideInstances
         */
        hideInstances: function() {
            var that = this;
            jQuery(instances).each(function(){
                if (that !== this) {
                    this.hideDropdown();
                }
            });
        },

        
        getHash: function () {
            if (!this.hash) {
                this.hash = {
                    container: this.dropdown,
                    hide: this.hideDropdown,
                    show: this.displayDropdown
                };
            }
            return this.hash;
        },

        /**
         * Calls <em>hideInstances</em> method to hide all other dropdowns.
         * Adds <em>active</em> class to <em>dropdown</em> and styles to make it visible.
         * @function {public} displayDropdown
         */
        displayDropdown: function() {
            if (jira.widget.dropdown.current === this) {
                return;
            }

            this.hideInstances();
            jira.widget.dropdown.current = this;
            this.dropdown.css({display: "block"});

            this.displayed = true;

            var dd = this.dropdown;
            setTimeout(function() {
                // Scroll dropdown into view
                var win = jQuery(window);
                var minScrollTop = dd.offset().top + dd.attr("offsetHeight") - win.height() + 10;

                if (win.scrollTop() < minScrollTop) {
                    jQuery("html,body").animate({scrollTop: minScrollTop}, 300, "linear");
                }
            }, 100);
        },

        /**
         *
         * Removes <em>active</em> class from <em>dropdown</em> and styles to make it hidden.
         * @function {public} hideDropdown
         */
        hideDropdown: function() {
            if (this.displayed === false) {
                return;
            }

            jira.widget.dropdown.current = null;
            this.dropdown.css({display: "none"});

            this.displayed = false;
        },

        /**
         * Initialises instance by, applying primary handler, user options and a Internet Explorer hack.
         * function {public} init
         * @param {HTMLelement} trigger
         * @param {HTMLelement} dropdown
         */
        init: function(trigger, dropdown) {

            var that = this;

            this.addInstance(this);
            this.dropdown = jQuery(dropdown);

            this.dropdown.css({display: "none"});

            // hide dropdown on tab
            jQuery(document).keydown(function(e){
                if(e.keyCode === 9) {
                    that.hideDropdown();
                }
            });

            // this instance is triggered by a method call
            if (trigger.target) {
                jQuery.aop.before(trigger, function(){
                    if (!that.displayed) {
                        that.displayDropdown();
                    }
                });

            // this instance is triggered by a click event
            } else {
                that.dropdown.css("top",jQuery(trigger).outerHeight() + "px");
                trigger.click(function(e){
                    if (!that.displayed) {
                        that.displayDropdown();
                        e.stopPropagation();
                        // lets not follow the link (if it is a link)
                    } else {
                        that.hideDropdown();
                    }
                    e.preventDefault();
                });
            }

            // hide dropdown when click anywhere other than on this instance
            jQuery(document.body).click(function(){
                if (that.displayed) {
                    that.hideDropdown();
                }
            });
        }
    };

}();

/**
 * Standard dropdown constructor 
 * @constucter Standard
 * @param {HTMLelement} trigger
 * @param {HTMLelement} dropdown
 * @return {Object} - instance
 */
jira.widget.dropdown.Standard = function(trigger, dropdown) {

    var that = begetObject(jira.widget.dropdown);
    that.init(trigger, dropdown);

    return that;
};

/**
 * Standard dropdown constructor
 * @constucter Standard
 * @param {HTMLelement} trigger
 * @param {HTMLelement} dropdown
 * @return {Object} - instance
 */
jira.widget.dropdown.Autocomplete = function(trigger, dropdown) {

    var that = begetObject(jira.widget.dropdown);

    that.init = function(trigger, dropdown) {

        this.addInstance(this);
        this.dropdown = jQuery(dropdown).click(function(e){
            // lets not hide dropdown when we click on it
            e.stopPropagation();
        });
        this.dropdown.css({display: "none"});

        // this instance is triggered by a method call
        if (trigger.target) {
            jQuery.aop.before(trigger, function(){
                if (!that.displayed) {
                    that.displayDropdown();
                }
            });

        // this instance is triggered by a click event
        } else {
            trigger.click(function(e){
                if (!that.displayed) {
                    that.displayDropdown();
                    e.stopPropagation();
                }
            });
        }

        // hide dropdown when click anywhere other than on this instance
        jQuery(document.body).click(function(){
            if (that.displayed) {
                that.hideDropdown();
            }
        });
    };

    that.init(trigger, dropdown);

    return that;
};
;
;
/* module-key = 'bamboo.web.resources:bamboojirajs', location = '/scripts/autocomplete-bamboo.js' */
AJS.namespace("BAMBOO.widget.autocomplete");


BAMBOO.widget.autocomplete.Variables = function(options) {

    // prototypial inheritance (http://javascript.crockford.com/prototypal.html)
    var that = begetObject(jira.widget.autocomplete.REST);

    that.getAjaxParams = function(){
        return {
            url: 'rest/api/latest/plan/%PLAN%?expand=variableContext'.replace('%PLAN%', that.planKey),
            data: options.ajaxData,
            dataType: "json",
            type: "GET"
        };
    };

    that.dispatcher = function(val) {
        var that = this,
            selectionRange = that.field.selectionRange(),
            parseValue = val.substring(0, selectionRange.start),
            match = parseValue.match(that.variableRegEx);
    };

    var defaults = {
        minQueryLength: 1,
        variableRegEx: /\$\{([a-z0-9\.]*)$/i
    };

    options = AJS.$.extend(true, defaults, options);
    that.init(options);

    return that;
};

BAMBOO.widget.autocomplete.Variables.init = function(parent) {
    AJS.$(".field-group .autocomplete-variables", parent).each(function() {
        var $item = AJS.$(this);
        var planKey = null;
        if (BAMBOO.currentPlan)
        {
            planKey = BAMBOO.currentPlan.key;
        }
        BAMBOO.widget.autocomplete.Variables({
            field: $item,
            planKey: planKey
        });
    })
};


AJS.$(document).bind("dialogContentReady", function(e, dialog){
    BAMBOO.widget.autocomplete.Variables.init(dialog.get$popupContent());
});

AJS.$(function(){
    BAMBOO.widget.autocomplete.Variables.init();
});
;
;
/* module-key = 'bamboo.web.resources:xsrf', location = '/scripts/xsrf.js' */
AJS.$.ajaxPrefilter(
        function(options, originalOptions, jqXHR) {
            function isMutativeHttpMethod(method) {
                return !(/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }
            if (isMutativeHttpMethod(options.type)) {
                options.crossDomain = false;
                jqXHR.setRequestHeader("X-Atlassian-Token", "no-check");
            }
        });

BAMBOO.XsrfUtils = (function ($) {
    function getXsrfTokenFromCookie() {
        return $.cookie('atl.xsrf.token');
    }

    function addXsrfToken($form) {
        $form.append($("<input>", {type: "hidden", name: "atl_token", value: getXsrfTokenFromCookie()}));
    }

    function postOnLinkClick(event) {
        if (event.isDefaultPrevented()) {
            return;
        }

        var $form = $("<form/>", {method: "post", action: this.href});
        addXsrfToken($form);

        $("body").append($form);

        event.preventDefault();
        $form.submit();
    }

    function isOriginCurrentLocation(url) {
        function isUrlEqual(url1, url2) {
            return (url1 == url2 || url1.slice(0, url2.length + 1) == url2 + '/');
        }

        var
                protocol = document.location.protocol,
                hostPort = document.location.host,
                ssHostPort = '//' + hostPort,
                protocolSsHostPort = protocol + ssHostPort;

        if (!url) {
            return false;
        }

        return isUrlEqual(url, protocolSsHostPort) ||
                isUrlEqual(url, ssHostPort) ||
                !(/^(\/\/|http:|https:).*/.test(url)); //not starting with: // or http: or https:
    }

    function addXsrfTokenToFormIfSameOrigin($form) {
        if (isOriginCurrentLocation($form.attr('action'))) {
            addXsrfToken($form);
        }
    }

    function addXsrfTokenProperty(url, object) {
        if (isOriginCurrentLocation(url)) {
            object.atl_token = getXsrfTokenFromCookie();
        }
        return object;
    }

    function addXsrfTokenToForms() {
        function addXsrfTokenSource($form) {
            $form.append($("<input>", {type: "hidden", name: "atl_token_source", value: 'js'})); //this will cause a warning in DEV mode
        }

        $("form").each(function () {
            var
                    $form = $(this),
                    hasNoAtlToken = !$form.find("input[name='atl_token']").length;

            if (hasNoAtlToken) {
                addXsrfTokenToFormIfSameOrigin($form);
                addXsrfTokenSource($form);
            }
        });
    }

    function getAtlTokenQueryParam(url) {
        if (isOriginCurrentLocation(url)) {
            return "atl_token=" + getXsrfTokenFromCookie();
        }
    }

    function registerLinkClickHandler() {
        $(document).on('click', 'a.mutative:not(.requireConfirmation)', postOnLinkClick);
        $(document).on('clickMutativeLink', 'a', postOnLinkClick);
        $(document).on('click', 'a#log-out', postOnLinkClick);
    }

    return {
        registerLinkClickHandler: registerLinkClickHandler,
        addXsrfTokenProperty: addXsrfTokenProperty,
        addXsrfTokenToForm: addXsrfTokenToFormIfSameOrigin,
        addXsrfTokenToForms: addXsrfTokenToForms,
        getAtlTokenQueryParam: getAtlTokenQueryParam
    }
})(AJS.$);


AJS.$(function() {
    BAMBOO.XsrfUtils.addXsrfTokenToForms();
    BAMBOO.XsrfUtils.registerLinkClickHandler();
});;
;
/* module-key = 'bamboo.web.resources:flot', location = '/bower/jquery-flot/jquery.flot.js' */
/*! Javascript plotting library for jQuery, v. 0.7.
 *
 * Released under the MIT license by IOLA, December 2007.
 *
 */

// first an inline dependency, jquery.colorhelpers.js, we inline it here
// for convenience

/* Plugin for jQuery for working with colors.
 * 
 * Version 1.1.
 * 
 * Inspiration from jQuery color animation plugin by John Resig.
 *
 * Released under the MIT license by Ole Laursen, October 2009.
 *
 * Examples:
 *
 *   $.color.parse("#fff").scale('rgb', 0.25).add('a', -0.5).toString()
 *   var c = $.color.extract($("#mydiv"), 'background-color');
 *   console.log(c.r, c.g, c.b, c.a);
 *   $.color.make(100, 50, 25, 0.4).toString() // returns "rgba(100,50,25,0.4)"
 *
 * Note that .scale() and .add() return the same modified object
 * instead of making a new one.
 *
 * V. 1.1: Fix error handling so e.g. parsing an empty string does
 * produce a color rather than just crashing.
 */ 
(function(B){B.color={};B.color.make=function(F,E,C,D){var G={};G.r=F||0;G.g=E||0;G.b=C||0;G.a=D!=null?D:1;G.add=function(J,I){for(var H=0;H<J.length;++H){G[J.charAt(H)]+=I}return G.normalize()};G.scale=function(J,I){for(var H=0;H<J.length;++H){G[J.charAt(H)]*=I}return G.normalize()};G.toString=function(){if(G.a>=1){return"rgb("+[G.r,G.g,G.b].join(",")+")"}else{return"rgba("+[G.r,G.g,G.b,G.a].join(",")+")"}};G.normalize=function(){function H(J,K,I){return K<J?J:(K>I?I:K)}G.r=H(0,parseInt(G.r),255);G.g=H(0,parseInt(G.g),255);G.b=H(0,parseInt(G.b),255);G.a=H(0,G.a,1);return G};G.clone=function(){return B.color.make(G.r,G.b,G.g,G.a)};return G.normalize()};B.color.extract=function(D,C){var E;do{E=D.css(C).toLowerCase();if(E!=""&&E!="transparent"){break}D=D.parent()}while(!B.nodeName(D.get(0),"body"));if(E=="rgba(0, 0, 0, 0)"){E="transparent"}return B.color.parse(E)};B.color.parse=function(F){var E,C=B.color.make;if(E=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(F)){return C(parseInt(E[1],10),parseInt(E[2],10),parseInt(E[3],10))}if(E=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(F)){return C(parseInt(E[1],10),parseInt(E[2],10),parseInt(E[3],10),parseFloat(E[4]))}if(E=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(F)){return C(parseFloat(E[1])*2.55,parseFloat(E[2])*2.55,parseFloat(E[3])*2.55)}if(E=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(F)){return C(parseFloat(E[1])*2.55,parseFloat(E[2])*2.55,parseFloat(E[3])*2.55,parseFloat(E[4]))}if(E=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(F)){return C(parseInt(E[1],16),parseInt(E[2],16),parseInt(E[3],16))}if(E=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(F)){return C(parseInt(E[1]+E[1],16),parseInt(E[2]+E[2],16),parseInt(E[3]+E[3],16))}var D=B.trim(F).toLowerCase();if(D=="transparent"){return C(255,255,255,0)}else{E=A[D]||[0,0,0];return C(E[0],E[1],E[2])}};var A={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}})(jQuery);

// the actual Flot code
(function($) {
    function Plot(placeholder, data_, options_, plugins) {
        // data is on the form:
        //   [ series1, series2 ... ]
        // where series is either just the data as [ [x1, y1], [x2, y2], ... ]
        // or { data: [ [x1, y1], [x2, y2], ... ], label: "some label", ... }
        
        var series = [],
            options = {
                // the color theme used for graphs
                colors: ["#edc240", "#afd8f8", "#cb4b4b", "#4da74d", "#9440ed"],
                legend: {
                    show: true,
                    noColumns: 1, // number of colums in legend table
                    labelFormatter: null, // fn: string -> string
                    labelBoxBorderColor: "#ccc", // border color for the little label boxes
                    container: null, // container (as jQuery object) to put legend in, null means default on top of graph
                    position: "ne", // position of default legend container within plot
                    margin: 5, // distance from grid edge to default legend container within plot
                    backgroundColor: null, // null means auto-detect
                    backgroundOpacity: 0.85 // set to 0 to avoid background
                },
                xaxis: {
                    show: null, // null = auto-detect, true = always, false = never
                    position: "bottom", // or "top"
                    mode: null, // null or "time"
                    color: null, // base color, labels, ticks
                    tickColor: null, // possibly different color of ticks, e.g. "rgba(0,0,0,0.15)"
                    transform: null, // null or f: number -> number to transform axis
                    inverseTransform: null, // if transform is set, this should be the inverse function
                    min: null, // min. value to show, null means set automatically
                    max: null, // max. value to show, null means set automatically
                    autoscaleMargin: null, // margin in % to add if auto-setting min/max
                    ticks: null, // either [1, 3] or [[1, "a"], 3] or (fn: axis info -> ticks) or app. number of ticks for auto-ticks
                    tickFormatter: null, // fn: number -> string
                    labelWidth: null, // size of tick labels in pixels
                    labelHeight: null,
                    reserveSpace: null, // whether to reserve space even if axis isn't shown
                    tickLength: null, // size in pixels of ticks, or "full" for whole line
                    alignTicksWithAxis: null, // axis number or null for no sync
                    
                    // mode specific options
                    tickDecimals: null, // no. of decimals, null means auto
                    tickSize: null, // number or [number, "unit"]
                    minTickSize: null, // number or [number, "unit"]
                    monthNames: null, // list of names of months
                    timeformat: null, // format string to use
                    twelveHourClock: false // 12 or 24 time in time mode
                },
                yaxis: {
                    autoscaleMargin: 0.02,
                    position: "left" // or "right"
                },
                xaxes: [],
                yaxes: [],
                series: {
                    points: {
                        show: false,
                        radius: 3,
                        lineWidth: 2, // in pixels
                        fill: true,
                        fillColor: "#ffffff",
                        symbol: "circle" // or callback
                    },
                    lines: {
                        // we don't put in show: false so we can see
                        // whether lines were actively disabled 
                        lineWidth: 2, // in pixels
                        fill: false,
                        fillColor: null,
                        steps: false
                    },
                    bars: {
                        show: false,
                        lineWidth: 2, // in pixels
                        barWidth: 1, // in units of the x axis
                        fill: true,
                        fillColor: null,
                        align: "left", // or "center" 
                        horizontal: false
                    },
                    shadowSize: 3
                },
                grid: {
                    show: true,
                    aboveData: false,
                    color: "#545454", // primary color used for outline and labels
                    backgroundColor: null, // null for transparent, else color
                    borderColor: null, // set if different from the grid color
                    tickColor: null, // color for the ticks, e.g. "rgba(0,0,0,0.15)"
                    labelMargin: 5, // in pixels
                    axisMargin: 8, // in pixels
                    borderWidth: 2, // in pixels
                    minBorderMargin: null, // in pixels, null means taken from points radius
                    markings: null, // array of ranges or fn: axes -> array of ranges
                    markingsColor: "#f4f4f4",
                    markingsLineWidth: 2,
                    // interactive stuff
                    clickable: false,
                    hoverable: false,
                    autoHighlight: true, // highlight in case mouse is near
                    mouseActiveRadius: 10 // how far the mouse can be away to activate an item
                },
                hooks: {}
            },
        canvas = null,      // the canvas for the plot itself
        overlay = null,     // canvas for interactive stuff on top of plot
        eventHolder = null, // jQuery object that events should be bound to
        ctx = null, octx = null,
        xaxes = [], yaxes = [],
        plotOffset = { left: 0, right: 0, top: 0, bottom: 0},
        canvasWidth = 0, canvasHeight = 0,
        plotWidth = 0, plotHeight = 0,
        hooks = {
            processOptions: [],
            processRawData: [],
            processDatapoints: [],
            drawSeries: [],
            draw: [],
            bindEvents: [],
            drawOverlay: [],
            shutdown: []
        },
        plot = this;

        // public functions
        plot.setData = setData;
        plot.setupGrid = setupGrid;
        plot.draw = draw;
        plot.getPlaceholder = function() { return placeholder; };
        plot.getCanvas = function() { return canvas; };
        plot.getPlotOffset = function() { return plotOffset; };
        plot.width = function () { return plotWidth; };
        plot.height = function () { return plotHeight; };
        plot.offset = function () {
            var o = eventHolder.offset();
            o.left += plotOffset.left;
            o.top += plotOffset.top;
            return o;
        };
        plot.getData = function () { return series; };
        plot.getAxes = function () {
            var res = {}, i;
            $.each(xaxes.concat(yaxes), function (_, axis) {
                if (axis)
                    res[axis.direction + (axis.n != 1 ? axis.n : "") + "axis"] = axis;
            });
            return res;
        };
        plot.getXAxes = function () { return xaxes; };
        plot.getYAxes = function () { return yaxes; };
        plot.c2p = canvasToAxisCoords;
        plot.p2c = axisToCanvasCoords;
        plot.getOptions = function () { return options; };
        plot.highlight = highlight;
        plot.unhighlight = unhighlight;
        plot.triggerRedrawOverlay = triggerRedrawOverlay;
        plot.pointOffset = function(point) {
            return {
                left: parseInt(xaxes[axisNumber(point, "x") - 1].p2c(+point.x) + plotOffset.left),
                top: parseInt(yaxes[axisNumber(point, "y") - 1].p2c(+point.y) + plotOffset.top)
            };
        };
        plot.shutdown = shutdown;
        plot.resize = function () {
            getCanvasDimensions();
            resizeCanvas(canvas);
            resizeCanvas(overlay);
        };

        // public attributes
        plot.hooks = hooks;
        
        // initialize
        initPlugins(plot);
        parseOptions(options_);
        setupCanvases();
        setData(data_);
        setupGrid();
        draw();
        bindEvents();


        function executeHooks(hook, args) {
            args = [plot].concat(args);
            for (var i = 0; i < hook.length; ++i)
                hook[i].apply(this, args);
        }

        function initPlugins() {
            for (var i = 0; i < plugins.length; ++i) {
                var p = plugins[i];
                p.init(plot);
                if (p.options)
                    $.extend(true, options, p.options);
            }
        }
        
        function parseOptions(opts) {
            var i;
            
            $.extend(true, options, opts);
            
            if (options.xaxis.color == null)
                options.xaxis.color = options.grid.color;
            if (options.yaxis.color == null)
                options.yaxis.color = options.grid.color;
            
            if (options.xaxis.tickColor == null) // backwards-compatibility
                options.xaxis.tickColor = options.grid.tickColor;
            if (options.yaxis.tickColor == null) // backwards-compatibility
                options.yaxis.tickColor = options.grid.tickColor;

            if (options.grid.borderColor == null)
                options.grid.borderColor = options.grid.color;
            if (options.grid.tickColor == null)
                options.grid.tickColor = $.color.parse(options.grid.color).scale('a', 0.22).toString();
            
            // fill in defaults in axes, copy at least always the
            // first as the rest of the code assumes it'll be there
            for (i = 0; i < Math.max(1, options.xaxes.length); ++i)
                options.xaxes[i] = $.extend(true, {}, options.xaxis, options.xaxes[i]);
            for (i = 0; i < Math.max(1, options.yaxes.length); ++i)
                options.yaxes[i] = $.extend(true, {}, options.yaxis, options.yaxes[i]);

            // backwards compatibility, to be removed in future
            if (options.xaxis.noTicks && options.xaxis.ticks == null)
                options.xaxis.ticks = options.xaxis.noTicks;
            if (options.yaxis.noTicks && options.yaxis.ticks == null)
                options.yaxis.ticks = options.yaxis.noTicks;
            if (options.x2axis) {
                options.xaxes[1] = $.extend(true, {}, options.xaxis, options.x2axis);
                options.xaxes[1].position = "top";
            }
            if (options.y2axis) {
                options.yaxes[1] = $.extend(true, {}, options.yaxis, options.y2axis);
                options.yaxes[1].position = "right";
            }
            if (options.grid.coloredAreas)
                options.grid.markings = options.grid.coloredAreas;
            if (options.grid.coloredAreasColor)
                options.grid.markingsColor = options.grid.coloredAreasColor;
            if (options.lines)
                $.extend(true, options.series.lines, options.lines);
            if (options.points)
                $.extend(true, options.series.points, options.points);
            if (options.bars)
                $.extend(true, options.series.bars, options.bars);
            if (options.shadowSize != null)
                options.series.shadowSize = options.shadowSize;

            // save options on axes for future reference
            for (i = 0; i < options.xaxes.length; ++i)
                getOrCreateAxis(xaxes, i + 1).options = options.xaxes[i];
            for (i = 0; i < options.yaxes.length; ++i)
                getOrCreateAxis(yaxes, i + 1).options = options.yaxes[i];

            // add hooks from options
            for (var n in hooks)
                if (options.hooks[n] && options.hooks[n].length)
                    hooks[n] = hooks[n].concat(options.hooks[n]);

            executeHooks(hooks.processOptions, [options]);
        }

        function setData(d) {
            series = parseData(d);
            fillInSeriesOptions();
            processData();
        }
        
        function parseData(d) {
            var res = [];
            for (var i = 0; i < d.length; ++i) {
                var s = $.extend(true, {}, options.series);

                if (d[i].data != null) {
                    s.data = d[i].data; // move the data instead of deep-copy
                    delete d[i].data;

                    $.extend(true, s, d[i]);

                    d[i].data = s.data;
                }
                else
                    s.data = d[i];
                res.push(s);
            }

            return res;
        }
        
        function axisNumber(obj, coord) {
            var a = obj[coord + "axis"];
            if (typeof a == "object") // if we got a real axis, extract number
                a = a.n;
            if (typeof a != "number")
                a = 1; // default to first axis
            return a;
        }

        function allAxes() {
            // return flat array without annoying null entries
            return $.grep(xaxes.concat(yaxes), function (a) { return a; });
        }
        
        function canvasToAxisCoords(pos) {
            // return an object with x/y corresponding to all used axes 
            var res = {}, i, axis;
            for (i = 0; i < xaxes.length; ++i) {
                axis = xaxes[i];
                if (axis && axis.used)
                    res["x" + axis.n] = axis.c2p(pos.left);
            }

            for (i = 0; i < yaxes.length; ++i) {
                axis = yaxes[i];
                if (axis && axis.used)
                    res["y" + axis.n] = axis.c2p(pos.top);
            }
            
            if (res.x1 !== undefined)
                res.x = res.x1;
            if (res.y1 !== undefined)
                res.y = res.y1;

            return res;
        }
        
        function axisToCanvasCoords(pos) {
            // get canvas coords from the first pair of x/y found in pos
            var res = {}, i, axis, key;

            for (i = 0; i < xaxes.length; ++i) {
                axis = xaxes[i];
                if (axis && axis.used) {
                    key = "x" + axis.n;
                    if (pos[key] == null && axis.n == 1)
                        key = "x";

                    if (pos[key] != null) {
                        res.left = axis.p2c(pos[key]);
                        break;
                    }
                }
            }
            
            for (i = 0; i < yaxes.length; ++i) {
                axis = yaxes[i];
                if (axis && axis.used) {
                    key = "y" + axis.n;
                    if (pos[key] == null && axis.n == 1)
                        key = "y";

                    if (pos[key] != null) {
                        res.top = axis.p2c(pos[key]);
                        break;
                    }
                }
            }
            
            return res;
        }
        
        function getOrCreateAxis(axes, number) {
            if (!axes[number - 1])
                axes[number - 1] = {
                    n: number, // save the number for future reference
                    direction: axes == xaxes ? "x" : "y",
                    options: $.extend(true, {}, axes == xaxes ? options.xaxis : options.yaxis)
                };
                
            return axes[number - 1];
        }

        function fillInSeriesOptions() {
            var i;
            
            // collect what we already got of colors
            var neededColors = series.length,
                usedColors = [],
                assignedColors = [];
            for (i = 0; i < series.length; ++i) {
                var sc = series[i].color;
                if (sc != null) {
                    --neededColors;
                    if (typeof sc == "number")
                        assignedColors.push(sc);
                    else
                        usedColors.push($.color.parse(series[i].color));
                }
            }
            
            // we might need to generate more colors if higher indices
            // are assigned
            for (i = 0; i < assignedColors.length; ++i) {
                neededColors = Math.max(neededColors, assignedColors[i] + 1);
            }

            // produce colors as needed
            var colors = [], variation = 0;
            i = 0;
            while (colors.length < neededColors) {
                var c;
                if (options.colors.length == i) // check degenerate case
                    c = $.color.make(100, 100, 100);
                else
                    c = $.color.parse(options.colors[i]);

                // vary color if needed
                var sign = variation % 2 == 1 ? -1 : 1;
                c.scale('rgb', 1 + sign * Math.ceil(variation / 2) * 0.2)

                // FIXME: if we're getting to close to something else,
                // we should probably skip this one
                colors.push(c);
                
                ++i;
                if (i >= options.colors.length) {
                    i = 0;
                    ++variation;
                }
            }

            // fill in the options
            var colori = 0, s;
            for (i = 0; i < series.length; ++i) {
                s = series[i];
                
                // assign colors
                if (s.color == null) {
                    s.color = colors[colori].toString();
                    ++colori;
                }
                else if (typeof s.color == "number")
                    s.color = colors[s.color].toString();

                // turn on lines automatically in case nothing is set
                if (s.lines.show == null) {
                    var v, show = true;
                    for (v in s)
                        if (s[v] && s[v].show) {
                            show = false;
                            break;
                        }
                    if (show)
                        s.lines.show = true;
                }

                // setup axes
                s.xaxis = getOrCreateAxis(xaxes, axisNumber(s, "x"));
                s.yaxis = getOrCreateAxis(yaxes, axisNumber(s, "y"));
            }
        }
        
        function processData() {
            var topSentry = Number.POSITIVE_INFINITY,
                bottomSentry = Number.NEGATIVE_INFINITY,
                fakeInfinity = Number.MAX_VALUE,
                i, j, k, m, length,
                s, points, ps, x, y, axis, val, f, p;

            function updateAxis(axis, min, max) {
                if (min < axis.datamin && min != -fakeInfinity)
                    axis.datamin = min;
                if (max > axis.datamax && max != fakeInfinity)
                    axis.datamax = max;
            }

            $.each(allAxes(), function (_, axis) {
                // init axis
                axis.datamin = topSentry;
                axis.datamax = bottomSentry;
                axis.used = false;
            });
            
            for (i = 0; i < series.length; ++i) {
                s = series[i];
                s.datapoints = { points: [] };
                
                executeHooks(hooks.processRawData, [ s, s.data, s.datapoints ]);
            }
            
            // first pass: clean and copy data
            for (i = 0; i < series.length; ++i) {
                s = series[i];

                var data = s.data, format = s.datapoints.format;

                if (!format) {
                    format = [];
                    // find out how to copy
                    format.push({ x: true, number: true, required: true });
                    format.push({ y: true, number: true, required: true });

                    if (s.bars.show || (s.lines.show && s.lines.fill)) {
                        format.push({ y: true, number: true, required: false, defaultValue: 0 });
                        if (s.bars.horizontal) {
                            delete format[format.length - 1].y;
                            format[format.length - 1].x = true;
                        }
                    }
                    
                    s.datapoints.format = format;
                }

                if (s.datapoints.pointsize != null)
                    continue; // already filled in

                s.datapoints.pointsize = format.length;
                
                ps = s.datapoints.pointsize;
                points = s.datapoints.points;

                insertSteps = s.lines.show && s.lines.steps;
                s.xaxis.used = s.yaxis.used = true;
                
                for (j = k = 0; j < data.length; ++j, k += ps) {
                    p = data[j];

                    var nullify = p == null;
                    if (!nullify) {
                        for (m = 0; m < ps; ++m) {
                            val = p[m];
                            f = format[m];

                            if (f) {
                                if (f.number && val != null) {
                                    val = +val; // convert to number
                                    if (isNaN(val))
                                        val = null;
                                    else if (val == Infinity)
                                        val = fakeInfinity;
                                    else if (val == -Infinity)
                                        val = -fakeInfinity;
                                }

                                if (val == null) {
                                    if (f.required)
                                        nullify = true;
                                    
                                    if (f.defaultValue != null)
                                        val = f.defaultValue;
                                }
                            }
                            
                            points[k + m] = val;
                        }
                    }
                    
                    if (nullify) {
                        for (m = 0; m < ps; ++m) {
                            val = points[k + m];
                            if (val != null) {
                                f = format[m];
                                // extract min/max info
                                if (f.x)
                                    updateAxis(s.xaxis, val, val);
                                if (f.y)
                                    updateAxis(s.yaxis, val, val);
                            }
                            points[k + m] = null;
                        }
                    }
                    else {
                        // a little bit of line specific stuff that
                        // perhaps shouldn't be here, but lacking
                        // better means...
                        if (insertSteps && k > 0
                            && points[k - ps] != null
                            && points[k - ps] != points[k]
                            && points[k - ps + 1] != points[k + 1]) {
                            // copy the point to make room for a middle point
                            for (m = 0; m < ps; ++m)
                                points[k + ps + m] = points[k + m];

                            // middle point has same y
                            points[k + 1] = points[k - ps + 1];

                            // we've added a point, better reflect that
                            k += ps;
                        }
                    }
                }
            }

            // give the hooks a chance to run
            for (i = 0; i < series.length; ++i) {
                s = series[i];
                
                executeHooks(hooks.processDatapoints, [ s, s.datapoints]);
            }

            // second pass: find datamax/datamin for auto-scaling
            for (i = 0; i < series.length; ++i) {
                s = series[i];
                points = s.datapoints.points,
                ps = s.datapoints.pointsize;

                var xmin = topSentry, ymin = topSentry,
                    xmax = bottomSentry, ymax = bottomSentry;
                
                for (j = 0; j < points.length; j += ps) {
                    if (points[j] == null)
                        continue;

                    for (m = 0; m < ps; ++m) {
                        val = points[j + m];
                        f = format[m];
                        if (!f || val == fakeInfinity || val == -fakeInfinity)
                            continue;
                        
                        if (f.x) {
                            if (val < xmin)
                                xmin = val;
                            if (val > xmax)
                                xmax = val;
                        }
                        if (f.y) {
                            if (val < ymin)
                                ymin = val;
                            if (val > ymax)
                                ymax = val;
                        }
                    }
                }
                
                if (s.bars.show) {
                    // make sure we got room for the bar on the dancing floor
                    var delta = s.bars.align == "left" ? 0 : -s.bars.barWidth/2;
                    if (s.bars.horizontal) {
                        ymin += delta;
                        ymax += delta + s.bars.barWidth;
                    }
                    else {
                        xmin += delta;
                        xmax += delta + s.bars.barWidth;
                    }
                }
                
                updateAxis(s.xaxis, xmin, xmax);
                updateAxis(s.yaxis, ymin, ymax);
            }

            $.each(allAxes(), function (_, axis) {
                if (axis.datamin == topSentry)
                    axis.datamin = null;
                if (axis.datamax == bottomSentry)
                    axis.datamax = null;
            });
        }

        function makeCanvas(skipPositioning, cls) {
            var c = document.createElement('canvas');
            c.className = cls;
            c.width = canvasWidth;
            c.height = canvasHeight;
                    
            if (!skipPositioning)
                $(c).css({ position: 'absolute', left: 0, top: 0 });
                
            $(c).appendTo(placeholder);
                
            if (!c.getContext) // excanvas hack
                c = window.G_vmlCanvasManager.initElement(c);

            // used for resetting in case we get replotted
            c.getContext("2d").save();
            
            return c;
        }

        function getCanvasDimensions() {
            canvasWidth = placeholder.width();
            canvasHeight = placeholder.height();
            
            if (canvasWidth <= 0 || canvasHeight <= 0)
                throw "Invalid dimensions for plot, width = " + canvasWidth + ", height = " + canvasHeight;
        }

        function resizeCanvas(c) {
            // resizing should reset the state (excanvas seems to be
            // buggy though)
            if (c.width != canvasWidth)
                c.width = canvasWidth;

            if (c.height != canvasHeight)
                c.height = canvasHeight;

            // so try to get back to the initial state (even if it's
            // gone now, this should be safe according to the spec)
            var cctx = c.getContext("2d");
            cctx.restore();

            // and save again
            cctx.save();
        }
        
        function setupCanvases() {
            var reused,
                existingCanvas = placeholder.children("canvas.base"),
                existingOverlay = placeholder.children("canvas.overlay");

            if (existingCanvas.length == 0 || existingOverlay == 0) {
                // init everything
                
                placeholder.html(""); // make sure placeholder is clear
            
                placeholder.css({ padding: 0 }); // padding messes up the positioning
                
                if (placeholder.css("position") == 'static')
                    placeholder.css("position", "relative"); // for positioning labels and overlay

                getCanvasDimensions();
                
                canvas = makeCanvas(true, "base");
                overlay = makeCanvas(false, "overlay"); // overlay canvas for interactive features

                reused = false;
            }
            else {
                // reuse existing elements

                canvas = existingCanvas.get(0);
                overlay = existingOverlay.get(0);

                reused = true;
            }

            ctx = canvas.getContext("2d");
            octx = overlay.getContext("2d");

            // we include the canvas in the event holder too, because IE 7
            // sometimes has trouble with the stacking order
            eventHolder = $([overlay, canvas]);

            if (reused) {
                // run shutdown in the old plot object
                placeholder.data("plot").shutdown();

                // reset reused canvases
                plot.resize();
                
                // make sure overlay pixels are cleared (canvas is cleared when we redraw)
                octx.clearRect(0, 0, canvasWidth, canvasHeight);
                
                // then whack any remaining obvious garbage left
                eventHolder.unbind();
                placeholder.children().not([canvas, overlay]).remove();
            }

            // save in case we get replotted
            placeholder.data("plot", plot);
        }

        function bindEvents() {
            // bind events
            if (options.grid.hoverable) {
                eventHolder.mousemove(onMouseMove);
                eventHolder.mouseleave(onMouseLeave);
            }

            if (options.grid.clickable)
                eventHolder.click(onClick);

            executeHooks(hooks.bindEvents, [eventHolder]);
        }

        function shutdown() {
            if (redrawTimeout)
                clearTimeout(redrawTimeout);
            
            eventHolder.unbind("mousemove", onMouseMove);
            eventHolder.unbind("mouseleave", onMouseLeave);
            eventHolder.unbind("click", onClick);
            
            executeHooks(hooks.shutdown, [eventHolder]);
        }

        function setTransformationHelpers(axis) {
            // set helper functions on the axis, assumes plot area
            // has been computed already
            
            function identity(x) { return x; }
            
            var s, m, t = axis.options.transform || identity,
                it = axis.options.inverseTransform;
            
            // precompute how much the axis is scaling a point
            // in canvas space
            if (axis.direction == "x") {
                s = axis.scale = plotWidth / Math.abs(t(axis.max) - t(axis.min));
                m = Math.min(t(axis.max), t(axis.min));
            }
            else {
                s = axis.scale = plotHeight / Math.abs(t(axis.max) - t(axis.min));
                s = -s;
                m = Math.max(t(axis.max), t(axis.min));
            }

            // data point to canvas coordinate
            if (t == identity) // slight optimization
                axis.p2c = function (p) { return (p - m) * s; };
            else
                axis.p2c = function (p) { return (t(p) - m) * s; };
            // canvas coordinate to data point
            if (!it)
                axis.c2p = function (c) { return m + c / s; };
            else
                axis.c2p = function (c) { return it(m + c / s); };
        }

        function measureTickLabels(axis) {
            var opts = axis.options, i, ticks = axis.ticks || [], labels = [],
                l, w = opts.labelWidth, h = opts.labelHeight, dummyDiv;

            function makeDummyDiv(labels, width) {
                return $('<div style="position:absolute;top:-10000px;' + width + 'font-size:smaller">' +
                         '<div class="' + axis.direction + 'Axis ' + axis.direction + axis.n + 'Axis">'
                         + labels.join("") + '</div></div>')
                    .appendTo(placeholder);
            }
            
            if (axis.direction == "x") {
                // to avoid measuring the widths of the labels (it's slow), we
                // construct fixed-size boxes and put the labels inside
                // them, we don't need the exact figures and the
                // fixed-size box content is easy to center
                if (w == null)
                    w = Math.floor(canvasWidth / (ticks.length > 0 ? ticks.length : 1));

                // measure x label heights
                if (h == null) {
                    labels = [];
                    for (i = 0; i < ticks.length; ++i) {
                        l = ticks[i].label;
                        if (l)
                            labels.push('<div class="tickLabel" style="float:left;width:' + w + 'px">' + l + '</div>');
                    }

                    if (labels.length > 0) {
                        // stick them all in the same div and measure
                        // collective height
                        labels.push('<div style="clear:left"></div>');
                        dummyDiv = makeDummyDiv(labels, "width:10000px;");
                        h = dummyDiv.height();
                        dummyDiv.remove();
                    }
                }
            }
            else if (w == null || h == null) {
                // calculate y label dimensions
                for (i = 0; i < ticks.length; ++i) {
                    l = ticks[i].label;
                    if (l)
                        labels.push('<div class="tickLabel">' + l + '</div>');
                }
                
                if (labels.length > 0) {
                    dummyDiv = makeDummyDiv(labels, "");
                    if (w == null)
                        w = dummyDiv.children().width();
                    if (h == null)
                        h = dummyDiv.find("div.tickLabel").height();
                    dummyDiv.remove();
                }
            }

            if (w == null)
                w = 0;
            if (h == null)
                h = 0;

            axis.labelWidth = w;
            axis.labelHeight = h;
        }

        function allocateAxisBoxFirstPhase(axis) {
            // find the bounding box of the axis by looking at label
            // widths/heights and ticks, make room by diminishing the
            // plotOffset

            var lw = axis.labelWidth,
                lh = axis.labelHeight,
                pos = axis.options.position,
                tickLength = axis.options.tickLength,
                axismargin = options.grid.axisMargin,
                padding = options.grid.labelMargin,
                all = axis.direction == "x" ? xaxes : yaxes,
                index;

            // determine axis margin
            var samePosition = $.grep(all, function (a) {
                return a && a.options.position == pos && a.reserveSpace;
            });
            if ($.inArray(axis, samePosition) == samePosition.length - 1)
                axismargin = 0; // outermost

            // determine tick length - if we're innermost, we can use "full"
            if (tickLength == null)
                tickLength = "full";

            var sameDirection = $.grep(all, function (a) {
                return a && a.reserveSpace;
            });

            var innermost = $.inArray(axis, sameDirection) == 0;
            if (!innermost && tickLength == "full")
                tickLength = 5;
                
            if (!isNaN(+tickLength))
                padding += +tickLength;

            // compute box
            if (axis.direction == "x") {
                lh += padding;
                
                if (pos == "bottom") {
                    plotOffset.bottom += lh + axismargin;
                    axis.box = { top: canvasHeight - plotOffset.bottom, height: lh };
                }
                else {
                    axis.box = { top: plotOffset.top + axismargin, height: lh };
                    plotOffset.top += lh + axismargin;
                }
            }
            else {
                lw += padding;
                
                if (pos == "left") {
                    axis.box = { left: plotOffset.left + axismargin, width: lw };
                    plotOffset.left += lw + axismargin;
                }
                else {
                    plotOffset.right += lw + axismargin;
                    axis.box = { left: canvasWidth - plotOffset.right, width: lw };
                }
            }

             // save for future reference
            axis.position = pos;
            axis.tickLength = tickLength;
            axis.box.padding = padding;
            axis.innermost = innermost;
        }

        function allocateAxisBoxSecondPhase(axis) {
            // set remaining bounding box coordinates
            if (axis.direction == "x") {
                axis.box.left = plotOffset.left;
                axis.box.width = plotWidth;
            }
            else {
                axis.box.top = plotOffset.top;
                axis.box.height = plotHeight;
            }
        }
        
        function setupGrid() {
            var i, axes = allAxes();

            // first calculate the plot and axis box dimensions

            $.each(axes, function (_, axis) {
                axis.show = axis.options.show;
                if (axis.show == null)
                    axis.show = axis.used; // by default an axis is visible if it's got data
                
                axis.reserveSpace = axis.show || axis.options.reserveSpace;

                setRange(axis);
            });

            allocatedAxes = $.grep(axes, function (axis) { return axis.reserveSpace; });

            plotOffset.left = plotOffset.right = plotOffset.top = plotOffset.bottom = 0;
            if (options.grid.show) {
                $.each(allocatedAxes, function (_, axis) {
                    // make the ticks
                    setupTickGeneration(axis);
                    setTicks(axis);
                    snapRangeToTicks(axis, axis.ticks);

                    // find labelWidth/Height for axis
                    measureTickLabels(axis);
                });

                // with all dimensions in house, we can compute the
                // axis boxes, start from the outside (reverse order)
                for (i = allocatedAxes.length - 1; i >= 0; --i)
                    allocateAxisBoxFirstPhase(allocatedAxes[i]);

                // make sure we've got enough space for things that
                // might stick out
                var minMargin = options.grid.minBorderMargin;
                if (minMargin == null) {
                    minMargin = 0;
                    for (i = 0; i < series.length; ++i)
                        minMargin = Math.max(minMargin, series[i].points.radius + series[i].points.lineWidth/2);
                }
                    
                for (var a in plotOffset) {
                    plotOffset[a] += options.grid.borderWidth;
                    plotOffset[a] = Math.max(minMargin, plotOffset[a]);
                }
            }
            
            plotWidth = canvasWidth - plotOffset.left - plotOffset.right;
            plotHeight = canvasHeight - plotOffset.bottom - plotOffset.top;

            // now we got the proper plotWidth/Height, we can compute the scaling
            $.each(axes, function (_, axis) {
                setTransformationHelpers(axis);
            });

            if (options.grid.show) {
                $.each(allocatedAxes, function (_, axis) {
                    allocateAxisBoxSecondPhase(axis);
                });

                insertAxisLabels();
            }
            
            insertLegend();
        }
        
        function setRange(axis) {
            var opts = axis.options,
                min = +(opts.min != null ? opts.min : axis.datamin),
                max = +(opts.max != null ? opts.max : axis.datamax),
                delta = max - min;

            if (delta == 0.0) {
                // degenerate case
                var widen = max == 0 ? 1 : 0.01;

                if (opts.min == null)
                    min -= widen;
                // always widen max if we couldn't widen min to ensure we
                // don't fall into min == max which doesn't work
                if (opts.max == null || opts.min != null)
                    max += widen;
            }
            else {
                // consider autoscaling
                var margin = opts.autoscaleMargin;
                if (margin != null) {
                    if (opts.min == null) {
                        min -= delta * margin;
                        // make sure we don't go below zero if all values
                        // are positive
                        if (min < 0 && axis.datamin != null && axis.datamin >= 0)
                            min = 0;
                    }
                    if (opts.max == null) {
                        max += delta * margin;
                        if (max > 0 && axis.datamax != null && axis.datamax <= 0)
                            max = 0;
                    }
                }
            }
            axis.min = min;
            axis.max = max;
        }

        function setupTickGeneration(axis) {
            var opts = axis.options;
                
            // estimate number of ticks
            var noTicks;
            if (typeof opts.ticks == "number" && opts.ticks > 0)
                noTicks = opts.ticks;
            else
                // heuristic based on the model a*sqrt(x) fitted to
                // some data points that seemed reasonable
                noTicks = 0.3 * Math.sqrt(axis.direction == "x" ? canvasWidth : canvasHeight);

            var delta = (axis.max - axis.min) / noTicks,
                size, generator, unit, formatter, i, magn, norm;

            if (opts.mode == "time") {
                // pretty handling of time
                
                // map of app. size of time units in milliseconds
                var timeUnitSize = {
                    "second": 1000,
                    "minute": 60 * 1000,
                    "hour": 60 * 60 * 1000,
                    "day": 24 * 60 * 60 * 1000,
                    "month": 30 * 24 * 60 * 60 * 1000,
                    "year": 365.2425 * 24 * 60 * 60 * 1000
                };


                // the allowed tick sizes, after 1 year we use
                // an integer algorithm
                var spec = [
                    [1, "second"], [2, "second"], [5, "second"], [10, "second"],
                    [30, "second"], 
                    [1, "minute"], [2, "minute"], [5, "minute"], [10, "minute"],
                    [30, "minute"], 
                    [1, "hour"], [2, "hour"], [4, "hour"],
                    [8, "hour"], [12, "hour"],
                    [1, "day"], [2, "day"], [3, "day"],
                    [0.25, "month"], [0.5, "month"], [1, "month"],
                    [2, "month"], [3, "month"], [6, "month"],
                    [1, "year"]
                ];

                var minSize = 0;
                if (opts.minTickSize != null) {
                    if (typeof opts.tickSize == "number")
                        minSize = opts.tickSize;
                    else
                        minSize = opts.minTickSize[0] * timeUnitSize[opts.minTickSize[1]];
                }

                for (var i = 0; i < spec.length - 1; ++i)
                    if (delta < (spec[i][0] * timeUnitSize[spec[i][1]]
                                 + spec[i + 1][0] * timeUnitSize[spec[i + 1][1]]) / 2
                       && spec[i][0] * timeUnitSize[spec[i][1]] >= minSize)
                        break;
                size = spec[i][0];
                unit = spec[i][1];
                
                // special-case the possibility of several years
                if (unit == "year") {
                    magn = Math.pow(10, Math.floor(Math.log(delta / timeUnitSize.year) / Math.LN10));
                    norm = (delta / timeUnitSize.year) / magn;
                    if (norm < 1.5)
                        size = 1;
                    else if (norm < 3)
                        size = 2;
                    else if (norm < 7.5)
                        size = 5;
                    else
                        size = 10;

                    size *= magn;
                }

                axis.tickSize = opts.tickSize || [size, unit];
                
                generator = function(axis) {
                    var ticks = [],
                        tickSize = axis.tickSize[0], unit = axis.tickSize[1],
                        d = new Date(axis.min);
                    
                    var step = tickSize * timeUnitSize[unit];

                    if (unit == "second")
                        d.setUTCSeconds(floorInBase(d.getUTCSeconds(), tickSize));
                    if (unit == "minute")
                        d.setUTCMinutes(floorInBase(d.getUTCMinutes(), tickSize));
                    if (unit == "hour")
                        d.setUTCHours(floorInBase(d.getUTCHours(), tickSize));
                    if (unit == "month")
                        d.setUTCMonth(floorInBase(d.getUTCMonth(), tickSize));
                    if (unit == "year")
                        d.setUTCFullYear(floorInBase(d.getUTCFullYear(), tickSize));
                    
                    // reset smaller components
                    d.setUTCMilliseconds(0);
                    if (step >= timeUnitSize.minute)
                        d.setUTCSeconds(0);
                    if (step >= timeUnitSize.hour)
                        d.setUTCMinutes(0);
                    if (step >= timeUnitSize.day)
                        d.setUTCHours(0);
                    if (step >= timeUnitSize.day * 4)
                        d.setUTCDate(1);
                    if (step >= timeUnitSize.year)
                        d.setUTCMonth(0);


                    var carry = 0, v = Number.NaN, prev;
                    do {
                        prev = v;
                        v = d.getTime();
                        ticks.push(v);
                        if (unit == "month") {
                            if (tickSize < 1) {
                                // a bit complicated - we'll divide the month
                                // up but we need to take care of fractions
                                // so we don't end up in the middle of a day
                                d.setUTCDate(1);
                                var start = d.getTime();
                                d.setUTCMonth(d.getUTCMonth() + 1);
                                var end = d.getTime();
                                d.setTime(v + carry * timeUnitSize.hour + (end - start) * tickSize);
                                carry = d.getUTCHours();
                                d.setUTCHours(0);
                            }
                            else
                                d.setUTCMonth(d.getUTCMonth() + tickSize);
                        }
                        else if (unit == "year") {
                            d.setUTCFullYear(d.getUTCFullYear() + tickSize);
                        }
                        else
                            d.setTime(v + step);
                    } while (v < axis.max && v != prev);

                    return ticks;
                };

                formatter = function (v, axis) {
                    var d = new Date(v);

                    // first check global format
                    if (opts.timeformat != null)
                        return $.plot.formatDate(d, opts.timeformat, opts.monthNames);
                    
                    var t = axis.tickSize[0] * timeUnitSize[axis.tickSize[1]];
                    var span = axis.max - axis.min;
                    var suffix = (opts.twelveHourClock) ? " %p" : "";
                    
                    if (t < timeUnitSize.minute)
                        fmt = "%h:%M:%S" + suffix;
                    else if (t < timeUnitSize.day) {
                        if (span < 2 * timeUnitSize.day)
                            fmt = "%h:%M" + suffix;
                        else
                            fmt = "%b %d %h:%M" + suffix;
                    }
                    else if (t < timeUnitSize.month)
                        fmt = "%b %d";
                    else if (t < timeUnitSize.year) {
                        if (span < timeUnitSize.year)
                            fmt = "%b";
                        else
                            fmt = "%b %y";
                    }
                    else
                        fmt = "%y";
                    
                    return $.plot.formatDate(d, fmt, opts.monthNames);
                };
            }
            else {
                // pretty rounding of base-10 numbers
                var maxDec = opts.tickDecimals;
                var dec = -Math.floor(Math.log(delta) / Math.LN10);
                if (maxDec != null && dec > maxDec)
                    dec = maxDec;

                magn = Math.pow(10, -dec);
                norm = delta / magn; // norm is between 1.0 and 10.0
                
                if (norm < 1.5)
                    size = 1;
                else if (norm < 3) {
                    size = 2;
                    // special case for 2.5, requires an extra decimal
                    if (norm > 2.25 && (maxDec == null || dec + 1 <= maxDec)) {
                        size = 2.5;
                        ++dec;
                    }
                }
                else if (norm < 7.5)
                    size = 5;
                else
                    size = 10;

                size *= magn;
                
                if (opts.minTickSize != null && size < opts.minTickSize)
                    size = opts.minTickSize;

                axis.tickDecimals = Math.max(0, maxDec != null ? maxDec : dec);
                axis.tickSize = opts.tickSize || size;

                generator = function (axis) {
                    var ticks = [];

                    // spew out all possible ticks
                    var start = floorInBase(axis.min, axis.tickSize),
                        i = 0, v = Number.NaN, prev;
                    do {
                        prev = v;
                        v = start + i * axis.tickSize;
                        ticks.push(v);
                        ++i;
                    } while (v < axis.max && v != prev);
                    return ticks;
                };

                formatter = function (v, axis) {
                    return v.toFixed(axis.tickDecimals);
                };
            }

            if (opts.alignTicksWithAxis != null) {
                var otherAxis = (axis.direction == "x" ? xaxes : yaxes)[opts.alignTicksWithAxis - 1];
                if (otherAxis && otherAxis.used && otherAxis != axis) {
                    // consider snapping min/max to outermost nice ticks
                    var niceTicks = generator(axis);
                    if (niceTicks.length > 0) {
                        if (opts.min == null)
                            axis.min = Math.min(axis.min, niceTicks[0]);
                        if (opts.max == null && niceTicks.length > 1)
                            axis.max = Math.max(axis.max, niceTicks[niceTicks.length - 1]);
                    }
                    
                    generator = function (axis) {
                        // copy ticks, scaled to this axis
                        var ticks = [], v, i;
                        for (i = 0; i < otherAxis.ticks.length; ++i) {
                            v = (otherAxis.ticks[i].v - otherAxis.min) / (otherAxis.max - otherAxis.min);
                            v = axis.min + v * (axis.max - axis.min);
                            ticks.push(v);
                        }
                        return ticks;
                    };
                    
                    // we might need an extra decimal since forced
                    // ticks don't necessarily fit naturally
                    if (axis.mode != "time" && opts.tickDecimals == null) {
                        var extraDec = Math.max(0, -Math.floor(Math.log(delta) / Math.LN10) + 1),
                            ts = generator(axis);

                        // only proceed if the tick interval rounded
                        // with an extra decimal doesn't give us a
                        // zero at end
                        if (!(ts.length > 1 && /\..*0$/.test((ts[1] - ts[0]).toFixed(extraDec))))
                            axis.tickDecimals = extraDec;
                    }
                }
            }

            axis.tickGenerator = generator;
            if ($.isFunction(opts.tickFormatter))
                axis.tickFormatter = function (v, axis) { return "" + opts.tickFormatter(v, axis); };
            else
                axis.tickFormatter = formatter;
        }
        
        function setTicks(axis) {
            var oticks = axis.options.ticks, ticks = [];
            if (oticks == null || (typeof oticks == "number" && oticks > 0))
                ticks = axis.tickGenerator(axis);
            else if (oticks) {
                if ($.isFunction(oticks))
                    // generate the ticks
                    ticks = oticks({ min: axis.min, max: axis.max });
                else
                    ticks = oticks;
            }

            // clean up/labelify the supplied ticks, copy them over
            var i, v;
            axis.ticks = [];
            for (i = 0; i < ticks.length; ++i) {
                var label = null;
                var t = ticks[i];
                if (typeof t == "object") {
                    v = +t[0];
                    if (t.length > 1)
                        label = t[1];
                }
                else
                    v = +t;
                if (label == null)
                    label = axis.tickFormatter(v, axis);
                if (!isNaN(v))
                    axis.ticks.push({ v: v, label: label });
            }
        }

        function snapRangeToTicks(axis, ticks) {
            if (axis.options.autoscaleMargin && ticks.length > 0) {
                // snap to ticks
                if (axis.options.min == null)
                    axis.min = Math.min(axis.min, ticks[0].v);
                if (axis.options.max == null && ticks.length > 1)
                    axis.max = Math.max(axis.max, ticks[ticks.length - 1].v);
            }
        }
      
        function draw() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            var grid = options.grid;

            // draw background, if any
            if (grid.show && grid.backgroundColor)
                drawBackground();
            
            if (grid.show && !grid.aboveData)
                drawGrid();

            for (var i = 0; i < series.length; ++i) {
                executeHooks(hooks.drawSeries, [ctx, series[i]]);
                drawSeries(series[i]);
            }

            executeHooks(hooks.draw, [ctx]);
            
            if (grid.show && grid.aboveData)
                drawGrid();
        }

        function extractRange(ranges, coord) {
            var axis, from, to, key, axes = allAxes();

            for (i = 0; i < axes.length; ++i) {
                axis = axes[i];
                if (axis.direction == coord) {
                    key = coord + axis.n + "axis";
                    if (!ranges[key] && axis.n == 1)
                        key = coord + "axis"; // support x1axis as xaxis
                    if (ranges[key]) {
                        from = ranges[key].from;
                        to = ranges[key].to;
                        break;
                    }
                }
            }

            // backwards-compat stuff - to be removed in future
            if (!ranges[key]) {
                axis = coord == "x" ? xaxes[0] : yaxes[0];
                from = ranges[coord + "1"];
                to = ranges[coord + "2"];
            }

            // auto-reverse as an added bonus
            if (from != null && to != null && from > to) {
                var tmp = from;
                from = to;
                to = tmp;
            }
            
            return { from: from, to: to, axis: axis };
        }
        
        function drawBackground() {
            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);

            ctx.fillStyle = getColorOrGradient(options.grid.backgroundColor, plotHeight, 0, "rgba(255, 255, 255, 0)");
            ctx.fillRect(0, 0, plotWidth, plotHeight);
            ctx.restore();
        }

        function drawGrid() {
            var i;
            
            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);

            // draw markings
            var markings = options.grid.markings;
            if (markings) {
                if ($.isFunction(markings)) {
                    var axes = plot.getAxes();
                    // xmin etc. is backwards compatibility, to be
                    // removed in the future
                    axes.xmin = axes.xaxis.min;
                    axes.xmax = axes.xaxis.max;
                    axes.ymin = axes.yaxis.min;
                    axes.ymax = axes.yaxis.max;
                    
                    markings = markings(axes);
                }

                for (i = 0; i < markings.length; ++i) {
                    var m = markings[i],
                        xrange = extractRange(m, "x"),
                        yrange = extractRange(m, "y");

                    // fill in missing
                    if (xrange.from == null)
                        xrange.from = xrange.axis.min;
                    if (xrange.to == null)
                        xrange.to = xrange.axis.max;
                    if (yrange.from == null)
                        yrange.from = yrange.axis.min;
                    if (yrange.to == null)
                        yrange.to = yrange.axis.max;

                    // clip
                    if (xrange.to < xrange.axis.min || xrange.from > xrange.axis.max ||
                        yrange.to < yrange.axis.min || yrange.from > yrange.axis.max)
                        continue;

                    xrange.from = Math.max(xrange.from, xrange.axis.min);
                    xrange.to = Math.min(xrange.to, xrange.axis.max);
                    yrange.from = Math.max(yrange.from, yrange.axis.min);
                    yrange.to = Math.min(yrange.to, yrange.axis.max);

                    if (xrange.from == xrange.to && yrange.from == yrange.to)
                        continue;

                    // then draw
                    xrange.from = xrange.axis.p2c(xrange.from);
                    xrange.to = xrange.axis.p2c(xrange.to);
                    yrange.from = yrange.axis.p2c(yrange.from);
                    yrange.to = yrange.axis.p2c(yrange.to);
                    
                    if (xrange.from == xrange.to || yrange.from == yrange.to) {
                        // draw line
                        ctx.beginPath();
                        ctx.strokeStyle = m.color || options.grid.markingsColor;
                        ctx.lineWidth = m.lineWidth || options.grid.markingsLineWidth;
                        ctx.moveTo(xrange.from, yrange.from);
                        ctx.lineTo(xrange.to, yrange.to);
                        ctx.stroke();
                    }
                    else {
                        // fill area
                        ctx.fillStyle = m.color || options.grid.markingsColor;
                        ctx.fillRect(xrange.from, yrange.to,
                                     xrange.to - xrange.from,
                                     yrange.from - yrange.to);
                    }
                }
            }
            
            // draw the ticks
            var axes = allAxes(), bw = options.grid.borderWidth;

            for (var j = 0; j < axes.length; ++j) {
                var axis = axes[j], box = axis.box,
                    t = axis.tickLength, x, y, xoff, yoff;
                if (!axis.show || axis.ticks.length == 0)
                    continue
                
                ctx.strokeStyle = axis.options.tickColor || $.color.parse(axis.options.color).scale('a', 0.22).toString();
                ctx.lineWidth = 1;

                // find the edges
                if (axis.direction == "x") {
                    x = 0;
                    if (t == "full")
                        y = (axis.position == "top" ? 0 : plotHeight);
                    else
                        y = box.top - plotOffset.top + (axis.position == "top" ? box.height : 0);
                }
                else {
                    y = 0;
                    if (t == "full")
                        x = (axis.position == "left" ? 0 : plotWidth);
                    else
                        x = box.left - plotOffset.left + (axis.position == "left" ? box.width : 0);
                }
                
                // draw tick bar
                if (!axis.innermost) {
                    ctx.beginPath();
                    xoff = yoff = 0;
                    if (axis.direction == "x")
                        xoff = plotWidth;
                    else
                        yoff = plotHeight;
                    
                    if (ctx.lineWidth == 1) {
                        x = Math.floor(x) + 0.5;
                        y = Math.floor(y) + 0.5;
                    }

                    ctx.moveTo(x, y);
                    ctx.lineTo(x + xoff, y + yoff);
                    ctx.stroke();
                }

                // draw ticks
                ctx.beginPath();
                for (i = 0; i < axis.ticks.length; ++i) {
                    var v = axis.ticks[i].v;
                    
                    xoff = yoff = 0;

                    if (v < axis.min || v > axis.max
                        // skip those lying on the axes if we got a border
                        || (t == "full" && bw > 0
                            && (v == axis.min || v == axis.max)))
                        continue;

                    if (axis.direction == "x") {
                        x = axis.p2c(v);
                        yoff = t == "full" ? -plotHeight : t;
                        
                        if (axis.position == "top")
                            yoff = -yoff;
                    }
                    else {
                        y = axis.p2c(v);
                        xoff = t == "full" ? -plotWidth : t;
                        
                        if (axis.position == "left")
                            xoff = -xoff;
                    }

                    if (ctx.lineWidth == 1) {
                        if (axis.direction == "x")
                            x = Math.floor(x) + 0.5;
                        else
                            y = Math.floor(y) + 0.5;
                    }

                    ctx.moveTo(x, y);
                    ctx.lineTo(x + xoff, y + yoff);
                }
                
                ctx.stroke();
            }
            
            
            // draw border
            if (bw) {
                ctx.lineWidth = bw;
                ctx.strokeStyle = options.grid.borderColor;
                ctx.strokeRect(-bw/2, -bw/2, plotWidth + bw, plotHeight + bw);
            }

            ctx.restore();
        }

        function insertAxisLabels() {
            placeholder.find(".tickLabels").remove();
            
            var html = ['<div class="tickLabels" style="font-size:smaller">'];

            var axes = allAxes();
            for (var j = 0; j < axes.length; ++j) {
                var axis = axes[j], box = axis.box;
                if (!axis.show)
                    continue;
                //debug: html.push('<div style="position:absolute;opacity:0.10;background-color:red;left:' + box.left + 'px;top:' + box.top + 'px;width:' + box.width +  'px;height:' + box.height + 'px"></div>')
                html.push('<div class="' + axis.direction + 'Axis ' + axis.direction + axis.n + 'Axis" style="color:' + axis.options.color + '">');
                for (var i = 0; i < axis.ticks.length; ++i) {
                    var tick = axis.ticks[i];
                    if (!tick.label || tick.v < axis.min || tick.v > axis.max)
                        continue;

                    var pos = {}, align;
                    
                    if (axis.direction == "x") {
                        align = "center";
                        pos.left = Math.round(plotOffset.left + axis.p2c(tick.v) - axis.labelWidth/2);
                        if (axis.position == "bottom")
                            pos.top = box.top + box.padding;
                        else
                            pos.bottom = canvasHeight - (box.top + box.height - box.padding);
                    }
                    else {
                        pos.top = Math.round(plotOffset.top + axis.p2c(tick.v) - axis.labelHeight/2);
                        if (axis.position == "left") {
                            pos.right = canvasWidth - (box.left + box.width - box.padding)
                            align = "right";
                        }
                        else {
                            pos.left = box.left + box.padding;
                            align = "left";
                        }
                    }

                    pos.width = axis.labelWidth;

                    var style = ["position:absolute", "text-align:" + align ];
                    for (var a in pos)
                        style.push(a + ":" + pos[a] + "px")
                    
                    html.push('<div class="tickLabel" style="' + style.join(';') + '">' + tick.label + '</div>');
                }
                html.push('</div>');
            }

            html.push('</div>');

            placeholder.append(html.join(""));
        }

        function drawSeries(series) {
            if (series.lines.show)
                drawSeriesLines(series);
            if (series.bars.show)
                drawSeriesBars(series);
            if (series.points.show)
                drawSeriesPoints(series);
        }
        
        function drawSeriesLines(series) {
            function plotLine(datapoints, xoffset, yoffset, axisx, axisy) {
                var points = datapoints.points,
                    ps = datapoints.pointsize,
                    prevx = null, prevy = null;
                
                ctx.beginPath();
                for (var i = ps; i < points.length; i += ps) {
                    var x1 = points[i - ps], y1 = points[i - ps + 1],
                        x2 = points[i], y2 = points[i + 1];
                    
                    if (x1 == null || x2 == null)
                        continue;

                    // clip with ymin
                    if (y1 <= y2 && y1 < axisy.min) {
                        if (y2 < axisy.min)
                            continue;   // line segment is outside
                        // compute new intersection point
                        x1 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y1 = axisy.min;
                    }
                    else if (y2 <= y1 && y2 < axisy.min) {
                        if (y1 < axisy.min)
                            continue;
                        x2 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y2 = axisy.min;
                    }

                    // clip with ymax
                    if (y1 >= y2 && y1 > axisy.max) {
                        if (y2 > axisy.max)
                            continue;
                        x1 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y1 = axisy.max;
                    }
                    else if (y2 >= y1 && y2 > axisy.max) {
                        if (y1 > axisy.max)
                            continue;
                        x2 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y2 = axisy.max;
                    }

                    // clip with xmin
                    if (x1 <= x2 && x1 < axisx.min) {
                        if (x2 < axisx.min)
                            continue;
                        y1 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x1 = axisx.min;
                    }
                    else if (x2 <= x1 && x2 < axisx.min) {
                        if (x1 < axisx.min)
                            continue;
                        y2 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x2 = axisx.min;
                    }

                    // clip with xmax
                    if (x1 >= x2 && x1 > axisx.max) {
                        if (x2 > axisx.max)
                            continue;
                        y1 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x1 = axisx.max;
                    }
                    else if (x2 >= x1 && x2 > axisx.max) {
                        if (x1 > axisx.max)
                            continue;
                        y2 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x2 = axisx.max;
                    }

                    if (x1 != prevx || y1 != prevy)
                        ctx.moveTo(axisx.p2c(x1) + xoffset, axisy.p2c(y1) + yoffset);
                    
                    prevx = x2;
                    prevy = y2;
                    ctx.lineTo(axisx.p2c(x2) + xoffset, axisy.p2c(y2) + yoffset);
                }
                ctx.stroke();
            }

            function plotLineArea(datapoints, axisx, axisy) {
                var points = datapoints.points,
                    ps = datapoints.pointsize,
                    bottom = Math.min(Math.max(0, axisy.min), axisy.max),
                    i = 0, top, areaOpen = false,
                    ypos = 1, segmentStart = 0, segmentEnd = 0;

                // we process each segment in two turns, first forward
                // direction to sketch out top, then once we hit the
                // end we go backwards to sketch the bottom
                while (true) {
                    if (ps > 0 && i > points.length + ps)
                        break;

                    i += ps; // ps is negative if going backwards

                    var x1 = points[i - ps],
                        y1 = points[i - ps + ypos],
                        x2 = points[i], y2 = points[i + ypos];

                    if (areaOpen) {
                        if (ps > 0 && x1 != null && x2 == null) {
                            // at turning point
                            segmentEnd = i;
                            ps = -ps;
                            ypos = 2;
                            continue;
                        }

                        if (ps < 0 && i == segmentStart + ps) {
                            // done with the reverse sweep
                            ctx.fill();
                            areaOpen = false;
                            ps = -ps;
                            ypos = 1;
                            i = segmentStart = segmentEnd + ps;
                            continue;
                        }
                    }

                    if (x1 == null || x2 == null)
                        continue;

                    // clip x values
                    
                    // clip with xmin
                    if (x1 <= x2 && x1 < axisx.min) {
                        if (x2 < axisx.min)
                            continue;
                        y1 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x1 = axisx.min;
                    }
                    else if (x2 <= x1 && x2 < axisx.min) {
                        if (x1 < axisx.min)
                            continue;
                        y2 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x2 = axisx.min;
                    }

                    // clip with xmax
                    if (x1 >= x2 && x1 > axisx.max) {
                        if (x2 > axisx.max)
                            continue;
                        y1 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x1 = axisx.max;
                    }
                    else if (x2 >= x1 && x2 > axisx.max) {
                        if (x1 > axisx.max)
                            continue;
                        y2 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x2 = axisx.max;
                    }

                    if (!areaOpen) {
                        // open area
                        ctx.beginPath();
                        ctx.moveTo(axisx.p2c(x1), axisy.p2c(bottom));
                        areaOpen = true;
                    }
                    
                    // now first check the case where both is outside
                    if (y1 >= axisy.max && y2 >= axisy.max) {
                        ctx.lineTo(axisx.p2c(x1), axisy.p2c(axisy.max));
                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(axisy.max));
                        continue;
                    }
                    else if (y1 <= axisy.min && y2 <= axisy.min) {
                        ctx.lineTo(axisx.p2c(x1), axisy.p2c(axisy.min));
                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(axisy.min));
                        continue;
                    }
                    
                    // else it's a bit more complicated, there might
                    // be a flat maxed out rectangle first, then a
                    // triangular cutout or reverse; to find these
                    // keep track of the current x values
                    var x1old = x1, x2old = x2;

                    // clip the y values, without shortcutting, we
                    // go through all cases in turn
                    
                    // clip with ymin
                    if (y1 <= y2 && y1 < axisy.min && y2 >= axisy.min) {
                        x1 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y1 = axisy.min;
                    }
                    else if (y2 <= y1 && y2 < axisy.min && y1 >= axisy.min) {
                        x2 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y2 = axisy.min;
                    }

                    // clip with ymax
                    if (y1 >= y2 && y1 > axisy.max && y2 <= axisy.max) {
                        x1 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y1 = axisy.max;
                    }
                    else if (y2 >= y1 && y2 > axisy.max && y1 <= axisy.max) {
                        x2 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y2 = axisy.max;
                    }

                    // if the x value was changed we got a rectangle
                    // to fill
                    if (x1 != x1old) {
                        ctx.lineTo(axisx.p2c(x1old), axisy.p2c(y1));
                        // it goes to (x1, y1), but we fill that below
                    }
                    
                    // fill triangular section, this sometimes result
                    // in redundant points if (x1, y1) hasn't changed
                    // from previous line to, but we just ignore that
                    ctx.lineTo(axisx.p2c(x1), axisy.p2c(y1));
                    ctx.lineTo(axisx.p2c(x2), axisy.p2c(y2));

                    // fill the other rectangle if it's there
                    if (x2 != x2old) {
                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(y2));
                        ctx.lineTo(axisx.p2c(x2old), axisy.p2c(y2));
                    }
                }
            }

            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);
            ctx.lineJoin = "round";

            var lw = series.lines.lineWidth,
                sw = series.shadowSize;
            // FIXME: consider another form of shadow when filling is turned on
            if (lw > 0 && sw > 0) {
                // draw shadow as a thick and thin line with transparency
                ctx.lineWidth = sw;
                ctx.strokeStyle = "rgba(0,0,0,0.1)";
                // position shadow at angle from the mid of line
                var angle = Math.PI/18;
                plotLine(series.datapoints, Math.sin(angle) * (lw/2 + sw/2), Math.cos(angle) * (lw/2 + sw/2), series.xaxis, series.yaxis);
                ctx.lineWidth = sw/2;
                plotLine(series.datapoints, Math.sin(angle) * (lw/2 + sw/4), Math.cos(angle) * (lw/2 + sw/4), series.xaxis, series.yaxis);
            }

            ctx.lineWidth = lw;
            ctx.strokeStyle = series.color;
            var fillStyle = getFillStyle(series.lines, series.color, 0, plotHeight);
            if (fillStyle) {
                ctx.fillStyle = fillStyle;
                plotLineArea(series.datapoints, series.xaxis, series.yaxis);
            }

            if (lw > 0)
                plotLine(series.datapoints, 0, 0, series.xaxis, series.yaxis);
            ctx.restore();
        }

        function drawSeriesPoints(series) {
            function plotPoints(datapoints, radius, fillStyle, offset, shadow, axisx, axisy, symbol) {
                var points = datapoints.points, ps = datapoints.pointsize;

                for (var i = 0; i < points.length; i += ps) {
                    var x = points[i], y = points[i + 1];
                    if (x == null || x < axisx.min || x > axisx.max || y < axisy.min || y > axisy.max)
                        continue;
                    
                    ctx.beginPath();
                    x = axisx.p2c(x);
                    y = axisy.p2c(y) + offset;
                    if (symbol == "circle")
                        ctx.arc(x, y, radius, 0, shadow ? Math.PI : Math.PI * 2, false);
                    else
                        symbol(ctx, x, y, radius, shadow);
                    ctx.closePath();
                    
                    if (fillStyle) {
                        ctx.fillStyle = fillStyle;
                        ctx.fill();
                    }
                    ctx.stroke();
                }
            }
            
            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);

            var lw = series.points.lineWidth,
                sw = series.shadowSize,
                radius = series.points.radius,
                symbol = series.points.symbol;
            if (lw > 0 && sw > 0) {
                // draw shadow in two steps
                var w = sw / 2;
                ctx.lineWidth = w;
                ctx.strokeStyle = "rgba(0,0,0,0.1)";
                plotPoints(series.datapoints, radius, null, w + w/2, true,
                           series.xaxis, series.yaxis, symbol);

                ctx.strokeStyle = "rgba(0,0,0,0.2)";
                plotPoints(series.datapoints, radius, null, w/2, true,
                           series.xaxis, series.yaxis, symbol);
            }

            ctx.lineWidth = lw;
            ctx.strokeStyle = series.color;
            plotPoints(series.datapoints, radius,
                       getFillStyle(series.points, series.color), 0, false,
                       series.xaxis, series.yaxis, symbol);
            ctx.restore();
        }

        function drawBar(x, y, b, barLeft, barRight, offset, fillStyleCallback, axisx, axisy, c, horizontal, lineWidth) {
            var left, right, bottom, top,
                drawLeft, drawRight, drawTop, drawBottom,
                tmp;

            // in horizontal mode, we start the bar from the left
            // instead of from the bottom so it appears to be
            // horizontal rather than vertical
            if (horizontal) {
                drawBottom = drawRight = drawTop = true;
                drawLeft = false;
                left = b;
                right = x;
                top = y + barLeft;
                bottom = y + barRight;

                // account for negative bars
                if (right < left) {
                    tmp = right;
                    right = left;
                    left = tmp;
                    drawLeft = true;
                    drawRight = false;
                }
            }
            else {
                drawLeft = drawRight = drawTop = true;
                drawBottom = false;
                left = x + barLeft;
                right = x + barRight;
                bottom = b;
                top = y;

                // account for negative bars
                if (top < bottom) {
                    tmp = top;
                    top = bottom;
                    bottom = tmp;
                    drawBottom = true;
                    drawTop = false;
                }
            }
           
            // clip
            if (right < axisx.min || left > axisx.max ||
                top < axisy.min || bottom > axisy.max)
                return;
            
            if (left < axisx.min) {
                left = axisx.min;
                drawLeft = false;
            }

            if (right > axisx.max) {
                right = axisx.max;
                drawRight = false;
            }

            if (bottom < axisy.min) {
                bottom = axisy.min;
                drawBottom = false;
            }
            
            if (top > axisy.max) {
                top = axisy.max;
                drawTop = false;
            }

            left = axisx.p2c(left);
            bottom = axisy.p2c(bottom);
            right = axisx.p2c(right);
            top = axisy.p2c(top);
            
            // fill the bar
            if (fillStyleCallback) {
                c.beginPath();
                c.moveTo(left, bottom);
                c.lineTo(left, top);
                c.lineTo(right, top);
                c.lineTo(right, bottom);
                c.fillStyle = fillStyleCallback(bottom, top);
                c.fill();
            }

            // draw outline
            if (lineWidth > 0 && (drawLeft || drawRight || drawTop || drawBottom)) {
                c.beginPath();

                // FIXME: inline moveTo is buggy with excanvas
                c.moveTo(left, bottom + offset);
                if (drawLeft)
                    c.lineTo(left, top + offset);
                else
                    c.moveTo(left, top + offset);
                if (drawTop)
                    c.lineTo(right, top + offset);
                else
                    c.moveTo(right, top + offset);
                if (drawRight)
                    c.lineTo(right, bottom + offset);
                else
                    c.moveTo(right, bottom + offset);
                if (drawBottom)
                    c.lineTo(left, bottom + offset);
                else
                    c.moveTo(left, bottom + offset);
                c.stroke();
            }
        }
        
        function drawSeriesBars(series) {
            function plotBars(datapoints, barLeft, barRight, offset, fillStyleCallback, axisx, axisy) {
                var points = datapoints.points, ps = datapoints.pointsize;
                
                for (var i = 0; i < points.length; i += ps) {
                    if (points[i] == null)
                        continue;
                    drawBar(points[i], points[i + 1], points[i + 2], barLeft, barRight, offset, fillStyleCallback, axisx, axisy, ctx, series.bars.horizontal, series.bars.lineWidth);
                }
            }

            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);

            // FIXME: figure out a way to add shadows (for instance along the right edge)
            ctx.lineWidth = series.bars.lineWidth;
            ctx.strokeStyle = series.color;
            var barLeft = series.bars.align == "left" ? 0 : -series.bars.barWidth/2;
            var fillStyleCallback = series.bars.fill ? function (bottom, top) { return getFillStyle(series.bars, series.color, bottom, top); } : null;
            plotBars(series.datapoints, barLeft, barLeft + series.bars.barWidth, 0, fillStyleCallback, series.xaxis, series.yaxis);
            ctx.restore();
        }

        function getFillStyle(filloptions, seriesColor, bottom, top) {
            var fill = filloptions.fill;
            if (!fill)
                return null;

            if (filloptions.fillColor)
                return getColorOrGradient(filloptions.fillColor, bottom, top, seriesColor);
            
            var c = $.color.parse(seriesColor);
            c.a = typeof fill == "number" ? fill : 0.4;
            c.normalize();
            return c.toString();
        }
        
        function insertLegend() {
            placeholder.find(".legend").remove();

            if (!options.legend.show)
                return;
            
            var fragments = [], rowStarted = false,
                lf = options.legend.labelFormatter, s, label;
            for (var i = 0; i < series.length; ++i) {
                s = series[i];
                label = s.label;
                if (!label)
                    continue;
                
                if (i % options.legend.noColumns == 0) {
                    if (rowStarted)
                        fragments.push('</tr>');
                    fragments.push('<tr>');
                    rowStarted = true;
                }

                if (lf)
                    label = lf(label, s);
                
                fragments.push(
                    '<td class="legendColorBox"><div style="border:1px solid ' + options.legend.labelBoxBorderColor + ';padding:1px"><div style="width:4px;height:0;border:5px solid ' + s.color + ';overflow:hidden"></div></div></td>' +
                    '<td class="legendLabel">' + label + '</td>');
            }
            if (rowStarted)
                fragments.push('</tr>');
            
            if (fragments.length == 0)
                return;

            var table = '<table style="font-size:smaller;color:' + options.grid.color + '">' + fragments.join("") + '</table>';
            if (options.legend.container != null)
                $(options.legend.container).html(table);
            else {
                var pos = "",
                    p = options.legend.position,
                    m = options.legend.margin;
                if (m[0] == null)
                    m = [m, m];
                if (p.charAt(0) == "n")
                    pos += 'top:' + (m[1] + plotOffset.top) + 'px;';
                else if (p.charAt(0) == "s")
                    pos += 'bottom:' + (m[1] + plotOffset.bottom) + 'px;';
                if (p.charAt(1) == "e")
                    pos += 'right:' + (m[0] + plotOffset.right) + 'px;';
                else if (p.charAt(1) == "w")
                    pos += 'left:' + (m[0] + plotOffset.left) + 'px;';
                var legend = $('<div class="legend">' + table.replace('style="', 'style="position:absolute;' + pos +';') + '</div>').appendTo(placeholder);
                if (options.legend.backgroundOpacity != 0.0) {
                    // put in the transparent background
                    // separately to avoid blended labels and
                    // label boxes
                    var c = options.legend.backgroundColor;
                    if (c == null) {
                        c = options.grid.backgroundColor;
                        if (c && typeof c == "string")
                            c = $.color.parse(c);
                        else
                            c = $.color.extract(legend, 'background-color');
                        c.a = 1;
                        c = c.toString();
                    }
                    var div = legend.children();
                    $('<div style="position:absolute;width:' + div.width() + 'px;height:' + div.height() + 'px;' + pos +'background-color:' + c + ';"> </div>').prependTo(legend).css('opacity', options.legend.backgroundOpacity);
                }
            }
        }


        // interactive features
        
        var highlights = [],
            redrawTimeout = null;
        
        // returns the data item the mouse is over, or null if none is found
        function findNearbyItem(mouseX, mouseY, seriesFilter) {
            var maxDistance = options.grid.mouseActiveRadius,
                smallestDistance = maxDistance * maxDistance + 1,
                item = null, foundPoint = false, i, j;

            for (i = series.length - 1; i >= 0; --i) {
                if (!seriesFilter(series[i]))
                    continue;
                
                var s = series[i],
                    axisx = s.xaxis,
                    axisy = s.yaxis,
                    points = s.datapoints.points,
                    ps = s.datapoints.pointsize,
                    mx = axisx.c2p(mouseX), // precompute some stuff to make the loop faster
                    my = axisy.c2p(mouseY),
                    maxx = maxDistance / axisx.scale,
                    maxy = maxDistance / axisy.scale;

                // with inverse transforms, we can't use the maxx/maxy
                // optimization, sadly
                if (axisx.options.inverseTransform)
                    maxx = Number.MAX_VALUE;
                if (axisy.options.inverseTransform)
                    maxy = Number.MAX_VALUE;
                
                if (s.lines.show || s.points.show) {
                    for (j = 0; j < points.length; j += ps) {
                        var x = points[j], y = points[j + 1];
                        if (x == null)
                            continue;
                        
                        // For points and lines, the cursor must be within a
                        // certain distance to the data point
                        if (x - mx > maxx || x - mx < -maxx ||
                            y - my > maxy || y - my < -maxy)
                            continue;

                        // We have to calculate distances in pixels, not in
                        // data units, because the scales of the axes may be different
                        var dx = Math.abs(axisx.p2c(x) - mouseX),
                            dy = Math.abs(axisy.p2c(y) - mouseY),
                            dist = dx * dx + dy * dy; // we save the sqrt

                        // use <= to ensure last point takes precedence
                        // (last generally means on top of)
                        if (dist < smallestDistance) {
                            smallestDistance = dist;
                            item = [i, j / ps];
                        }
                    }
                }
                    
                if (s.bars.show && !item) { // no other point can be nearby
                    var barLeft = s.bars.align == "left" ? 0 : -s.bars.barWidth/2,
                        barRight = barLeft + s.bars.barWidth;
                    
                    for (j = 0; j < points.length; j += ps) {
                        var x = points[j], y = points[j + 1], b = points[j + 2];
                        if (x == null)
                            continue;
  
                        // for a bar graph, the cursor must be inside the bar
                        if (series[i].bars.horizontal ? 
                            (mx <= Math.max(b, x) && mx >= Math.min(b, x) && 
                             my >= y + barLeft && my <= y + barRight) :
                            (mx >= x + barLeft && mx <= x + barRight &&
                             my >= Math.min(b, y) && my <= Math.max(b, y)))
                                item = [i, j / ps];
                    }
                }
            }

            if (item) {
                i = item[0];
                j = item[1];
                ps = series[i].datapoints.pointsize;
                
                return { datapoint: series[i].datapoints.points.slice(j * ps, (j + 1) * ps),
                         dataIndex: j,
                         series: series[i],
                         seriesIndex: i };
            }
            
            return null;
        }

        function onMouseMove(e) {
            if (options.grid.hoverable)
                triggerClickHoverEvent("plothover", e,
                                       function (s) { return s["hoverable"] != false; });
        }

        function onMouseLeave(e) {
            if (options.grid.hoverable)
                triggerClickHoverEvent("plothover", e,
                                       function (s) { return false; });
        }

        function onClick(e) {
            triggerClickHoverEvent("plotclick", e,
                                   function (s) { return s["clickable"] != false; });
        }

        // trigger click or hover event (they send the same parameters
        // so we share their code)
        function triggerClickHoverEvent(eventname, event, seriesFilter) {
            var offset = eventHolder.offset(),
                canvasX = event.pageX - offset.left - plotOffset.left,
                canvasY = event.pageY - offset.top - plotOffset.top,
            pos = canvasToAxisCoords({ left: canvasX, top: canvasY });

            pos.pageX = event.pageX;
            pos.pageY = event.pageY;

            var item = findNearbyItem(canvasX, canvasY, seriesFilter);

            if (item) {
                // fill in mouse pos for any listeners out there
                item.pageX = parseInt(item.series.xaxis.p2c(item.datapoint[0]) + offset.left + plotOffset.left);
                item.pageY = parseInt(item.series.yaxis.p2c(item.datapoint[1]) + offset.top + plotOffset.top);
            }

            if (options.grid.autoHighlight) {
                // clear auto-highlights
                for (var i = 0; i < highlights.length; ++i) {
                    var h = highlights[i];
                    if (h.auto == eventname &&
                        !(item && h.series == item.series &&
                          h.point[0] == item.datapoint[0] &&
                          h.point[1] == item.datapoint[1]))
                        unhighlight(h.series, h.point);
                }
                
                if (item)
                    highlight(item.series, item.datapoint, eventname);
            }
            
            placeholder.trigger(eventname, [ pos, item ]);
        }

        function triggerRedrawOverlay() {
            if (!redrawTimeout)
                redrawTimeout = setTimeout(drawOverlay, 30);
        }

        function drawOverlay() {
            redrawTimeout = null;

            // draw highlights
            octx.save();
            octx.clearRect(0, 0, canvasWidth, canvasHeight);
            octx.translate(plotOffset.left, plotOffset.top);
            
            var i, hi;
            for (i = 0; i < highlights.length; ++i) {
                hi = highlights[i];

                if (hi.series.bars.show)
                    drawBarHighlight(hi.series, hi.point);
                else
                    drawPointHighlight(hi.series, hi.point);
            }
            octx.restore();
            
            executeHooks(hooks.drawOverlay, [octx]);
        }
        
        function highlight(s, point, auto) {
            if (typeof s == "number")
                s = series[s];

            if (typeof point == "number") {
                var ps = s.datapoints.pointsize;
                point = s.datapoints.points.slice(ps * point, ps * (point + 1));
            }

            var i = indexOfHighlight(s, point);
            if (i == -1) {
                highlights.push({ series: s, point: point, auto: auto });

                triggerRedrawOverlay();
            }
            else if (!auto)
                highlights[i].auto = false;
        }
            
        function unhighlight(s, point) {
            if (s == null && point == null) {
                highlights = [];
                triggerRedrawOverlay();
            }
            
            if (typeof s == "number")
                s = series[s];

            if (typeof point == "number")
                point = s.data[point];

            var i = indexOfHighlight(s, point);
            if (i != -1) {
                highlights.splice(i, 1);

                triggerRedrawOverlay();
            }
        }
        
        function indexOfHighlight(s, p) {
            for (var i = 0; i < highlights.length; ++i) {
                var h = highlights[i];
                if (h.series == s && h.point[0] == p[0]
                    && h.point[1] == p[1])
                    return i;
            }
            return -1;
        }
        
        function drawPointHighlight(series, point) {
            var x = point[0], y = point[1],
                axisx = series.xaxis, axisy = series.yaxis;
            
            if (x < axisx.min || x > axisx.max || y < axisy.min || y > axisy.max)
                return;
            
            var pointRadius = series.points.radius + series.points.lineWidth / 2;
            octx.lineWidth = pointRadius;
            octx.strokeStyle = $.color.parse(series.color).scale('a', 0.5).toString();
            var radius = 1.5 * pointRadius,
                x = axisx.p2c(x),
                y = axisy.p2c(y);
            
            octx.beginPath();
            if (series.points.symbol == "circle")
                octx.arc(x, y, radius, 0, 2 * Math.PI, false);
            else
                series.points.symbol(octx, x, y, radius, false);
            octx.closePath();
            octx.stroke();
        }

        function drawBarHighlight(series, point) {
            octx.lineWidth = series.bars.lineWidth;
            octx.strokeStyle = $.color.parse(series.color).scale('a', 0.5).toString();
            var fillStyle = $.color.parse(series.color).scale('a', 0.5).toString();
            var barLeft = series.bars.align == "left" ? 0 : -series.bars.barWidth/2;
            drawBar(point[0], point[1], point[2] || 0, barLeft, barLeft + series.bars.barWidth,
                    0, function () { return fillStyle; }, series.xaxis, series.yaxis, octx, series.bars.horizontal, series.bars.lineWidth);
        }

        function getColorOrGradient(spec, bottom, top, defaultColor) {
            if (typeof spec == "string")
                return spec;
            else {
                // assume this is a gradient spec; IE currently only
                // supports a simple vertical gradient properly, so that's
                // what we support too
                var gradient = ctx.createLinearGradient(0, top, 0, bottom);
                
                for (var i = 0, l = spec.colors.length; i < l; ++i) {
                    var c = spec.colors[i];
                    if (typeof c != "string") {
                        var co = $.color.parse(defaultColor);
                        if (c.brightness != null)
                            co = co.scale('rgb', c.brightness)
                        if (c.opacity != null)
                            co.a *= c.opacity;
                        c = co.toString();
                    }
                    gradient.addColorStop(i / (l - 1), c);
                }
                
                return gradient;
            }
        }
    }

    $.plot = function(placeholder, data, options) {
        //var t0 = new Date();
        var plot = new Plot($(placeholder), data, options, $.plot.plugins);
        //(window.console ? console.log : alert)("time used (msecs): " + ((new Date()).getTime() - t0.getTime()));
        return plot;
    };

    $.plot.version = "0.7";
    
    $.plot.plugins = [];

    // returns a string with the date d formatted according to fmt
    $.plot.formatDate = function(d, fmt, monthNames) {
        var leftPad = function(n) {
            n = "" + n;
            return n.length == 1 ? "0" + n : n;
        };
        
        var r = [];
        var escape = false, padNext = false;
        var hours = d.getUTCHours();
        var isAM = hours < 12;
        if (monthNames == null)
            monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

        if (fmt.search(/%p|%P/) != -1) {
            if (hours > 12) {
                hours = hours - 12;
            } else if (hours == 0) {
                hours = 12;
            }
        }
        for (var i = 0; i < fmt.length; ++i) {
            var c = fmt.charAt(i);
            
            if (escape) {
                switch (c) {
                case 'h': c = "" + hours; break;
                case 'H': c = leftPad(hours); break;
                case 'M': c = leftPad(d.getUTCMinutes()); break;
                case 'S': c = leftPad(d.getUTCSeconds()); break;
                case 'd': c = "" + d.getUTCDate(); break;
                case 'm': c = "" + (d.getUTCMonth() + 1); break;
                case 'y': c = "" + d.getUTCFullYear(); break;
                case 'b': c = "" + monthNames[d.getUTCMonth()]; break;
                case 'p': c = (isAM) ? ("" + "am") : ("" + "pm"); break;
                case 'P': c = (isAM) ? ("" + "AM") : ("" + "PM"); break;
                case '0': c = ""; padNext = true; break;
                }
                if (c && padNext) {
                    c = leftPad(c);
                    padNext = false;
                }
                r.push(c);
                if (!padNext)
                    escape = false;
            }
            else {
                if (c == "%")
                    escape = true;
                else
                    r.push(c);
            }
        }
        return r.join("");
    };
    
    // round to nearby lower multiple of base
    function floorInBase(n, base) {
        return base * Math.floor(n / base);
    }
    
})(jQuery);
;
;
/* module-key = 'bamboo.web.resources:flot', location = '/bower/jquery-flot/jquery.flot.pie.js' */
/*
Flot plugin for rendering pie charts. The plugin assumes the data is 
coming is as a single data value for each series, and each of those 
values is a positive value or zero (negative numbers don't make 
any sense and will cause strange effects). The data values do 
NOT need to be passed in as percentage values because it 
internally calculates the total and percentages.

* Created by Brian Medendorp, June 2009
* Updated November 2009 with contributions from: btburnett3, Anthony Aragues and Xavi Ivars

* Changes:
	2009-10-22: lineJoin set to round
	2009-10-23: IE full circle fix, donut
	2009-11-11: Added basic hover from btburnett3 - does not work in IE, and center is off in Chrome and Opera
	2009-11-17: Added IE hover capability submitted by Anthony Aragues
	2009-11-18: Added bug fix submitted by Xavi Ivars (issues with arrays when other JS libraries are included as well)
		

Available options are:
series: {
	pie: {
		show: true/false
		radius: 0-1 for percentage of fullsize, or a specified pixel length, or 'auto'
		innerRadius: 0-1 for percentage of fullsize or a specified pixel length, for creating a donut effect
		startAngle: 0-2 factor of PI used for starting angle (in radians) i.e 3/2 starts at the top, 0 and 2 have the same result
		tilt: 0-1 for percentage to tilt the pie, where 1 is no tilt, and 0 is completely flat (nothing will show)
		offset: {
			top: integer value to move the pie up or down
			left: integer value to move the pie left or right, or 'auto'
		},
		stroke: {
			color: any hexidecimal color value (other formats may or may not work, so best to stick with something like '#FFF')
			width: integer pixel width of the stroke
		},
		label: {
			show: true/false, or 'auto'
			formatter:  a user-defined function that modifies the text/style of the label text
			radius: 0-1 for percentage of fullsize, or a specified pixel length
			background: {
				color: any hexidecimal color value (other formats may or may not work, so best to stick with something like '#000')
				opacity: 0-1
			},
			threshold: 0-1 for the percentage value at which to hide labels (if they're too small)
		},
		combine: {
			threshold: 0-1 for the percentage value at which to combine slices (if they're too small)
			color: any hexidecimal color value (other formats may or may not work, so best to stick with something like '#CCC'), if null, the plugin will automatically use the color of the first slice to be combined
			label: any text value of what the combined slice should be labeled
		}
		highlight: {
			opacity: 0-1
		}
	}
}

More detail and specific examples can be found in the included HTML file.

*/

(function ($) 
{
	function init(plot) // this is the "body" of the plugin
	{
		var canvas = null;
		var target = null;
		var maxRadius = null;
		var centerLeft = null;
		var centerTop = null;
		var total = 0;
		var redraw = true;
		var redrawAttempts = 10;
		var shrink = 0.95;
		var legendWidth = 0;
		var processed = false;
		var raw = false;
		
		// interactive variables	
		var highlights = [];	
	
		// add hook to determine if pie plugin in enabled, and then perform necessary operations
		plot.hooks.processOptions.push(checkPieEnabled);
		plot.hooks.bindEvents.push(bindEvents);	

		// check to see if the pie plugin is enabled
		function checkPieEnabled(plot, options)
		{
			if (options.series.pie.show)
			{
				//disable grid
				options.grid.show = false;
				
				// set labels.show
				if (options.series.pie.label.show=='auto')
					if (options.legend.show)
						options.series.pie.label.show = false;
					else
						options.series.pie.label.show = true;
				
				// set radius
				if (options.series.pie.radius=='auto')
					if (options.series.pie.label.show)
						options.series.pie.radius = 3/4;
					else
						options.series.pie.radius = 1;
						
				// ensure sane tilt
				if (options.series.pie.tilt>1)
					options.series.pie.tilt=1;
				if (options.series.pie.tilt<0)
					options.series.pie.tilt=0;
			
				// add processData hook to do transformations on the data
				plot.hooks.processDatapoints.push(processDatapoints);
				plot.hooks.drawOverlay.push(drawOverlay);	
				
				// add draw hook
				plot.hooks.draw.push(draw);
			}
		}
	
		// bind hoverable events
		function bindEvents(plot, eventHolder) 		
		{		
			var options = plot.getOptions();
			
			if (options.series.pie.show && options.grid.hoverable)
				eventHolder.unbind('mousemove').mousemove(onMouseMove);
				
			if (options.series.pie.show && options.grid.clickable)
				eventHolder.unbind('click').click(onClick);
		}	
		

		// debugging function that prints out an object
		function alertObject(obj)
		{
			var msg = '';
			function traverse(obj, depth)
			{
				if (!depth)
					depth = 0;
				for (var i = 0; i < obj.length; ++i)
				{
					for (var j=0; j<depth; j++)
						msg += '\t';
				
					if( typeof obj[i] == "object")
					{	// its an object
						msg += ''+i+':\n';
						traverse(obj[i], depth+1);
					}
					else
					{	// its a value
						msg += ''+i+': '+obj[i]+'\n';
					}
				}
			}
			traverse(obj);
			alert(msg);
		}
		
		function calcTotal(data)
		{
			for (var i = 0; i < data.length; ++i)
			{
				var item = parseFloat(data[i].data[0][1]);
				if (item)
					total += item;
			}
		}	
		
		function processDatapoints(plot, series, data, datapoints) 
		{	
			if (!processed)
			{
				processed = true;
			
				canvas = plot.getCanvas();
				target = $(canvas).parent();
				options = plot.getOptions();
			
				plot.setData(combine(plot.getData()));
			}
		}
		
		function setupPie()
		{
			legendWidth = target.children().filter('.legend').children().width();
		
			// calculate maximum radius and center point
			maxRadius =  Math.min(canvas.width,(canvas.height/options.series.pie.tilt))/2;
			centerTop = (canvas.height/2)+options.series.pie.offset.top;
			centerLeft = (canvas.width/2);
			
			if (options.series.pie.offset.left=='auto')
				if (options.legend.position.match('w'))
					centerLeft += legendWidth/2;
				else
					centerLeft -= legendWidth/2;
			else
				centerLeft += options.series.pie.offset.left;
					
			if (centerLeft<maxRadius)
				centerLeft = maxRadius;
			else if (centerLeft>canvas.width-maxRadius)
				centerLeft = canvas.width-maxRadius;
		}
		
		function fixData(data)
		{
			for (var i = 0; i < data.length; ++i)
			{
				if (typeof(data[i].data)=='number')
					data[i].data = [[1,data[i].data]];
				else if (typeof(data[i].data)=='undefined' || typeof(data[i].data[0])=='undefined')
				{
					if (typeof(data[i].data)!='undefined' && typeof(data[i].data.label)!='undefined')
						data[i].label = data[i].data.label; // fix weirdness coming from flot
					data[i].data = [[1,0]];
					
				}
			}
			return data;
		}
		
		function combine(data)
		{
			data = fixData(data);
			calcTotal(data);
			var combined = 0;
			var numCombined = 0;
			var color = options.series.pie.combine.color;
			
			var newdata = [];
			for (var i = 0; i < data.length; ++i)
			{
				// make sure its a number
				data[i].data[0][1] = parseFloat(data[i].data[0][1]);
				if (!data[i].data[0][1])
					data[i].data[0][1] = 0;
					
				if (data[i].data[0][1]/total<=options.series.pie.combine.threshold)
				{
					combined += data[i].data[0][1];
					numCombined++;
					if (!color)
						color = data[i].color;
				}				
				else
				{
					newdata.push({
						data: [[1,data[i].data[0][1]]], 
						color: data[i].color, 
						label: data[i].label,
						angle: (data[i].data[0][1]*(Math.PI*2))/total,
						percent: (data[i].data[0][1]/total*100)
					});
				}
			}
			if (numCombined>0)
				newdata.push({
					data: [[1,combined]], 
					color: color, 
					label: options.series.pie.combine.label,
					angle: (combined*(Math.PI*2))/total,
					percent: (combined/total*100)
				});
			return newdata;
		}		
		
		function draw(plot, newCtx)
		{
			if (!target) return; // if no series were passed
			ctx = newCtx;
		
			setupPie();
			var slices = plot.getData();
		
			var attempts = 0;
			while (redraw && attempts<redrawAttempts)
			{
				redraw = false;
				if (attempts>0)
					maxRadius *= shrink;
				attempts += 1;
				clear();
				if (options.series.pie.tilt<=0.8)
					drawShadow();
				drawPie();
			}
			if (attempts >= redrawAttempts) {
				clear();
				target.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>');
			}
			
			if ( plot.setSeries && plot.insertLegend )
			{
				plot.setSeries(slices);
				plot.insertLegend();
			}
			
			// we're actually done at this point, just defining internal functions at this point
			
			function clear()
			{
				ctx.clearRect(0,0,canvas.width,canvas.height);
				target.children().filter('.pieLabel, .pieLabelBackground').remove();
			}
			
			function drawShadow()
			{
				var shadowLeft = 5;
				var shadowTop = 15;
				var edge = 10;
				var alpha = 0.02;
			
				// set radius
				if (options.series.pie.radius>1)
					var radius = options.series.pie.radius;
				else
					var radius = maxRadius * options.series.pie.radius;
					
				if (radius>=(canvas.width/2)-shadowLeft || radius*options.series.pie.tilt>=(canvas.height/2)-shadowTop || radius<=edge)
					return;	// shadow would be outside canvas, so don't draw it
			
				ctx.save();
				ctx.translate(shadowLeft,shadowTop);
				ctx.globalAlpha = alpha;
				ctx.fillStyle = '#000';

				// center and rotate to starting position
				ctx.translate(centerLeft,centerTop);
				ctx.scale(1, options.series.pie.tilt);
				
				//radius -= edge;
				for (var i=1; i<=edge; i++)
				{
					ctx.beginPath();
					ctx.arc(0,0,radius,0,Math.PI*2,false);
					ctx.fill();
					radius -= i;
				}	
				
				ctx.restore();
			}
			
			function drawPie()
			{
				startAngle = Math.PI*options.series.pie.startAngle;
				
				// set radius
				if (options.series.pie.radius>1)
					var radius = options.series.pie.radius;
				else
					var radius = maxRadius * options.series.pie.radius;
				
				// center and rotate to starting position
				ctx.save();
				ctx.translate(centerLeft,centerTop);
				ctx.scale(1, options.series.pie.tilt);
				//ctx.rotate(startAngle); // start at top; -- This doesn't work properly in Opera
				
				// draw slices
				ctx.save();
				var currentAngle = startAngle;
				for (var i = 0; i < slices.length; ++i)
				{
					slices[i].startAngle = currentAngle;
					drawSlice(slices[i].angle, slices[i].color, true);
				}
				ctx.restore();
				
				// draw slice outlines
				ctx.save();
				ctx.lineWidth = options.series.pie.stroke.width;
				currentAngle = startAngle;
				for (var i = 0; i < slices.length; ++i)
					drawSlice(slices[i].angle, options.series.pie.stroke.color, false);
				ctx.restore();
					
				// draw donut hole
				drawDonutHole(ctx);
				
				// draw labels
				if (options.series.pie.label.show)
					drawLabels();
				
				// restore to original state
				ctx.restore();
				
				function drawSlice(angle, color, fill)
				{	
					if (angle<=0)
						return;
				
					if (fill)
						ctx.fillStyle = color;
					else
					{
						ctx.strokeStyle = color;
						ctx.lineJoin = 'round';
					}
						
					ctx.beginPath();
					if (Math.abs(angle - Math.PI*2) > 0.000000001)
						ctx.moveTo(0,0); // Center of the pie
					else if ($.browser.msie)
						angle -= 0.0001;
					//ctx.arc(0,0,radius,0,angle,false); // This doesn't work properly in Opera
					ctx.arc(0,0,radius,currentAngle,currentAngle+angle,false);
					ctx.closePath();
					//ctx.rotate(angle); // This doesn't work properly in Opera
					currentAngle += angle;
					
					if (fill)
						ctx.fill();
					else
						ctx.stroke();
				}
				
				function drawLabels()
				{
					var currentAngle = startAngle;
					
					// set radius
					if (options.series.pie.label.radius>1)
						var radius = options.series.pie.label.radius;
					else
						var radius = maxRadius * options.series.pie.label.radius;
					
					for (var i = 0; i < slices.length; ++i)
					{
						if (slices[i].percent >= options.series.pie.label.threshold*100)
							drawLabel(slices[i], currentAngle, i);
						currentAngle += slices[i].angle;
					}
					
					function drawLabel(slice, startAngle, index)
					{
						if (slice.data[0][1]==0)
							return;
							
						// format label text
						var lf = options.legend.labelFormatter, text, plf = options.series.pie.label.formatter;
						if (lf)
							text = lf(slice.label, slice);
						else
							text = slice.label;
						if (plf)
							text = plf(text, slice);
							
						var halfAngle = ((startAngle+slice.angle) + startAngle)/2;
						var x = centerLeft + Math.round(Math.cos(halfAngle) * radius);
						var y = centerTop + Math.round(Math.sin(halfAngle) * radius) * options.series.pie.tilt;
						
						var html = '<span class="pieLabel" id="pieLabel'+index+'" style="position:absolute;top:' + y + 'px;left:' + x + 'px;">' + text + "</span>";
						target.append(html);
						var label = target.children('#pieLabel'+index);
						var labelTop = (y - label.height()/2);
						var labelLeft = (x - label.width()/2);
						label.css('top', labelTop);
						label.css('left', labelLeft);
						
						// check to make sure that the label is not outside the canvas
						if (0-labelTop>0 || 0-labelLeft>0 || canvas.height-(labelTop+label.height())<0 || canvas.width-(labelLeft+label.width())<0)
							redraw = true;
						
						if (options.series.pie.label.background.opacity != 0) {
							// put in the transparent background separately to avoid blended labels and label boxes
							var c = options.series.pie.label.background.color;
							if (c == null) {
								c = slice.color;
							}
							var pos = 'top:'+labelTop+'px;left:'+labelLeft+'px;';
							$('<div class="pieLabelBackground" style="position:absolute;width:' + label.width() + 'px;height:' + label.height() + 'px;' + pos +'background-color:' + c + ';"> </div>').insertBefore(label).css('opacity', options.series.pie.label.background.opacity);
						}
					} // end individual label function
				} // end drawLabels function
			} // end drawPie function
		} // end draw function
		
		// Placed here because it needs to be accessed from multiple locations 
		function drawDonutHole(layer)
		{
			// draw donut hole
			if(options.series.pie.innerRadius > 0)
			{
				// subtract the center
				layer.save();
				innerRadius = options.series.pie.innerRadius > 1 ? options.series.pie.innerRadius : maxRadius * options.series.pie.innerRadius;
				layer.globalCompositeOperation = 'destination-out'; // this does not work with excanvas, but it will fall back to using the stroke color
				layer.beginPath();
				layer.fillStyle = options.series.pie.stroke.color;
				layer.arc(0,0,innerRadius,0,Math.PI*2,false);
				layer.fill();
				layer.closePath();
				layer.restore();
				
				// add inner stroke
				layer.save();
				layer.beginPath();
				layer.strokeStyle = options.series.pie.stroke.color;
				layer.arc(0,0,innerRadius,0,Math.PI*2,false);
				layer.stroke();
				layer.closePath();
				layer.restore();
				// TODO: add extra shadow inside hole (with a mask) if the pie is tilted.
			}
		}
		
		//-- Additional Interactive related functions --
		
		function isPointInPoly(poly, pt)
		{
			for(var c = false, i = -1, l = poly.length, j = l - 1; ++i < l; j = i)
				((poly[i][1] <= pt[1] && pt[1] < poly[j][1]) || (poly[j][1] <= pt[1] && pt[1]< poly[i][1]))
				&& (pt[0] < (poly[j][0] - poly[i][0]) * (pt[1] - poly[i][1]) / (poly[j][1] - poly[i][1]) + poly[i][0])
				&& (c = !c);
			return c;
		}
		
		function findNearbySlice(mouseX, mouseY)
		{
			var slices = plot.getData(),
				options = plot.getOptions(),
				radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;
			
			for (var i = 0; i < slices.length; ++i) 
			{
				var s = slices[i];	
				
				if(s.pie.show)
				{
					ctx.save();
					ctx.beginPath();
					ctx.moveTo(0,0); // Center of the pie
					//ctx.scale(1, options.series.pie.tilt);	// this actually seems to break everything when here.
					ctx.arc(0,0,radius,s.startAngle,s.startAngle+s.angle,false);
					ctx.closePath();
					x = mouseX-centerLeft;
					y = mouseY-centerTop;
					if(ctx.isPointInPath)
					{
						if (ctx.isPointInPath(mouseX-centerLeft, mouseY-centerTop))
						{
							//alert('found slice!');
							ctx.restore();
							return {datapoint: [s.percent, s.data], dataIndex: 0, series: s, seriesIndex: i};
						}
					}
					else
					{
						// excanvas for IE doesn;t support isPointInPath, this is a workaround. 
						p1X = (radius * Math.cos(s.startAngle));
						p1Y = (radius * Math.sin(s.startAngle));
						p2X = (radius * Math.cos(s.startAngle+(s.angle/4)));
						p2Y = (radius * Math.sin(s.startAngle+(s.angle/4)));
						p3X = (radius * Math.cos(s.startAngle+(s.angle/2)));
						p3Y = (radius * Math.sin(s.startAngle+(s.angle/2)));
						p4X = (radius * Math.cos(s.startAngle+(s.angle/1.5)));
						p4Y = (radius * Math.sin(s.startAngle+(s.angle/1.5)));
						p5X = (radius * Math.cos(s.startAngle+s.angle));
						p5Y = (radius * Math.sin(s.startAngle+s.angle));
						arrPoly = [[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];
						arrPoint = [x,y];
						// TODO: perhaps do some mathmatical trickery here with the Y-coordinate to compensate for pie tilt?
						if(isPointInPoly(arrPoly, arrPoint))
						{
							ctx.restore();
							return {datapoint: [s.percent, s.data], dataIndex: 0, series: s, seriesIndex: i};
						}			
					}
					ctx.restore();
				}
			}
			
			return null;
		}

		function onMouseMove(e) 
		{
			triggerClickHoverEvent('plothover', e);
		}
		
        function onClick(e) 
		{
			triggerClickHoverEvent('plotclick', e);
        }

		// trigger click or hover event (they send the same parameters so we share their code)
		function triggerClickHoverEvent(eventname, e) 
		{
			var offset = plot.offset(),
				canvasX = parseInt(e.pageX - offset.left),
				canvasY =  parseInt(e.pageY - offset.top),
				item = findNearbySlice(canvasX, canvasY);
			
			if (options.grid.autoHighlight) 
			{
				// clear auto-highlights
				for (var i = 0; i < highlights.length; ++i) 
				{
					var h = highlights[i];
					if (h.auto == eventname && !(item && h.series == item.series))
						unhighlight(h.series);
				}
			}
			
			// highlight the slice
			if (item) 
			    highlight(item.series, eventname);
				
			// trigger any hover bind events
			var pos = { pageX: e.pageX, pageY: e.pageY };
			target.trigger(eventname, [ pos, item ]);	
		}

		function highlight(s, auto) 
		{
			if (typeof s == "number")
				s = series[s];

			var i = indexOfHighlight(s);
			if (i == -1) 
			{
				highlights.push({ series: s, auto: auto });
				plot.triggerRedrawOverlay();
			}
			else if (!auto)
				highlights[i].auto = false;
		}

		function unhighlight(s) 
		{
			if (s == null) 
			{
				highlights = [];
				plot.triggerRedrawOverlay();
			}
			
			if (typeof s == "number")
				s = series[s];

			var i = indexOfHighlight(s);
			if (i != -1) 
			{
				highlights.splice(i, 1);
				plot.triggerRedrawOverlay();
			}
		}

		function indexOfHighlight(s) 
		{
			for (var i = 0; i < highlights.length; ++i) 
			{
				var h = highlights[i];
				if (h.series == s)
					return i;
			}
			return -1;
		}

		function drawOverlay(plot, octx) 
		{
			//alert(options.series.pie.radius);
			var options = plot.getOptions();
			//alert(options.series.pie.radius);
			
			var radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;

			octx.save();
			octx.translate(centerLeft, centerTop);
			octx.scale(1, options.series.pie.tilt);
			
			for (i = 0; i < highlights.length; ++i) 
				drawHighlight(highlights[i].series);
			
			drawDonutHole(octx);

			octx.restore();

			function drawHighlight(series) 
			{
				if (series.angle < 0) return;
				
				//octx.fillStyle = parseColor(options.series.pie.highlight.color).scale(null, null, null, options.series.pie.highlight.opacity).toString();
				octx.fillStyle = "rgba(255, 255, 255, "+options.series.pie.highlight.opacity+")"; // this is temporary until we have access to parseColor
				
				octx.beginPath();
				if (Math.abs(series.angle - Math.PI*2) > 0.000000001)
					octx.moveTo(0,0); // Center of the pie
				octx.arc(0,0,radius,series.startAngle,series.startAngle+series.angle,false);
				octx.closePath();
				octx.fill();
			}
			
		}	
		
	} // end init (plugin body)
	
	// define pie specific options and their default values
	var options = {
		series: {
			pie: {
				show: false,
				radius: 'auto',	// actual radius of the visible pie (based on full calculated radius if <=1, or hard pixel value)
				innerRadius:0, /* for donut */
				startAngle: 3/2,
				tilt: 1,
				offset: {
					top: 0,
					left: 'auto'
				},
				stroke: {
					color: '#FFF',
					width: 1
				},
				label: {
					show: 'auto',
					formatter: function(label, slice){
						return '<div style="font-size:x-small;text-align:center;padding:2px;color:'+slice.color+';">'+label+'<br/>'+Math.round(slice.percent)+'%</div>';
					},	// formatter function
					radius: 1,	// radius at which to place the labels (based on full calculated radius if <=1, or hard pixel value)
					background: {
						color: null,
						opacity: 0
					},
					threshold: 0	// percentage at which to hide the label (i.e. the slice is too narrow)
				},
				combine: {
					threshold: -1,	// percentage at which to combine little slices into one larger slice
					color: null,	// color to give the new slice (auto-generated if null)
					label: 'Other'	// label to give the new slice
				},
				highlight: {
					//color: '#FFF',		// will add this functionality once parseColor is available
					opacity: 0.5
				}
			}
		}
	};
    
	$.plot.plugins.push({
		init: init,
		options: options,
		name: "pie",
		version: "1.0"
	});
})(jQuery);
;
;
/* module-key = 'bamboo.web.resources:buildStatistics', location = '/scripts/build-statistics.js' */
BAMBOO.BuildStatistics = (function ($) {
    var colours = {
            fail: '#a00',
            success: '#393'
        };

    function generatePieData(successRate, failureRate) {
        function sliceWithinBounds(slice) {
            var min = 0.125, /* small enough so that it only renders a white line at the size we have the graph */
                max = 100 - min;

            return Math.max(Math.min(slice, max), min);
        }
        function buildSuccessSeriesConfig(label, data, colour) {
            return {
                label: label,
                data: sliceWithinBounds(data),
                color: colour
            }
        }

        return [
            buildSuccessSeriesConfig('Successful', successRate, colours.success),
            buildSuccessSeriesConfig('Failed', failureRate, colours.fail)
        ];
    }
    function buildNumberSeriesConfig(data, colour) {
        return {
            data: data,
            bars: { show: true, fill: 1, lineWidth: 0 },
            color: colour,
            shadowSize: 0
        }
    }

    return {
        init: function () {
            $(function () {
                var $buildSuccessChart = $('#build-success-chart'),
                    $buildNumberChart = $('#build-number-chart'),
                    buildNumberResults = $buildNumberChart.data('json')['results'];

                $.plot($buildSuccessChart, generatePieData($buildSuccessChart.data('successful'), $buildSuccessChart.data('failed')), {
                    series: {
                        pie: {
                            show: true,
                            radius: 1,
                            label: { show: false }
                        }
                    },
                    legend: { show: false }
                });
                $.plot($buildNumberChart, [ buildNumberSeriesConfig(buildNumberResults['failed'], colours.fail), buildNumberSeriesConfig(buildNumberResults['successful'], colours.success) ], {
                    xaxis: { show: false },
                    yaxis: { show: false },
                    grid: { show: false }
                });
            });
        }
    };
})(jQuery);;
;
/* module-key = 'bamboo.web.resources:jira-issue-list', location = '/feature/jira-issue-list/jira-issue-list.soy' */
// This file was automatically generated from jira-issue-list.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.jiraIssueList.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.jiraIssueList == 'undefined') { bamboo.feature.jiraIssueList = {}; }


bamboo.feature.jiraIssueList.jiraIssueList = function(opt_data, opt_ignored) {
  var output = '<table class="aui jira-issues' + ((opt_data.loading) ? ' loading' : '') + '"><thead><tr><th colspan="2" class="issue">Issue</th><th class="description">Description</th>' + ((! opt_data.hideStatus) ? '<th class="status">Status</th>' : '') + '</tr></thead>' + ((opt_data.issuesCount > opt_data.maxIssues) ? '<tfoot><tr><td colspan="' + soy.$$escapeHtml(opt_data.hideStatus ? 3 : 4) + '"><a href="' + soy.$$escapeHtml(opt_data.jiraTabUrl) + '">' + soy.$$escapeHtml(opt_data.issuesCount - opt_data.maxIssues + ' more issue' + (opt_data.issuesCount - opt_data.maxIssues > 1 ? 's' : '')) + '&hellip;</a></td></tr></tfoot>' : '') + '<tbody>';
  var issueList22 = opt_data.issues;
  var issueListLen22 = issueList22.length;
  for (var issueIndex22 = 0; issueIndex22 < issueListLen22; issueIndex22++) {
    var issueData22 = issueList22[issueIndex22];
    output += (issueData22.url && issueData22.url.href && issueData22.key && issueData22.summary) ? bamboo.feature.jiraIssueList.jiraIssueListItem({key: issueData22.key, url: issueData22.url, summary: issueData22.summary, issueType: issueData22.issueType ? issueData22.issueType : opt_data.defaultIssueType, iconUrl: issueData22.iconUrl ? issueData22.iconUrl : opt_data.defaultIssueIconUrl, status: issueData22.status, statusClass: issueData22.statusClass, hideStatus: opt_data.hideStatus}) : bamboo.feature.jiraIssueList.jiraIssueListItemNoConnection({key: issueData22.issueKey ? issueData22.issueKey : issueData22.key, hideStatus: opt_data.hideStatus});
  }
  output += '</tbody></table>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.jiraIssueList.soyTemplateName = 'bamboo.feature.jiraIssueList.jiraIssueList';
}


bamboo.feature.jiraIssueList.jiraIssueListItem = function(opt_data, opt_ignored) {
  return '<tr data-issue-key="' + opt_data.key + '"><td class="type"><a href="' + soy.$$escapeHtml(opt_data.url.href) + '" title="' + soy.$$escapeHtml("View this issue") + '"><img src="' + soy.$$escapeHtml(opt_data.iconUrl) + '" alt="' + soy.$$escapeHtml(opt_data.issueType) + '" /></a></td><td class="key"><a href="' + soy.$$escapeHtml(opt_data.url.href) + '">' + opt_data.key + '</a></td><td class="description">' + soy.$$escapeHtml(opt_data.summary) + '</td>' + ((! opt_data.hideStatus) ? '<td class="status"><span class="status-lozenge lozenge-subtle' + ((opt_data.statusClass) ? ' status-' + opt_data.statusClass : '') + '" title="' + soy.$$escapeHtml(opt_data.status) + '">' + soy.$$escapeHtml(opt_data.status) + '</span></td>' : '') + '</tr>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.jiraIssueListItem.soyTemplateName = 'bamboo.feature.jiraIssueList.jiraIssueListItem';
}


bamboo.feature.jiraIssueList.jiraIssueListItemNoConnection = function(opt_data, opt_ignored) {
  return '<tr><td class="type">' + widget.icons.icon({type: 'jiraissue-unknown', text: 'Unknown Issue Type', showTitle: true}) + '</td><td class="key">' + soy.$$escapeHtml(opt_data.key) + '</td><td' + ((! opt_data.hideStatus) ? ' colspan="2"' : '') + ' class="details-error"><span>' + soy.$$escapeHtml("Could not obtain issue details from JIRA") + '</span></td></tr>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.jiraIssueListItemNoConnection.soyTemplateName = 'bamboo.feature.jiraIssueList.jiraIssueListItemNoConnection';
}


bamboo.feature.jiraIssueList.singleIssue = function(opt_data, opt_ignored) {
  return '<span class="jira-issue"' + ((opt_data.key) ? ' data-key="' + opt_data.key + '"' : '') + '><a href="' + ((opt_data.url.href) ? soy.$$escapeHtml(opt_data.url.href) : soy.$$escapeHtml(opt_data.url)) + '" title="' + soy.$$escapeHtml("View this issue") + ' (' + soy.$$escapeHtml(opt_data.issueType) + ')" style="background-image: url(' + soy.$$escapeHtml(opt_data.iconUrl) + ');">' + soy.$$escapeHtml(opt_data.key) + '</a><span class="description">' + soy.$$escapeHtml(opt_data.summary) + '</span><span class="status-lozenge">' + soy.$$escapeHtml(opt_data.status) + '</span></span>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.singleIssue.soyTemplateName = 'bamboo.feature.jiraIssueList.singleIssue';
}


bamboo.feature.jiraIssueList.singleIssueLoading = function(opt_data, opt_ignored) {
  return '<span class="single-issue-loading"><a' + ((opt_data.keyLink) ? ' href="' + soy.$$escapeHtml(opt_data.keyLink) + '"' : '') + '>' + opt_data.key + '</a></span>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.singleIssueLoading.soyTemplateName = 'bamboo.feature.jiraIssueList.singleIssueLoading';
}


bamboo.feature.jiraIssueList.singleIssueOAuth = function(opt_data, opt_ignored) {
  return '' + bamboo.feature.jiraIssueList.singleIssueRetrievalError({key: opt_data.key, keyLink: opt_data.keyLink, errorDetails: '' + bamboo.feature.jiraIssueList.linkedIssueOAuth({authenticationRedirectUrl: opt_data.authenticationRedirectUrl, authenticationInstanceName: opt_data.authenticationInstanceName, reason: 'to see issue details'})});
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.singleIssueOAuth.soyTemplateName = 'bamboo.feature.jiraIssueList.singleIssueOAuth';
}


bamboo.feature.jiraIssueList.singleIssueRetrievalError = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<span class="single-issue-retrieval-error"' + ((opt_data.key) ? ' data-key="' + opt_data.key + '"' : '') + '>' + ((opt_data.key) ? '<a' + ((opt_data.keyLink) ? ' href="' + soy.$$escapeHtml(opt_data.keyLink) + '"' : '') + '>' + opt_data.key + '</a>' : '') + '<span class="error-message' + ((! opt_data.errorDetails) ? ' unspecified' : '') + '">' + ((opt_data.errorDetails) ? soy.$$filterNoAutoescape(opt_data.errorDetails) : soy.$$escapeHtml("Could not obtain issue details from JIRA")) + '</span></span>';
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.singleIssueRetrievalError.soyTemplateName = 'bamboo.feature.jiraIssueList.singleIssueRetrievalError';
}


bamboo.feature.jiraIssueList.linkedIssueOAuth = function(opt_data, opt_ignored) {
  return '<a class="oauth-init" href="' + soy.$$escapeHtml(opt_data.authenticationRedirectUrl) + '">Authenticate</a> ' + ((opt_data.authenticationInstanceName) ? ' with ' + soy.$$escapeHtml(opt_data.authenticationInstanceName) : '') + ' ' + soy.$$escapeHtml(opt_data.reason);
};
if (goog.DEBUG) {
  bamboo.feature.jiraIssueList.linkedIssueOAuth.soyTemplateName = 'bamboo.feature.jiraIssueList.linkedIssueOAuth';
}
;
;
/* module-key = 'bamboo.web.resources:autocomplete-controls', location = '/widget/autocomplete-controls/aui/progressive-data-set.js' */
AJS.ProgressiveDataSet = Backbone.Collection.extend({
    initialize: function(models, options) {
        options || (options = {});
        if (options.matcher) this.matcher = options.matcher;
        if (options.model) this.model = options.model; // Fixed in backbone 0.9.2
        this._idAttribute = (new this.model()).idAttribute;
        this._maxResults = options.maxResults || 5;
        this._queryData = options.queryData || {};
        this._queryParamKey = options.queryParamKey || "q";
        this._queryEndpoint = options.queryEndpoint || "";
        this._allowEmptyQuery = (typeof options.allowEmptyQuery != 'undefined' ? options.allowEmptyQuery : false);
        this._matchAnyOnEmptyQuery = (typeof options.matchAnyOnEmptyQuery != 'undefined' ? options.matchAnyOnEmptyQuery : true);
        this.value = null;
        this.queryCache = {};
        this.activeQueryCount = 0;
        _.bindAll(this, 'query', 'respond');
    },

    url: function() {
        return this._queryEndpoint;
    },

    query: function(query) {
        var remote, results;

        this.value = query;
        results = this.getFilteredResults(query);
        this.respond(query, results);

        if (!this._queryEndpoint ||
            (query && (this.hasQueryCache(query) || !this.shouldGetMoreResults(results))) ||
            (!query && !(this._allowEmptyQuery && this.shouldGetMoreResults(results)))
            ) {
            return;
        }

        remote = this.fetch(query);

        this.activeQueryCount++;
        this.trigger('activity', { activity: true });
        remote.always(_.bind(function() {
            this.activeQueryCount--;
            this.trigger('activity', { activity: !!this.activeQueryCount });
        }, this));

        remote.done(_.bind(function(resp, succ, xhr) {
            this.addQueryCache(query, resp, xhr);
        }, this));
        remote.done(_.bind(function() {
            query = this.value;
            results = this.getFilteredResults(query);
            this.respond(query, results);
        }, this));
    },

    getQueryData: function(query) {
        var params = _.isFunction(this._queryData) ? this._queryData(query) : this._queryData;
        var data = _.extend({}, params);
        data[this._queryParamKey] = query;
        return data;
    },

    fetch: function(query) {
        var data = this.getQueryData(query);
        // {add: true} for Backbone <= 0.9.2
        // {update: true, remove: false} for Backbone >= 0.9.9
        var params = { add : true, update : true, remove : false, data : data };
        var remote = Backbone.Collection.prototype.fetch.call(this, params);
        return remote;
    },

    respond: function(query, results) {
        this.trigger('respond', {
            query: query,
            results: results
        });
        return results;
    },

    matcher: function(item, query) { },

    getFilteredResults: function(query) {
        var results = [];
        if (!query && !this._matchAnyOnEmptyQuery) return results;
        results = this.filter(function(item) {
            return (true == this.matcher(item, query) || !query && this._matchAnyOnEmptyQuery);
        }, this);
        if (this._maxResults) {
            results = _.first(results, this._maxResults);
        }
        return results;
    },

    addQueryCache: function(query, response, xhr) {
        var cache = this.queryCache;
        var results = this.parse(response, xhr);
        cache[query] = _.pluck(results, this._idAttribute);
    },

    hasQueryCache: function(query) {
        return this.queryCache.hasOwnProperty(query);
    },

    findQueryCache: function(query) {
        return this.queryCache[query];
    },

    shouldGetMoreResults: function(results) {
        return results.length < this._maxResults;
    },

    setMaxResults: function(number) {
        this._maxResults = number;
        this.value && this.respond(this.value, this.getFilteredResults(this.value));
    }
});;
;
/* module-key = 'bamboo.web.resources:autocomplete-controls', location = '/widget/autocomplete-controls/aui/query-input.js' */
AJS.QueryInput = Backbone.View.extend({
    initialize: function(options) {
        _.bindAll(this, 'changed', 'val');
        this._lastValue = this.val();
        this.$el.bind('keyup focus', this.changed);
    },
    val: function () {
        if (arguments.length) { this._lastValue = arguments[0]; } // difference to AUI
        return this.$el.val.apply(this.$el, arguments);
    },
    changed: function() {
        if (this._lastValue != this.val()) {
            this.trigger('change', this.val());
            this._lastValue = this.val();
        }
    }
});;
;
/* module-key = 'bamboo.web.resources:autocomplete-controls', location = '/widget/autocomplete-controls/aui/query-result.js' */
AJS.ResultSet = Backbone.Model.extend({
    initialize: function(options) {
        this.set('active', null, {silent: true});
        this.collection = new Backbone.Collection();
        this.collection.bind('reset', this.setActive, this);
        this.source = options.source;
        this.source.bind('respond', this.process, this);
    },

    url: false,

    process: function(response) {
        this.set('query', response.query);
        this.collection.reset(response.results);
        this.set('length', response.results.length);
        this.trigger('update', this);
    },

    setActive: function() {
        var id = (arguments[0] instanceof Backbone.Collection) ? false : arguments[0];
        var model = (id) ? this.collection.get(id) : this.collection.first();
        this.set('active', model || null);
        return this.get('active');
    },

    next: function() {
        var current = this.collection.indexOf(this.get('active'));
        var i = (current + 1) % this.get('length');
        var next = this.collection.at(i);
        return this.setActive(next && next.id);
    },

    prev: function() {
        var current = this.collection.indexOf(this.get('active'));
        var i = ((current === 0) ? this.get('length') : current) - 1;
        var prev = this.collection.at(i);
        return this.setActive(prev && prev.id);
    },

    each: function() {
        return this.collection.each.apply(this.collection, arguments);
    }
});

AJS.ResultsList = Backbone.View.extend({
    events: {
        "click [data-id]": "setSelection"
    },

    initialize: function (options) {
        if (!this.model) {
            this.model = new AJS.ResultSet({ source: options.source });
        }
        if (!(this.model instanceof AJS.ResultSet)) {
            throw new Error('model must be set to a ResultSet');
        }
        this.model.bind('update', this.process, this);

        this.render = _.wrap(this.render, function(func) {
            this.trigger('rendering');
            func.apply(this, arguments);
            this.trigger('rendered');
        });
    },

    process: function() {
        if (!this._shouldShow(this.model.get('query'))) return;
        this.show();
    },

    render: function() {
        var ul, listItems = [];
        this.model.each(function(model) {
            var li = Backbone.$('<li/>').attr('data-id', model.id).html(this.renderItem(model));
            listItems.push(li);
        }, this);
        ul = Backbone.$('<ul/>').html(listItems);
        this.$el.html(ul);
        return this;
    },

    renderItem: function() {
        return;
    },

    setSelection: function(event) {
        var id = Backbone.$(event.target).closest('li[data-id]').data("id");
        var selected = this.model.setActive(id);
        this.trigger('selected', selected);
    },

    show: function() {
        this.lastQuery = this.model.get('query');
        this._hiddenQuery = null;
        this.render();
        this.$el.show();
        this.trigger('shown');
    },

    hide: function() {
        this.$el.hide();
        this._hiddenQuery = this.lastQuery;
        this.trigger('hidden');
    },

    size: function() {
        return this.model.get('length');
    },

    _shouldShow: function(query) {
        return query === '' || !(this._hiddenQuery && this._hiddenQuery === query);
    }

});;
;
/* module-key = 'bamboo.web.resources:autocomplete', location = '/widget/autocomplete-controls/bamboo/single-select.js' */
define('widget/single-select', [
    'jquery',
    'underscore',
    'backbone'
], function(
    $,
    _,
    Backbone
) {

    'use strict';

    var SingleSelectResultView = AJS.ResultsList.extend({
        events: function() {
            // Required because Backbone doesn't easily support
            // adding event to the event object when extending a View, it just replaces them
            return _.extend({}, AJS.ResultsList.prototype.events, {
                'hover [data-id]': 'setActive',
                mouseenter: 'setContainerActive',
                mouseleave: 'setContainerInactive'
            });
        },
        process: function() {
            if (!this.size() && !this.model.get('query')) {
                this.hide();
            } else {
                this.show();
            }
        },
        render: function() {
            var $ul = jQuery('<ul/>');
            if (this.size()) {
                this.model.each(function(model) {
                    var $li = jQuery('<li/>', {
                        'data-id': model.id,
                        html: this.renderItem(model)
                    });
                    $li.attr('title', $li.text());
                    $ul.append($li);
                }, this);
            } else {
                jQuery('<li/>', {
                    'class': 'autocomplete-nomatch',
                    text: "No matches"
                }).appendTo($ul);
            }
            this.$el.html($ul);
            return this;
        },
        setActive: function(event) {
            var id = jQuery(event.target).closest('li[data-id]').data('id');
            this.model.setActive(id);
        },
        isContainerActive: function() {
            return !!this._containerActive;
        },
        setContainerActive: function() {
            this._containerActive = true;
        },
        setContainerInactive: function() {
            this._containerActive = false;
        }
    });

    var SingleSelectInputDropdown = Backbone.View.extend({
        initialize: function() {
            this.render();
        },
        _loadingClass: 'loading',
        tagName: 'span',
        className: 'icon bamboo-single-select-icon drop-menu',
        events: {
            mouseenter: 'setActive',
            mouseleave: 'setInactive'
        },
        render: function() {
            this.$el.html('<span>More</span>');
            return this;
        },
        isActive: function() {
            return !!this._active;
        },
        setActive: function() {
            this._active = true;
        },
        setInactive: function() {
            this._active = false;
        },
        setLoading: function(isLoading) {
            this.$el.toggleClass(this._loadingClass, isLoading);
        }
    });

    var SingleSelectField = Backbone.View.extend({
        initialize: function(options) {
            this.$original = options.$original;
            this.dropMenu = new SingleSelectInputDropdown();
            this.$placeholder = jQuery('<input type="text" autocomplete="off" class="bamboo-single-select-field text" />');
            this.render();
        },
        _hasIconClass: 'bamboo-single-select-has-entity-icon',
        render: function() {
            this.$el.removeClass('text'); // remove AUI field class names
            this.dropMenu.$el.appendTo(this.$el);
            this.$placeholder
                .attr('placeholder', this.$original.attr('placeholder') || '')
                .val(this.$original.attr('data-field-text') || this.$original.val())
                .prependTo(this.$el);
            this.setIcon(this.$original.attr('data-icon'));
            jQuery('label').filter('[for="' + this.$original.attr('id') + '"]').click(_.bind(function() {
                this.$placeholder.focus();
            }, this));

            return this;
        },
        addDropMenuEvents: function(events) {
            this.dropMenu.delegateEvents(_.extend(SingleSelectInputDropdown.prototype.events, events));
        },
        indicateActivity: function(ds) {
            this.dropMenu.setLoading(ds.activity);
        },
        setIcon: function(iconUrl) {
            this.$icon = this.$icon || jQuery('<div />', { 'class': 'bamboo-single-select-entity-icon' });
            if (iconUrl) {
                this.$icon.css('background-image', 'url(' + iconUrl + ')').appendTo(this.$el);
                this.$el.addClass(this._hasIconClass);
            } else {
                this.$icon.detach();
                this.$el.removeClass(this._hasIconClass);
            }
        }
    });

    var SingleSelect = Backbone.View.extend({
        initialize: function(options) {
            this._chosen = !!this.$el.data('chosen');
            this._activeClass = options.activeClass || 'active';
            this.datasource = new AJS.ProgressiveDataSet(options.bootstrap || [], {
                queryEndpoint: options.queryEndpoint,
                queryParamKey: options.queryParamKey,
                maxResults: options.maxResults,
                allowEmptyQuery: (typeof options.allowEmptyQuery != 'undefined' ? options.allowEmptyQuery : true),
                matchAnyOnEmptyQuery: options.matchAnyOnEmptyQuery,
                queryData: options.queryData
            });
            this.datasource.matcher = options.matcher;
            this.datasource.parse = options.parser;

            this.field = new SingleSelectField({
                className: 'bamboo-single-select ' + this.$el.attr('class'),
                $original: this.$el
            });

            this.queryInput = new AJS.QueryInput({ el: this.field.$placeholder });
            this.queryInput
                .on('change', this.datasource.query)
                .on('change', this.handleInputChange, this)
                .delegateEvents(_.extend(AJS.QueryInput.prototype.events || {}, {
                    keydown: _.bind(this.handleInputKeydown, this),
                    blur: _.bind(this.handleInputBlur, this),
                    focus: _.bind(this.handleInputFocus, this),
                    click: _.bind(this.requestMatches, this)
                }));

            var singleSelect = this;

            var ResultView = SingleSelectResultView.extend({
                renderItem: function(model) {
                    return options.resultItemTemplate(model.attributes);
                },
                process: function() {
                    if (!singleSelect.disableRendering)
                    {
                        SingleSelectResultView.prototype.process.call(this);
                    }
                    singleSelect.disableRendering = false;
                }
            });

            this.field.addDropMenuEvents({
                click: _.bind(function() {
                    this.queryInput.$el.focus();
                    if (this.queryResult.$el.is(':visible')) {
                        this.queryResult.hide();
                    } else {
                        this.requestMatches();
                    }
                }, this)
            });

            this.datasource.on('activity', this.field.indicateActivity, this.field);

            this.queryResult = new ResultView({ source: this.datasource });
            this.queryResult
                .on('selected', this.setValue, this)
                .on('rendered', this.highlightActive, this)
                .on('shown', this.indicateActive, this)
                .on('hidden', this.indicateInactive, this)
                .model.on('change:active', this.highlightActive, this);

            this.render();
        },
        render: function() {
            this.field.$el.insertBefore(this.$el.hide());
            this.queryResult.hide();
            this.queryResult.$el.addClass('autocomplete').appendTo(document.body);

            return this;
        },
        highlightActive: function() {
            var active = this.queryResult.model.get('active');
            var id = active && active.id;
            this.queryResult.$('li[data-id]').filter(function(i, li) {
                var $li = jQuery(li);
                var method = (id == $li.attr('data-id')) ? 'addClass' : 'removeClass';
                $li[method]('active');
            });
        },
        reset: function() {
            this.datasource.reset();
            this.setValue(null);
            this.trigger('reset');
        },
        setValue: function(model) {
            this.$el.val(model ? model.id : '');
            this.queryInput.val(model ? this.getDisplayValue(model) : '');
            this.field.setIcon(model ? this.getIconValue(model) : null);
            this.queryResult.hide();
            if (model) {
                this.queryInput.$el.focus();
                this._chosen = true;
                this.trigger('selected', model);
            } else {
                this._chosen = false;
            }
            // QueryResult and dropmenu being active prevents blurring the field,
            // so ensure we set them inactive if an option is chosen to allow taking focus from field
            this.queryResult.setContainerInactive();
            this.field.dropMenu.setInactive();
        },
        getDisplayValue: function(model) {
            return model.id;
        },
        getIconValue: function() {
            return null;
        },
        indicateActive: function() {
            this.queryInput.$el.addClass(this._activeClass);
        },
        indicateInactive: function() {
            this.queryInput.$el.removeClass(this._activeClass);
        },
        requestMatchesQuietly: function(callback) {
            this.requestMatches();

            this.datasource.once('sync',
                    _.bind(function()
                    {
                        callback();
                        this.disableRendering = true;
                    }, this));
        },
        requestMatches: function() {
            this.datasource.query(this._chosen ? '' : this.queryInput.val());
        },
        handleInputKeydown: function(e) {
            var active;
            if (this.queryResult.$el.is(':visible')) {
                switch (e.which) {
                    case jQuery.ui.keyCode.UP:
                        e.preventDefault();
                        this.queryResult.model.prev();
                        break;
                    case jQuery.ui.keyCode.DOWN:
                        e.preventDefault();
                        this.queryResult.model.next();
                        break;
                    case jQuery.ui.keyCode.ENTER:
                    case jQuery.ui.keyCode.TAB:
                        e.preventDefault();
                        active = this.queryResult.model.get('active');
                        if (active) {
                            this.queryResult.trigger('selected', active);
                        }
                        break;
                    case jQuery.ui.keyCode.ESCAPE:
                        e.stopPropagation();
                        this.queryResult.hide();
                        break;
                }
            } else if (e.which == jQuery.ui.keyCode.DOWN) {
                this.requestMatches();
            }
        },
        handleInputBlur: function() {
            if (this.field.dropMenu.isActive() || this.queryResult.isContainerActive()) {
                this.queryInput.$el.focus();
            } else {
                if (this.queryResult.$el.is(':visible')) {
                    this.queryResult.hide();
                }
            }
        },
        handleInputFocus: function() {
            var $input = this.queryInput.$el;
            var inputOffset = $input.offset();
            var inputWidth = $input.outerWidth();
            var inputHeight = $input.outerHeight();
            this.queryResult.$el.css({
                width: inputWidth,
                top: inputOffset.top + inputHeight,
                left: inputOffset.left
            });
            // setTimeout will fire after user has clicked in field to give it focus,
            // ensures text is always selected on focus
            setTimeout(function() {
                $input.select();
            });
        },
        handleInputChange: function() {
            this.$el.val(this.queryInput.val());
            this.field.setIcon(null);
            this._chosen = false;
        }
    });

    return SingleSelect;

});

/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('BAMBOO.SingleSelect', null, require('widget/single-select'));
};
;
/* module-key = 'bamboo.web.resources:autocomplete', location = '/widget/autocomplete-controls/bamboo/selected-set.js' */
define('widget/selected-list', [
    'jquery',
    'underscore',
    'backbone'
], function(
    $,
    _,
    Backbone
) {

    'use strict';

    var SelectedSet = Backbone.Model.extend({
        initialize: function(options) {
            this.collection = options.bootstrap instanceof Backbone.Collection
                ? options.bootstrap
                : new Backbone.Collection(options.bootstrap || []);
        },
        each: function() {
            return this.collection.each.apply(this.collection, arguments);
        },
        add: function(model) {
            this.collection.add(model);
        },
        remove: function(id) {
            this.collection.remove(this.collection.get(id));
        }
    });
    var SelectedList = Backbone.View.extend({
        events: {
            'click [data-id] .remove': 'removeItem'
        },
        initialize: function(options) {
            this.model = new SelectedSet({ bootstrap: options.bootstrap || [] });
            this.options = options;
            if (this.model.collection.length) {
                this.render();
            }
        },
        render: function() {
            var listItems = [];
            this.model.each(function(model) {
                var li = Backbone.$('<li/>').attr('data-id', model.id).html(this.renderItem(model));
                listItems.push(li);
            }, this);
            this.$el.toggleClass('empty', (this.model.collection.length === 0)).html(listItems);
            return this;
        },
        renderItem: function(model) {
            return this.options.itemTemplate(model.attributes);
        },
        fadeout: function() {
            jQuery('.multi-select-added').animate({
                 'background-color': 'transparent'
            }, 1500);
        },
        addItem: function(model) {
            this.model.add(model);
            this.render(model);
            this.fadeout();
        },
        removeItem: function(event) {
            var $item = jQuery(event.target).closest('[data-id]');
            this.model.remove($item.data('id'));
            $item.fadeOut(400, _.bind(function() {
                this.render();
            }, this));
        }

    });

    return SelectedList;
});
;
;
/* module-key = 'bamboo.web.resources:autocomplete', location = '/widget/autocomplete-controls/bamboo/user-autocomplete.js' */
define('widget/user-single-select', [
    'jquery',
    'underscore',
    'backbone',
    'widget/single-select'
], function(
    $,
    _,
    Backbone,
    SingleSelect
) {

    'use strict';

    var UserSingleSelect = Backbone.View.extend({
        initialize: function(options) {
            options || (options = {});
            var SingleSelectWrapper = SingleSelect.extend({
                getDisplayValue: this.getFilterValue,
                getIconValue: this.getIconValue
            });
            this.singleSelect = new SingleSelectWrapper({
                el: this.$el,
                bootstrap: options.bootstrap || [],
                maxResults: options.maxResults || 5,
                matcher: _.bind(this.matcher, this),
                parser: this.parser,
                resultItemTemplate: bamboo.widget.autocomplete.userItemResult,
                queryEndpoint: AJS.contextPath() + '/rest/api/latest/search/users?includeAvatars=true',
                queryParamKey: 'searchTerm',
                allowEmptyQuery: false
            });
            this.singleSelect.on('selected', this.handleSelection, this);
        },
        lCasePrefixMatch: function(str, prefix) {
            return (str.toLowerCase().indexOf(prefix.toLowerCase()) === 0);
        },
        matcher: function(user, query) {
            var matches = false;
            matches = matches || this.lCasePrefixMatch(user.get('username'), query);
            if (user.has('fullName')) {
                matches = matches || this.lCasePrefixMatch(user.get('fullName'), query);
            }
            if (user.has('displayableEmail')) {
                matches = matches || this.lCasePrefixMatch(user.get('displayableEmail'), query);
            }
            return matches;
        },
        parser: function(response) {
            return _.map(response.searchResults, function(result) {
                return result.searchEntity;
            });
        },
        handleSelection: function(user) {
            this.trigger('selected', user);
        },
        getFilterValue: function(user) {
            return user.get('fullName');
        },
        getIconValue: function(user) {
            return user.get('avatarUrl');
        }
    });

    return UserSingleSelect;
});
;
;
/* module-key = 'bamboo.web.resources:autocomplete', location = '/widget/autocomplete-controls/bamboo/plan-single-select.js' */
define('widget/plan-single-select', [
    'jquery',
    'underscore',
    'brace',
    'backbone',
    'widget/single-select',
    'util/events'
], function(
    $,
    _,
    Brace,
    Backbone,
    SingleSelect,
    events
) {

    'use strict';

    var PlanSingleSelect = Brace.View.extend({
        mixins: [events.EventBusMixin],
        initialize: function(options) {
            options || (options = {});

            var PlanSingleSelect = SingleSelect.extend({
                getDisplayValue: this.getFilterValue
            });

            this.singleSelect = new PlanSingleSelect({
                el: this.$el,
                bootstrap: options.bootstrap || [],
                maxResults: options.maxResults || 10,
                matcher: _.bind(this.matcher, this),
                parser: this.parser,
                resultItemTemplate: bamboo.widget.autocomplete.planItemResult,
                queryEndpoint: AJS.contextPath() + '/rest/api/latest/search/plans',
                queryParamKey: 'searchTerm'
            });

            if (this.singleSelect.queryInput.val()) {
                this.singleSelect.requestMatchesQuietly(_.bind(function() {
                    if (this.singleSelect.datasource.length) {
                        this.singleSelect.setValue(this.singleSelect.datasource.models[0]);
                    }
                }, this));
            }

            this.onEvent('branch:empty', this.onHideBranchOptions);
            this.singleSelect.on('selected', this.onHandleSelection, this);
            this.singleSelect.queryInput.on('change', this.onHandleSelection, this);
        },
        containsMatch: function(str, find) {
            return (str.toLowerCase().indexOf(find.toLowerCase()) > -1);
        },
        matcher: function(plan, query) {
            return this.containsMatch(this.getFilterValue(plan), query);
        },
        parser: function(response) {
            return _.map(response.searchResults, function(result) {
                return result.searchEntity;
            });
        },
        getFilterValue: function(model) {
            // > character is not escaped for a reason
            return model.get('projectName') + '  ' + model.get('planName');
        },
        onHandleSelection: function(model) {
            this.triggerEvent('plan:selected', model);

            if (model instanceof Backbone.Model) {
                this.$el.parents('.field-group').next().show();
            }
        },
        onHideBranchOptions: function() {
            this.$el.parents('.field-group').next().hide();
        }
    });

    return PlanSingleSelect;
});
;
;
/* module-key = 'bamboo.web.resources:autocomplete', location = '/widget/autocomplete-controls/bamboo/branch-autocomplete.js' */
define('widget/branch-single-select', [
    'jquery',
    'underscore',
    'backbone',
    'brace',
    'widget/single-select',
    'util/events'
], function(
    $,
    _,
    Backbone,
    Brace,
    SingleSelect,
    events
) {

    'use strict';

    var BranchSingleSelect = Brace.View.extend({
        mixins: [events.EventBusMixin],
        initialize: function(options) {
            options || (options = {});

            var ExtendedSingleSelect = SingleSelect.extend({
                getDisplayValue: this.getFilterValue
            });

            this.singleSelect = new ExtendedSingleSelect({
                el: this.$el,
                bootstrap: options.bootstrap || [],
                maxResults: options.maxResults || 10,
                matcher: _.bind(this.matcher, this),
                parser: this.parser,
                resultItemTemplate: bamboo.widget.autocomplete.branchItemResult,
                queryEndpoint: AJS.contextPath() + '/rest/api/latest/search/branches',
                queryParamKey: 'searchTerm',
                queryData: _.bind(this.generateAdditionalQueryData, this)
            });

            this.singleSelect.on('selected', this.handleSelection, this);
            this.singleSelect.queryInput.on('change', this.handleSelection, this);

            if (options.masterPlanKey) {
                this.masterPlanKey = options.masterPlanKey;
            }
            else if (options.masterPlanField) {
                this.masterPlanKey = options.masterPlanField.val();
            }
            else if (options.masterPlanPicker) {
                this.onEvent('plan:selected', this.onMasterPlanChange);
                this.masterPlanKey = options.masterPlanPicker.val();
            }

            if (!this.masterPlanKey) {
                this.singleSelect.$el.parent().hide();
            }
        },
        containsMatch: function(str, find) {
            return (str.toLowerCase().indexOf(find.toLowerCase()) > -1);
        },
        matcher: function(plan, query) {
            return this.containsMatch(this.getFilterValue(plan), query);
        },
        parser: function(response) {
            return _.map(response.searchResults, function(result) {
                return result.searchEntity;
            });
        },
        handleSelection: function(model) {
            this.trigger('selected', model);
        },
        getFilterValue: function(model) {
            return model.get('branchName');
        },
        generateAdditionalQueryData: function() {
            return { masterPlanKey: this.masterPlanKey, includeMasterBranch: this.options.includeMasterBranch };
        },
        // using global event-bus event handling (first argument is an instance)
        onMasterPlanChange: function(instance, masterModel) {
            this.singleSelect.reset();

            if (!(masterModel instanceof Backbone.Model)) {
                this.singleSelect.$el.parent().hide();
            }
            else {
                this.singleSelect.$el.parent().filter(':hidden').show();
                this.masterPlanKey = masterModel.get('key');

                var branchPickerContainer = this.options.branchPickerContainer;

                if (branchPickerContainer) {
                    this.singleSelect.requestMatchesQuietly(_.bind(function() {
                        var numberOfBranches = this.singleSelect.datasource.length;
                        if (this.options.includeMasterBranch) numberOfBranches--;
                        if (numberOfBranches) {
                            branchPickerContainer.show();

                            // select master branch
                            if (this.options.includeMasterBranch) {
                                this.singleSelect.setValue(this.singleSelect.datasource.models[0]);
                            }
                        } else {
                            branchPickerContainer.hide();
                        }
                    }, this));
                }
            }
        }
    });

    return BranchSingleSelect;
});
;
;
/* module-key = 'bamboo.web.resources:autocomplete', location = '/widget/autocomplete-controls/bamboo/project-autocomplete.js' */
define('widget/project-single-select', [
    'jquery',
    'underscore',
    'backbone',
    'widget/single-select'
], function(
    $,
    _,
    Backbone,
    SingleSelect
) {

    'use strict';

    var ProjectSingleSelect = Backbone.View.extend({
        initialize: function(options) {
            options || (options = {});
            this.singleSelect = new SingleSelect({
                el: this.$el,
                bootstrap: options.bootstrap || [],
                maxResults: options.maxResults || 5,
                matcher: _.bind(this.matcher, this),
                parser: this.parser,
                resultItemTemplate: bamboo.widget.autocomplete.projectItemResult,
                queryEndpoint: AJS.contextPath() + '/rest/api/latest/search/projects',
                queryParamKey: 'searchTerm'
            });
            this.singleSelect.on('selected', this.handleSelection, this);
        },
        containsMatch: function(str, find) {
            return (str.toLowerCase().indexOf(find.toLowerCase()) > -1);
        },
        matcher: function(plan, query) {
            var matches = false;
            matches = matches || this.containsMatch(plan.get('projectName'), query);
            return matches;
        },
        parser: function(response) {
            return _.map(response.searchResults, function(result) {
                return result.searchEntity;
            });
        },
        handleSelection: function(model) {
            this.trigger('selected', model);
        }
    });

    return ProjectSingleSelect;
});
;
;
/* module-key = 'bamboo.web.resources:autocomplete', location = '/widget/autocomplete-controls/bamboo/autocomplete.soy' */
// This file was automatically generated from autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.autocomplete == 'undefined') { bamboo.widget.autocomplete = {}; }


bamboo.widget.autocomplete.userItemResult = function(opt_data, opt_ignored) {
  return '<span>' + ((opt_data.avatarUrl) ? '<img src="' + soy.$$escapeHtml(opt_data.avatarUrl) + '" alt="" class="avatar" />' : '') + ((opt_data.fullName) ? soy.$$escapeHtml(opt_data.fullName) + ((opt_data.displayableEmail) ? ' - ' + soy.$$escapeHtml(opt_data.displayableEmail) : '') + ' (' + soy.$$escapeHtml(opt_data.username) + ')' : (opt_data.displayableEmail) ? soy.$$escapeHtml(opt_data.displayableEmail) + ' (' + soy.$$escapeHtml(opt_data.username) + ')' : soy.$$escapeHtml(opt_data.username)) + '</span>';
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.userItemResult.soyTemplateName = 'bamboo.widget.autocomplete.userItemResult';
}


bamboo.widget.autocomplete.planItemResult = function(opt_data, opt_ignored) {
  return '<span>' + soy.$$escapeHtml(opt_data.projectName) + ((opt_data.planName) ? ' &rsaquo; ' + soy.$$escapeHtml(opt_data.planName) : '') + '</span>';
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.planItemResult.soyTemplateName = 'bamboo.widget.autocomplete.planItemResult';
}


bamboo.widget.autocomplete.branchItemResult = function(opt_data, opt_ignored) {
  return '<span>' + soy.$$escapeHtml(opt_data.branchName) + '</span>';
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.branchItemResult.soyTemplateName = 'bamboo.widget.autocomplete.branchItemResult';
}


bamboo.widget.autocomplete.projectItemResult = function(opt_data, opt_ignored) {
  return '<span>' + soy.$$escapeHtml(opt_data.projectName) + '</span>';
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.projectItemResult.soyTemplateName = 'bamboo.widget.autocomplete.projectItemResult';
}


bamboo.widget.autocomplete.variableItemResult = function(opt_data, opt_ignored) {
  return '<span>' + soy.$$escapeHtml(opt_data.key) + '</span>';
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.variableItemResult.soyTemplateName = 'bamboo.widget.autocomplete.variableItemResult';
}
;
;
/* module-key = 'bamboo.web.resources:variable-multiselect', location = '/widget/autocomplete-controls/bamboo/variables/variable-singleselect.js' */
define('widget/variable-single-select', [
    'jquery',
    'underscore',
    'backbone',
    'widget/single-select'
], function(
    $,
    _,
    Backbone,
    SingleSelect
) {

    'use strict';

    /* currently only supports pre-bootstrapped data.  No rest end point. */
    var VariableSingleSelect = Backbone.View.extend({
        initialize: function(options) {
            options || (options = {});
            this.singleSelect = new SingleSelect({
                el: this.$el,
                bootstrap: options.bootstrap ? _.map(options.bootstrap, function(variable) {
                    return $.extend(true, variable, {id: variable.key});
                }) : [],
                maxResults: options.maxResults || 5,
                matcher: _.bind(this.matcher, this),
                resultItemTemplate: bamboo.widget.autocomplete.variableItemResult
            });
            this.singleSelect.on('selected', this.handleSelection, this);
        },
        containsMatch: function(str, find) {
            return (str.toLowerCase().indexOf(find.toLowerCase()) > -1);
        },
        matcher: function(variable, query) {
            var matches = false;
            matches = matches || this.containsMatch(variable.get('key'), query);
            return matches;
        },
        handleSelection: function(model) {
            this.$el.trigger('selected', model);
        }
    });

    return VariableSingleSelect;
});
;
;
/* module-key = 'bamboo.web.resources:variable-multiselect', location = '/widget/autocomplete-controls/bamboo/variables/variable-multiselect.js' */
define('widget/variable-multi-select', [
    'jquery',
    'underscore',
    'backbone',
    'widget/variable-single-select',
    'widget/selected-list'
], function(
    $,
    _,
    Backbone,
    VariableSingleSelect,
    SelectedList
) {

    'use strict';

    var VariableMultiSelect = Backbone.View.extend({
        initialize: function(options) {
            this.variableSelect = new VariableSingleSelect({
                el: this.$el,
                bootstrap: options.bootstrap || [],
                maxResults: 10
            });
            this.variableSelect.on('selected', this.handleSelection, this);

            this.selectedVariables = new SelectedList({
                el: options.selectedVariablesEl,
                bootstrap: options.selectedVariables ? _.map(options.selectedVariables, function(variable) {
                    return $.extend(true, variable, {id: variable.key});
                }) : [],
                itemTemplate: bamboo.widget.autocomplete.variableSelect.item
            });
        },
        handleSelection: function(model) {
            this.selectedVariables.addItem(model);
            this.variableSelect.singleSelect.setValue('');
        }
    });

    return VariableMultiSelect;
});
;
;
/* module-key = 'bamboo.web.resources:variable-multiselect', location = '/widget/autocomplete-controls/bamboo/variables/variable-multiselect.soy' */
// This file was automatically generated from variable-multiselect.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.autocomplete.variableSelect.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.autocomplete == 'undefined') { bamboo.widget.autocomplete = {}; }
if (typeof bamboo.widget.autocomplete.variableSelect == 'undefined') { bamboo.widget.autocomplete.variableSelect = {}; }


bamboo.widget.autocomplete.variableSelect.list = function(opt_data, opt_ignored) {
  var output = '<ul class="' + soy.$$escapeHtml(opt_data.variablesToAutoIncrement.length == 0 ? 'empty' : '') + aui.renderExtraClasses(opt_data) + '">';
  var variableList7 = opt_data.variablesToAutoIncrement;
  var variableListLen7 = variableList7.length;
  for (var variableIndex7 = 0; variableIndex7 < variableListLen7; variableIndex7++) {
    var variableData7 = variableList7[variableIndex7];
    output += '<li data-id="' + soy.$$escapeHtml(variableData7.key) + '">' + bamboo.widget.autocomplete.variableSelect.item(variableData7) + '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.variableSelect.list.soyTemplateName = 'bamboo.widget.autocomplete.variableSelect.list';
}


bamboo.widget.autocomplete.variableSelect.item = function(opt_data, opt_ignored) {
  return soy.$$escapeHtml(opt_data.key) + '<a class="remove"></a><input type="hidden" name="variablesToAutoIncrement" value="' + soy.$$escapeHtml(opt_data.key) + '" />';
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.variableSelect.item.soyTemplateName = 'bamboo.widget.autocomplete.variableSelect.item';
}
;
;
/* module-key = 'bamboo.web.resources:status-widgets', location = '/widget/status/status.soy' */
// This file was automatically generated from status.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.status.
 */

if (typeof widget == 'undefined') { var widget = {}; }
if (typeof widget.status == 'undefined') { widget.status = {}; }


widget.status.deploymentResultStatusLozenge = function(opt_data, opt_ignored) {
  var output = '';
  var colour__soy3 = '';
  if (opt_data.lifeCycleState == 'FINISHED') {
    switch (opt_data.deploymentState) {
      case 'UNKNOWN':
        colour__soy3 += 'current';
        break;
      case 'SUCCESS':
        colour__soy3 += 'success';
        break;
      case 'FAILED':
        colour__soy3 += 'error';
        break;
    }
  } else {
    switch (opt_data.lifeCycleState) {
      case 'PENDING':
        colour__soy3 += 'complete';
        break;
      case 'QUEUED':
        colour__soy3 += 'complete';
        break;
      case 'IN_PROGRESS':
        colour__soy3 += 'complete';
        break;
      case 'NOT_BUILT':
        colour__soy3 += 'current';
        break;
    }
  }
  var text__soy23 = '';
  if (opt_data.lifeCycleState == 'FINISHED') {
    switch (opt_data.deploymentState) {
      case 'UNKNOWN':
        text__soy23 += 'Unknown';
        break;
      case 'SUCCESS':
        text__soy23 += 'Success';
        break;
      case 'FAILED':
        text__soy23 += 'Failed';
        break;
    }
  } else {
    switch (opt_data.lifeCycleState) {
      case 'PENDING':
        text__soy23 += 'Queued';
        break;
      case 'QUEUED':
        text__soy23 += 'Queued';
        break;
      case 'IN_PROGRESS':
        text__soy23 += 'In Progress';
        break;
      case 'NOT_BUILT':
        text__soy23 += 'Not Built';
        break;
    }
  }
  output += widget.lozenges.auilozenge({colour: colour__soy3, text: text__soy23, subtle: opt_data.subtle});
  return output;
};
if (goog.DEBUG) {
  widget.status.deploymentResultStatusLozenge.soyTemplateName = 'widget.status.deploymentResultStatusLozenge';
}


widget.status.buildResultStatusIcon = function(opt_data, opt_ignored) {
  var output = '';
  var class__soy48 = '' + widget.status.buildResultStatusClass(opt_data);
  output += widget.icons.statusIcon({status: class__soy48});
  return output;
};
if (goog.DEBUG) {
  widget.status.buildResultStatusIcon.soyTemplateName = 'widget.status.buildResultStatusIcon';
}


widget.status.buildResultStatusClass = function(opt_data, opt_ignored) {
  return '' + ((opt_data.resultSummary.continuable && opt_data.resultSummary.successful) ? 'SuccessfulPartial' : (opt_data.resultSummary.notRunYet) ? 'NotRunYet' : (opt_data.resultSummary.finished) ? soy.$$escapeHtml(opt_data.resultSummary.buildState) : soy.$$escapeHtml(opt_data.resultSummary.lifeCycleState));
};
if (goog.DEBUG) {
  widget.status.buildResultStatusClass.soyTemplateName = 'widget.status.buildResultStatusClass';
}


widget.status.statusRibbon = function(opt_data, opt_ignored) {
  var output = '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="status-ribbon' + aui.renderExtraClasses(opt_data) + '" data-statuses="' + soy.$$escapeHtml(opt_data.statuses.length) + '"' + aui.renderExtraAttributes(opt_data) + '><div class="status-ribbon-inner">';
  var statusList77 = opt_data.statuses;
  var statusListLen77 = statusList77.length;
  for (var statusIndex77 = 0; statusIndex77 < statusListLen77; statusIndex77++) {
    var statusData77 = statusList77[statusIndex77];
    output += widget.status.statusRibbonItem(statusData77);
  }
  output += '</div>' + ((opt_data.progressbarContent) ? '<div class="status-ribbon-progress-bar">' + soy.$$filterNoAutoescape(opt_data.progressbarContent) + '</div>' : '') + '</div>';
  return output;
};
if (goog.DEBUG) {
  widget.status.statusRibbon.soyTemplateName = 'widget.status.statusRibbon';
}


widget.status.statusRibbonItem = function(opt_data, opt_ignored) {
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="status-ribbon-status ' + soy.$$escapeHtml(opt_data.state) + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><' + soy.$$escapeHtml(opt_data.headingTagName ? opt_data.headingTagName : 'h2') + ' class="status-ribbon-status-heading">' + widget.icons.statusIcon({status: opt_data.state, reversed: true}) + ' ' + soy.$$filterNoAutoescape(opt_data.content) + '</' + soy.$$escapeHtml(opt_data.headingTagName ? opt_data.headingTagName : 'h2') + '></div>';
};
if (goog.DEBUG) {
  widget.status.statusRibbonItem.soyTemplateName = 'widget.status.statusRibbonItem';
}


widget.status.deploymentVersionStatus = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.deploymentVersionState && opt_data.deploymentVersionState != 'UNKNOWN') ? widget.lozenges.auilozenge({colour: '' + ((opt_data.deploymentVersionState == 'BROKEN' || opt_data.deploymentVersionState == 'INCOMPLETE') ? 'error' : 'success'), text: opt_data.deploymentVersionState, subtle: opt_data.subtle, extraClasses: 'version-lozenge'}) : '');
};
if (goog.DEBUG) {
  widget.status.deploymentVersionStatus.soyTemplateName = 'widget.status.deploymentVersionStatus';
}


widget.status.deploymentVersionStatusInfo = function(opt_data, opt_ignored) {
  return '' + ((opt_data.deploymentVersionState == 'APPROVED' || opt_data.deploymentVersionState == 'BROKEN') ? '<div class="detailed-version-info-container reviewed-user-avatar">' + aui.avatar.avatar({size: 'small', avatarImageUrl: opt_data.avatar ? opt_data.avatar : "" + '/images/icons/useravatar.png', accessibilityText: opt_data.userName ? opt_data.userName : "Anonymous user", title: opt_data.displayName ? opt_data.displayName : "Anonymous user", badgeContent: '' + ((opt_data.deploymentVersionState == 'BROKEN') ? '<span class="badge reviewed broken"></span>' : (opt_data.deploymentVersionState == 'APPROVED') ? '<span class="badge reviewed approved"></span>' : '')}) + '<script>AJS.$(".aui-avatar-inner > img").tooltip({gravity: \'n\'});<\/script></div>' : '');
};
if (goog.DEBUG) {
  widget.status.deploymentVersionStatusInfo.soyTemplateName = 'widget.status.deploymentVersionStatusInfo';
}
;
;
/* module-key = 'bamboo.web.resources:tooltip-widget', location = '/widget/tooltip/tooltip.soy' */
// This file was automatically generated from tooltip.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.tooltip.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.tooltip == 'undefined') { bamboo.widget.tooltip = {}; }


bamboo.widget.tooltip.tooltip = function(opt_data, opt_ignored) {
  return '<script type="text/javascript">require([\'aui\', \'jquery\', \'underscore\'], function(AJS, $, _){var $element = $(\'' + soy.$$escapeHtml(opt_data.trigger) + '\'); AJS.InlineDialog( $element, undefined' + ((opt_data.url) ? ',\'' + soy.$$escapeHtml("") + soy.$$escapeJsString(opt_data.url) + '\'' : ',function(content, trigger, showPopup){content .css({padding: \'20px\'}) .html(_.unescape(\'' + soy.$$escapeHtml(opt_data.content) + '\')); showPopup(); return false;}') + ',{' + ((opt_data.width) ? ' width: ' + soy.$$escapeHtml(opt_data.width) + ' ' : '') + ((opt_data.showDelay) ? ' ' + ((opt_data.width) ? ',' : '') + ' showDelay: ' + soy.$$escapeHtml(opt_data.showDelay) : '') + ((opt_data.width || opt_data.showDelay) ? ',' : '') + ' onHover: true});' + ((opt_data.addMarker) ? '$element.addClass(\'tooltip-marker\');' : '') + '});<\/script>';
};
if (goog.DEBUG) {
  bamboo.widget.tooltip.tooltip.soyTemplateName = 'bamboo.widget.tooltip.tooltip';
}
;
;
/* module-key = 'bamboo.web.resources:variables', location = '/feature/variables/variables.js' */
define('feature/variables', [
    'jquery',
    'underscore',
    'widget/dialog',
    'widget/variable-single-select',
    'exports'
], function(
    $,
    _,
    Dialog,
    VariableSingleSelect,
    exports
) {

    'use strict';

    /**
     * Array of keywords to determine whether a variable should be masked. Lazily initialised by #isPasswordVariable
     * function.
     */
    var passwordKeywords;

    /**
     * A function that determines whether a variable should be masked.
     * @param variableName name of the variable
     * @returns {boolean}
     */
    var isPasswordVariable = function(variableName) {
        if (!passwordKeywords) {
            var resourceKey = 'bamboo.web.resources:variables.password-variable-keywords';
            passwordKeywords = _.map(WRM.data.claim(resourceKey), function(keyword) {
                return keyword.toLowerCase();
            });
        }
        var lcVariableName = (variableName || '').toLowerCase();
        return passwordKeywords.some(function(keyword) {
            return lcVariableName.indexOf(keyword) >= 0;
        });
    };

    /**
     * Inline Editing
     * @param options
     *  - target        String - selector targeting the span/element to make inline-editable
     *  - submit        Function - handles what to do when value is submitted
     *  - cancel        Function - handles what to do when cancel is triggered
     *  - focus         Function - handles what to do when focus is given to the edit field
     *  - $delegator    jQuery Object - where the event handler should be bound
     */
    var inlineEdit = function(options) {
        var defaults = {
                target: null,
                submit: null,
                cancel: null,
                focus: null
            },
            handleEdit = function(event) {
                var $target = $(this);
                var $row = $target.parents('tr:first');

                if (!keyIsPassword($row)) {
                    prepareRow($row, $target);
                }
                // field contains password
                else {
                    prepareRow($row, $target, true,
                        _.bind(function() {
                            var keyElement = $row.find('td:eq(0) .inline-edit-field');
                            var $input = $target.siblings('div.input-password');

                            keyElement.trigger('selected', !!$input.length);
                        }, this)
                    );
                }

                event.preventDefault();
            },
            handleKeyDown = function(event) {
                var keyCode = event.which;
                var $element = $(event.currentTarget);

                // on ESCAPE revert current changes
                if (keyCode === $.ui.keyCode.ESCAPE) {
                    revertRow($element.blur().parents('tr:first'));
                    event.preventDefault();
                }
                // on ENTER apply current changes
                else if (keyCode === $.ui.keyCode.ENTER) {
                    updateRow($element.blur().parents('tr:first'));
                    event.preventDefault();
                }
            },
            prepareRow = function($row, $target, clearValue, callback) {
                // update currently active row
                options.$delegator.find('tr.active').each(function() {
                    revertRow($(this));
                });

                // find elements
                var $elements = $row.find('.inline-edit-view');
                var elementsCount = $elements.length;

                $elements.each(function(index) {
                    var $target = $(this);
                    var $input = $target.parent('td:first').find('.inline-edit-field:text');

                    // set current value
                    $input.val($target.text());

                    // clear value for last element if flag was set
                    if (clearValue && (elementsCount - 1) === index) {
                        $input.val('');
                    }

                    if (!$input.data('hasInlineEditHandlers')) {
                        $input.keydown(handleKeyDown)
                            .data('hasInlineEditHandlers', true)
                            .data('lastValidValue', $input.val());
                    }

                    $target.hide();
                    $input.parent().removeClass('hidden');
                });

                if ($.isFunction(options.focus)) {
                    options.focus($target);
                }

                // focus on first input field (which was clicked)
                $target.parent().find('.inline-edit-field').addClass('focus').focus();

                if ($.isFunction(callback)) {
                    callback();
                }
            },
            revertRow = function($row) {
                // activate first row
                options.$delegator.find('tr.inactive').removeClass('inactive');

                // cancel callback
                if ($.isFunction(options.cancel)) {
                    options.cancel($row.find('td:eq(0) input:visible'));
                }

                // reset styles and behaviour
                $row.removeClass('active')
                    .find('.inline-edit-view, .inline-edit-field')
                    .attr('style', '');

                $row.find('td:eq(1) .input-password').addClass('hidden');
            },
            updateRow = function($row) {
                if (!$.isFunction(options.submit)) {
                    updateRowSuccess();
                }
                // submit callback
                else {
                    options.submit($row.find('td:eq(1)').find('input:visible'), _.bind(function() {
                        updateRowSuccess($row);
                    }, this));
                }
            },
            updateRowSuccess = function($row) {
                var keyCell = $row.find('td:eq(0)');

                // is key value empty?
                if ($.trim(keyCell.find('input').val()).length > 0) {
                    // activate first row
                    options.$delegator.find('tr.inactive').removeClass('inactive');

                    // cancel callback
                    if ($.isFunction(options.cancel)) {
                        options.cancel(keyCell.find('input:visible'));
                    }

                    // reset styles and behaviour
                    $row.removeClass('active')
                        .find('.inline-edit-view, .inline-edit-field')
                        .attr('style', '');

                    keyCell.find('.inline-edit-view:first').text(
                        keyCell.find('.inline-edit-field:text').val()
                    );

                    // default password value
                    var value = '********';
                    var valueCell = $row.find('td:eq(1)');

                    valueCell.find('.input-password')
                        .addClass('hidden');

                    if (!keyIsPassword($row)) {
                        value = valueCell.find('.inline-edit-field:text').val();
                    }

                    $row.find('td:eq(1) .inline-edit-view:first').text(value);
                }
            },
            keyIsPassword = function($row) {
                var value = $.trim($row.find('.inline-edit-view:first').text());
                return isPasswordVariable(value);
            };

        options = $.extend(true, defaults, options);

        // append update handler
        options.$delegator.find('.operations button[name="update"]').on('click', function() {
            updateRow($(this).parents('tr:first'));
        });

        // append revert handler
        options.$delegator.find('.operations a.cancel-variable').on('click', function() {
            revertRow($(this).parents('tr:first'));
        });

        // revert current active TR if user click on .add-variable fields
        options.$delegator.find('tr.add-variable').on('click', 'input', _.bind(function() {
            var $active = options.$delegator.find('tr.active');

            if ($active.length) {
                revertRow($active);
                $(this).removeClass('inactive');
            }
        }, this));

        if (options.target) {
            options.$delegator.delegate(options.target, 'click', handleEdit);
        }
    };

    function VariablesTable(options) {
        if (!(this instanceof VariablesTable)) {
            return new VariablesTable(options);
        }

        var defaults = {
            selectors: {
                table: null,
                addRow: '.add-variable',
                deleteRow: '.delete-variable',
                overrideButton: 'a.variables-override'
            },
            templates: {
                row: null
            },
            availableVariables: null
        }, that = this;
        this.options = $.extend(true, defaults, options);

        this.$table = $(this.options.selectors.table)
            .on('click', this.options.selectors.deleteRow, function(e) {
                _.bind(that.handleDeleteClick, that)(this, e);
            })
            .on('click', this.options.selectors.overrideButton, _.bind(this.handleOverrideClick, this))
            .on('change', 'select', this.handleChangeVariableSelection);

        this.$addVariable = this.$table.find(this.options.selectors.addRow)
            .on('keydown', 'input:text, select', _.bind(this.handleAdd, this))
            .on('click', 'input:submit', _.bind(this.handleAdd, this));
    }

    VariablesTable.prototype = {
        handleAdd: function(e) {
            if (e.type == 'click' || e.which == jQuery.ui.keyCode.ENTER) {
                e.preventDefault();
                var $inputs = this.$addVariable.find(':input'),
                    key = $inputs.filter('[name="variableKey"]').val(),
                    value = $inputs.filter('[name="variableValue"]').val();

                $(AJS.template.load(this.options.templates.row).fill({
                    id: 'variable_' + key,
                    key: key,
                    value: value
                }).toString()).appendTo(this.$table.find('tbody'));
            }
        },
        handleChangeVariableSelection: function() {
            var $this = $(this),
                $option = $this.find('option:selected'),
                $text = $this.closest('tr').find('input:text, input:password'),
                id = $option.val(),
                hasPassword = isPasswordVariable(id);
            $this.prop('name', 'key_' + id);
            $text.prop('type', hasPassword ? 'password' : 'text');
            $text.prop('name', 'variable_' + id).val($option.get(0).getAttribute('data-current-value') || '');
        },
        handleDeleteClick: function(el, event) {
            var $this = $(el);
            var href = $this.attr('href');
            var self = this;

            event.preventDefault();

            // if in override mode (customised build) then just delete nearest TR
            if (!!this.overrideMode) {
                $this.closest('tr').remove();
            }
            // show confirmation dialog when deleting a record
            else {
                new Dialog({
                    header: "Delete a variable",
                    content: bamboo.feature.variables.deleteConfirmaton(),
                    height: 260,
                    width: 600,
                    buttons: [
                        {
                            id: 'confirm',
                            label: "Confirm",
                            cssClass: 'aui-button aui-button-primary',
                            params: {
                                self: self,
                                $this: $this,
                                href: href
                            },
                            callback: function(id, params) {
                                if (params.href) {
                                    $.post(params.href, { 'bamboo.successReturnMode': 'json', decorator: 'nothing', confirm: true }).done(_.bind(function(result) {
                                        if (params.self.resultStatusMatches(result, 'OK')) {
                                            if (!$('table[id=global-variable-config]').length) {
                                                var variable = {};
                                                variable.key = params.$this.data('variableKey');

                                                if (params.self.options.overriddenVariablesMap[variable.key]) {
                                                    var oldPicker = params.$this.closest('tbody').find('.bamboo-single-select');

                                                    if (oldPicker) {
                                                        oldPicker.remove();
                                                    }

                                                    params.self.options.globalNotOverriddenVariables.push(variable);

                                                    var variableSelect = new VariableSingleSelect({
                                                        el: '#variableKey',
                                                        bootstrap: params.self.options.globalNotOverriddenVariables
                                                    });

                                                    variableSelect.singleSelect.field.$placeholder.attr(
                                                        'placeholder', "Choose from global variables or type in your own"
                                                    );
                                                }
                                            }
                                            params.$this.closest('tr').remove();
                                        }
                                    }, params.self));
                                } else {
                                    params.$this.closest('tr').remove();
                                }

                                this.dialog.remove();
                            }
                        },
                        {
                            id: 'cancel',
                            label: "Cancel",
                            type: 'link'
                        }
                    ]
                });
            }
        },
        handleOverrideClick: function(e) {
            var $row = $(bamboo.feature.variables.variablesTableRow({
                id: '',
                key: '',
                value: '',
                availableVariables: this.options.availableVariables
            })).appendTo(this.$table.find('tbody'));

            this.handleChangeVariableSelection.call($row[0]);
            this.overrideMode = true;

            e.preventDefault();
        },
        resultStatusMatches: function(result, match) {
            return (result.status.toUpperCase() == match);
        }
    };

    function VariablesConfigurationForm(options) {
        if (!(this instanceof VariablesConfigurationForm)) {
            return new VariablesConfigurationForm(options);
        }

        var defaults = {
            selectors: {
                form: null,
                table: '.variables-list',
                addRow: '.add-variable',
                deleteRow: '.delete-variable'
            },
            templates: {
                row: null
            },
            classes: {
                active: 'active',
                inactive: 'inactive'
            },
            updateVariableUrl: null,
            overriddenVariablesMap: {},
            globalNotOverriddenVariables: []
        }, that = this;

        this.options = $.extend(true, defaults, options);
        this.cache = {};

        this.$form = $(this.options.selectors.form)
            .on('submit', _.bind(this.handleSubmit, this));
        this.$table = this.$form.find(this.options.selectors.table)
            .on('click', this.options.selectors.deleteRow, function(event) {
                _.bind(that.handleDeleteClick, that)(this, event);
            });

        this.$addVariable = this.$table.find(this.options.selectors.addRow)
            .on('change', 'select', this.handleChangeVariableSelection);

        // global table handler for input <> password fields
        this.$table.on('selected keyup', 'tr td:first-child input', function(event, focusValue) {
            _.bind(that.handleChangeVariableName, this)(that, focusValue);
        });

        inlineEdit({
            target: '.inline-edit-view',
            $delegator: this.$form,
            submit: _.bind(this.handleInlineSubmit, this),
            focus: _.bind(this.handleInlineFocus, this),
            cancel: _.bind(this.handleInlineCancel, this)
        });
    }

    VariablesConfigurationForm.prototype = new VariablesTable();

    $.extend(true, VariablesConfigurationForm.prototype, {
        clearFormErrors: function() {
            this.$form.find('.error,.aui-message').remove();
        },
        clearFieldErrors: function($field) {
            $field.nextAll('.error').remove();
        },
        resultFieldErrors: function(fieldErrors, func) {
            for (var fieldName in fieldErrors) {
                if (fieldErrors.hasOwnProperty(fieldName)) {
                    func(fieldName, fieldErrors[fieldName]);
                }
            }
        },
        handleChangeVariableSelection: function() {
            var $this = $(this),
                $option = $this.find('option:selected'),
                $text = $this.closest('tr').find('input:text');

            $text.val($option.get(0).getAttribute('data-current-value') || '');
        },
        handleChangeVariableName: function(self, focusValue) {
            var $this = $(this);
            var $tr = $this.parents('tr:first');
            var id = $tr.attr('id');

            var value = $.trim($this.val());
            var hasPassword = isPasswordVariable(value);

            // initialize cache object
            if (!self.cache[id]) {
                self.cache[id] = {};
            }

            // runs only once per row & then is cached
            if (_.isEmpty(self.cache[id])) {
                self.cache[id].varHasPassword = null;

                // always synchronize input & password field
                self.cache[id].$varInput = $tr.find('.variable-value input')
                    .on('keyup', _.bind(function() {
                        self.cache[id].$varPassword.val(
                            self.cache[id].$varInput.val()
                        );
                    }, $this));

                self.cache[id].$varPassword = $tr.find('.variable-value-password input')
                    .on('keyup', _.bind(function() {
                        self.cache[id].$varInput.val(
                            self.cache[id].$varPassword.val()
                        );
                    }, $this));

                // register toggle for show/hide password field
                self.cache[id].$varToggle = $tr.find('.input-password > button').on('click', _.bind(function(event) {
                    self.cache[id].$varInput.parent().toggleClass('hidden')
                        .find('button').toggleClass('hidden');

                    self.cache[id].$varPassword
                        .parent().toggleClass('hidden');

                    event.preventDefault();
                }, self));
            }

            // input contains variable to mask
            if (hasPassword) {
                self.cache[id].$varInput.parent().addClass('hidden');
                self.cache[id].$varPassword.val(self.cache[id].$varInput.val()).parent().removeClass('hidden');
                self.cache[id].varHasPassword = true;

                if (focusValue) {
                    self.cache[id].$varPassword.focus();
                }
            }
            else if (self.cache[id].varHasPassword !== false) {
                self.cache[id].$varInput.parent().removeClass('hidden').find('button').addClass('hidden');
                self.cache[id].$varPassword.parent().addClass('hidden');
                self.cache[id].varHasPassword = false;

                if (focusValue) {
                    self.cache[id].$varInput.focus();
                }
            }

            // focus variable key
            if (!_.isUndefined(focusValue) && !focusValue) {
                $this.focus();
            }
        },
        handleSubmit: function(e) {
            e.preventDefault();
            this.clearFormErrors();
            var formUrl = this.$form.attr('action'),
                data = this.$addVariable.find(':input').serialize() + '&'
                    + BAMBOO.XsrfUtils.getAtlTokenQueryParam(formUrl)
                    + '&bamboo.successReturnMode=json&decorator=nothing&confirm=true';
            $.post(formUrl, data, _.bind(function(result) {
                if (this.resultStatusMatches(result, 'OK')) {
                    window.location.reload();
                } else if (this.resultStatusMatches(result, 'ERROR')) {
                    var fieldErrors = result.fieldErrors,
                        errors = result.errors,
                        $firstError;

                    if (fieldErrors) {
                        this.resultFieldErrors(fieldErrors, _.bind(function(fieldName, fieldError) {
                            this.$addVariable.find(':input[name="' + fieldName + '"]').after(BAMBOO.buildFieldError(fieldError));
                        }, this));
                    }
                    if (errors) {
                        this.$form.prepend(BAMBOO.buildAUIErrorMessage(errors));
                    }
                    $firstError = this.$addVariable.find(':input:visible:enabled.errorField:first').focus();
                    if (!$firstError.length) {
                        this.$addVariable.find(':input:visible:enabled:first').focus();
                    }
                }
            }, this));
        },
        handleInlineSubmit: function($target, callback) {
            var $loading = $('<span/>', { 'class': 'icon icon-loading' }),
                name = $target.attr('name'),
                id, $key, $value;

            if (name.indexOf('key_') === 0) {
                id = BAMBOO.stripPrefixFromId('key_', name);
                $key = $target;
                $value = this.$form.find(':input[name="value_' + id + '"]');
            }
            else if (name.indexOf('value_') === 0) {
                id = BAMBOO.stripPrefixFromId('value_', name);
                $key = this.$form.find(':input[name="key_' + id + '"]');
                $value = $target;
            }

            if (id && $key && $value) {
                $loading.insertAfter($target[0]);
                this.clearFieldErrors($target);

                $.post(this.options.updateVariableUrl, BAMBOO.XsrfUtils.addXsrfTokenProperty(this.options.updateVariableUrl, {
                        variableId: id,
                        variableKey: $key.val(),
                        variableValue: $value.val(),
                        'bamboo.successReturnMode': 'json',
                        decorator: 'nothing',
                        confirm: true
                    })).done(_.bind(function(result) {
                        var fieldErrors = result.fieldErrors,
                            errors = result.errors,
                            $tr = $target.closest('tr');

                        $loading.remove();

                        if (!$tr.find('.focus').length) {
                            $tr.removeClass('active');
                        }
                        if (this.resultStatusMatches(result, 'OK')) {
                            $target.data('lastValidValue', $target.val());
                            var $div = $('#override_field_' + id);

                            $div.html($(bamboo.feature.variables.overrideText({
                                variable: this.options.overriddenVariablesMap[$key.val()]
                            })));

                            if (!this.$form.find('.focus').length) {
                                this.$addVariable
                                    .removeClass(this.options.classes.inactive)
                                    .find('input')
                                    .removeAttr('disabled');
                            }

                            if (callback) {
                                callback();
                            }
                        }
                        else if (this.resultStatusMatches(result, 'ERROR')) {
                            if (fieldErrors) {
                                this.resultFieldErrors(fieldErrors, _.bind(function(fieldName, fieldError) {
                                    var $field = (fieldName === 'variableValue' ? $value : $key);
                                    this.clearFieldErrors($field);
                                    $field.after(BAMBOO.buildFieldError(fieldError));
                                }, this));
                            }
                            if (errors) {
                                $key.after(BAMBOO.buildAUIErrorMessage(errors));
                            }
                        }

                        // update variable meta-data
                        $tr.find('td.variable-value-container')
                            .attr('data-variable-key', $key.val());

                    }, this)).fail(function() {
                        $loading.remove();
                        var error = ["Server error - variable not saved"];
                        $key.after(BAMBOO.buildFieldError(error));
                    });
            }
        },
        handleInlineFocus: function($target) {
            $target.closest('tr').addClass(this.options.classes.active);
            this.$addVariable.addClass(this.options.classes.inactive);
        },
        handleInlineCancel: function($target) {
            this.clearFieldErrors($target.closest('tr').removeClass(this.options.classes.active).end());
            this.$addVariable.removeClass(this.options.classes.inactive);
        }
    });

    exports.VariablesTable = VariablesTable;
    exports.VariablesConfigurationForm = VariablesConfigurationForm;

});
;
;
/* module-key = 'bamboo.web.resources:variables', location = '/feature/variables/variables.soy' */
// This file was automatically generated from variables.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.variables.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.variables == 'undefined') { bamboo.feature.variables = {}; }


bamboo.feature.variables.variablesTable = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var param28 = '' + ((! opt_data.hideAddHeader) ? '<tr class="add-variable"><td>' + bamboo.feature.variables.selectOrInput({id: 'variableKey', options: opt_data.availableVariables}) + '</td><td>' + bamboo.feature.variables.selectOrInput({id: 'variableValue', value: opt_data.firstAvailableVariable}) + '</td><td class="operations">' + aui.form.submit({text: "Add", id: ''}) + '</td></tr>' : '');
  if (opt_data.variables) {
    var variableList46 = opt_data.variables;
    var variableListLen46 = variableList46.length;
    for (var variableIndex46 = 0; variableIndex46 < variableListLen46; variableIndex46++) {
      var variableData46 = variableList46[variableIndex46];
      param28 += bamboo.feature.variables.variablesTableRow(soy.$$augmentMap(variableData46, {inlineEdit: opt_data.inlineEdit, availableVariables: opt_data.availableVariables, deleteVariableUrl: opt_data.deleteVariableUrl}));
    }
  }
  var output = '' + aui.table({extraClasses: 'variables-list', columnsContent: '<colgroup><col width="30%" /><col width="*" /><col width="60" /></colgroup>', theadContent: '<tr><th>' + soy.$$escapeHtml("Variable name") + '</th><th>' + soy.$$escapeHtml("Value") + '</th><th class="operations"><span class="assistive">' + soy.$$escapeHtml("Operations") + '</span></th></tr>', tfootContent: '' + ((opt_data.showOverrideFooter) ? '<tr>' + ((opt_data.userCanOverrideVariables) ? '<td colspan="3"><a class="aui-button aui-button-link aui-style variables-override">' + soy.$$escapeHtml("Override a variable") + '</a></td>' : '<td colspan="3"><span class="variables-override">' + soy.$$escapeHtml("Build variables override is forbidden") + '</span></td>') + '</tr>' : ''), content: param28});
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.variables.variablesTable.soyTemplateName = 'bamboo.feature.variables.variablesTable';
}


bamboo.feature.variables.variablesTableRow = function(opt_data, opt_ignored) {
  return '<tr data-variable-id="' + soy.$$escapeHtml(opt_data.id) + '"><td>' + ((opt_data.inlineEdit) ? bamboo.feature.variables.inPlaceEditField({id: 'key_' + opt_data.id, value: opt_data.key, options: opt_data.availableVariables}) : bamboo.feature.variables.selectOrInput({id: 'key_' + opt_data.id, value: opt_data.key, options: opt_data.availableVariables})) + '</td><td>' + ((opt_data.inlineEdit) ? bamboo.feature.variables.inPlaceEditField({id: 'value_' + opt_data.id, value: opt_data.value}) : bamboo.feature.variables.selectOrInput({id: 'value_' + opt_data.id, value: opt_data.key})) + '</td><td class="operations"><a id="deleteVariable_' + soy.$$escapeHtml(opt_data.id) + '" class="delete-variable"' + ((opt_data.deleteVariableUrl) ? ' href="' + soy.$$escapeHtml(opt_data.deleteVariableUrl) + '"' : '') + ' title="' + soy.$$escapeHtml("Delete") + '" tabindex="-1">' + aui.icons.icon({icon: 'remove', useIconFont: true, accessibilityText: "Delete", extraAttributes: {title: "Delete"}}) + '</a></td></tr>';
};
if (goog.DEBUG) {
  bamboo.feature.variables.variablesTableRow.soyTemplateName = 'bamboo.feature.variables.variablesTableRow';
}


bamboo.feature.variables.inPlaceEditField = function(opt_data, opt_ignored) {
  return '<span class="inline-edit-view"' + ((! opt_data.readonly) ? ' tabindex="0"' : '') + ' id="key_' + soy.$$escapeHtml(opt_data.id) + '">' + soy.$$escapeHtml(opt_data.value) + '</span>' + ((opt_data.readonly) ? aui.form.input({type: 'hidden', name: opt_data.id, value: opt_data.value}) : bamboo.feature.variables.selectOrInput(soy.$$augmentMap(opt_data, {extraClasses: 'inline-edit-field'})));
};
if (goog.DEBUG) {
  bamboo.feature.variables.inPlaceEditField.soyTemplateName = 'bamboo.feature.variables.inPlaceEditField';
}


bamboo.feature.variables.selectOrInput = function(opt_data, opt_ignored) {
  return '' + ((opt_data.options) ? bamboo.feature.variables.select({name: opt_data.id, options: opt_data.options, extraClasses: opt_data.extraClasses}) : aui.form.input({type: 'text', name: opt_data.id, value: opt_data.value, extraClasses: opt_data.extraClasses, extraAttributes: {autocomplete: 'off'}}));
};
if (goog.DEBUG) {
  bamboo.feature.variables.selectOrInput.soyTemplateName = 'bamboo.feature.variables.selectOrInput';
}


bamboo.feature.variables.passwordConfirmaton = function(opt_data, opt_ignored) {
  return '' + aui.message.warning({titleContent: "variables.password.dialog.title", content: '<p>' + soy.$$escapeHtml("variables.password.dialog.description") + '</p>'});
};
if (goog.DEBUG) {
  bamboo.feature.variables.passwordConfirmaton.soyTemplateName = 'bamboo.feature.variables.passwordConfirmaton';
}


bamboo.feature.variables.deleteConfirmaton = function(opt_data, opt_ignored) {
  return '' + aui.message.warning({titleContent: "Warning", content: '<p>' + soy.$$escapeHtml("You are about to delete the selected variable. Are you sure you want to continue?") + '</p>'});
};
if (goog.DEBUG) {
  bamboo.feature.variables.deleteConfirmaton.soyTemplateName = 'bamboo.feature.variables.deleteConfirmaton';
}


bamboo.feature.variables.select = function(opt_data, opt_ignored) {
  var output = '<select' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' name="' + ((opt_data.name) ? soy.$$escapeHtml(opt_data.name) : soy.$$escapeHtml(opt_data.id)) + '" class="' + soy.$$escapeHtml(opt_data.isMultiple ? 'multi-select' : 'select') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.size) ? ' size="' + soy.$$escapeHtml(opt_data.size) + '"' : '') + ((opt_data.isDisabled) ? ' disabled' : '') + ((opt_data.isMultiple) ? ' multiple' : '') + aui.renderExtraAttributes(opt_data) + '>';
  var optionList172 = opt_data.options;
  var optionListLen172 = optionList172.length;
  for (var optionIndex172 = 0; optionIndex172 < optionListLen172; optionIndex172++) {
    var optionData172 = optionList172[optionIndex172];
    output += bamboo.feature.variables.optionOrOptgroup(optionData172);
  }
  output += '</select>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.variables.select.soyTemplateName = 'bamboo.feature.variables.select';
}


bamboo.feature.variables.optionOrOptgroup = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.options) {
    output += '<optgroup label="' + soy.$$escapeHtml(opt_data.text) + '"' + aui.renderExtraAttributes(opt_data) + '>';
    var optionList184 = opt_data.options;
    var optionListLen184 = optionList184.length;
    for (var optionIndex184 = 0; optionIndex184 < optionListLen184; optionIndex184++) {
      var optionData184 = optionList184[optionIndex184];
      output += bamboo.feature.variables.optionOrOptgroup(optionData184);
    }
    output += '</optgroup>';
  } else {
    output += '<option value="' + soy.$$escapeHtml(opt_data.value) + '"' + aui.renderExtraAttributes(opt_data) + ((opt_data.selected) ? ' selected' : '') + '>' + soy.$$escapeHtml(opt_data.text) + '</option>';
  }
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.variables.optionOrOptgroup.soyTemplateName = 'bamboo.feature.variables.optionOrOptgroup';
}


bamboo.feature.variables.overrideText = function(opt_data, opt_ignored) {
  return '' + ((opt_data.variable) ? '<div class="variable-override-text">' + ((opt_data.variable.variableType == 'PLAN') ? soy.$$escapeHtml("Overrides plan value:") + ' ' + soy.$$escapeHtml(opt_data.variable.value) : soy.$$escapeHtml("Overrides global value:") + ' ' + soy.$$escapeHtml(opt_data.variable.value)) + '</div>' : '');
};
if (goog.DEBUG) {
  bamboo.feature.variables.overrideText.soyTemplateName = 'bamboo.feature.variables.overrideText';
}
;
;
/* module-key = 'bamboo.web.resources:variables', location = '/widget/autocomplete-controls/bamboo/variables/variable-singleselect.js' */
define('widget/variable-single-select', [
    'jquery',
    'underscore',
    'backbone',
    'widget/single-select'
], function(
    $,
    _,
    Backbone,
    SingleSelect
) {

    'use strict';

    /* currently only supports pre-bootstrapped data.  No rest end point. */
    var VariableSingleSelect = Backbone.View.extend({
        initialize: function(options) {
            options || (options = {});
            this.singleSelect = new SingleSelect({
                el: this.$el,
                bootstrap: options.bootstrap ? _.map(options.bootstrap, function(variable) {
                    return $.extend(true, variable, {id: variable.key});
                }) : [],
                maxResults: options.maxResults || 5,
                matcher: _.bind(this.matcher, this),
                resultItemTemplate: bamboo.widget.autocomplete.variableItemResult
            });
            this.singleSelect.on('selected', this.handleSelection, this);
        },
        containsMatch: function(str, find) {
            return (str.toLowerCase().indexOf(find.toLowerCase()) > -1);
        },
        matcher: function(variable, query) {
            var matches = false;
            matches = matches || this.containsMatch(variable.get('key'), query);
            return matches;
        },
        handleSelection: function(model) {
            this.$el.trigger('selected', model);
        }
    });

    return VariableSingleSelect;
});
;
;
/* module-key = 'bamboo.web.resources:lib-zeroclipboard', location = '/bower/zeroclipboard/ZeroClipboard.js' */
/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
 * Copyright (c) 2009-2014 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.2.0
 */
(function(window, undefined) {
  "use strict";
  /**
 * Store references to critically important global functions that may be
 * overridden on certain web pages.
 */
  var _window = window, _document = _window.document, _navigator = _window.navigator, _setTimeout = _window.setTimeout, _clearTimeout = _window.clearTimeout, _setInterval = _window.setInterval, _clearInterval = _window.clearInterval, _getComputedStyle = _window.getComputedStyle, _encodeURIComponent = _window.encodeURIComponent, _ActiveXObject = _window.ActiveXObject, _Error = _window.Error, _parseInt = _window.Number.parseInt || _window.parseInt, _parseFloat = _window.Number.parseFloat || _window.parseFloat, _isNaN = _window.Number.isNaN || _window.isNaN, _now = _window.Date.now, _keys = _window.Object.keys, _defineProperty = _window.Object.defineProperty, _hasOwn = _window.Object.prototype.hasOwnProperty, _slice = _window.Array.prototype.slice, _unwrap = function() {
    var unwrapper = function(el) {
      return el;
    };
    if (typeof _window.wrap === "function" && typeof _window.unwrap === "function") {
      try {
        var div = _document.createElement("div");
        var unwrappedDiv = _window.unwrap(div);
        if (div.nodeType === 1 && unwrappedDiv && unwrappedDiv.nodeType === 1) {
          unwrapper = _window.unwrap;
        }
      } catch (e) {}
    }
    return unwrapper;
  }();
  /**
 * Convert an `arguments` object into an Array.
 *
 * @returns The arguments as an Array
 * @private
 */
  var _args = function(argumentsObj) {
    return _slice.call(argumentsObj, 0);
  };
  /**
 * Shallow-copy the owned, enumerable properties of one object over to another, similar to jQuery's `$.extend`.
 *
 * @returns The target object, augmented
 * @private
 */
  var _extend = function() {
    var i, len, arg, prop, src, copy, args = _args(arguments), target = args[0] || {};
    for (i = 1, len = args.length; i < len; i++) {
      if ((arg = args[i]) != null) {
        for (prop in arg) {
          if (_hasOwn.call(arg, prop)) {
            src = target[prop];
            copy = arg[prop];
            if (target !== copy && copy !== undefined) {
              target[prop] = copy;
            }
          }
        }
      }
    }
    return target;
  };
  /**
 * Return a deep copy of the source object or array.
 *
 * @returns Object or Array
 * @private
 */
  var _deepCopy = function(source) {
    var copy, i, len, prop;
    if (typeof source !== "object" || source == null || typeof source.nodeType === "number") {
      copy = source;
    } else if (typeof source.length === "number") {
      copy = [];
      for (i = 0, len = source.length; i < len; i++) {
        if (_hasOwn.call(source, i)) {
          copy[i] = _deepCopy(source[i]);
        }
      }
    } else {
      copy = {};
      for (prop in source) {
        if (_hasOwn.call(source, prop)) {
          copy[prop] = _deepCopy(source[prop]);
        }
      }
    }
    return copy;
  };
  /**
 * Makes a shallow copy of `obj` (like `_extend`) but filters its properties based on a list of `keys` to keep.
 * The inverse of `_omit`, mostly. The big difference is that these properties do NOT need to be enumerable to
 * be kept.
 *
 * @returns A new filtered object.
 * @private
 */
  var _pick = function(obj, keys) {
    var newObj = {};
    for (var i = 0, len = keys.length; i < len; i++) {
      if (keys[i] in obj) {
        newObj[keys[i]] = obj[keys[i]];
      }
    }
    return newObj;
  };
  /**
 * Makes a shallow copy of `obj` (like `_extend`) but filters its properties based on a list of `keys` to omit.
 * The inverse of `_pick`.
 *
 * @returns A new filtered object.
 * @private
 */
  var _omit = function(obj, keys) {
    var newObj = {};
    for (var prop in obj) {
      if (keys.indexOf(prop) === -1) {
        newObj[prop] = obj[prop];
      }
    }
    return newObj;
  };
  /**
 * Remove all owned, enumerable properties from an object.
 *
 * @returns The original object without its owned, enumerable properties.
 * @private
 */
  var _deleteOwnProperties = function(obj) {
    if (obj) {
      for (var prop in obj) {
        if (_hasOwn.call(obj, prop)) {
          delete obj[prop];
        }
      }
    }
    return obj;
  };
  /**
 * Determine if an element is contained within another element.
 *
 * @returns Boolean
 * @private
 */
  var _containedBy = function(el, ancestorEl) {
    if (el && el.nodeType === 1 && el.ownerDocument && ancestorEl && (ancestorEl.nodeType === 1 && ancestorEl.ownerDocument && ancestorEl.ownerDocument === el.ownerDocument || ancestorEl.nodeType === 9 && !ancestorEl.ownerDocument && ancestorEl === el.ownerDocument)) {
      do {
        if (el === ancestorEl) {
          return true;
        }
        el = el.parentNode;
      } while (el);
    }
    return false;
  };
  /**
 * Get the URL path's parent directory.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getDirPathOfUrl = function(url) {
    var dir;
    if (typeof url === "string" && url) {
      dir = url.split("#")[0].split("?")[0];
      dir = url.slice(0, url.lastIndexOf("/") + 1);
    }
    return dir;
  };
  /**
 * Get the current script's URL by throwing an `Error` and analyzing it.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getCurrentScriptUrlFromErrorStack = function(stack) {
    var url, matches;
    if (typeof stack === "string" && stack) {
      matches = stack.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);
      if (matches && matches[1]) {
        url = matches[1];
      } else {
        matches = stack.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);
        if (matches && matches[1]) {
          url = matches[1];
        }
      }
    }
    return url;
  };
  /**
 * Get the current script's URL by throwing an `Error` and analyzing it.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getCurrentScriptUrlFromError = function() {
    var url, err;
    try {
      throw new _Error();
    } catch (e) {
      err = e;
    }
    if (err) {
      url = err.sourceURL || err.fileName || _getCurrentScriptUrlFromErrorStack(err.stack);
    }
    return url;
  };
  /**
 * Get the current script's URL.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getCurrentScriptUrl = function() {
    var jsPath, scripts, i;
    if (_document.currentScript && (jsPath = _document.currentScript.src)) {
      return jsPath;
    }
    scripts = _document.getElementsByTagName("script");
    if (scripts.length === 1) {
      return scripts[0].src || undefined;
    }
    if ("readyState" in scripts[0]) {
      for (i = scripts.length; i--; ) {
        if (scripts[i].readyState === "interactive" && (jsPath = scripts[i].src)) {
          return jsPath;
        }
      }
    }
    if (_document.readyState === "loading" && (jsPath = scripts[scripts.length - 1].src)) {
      return jsPath;
    }
    if (jsPath = _getCurrentScriptUrlFromError()) {
      return jsPath;
    }
    return undefined;
  };
  /**
 * Get the unanimous parent directory of ALL script tags.
 * If any script tags are either (a) inline or (b) from differing parent
 * directories, this method must return `undefined`.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getUnanimousScriptParentDir = function() {
    var i, jsDir, jsPath, scripts = _document.getElementsByTagName("script");
    for (i = scripts.length; i--; ) {
      if (!(jsPath = scripts[i].src)) {
        jsDir = null;
        break;
      }
      jsPath = _getDirPathOfUrl(jsPath);
      if (jsDir == null) {
        jsDir = jsPath;
      } else if (jsDir !== jsPath) {
        jsDir = null;
        break;
      }
    }
    return jsDir || undefined;
  };
  /**
 * Get the presumed location of the "ZeroClipboard.swf" file, based on the location
 * of the executing JavaScript file (e.g. "ZeroClipboard.js", etc.).
 *
 * @returns String
 * @private
 */
  var _getDefaultSwfPath = function() {
    var jsDir = _getDirPathOfUrl(_getCurrentScriptUrl()) || _getUnanimousScriptParentDir() || "";
    return jsDir + "ZeroClipboard.swf";
  };
  /**
 * Keep track of if the page is framed (in an `iframe`). This can never change.
 * @private
 */
  var _pageIsFramed = function() {
    return window.opener == null && (!!window.top && window != window.top || !!window.parent && window != window.parent);
  }();
  /**
 * Keep track of the state of the Flash object.
 * @private
 */
  var _flashState = {
    bridge: null,
    version: "0.0.0",
    pluginType: "unknown",
    disabled: null,
    outdated: null,
    sandboxed: null,
    unavailable: null,
    degraded: null,
    deactivated: null,
    overdue: null,
    ready: null
  };
  /**
 * The minimum Flash Player version required to use ZeroClipboard completely.
 * @readonly
 * @private
 */
  var _minimumFlashVersion = "11.0.0";
  /**
 * The ZeroClipboard library version number, as reported by Flash, at the time the SWF was compiled.
 */
  var _zcSwfVersion;
  /**
 * Keep track of all event listener registrations.
 * @private
 */
  var _handlers = {};
  /**
 * Keep track of the currently activated element.
 * @private
 */
  var _currentElement;
  /**
 * Keep track of the element that was activated when a `copy` process started.
 * @private
 */
  var _copyTarget;
  /**
 * Keep track of data for the pending clipboard transaction.
 * @private
 */
  var _clipData = {};
  /**
 * Keep track of data formats for the pending clipboard transaction.
 * @private
 */
  var _clipDataFormatMap = null;
  /**
 * Keep track of the Flash availability check timeout.
 * @private
 */
  var _flashCheckTimeout = 0;
  /**
 * Keep track of SWF network errors interval polling.
 * @private
 */
  var _swfFallbackCheckInterval = 0;
  /**
 * The `message` store for events
 * @private
 */
  var _eventMessages = {
    ready: "Flash communication is established",
    error: {
      "flash-disabled": "Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.",
      "flash-outdated": "Flash is too outdated to support ZeroClipboard",
      "flash-sandboxed": "Attempting to run Flash in a sandboxed iframe, which is impossible",
      "flash-unavailable": "Flash is unable to communicate bidirectionally with JavaScript",
      "flash-degraded": "Flash is unable to preserve data fidelity when communicating with JavaScript",
      "flash-deactivated": "Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.",
      "flash-overdue": "Flash communication was established but NOT within the acceptable time limit",
      "version-mismatch": "ZeroClipboard JS version number does not match ZeroClipboard SWF version number",
      "clipboard-error": "At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard",
      "config-mismatch": "ZeroClipboard configuration does not match Flash's reality",
      "swf-not-found": "The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"
    }
  };
  /**
 * The `name`s of `error` events that can only occur is Flash has at least
 * been able to load the SWF successfully.
 * @private
 */
  var _errorsThatOnlyOccurAfterFlashLoads = [ "flash-unavailable", "flash-degraded", "flash-overdue", "version-mismatch", "config-mismatch", "clipboard-error" ];
  /**
 * The `name`s of `error` events that should likely result in the `_flashState`
 * variable's property values being updated.
 * @private
 */
  var _flashStateErrorNames = [ "flash-disabled", "flash-outdated", "flash-sandboxed", "flash-unavailable", "flash-degraded", "flash-deactivated", "flash-overdue" ];
  /**
 * A RegExp to match the `name` property of `error` events related to Flash.
 * @private
 */
  var _flashStateErrorNameMatchingRegex = new RegExp("^flash-(" + _flashStateErrorNames.map(function(errorName) {
    return errorName.replace(/^flash-/, "");
  }).join("|") + ")$");
  /**
 * A RegExp to match the `name` property of `error` events related to Flash,
 * which is enabled.
 * @private
 */
  var _flashStateEnabledErrorNameMatchingRegex = new RegExp("^flash-(" + _flashStateErrorNames.slice(1).map(function(errorName) {
    return errorName.replace(/^flash-/, "");
  }).join("|") + ")$");
  /**
 * ZeroClipboard configuration defaults for the Core module.
 * @private
 */
  var _globalConfig = {
    swfPath: _getDefaultSwfPath(),
    trustedDomains: window.location.host ? [ window.location.host ] : [],
    cacheBust: true,
    forceEnhancedClipboard: false,
    flashLoadTimeout: 3e4,
    autoActivate: true,
    bubbleEvents: true,
    containerId: "global-zeroclipboard-html-bridge",
    containerClass: "global-zeroclipboard-container",
    swfObjectId: "global-zeroclipboard-flash-bridge",
    hoverClass: "zeroclipboard-is-hover",
    activeClass: "zeroclipboard-is-active",
    forceHandCursor: false,
    title: null,
    zIndex: 999999999
  };
  /**
 * The underlying implementation of `ZeroClipboard.config`.
 * @private
 */
  var _config = function(options) {
    if (typeof options === "object" && options !== null) {
      for (var prop in options) {
        if (_hasOwn.call(options, prop)) {
          if (/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(prop)) {
            _globalConfig[prop] = options[prop];
          } else if (_flashState.bridge == null) {
            if (prop === "containerId" || prop === "swfObjectId") {
              if (_isValidHtml4Id(options[prop])) {
                _globalConfig[prop] = options[prop];
              } else {
                throw new Error("The specified `" + prop + "` value is not valid as an HTML4 Element ID");
              }
            } else {
              _globalConfig[prop] = options[prop];
            }
          }
        }
      }
    }
    if (typeof options === "string" && options) {
      if (_hasOwn.call(_globalConfig, options)) {
        return _globalConfig[options];
      }
      return;
    }
    return _deepCopy(_globalConfig);
  };
  /**
 * The underlying implementation of `ZeroClipboard.state`.
 * @private
 */
  var _state = function() {
    _detectSandbox();
    return {
      browser: _pick(_navigator, [ "userAgent", "platform", "appName" ]),
      flash: _omit(_flashState, [ "bridge" ]),
      zeroclipboard: {
        version: ZeroClipboard.version,
        config: ZeroClipboard.config()
      }
    };
  };
  /**
 * The underlying implementation of `ZeroClipboard.isFlashUnusable`.
 * @private
 */
  var _isFlashUnusable = function() {
    return !!(_flashState.disabled || _flashState.outdated || _flashState.sandboxed || _flashState.unavailable || _flashState.degraded || _flashState.deactivated);
  };
  /**
 * The underlying implementation of `ZeroClipboard.on`.
 * @private
 */
  var _on = function(eventType, listener) {
    var i, len, events, added = {};
    if (typeof eventType === "string" && eventType) {
      events = eventType.toLowerCase().split(/\s+/);
    } else if (typeof eventType === "object" && eventType && typeof listener === "undefined") {
      for (i in eventType) {
        if (_hasOwn.call(eventType, i) && typeof i === "string" && i && typeof eventType[i] === "function") {
          ZeroClipboard.on(i, eventType[i]);
        }
      }
    }
    if (events && events.length) {
      for (i = 0, len = events.length; i < len; i++) {
        eventType = events[i].replace(/^on/, "");
        added[eventType] = true;
        if (!_handlers[eventType]) {
          _handlers[eventType] = [];
        }
        _handlers[eventType].push(listener);
      }
      if (added.ready && _flashState.ready) {
        ZeroClipboard.emit({
          type: "ready"
        });
      }
      if (added.error) {
        for (i = 0, len = _flashStateErrorNames.length; i < len; i++) {
          if (_flashState[_flashStateErrorNames[i].replace(/^flash-/, "")] === true) {
            ZeroClipboard.emit({
              type: "error",
              name: _flashStateErrorNames[i]
            });
            break;
          }
        }
        if (_zcSwfVersion !== undefined && ZeroClipboard.version !== _zcSwfVersion) {
          ZeroClipboard.emit({
            type: "error",
            name: "version-mismatch",
            jsVersion: ZeroClipboard.version,
            swfVersion: _zcSwfVersion
          });
        }
      }
    }
    return ZeroClipboard;
  };
  /**
 * The underlying implementation of `ZeroClipboard.off`.
 * @private
 */
  var _off = function(eventType, listener) {
    var i, len, foundIndex, events, perEventHandlers;
    if (arguments.length === 0) {
      events = _keys(_handlers);
    } else if (typeof eventType === "string" && eventType) {
      events = eventType.split(/\s+/);
    } else if (typeof eventType === "object" && eventType && typeof listener === "undefined") {
      for (i in eventType) {
        if (_hasOwn.call(eventType, i) && typeof i === "string" && i && typeof eventType[i] === "function") {
          ZeroClipboard.off(i, eventType[i]);
        }
      }
    }
    if (events && events.length) {
      for (i = 0, len = events.length; i < len; i++) {
        eventType = events[i].toLowerCase().replace(/^on/, "");
        perEventHandlers = _handlers[eventType];
        if (perEventHandlers && perEventHandlers.length) {
          if (listener) {
            foundIndex = perEventHandlers.indexOf(listener);
            while (foundIndex !== -1) {
              perEventHandlers.splice(foundIndex, 1);
              foundIndex = perEventHandlers.indexOf(listener, foundIndex);
            }
          } else {
            perEventHandlers.length = 0;
          }
        }
      }
    }
    return ZeroClipboard;
  };
  /**
 * The underlying implementation of `ZeroClipboard.handlers`.
 * @private
 */
  var _listeners = function(eventType) {
    var copy;
    if (typeof eventType === "string" && eventType) {
      copy = _deepCopy(_handlers[eventType]) || null;
    } else {
      copy = _deepCopy(_handlers);
    }
    return copy;
  };
  /**
 * The underlying implementation of `ZeroClipboard.emit`.
 * @private
 */
  var _emit = function(event) {
    var eventCopy, returnVal, tmp;
    event = _createEvent(event);
    if (!event) {
      return;
    }
    if (_preprocessEvent(event)) {
      return;
    }
    if (event.type === "ready" && _flashState.overdue === true) {
      return ZeroClipboard.emit({
        type: "error",
        name: "flash-overdue"
      });
    }
    eventCopy = _extend({}, event);
    _dispatchCallbacks.call(this, eventCopy);
    if (event.type === "copy") {
      tmp = _mapClipDataToFlash(_clipData);
      returnVal = tmp.data;
      _clipDataFormatMap = tmp.formatMap;
    }
    return returnVal;
  };
  /**
 * The underlying implementation of `ZeroClipboard.create`.
 * @private
 */
  var _create = function() {
    var previousState = _flashState.sandboxed;
    _detectSandbox();
    if (typeof _flashState.ready !== "boolean") {
      _flashState.ready = false;
    }
    if (_flashState.sandboxed !== previousState && _flashState.sandboxed === true) {
      _flashState.ready = false;
      ZeroClipboard.emit({
        type: "error",
        name: "flash-sandboxed"
      });
    } else if (!ZeroClipboard.isFlashUnusable() && _flashState.bridge === null) {
      var maxWait = _globalConfig.flashLoadTimeout;
      if (typeof maxWait === "number" && maxWait >= 0) {
        _flashCheckTimeout = _setTimeout(function() {
          if (typeof _flashState.deactivated !== "boolean") {
            _flashState.deactivated = true;
          }
          if (_flashState.deactivated === true) {
            ZeroClipboard.emit({
              type: "error",
              name: "flash-deactivated"
            });
          }
        }, maxWait);
      }
      _flashState.overdue = false;
      _embedSwf();
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.destroy`.
 * @private
 */
  var _destroy = function() {
    ZeroClipboard.clearData();
    ZeroClipboard.blur();
    ZeroClipboard.emit("destroy");
    _unembedSwf();
    ZeroClipboard.off();
  };
  /**
 * The underlying implementation of `ZeroClipboard.setData`.
 * @private
 */
  var _setData = function(format, data) {
    var dataObj;
    if (typeof format === "object" && format && typeof data === "undefined") {
      dataObj = format;
      ZeroClipboard.clearData();
    } else if (typeof format === "string" && format) {
      dataObj = {};
      dataObj[format] = data;
    } else {
      return;
    }
    for (var dataFormat in dataObj) {
      if (typeof dataFormat === "string" && dataFormat && _hasOwn.call(dataObj, dataFormat) && typeof dataObj[dataFormat] === "string" && dataObj[dataFormat]) {
        _clipData[dataFormat] = dataObj[dataFormat];
      }
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.clearData`.
 * @private
 */
  var _clearData = function(format) {
    if (typeof format === "undefined") {
      _deleteOwnProperties(_clipData);
      _clipDataFormatMap = null;
    } else if (typeof format === "string" && _hasOwn.call(_clipData, format)) {
      delete _clipData[format];
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.getData`.
 * @private
 */
  var _getData = function(format) {
    if (typeof format === "undefined") {
      return _deepCopy(_clipData);
    } else if (typeof format === "string" && _hasOwn.call(_clipData, format)) {
      return _clipData[format];
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.focus`/`ZeroClipboard.activate`.
 * @private
 */
  var _focus = function(element) {
    if (!(element && element.nodeType === 1)) {
      return;
    }
    if (_currentElement) {
      _removeClass(_currentElement, _globalConfig.activeClass);
      if (_currentElement !== element) {
        _removeClass(_currentElement, _globalConfig.hoverClass);
      }
    }
    _currentElement = element;
    _addClass(element, _globalConfig.hoverClass);
    var newTitle = element.getAttribute("title") || _globalConfig.title;
    if (typeof newTitle === "string" && newTitle) {
      var htmlBridge = _getHtmlBridge(_flashState.bridge);
      if (htmlBridge) {
        htmlBridge.setAttribute("title", newTitle);
      }
    }
    var useHandCursor = _globalConfig.forceHandCursor === true || _getStyle(element, "cursor") === "pointer";
    _setHandCursor(useHandCursor);
    _reposition();
  };
  /**
 * The underlying implementation of `ZeroClipboard.blur`/`ZeroClipboard.deactivate`.
 * @private
 */
  var _blur = function() {
    var htmlBridge = _getHtmlBridge(_flashState.bridge);
    if (htmlBridge) {
      htmlBridge.removeAttribute("title");
      htmlBridge.style.left = "0px";
      htmlBridge.style.top = "-9999px";
      htmlBridge.style.width = "1px";
      htmlBridge.style.height = "1px";
    }
    if (_currentElement) {
      _removeClass(_currentElement, _globalConfig.hoverClass);
      _removeClass(_currentElement, _globalConfig.activeClass);
      _currentElement = null;
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.activeElement`.
 * @private
 */
  var _activeElement = function() {
    return _currentElement || null;
  };
  /**
 * Check if a value is a valid HTML4 `ID` or `Name` token.
 * @private
 */
  var _isValidHtml4Id = function(id) {
    return typeof id === "string" && id && /^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(id);
  };
  /**
 * Create or update an `event` object, based on the `eventType`.
 * @private
 */
  var _createEvent = function(event) {
    var eventType;
    if (typeof event === "string" && event) {
      eventType = event;
      event = {};
    } else if (typeof event === "object" && event && typeof event.type === "string" && event.type) {
      eventType = event.type;
    }
    if (!eventType) {
      return;
    }
    eventType = eventType.toLowerCase();
    if (!event.target && (/^(copy|aftercopy|_click)$/.test(eventType) || eventType === "error" && event.name === "clipboard-error")) {
      event.target = _copyTarget;
    }
    _extend(event, {
      type: eventType,
      target: event.target || _currentElement || null,
      relatedTarget: event.relatedTarget || null,
      currentTarget: _flashState && _flashState.bridge || null,
      timeStamp: event.timeStamp || _now() || null
    });
    var msg = _eventMessages[event.type];
    if (event.type === "error" && event.name && msg) {
      msg = msg[event.name];
    }
    if (msg) {
      event.message = msg;
    }
    if (event.type === "ready") {
      _extend(event, {
        target: null,
        version: _flashState.version
      });
    }
    if (event.type === "error") {
      if (_flashStateErrorNameMatchingRegex.test(event.name)) {
        _extend(event, {
          target: null,
          minimumVersion: _minimumFlashVersion
        });
      }
      if (_flashStateEnabledErrorNameMatchingRegex.test(event.name)) {
        _extend(event, {
          version: _flashState.version
        });
      }
    }
    if (event.type === "copy") {
      event.clipboardData = {
        setData: ZeroClipboard.setData,
        clearData: ZeroClipboard.clearData
      };
    }
    if (event.type === "aftercopy") {
      event = _mapClipResultsFromFlash(event, _clipDataFormatMap);
    }
    if (event.target && !event.relatedTarget) {
      event.relatedTarget = _getRelatedTarget(event.target);
    }
    return _addMouseData(event);
  };
  /**
 * Get a relatedTarget from the target's `data-clipboard-target` attribute
 * @private
 */
  var _getRelatedTarget = function(targetEl) {
    var relatedTargetId = targetEl && targetEl.getAttribute && targetEl.getAttribute("data-clipboard-target");
    return relatedTargetId ? _document.getElementById(relatedTargetId) : null;
  };
  /**
 * Add element and position data to `MouseEvent` instances
 * @private
 */
  var _addMouseData = function(event) {
    if (event && /^_(?:click|mouse(?:over|out|down|up|move))$/.test(event.type)) {
      var srcElement = event.target;
      var fromElement = event.type === "_mouseover" && event.relatedTarget ? event.relatedTarget : undefined;
      var toElement = event.type === "_mouseout" && event.relatedTarget ? event.relatedTarget : undefined;
      var pos = _getElementPosition(srcElement);
      var screenLeft = _window.screenLeft || _window.screenX || 0;
      var screenTop = _window.screenTop || _window.screenY || 0;
      var scrollLeft = _document.body.scrollLeft + _document.documentElement.scrollLeft;
      var scrollTop = _document.body.scrollTop + _document.documentElement.scrollTop;
      var pageX = pos.left + (typeof event._stageX === "number" ? event._stageX : 0);
      var pageY = pos.top + (typeof event._stageY === "number" ? event._stageY : 0);
      var clientX = pageX - scrollLeft;
      var clientY = pageY - scrollTop;
      var screenX = screenLeft + clientX;
      var screenY = screenTop + clientY;
      var moveX = typeof event.movementX === "number" ? event.movementX : 0;
      var moveY = typeof event.movementY === "number" ? event.movementY : 0;
      delete event._stageX;
      delete event._stageY;
      _extend(event, {
        srcElement: srcElement,
        fromElement: fromElement,
        toElement: toElement,
        screenX: screenX,
        screenY: screenY,
        pageX: pageX,
        pageY: pageY,
        clientX: clientX,
        clientY: clientY,
        x: clientX,
        y: clientY,
        movementX: moveX,
        movementY: moveY,
        offsetX: 0,
        offsetY: 0,
        layerX: 0,
        layerY: 0
      });
    }
    return event;
  };
  /**
 * Determine if an event's registered handlers should be execute synchronously or asynchronously.
 *
 * @returns {boolean}
 * @private
 */
  var _shouldPerformAsync = function(event) {
    var eventType = event && typeof event.type === "string" && event.type || "";
    return !/^(?:(?:before)?copy|destroy)$/.test(eventType);
  };
  /**
 * Control if a callback should be executed asynchronously or not.
 *
 * @returns `undefined`
 * @private
 */
  var _dispatchCallback = function(func, context, args, async) {
    if (async) {
      _setTimeout(function() {
        func.apply(context, args);
      }, 0);
    } else {
      func.apply(context, args);
    }
  };
  /**
 * Handle the actual dispatching of events to client instances.
 *
 * @returns `undefined`
 * @private
 */
  var _dispatchCallbacks = function(event) {
    if (!(typeof event === "object" && event && event.type)) {
      return;
    }
    var async = _shouldPerformAsync(event);
    var wildcardTypeHandlers = _handlers["*"] || [];
    var specificTypeHandlers = _handlers[event.type] || [];
    var handlers = wildcardTypeHandlers.concat(specificTypeHandlers);
    if (handlers && handlers.length) {
      var i, len, func, context, eventCopy, originalContext = this;
      for (i = 0, len = handlers.length; i < len; i++) {
        func = handlers[i];
        context = originalContext;
        if (typeof func === "string" && typeof _window[func] === "function") {
          func = _window[func];
        }
        if (typeof func === "object" && func && typeof func.handleEvent === "function") {
          context = func;
          func = func.handleEvent;
        }
        if (typeof func === "function") {
          eventCopy = _extend({}, event);
          _dispatchCallback(func, context, [ eventCopy ], async);
        }
      }
    }
    return this;
  };
  /**
 * Check an `error` event's `name` property to see if Flash has
 * already loaded, which rules out possible `iframe` sandboxing.
 * @private
 */
  var _getSandboxStatusFromErrorEvent = function(event) {
    var isSandboxed = null;
    if (_pageIsFramed === false || event && event.type === "error" && event.name && _errorsThatOnlyOccurAfterFlashLoads.indexOf(event.name) !== -1) {
      isSandboxed = false;
    }
    return isSandboxed;
  };
  /**
 * Preprocess any special behaviors, reactions, or state changes after receiving this event.
 * Executes only once per event emitted, NOT once per client.
 * @private
 */
  var _preprocessEvent = function(event) {
    var element = event.target || _currentElement || null;
    var sourceIsSwf = event._source === "swf";
    delete event._source;
    switch (event.type) {
     case "error":
      var isSandboxed = event.name === "flash-sandboxed" || _getSandboxStatusFromErrorEvent(event);
      if (typeof isSandboxed === "boolean") {
        _flashState.sandboxed = isSandboxed;
      }
      if (_flashStateErrorNames.indexOf(event.name) !== -1) {
        _extend(_flashState, {
          disabled: event.name === "flash-disabled",
          outdated: event.name === "flash-outdated",
          unavailable: event.name === "flash-unavailable",
          degraded: event.name === "flash-degraded",
          deactivated: event.name === "flash-deactivated",
          overdue: event.name === "flash-overdue",
          ready: false
        });
      } else if (event.name === "version-mismatch") {
        _zcSwfVersion = event.swfVersion;
        _extend(_flashState, {
          disabled: false,
          outdated: false,
          unavailable: false,
          degraded: false,
          deactivated: false,
          overdue: false,
          ready: false
        });
      }
      _clearTimeoutsAndPolling();
      break;

     case "ready":
      _zcSwfVersion = event.swfVersion;
      var wasDeactivated = _flashState.deactivated === true;
      _extend(_flashState, {
        disabled: false,
        outdated: false,
        sandboxed: false,
        unavailable: false,
        degraded: false,
        deactivated: false,
        overdue: wasDeactivated,
        ready: !wasDeactivated
      });
      _clearTimeoutsAndPolling();
      break;

     case "beforecopy":
      _copyTarget = element;
      break;

     case "copy":
      var textContent, htmlContent, targetEl = event.relatedTarget;
      if (!(_clipData["text/html"] || _clipData["text/plain"]) && targetEl && (htmlContent = targetEl.value || targetEl.outerHTML || targetEl.innerHTML) && (textContent = targetEl.value || targetEl.textContent || targetEl.innerText)) {
        event.clipboardData.clearData();
        event.clipboardData.setData("text/plain", textContent);
        if (htmlContent !== textContent) {
          event.clipboardData.setData("text/html", htmlContent);
        }
      } else if (!_clipData["text/plain"] && event.target && (textContent = event.target.getAttribute("data-clipboard-text"))) {
        event.clipboardData.clearData();
        event.clipboardData.setData("text/plain", textContent);
      }
      break;

     case "aftercopy":
      _queueEmitClipboardErrors(event);
      ZeroClipboard.clearData();
      if (element && element !== _safeActiveElement() && element.focus) {
        element.focus();
      }
      break;

     case "_mouseover":
      ZeroClipboard.focus(element);
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        if (element && element !== event.relatedTarget && !_containedBy(event.relatedTarget, element)) {
          _fireMouseEvent(_extend({}, event, {
            type: "mouseenter",
            bubbles: false,
            cancelable: false
          }));
        }
        _fireMouseEvent(_extend({}, event, {
          type: "mouseover"
        }));
      }
      break;

     case "_mouseout":
      ZeroClipboard.blur();
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        if (element && element !== event.relatedTarget && !_containedBy(event.relatedTarget, element)) {
          _fireMouseEvent(_extend({}, event, {
            type: "mouseleave",
            bubbles: false,
            cancelable: false
          }));
        }
        _fireMouseEvent(_extend({}, event, {
          type: "mouseout"
        }));
      }
      break;

     case "_mousedown":
      _addClass(element, _globalConfig.activeClass);
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        _fireMouseEvent(_extend({}, event, {
          type: event.type.slice(1)
        }));
      }
      break;

     case "_mouseup":
      _removeClass(element, _globalConfig.activeClass);
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        _fireMouseEvent(_extend({}, event, {
          type: event.type.slice(1)
        }));
      }
      break;

     case "_click":
      _copyTarget = null;
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        _fireMouseEvent(_extend({}, event, {
          type: event.type.slice(1)
        }));
      }
      break;

     case "_mousemove":
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        _fireMouseEvent(_extend({}, event, {
          type: event.type.slice(1)
        }));
      }
      break;
    }
    if (/^_(?:click|mouse(?:over|out|down|up|move))$/.test(event.type)) {
      return true;
    }
  };
  /**
 * Check an "aftercopy" event for clipboard errors and emit a corresponding "error" event.
 * @private
 */
  var _queueEmitClipboardErrors = function(aftercopyEvent) {
    if (aftercopyEvent.errors && aftercopyEvent.errors.length > 0) {
      var errorEvent = _deepCopy(aftercopyEvent);
      _extend(errorEvent, {
        type: "error",
        name: "clipboard-error"
      });
      delete errorEvent.success;
      _setTimeout(function() {
        ZeroClipboard.emit(errorEvent);
      }, 0);
    }
  };
  /**
 * Dispatch a synthetic MouseEvent.
 *
 * @returns `undefined`
 * @private
 */
  var _fireMouseEvent = function(event) {
    if (!(event && typeof event.type === "string" && event)) {
      return;
    }
    var e, target = event.target || null, doc = target && target.ownerDocument || _document, defaults = {
      view: doc.defaultView || _window,
      canBubble: true,
      cancelable: true,
      detail: event.type === "click" ? 1 : 0,
      button: typeof event.which === "number" ? event.which - 1 : typeof event.button === "number" ? event.button : doc.createEvent ? 0 : 1
    }, args = _extend(defaults, event);
    if (!target) {
      return;
    }
    if (doc.createEvent && target.dispatchEvent) {
      args = [ args.type, args.canBubble, args.cancelable, args.view, args.detail, args.screenX, args.screenY, args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.button, args.relatedTarget ];
      e = doc.createEvent("MouseEvents");
      if (e.initMouseEvent) {
        e.initMouseEvent.apply(e, args);
        e._source = "js";
        target.dispatchEvent(e);
      }
    }
  };
  /**
 * Continuously poll the DOM until either:
 *  (a) the fallback content becomes visible, or
 *  (b) we receive an event from SWF (handled elsewhere)
 *
 * IMPORTANT:
 * This is NOT a necessary check but it can result in significantly faster
 * detection of bad `swfPath` configuration and/or network/server issues [in
 * supported browsers] than waiting for the entire `flashLoadTimeout` duration
 * to elapse before detecting that the SWF cannot be loaded. The detection
 * duration can be anywhere from 10-30 times faster [in supported browsers] by
 * using this approach.
 *
 * @returns `undefined`
 * @private
 */
  var _watchForSwfFallbackContent = function() {
    var maxWait = _globalConfig.flashLoadTimeout;
    if (typeof maxWait === "number" && maxWait >= 0) {
      var pollWait = Math.min(1e3, maxWait / 10);
      var fallbackContentId = _globalConfig.swfObjectId + "_fallbackContent";
      _swfFallbackCheckInterval = _setInterval(function() {
        var el = _document.getElementById(fallbackContentId);
        if (_isElementVisible(el)) {
          _clearTimeoutsAndPolling();
          _flashState.deactivated = null;
          ZeroClipboard.emit({
            type: "error",
            name: "swf-not-found"
          });
        }
      }, pollWait);
    }
  };
  /**
 * Create the HTML bridge element to embed the Flash object into.
 * @private
 */
  var _createHtmlBridge = function() {
    var container = _document.createElement("div");
    container.id = _globalConfig.containerId;
    container.className = _globalConfig.containerClass;
    container.style.position = "absolute";
    container.style.left = "0px";
    container.style.top = "-9999px";
    container.style.width = "1px";
    container.style.height = "1px";
    container.style.zIndex = "" + _getSafeZIndex(_globalConfig.zIndex);
    return container;
  };
  /**
 * Get the HTML element container that wraps the Flash bridge object/element.
 * @private
 */
  var _getHtmlBridge = function(flashBridge) {
    var htmlBridge = flashBridge && flashBridge.parentNode;
    while (htmlBridge && htmlBridge.nodeName === "OBJECT" && htmlBridge.parentNode) {
      htmlBridge = htmlBridge.parentNode;
    }
    return htmlBridge || null;
  };
  /**
 * Create the SWF object.
 *
 * @returns The SWF object reference.
 * @private
 */
  var _embedSwf = function() {
    var len, flashBridge = _flashState.bridge, container = _getHtmlBridge(flashBridge);
    if (!flashBridge) {
      var allowScriptAccess = _determineScriptAccess(_window.location.host, _globalConfig);
      var allowNetworking = allowScriptAccess === "never" ? "none" : "all";
      var flashvars = _vars(_extend({
        jsVersion: ZeroClipboard.version
      }, _globalConfig));
      var swfUrl = _globalConfig.swfPath + _cacheBust(_globalConfig.swfPath, _globalConfig);
      container = _createHtmlBridge();
      var divToBeReplaced = _document.createElement("div");
      container.appendChild(divToBeReplaced);
      _document.body.appendChild(container);
      var tmpDiv = _document.createElement("div");
      var usingActiveX = _flashState.pluginType === "activex";
      tmpDiv.innerHTML = '<object id="' + _globalConfig.swfObjectId + '" name="' + _globalConfig.swfObjectId + '" ' + 'width="100%" height="100%" ' + (usingActiveX ? 'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"' : 'type="application/x-shockwave-flash" data="' + swfUrl + '"') + ">" + (usingActiveX ? '<param name="movie" value="' + swfUrl + '"/>' : "") + '<param name="allowScriptAccess" value="' + allowScriptAccess + '"/>' + '<param name="allowNetworking" value="' + allowNetworking + '"/>' + '<param name="menu" value="false"/>' + '<param name="wmode" value="transparent"/>' + '<param name="flashvars" value="' + flashvars + '"/>' + '<div id="' + _globalConfig.swfObjectId + '_fallbackContent">&nbsp;</div>' + "</object>";
      flashBridge = tmpDiv.firstChild;
      tmpDiv = null;
      _unwrap(flashBridge).ZeroClipboard = ZeroClipboard;
      container.replaceChild(flashBridge, divToBeReplaced);
      _watchForSwfFallbackContent();
    }
    if (!flashBridge) {
      flashBridge = _document[_globalConfig.swfObjectId];
      if (flashBridge && (len = flashBridge.length)) {
        flashBridge = flashBridge[len - 1];
      }
      if (!flashBridge && container) {
        flashBridge = container.firstChild;
      }
    }
    _flashState.bridge = flashBridge || null;
    return flashBridge;
  };
  /**
 * Destroy the SWF object.
 * @private
 */
  var _unembedSwf = function() {
    var flashBridge = _flashState.bridge;
    if (flashBridge) {
      var htmlBridge = _getHtmlBridge(flashBridge);
      if (htmlBridge) {
        if (_flashState.pluginType === "activex" && "readyState" in flashBridge) {
          flashBridge.style.display = "none";
          (function removeSwfFromIE() {
            if (flashBridge.readyState === 4) {
              for (var prop in flashBridge) {
                if (typeof flashBridge[prop] === "function") {
                  flashBridge[prop] = null;
                }
              }
              if (flashBridge.parentNode) {
                flashBridge.parentNode.removeChild(flashBridge);
              }
              if (htmlBridge.parentNode) {
                htmlBridge.parentNode.removeChild(htmlBridge);
              }
            } else {
              _setTimeout(removeSwfFromIE, 10);
            }
          })();
        } else {
          if (flashBridge.parentNode) {
            flashBridge.parentNode.removeChild(flashBridge);
          }
          if (htmlBridge.parentNode) {
            htmlBridge.parentNode.removeChild(htmlBridge);
          }
        }
      }
      _clearTimeoutsAndPolling();
      _flashState.ready = null;
      _flashState.bridge = null;
      _flashState.deactivated = null;
      _zcSwfVersion = undefined;
    }
  };
  /**
 * Map the data format names of the "clipData" to Flash-friendly names.
 *
 * @returns A new transformed object.
 * @private
 */
  var _mapClipDataToFlash = function(clipData) {
    var newClipData = {}, formatMap = {};
    if (!(typeof clipData === "object" && clipData)) {
      return;
    }
    for (var dataFormat in clipData) {
      if (dataFormat && _hasOwn.call(clipData, dataFormat) && typeof clipData[dataFormat] === "string" && clipData[dataFormat]) {
        switch (dataFormat.toLowerCase()) {
         case "text/plain":
         case "text":
         case "air:text":
         case "flash:text":
          newClipData.text = clipData[dataFormat];
          formatMap.text = dataFormat;
          break;

         case "text/html":
         case "html":
         case "air:html":
         case "flash:html":
          newClipData.html = clipData[dataFormat];
          formatMap.html = dataFormat;
          break;

         case "application/rtf":
         case "text/rtf":
         case "rtf":
         case "richtext":
         case "air:rtf":
         case "flash:rtf":
          newClipData.rtf = clipData[dataFormat];
          formatMap.rtf = dataFormat;
          break;

         default:
          break;
        }
      }
    }
    return {
      data: newClipData,
      formatMap: formatMap
    };
  };
  /**
 * Map the data format names from Flash-friendly names back to their original "clipData" names (via a format mapping).
 *
 * @returns A new transformed object.
 * @private
 */
  var _mapClipResultsFromFlash = function(clipResults, formatMap) {
    if (!(typeof clipResults === "object" && clipResults && typeof formatMap === "object" && formatMap)) {
      return clipResults;
    }
    var newResults = {};
    for (var prop in clipResults) {
      if (_hasOwn.call(clipResults, prop)) {
        if (prop === "errors") {
          newResults[prop] = clipResults[prop] ? clipResults[prop].slice() : [];
          for (var i = 0, len = newResults[prop].length; i < len; i++) {
            newResults[prop][i].format = formatMap[newResults[prop][i].format];
          }
        } else if (prop !== "success" && prop !== "data") {
          newResults[prop] = clipResults[prop];
        } else {
          newResults[prop] = {};
          var tmpHash = clipResults[prop];
          for (var dataFormat in tmpHash) {
            if (dataFormat && _hasOwn.call(tmpHash, dataFormat) && _hasOwn.call(formatMap, dataFormat)) {
              newResults[prop][formatMap[dataFormat]] = tmpHash[dataFormat];
            }
          }
        }
      }
    }
    return newResults;
  };
  /**
 * Will look at a path, and will create a "?noCache={time}" or "&noCache={time}"
 * query param string to return. Does NOT append that string to the original path.
 * This is useful because ExternalInterface often breaks when a Flash SWF is cached.
 *
 * @returns The `noCache` query param with necessary "?"/"&" prefix.
 * @private
 */
  var _cacheBust = function(path, options) {
    var cacheBust = options == null || options && options.cacheBust === true;
    if (cacheBust) {
      return (path.indexOf("?") === -1 ? "?" : "&") + "noCache=" + _now();
    } else {
      return "";
    }
  };
  /**
 * Creates a query string for the FlashVars param.
 * Does NOT include the cache-busting query param.
 *
 * @returns FlashVars query string
 * @private
 */
  var _vars = function(options) {
    var i, len, domain, domains, str = "", trustedOriginsExpanded = [];
    if (options.trustedDomains) {
      if (typeof options.trustedDomains === "string") {
        domains = [ options.trustedDomains ];
      } else if (typeof options.trustedDomains === "object" && "length" in options.trustedDomains) {
        domains = options.trustedDomains;
      }
    }
    if (domains && domains.length) {
      for (i = 0, len = domains.length; i < len; i++) {
        if (_hasOwn.call(domains, i) && domains[i] && typeof domains[i] === "string") {
          domain = _extractDomain(domains[i]);
          if (!domain) {
            continue;
          }
          if (domain === "*") {
            trustedOriginsExpanded.length = 0;
            trustedOriginsExpanded.push(domain);
            break;
          }
          trustedOriginsExpanded.push.apply(trustedOriginsExpanded, [ domain, "//" + domain, _window.location.protocol + "//" + domain ]);
        }
      }
    }
    if (trustedOriginsExpanded.length) {
      str += "trustedOrigins=" + _encodeURIComponent(trustedOriginsExpanded.join(","));
    }
    if (options.forceEnhancedClipboard === true) {
      str += (str ? "&" : "") + "forceEnhancedClipboard=true";
    }
    if (typeof options.swfObjectId === "string" && options.swfObjectId) {
      str += (str ? "&" : "") + "swfObjectId=" + _encodeURIComponent(options.swfObjectId);
    }
    if (typeof options.jsVersion === "string" && options.jsVersion) {
      str += (str ? "&" : "") + "jsVersion=" + _encodeURIComponent(options.jsVersion);
    }
    return str;
  };
  /**
 * Extract the domain (e.g. "github.com") from an origin (e.g. "https://github.com") or
 * URL (e.g. "https://github.com/zeroclipboard/zeroclipboard/").
 *
 * @returns the domain
 * @private
 */
  var _extractDomain = function(originOrUrl) {
    if (originOrUrl == null || originOrUrl === "") {
      return null;
    }
    originOrUrl = originOrUrl.replace(/^\s+|\s+$/g, "");
    if (originOrUrl === "") {
      return null;
    }
    var protocolIndex = originOrUrl.indexOf("//");
    originOrUrl = protocolIndex === -1 ? originOrUrl : originOrUrl.slice(protocolIndex + 2);
    var pathIndex = originOrUrl.indexOf("/");
    originOrUrl = pathIndex === -1 ? originOrUrl : protocolIndex === -1 || pathIndex === 0 ? null : originOrUrl.slice(0, pathIndex);
    if (originOrUrl && originOrUrl.slice(-4).toLowerCase() === ".swf") {
      return null;
    }
    return originOrUrl || null;
  };
  /**
 * Set `allowScriptAccess` based on `trustedDomains` and `window.location.host` vs. `swfPath`.
 *
 * @returns The appropriate script access level.
 * @private
 */
  var _determineScriptAccess = function() {
    var _extractAllDomains = function(origins) {
      var i, len, tmp, resultsArray = [];
      if (typeof origins === "string") {
        origins = [ origins ];
      }
      if (!(typeof origins === "object" && origins && typeof origins.length === "number")) {
        return resultsArray;
      }
      for (i = 0, len = origins.length; i < len; i++) {
        if (_hasOwn.call(origins, i) && (tmp = _extractDomain(origins[i]))) {
          if (tmp === "*") {
            resultsArray.length = 0;
            resultsArray.push("*");
            break;
          }
          if (resultsArray.indexOf(tmp) === -1) {
            resultsArray.push(tmp);
          }
        }
      }
      return resultsArray;
    };
    return function(currentDomain, configOptions) {
      var swfDomain = _extractDomain(configOptions.swfPath);
      if (swfDomain === null) {
        swfDomain = currentDomain;
      }
      var trustedDomains = _extractAllDomains(configOptions.trustedDomains);
      var len = trustedDomains.length;
      if (len > 0) {
        if (len === 1 && trustedDomains[0] === "*") {
          return "always";
        }
        if (trustedDomains.indexOf(currentDomain) !== -1) {
          if (len === 1 && currentDomain === swfDomain) {
            return "sameDomain";
          }
          return "always";
        }
      }
      return "never";
    };
  }();
  /**
 * Get the currently active/focused DOM element.
 *
 * @returns the currently active/focused element, or `null`
 * @private
 */
  var _safeActiveElement = function() {
    try {
      return _document.activeElement;
    } catch (err) {
      return null;
    }
  };
  /**
 * Add a class to an element, if it doesn't already have it.
 *
 * @returns The element, with its new class added.
 * @private
 */
  var _addClass = function(element, value) {
    var c, cl, className, classNames = [];
    if (typeof value === "string" && value) {
      classNames = value.split(/\s+/);
    }
    if (element && element.nodeType === 1 && classNames.length > 0) {
      if (element.classList) {
        for (c = 0, cl = classNames.length; c < cl; c++) {
          element.classList.add(classNames[c]);
        }
      } else if (element.hasOwnProperty("className")) {
        className = " " + element.className + " ";
        for (c = 0, cl = classNames.length; c < cl; c++) {
          if (className.indexOf(" " + classNames[c] + " ") === -1) {
            className += classNames[c] + " ";
          }
        }
        element.className = className.replace(/^\s+|\s+$/g, "");
      }
    }
    return element;
  };
  /**
 * Remove a class from an element, if it has it.
 *
 * @returns The element, with its class removed.
 * @private
 */
  var _removeClass = function(element, value) {
    var c, cl, className, classNames = [];
    if (typeof value === "string" && value) {
      classNames = value.split(/\s+/);
    }
    if (element && element.nodeType === 1 && classNames.length > 0) {
      if (element.classList && element.classList.length > 0) {
        for (c = 0, cl = classNames.length; c < cl; c++) {
          element.classList.remove(classNames[c]);
        }
      } else if (element.className) {
        className = (" " + element.className + " ").replace(/[\r\n\t]/g, " ");
        for (c = 0, cl = classNames.length; c < cl; c++) {
          className = className.replace(" " + classNames[c] + " ", " ");
        }
        element.className = className.replace(/^\s+|\s+$/g, "");
      }
    }
    return element;
  };
  /**
 * Attempt to interpret the element's CSS styling. If `prop` is `"cursor"`,
 * then we assume that it should be a hand ("pointer") cursor if the element
 * is an anchor element ("a" tag).
 *
 * @returns The computed style property.
 * @private
 */
  var _getStyle = function(el, prop) {
    var value = _getComputedStyle(el, null).getPropertyValue(prop);
    if (prop === "cursor") {
      if (!value || value === "auto") {
        if (el.nodeName === "A") {
          return "pointer";
        }
      }
    }
    return value;
  };
  /**
 * Get the absolutely positioned coordinates of a DOM element.
 *
 * @returns Object containing the element's position, width, and height.
 * @private
 */
  var _getElementPosition = function(el) {
    var pos = {
      left: 0,
      top: 0,
      width: 0,
      height: 0
    };
    if (el.getBoundingClientRect) {
      var elRect = el.getBoundingClientRect();
      var pageXOffset = _window.pageXOffset;
      var pageYOffset = _window.pageYOffset;
      var leftBorderWidth = _document.documentElement.clientLeft || 0;
      var topBorderWidth = _document.documentElement.clientTop || 0;
      var leftBodyOffset = 0;
      var topBodyOffset = 0;
      if (_getStyle(_document.body, "position") === "relative") {
        var bodyRect = _document.body.getBoundingClientRect();
        var htmlRect = _document.documentElement.getBoundingClientRect();
        leftBodyOffset = bodyRect.left - htmlRect.left || 0;
        topBodyOffset = bodyRect.top - htmlRect.top || 0;
      }
      pos.left = elRect.left + pageXOffset - leftBorderWidth - leftBodyOffset;
      pos.top = elRect.top + pageYOffset - topBorderWidth - topBodyOffset;
      pos.width = "width" in elRect ? elRect.width : elRect.right - elRect.left;
      pos.height = "height" in elRect ? elRect.height : elRect.bottom - elRect.top;
    }
    return pos;
  };
  /**
 * Determine is an element is visible somewhere within the document (page).
 *
 * @returns Boolean
 * @private
 */
  var _isElementVisible = function(el) {
    if (!el) {
      return false;
    }
    var styles = _getComputedStyle(el, null);
    var hasCssHeight = _parseFloat(styles.height) > 0;
    var hasCssWidth = _parseFloat(styles.width) > 0;
    var hasCssTop = _parseFloat(styles.top) >= 0;
    var hasCssLeft = _parseFloat(styles.left) >= 0;
    var cssKnows = hasCssHeight && hasCssWidth && hasCssTop && hasCssLeft;
    var rect = cssKnows ? null : _getElementPosition(el);
    var isVisible = styles.display !== "none" && styles.visibility !== "collapse" && (cssKnows || !!rect && (hasCssHeight || rect.height > 0) && (hasCssWidth || rect.width > 0) && (hasCssTop || rect.top >= 0) && (hasCssLeft || rect.left >= 0));
    return isVisible;
  };
  /**
 * Clear all existing timeouts and interval polling delegates.
 *
 * @returns `undefined`
 * @private
 */
  var _clearTimeoutsAndPolling = function() {
    _clearTimeout(_flashCheckTimeout);
    _flashCheckTimeout = 0;
    _clearInterval(_swfFallbackCheckInterval);
    _swfFallbackCheckInterval = 0;
  };
  /**
 * Reposition the Flash object to cover the currently activated element.
 *
 * @returns `undefined`
 * @private
 */
  var _reposition = function() {
    var htmlBridge;
    if (_currentElement && (htmlBridge = _getHtmlBridge(_flashState.bridge))) {
      var pos = _getElementPosition(_currentElement);
      _extend(htmlBridge.style, {
        width: pos.width + "px",
        height: pos.height + "px",
        top: pos.top + "px",
        left: pos.left + "px",
        zIndex: "" + _getSafeZIndex(_globalConfig.zIndex)
      });
    }
  };
  /**
 * Sends a signal to the Flash object to display the hand cursor if `true`.
 *
 * @returns `undefined`
 * @private
 */
  var _setHandCursor = function(enabled) {
    if (_flashState.ready === true) {
      if (_flashState.bridge && typeof _flashState.bridge.setHandCursor === "function") {
        _flashState.bridge.setHandCursor(enabled);
      } else {
        _flashState.ready = false;
      }
    }
  };
  /**
 * Get a safe value for `zIndex`
 *
 * @returns an integer, or "auto"
 * @private
 */
  var _getSafeZIndex = function(val) {
    if (/^(?:auto|inherit)$/.test(val)) {
      return val;
    }
    var zIndex;
    if (typeof val === "number" && !_isNaN(val)) {
      zIndex = val;
    } else if (typeof val === "string") {
      zIndex = _getSafeZIndex(_parseInt(val, 10));
    }
    return typeof zIndex === "number" ? zIndex : "auto";
  };
  /**
 * Attempt to detect if ZeroClipboard is executing inside of a sandboxed iframe.
 * If it is, Flash Player cannot be used, so ZeroClipboard is dead in the water.
 *
 * @see {@link http://lists.w3.org/Archives/Public/public-whatwg-archive/2014Dec/0002.html}
 * @see {@link https://github.com/zeroclipboard/zeroclipboard/issues/511}
 * @see {@link http://zeroclipboard.org/test-iframes.html}
 *
 * @returns `true` (is sandboxed), `false` (is not sandboxed), or `null` (uncertain) 
 * @private
 */
  var _detectSandbox = function(doNotReassessFlashSupport) {
    var effectiveScriptOrigin, frame, frameError, previousState = _flashState.sandboxed, isSandboxed = null;
    doNotReassessFlashSupport = doNotReassessFlashSupport === true;
    if (_pageIsFramed === false) {
      isSandboxed = false;
    } else {
      try {
        frame = window.frameElement || null;
      } catch (e) {
        frameError = {
          name: e.name,
          message: e.message
        };
      }
      if (frame && frame.nodeType === 1 && frame.nodeName === "IFRAME") {
        try {
          isSandboxed = frame.hasAttribute("sandbox");
        } catch (e) {
          isSandboxed = null;
        }
      } else {
        try {
          effectiveScriptOrigin = document.domain || null;
        } catch (e) {
          effectiveScriptOrigin = null;
        }
        if (effectiveScriptOrigin === null || frameError && frameError.name === "SecurityError" && /(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(frameError.message.toLowerCase())) {
          isSandboxed = true;
        }
      }
    }
    _flashState.sandboxed = isSandboxed;
    if (previousState !== isSandboxed && !doNotReassessFlashSupport) {
      _detectFlashSupport(_ActiveXObject);
    }
    return isSandboxed;
  };
  /**
 * Detect the Flash Player status, version, and plugin type.
 *
 * @see {@link https://code.google.com/p/doctype-mirror/wiki/ArticleDetectFlash#The_code}
 * @see {@link http://stackoverflow.com/questions/12866060/detecting-pepper-ppapi-flash-with-javascript}
 *
 * @returns `undefined`
 * @private
 */
  var _detectFlashSupport = function(ActiveXObject) {
    var plugin, ax, mimeType, hasFlash = false, isActiveX = false, isPPAPI = false, flashVersion = "";
    /**
   * Derived from Apple's suggested sniffer.
   * @param {String} desc e.g. "Shockwave Flash 7.0 r61"
   * @returns {String} "7.0.61"
   * @private
   */
    function parseFlashVersion(desc) {
      var matches = desc.match(/[\d]+/g);
      matches.length = 3;
      return matches.join(".");
    }
    function isPepperFlash(flashPlayerFileName) {
      return !!flashPlayerFileName && (flashPlayerFileName = flashPlayerFileName.toLowerCase()) && (/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(flashPlayerFileName) || flashPlayerFileName.slice(-13) === "chrome.plugin");
    }
    function inspectPlugin(plugin) {
      if (plugin) {
        hasFlash = true;
        if (plugin.version) {
          flashVersion = parseFlashVersion(plugin.version);
        }
        if (!flashVersion && plugin.description) {
          flashVersion = parseFlashVersion(plugin.description);
        }
        if (plugin.filename) {
          isPPAPI = isPepperFlash(plugin.filename);
        }
      }
    }
    if (_navigator.plugins && _navigator.plugins.length) {
      plugin = _navigator.plugins["Shockwave Flash"];
      inspectPlugin(plugin);
      if (_navigator.plugins["Shockwave Flash 2.0"]) {
        hasFlash = true;
        flashVersion = "2.0.0.11";
      }
    } else if (_navigator.mimeTypes && _navigator.mimeTypes.length) {
      mimeType = _navigator.mimeTypes["application/x-shockwave-flash"];
      plugin = mimeType && mimeType.enabledPlugin;
      inspectPlugin(plugin);
    } else if (typeof ActiveXObject !== "undefined") {
      isActiveX = true;
      try {
        ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");
        hasFlash = true;
        flashVersion = parseFlashVersion(ax.GetVariable("$version"));
      } catch (e1) {
        try {
          ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
          hasFlash = true;
          flashVersion = "6.0.21";
        } catch (e2) {
          try {
            ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
            hasFlash = true;
            flashVersion = parseFlashVersion(ax.GetVariable("$version"));
          } catch (e3) {
            isActiveX = false;
          }
        }
      }
    }
    _flashState.disabled = hasFlash !== true;
    _flashState.outdated = flashVersion && _parseFloat(flashVersion) < _parseFloat(_minimumFlashVersion);
    _flashState.version = flashVersion || "0.0.0";
    _flashState.pluginType = isPPAPI ? "pepper" : isActiveX ? "activex" : hasFlash ? "netscape" : "unknown";
  };
  /**
 * Invoke the Flash detection algorithms immediately upon inclusion so we're not waiting later.
 */
  _detectFlashSupport(_ActiveXObject);
  /**
 * Always assess the `sandboxed` state of the page at important Flash-related moments.
 */
  _detectSandbox(true);
  /**
 * A shell constructor for `ZeroClipboard` client instances.
 *
 * @constructor
 */
  var ZeroClipboard = function() {
    if (!(this instanceof ZeroClipboard)) {
      return new ZeroClipboard();
    }
    if (typeof ZeroClipboard._createClient === "function") {
      ZeroClipboard._createClient.apply(this, _args(arguments));
    }
  };
  /**
 * The ZeroClipboard library's version number.
 *
 * @static
 * @readonly
 * @property {string}
 */
  _defineProperty(ZeroClipboard, "version", {
    value: "2.2.0",
    writable: false,
    configurable: true,
    enumerable: true
  });
  /**
 * Update or get a copy of the ZeroClipboard global configuration.
 * Returns a copy of the current/updated configuration.
 *
 * @returns Object
 * @static
 */
  ZeroClipboard.config = function() {
    return _config.apply(this, _args(arguments));
  };
  /**
 * Diagnostic method that describes the state of the browser, Flash Player, and ZeroClipboard.
 *
 * @returns Object
 * @static
 */
  ZeroClipboard.state = function() {
    return _state.apply(this, _args(arguments));
  };
  /**
 * Check if Flash is unusable for any reason: disabled, outdated, deactivated, etc.
 *
 * @returns Boolean
 * @static
 */
  ZeroClipboard.isFlashUnusable = function() {
    return _isFlashUnusable.apply(this, _args(arguments));
  };
  /**
 * Register an event listener.
 *
 * @returns `ZeroClipboard`
 * @static
 */
  ZeroClipboard.on = function() {
    return _on.apply(this, _args(arguments));
  };
  /**
 * Unregister an event listener.
 * If no `listener` function/object is provided, it will unregister all listeners for the provided `eventType`.
 * If no `eventType` is provided, it will unregister all listeners for every event type.
 *
 * @returns `ZeroClipboard`
 * @static
 */
  ZeroClipboard.off = function() {
    return _off.apply(this, _args(arguments));
  };
  /**
 * Retrieve event listeners for an `eventType`.
 * If no `eventType` is provided, it will retrieve all listeners for every event type.
 *
 * @returns array of listeners for the `eventType`; if no `eventType`, then a map/hash object of listeners for all event types; or `null`
 */
  ZeroClipboard.handlers = function() {
    return _listeners.apply(this, _args(arguments));
  };
  /**
 * Event emission receiver from the Flash object, forwarding to any registered JavaScript event listeners.
 *
 * @returns For the "copy" event, returns the Flash-friendly "clipData" object; otherwise `undefined`.
 * @static
 */
  ZeroClipboard.emit = function() {
    return _emit.apply(this, _args(arguments));
  };
  /**
 * Create and embed the Flash object.
 *
 * @returns The Flash object
 * @static
 */
  ZeroClipboard.create = function() {
    return _create.apply(this, _args(arguments));
  };
  /**
 * Self-destruct and clean up everything, including the embedded Flash object.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.destroy = function() {
    return _destroy.apply(this, _args(arguments));
  };
  /**
 * Set the pending data for clipboard injection.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.setData = function() {
    return _setData.apply(this, _args(arguments));
  };
  /**
 * Clear the pending data for clipboard injection.
 * If no `format` is provided, all pending data formats will be cleared.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.clearData = function() {
    return _clearData.apply(this, _args(arguments));
  };
  /**
 * Get a copy of the pending data for clipboard injection.
 * If no `format` is provided, a copy of ALL pending data formats will be returned.
 *
 * @returns `String` or `Object`
 * @static
 */
  ZeroClipboard.getData = function() {
    return _getData.apply(this, _args(arguments));
  };
  /**
 * Sets the current HTML object that the Flash object should overlay. This will put the global
 * Flash object on top of the current element; depending on the setup, this may also set the
 * pending clipboard text data as well as the Flash object's wrapping element's title attribute
 * based on the underlying HTML element and ZeroClipboard configuration.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.focus = ZeroClipboard.activate = function() {
    return _focus.apply(this, _args(arguments));
  };
  /**
 * Un-overlays the Flash object. This will put the global Flash object off-screen; depending on
 * the setup, this may also unset the Flash object's wrapping element's title attribute based on
 * the underlying HTML element and ZeroClipboard configuration.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.blur = ZeroClipboard.deactivate = function() {
    return _blur.apply(this, _args(arguments));
  };
  /**
 * Returns the currently focused/"activated" HTML element that the Flash object is wrapping.
 *
 * @returns `HTMLElement` or `null`
 * @static
 */
  ZeroClipboard.activeElement = function() {
    return _activeElement.apply(this, _args(arguments));
  };
  /**
 * Keep track of the ZeroClipboard client instance counter.
 */
  var _clientIdCounter = 0;
  /**
 * Keep track of the state of the client instances.
 *
 * Entry structure:
 *   _clientMeta[client.id] = {
 *     instance: client,
 *     elements: [],
 *     handlers: {}
 *   };
 */
  var _clientMeta = {};
  /**
 * Keep track of the ZeroClipboard clipped elements counter.
 */
  var _elementIdCounter = 0;
  /**
 * Keep track of the state of the clipped element relationships to clients.
 *
 * Entry structure:
 *   _elementMeta[element.zcClippingId] = [client1.id, client2.id];
 */
  var _elementMeta = {};
  /**
 * Keep track of the state of the mouse event handlers for clipped elements.
 *
 * Entry structure:
 *   _mouseHandlers[element.zcClippingId] = {
 *     mouseover:  function(event) {},
 *     mouseout:   function(event) {},
 *     mouseenter: function(event) {},
 *     mouseleave: function(event) {},
 *     mousemove:  function(event) {}
 *   };
 */
  var _mouseHandlers = {};
  /**
 * Extending the ZeroClipboard configuration defaults for the Client module.
 */
  _extend(_globalConfig, {
    autoActivate: true
  });
  /**
 * The real constructor for `ZeroClipboard` client instances.
 * @private
 */
  var _clientConstructor = function(elements) {
    var client = this;
    client.id = "" + _clientIdCounter++;
    _clientMeta[client.id] = {
      instance: client,
      elements: [],
      handlers: {}
    };
    if (elements) {
      client.clip(elements);
    }
    ZeroClipboard.on("*", function(event) {
      return client.emit(event);
    });
    ZeroClipboard.on("destroy", function() {
      client.destroy();
    });
    ZeroClipboard.create();
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.on`.
 * @private
 */
  var _clientOn = function(eventType, listener) {
    var i, len, events, added = {}, meta = _clientMeta[this.id], handlers = meta && meta.handlers;
    if (!meta) {
      throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");
    }
    if (typeof eventType === "string" && eventType) {
      events = eventType.toLowerCase().split(/\s+/);
    } else if (typeof eventType === "object" && eventType && typeof listener === "undefined") {
      for (i in eventType) {
        if (_hasOwn.call(eventType, i) && typeof i === "string" && i && typeof eventType[i] === "function") {
          this.on(i, eventType[i]);
        }
      }
    }
    if (events && events.length) {
      for (i = 0, len = events.length; i < len; i++) {
        eventType = events[i].replace(/^on/, "");
        added[eventType] = true;
        if (!handlers[eventType]) {
          handlers[eventType] = [];
        }
        handlers[eventType].push(listener);
      }
      if (added.ready && _flashState.ready) {
        this.emit({
          type: "ready",
          client: this
        });
      }
      if (added.error) {
        for (i = 0, len = _flashStateErrorNames.length; i < len; i++) {
          if (_flashState[_flashStateErrorNames[i].replace(/^flash-/, "")]) {
            this.emit({
              type: "error",
              name: _flashStateErrorNames[i],
              client: this
            });
            break;
          }
        }
        if (_zcSwfVersion !== undefined && ZeroClipboard.version !== _zcSwfVersion) {
          this.emit({
            type: "error",
            name: "version-mismatch",
            jsVersion: ZeroClipboard.version,
            swfVersion: _zcSwfVersion
          });
        }
      }
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.off`.
 * @private
 */
  var _clientOff = function(eventType, listener) {
    var i, len, foundIndex, events, perEventHandlers, meta = _clientMeta[this.id], handlers = meta && meta.handlers;
    if (!handlers) {
      return this;
    }
    if (arguments.length === 0) {
      events = _keys(handlers);
    } else if (typeof eventType === "string" && eventType) {
      events = eventType.split(/\s+/);
    } else if (typeof eventType === "object" && eventType && typeof listener === "undefined") {
      for (i in eventType) {
        if (_hasOwn.call(eventType, i) && typeof i === "string" && i && typeof eventType[i] === "function") {
          this.off(i, eventType[i]);
        }
      }
    }
    if (events && events.length) {
      for (i = 0, len = events.length; i < len; i++) {
        eventType = events[i].toLowerCase().replace(/^on/, "");
        perEventHandlers = handlers[eventType];
        if (perEventHandlers && perEventHandlers.length) {
          if (listener) {
            foundIndex = perEventHandlers.indexOf(listener);
            while (foundIndex !== -1) {
              perEventHandlers.splice(foundIndex, 1);
              foundIndex = perEventHandlers.indexOf(listener, foundIndex);
            }
          } else {
            perEventHandlers.length = 0;
          }
        }
      }
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.handlers`.
 * @private
 */
  var _clientListeners = function(eventType) {
    var copy = null, handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;
    if (handlers) {
      if (typeof eventType === "string" && eventType) {
        copy = handlers[eventType] ? handlers[eventType].slice(0) : [];
      } else {
        copy = _deepCopy(handlers);
      }
    }
    return copy;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.emit`.
 * @private
 */
  var _clientEmit = function(event) {
    if (_clientShouldEmit.call(this, event)) {
      if (typeof event === "object" && event && typeof event.type === "string" && event.type) {
        event = _extend({}, event);
      }
      var eventCopy = _extend({}, _createEvent(event), {
        client: this
      });
      _clientDispatchCallbacks.call(this, eventCopy);
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.clip`.
 * @private
 */
  var _clientClip = function(elements) {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");
    }
    elements = _prepClip(elements);
    for (var i = 0; i < elements.length; i++) {
      if (_hasOwn.call(elements, i) && elements[i] && elements[i].nodeType === 1) {
        if (!elements[i].zcClippingId) {
          elements[i].zcClippingId = "zcClippingId_" + _elementIdCounter++;
          _elementMeta[elements[i].zcClippingId] = [ this.id ];
          if (_globalConfig.autoActivate === true) {
            _addMouseHandlers(elements[i]);
          }
        } else if (_elementMeta[elements[i].zcClippingId].indexOf(this.id) === -1) {
          _elementMeta[elements[i].zcClippingId].push(this.id);
        }
        var clippedElements = _clientMeta[this.id] && _clientMeta[this.id].elements;
        if (clippedElements.indexOf(elements[i]) === -1) {
          clippedElements.push(elements[i]);
        }
      }
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.unclip`.
 * @private
 */
  var _clientUnclip = function(elements) {
    var meta = _clientMeta[this.id];
    if (!meta) {
      return this;
    }
    var clippedElements = meta.elements;
    var arrayIndex;
    if (typeof elements === "undefined") {
      elements = clippedElements.slice(0);
    } else {
      elements = _prepClip(elements);
    }
    for (var i = elements.length; i--; ) {
      if (_hasOwn.call(elements, i) && elements[i] && elements[i].nodeType === 1) {
        arrayIndex = 0;
        while ((arrayIndex = clippedElements.indexOf(elements[i], arrayIndex)) !== -1) {
          clippedElements.splice(arrayIndex, 1);
        }
        var clientIds = _elementMeta[elements[i].zcClippingId];
        if (clientIds) {
          arrayIndex = 0;
          while ((arrayIndex = clientIds.indexOf(this.id, arrayIndex)) !== -1) {
            clientIds.splice(arrayIndex, 1);
          }
          if (clientIds.length === 0) {
            if (_globalConfig.autoActivate === true) {
              _removeMouseHandlers(elements[i]);
            }
            delete elements[i].zcClippingId;
          }
        }
      }
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.elements`.
 * @private
 */
  var _clientElements = function() {
    var meta = _clientMeta[this.id];
    return meta && meta.elements ? meta.elements.slice(0) : [];
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.destroy`.
 * @private
 */
  var _clientDestroy = function() {
    if (!_clientMeta[this.id]) {
      return;
    }
    this.unclip();
    this.off();
    delete _clientMeta[this.id];
  };
  /**
 * Inspect an Event to see if the Client (`this`) should honor it for emission.
 * @private
 */
  var _clientShouldEmit = function(event) {
    if (!(event && event.type)) {
      return false;
    }
    if (event.client && event.client !== this) {
      return false;
    }
    var meta = _clientMeta[this.id];
    var clippedEls = meta && meta.elements;
    var hasClippedEls = !!clippedEls && clippedEls.length > 0;
    var goodTarget = !event.target || hasClippedEls && clippedEls.indexOf(event.target) !== -1;
    var goodRelTarget = event.relatedTarget && hasClippedEls && clippedEls.indexOf(event.relatedTarget) !== -1;
    var goodClient = event.client && event.client === this;
    if (!meta || !(goodTarget || goodRelTarget || goodClient)) {
      return false;
    }
    return true;
  };
  /**
 * Handle the actual dispatching of events to a client instance.
 *
 * @returns `undefined`
 * @private
 */
  var _clientDispatchCallbacks = function(event) {
    var meta = _clientMeta[this.id];
    if (!(typeof event === "object" && event && event.type && meta)) {
      return;
    }
    var async = _shouldPerformAsync(event);
    var wildcardTypeHandlers = meta && meta.handlers["*"] || [];
    var specificTypeHandlers = meta && meta.handlers[event.type] || [];
    var handlers = wildcardTypeHandlers.concat(specificTypeHandlers);
    if (handlers && handlers.length) {
      var i, len, func, context, eventCopy, originalContext = this;
      for (i = 0, len = handlers.length; i < len; i++) {
        func = handlers[i];
        context = originalContext;
        if (typeof func === "string" && typeof _window[func] === "function") {
          func = _window[func];
        }
        if (typeof func === "object" && func && typeof func.handleEvent === "function") {
          context = func;
          func = func.handleEvent;
        }
        if (typeof func === "function") {
          eventCopy = _extend({}, event);
          _dispatchCallback(func, context, [ eventCopy ], async);
        }
      }
    }
  };
  /**
 * Prepares the elements for clipping/unclipping.
 *
 * @returns An Array of elements.
 * @private
 */
  var _prepClip = function(elements) {
    if (typeof elements === "string") {
      elements = [];
    }
    return typeof elements.length !== "number" ? [ elements ] : elements;
  };
  /**
 * Add a `mouseover` handler function for a clipped element.
 *
 * @returns `undefined`
 * @private
 */
  var _addMouseHandlers = function(element) {
    if (!(element && element.nodeType === 1)) {
      return;
    }
    var _suppressMouseEvents = function(event) {
      if (!(event || (event = _window.event))) {
        return;
      }
      if (event._source !== "js") {
        event.stopImmediatePropagation();
        event.preventDefault();
      }
      delete event._source;
    };
    var _elementMouseOver = function(event) {
      if (!(event || (event = _window.event))) {
        return;
      }
      _suppressMouseEvents(event);
      ZeroClipboard.focus(element);
    };
    element.addEventListener("mouseover", _elementMouseOver, false);
    element.addEventListener("mouseout", _suppressMouseEvents, false);
    element.addEventListener("mouseenter", _suppressMouseEvents, false);
    element.addEventListener("mouseleave", _suppressMouseEvents, false);
    element.addEventListener("mousemove", _suppressMouseEvents, false);
    _mouseHandlers[element.zcClippingId] = {
      mouseover: _elementMouseOver,
      mouseout: _suppressMouseEvents,
      mouseenter: _suppressMouseEvents,
      mouseleave: _suppressMouseEvents,
      mousemove: _suppressMouseEvents
    };
  };
  /**
 * Remove a `mouseover` handler function for a clipped element.
 *
 * @returns `undefined`
 * @private
 */
  var _removeMouseHandlers = function(element) {
    if (!(element && element.nodeType === 1)) {
      return;
    }
    var mouseHandlers = _mouseHandlers[element.zcClippingId];
    if (!(typeof mouseHandlers === "object" && mouseHandlers)) {
      return;
    }
    var key, val, mouseEvents = [ "move", "leave", "enter", "out", "over" ];
    for (var i = 0, len = mouseEvents.length; i < len; i++) {
      key = "mouse" + mouseEvents[i];
      val = mouseHandlers[key];
      if (typeof val === "function") {
        element.removeEventListener(key, val, false);
      }
    }
    delete _mouseHandlers[element.zcClippingId];
  };
  /**
 * Creates a new ZeroClipboard client instance.
 * Optionally, auto-`clip` an element or collection of elements.
 *
 * @constructor
 */
  ZeroClipboard._createClient = function() {
    _clientConstructor.apply(this, _args(arguments));
  };
  /**
 * Register an event listener to the client.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.on = function() {
    return _clientOn.apply(this, _args(arguments));
  };
  /**
 * Unregister an event handler from the client.
 * If no `listener` function/object is provided, it will unregister all handlers for the provided `eventType`.
 * If no `eventType` is provided, it will unregister all handlers for every event type.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.off = function() {
    return _clientOff.apply(this, _args(arguments));
  };
  /**
 * Retrieve event listeners for an `eventType` from the client.
 * If no `eventType` is provided, it will retrieve all listeners for every event type.
 *
 * @returns array of listeners for the `eventType`; if no `eventType`, then a map/hash object of listeners for all event types; or `null`
 */
  ZeroClipboard.prototype.handlers = function() {
    return _clientListeners.apply(this, _args(arguments));
  };
  /**
 * Event emission receiver from the Flash object for this client's registered JavaScript event listeners.
 *
 * @returns For the "copy" event, returns the Flash-friendly "clipData" object; otherwise `undefined`.
 */
  ZeroClipboard.prototype.emit = function() {
    return _clientEmit.apply(this, _args(arguments));
  };
  /**
 * Register clipboard actions for new element(s) to the client.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.clip = function() {
    return _clientClip.apply(this, _args(arguments));
  };
  /**
 * Unregister the clipboard actions of previously registered element(s) on the page.
 * If no elements are provided, ALL registered elements will be unregistered.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.unclip = function() {
    return _clientUnclip.apply(this, _args(arguments));
  };
  /**
 * Get all of the elements to which this client is clipped.
 *
 * @returns array of clipped elements
 */
  ZeroClipboard.prototype.elements = function() {
    return _clientElements.apply(this, _args(arguments));
  };
  /**
 * Self-destruct and clean up everything for a single client.
 * This will NOT destroy the embedded Flash object.
 *
 * @returns `undefined`
 */
  ZeroClipboard.prototype.destroy = function() {
    return _clientDestroy.apply(this, _args(arguments));
  };
  /**
 * Stores the pending plain text to inject into the clipboard.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.setText = function(text) {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.setData("text/plain", text);
    return this;
  };
  /**
 * Stores the pending HTML text to inject into the clipboard.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.setHtml = function(html) {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.setData("text/html", html);
    return this;
  };
  /**
 * Stores the pending rich text (RTF) to inject into the clipboard.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.setRichText = function(richText) {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.setData("application/rtf", richText);
    return this;
  };
  /**
 * Stores the pending data to inject into the clipboard.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.setData = function() {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.setData.apply(this, _args(arguments));
    return this;
  };
  /**
 * Clears the pending data to inject into the clipboard.
 * If no `format` is provided, all pending data formats will be cleared.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.clearData = function() {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.clearData.apply(this, _args(arguments));
    return this;
  };
  /**
 * Gets a copy of the pending data to inject into the clipboard.
 * If no `format` is provided, a copy of ALL pending data formats will be returned.
 *
 * @returns `String` or `Object`
 */
  ZeroClipboard.prototype.getData = function() {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    return ZeroClipboard.getData.apply(this, _args(arguments));
  };
  if (typeof define === "function" && define.amd) {
    define(function() {
      return ZeroClipboard;
    });
  } else if (typeof module === "object" && module && typeof module.exports === "object" && module.exports) {
    module.exports = ZeroClipboard;
  } else {
    window.ZeroClipboard = ZeroClipboard;
  }
})(function() {
  return this || window;
}());;
;
/* module-key = 'bamboo.web.resources:lib-zeroclipboard', location = '/util/shims/zeroclipboard.js' */
define('zeroclipboard', function() {
    return ZeroClipboard;
});;
;
/* module-key = 'bamboo.web.resources.common:widget-copy-clipboard', location = '/widget/copy-clipboard/copy-clipboard.soy' */
// This file was automatically generated from copy-clipboard.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.copyclipboard.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.copyclipboard == 'undefined') { bamboo.widget.copyclipboard = {}; }


bamboo.widget.copyclipboard.element = function(opt_data, opt_ignored) {
  return '' + aui.icons.icon({tagName: 'copy-clipboard', useIconFont: true, icon: 'copy-clipboard', accessibilityText: opt_data.text, extraAttributes: {'data-clipboard-text': opt_data.text, 'data-message': opt_data.copyMessage, 'data-message-complete': opt_data.copyCompleteMessage}});
};
if (goog.DEBUG) {
  bamboo.widget.copyclipboard.element.soyTemplateName = 'bamboo.widget.copyclipboard.element';
}
;
;
/* module-key = 'bamboo.web.resources.common:widget-copy-clipboard', location = '/widget/copy-clipboard/copy-clipboard.js' */
require([
    'jquery',
    'aui/internal/skate',
    'zeroclipboard'
], function($, skate, ZeroClipboard) {
    'use strict';

    $(function() {
        var client = new ZeroClipboard();

        var attachTipsy = function($element) {
            $element.tipsy({
                title: 'data-message',
                delayIn: 0,
                delayOut: 100,
                trigger: 'hover'
            });
        };

        client.on('ready', function() {
            skate('copy-clipboard', {
                attached: function(element) {
                    var $element = $(element);
                    $element.attr('data-original-message', $element.attr('data-message'));

                    client.clip(element);
                    attachTipsy($element);
                },
                detached: function(element) {
                    client.unclip(element);
                }
            });
        });

        client.on('copy', function(e) {
            var $element = $(e.target);
            $element.attr('data-message', $element.attr('data-message-complete'))
                .tipsy('show');

            // restore original title
            $element.one('mouseout', function() {
                $element.attr('data-message', $element.attr('data-original-message'));
            });
        });
    });
});
;
;
/* module-key = 'com.atlassian.auiplugin:aui-trigger', location = '/js/aui/trigger.js' */
(function(f){var e=f(AJS.$,window.skate);define("aui/trigger",[],function(){return e})})(function(f,e){function d(a,b){if(a.isEnabled()){var c=document.getElementById(a.getAttribute("aria-controls"));c&&c.message&&c.message(b)}}e("data-aui-trigger",{type:e.types.ATTR,events:{click:function(a,b){var c=f(b.target).closest("a[href]",a);c.length&&c[0]!==a||(d(a,b),b.preventDefault())},mouseenter:function(a,b){d(a,b)},mouseleave:function(a,b){d(a,b)},focus:function(a,b){d(a,b)},blur:function(a,b){d(a,
b)}},prototype:{disable:function(){this.setAttribute("aria-disabled","true")},enable:function(){this.setAttribute("aria-disabled","false")},isEnabled:function(){return"true"!==this.getAttribute("aria-disabled")}}})});;
;
/* module-key = 'com.atlassian.auiplugin:aui-trigger', location = '/soy/trigger.soy' */
// This file was automatically generated from trigger.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.trigger.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.trigger == 'undefined') { aui.trigger = {}; }


aui.trigger.trigger = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'a') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '" ' : '') + ' class="' + aui.renderExtraClasses(opt_data) + '" aria-controls="' + soy.$$escapeHtml(opt_data.menu.id) + '" aria-haspopup="true" role="button"' + ((opt_data.title) ? ' title="' + soy.$$escapeHtml(opt_data.title) + '"' : '') + ((opt_data.container) ? ' data-container="' + soy.$$escapeHtml(opt_data.container) + '"' : '') + (((! opt_data.tagName || opt_data.tagName == 'a') && (! opt_data.extraAttributes || Object.prototype.toString.call(opt_data.extraAttributes) === '[object Object]' && ! opt_data.extraAttributes.href && ! opt_data.extraAttributes.tabindex || (! opt_data.extraAttributes.href || ! opt_data.extraAttributes.tabindex))) ? ' tabindex="0"' : '') + ' data-aui-trigger' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + ((! (opt_data.showIcon == false)) ? '<span class="icon ' + soy.$$escapeHtml(opt_data.iconClasses ? opt_data.iconClasses : 'aui-icon-dropdown') + '">' + ((opt_data.iconText) ? soy.$$escapeHtml(opt_data.iconText) : '') + '</span>' : '') + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'a') + '>';
};
if (goog.DEBUG) {
  aui.trigger.trigger.soyTemplateName = 'aui.trigger.trigger';
}
;
;
/* module-key = 'com.atlassian.auiplugin:aui-inline-dialog2', location = '/js/aui/inline-dialog2.js' */
(function(d){var e=d();define("aui/inline-dialog2",["aui/internal/skate","./internal/alignment","./trigger","../layer"],function(){return e})})(function(){function d(a,b){var c=document.querySelector('[aria-controls="'+a.id+'"]');c&&b(c)}var e=window.jQuery,f=AJS.Alignment,c=AJS.layer,g=window.skate,h={click:function(a){a.isVisible()?c(a).isPersistent()||a.hide():a.show()},mouseenter:function(a){a.isVisible()||a.show();a._clearMouseleaveTimeout&&a._clearMouseleaveTimeout()},mouseleave:function(a){if(!c(a).isPersistent()&&
a.isVisible()){a._clearMouseleaveTimeout&&a._clearMouseleaveTimeout();var b=setTimeout(function(){a.mouseInside||a.hide()},1E3);a._clearMouseleaveTimeout=function(){clearTimeout(b);a._clearMouseleaveTimeout=null}}},focus:function(a){a.isVisible()||a.show()},blur:function(a){!c(a).isPersistent()&&a.isVisible()&&a.hide()}};return g("aui-inline-dialog2",{type:g.types.TAG,prototype:{show:function(){var a=this;c(this).show();d(this,function(b){a._auiAlignment||(a._auiAlignment=new f(a,b));a._auiAlignment.enable();
b.setAttribute("aria-expanded","true")});return this},hide:function(){var a=this;c(this).hide();d(this,function(b){a._auiAlignment||(a._auiAlignment=new f(a,b));a._auiAlignment.disable();b.setAttribute("aria-expanded","false")});return this},isVisible:function(){return c(this).isVisible()},message:function(a){var b={toggle:["click"],hover:["mouseenter","mouseleave","focus","blur"]}[this.getAttribute("responds-to")||this.getAttribute("data-aui-responds-to")];if(b&&-1<b.indexOf(a.type))h[a.type](this,
a);return this}},created:function(a){d(a,function(b){b.setAttribute("aria-expanded",a.isVisible());b.setAttribute("aria-haspopup","true")});"hover"===a.getAttribute("responds-to")&&(a.mouseInside=!1,a.addEventListener("mouseenter",function(){a.mouseInside=!0;a.message({type:"mouseenter"})}),a.addEventListener("mouseleave",function(){a.mouseInside=!1;a.message({type:"mouseleave"})}))},detached:function(a){a._auiAlignment&&a._auiAlignment.destroy()},template:function(a){e(a).addClass("aui-layer").attr("aria-hidden",
"true").html('<div class="aui-inline-dialog-contents">'+a.innerHTML+"</div>")}})});;
;
/* module-key = 'com.atlassian.auiplugin:aui-inline-dialog2', location = 'soy/inline-dialog2.soy' */
// This file was automatically generated from inline-dialog2.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.inlineDialog2.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.inlineDialog2 == 'undefined') { aui.inlineDialog2 = {}; }


aui.inlineDialog2.inlineDialog2 = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog2 ' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + '  class="' + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.alignment) ? 'alignment="' + soy.$$escapeHtml(opt_data.alignment) + '"' : '') + ((opt_data.respondsTo) ? 'responds-to="' + soy.$$escapeHtml(opt_data.respondsTo) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</aui-inline-dialog2>';
};
if (goog.DEBUG) {
  aui.inlineDialog2.inlineDialog2.soyTemplateName = 'aui.inlineDialog2.inlineDialog2';
}


aui.inlineDialog2.trigger = function(opt_data, opt_ignored) {
  return '' + aui.trigger.trigger(soy.$$augmentMap(opt_data, {showIcon: opt_data.showIcon ? opt_data.showIcon : false}));
};
if (goog.DEBUG) {
  aui.inlineDialog2.trigger.soyTemplateName = 'aui.inlineDialog2.trigger';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/header/branch-selection-view.js' */
define("branchinator/views/layout/header/branch-selection-view",["backbone","branchinator/utils/branchinator-utils","branchinator/utils/radio-utils"],function(c,a,b){return Marionette.ItemView.extend({tagName:"span",ui:{repoSelector:"#repoSelector",branchSelector:"#branchSelector",copyLink:"#copyBranchNameLink"},modelEvents:{"repo:selected":"onRepoSelected","repo:cleared":"onRepoCleared","branch:selected":"onBranchSelected","branch:cleared":"onBranchCleared"},events:{"change @ui.repoSelector":"onRepoSelectorChange","change @ui.branchSelector":"onBranchSelectorChange"},template:function(){return bamboo.plugins.branchinator.renderBranchSelectionView()},onShow:function(){this.ui.repoSelector.auiSelect2({placeholder:"Select shared repository",minimumInputLength:0,dropdownCssClass:"repoSelectorDropdown",ajax:{url:a.getRestUrl("repos"),dataType:"json",data:function(d,e){return{searchTerm:d}},results:function(e,d){return{results:e}},cache:true,params:{error:this.onFetchError.bind(this)}},formatResult:function(d){return d.name},formatSelection:function(d){return d.name}});this.ui.branchSelector.auiSelect2({placeholder:"Select VCS branch",minimumInputLength:0,dropdownCssClass:"branchSelectorDropdown",ajax:{url:function(){return a.getRestUrl("branches?repoId={0}",this.model.get("repo").id)}.bind(this),dataType:"json",data:function(d,e){return{searchTerm:d}},results:function(e,d){return{results:e}},cache:false,params:{error:this.onFetchError.bind(this)}},id:function(d){return d.branchName},formatResult:function(d){return d.branchName},formatSelection:function(d){return bamboo.plugins.branchinator.renderBranchSelection({branch:d.branchName})}});this.ui.branchSelector.auiSelect2("enable",false)},onRepoSelectorChange:function(f){var d=this.ui.repoSelector.auiSelect2("data");this.model.selectRepo(d.id,d.name)},onBranchSelectorChange:function(d){this.model.selectBranch(d.val)},onRepoCleared:function(){this.ui.repoSelector.val("");this.ui.repoSelector.auiSelect2("data","");this.ui.branchSelector.auiSelect2("enable",false);this.ui.copyLink.empty()},onRepoSelected:function(d){this.ui.repoSelector.val(d.id);this.ui.repoSelector.auiSelect2("data",{id:d.id,name:d.name});this.ui.branchSelector.auiSelect2("enable",true);this.ui.copyLink.empty()},onBranchCleared:function(){this.ui.branchSelector.val("");this.ui.branchSelector.auiSelect2("data","");this.ui.copyLink.empty()},onBranchSelected:function(e){var d=e.branch.branchName;this.ui.branchSelector.val(e.branch.id);this.ui.branchSelector.auiSelect2("data",{id:e.branch.id,branchName:d});this.ui.copyLink.html(bamboo.plugins.branchinator.renderCopyBranchLink({branchName:d}))},onFetchError:function(d){if(d.status!==0||d.statusText!=="abort"){b.trigger("message:error",a.getErrorFromResponse(d))}}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/dialogs/discovery-dialog.js' */
define("branchinator/dialogs/discovery-dialog",["backbone","branchinator/utils/branchinator-utils","jquery","util/ajax"],function(d,a,c,b){return d.View.extend({events:{"click .close":"onCloseDialog"},initialize:function(){this.dialog=this.$el.get(0);this.dialog.show()},onCloseDialog:function(){if(this.$el.is(":visible")){this.$el.hide()}this.saveDialogDisplayed().done(function(){c("#branchStatusLink").addClass("persisted")})},saveDialogDisplayed:function(){var f="plan.page.navigation.discovery.dialog.displayed";var e={property:f,value:"true"};return b({url:a.getRestUrl("config/user/{0}",f),type:"PUT",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/behaviors/fetch-state-aware-behavior.js' */
define("branchinator/behaviors/fetch-state-aware-behavior",["marionette"],function(b){var a={request:"onFetchStarted","sync error":"onFetchEnded"};return b.Behavior.extend({collectionEvents:a,modelEvents:a,initialize:function(){this.fetchState={fetched:false,fetching:false};this.view.isFetched=this.isFetched.bind(this);this.view.isFetching=this.isFetching.bind(this)},onFetchStarted:function(){this.fetchState.fetching=true},onFetchEnded:function(){this.fetchState.fetching=false;if(!this.fetchState.fetched){this.fetchState.fetched=true;this.view.triggerMethod("initial:fetch:complete")}},isFetched:function(){return this.fetchState.fetched},isFetching:function(){return this.fetchState.fetching}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/collections/recent-branches-collection.js' */
define("branchinator/collections/recent-branches-collection",["backbone","branchinator/utils/branchinator-utils"],function(b,a){return b.Collection.extend({url:a.getRestUrl("recent/branch")})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/utils/branchinator-utils.js' */
define("branchinator/utils/branchinator-utils",[],function(){var c=AJS.contextPath()+"/branchStatus";var b=AJS.contextPath()+"/rest/branchStatus/latest/";var a=(function(){var d=document.createElement("fakeElement");var e={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(var f in e){if(d.style[f]!==undefined){return e[f]}}})();return Object.freeze({getApplicationRootUrl:function(){return c},getRestUrl:function(){return b+AJS.format.apply(null,arguments)},getRepoUrlPath:function(d,e){return(d&&e)?d+"/"+this.slashSafeUrlEncode(e):""},getRepoAndBranchUrlPath:function(e,f,d){return this.getRepoUrlPath(e,f)+(d?"/"+this.slashSafeUrlEncode(d):"")},slashSafeUrlEncode:function(d){if(d){return encodeURIComponent(d).replace(/%2[fF]/g,"%252F").replace(/%5C/,"%255C")}},slashSafeUrlDecode:function(d){if(d){return d.replace(/%2[fF]/g,"/").replace(/%5C/,"\\")}},getErrorFromResponse:function(d){var f=d.responseJSON;var e=f&&f.errors&&f.errors[0];return e||"An error occurred while trying to update the branch view. Please select a different repository/branch or reload the page."},getAnimationCompletedEventName:function(){return a}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/content/landing-page-recent-branch-view.js' */
define("branchinator/views/layout/content/landing-page-recent-branch-view",["branchinator/utils/branchinator-utils","marionette"],function(a,b){return b.ItemView.extend({tagName:"li",ui:{branchSuggestion:".branchSuggestion"},triggers:{"click @ui.branchSuggestion":"recent:branch:selected"},template:function(c){return bamboo.plugins.branchinator.renderLandingPageRecentBranchView({recentBranch:c})},onRender:function(){var c=a.getRepoAndBranchUrlPath(this.model.get("repoId"),this.model.get("repoName"),this.model.get("branchName"));this.ui.branchSuggestion.attr("href",a.getApplicationRootUrl()+"/"+c);return this}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/header-view.js' */
define("branchinator/views/layout/header-view",["branchinator/views/layout/header/branch-selection-view","jquery","marionette"],function(c,a,b){return b.LayoutView.extend({id:"branchStatusHeader",tagName:"header",className:"aui-page-header",regions:{branchSelection:"#branchSelectionContainer"},template:function(){return bamboo.plugins.branchinator.renderHeaderView()},initialize:function(d){this.options=d},onShow:function(){if(this.getOption("hasRepositories")){this.branchSelection.show(new c({model:this.model}))}}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/soy/branchinator.soy' */
// This file was automatically generated from branchinator.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.plugins.branchinator.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.plugins == 'undefined') { bamboo.plugins = {}; }
if (typeof bamboo.plugins.branchinator == 'undefined') { bamboo.plugins.branchinator = {}; }


bamboo.plugins.branchinator.renderLayoutView = function(opt_data, opt_ignored) {
  return '<div id="headerContainer"></div><div id="messagesContainer"></div><div id="contentContainer"></div>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderLayoutView.soyTemplateName = 'bamboo.plugins.branchinator.renderLayoutView';
}


bamboo.plugins.branchinator.renderHeaderView = function(opt_data, opt_ignored) {
  return '<div class="aui-page-header-inner"><div class="aui-page-header-main"><ol id="breadcrumb" class="aui-nav aui-nav-breadcrumbs"><li><a href="' + soy.$$escapeHtml("") + '/allPlans.action">' + soy.$$escapeHtml("Build projects") + '</a></li></ol><h1>' + soy.$$escapeHtml("Branch status") + '</h1><span id="branchSelectionContainer"></span></div></div>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderHeaderView.soyTemplateName = 'bamboo.plugins.branchinator.renderHeaderView';
}


bamboo.plugins.branchinator.renderContentView = function(opt_data, opt_ignored) {
  return '<div id="landingPageContainer"></div><div id="buildsContainer"></div>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderContentView.soyTemplateName = 'bamboo.plugins.branchinator.renderContentView';
}


bamboo.plugins.branchinator.renderBranchSelectionView = function(opt_data, opt_ignored) {
  return '<form id="branchSelectionForm" class="aui"><span><input id="repoSelector"/></span><span><input id="branchSelector"/></span><span id="copyBranchNameLink"></span></form>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBranchSelectionView.soyTemplateName = 'bamboo.plugins.branchinator.renderBranchSelectionView';
}


bamboo.plugins.branchinator.renderCopyBranchLink = function(opt_data, opt_ignored) {
  return '' + bamboo.widget.copyclipboard.element({text: opt_data.branchName, copyMessage: "Click to copy branch name", copyCompleteMessage: "Copied!"});
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderCopyBranchLink.soyTemplateName = 'bamboo.plugins.branchinator.renderCopyBranchLink';
}


bamboo.plugins.branchinator.renderBranchSelection = function(opt_data, opt_ignored) {
  return aui.icons.icon({useIconFont: true, icon: 'devtools-branch'}) + ' ' + soy.$$escapeHtml(opt_data.branch);
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBranchSelection.soyTemplateName = 'bamboo.plugins.branchinator.renderBranchSelection';
}


bamboo.plugins.branchinator.renderLandingPageView = function(opt_data, opt_ignored) {
  return '<img id="landingPageLogo" src="' + soy.$$escapeHtml("") + '/download/resources/com.atlassian.bamboo.plugins.branchinator:branchinator-resources/images/landingPage.png"/><h1>' + soy.$$escapeHtml("Track and handle build plans of your branches") + '</h1><p>' + soy.$$escapeHtml("Pick a branch to view build statuses and manage plan assignments.") + ' <a href="' + soy.$$escapeHtml("http://docs.atlassian.com/bamboo/docs-0515/") + soy.$$escapeHtml("Using+plan+branches") + '">' + soy.$$escapeHtml("Learn more") + '</a></p><h3>' + soy.$$escapeHtml("Recently visited branches") + '</h3><div id="recentlyVisited"><ul class="branchSuggestions"></ul></div>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderLandingPageView.soyTemplateName = 'bamboo.plugins.branchinator.renderLandingPageView';
}


bamboo.plugins.branchinator.renderLandingPageRecentBranchView = function(opt_data, opt_ignored) {
  return '<a href="#" class="branchSuggestion" title="' + soy.$$escapeHtml(opt_data.recentBranch.branchName) + '" data-repository-id="' + soy.$$escapeHtml(opt_data.recentBranch.repoId) + '" data-repository-name="' + soy.$$escapeHtml(opt_data.recentBranch.repoName) + '" data-branch-name="' + soy.$$escapeHtml(opt_data.recentBranch.branchName) + '">' + aui.icons.icon({icon: 'devtools-branch', useIconFont: true}) + ' ' + soy.$$escapeHtml(opt_data.recentBranch.repoName) + ' / ' + soy.$$escapeHtml(opt_data.recentBranch.branchName) + '</a>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderLandingPageRecentBranchView.soyTemplateName = 'bamboo.plugins.branchinator.renderLandingPageRecentBranchView';
}


bamboo.plugins.branchinator.renderLandingPageRecentBranchesEmptyView = function(opt_data, opt_ignored) {
  return '' + ((! opt_data.fetched) ? '<div id="landingPageLoadingIcon">' + bamboo.plugins.branchinator.renderBigSpinner(null) + '</div>' : '<p class="noRecentBranches">' + soy.$$escapeHtml("You have not visited any branches recently.") + '</p>');
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderLandingPageRecentBranchesEmptyView.soyTemplateName = 'bamboo.plugins.branchinator.renderLandingPageRecentBranchesEmptyView';
}


bamboo.plugins.branchinator.renderBuildsView = function(opt_data, opt_ignored) {
  var output = '<h1>' + soy.$$escapeHtml("Plans building this branch") + '</h1><div id="buildsSortOrderContainer"><label for="buildsSortOrderSelect">' + soy.$$escapeHtml("Order by:") + '</label><select id="buildsSortOrderSelect">';
  var sortOrderList76 = opt_data.buildsSortOrderings;
  var sortOrderListLen76 = sortOrderList76.length;
  for (var sortOrderIndex76 = 0; sortOrderIndex76 < sortOrderListLen76; sortOrderIndex76++) {
    var sortOrderData76 = sortOrderList76[sortOrderIndex76];
    output += '<option value="' + soy.$$escapeHtml(sortOrderData76.column) + '" ' + ((sortOrderData76.selected) ? 'selected' : '') + '>' + soy.$$escapeHtml(sortOrderData76.label) + '</option>';
  }
  output += '</select></div><div id="addPlansContainer"></div><div id="buildsTableContainer"></div>';
  return output;
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBuildsView.soyTemplateName = 'bamboo.plugins.branchinator.renderBuildsView';
}


bamboo.plugins.branchinator.renderAddPlansView = function(opt_data, opt_ignored) {
  return '<form class="aui"><table id="addPlansTable"><tr><td id="addPlansSelectColumn"><input id="addPlansSelect" /></td><td id="addPlansButtonColumn"><button id="addPlansButton" class="aui-button aui-button-primary">' + soy.$$escapeHtml("Add") + '</button></td></tr></table></form>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderAddPlansView.soyTemplateName = 'bamboo.plugins.branchinator.renderAddPlansView';
}


bamboo.plugins.branchinator.renderBuildsTableView = function(opt_data, opt_ignored) {
  return '<table class="aui"><colgroup><col width="30%"/><col width=""/><col width=""/><col width=""/><col width=""/><col width="70px"/></colgroup><thead><tr><th id=\'plan-header\' data-sort="none">' + soy.$$escapeHtml("Plan") + '</th><th>' + soy.$$escapeHtml("Build") + '</th><th id=\'buildtime-header\' data-sort="ascending">' + soy.$$escapeHtml("Completed") + '</th><th>' + soy.$$escapeHtml("Tests") + '</th><th>' + soy.$$escapeHtml("Reason") + '</th><th></th></tr></thead><tbody></tbody></table>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBuildsTableView.soyTemplateName = 'bamboo.plugins.branchinator.renderBuildsTableView';
}


bamboo.plugins.branchinator.renderBuildsTableRowView = function(opt_data, opt_ignored) {
  var output = '<td class="plan" data-plan-key="' + soy.$$escapeHtml(opt_data.build.planKey) + '" data-status="' + soy.$$escapeHtml(opt_data.build.statusIcon.statusCode) + '"><a href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.build.planKey) + '" class="view-branches">' + bamboo.plugins.branchinator.renderBuildName({planName: opt_data.build.planName, projectName: opt_data.build.projectName, branchName: opt_data.build.branchName}) + '</a></td><td class="build ' + ((opt_data.build.buildState) ? soy.$$escapeHtml(opt_data.build.buildState) : 'disabled') + '">';
  var latestActiveBuildNumber__soy125 = opt_data.build.latestActiveBuildNumber != null ? opt_data.build.latestActiveBuildNumber : opt_data.build.buildNumber;
  output += '<a class="statusIcon" href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.build.planKey) + ((latestActiveBuildNumber__soy125 != null) ? '-' + soy.$$escapeHtml(latestActiveBuildNumber__soy125) : '') + '">' + widget.icons.statusIcon({status: opt_data.build.statusIcon.iconType, text: opt_data.build.statusIcon.displayText}) + '</a> ' + ((opt_data.build.buildNumber) ? '<a href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.build.planKey) + '/latest" title="Latest build">#' + soy.$$escapeHtml(opt_data.build.buildNumber) + '</a>' + ((opt_data.build.nrCommits > 0) ? ' (<a href="#" class="commitsLink ' + ((opt_data.build.committerIsCurrentUser) ? 'me' : '') + '" data-plan-key="' + soy.$$escapeHtml(opt_data.build.planKey) + '">' + ((opt_data.build.nrCommits == 1) ? soy.$$escapeHtml(AJS.format("{0} commit",1)) : soy.$$escapeHtml(AJS.format("{0} commits",opt_data.build.nrCommits))) + '</a>)' : '') : soy.$$escapeHtml("Never built")) + '</td>' + ((opt_data.build.buildNumber) ? '<td class="lastBuildTime" data-lastbuildepoch="-' + soy.$$escapeHtml(opt_data.build.lastBuildEpoch) + '">' + soy.$$escapeHtml(opt_data.build.lastBuildTime) + '</td><td>' + soy.$$escapeHtml(opt_data.build.testResultsSummary) + '</td><td>' + soy.$$filterNoAutoescape(opt_data.build.reason) + '</td>' : '<td colspan="3"></td>') + '<td class="actions">' + bamboo.plugins.branchinator.renderBuildActions(opt_data) + '</td>';
  return output;
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBuildsTableRowView.soyTemplateName = 'bamboo.plugins.branchinator.renderBuildsTableRowView';
}


bamboo.plugins.branchinator.renderBuildsTableEmptyView = function(opt_data, opt_ignored) {
  return '<td colspan="6">' + ((! opt_data.fetched) ? bamboo.plugins.branchinator.renderBigSpinner(null) : soy.$$escapeHtml("There aren\x27t any plans scheduled to run on the selected VCS branch.")) + '</td>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBuildsTableEmptyView.soyTemplateName = 'bamboo.plugins.branchinator.renderBuildsTableEmptyView';
}


bamboo.plugins.branchinator.renderBuildActions = function(opt_data, opt_ignored) {
  return '' + ((opt_data.build.hasBuildPermission) ? ((opt_data.build.statusIcon.statusCode == 'disabled') ? '<a class="action resumeBuild mutative" id="resumeBuild_' + soy.$$escapeHtml(opt_data.build.planKey) + '" href="#" data-plan-key="' + soy.$$escapeHtml(opt_data.build.planKey) + '"><span class="icon icon-build-enable" title="Enable \'' + soy.$$escapeHtml(opt_data.build.planName) + '\'"><span >Enable \'' + soy.$$escapeHtml(opt_data.build.planName) + '\'</span></span></a>' : '') + ((opt_data.build.statusIcon.statusCode != 'inProgress' && opt_data.build.statusIcon.statusCode != 'disabled' && opt_data.build.statusIcon.statusCode != 'queued' && opt_data.build.statusIcon.statusCode != 'checkingOut') ? '<a class="action asynchronous mutative startBuild" id="manualBuild_' + soy.$$escapeHtml(opt_data.build.planKey) + '" href="#" data-plan-key="' + soy.$$escapeHtml(opt_data.build.planKey) + '"><span class="icon icon-build-run" title="Run"><span>Run</span></span></a>' : '') + ((opt_data.build.statusIcon.statusCode == 'inProgress' || opt_data.build.statusIcon.statusCode == 'queued' || opt_data.build.statusIcon.statusCode == 'checkingOut') ? '<a class="action asynchronous mutative stopBuild" id="stopSingleBuild_' + soy.$$escapeHtml(opt_data.build.planKey) + '" href="#" data-plan-key="' + soy.$$escapeHtml(opt_data.build.planKey) + '"><span class="icon icon-build-stop" title="Stop \'' + soy.$$escapeHtml(opt_data.build.planName) + '\'"><span>Stop \'' + soy.$$escapeHtml(opt_data.build.planName) + '\'</span></span></a>' : '') : '') + ((opt_data.build.hasEditPermission) ? '<a class="action editBuild" id="editBuild:' + soy.$$escapeHtml(opt_data.build.planKey) + '" href="' + soy.$$escapeHtml("") + '/chain/admin/config/editChainConfiguration.action?buildKey=' + soy.$$escapeHtml(opt_data.build.planKey) + '"><span class="action icon icon-build-configure" title="Edit \'' + soy.$$escapeHtml(opt_data.build.planName) + '\'"><span>Edit \'' + soy.$$escapeHtml(opt_data.build.planName) + '\'</span></span></a><a href="#" class="action deleteBuild" data-plan-key="' + soy.$$escapeHtml(opt_data.build.planKey) + '"><span class="aui-icon aui-icon-small aui-iconfont-remove">Delete</span></a>' : '');
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBuildActions.soyTemplateName = 'bamboo.plugins.branchinator.renderBuildActions';
}


bamboo.plugins.branchinator.renderBuildName = function(opt_data, opt_ignored) {
  return '' + ((opt_data.projectName) ? soy.$$escapeHtml(opt_data.projectName) + ' &rsaquo; ' : '') + soy.$$escapeHtml(opt_data.planName) + ((opt_data.branchName) ? ' ' + widget.icons.fontIcon({type: 'devtools-branch'}) + ' ' + soy.$$escapeHtml(opt_data.branchName) : '');
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBuildName.soyTemplateName = 'bamboo.plugins.branchinator.renderBuildName';
}


bamboo.plugins.branchinator.renderBigSpinner = function(opt_data, opt_ignored) {
  return '<div class="bigSpinner"><img src=\'' + soy.$$escapeHtml("") + '/download/resources/com.atlassian.bamboo.plugins.branchinator:branchinator-resources/images/loading.gif\' /></div>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderBigSpinner.soyTemplateName = 'bamboo.plugins.branchinator.renderBigSpinner';
}


bamboo.plugins.branchinator.renderSmallSpinner = function(opt_data, opt_ignored) {
  return '<div class="smallSpinner"><img src=\'' + soy.$$escapeHtml("") + '/download/resources/com.atlassian.bamboo.plugins.branchinator:branchinator-resources/images/loading.gif\' height="16" width="16"/></div>';
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderSmallSpinner.soyTemplateName = 'bamboo.plugins.branchinator.renderSmallSpinner';
}


bamboo.plugins.branchinator.renderCommitsDialog = function(opt_data, opt_ignored) {
  var output = '<table class="aui aui-zebra commits-table"><colgroup><col width="30%"/><col width="100px"/><col width=""/></colgroup><thead><tr><th>' + soy.$$escapeHtml("Author") + '</th><th>' + soy.$$escapeHtml("Commit") + '</th><th>' + soy.$$escapeHtml("Message") + '</th></tr></thead><tbody>';
  var commitList268 = opt_data.commits;
  var commitListLen268 = commitList268.length;
  for (var commitIndex268 = 0; commitIndex268 < commitListLen268; commitIndex268++) {
    var commitData268 = commitList268[commitIndex268];
    output += '<tr class="commit"><td><img src="' + soy.$$escapeHtml(commitData268.authorGravatarUrl) + '"/><span style="margin-left:5px">' + soy.$$escapeHtml(commitData268.authorName) + '</span></td><td class="revision">' + ((commitData268.commitUrl) ? '<a href="' + soy.$$escapeHtml(commitData268.commitUrl) + '" class="revision-id" title="' + soy.$$escapeHtml("View change set in web repository viewer") + '">' + soy.$$escapeHtml(commitData268.hash) + '</a>' : '<span class="revision-id">' + soy.$$escapeHtml(commitData268.hash) + '</span>') + '</td><td colspan="4">' + soy.$$escapeHtml(commitData268.message) + '</td></tr>';
  }
  output += '</tbody></table>';
  return output;
};
if (goog.DEBUG) {
  bamboo.plugins.branchinator.renderCommitsDialog.soyTemplateName = 'bamboo.plugins.branchinator.renderCommitsDialog';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/regions/header-region.js' */
define("branchinator/regions/header-region",["marionette","jquery"],function(b,a){return b.Region.extend({attachHtml:function(c){var e=a("section#content");var d=a(c.el).attr("id");e.find("#"+d).remove();e.prepend(c.el);this.$el.hide()}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/messages-view.js' */
define("branchinator/views/layout/messages-view",["backbone","branchinator/utils/radio-utils","underscore"],function(c,b,a){return Marionette.ItemView.extend({className:function(){return this.getOption("hasRepositories")?"hasRepositories":""},template:false,onShow:function(){b.listenTo("message:info",a.bind(this.showMessage,this,aui.message.info));b.listenTo("message:warn",a.bind(this.showMessage,this,aui.message.warning));b.listenTo("message:error",a.bind(this.showMessage,this,aui.message.error));b.listenTo("message:clear",this.clearMessage.bind(this))},showMessage:function(d,e){this.$el.html(d({content:e}))},clearMessage:function(){this.$el.empty()}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/models/branch-selection-model.js' */
define("branchinator/models/branch-selection-model",["backbone","underscore"],function(b,a){return b.Model.extend({defaults:{repo:{id:0,name:""},branch:{id:"",branchName:""}},getRepoId:function(){return this.get("repo").id},getRepoName:function(){return this.get("repo").name},getBranchName:function(){return this.get("branch").branchName},clearRepo:function(){if(this.get("repo").id>0){this.clearBranch();this.set("repo",this.defaults.repo);this.trigger("repo:cleared")}},selectRepo:function(e,d){var c={id:e,name:d};if(!a.isEqual(this.get("repo"),c)){this.clearBranch();this.set("repo",c);this.trigger("repo:selected",this.get("repo"))}},clearBranch:function(){if(this.get("branch").branchName){this.set("branch",this.defaults.branch);this.trigger("branch:cleared",this.get("repo"))}},selectBranch:function(c){var d={id:c,branchName:c};if(!a.isEqual(this.get("branch"),d)){this.set("branch",d);this.trigger("branch:selected",{repo:this.get("repo"),branch:this.get("branch")})}}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/content/builds-view.js' */
define("branchinator/views/layout/content/builds-view",["branchinator/collections/builds-collection","branchinator/utils/branchinator-utils","branchinator/utils/radio-utils","branchinator/views/layout/content/builds/add-plans-view","branchinator/views/layout/content/builds/builds-table-view","jquery","marionette","util/ajax"],function(c,g,a,i,e,b,f,h){var d=WRM.data.claim("com.atlassian.bamboo.plugins.branchinator:branchinator-resources.builds-sort-orderings");return f.LayoutView.extend({regions:{addPlans:"#addPlansContainer",buildsTable:"#buildsTableContainer"},ui:{sortOrderSelect:"#buildsSortOrderSelect"},events:{"change @ui.sortOrderSelect":"onSortOrderChanged"},modelEvents:{"repo:cleared repo:selected branch:cleared":"clearBuildsTable","branch:selected":"showBuildsTable"},template:function(){return bamboo.plugins.branchinator.renderBuildsView({buildsSortOrderings:d})},onRender:function(){this.ui.sortOrderSelect.auiSelect2({minimumResultsForSearch:Infinity})},onShow:function(){this.addPlans.show(new i({model:this.model}))},onChildviewBuildAdded:function(){if(this.buildsTable.currentView){this.buildsTable.currentView.fetchCollection()}},showBuildsTable:function(){this.buildsTable.show(new e({collection:c.forRepositoryBranch(this.model.getRepoId(),this.model.getBranchName(),this.ui.sortOrderSelect.val())}))},clearBuildsTable:function(){this.buildsTable.reset()},saveSortOrderForUser:function(){var k="branch.builds.sort.order";var j={property:k,value:this.ui.sortOrderSelect.val()};return h({url:g.getRestUrl("config/user/{0}",k),type:"PUT",data:JSON.stringify(j),contentType:"application/json",dataType:"json"})},onSortOrderChanged:function(){this.saveSortOrderForUser();if(this.buildsTable.currentView){this.showBuildsTable()}}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/utils/radio-utils.js' */
define("branchinator/utils/radio-utils",["backbone","underscore"],function(c,a){var b=c.Wreqr.radio.channel("branchinator");return Object.freeze({trigger:function(d,e){b.vent.trigger(d,e)},listenTo:function(d,e){b.vent.on(d,e)},request:function(d){return b.reqres.request(d)},respondTo:function(f,d){var e=a.isFunction(d)?d:function(){return d};b.reqres.setHandler(f,e)}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/content/builds/add-plans-view.js' */
define("branchinator/views/layout/content/builds/add-plans-view",["backbone","branchinator/utils/branchinator-utils","branchinator/utils/radio-utils","jquery","marionette"],function(e,a,c,b,d){return d.ItemView.extend({ui:{input:"#addPlansSelect",addButton:"#addPlansButton"},events:{"click @ui.addButton":"onAddButtonClicked"},template:function(){return bamboo.plugins.branchinator.renderAddPlansView()},onRender:function(){this.ui.input.auiSelect2({placeholder:"Add plans",minimumInputLength:0,multiple:true,ajax:{url:function(){return a.getRestUrl("builds/available?repoId={0}&branchName={1}",this.model.get("repo").id,encodeURIComponent(this.model.get("branch").branchName))}.bind(this),dataType:"json",data:function(f){return{searchTerm:f}},results:function(f){return{results:f}},cache:false},id:function(f){return f.planKey},formatResult:function(f){return bamboo.plugins.branchinator.renderBuildName({planName:f.buildName,projectName:f.project.name})},formatSelection:function(f){return f.buildName}})},onAddButtonClicked:function(h){h.preventDefault();var f=[];var g=this.ui.input.auiSelect2("val");this.ui.input.auiSelect2("val","");this.ui.input.auiSelect2("disable");this.ui.addButton.prop("disabled",true);g.forEach(function(i){f.push(this.addPlan(i))}.bind(this));b.when.apply(b,f).fail(function(){c.trigger("message:error","An error occurred - not all plans have been added successfully.")}).always(function(){this.ui.input.auiSelect2("enable");this.ui.addButton.prop("disabled",false)}.bind(this))},addPlan:function(g){var f=this.model.get("branch").branchName;return b.ajax({url:a.getRestUrl("actions/create?planKey={0}&branchName={1}",g,encodeURIComponent(f)),type:"POST",contentType:"application/json",dataType:"json"}).done(function(h){AJS.trigger("analyticsEvent",{name:"branch.view.action.plan.branch.created"});this.triggerMethod("build:added",h.branchKey)}.bind(this))}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/dialogs/build-commits-dialog.js' */
define("branchinator/dialogs/build-commits-dialog",["backbone","branchinator/collections/build-commits-collection","underscore","widget/dialog"],function(d,c,b,a){return a.extend({defaultSettings:{width:800,height:400,buttons:[{id:"cancel",label:"Close",type:"link",cssClass:"close-commits-dialog"}]},initialize:function(e){var f={header:AJS.format("Commits for latest build of {0}",e.planKey),content:bamboo.plugins.branchinator.renderBigSpinner()};a.prototype.initialize.call(this,b.defaults(f,this.defaultSettings));this.collection=c.forPlanKey(e.planKey);this.collection.on("sync",this.onCollectionSync,this);this.collection.on("error",this.onCollectionError,this);this.collection.fetch()},onCollectionSync:function(){this.$dialogContent.html(bamboo.plugins.branchinator.renderCommitsDialog({commits:this.collection.toJSON()}))},onCollectionError:function(){this.$dialogContent.html("An error occurred while trying to obtain most recent commits.")}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/content-view.js' */
define("branchinator/views/layout/content-view",["branchinator/collections/recent-branches-collection","branchinator/utils/radio-utils","branchinator/views/layout/content/builds-view","branchinator/views/layout/content/landing-page-view","jquery","marionette"],function(e,d,b,a,c,f){return f.LayoutView.extend({regions:{landingPage:"#landingPageContainer",builds:"#buildsContainer"},modelEvents:{"repo:cleared repo:selected branch:cleared":"showLandingPage","branch:selected":"showBuilds"},template:function(){return bamboo.plugins.branchinator.renderContentView()},onShow:function(){this.$el.hide();this.landingPage.show(new a({model:this.model,collection:new e()}));this.builds.show(new b({model:this.model}));this.showLandingPage();this.$el.show()},showLandingPage:function(){this.builds.$el.hide();this.landingPage.$el.show()},showBuilds:function(){this.landingPage.$el.hide();this.builds.$el.show()}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/collections/build-commits-collection.js' */
define("branchinator/collections/build-commits-collection",["branchinator/utils/branchinator-utils","backbone"],function(a,b){return b.Collection.extend({},{forPlanKey:function(c){return new this([],{url:a.getRestUrl("commits?planKey={0}",c)})}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/routers/router.js' */
define("branchinator/routers/router",["backbone","branchinator/utils/branchinator-utils","branchinator/utils/radio-utils","util/uri-utils"],function(e,b,d,c){var a=WRM.data.claim("com.atlassian.bamboo.plugins.branchinator:branchinator-resources.known-navigation-sources");return e.Router.extend({routes:{"(/)":"selectNone",":repoId/:repoName(/)":"selectRepo",":repoId/:repoName/:branchName(/)":"selectRepoAndBranch"},initialize:function(f){this.model=f.model;this.triggerAnalytics()},triggerAnalytics:function(){var g=c.queryToObject();var f=g.source&&this.isSourceKnown(g.source)?g.source:"direct";AJS.trigger("analyticsEvent",{name:"branch.view.page.opened",data:{source:f}})},isSourceKnown:function(f){return a.indexOf(f)>-1},removeQueryParams:function(){if(window.location.search){var f=e.history.getFragment();this.navigate(f+"/clear",{replace:true});this.navigate(f,{replace:true})}},selectNone:function(){this.removeQueryParams();this.model.clearRepo()},selectRepo:function(f,g){this.removeQueryParams();this.model.selectRepo(f,b.slashSafeUrlDecode(g));this.model.clearBranch()},selectRepoAndBranch:function(g,h,f){this.removeQueryParams();this.model.selectRepo(g,b.slashSafeUrlDecode(h));this.model.selectBranch(b.slashSafeUrlDecode(f))}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/content/landing-page-view.js' */
define("branchinator/views/layout/content/landing-page-view",["backbone","branchinator/behaviors/fetch-state-aware-behavior","branchinator/utils/branchinator-utils","branchinator/utils/radio-utils","branchinator/views/layout/content/landing-page-recent-branch-view","jquery","marionette"],function(h,f,a,e,b,d,g){var c=g.ItemView.extend({tagName:"li",template:function(){return bamboo.plugins.branchinator.renderLandingPageRecentBranchesEmptyView({fetched:this.getOption("isFetched")()})}});return g.CompositeView.extend({childView:b,childViewContainer:"ul.branchSuggestions",emptyView:c,emptyViewOptions:function(){return{isFetched:this.isFetched}},modelEvents:{"repo:cleared repo:selected branch:cleared branch:selected":"fetchCollection"},childEvents:{"recent:branch:selected":"onRecentBranchSelected"},behaviors:{FetchStateAware:{behaviorClass:f}},template:function(){return bamboo.plugins.branchinator.renderLandingPageView()},initialize:function(){this.fetchCollection()},fetchCollection:function(){this.collection.fetch({reset:true})},onInitialFetchComplete:function(){if(this.collection.isEmpty()){this.render()}},onRecentBranchSelected:function(i){var j=i.model;this.model.selectRepo(j.get("repoId"),j.get("repoName"));this.model.selectBranch(j.get("branchName"))}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/application.js' */
define("branchinator/application",["backbone","branchinator/models/branch-selection-model","branchinator/routers/router","branchinator/utils/branchinator-utils","branchinator/utils/radio-utils","branchinator/views/layout-view","marionette"],function(g,f,d,a,b,c,e){return e.Application.extend({onStart:function(h){var i=new e.RegionManager({regions:{main:h.el}});this.options=h;this.mainRegion=i.get("main");this.branchSelection=new f();this.initializeNavigation();this.showPageLayout();this.initializeRouting();this.displayMessages()},initializeNavigation:function(){this.listenTo(this.branchSelection,"repo:cleared",function(){g.history.navigate()});this.listenTo(this.branchSelection,"repo:selected branch:cleared",function(h){g.history.navigate(a.getRepoUrlPath(h.id,h.name))});this.listenTo(this.branchSelection,"branch:selected",function(h){g.history.navigate(a.getRepoAndBranchUrlPath(h.repo.id,h.repo.name,h.branch.branchName))})},showPageLayout:function(){this.mainRegion.show(new c({model:this.branchSelection,hasRepositories:this.options.hasBranchableRepos}))},initializeRouting:function(){new d({model:this.branchSelection});g.history.start({pushState:true,root:a.getApplicationRootUrl()})},displayMessages:function(){if(!this.options.hasLinkedRepos){b.trigger("message:info","You can only view branches of linked repositories. There are no linked repositories configured on this Bamboo server, or you do not have access to any.")}else{if(!this.options.hasBranchableRepos){b.trigger("message:info","We could not find any linked repositories that support branches.")}}}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/models/build-model.js' */
define("branchinator/models/build-model",["backbone","branchinator/utils/branchinator-utils","util/ajax"],function(c,a,b){return c.Model.extend({idAttribute:"planKey",isBuildSuccessful:function(){return this.get("buildState")==="Successful"},isBuildFailed:function(){return this.get("buildState")==="Failed"},isJustAdded:function(){return this.get("justAdded")===true},stopBuild:function(){return b({url:a.getRestUrl("actions/stop?planKey={0}",this.get("planKey")),type:"POST"})},startBuild:function(){return b({url:a.getRestUrl("actions/start?planKey={0}",this.get("planKey")),type:"POST"})},resumeBuild:function(){return b({url:a.getRestUrl("actions/resume?planKey={0}",this.get("planKey")),type:"POST"})},deleteBuild:function(){return b({url:a.getRestUrl("actions/delete?planKey={0}&branchName={1}",this.get("planKey"),encodeURIComponent(this.get("branchName"))),type:"DELETE"})}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout-view.js' */
define("branchinator/views/layout-view",["branchinator/regions/header-region","branchinator/utils/radio-utils","branchinator/views/layout/content-view","branchinator/views/layout/header-view","branchinator/views/layout/messages-view","marionette"],function(d,c,f,a,b,e){return e.LayoutView.extend({regions:{header:{selector:"#headerContainer",regionClass:d},messages:"#messagesContainer",content:"#contentContainer"},modelEvents:{"repo:cleared repo:selected branch:cleared branch:selected":"clearErrorMessages"},initialize:function(g){this.options=g},template:function(){return bamboo.plugins.branchinator.renderLayoutView()},onShow:function(){var g=this.getOption("hasRepositories");this.messages.show(new b({hasRepositories:g}));this.header.show(new a({model:this.model,hasRepositories:g}));if(g){this.content.show(new f({model:this.model}))}},clearErrorMessages:function(){c.trigger("message:clear")}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/content/builds/builds-table-view.js' */
define("branchinator/views/layout/content/builds/builds-table-view",["branchinator/behaviors/fetch-state-aware-behavior","branchinator/utils/branchinator-utils","branchinator/utils/radio-utils","branchinator/views/layout/content/builds/builds-table-row-view","marionette"],function(e,b,d,c,f){var a=f.ItemView.extend({tagName:"tr",className:"noResults",template:function(){return bamboo.plugins.branchinator.renderBuildsTableEmptyView({fetched:this.getOption("isFetched")()})}});return f.CompositeView.extend({id:"enabledBuilds",childView:c,childViewContainer:"tbody",emptyView:a,emptyViewOptions:function(){return{isFetched:this.isFetched}},collectionEvents:{sync:"onCollectionSync",error:"onCollectionError"},behaviors:{FetchStateAware:{behaviorClass:e}},template:function(){return bamboo.plugins.branchinator.renderBuildsTableView()},initialize:function(){this.fetchCollection()},fetchCollection:function(){clearTimeout(this.fetchTimer);this.collection.fetch({reset:true})},updateFavicon:function(){var g;if(this.collection.anyBuildFailed()){g="/images/iconsv4/icon-build-failed-64x64.png"}else{if(this.collection.anyBuildSuccessful()){g="/images/iconsv4/icon-build-successful-64x64.png"}else{g="/images/icons/favicon.png"}}Piecon.setFavicon(BAMBOO.staticResourcePrefix+g)},onCollectionSync:function(){clearTimeout(this.fetchTimer);this.fetchTimer=setTimeout(this.fetchCollection.bind(this),10000);this.updateFavicon()},onCollectionError:function(h,g){clearTimeout(this.fetchTimer);this.fetchTimer=setTimeout(this.fetchCollection.bind(this),10000);d.trigger("message:error",b.getErrorFromResponse(g))},onInitialFetchComplete:function(){if(this.collection.isEmpty()){this.render()}},onChildviewBuildStopped:function(){this.fetchCollection()},onChildviewBuildStarted:function(){this.fetchCollection()},onChildviewBuildResumed:function(){this.fetchCollection()},onChildviewBuildDeleted:function(g){g.hideWithHighlight().done(this.fetchCollection.bind(this))},onAddChild:function(g){if(this.isFetched()&&g instanceof c&&g.model.isJustAdded()){g.showWithHighlight()}},onBeforeDestroy:function(){clearTimeout(this.fetchTimer)}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/collections/builds-collection.js' */
define("branchinator/collections/builds-collection",["backbone","branchinator/utils/branchinator-utils","branchinator/models/build-model","underscore"],function(d,a,c,b){return d.Collection.extend({model:c,initialize:function(){this.saveCurrentIds();this.on("request",this.saveCurrentIds)},parse:function(e){return e.builds.map(function(g){var f=g[c.prototype.idAttribute];if(b.indexOf(this._previousIds,f,true)===-1){g.justAdded=true}return g},this)},anyBuildSuccessful:function(){return this.some(function(e){return e.isBuildSuccessful()})},anyBuildFailed:function(){return this.some(function(e){return e.isBuildFailed()})},saveCurrentIds:function(){this._previousIds=b.pluck(this.models,"id").sort()}},{forRepositoryBranch:function(f,e,g){return new this([],{url:a.getRestUrl("builds?repoId={0}&branchName={1}&sortBy={2}",f,encodeURIComponent(e),g||"")})}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/views/layout/content/builds/builds-table-row-view.js' */
define("branchinator/views/layout/content/builds/builds-table-row-view",["branchinator/dialogs/build-commits-dialog","branchinator/dialogs/delete-build-confirmation-dialog","branchinator/utils/branchinator-utils","jquery","marionette"],function(a,d,b,c,e){return e.ItemView.extend({tagName:"tr",className:function(){return"plan-"+this.model.get("planKey")},events:{"click .stopBuild":"onStopBuildClicked","click .startBuild":"onStartBuildClicked","click .resumeBuild":"onResumeBuildClicked","click .editBuild":"onEditBuildClicked","click .deleteBuild":"onDeleteBuildClicked","click .commitsLink":"onCommitsLinkClicked"},modelEvents:{change:"render"},template:function(f){return bamboo.plugins.branchinator.renderBuildsTableRowView({build:f})},onStopBuildClicked:function(f){f.preventDefault();this.model.stopBuild().done(function(){this.trigger("build:stopped",this.model.get("planKey"));AJS.trigger("analyticsEvent",{name:"branch.view.action.build.stopped"})}.bind(this))},onStartBuildClicked:function(f){f.preventDefault();this.model.startBuild().done(function(){this.trigger("build:started",this.model.get("planKey"));AJS.trigger("analyticsEvent",{name:"branch.view.action.build.started"})}.bind(this))},onResumeBuildClicked:function(f){f.preventDefault();this.model.resumeBuild().done(function(){this.trigger("build:resumed",this.model.get("planKey"));AJS.trigger("analyticsEvent",{name:"branch.view.action.plan.branch.enabled"})}.bind(this))},onEditBuildClicked:function(f){f.preventDefault();AJS.trigger("analyticsEvent",{name:"branch.view.action.build.configured"});window.location.href=c(f.currentTarget).attr("href")},onDeleteBuildClicked:function(f){f.preventDefault();new d({callback:this.deleteBuild.bind(this)})},onCommitsLinkClicked:function(f){f.preventDefault();AJS.trigger("analyticsEvent",{name:"branch.view.action.commits.show"});new a({planKey:this.model.get("planKey")})},deleteBuild:function(){this.model.deleteBuild().done(function(){this.trigger("build:deleted",this.model.get("planKey"));AJS.trigger("analyticsEvent",{name:"branch.view.action.plan.branch.deleted"})}.bind(this))},showWithHighlight:function(){return c.Deferred(function(f){this.$el.addClass("animateHighlight");this.$el.one(b.getAnimationCompletedEventName(),f.resolve)}.bind(this)).promise()},hideWithHighlight:function(){return c.Deferred(function(f){this.$el.addClass("animateFadeOut");this.$el.one(b.getAnimationCompletedEventName(),function(){this.$el.hide();f.resolve()}.bind(this))}.bind(this)).promise()}})});;
;
/* module-key = 'com.atlassian.bamboo.plugins.branchinator:branchinator-resources', location = '/client/js/dialogs/delete-build-confirmation-dialog.js' */
define("branchinator/dialogs/delete-build-confirmation-dialog",["backbone","branchinator/utils/branchinator-utils","branchinator/utils/radio-utils","underscore","widget/dialog"],function(e,b,d,c,a){return a.extend({defaultSettings:{width:600,height:300,closeOnOutsideClick:true,header:"Do you want to delete this branch build?",content:"This will irreversibly remove all build results and associated artifacts for this branch build.",buttons:[{id:"delete",label:"Delete",cssClass:"aui-button aui-button-primary confirm-delete-plan-branch"},{id:"cancel",label:"Cancel",type:"link",cssClass:"cancel-delete-plan-branch"}]},initialize:function(f){this.callback=f.callback;a.prototype.initialize.call(this,this.defaultSettings)},onButtonClick:function(f){a.prototype.onButtonClick.apply(this,arguments);if(f==="delete"){this.callback();this.dialog.remove()}}})});;
;
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/store-1.3.1.js' */
(function(){var l={},h=window,k=h.document,c="localStorage",n="globalStorage",d="__storejs__",g;l.disabled=false;l.set=function(e,o){};l.get=function(e){};l.remove=function(e){};l.clear=function(){};l.transact=function(e,o){var p=l.get(e);if(typeof p=="undefined"){p={}}o(p);l.set(e,p)};l.serialize=function(e){return JSON.stringify(e)};l.deserialize=function(e){if(typeof e!="string"){return undefined}return JSON.parse(e)};function b(){try{return(c in h&&h[c])}catch(e){return false}}function m(){try{return(n in h&&h[n]&&h[n][h.location.hostname])}catch(e){return false}}if(b()){g=h[c];l.set=function(e,o){if(o===undefined){return l.remove(e)}g.setItem(e,l.serialize(o))};l.get=function(e){return l.deserialize(g.getItem(e))};l.remove=function(e){g.removeItem(e)};l.clear=function(){g.clear()}}else{if(m()){g=h[n][h.location.hostname];l.set=function(e,o){if(o===undefined){return l.remove(e)}g[e]=l.serialize(o)};l.get=function(e){return l.deserialize(g[e]&&g[e].value)};l.remove=function(e){delete g[e]};l.clear=function(){for(var e in g){delete g[e]}}}else{if(k.documentElement.addBehavior){var j,f;try{f=new ActiveXObject("htmlfile");f.open();f.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></frame>');f.close();j=f.w.frames[0].document;g=j.createElement("div")}catch(i){g=k.createElement("div");j=k.body}function a(e){return function(){var p=Array.prototype.slice.call(arguments,0);p.unshift(g);j.appendChild(g);g.addBehavior("#default#userData");g.load(c);var o=e.apply(l,p);j.removeChild(g);return o}}l.set=a(function(p,e,o){if(o===undefined){return l.remove(e)}p.setAttribute(e,l.serialize(o));p.save(c)});l.get=a(function(o,e){return l.deserialize(o.getAttribute(e))});l.remove=a(function(o,e){o.removeAttribute(e);o.save(c)});l.clear=a(function(q){var o=q.XMLDocument.documentElement.attributes;q.load(c);for(var p=0,e;e=o[p];p++){q.removeAttribute(e.name)}q.save(c)})}}}try{l.set(d,d);if(l.get(d)!=d){l.disabled=true}l.remove(d)}catch(i){l.disabled=true}if(typeof module!="undefined"){module.exports=l}else{if(typeof define==="function"&&define.amd){define(l)}else{this.store=l}}})();;
;
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/page-visibility.js' */
define("atlassian/analytics/page-visibility",function(){var a=(document.hidden!==undefined);var b={supported:a,isHidden:function(){return a?document.hidden:false}};return b});;
;
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/user-activity-xhr-header.js' */
define("atlassian/analytics/user-activity-xhr-header",["atlassian/analytics/page-visibility"],function(c){var e="x-atlassian-mau-ignore";var d=XMLHttpRequest.prototype.send;var a=window.fetch;var b=false;return{install:function(){if(!b&&c.supported){XMLHttpRequest.prototype.send=function(){if(c.isHidden()){this.setRequestHeader(e,c.isHidden())}d.apply(this,arguments)};if(a){window.fetch=function(f,i){var g=i||{};var h=g.headers;if(c.isHidden()){g.headers=(h)?new Headers(h):new Headers();g.headers.append(e,c.isHidden())}return a.call(this,f,g)}}b=true}},uninstall:function(){if(b){XMLHttpRequest.prototype.send=d;if(a){window.fetch=a}}b=false}}});require("atlassian/analytics/user-activity-xhr-header").install();;
;
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/atlassian-analytics.js' */
(function(d){var p=AJS.$.ajax;var k="atlassian-analytics";var i=typeof AJS.contextPath=="function"?AJS.contextPath():typeof AJS.Confluence!="undefined"?AJS.Confluence.getContextPath():window.contextPath!=null?window.contextPath:"";var o=null;var l=null;var f=null;var q="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(y){var x=Math.random()*16|0,w=y=="x"?x:(x&3|8);return w.toString(16)});var s=function(){var w="unknown";if(document.body.id=="jira"){w="jira"}else{if(document.body.id=="com-atlassian-confluence"){w="confluence"}}l=k+"."+w;f=l+".lock"};var e=function(){if(store.get(f)){return false}store.set(f,q);return(store.get(f)===q)};var t=function(){store.set(f,null)};var h=function(){var x=[],z,A,w,y;if(AJS.EventQueue.length==0){return}x=store.get(l)||x;for(w=0,y=AJS.EventQueue.length;w<y;++w){A=AJS.EventQueue[w];if(A.name){z={name:A.name,properties:A.properties,time:A.time||0};x.push(z)}}AJS.EventQueue.length=0;store.set(l,x)};var u=0;var a=function(w){return Math.min(5000*Math.pow(2,w),5*60*1000)};var g=function(){var z;function x(){setTimeout(g,a(u=0))}function w(){setTimeout(g,a(++u))}if(!e()){return x()}h();z=store.get(l);if(!z||!z.length){t();return x()}store.remove(l);t();if(!n(z)){return x()}var A=new Date().getTime();for(var y=0;y<z.length;y++){if(z[y].time>0){z[y].timeDelta=z[y].time-A}else{z[y].timeDelta=y-z.length}delete z[y].time}o=p({type:"POST",url:i+"/rest/analytics/1.0/publish/bulk",data:JSON.stringify(z),contentType:"application/json",dataType:"json"});o.fail(function(){AJS.EventQueue.concat(z);h();w()});o.done(function(){x()})};var n=function(y){for(var x=y.length-1;x>=0;x--){var A="";var z=y[x];var w=z.properties;if(typeof z.name==="undefined"){A="you must provide a name for the event."}else{if(typeof w!=="undefined"&&w!==null){if(w.constructor!==Object){A="properties must be an object with key value pairs."}else{b(w)}}}if(A!==""){AJS.log("WARN: Invalid analytics event detected and ignored, "+A+"\nEvent: "+JSON.stringify(z));y.splice(x,1)}}return y.length};var b=function(y){for(var x in y){if(y.hasOwnProperty(x)){var w=y[x];if(c(w)&&j(w)){}else{if(c(w)&&w.toString){y[x]=w.toString()}else{y[x]=""}}}}};function c(w){return typeof w!=="undefined"&&w!==null}function j(w){return typeof w==="number"||typeof w==="string"||typeof w==="boolean"}var m=function(){if(o&&!(o.state()==="resolved"||o.state()==="rejected")){o.abort()}};AJS.EventQueue=AJS.EventQueue||[];var r=Array.prototype.push;AJS.EventQueue.push=function(w){w.time=new Date().getTime();r.call(AJS.EventQueue,w)};AJS.toInit(function(){s();setTimeout(g,500);v()});d(window).unload(function(){m();h()});AJS.Analytics={triggerPrivacyPolicySafeEvent:function(w,x){AJS.log("WARN: 'triggerPrivacyPolicySafeEvent' has been deprecated");AJS.EventQueue.push({name:w,properties:x})}};AJS.bind("analytics",function(w,x){AJS.EventQueue.push({name:x.name,properties:x.data})});AJS.bind("analyticsEvent",function(w,x){AJS.EventQueue.push({name:x.name,properties:x.data})});var v=function(){if(window.location.pathname.indexOf("/secure/admin/ViewApplicationProperties")>-1){AJS.$("[data-property-id='analytics-enabled']").remove()}else{if(window.location.pathname.indexOf("/secure/admin/EditApplicationProperties")>-1){var x=AJS.$(":contains(Enable Atlassian analytics)");if(x.size()>0){var w=x[x.size()-2];if(w){w.remove()}}}}}}(AJS.$));;
;
/* module-key = 'com.atlassian.analytics.analytics-client:policy-update-init', location = 'js/policy-update-init.js' */
AJS.toInit(function(){var a=WRM.data.claim("com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider");if(a){WRM.require("wrc!com.atlassian.analytics.analytics-client:policy-update")}});;
;
/* module-key = 'com.atlassian.analytics.analytics-client:programmatic-analytics-init', location = 'js/programmatic-analytics-init.js' */
(function(){var a=WRM.data.claim("com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider");if(a){WRM.require("wrc!com.atlassian.analytics.analytics-client:programmatic-analytics")}}());;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:application-header-administration-cog-resource', location = 'header/cog.js' */
var NavLinks=(function(a){a.ApplicationHeader=function(b){b.Cog=(function(){var c=function(){var d=AJS.$("#system-admin-menu-content");if(d.length>0){return d}var e=AJS.$("#admin-menu-link-content");if(e.length>0){return e}return AJS.$("#bamboo\\.global\\.header-admin\\.menu")};return{getDropdown:c}}());return b}(a.ApplicationHeader||{});return a}(NavLinks||{}));;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts-resources', location = 'adminshortcuts/adminshortcuts.soy' */
// This file was automatically generated from adminshortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.adminshortcuts.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.adminshortcuts == 'undefined') { navlinks.templates.adminshortcuts = {}; }


navlinks.templates.adminshortcuts.section = function(opt_data, opt_ignored) {
  var param5 = '<ul class="aui-list-truncate">';
  var linkList7 = opt_data.links;
  var linkListLen7 = linkList7.length;
  for (var linkIndex7 = 0; linkIndex7 < linkListLen7; linkIndex7++) {
    var linkData7 = linkList7[linkIndex7];
    param5 += '<li><a href="' + soy.$$escapeHtml(linkData7.link) + '">' + soy.$$escapeHtml(linkData7.label) + '</a></li>';
  }
  param5 += '</ul>';
  var output = '' + aui.dropdown2.section({id: 'nl-remote-admin-section', label: "Other applications", content: param5});
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.adminshortcuts.section.soyTemplateName = 'navlinks.templates.adminshortcuts.section';
}
;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts-resources', location = 'adminshortcuts/adminnavlinks.js' */
var NavLinks=(function(a){a.AdminShortcuts=(function(){var c=function(){return AJS.$.ajax({url:AJS.contextPath()+"/rest/menu/latest/admin",cache:false,dataType:"json"})};var b=function(){AJS.$("#nl-remote-admin-section").on("click","a",function(){NL.trackEvent("remoteAdminItemSelected",NL.getCurrentApplication(),$(this).attr("href"))})};return{render:function(){c().done(function(e){e=_.reject(e,function(f){return f.local===true});if(e.length){var d=navlinks.templates.adminshortcuts.section({links:e});a.ApplicationHeader.Cog.getDropdown().append(d);b()}})}}}());return a}(NavLinks||{}));;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.soy' */
// This file was automatically generated from projectshortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.projectshortcuts.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.projectshortcuts == 'undefined') { navlinks.templates.projectshortcuts = {}; }


navlinks.templates.projectshortcuts.dialogContent = function(opt_data, opt_ignored) {
  return '' + ((opt_data.localShortcuts && opt_data.localShortcuts.length > 0) ? navlinks.templates.projectshortcuts.dialogContentShortcuts({shortcuts: opt_data.localShortcuts, listClass: 'projectshortcut-links'}) : '') + ((opt_data.remoteShortcuts != null) ? (opt_data.remoteShortcuts.length > 0) ? '<h2 class="projectshortcuts-heading">Related Links</h2>' + navlinks.templates.projectshortcuts.dialogContentShortcuts(soy.$$augmentMap(opt_data.remoteShortcuts, {shortcuts: opt_data.remoteShortcuts, listClass: 'projectshortcut-links'})) : '' : navlinks.templates.projectshortcuts.dialogLoading(null));
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContent.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContent';
}


navlinks.templates.projectshortcuts.headingWrapper = function(opt_data, opt_ignored) {
  return '<div class="project-dialog-header-wrapper"><div class="project-header"><img class="project-img" src="' + soy.$$escapeHtml(opt_data.logoUrl) + '"><h2 class="dialog-title">' + soy.$$escapeHtml(opt_data.title) + '</h2></div><div class="project-content-wrapper">' + soy.$$filterNoAutoescape(opt_data.contentHtml) + '</div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.headingWrapper.soyTemplateName = 'navlinks.templates.projectshortcuts.headingWrapper';
}


navlinks.templates.projectshortcuts.dialogContentShortcuts = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<ul' + ((opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '') + '>';
  var shortcutList35 = opt_data.shortcuts;
  var shortcutListLen35 = shortcutList35.length;
  for (var shortcutIndex35 = 0; shortcutIndex35 < shortcutListLen35; shortcutIndex35++) {
    var shortcutData35 = shortcutList35[shortcutIndex35];
    output += '<li' + ((shortcutIndex35 == shortcutListLen35 - 1) ? ' class="last"' : '') + '>' + navlinks.templates.projectshortcuts.dialogContentShortcut(shortcutData35) + '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContentShortcuts.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContentShortcuts';
}


navlinks.templates.projectshortcuts.dialogContentShortcut = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml(opt_data.link) + '"' + ((opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.label) + '</a>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContentShortcut.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContentShortcut';
}


navlinks.templates.projectshortcuts.dialogLoading = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div class="projectshortcuts-loading">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogLoading.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogLoading';
}
;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.js' */
(function(e,g){var i,k={},m="key",b="name",j="entity-type";function f(s){var n=e(this),o=n.data(m),q=n.data(b),p=n.data(j);if(typeof o==="undefined"){return}s.preventDefault();i=new AJS.Dialog({width:600,keypressListener:function(u){if(u.which==jQuery.ui.keyCode.ESCAPE){i.remove()}},id:"project-shortcuts-dialog"}).addCancel("Close",function(){i.remove()}).addPanel("",navlinks.templates.projectshortcuts.headingWrapper({title:q,logoUrl:h(),contentHtml:navlinks.templates.projectshortcuts.dialogLoading({text:"Retrieving links"})})).show();c(i);if(!k[o]){k[o]={entity:{title:q},localShortcuts:null,remoteShortcuts:null};d(AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+o,{entityType:p}).done(t);d(AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+o,{entityType:p}).done(r).fail(function(){var u=i.getCurrentPanel().body.find(".project-content-wrapper");u.find(".projectshortcuts-loading").remove();AJS.messages.error(u,{body:"Could not retrieve remote project shortcuts",closeable:false});c(i)})}else{l(k[o])}function t(u){k[o].localShortcuts=u.shortcuts;l(k[o])}function r(u){k[o].remoteShortcuts=u.shortcuts;l(k[o])}}function h(){return e(".project-shortcut-dialog-trigger img").attr("src")}function l(n){if(n.localShortcuts){i.getCurrentPanel().html(navlinks.templates.projectshortcuts.headingWrapper({title:n.entity.title,logoUrl:h(),contentHtml:navlinks.templates.projectshortcuts.dialogContent(n)}));c(i)}}function a(p){var o=210;if(!p||p.length<=o){return p}var n=o;while(n>0&&p.charAt(n)!=" "){n--}if(n==0){n=o}p=p.substring(0,n);if(p.length>=n){p=p+"..."}return p}function c(n){var q=n.popup.element,p=q.find(".dialog-panel-body"),o=q.find(".dialog-components");p.height("auto");q.height(o.outerHeight()-1);e(".aui-shadow").remove()}function d(n,o){return e.ajax({url:n,cache:false,data:o,dataType:"json"})}e(document).on("click",".project-shortcut-dialog-trigger",f)}(jQuery,window.NL=(window.NL||{})));;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:atlassian-ui-popup-display-controller', location = 'popups/DisplayController.js' */
AJS.Popups=AJS.Popups||{};AJS.Popups.DisplayController=function(){var c=[];var a=false;var b=false;AJS.toInit(function(){setTimeout(function(){AJS.Popups.DisplayController.render()},0)});return{request:function(d){c.push(d);if(a&&b===false){this.render()}},render:function(){c.sort(function(e,d){return e.weight-d.weight});a=true;if(c.length!==0){b=true;c[0].show()}}}}();;
;
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics', location = 'browser-metrics-legacy.js' */
(function(){var a=window.BrowserMetrics||{};var b=window.WRM||{};a.isFunction=function(c){return !!(c&&c.constructor&&c.call&&c.apply)};a.isEnabled=function(){if(a.enabled===undefined){var c="com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy";a.enabled=a.isFunction(b.data)?b.data(c):b.data.claim(c)}return a.enabled};window.BrowserMetrics=a}());(function(){var b=window.BrowserMetrics||{};if(b.isEnabled()){var f=5;var e=12000;var c=function(g){return Math.round(g)};var a=function(g){return Math.round(g*100)/100};var d=function(k){var h=(function(){var n=/^(\w+):\/\/([^\/]*)(.*)$/;return function(p){var o=p.match(n);if(!o){return{path:p}}return{scheme:o[1],host:o[2],path:o[3]}}}());var i=(function(){var n=["secureConnectionStart","requestStart","responseStart","responseEnd","domContentLoadedEventStart","domContentLoadedEventEnd","loadEventEnd"];return function(o){if(k.performance){var s=k.performance.timing;var p=s.navigationStart;if(p){for(var r=0;r<n.length;++r){var q=n[r];var t=s[q];if(t){o(q,t-p)}}}}}}());var g=(function(){var o=[{key:"LOGIN",pattern:/^\/login.*/i},{key:"J-DASH",pattern:/^\/secure\/dashboard\.jspa.*/i},{key:"J-ISSUE",pattern:/^\/browse\/\w+\-\w+.*/i},{key:"J-NAV",pattern:/^\/issues.*/i},{key:"J-RAPID",pattern:/secure\/rapidboard\.jspa/i},{key:"SD-AGENT",pattern:/^(\/\w+)?\/servicedesk\/agent\/.*/i},{key:"SD-CUSTOMER",pattern:/^(\/\w+)?\/servicedesk\/customer\/.*/i},{key:"C-DASH",pattern:/^\/wiki(\/)?(\?.*|#.*)?$/i},{key:"C-DASH",pattern:/^\/wiki\/dashboard\.action.*$/i},{key:"C-SPACE",pattern:/^\/wiki\/display\/\w+(\?.*|#.*)?$/i},{key:"C-PAGE",pattern:/^\/wiki\/display\/\w+\/.*/i},{key:"C-PAGE",pattern:/^\/wiki\/pages\/viewpage\.action.*/i},{key:"C-BLOG",pattern:/^\/wiki\/display\/~\w+\/\d+\/\d+\/\d+\/.*/i},{key:"C-EDITOR",pattern:/^\/wiki\/pages\/editpage\.action.*/i},{key:"C-CREATE",pattern:/^\/wiki\/pages\/createpage\.action.*/i}];return function n(){var r=h(k.location.href).path;for(var p=0;p<o.length;++p){var q=o[p];if(r.match(q.pattern)){return q.key}}return null}}());function j(){var n=g();if(n){i(function(p,r){var o="browser.metrics."+p,q={version:f,page:n,value:r>e?"x":Math.ceil((r)/100),rawValue:c(r)};AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent(o,q):AJS.trigger("analyticsEvent",{name:o,data:q})})}}function m(){try{j()}catch(n){if(window.console){window.console.log("Error reporting browser metrics: "+n)}}}function l(){if(k.performance.timing.loadEventEnd){m()}else{setTimeout(l,1000)}}if(k.performance&&k.performance.timing){l()}};if(!window.ATL_PERF){window.ATL_PERF={}}window.ATL_PERF.initPageLoad=d}}());(function(){var b=window.BrowserMetrics||{};if(b.isEnabled()){var e=5;var d=12000;var a=function(f){return Math.round(f*100)/100};var c=function(g){var l={};function h(){return g.performance&&g.performance.now?g.performance.now():new Date().getTime()}function n(o){return o===Object(o)}function k(o){if(n(o)){return o.eventName+"."+o.eventType}else{return o}}function m(o){if(n(o)){return o.eventName}else{return o}}function j(o){if(n(o)){return o.eventType}else{return""}}function f(o){var p=k(o);l[p]=h()}function i(r,u){var v=k(r);if(!l[v]){throw ("Error logging browser metrics event end: no start event for key '"+v+"'")}var t=h()-l[v];l[v]=null;var o=m(r),q=j(r);var p="browser.metrics.e."+o+(u?"."+u:""),s={version:e,value:t>d?"x":Math.ceil((t)/100),rawValue:a(t),eventType:q};g.AJS.Analytics?g.AJS.Analytics.triggerPrivacyPolicySafeEvent(p,s):g.AJS.trigger("analyticsEvent",{name:p,data:s})}return{start:f,end:i}};if(!window.ATL_PERF){window.ATL_PERF={}}window.ATL_PERF.initEvents=c}}());(function(){var a=window.BrowserMetrics||{};if(a.isEnabled()){if(Math.random()<0.1){window.ATL_PERF&&window.ATL_PERF.initPageLoad&&window.ATL_PERF.initPageLoad(window)}window.ATL_PERF&&window.ATL_PERF.initEvents&&(function(){window.BrowserMetrics=window.ATL_PERF.initEvents(window)}())}}());;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.soy' */
// This file was automatically generated from appswitcher.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.appswitcher.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher == 'undefined') { navlinks.templates.appswitcher = {}; }


navlinks.templates.appswitcher.linkSection = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.list.length > 0) {
    output += '<div class="aui-nav-heading sidebar-section-header">' + soy.$$escapeHtml(opt_data.title) + '</div><ul class="aui-nav nav-links">';
    var linkList8 = opt_data.list;
    var linkListLen8 = linkList8.length;
    for (var linkIndex8 = 0; linkIndex8 < linkListLen8; linkIndex8++) {
      var linkData8 = linkList8[linkIndex8];
      output += navlinks.templates.appswitcher.applicationsItem(linkData8);
    }
    output += '</ul>';
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.linkSection.soyTemplateName = 'navlinks.templates.appswitcher.linkSection';
}


navlinks.templates.appswitcher.applicationsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link"><a href="' + soy.$$escapeHtml(opt_data.link) + '" ' + ((opt_data.self) ? 'class="checked"' : '') + ' title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span></a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.applicationsItem.soyTemplateName = 'navlinks.templates.appswitcher.applicationsItem';
}


navlinks.templates.appswitcher.shortcutsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link"><a href="' + soy.$$escapeHtml(opt_data.link) + '" ' + ((opt_data.self) ? 'class="checked"' : '') + ' title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' + ((opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '') + '</a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.shortcutsItem.soyTemplateName = 'navlinks.templates.appswitcher.shortcutsItem';
}


navlinks.templates.appswitcher.error = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-error">' + soy.$$filterNoAutoescape("Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.") + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.error.soyTemplateName = 'navlinks.templates.appswitcher.error';
}


navlinks.templates.appswitcher.sidebarContents = function(opt_data, opt_ignored) {
  return '<div class="aui-page-panel-nav"><nav class="aui-navgroup aui-navgroup-vertical"><div class="app-switcher-section app-switcher-applications"><div class="aui-nav-heading">' + soy.$$escapeHtml("Application Links") + '</div><div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Loading\x26hellip;") + '</div></div><div class="app-switcher-section app-switcher-shortcuts"><div class="aui-nav-heading">' + soy.$$escapeHtml("Shortcuts") + '</div><div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Loading\x26hellip;") + '</div></div></nav></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.sidebarContents.soyTemplateName = 'navlinks.templates.appswitcher.sidebarContents';
}


navlinks.templates.appswitcher.trigger = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">' + soy.$$escapeHtml("Linked Applications") + '</span>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.trigger.soyTemplateName = 'navlinks.templates.appswitcher.trigger';
}


navlinks.templates.appswitcher.projectHeaderSection = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-title">' + aui.avatar.avatar({size: 'large', avatarImageUrl: opt_data.avatarUrl, isProject: true, title: opt_data.name}) + '<div class="sidebar-project-name">' + soy.$$escapeHtml(opt_data.name) + '</div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.projectHeaderSection.soyTemplateName = 'navlinks.templates.appswitcher.projectHeaderSection';
}


navlinks.templates.appswitcher.cogDropdown = function(opt_data, opt_ignored) {
  var output = '';
  var dropdownList__soy74 = '' + navlinks.templates.appswitcher.dropdownList({list: opt_data.links});
  output += aui.dropdown2.dropdown2({menu: {id: opt_data.id, content: dropdownList__soy74, extraClasses: 'aui-style-default sidebar-customize-section'}, trigger: {showIcon: false, content: '<span class="aui-icon aui-icon-small aui-iconfont-configure"></span>', container: '#app-switcher'}});
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.cogDropdown.soyTemplateName = 'navlinks.templates.appswitcher.cogDropdown';
}


navlinks.templates.appswitcher.dropdownList = function(opt_data, opt_ignored) {
  var output = '<ul class="sidebar-admin-links">';
  var linkList82 = opt_data.list;
  var linkListLen82 = linkList82.length;
  for (var linkIndex82 = 0; linkIndex82 < linkListLen82; linkIndex82++) {
    var linkData82 = linkList82[linkIndex82];
    output += '<li class="nav-link"><a href="' + soy.$$escapeHtml(linkData82.href) + '" title="' + soy.$$escapeHtml(linkData82.title) + '"><span class="nav-link-label">' + soy.$$escapeHtml(linkData82.label) + '</span></a></li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.dropdownList.soyTemplateName = 'navlinks.templates.appswitcher.dropdownList';
}


navlinks.templates.appswitcher.switcher = function(opt_data, opt_ignored) {
  var output = '';
  if (true) {
    if (AJS.DarkFeatures.isEnabled('rotp.sidebar')) {
      var sidebarContents__soy97 = '' + navlinks.templates.appswitcher.sidebarContents(null);
      var triggerContent__soy99 = '' + navlinks.templates.appswitcher.trigger(null);
      output += navlinks.templates.appswitcher.sidebar({sidebar: {id: 'app-switcher', content: sidebarContents__soy97}, trigger: {showIcon: false, content: triggerContent__soy99}}) + '<script>\n                (function (NL) {\n                    var initialise = function () {\n                        new NL.SideBar({\n                            sidebarContents: \'#app-switcher\'\n                        });\n                    };\n                    if (NL.SideBar) {\n                        initialise();\n                    } else {\n                        NL.onInit = initialise;\n                    }\n                }(window.NL = (window.NL || {})));\n                window.NL.isUserAdmin = ' + soy.$$escapeHtml(false) + '<\/script>';
    } else {
      output += navlinks.templates.appswitcher_old.switcher(null);
    }
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.switcher.soyTemplateName = 'navlinks.templates.appswitcher.switcher';
}


navlinks.templates.appswitcher.sidebar = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml(opt_data.sidebar.id) + '" class="sidebar-trigger app-switcher-trigger" aria-owns="' + soy.$$escapeHtml(opt_data.sidebar.id) + '" aria-haspopup="true">' + soy.$$filterNoAutoescape(opt_data.trigger.content) + '</a><div id=' + soy.$$escapeHtml(opt_data.sidebar.id) + ' class="app-switcher-sidebar aui-style-default sidebar-offscreen">' + soy.$$filterNoAutoescape(opt_data.sidebar.content) + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.sidebar.soyTemplateName = 'navlinks.templates.appswitcher.sidebar';
}
;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.js' */
(function(c,a){a.SideBar=function(d){var e=this;this.$sidebar=null;d=c.extend({sidebarContents:null},d);this.getLinks=function(){return c.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateAppLinks).fail(this.showAppSwitcherError)};this.populateProjectHeader=function(g,f){e.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").after(navlinks.templates.appswitcher.projectHeaderSection({avatarUrl:f,name:g}))};this.getProjectData=function(){var f=c(".project-shortcut-dialog-trigger"),g=f.data("key"),h=f.data("entity-type");if(f.size()==0||!g||!h){c(".app-switcher-shortcuts").remove();return}var j,i;i=c.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+g,cache:false,data:{entityType:h},dataType:"json"});j=c.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+g,cache:false,data:{entityType:h},dataType:"json"});c.when(i,j).then(function(l,k){e.updateProjectShortcuts(l,k,{key:g,entityType:h,name:f.data("name"),avatarUrl:f.find("img").prop("src")})},e.showProjectShortcutsError)};this.getSidebar=function(){if(!this.$sidebar){this.$sidebar=c(d.sidebarContents)}return this.$sidebar};this.addApplicationsCog=function(){c(".app-switcher-applications .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-applications-admin-dropdown",links:[{href:AJS.contextPath()+"/plugins/servlet/customize-application-navigator",label:"Customize navigator",title:"Add new entries, hide existing or restrict who sees what"},{href:AJS.contextPath()+"/plugins/servlet/applinks/listApplicationLinks",label:"Manage application links",title:"Link to more Atlassian applications"}]}))};this.addProjectShortcutsCog=function(f,h){var g=[{href:AJS.contextPath()+"/plugins/servlet/custom-content-links-admin?entityKey="+f,label:"Customize shortcuts",title:""}];if(e.entityMappings[h]){g.push({href:e.generateEntityLinksUrl(f,e.entityMappings[h]),label:"Manage product links",title:""})}e.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-project-shortcuts-admin-dropdown",links:g}))};this.updateAppLinks=function(f){c(function(){e.getSidebar().find(".app-switcher-applications").html(navlinks.templates.appswitcher.linkSection({title:"Application Links",list:f}));if(a.isUserAdmin){e.addApplicationsCog()}e.bindAnalyticsHandlers(e.getSidebar(),f)})};this.updateProjectShortcuts=function(i,g,h){var j=i[0].shortcuts,f=g[0].shortcuts;e.getSidebar().find(".app-switcher-shortcuts").html(navlinks.templates.appswitcher.linkSection({title:"Shortcuts",list:j.concat(f)}));if(a.isUserAdmin){e.addProjectShortcutsCog(h.key,h.entityType)}e.populateProjectHeader(h.name,h.avatarUrl);e.bindAnalyticsHandlers(e.getSidebar(),data)};this.entityMappings={"confluence.space":"com.atlassian.applinks.api.application.confluence.ConfluenceSpaceEntityType","jira.project":"com.atlassian.applinks.api.application.jira.JiraProjectEntityType","bamboo.project":"com.atlassian.applinks.api.application.bamboo.BambooProjectEntityType","stash.project":"com.atlassian.applinks.api.application.stash.StashProjectEntityType"};this.generateEntityLinksUrl=function(f,g){if(g===e.entityMappings["confluence.space"]){return AJS.contextPath()+"/spaces/listentitylinks.action?typeId="+g+"&key="+f}else{return AJS.contextPath()+"/plugins/servlet/applinks/listEntityLinks/"+g+"/"+f}};this.showAppSwitcherError=function(){c(function(){var f=e.getSidebar();f.find(".app-switcher-applications .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());f.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",c.proxy(e.retryLoading,e))})};this.showProjectShortcutsError=function(){c(function(){var f=e.getSidebar();f.find(".app-switcher-shortcuts .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());f.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",c.proxy(e.retryLoading,e))})};this.retryLoading=function(f){this.getSidebar().html(navlinks.templates.appswitcher.sidebarContents());this.getLinks();this.getProjectData();f&&f.stopPropagation()};this.bindAnalyticsHandlers=function(f,g){};this.getLinks();c(this.getProjectData);this.toggleSidebar=function(h){var i=e.getSidebar(),g=c("body"),f=c(window.document);if(!g.hasClass("app-switcher-open")){var k=c("#header");i.css("left",-i.width());i.parent("body").length||i.appendTo("body");b({data:i});i.animate({left:0},300);function j(l){var n=l.target&&c(l.target),m=l.keyCode;if(l.originalEvent===h.originalEvent){return}if(n&&!m&&!(n.closest(i).length||n.closest(k).length)&&h.which==1&&!(l.shiftKey||l.ctrlKey||l.metaKey)){e.toggleSidebar()}else{if(m===27){e.toggleSidebar()}}}f.on("click.appSwitcher",j);f.on("keydown.appSwitcher",j);f.on("scroll.appSwitcher",i,b)}else{f.off(".appSwitcher")}g.toggleClass("app-switcher-open")};c("#header").on("click",".app-switcher-trigger",this.toggleSidebar)};function b(f){var d=c(document).scrollTop(),g=c("#header"),e=(g.height()+g.offset().top)-d;if(e>=0){f.data.css({top:e,position:"fixed"})}else{f.data.css({top:0,left:0,position:"fixed"})}}if(a.onInit){a.onInit()}}(jQuery,window.NL=(window.NL||{})));;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.js' */
(function(e,c){c.AppSwitcher=function(f){var g=AJS.contextPath()+"/plugins/servlet/customize-application-navigator";var h=this;this.$dropdown=null;f=e.extend({dropdownContents:null},f);this.getLinks=function(){return e.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateDropdown).fail(this.showError)};this.getDropdown=function(){if(!this.$dropdown){this.$dropdown=e(f.dropdownContents)}return this.$dropdown};this.updateDropdown=function(i){e(function(){h.getDropdown().html(navlinks.templates.appswitcher_old.applications({apps:i,showAdminLink:c.environment.isUserAdmin,adminLink:g}));h.bindAnalyticsHandlers(h.getDropdown(),i);if(window.NL.environment.isAppSuggestionAvailable){h.handleSuggestionApps(i)}})};this.bindAnalyticsHandlers=function(i,j){};this.handleSuggestionApps=function(k){var l=_.map(k,function(m){return m.applicationType.toLowerCase()});$suggestionApps=e("<div id='app-switcher-suggestion-apps' class='aui-dropdown2-section'/>");$suggestionApps.html(navlinks.templates.appswitcher_old.suggestionApps);var j=$suggestionApps.find(".suggestion-apps");var i=false;_.each(a,function(m){if(!_.contains(l,m.appName)){i=true;j.append(navlinks.templates.appswitcher_old.suggestionApp({appName:m.appName,appDesc:m.appDesc}))}});if(!i){return}e("#app-switcher").append($suggestionApps);e(".app-discovery-suggestion-app").click(function(){AJS.trigger("analytics",{name:"appswitcher.discovery.user.select."+e(this).find("a").attr("id").toLowerCase()});window.open(e(this).find("a").attr("title"),"_blank")});e(".app-discovery-suggestion-app").hover(function(){e(this).find("a").removeClass("active").removeClass("aui-dropdown2-active")});e(".app-discovery-cancel-button").click(function(){AJS.trigger("analytics",{name:"appswitcher.discovery.nothanks.button.click"});d(b,"true");$suggestionApps.remove()})};this.showError=function(){e(function(){h.getDropdown().html(navlinks.templates.appswitcher_old.error()).off(".appswitcher").on("click.appswitcher",".app-switcher-retry",e.proxy(h.retryLoading,h))})};this.retryLoading=function(i){this.getDropdown().html(navlinks.templates.appswitcher_old.loading());this.getLinks();i&&i.stopPropagation()};this.getLinks()};var b="key-no-thanks";var a=[{appName:"jira",appDesc:"Issue & Project Tracking Software"},{appName:"confluence",appDesc:"Collaboration and content sharing"},{appName:"bamboo",appDesc:"Continuous integration"}];var d=function(f,g){e.ajax({url:AJS.contextPath()+"/rest/menu/latest/userdata/",type:"PUT",contentType:"application/json",data:JSON.stringify({key:f,value:g})})};if(c.onInit){c.onInit()}}(jQuery,window.NL=(window.NL||{})));;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.soy' */
// This file was automatically generated from appswitcher_old.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.appswitcher_old.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher_old == 'undefined') { navlinks.templates.appswitcher_old = {}; }


navlinks.templates.appswitcher_old.applications = function(opt_data, opt_ignored) {
  return '' + navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.apps, listClass: 'nav-links', showDescription: opt_data.showDescription}) + ((opt_data.custom) ? navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.custom, showDescription: opt_data.showDescription}) : '') + ((opt_data.showAdminLink) ? navlinks.templates.appswitcher_old.adminSection(opt_data) : '');
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applications.soyTemplateName = 'navlinks.templates.appswitcher_old.applications';
}


navlinks.templates.appswitcher_old.applicationsSection = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.list.length > 0) {
    var param19 = '<ul' + ((opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '') + '>';
    var linkList27 = opt_data.list;
    var linkListLen27 = linkList27.length;
    for (var linkIndex27 = 0; linkIndex27 < linkListLen27; linkIndex27++) {
      var linkData27 = linkList27[linkIndex27];
      param19 += navlinks.templates.appswitcher_old.applicationsItem(soy.$$augmentMap(linkData27, {showDescription: opt_data.showDescription}));
    }
    param19 += '</ul>';
    output += aui.dropdown2.section({content: param19});
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applicationsSection.soyTemplateName = 'navlinks.templates.appswitcher_old.applicationsSection';
}


navlinks.templates.appswitcher_old.applicationsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link' + ((opt_data.self) ? ' nav-link-local' : '') + '"><a href="' + soy.$$escapeHtml(opt_data.link) + '" class="aui-dropdown2-radio ' + ((opt_data.self) ? 'aui-dropdown2-checked' : '') + '" title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' + ((opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '') + '</a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applicationsItem.soyTemplateName = 'navlinks.templates.appswitcher_old.applicationsItem';
}


navlinks.templates.appswitcher_old.adminSection = function(opt_data, opt_ignored) {
  return '' + aui.dropdown2.section({content: '<ul class="nav-links"><li><a class="nav-link-edit-wrapper" href="' + soy.$$escapeHtml(opt_data.adminLink) + '"><span class="nav-link-edit">' + soy.$$filterNoAutoescape("Configure\x26hellip;") + '</span></a></li></ul>'});
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.adminSection.soyTemplateName = 'navlinks.templates.appswitcher_old.adminSection';
}


navlinks.templates.appswitcher_old.error = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-error">' + soy.$$filterNoAutoescape("Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.") + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.error.soyTemplateName = 'navlinks.templates.appswitcher_old.error';
}


navlinks.templates.appswitcher_old.loading = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Loading\x26hellip;") + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.loading.soyTemplateName = 'navlinks.templates.appswitcher_old.loading';
}


navlinks.templates.appswitcher_old.trigger = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">' + soy.$$escapeHtml("Linked Applications") + '</span>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.trigger.soyTemplateName = 'navlinks.templates.appswitcher_old.trigger';
}


navlinks.templates.appswitcher_old.switcher = function(opt_data, opt_ignored) {
  var output = '';
  if (true) {
    var loadingContent__soy81 = '' + navlinks.templates.appswitcher_old.loading(null);
    var triggerContent__soy83 = '' + navlinks.templates.appswitcher_old.trigger(null);
    output += aui.dropdown2.dropdown2({menu: {id: 'app-switcher', content: loadingContent__soy81, extraClasses: 'aui-style-default'}, trigger: {showIcon: false, content: triggerContent__soy83, extraClasses: 'app-switcher-trigger', extraAttributes: {href: '#app-switcher'}}}) + '<script>\n            (function (NL) {\n                var initialise = function () {\n                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.\n                    window.atlassian = window.atlassian || window.aui;\n                    new NL.AppSwitcher({\n                        dropdownContents: \'#app-switcher\'\n                    });\n                };\n                if (NL.AppSwitcher) {\n                    initialise();\n                } else {\n                    NL.onInit = initialise;\n                }\n            }(window.NL = (window.NL || {})));\n            window.NL.environment = ' + soy.$$escapeHtml({}) + ';<\/script>';
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.switcher.soyTemplateName = 'navlinks.templates.appswitcher_old.switcher';
}


navlinks.templates.appswitcher_old.suggestionApp = function(opt_data, opt_ignored) {
  return '<li class="app-discovery-suggestion-app"><a id="' + soy.$$escapeHtml(opt_data.appName) + '" href="#" class="app-discovery-link aui-icon-container app-discovery-' + soy.$$escapeHtml(opt_data.appName) + '-product-icon" title="https://www.atlassian.com/software/' + soy.$$escapeHtml(opt_data.appName) + '"/><div class="app-discovery-small">' + soy.$$escapeHtml(opt_data.appDesc) + '</div></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.suggestionApp.soyTemplateName = 'navlinks.templates.appswitcher_old.suggestionApp';
}


navlinks.templates.appswitcher_old.suggestionApps = function(opt_data, opt_ignored) {
  return '<ul class=\'nav-links suggestion-apps\'><li><span class=\'app-discovery-suggest-title nav-link-label\'><h6>' + soy.$$escapeHtml("Try other Atlassian apps") + '</h6></span></li></ul><div class=\'buttons-container app-discovery-suggest-apps-buttons\'><div class=\'buttons\'><button class=\'aui-button aui-button-link app-discovery-cancel-button\' name=\'cancel\' accesskey=\'c\' href=\'#\'>' + soy.$$escapeHtml("Don\x27t show this again") + '</button></div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.suggestionApps.soyTemplateName = 'navlinks.templates.appswitcher_old.suggestionApps';
}
;
;
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/inline-dialog.js' */
(function(d){AJS.CustomInlineDialog=AJS.CustomInlineDialog||function(B,n,r,p){p=p||[];if(p.hasOwnProperty("getArrowAttributes")){getArrowAttributesDeprecationLogger()}if(p.hasOwnProperty("getArrowPath")){getArrowPathDeprecationLogger();if(p.hasOwnProperty("gravity")){getArrowPathWithGravityDeprecationLogger()}}if(p.hasOwnProperty("onTop")){onTopDeprecationLogger();if(p.onTop&&p.gravity===undefined){p.gravity="s"}}if(typeof n==="undefined"){n=String(Math.random()).replace(".","");if(d("#inline-dialog-"+n+", #arrow-"+n+", #inline-dialog-shim-"+n).length){throw"GENERATED_IDENTIFIER_NOT_UNIQUE"}}var z=d.extend(false,AJS.CustomInlineDialog.opts,p);if(z.gravity==="w"){z.offsetX=p.offsetX===undefined?10:p.offsetX;z.offsetY=p.offsetY===undefined?0:p.offsetY}var v=function(){return window.Raphael&&p&&(p.getArrowPath||p.getArrowAttributes)};var j;var q;var K;var u=false;var A=false;var I=false;var J;var x;var g=d('<div id="inline-dialog-'+n+'" class="aui-inline-dialog"><div class="aui-inline-dialog-contents contents"></div><div id="arrow-'+n+'" class="aui-inline-dialog-arrow arrow"></div></div>');var m=d("#arrow-"+n,g);var G=g.find(".contents");if(!v()){g.find(".aui-inline-dialog-arrow").addClass("aui-css-arrow")}if(!z.displayShadow){G.addClass("aui-inline-dialog-no-shadow")}if(z.autoWidth){G.addClass("aui-inline-dialog-auto-width")}else{G.css("width",z.width+"px")}G.mouseover(function(O){clearTimeout(q);g.unbind("mouseover")}).mouseout(function(){E()});var D=function(){if(!j){j={popup:g,hide:function(){E(0)},id:n,show:function(){y()},persistent:z.persistent?true:false,reset:function(){function S(U,T){U.css(T.popupCss);if(v()){if(T.gravity==="s"){T.arrowCss.top-=d.browser.msie?10:9}if(!U.arrowCanvas){U.arrowCanvas=Raphael("arrow-"+n,16,16)}var V=z.getArrowPath,W=d.isFunction(V)?V(T):V;U.arrowCanvas.path(W).attr(z.getArrowAttributes())}else{m.removeClass("aui-bottom-arrow aui-left-arrow aui-right-arrow");if(T.gravity==="s"&&!m.hasClass("aui-bottom-arrow")){m.addClass("aui-bottom-arrow")}else{if(T.gravity==="n"){}else{if(T.gravity==="w"){m.addClass("aui-left-arrow")}else{if(T.gravity==="e"){m.addClass("aui-right-arrow")}}}}}m.css(T.arrowCss)}var P=AJS.$(window).height();var Q=Math.round(P*0.75);g.children(".aui-inline-dialog-contents").css("max-height",Q);var O=z.calculatePositions(g,x,J,z);if(O.hasOwnProperty("displayAbove")){displayAboveDeprecationLogger();O.gravity=O.displayAbove?"s":"n"}S(g,O);g.fadeIn(z.fadeTime,function(){});if(d.browser.msie&&~~(d.browser.version)<10){var R=d("#inline-dialog-shim-"+n);if(!R.length){d(g).prepend(d('<iframe class = "inline-dialog-shim" id="inline-dialog-shim-'+n+'" frameBorder="0" src="javascript:false;"></iframe>'))}R.css({width:G.outerWidth(),height:G.outerHeight()})}}}}return j};var y=function(){if(g.is(":visible")){return}K=setTimeout(function(){if(!I||!A){return}z.addActiveClass&&d(B).addClass("active");u=true;if(!z.persistent){H()}AJS.CustomInlineDialog.current=D();d(document).trigger("showLayer",["inlineDialog",D()]);D().reset()},z.showDelay)};var E=function(O){if(typeof O=="undefined"&&z.persistent){return}A=false;if(u&&z.preHideCallback.call(g[0].popup)){O=(O==null)?z.hideDelay:O;clearTimeout(q);clearTimeout(K);if(O!=null){q=setTimeout(function(){l();z.addActiveClass&&d(B).removeClass("active");g.fadeOut(z.fadeTime,function(){z.hideCallback.call(g[0].popup)});if(g.arrowCanvas){g.arrowCanvas.remove();g.arrowCanvas=null}u=false;A=false;d(document).trigger("hideLayer",["inlineDialog",D()]);AJS.CustomInlineDialog.current=null;if(!z.cacheContent){I=false;w=false}},O)}}};var F=function(R,P){var O=d(P);z.upfrontCallback.call({popup:g,hide:function(){E(0)},id:n,show:function(){y()}});g.each(function(){if(typeof this.popup!="undefined"){this.popup.hide()}});if(z.closeOthers){d(".aui-inline-dialog").each(function(){!this.popup.persistent&&this.popup.hide()})}x={target:O};if(!R){J={x:O.offset().left,y:O.offset().top}}else{J={x:R.pageX,y:R.pageY}}if(!u){clearTimeout(K)}A=true;var Q=function(){w=false;I=true;z.initCallback.call({popup:g,hide:function(){E(0)},id:n,show:function(){y()}});y()};if(!w){w=true;if(d.isFunction(r)){r(G,P,Q)}else{d.get(r,function(T,S,U){G.html(z.responseHandler(T,S,U));I=true;z.initCallback.call({popup:g,hide:function(){E(0)},id:n,show:function(){y()}});y()})}}clearTimeout(q);if(!u){y()}return false};g[0].popup=D();var w=false;var t=false;var s=function(){if(!t){d(z.container).append(g);t=true}};var o=d(B);if(z.onHover){if(z.useLiveEvents){if(o.selector){d(document).on("mousemove",o.selector,function(O){s();F(O,this)}).on("mouseout",o.selector,function(){E()})}else{AJS.log("Warning: inline dialog trigger elements must have a jQuery selector when the useLiveEvents option is enabled.")}}else{o.mousemove(function(O){s();F(O,this)}).mouseout(function(){E()})}}else{if(!z.noBind){if(z.useLiveEvents){if(o.selector){d(document).on("click",o.selector,function(O){s();if(M()){g.hide()}else{F(O,this)}return false}).on("mouseout",o.selector,function(){E()})}else{AJS.log("Warning: inline dialog trigger elements must have a jQuery selector when the useLiveEvents option is enabled.")}}else{o.click(function(O){s();if(M()){g.hide()}else{F(O,this)}return false}).mouseout(function(){E()})}}}var M=function(){return u&&z.closeOnTriggerClick};var H=function(){k();f()};var l=function(){C();N()};var i=false;var h=n+".inline-dialog-check";var k=function(){if(!i){d("body").bind("click."+h,function(P){var O=d(P.target);if(O.closest("#inline-dialog-"+n+" .contents").length===0){E(0)}});i=true}};var C=function(){if(i){d("body").unbind("click."+h)}i=false};var L=function(O){if(O.keyCode===27){E(0)}};var f=function(){d(document).on("keydown",L)};var N=function(){d(document).off("keydown",L)};g.show=function(P,O){if(P){P.stopPropagation()}s();if(z.noBind&&!(B&&B.length)){F(P,O===undefined?P.target:O)}else{F(P,B)}};g.hide=function(){E(0)};g.refresh=function(){if(u){D().reset()}};g.getOptions=function(){return z};return g};function c(g){var f=d(g);var h=d.extend({left:0,top:0},f.offset());return{left:h.left,top:h.top,width:f.outerWidth(),height:f.outerHeight()}}function b(h,j,t,f){var m=AJS.$.isFunction(f.offsetX)?f.offsetX(h,j,t,f):f.offsetX;var l=AJS.$.isFunction(f.offsetY)?f.offsetY(h,j,t,f):f.offsetY;var q=AJS.$.isFunction(f.arrowOffsetX)?f.arrowOffsetX(h,j,t,f):f.arrowOffsetX;var p=AJS.$.isFunction(f.arrowOffsetY)?f.arrowOffsetY(h,j,t,f):f.arrowOffsetY;var s=f.container.toLowerCase()!=="body";var g=AJS.$(f.container);var o=s?AJS.$(f.container).parent():AJS.$(window);var r=s?g.offset():{left:0,top:0};var k=s?o.offset():{left:0,top:0};var i=j.target;var u=i.offset();var n=i[0].getBBox&&i[0].getBBox();return{screenPadding:10,arrowMargin:5,window:{top:k.top,left:k.left,scrollTop:o.scrollTop(),scrollLeft:o.scrollLeft(),width:o.width(),height:o.height()},scrollContainer:{width:g.width(),height:g.height()},trigger:{top:u.top-r.top,left:u.left-r.left,width:n?n.width:i.outerWidth(),height:n?n.height:i.outerHeight()},dialog:{width:h.width(),height:h.height(),offset:{top:l,left:m}},arrow:{height:h.find(".arrow").outerHeight(),offset:{top:p,left:q}}}}function e(f,p,G,r){var n=b(f,p,G,r);var j=n.screenPadding;var k=n.window;var t=n.trigger;var D=n.dialog;var i=n.arrow;var z=n.scrollContainer;var E={top:t.top-k.scrollTop,left:t.left-k.scrollLeft};var A=Math.floor(t.height/2);var v=Math.floor(D.height/2);var u=Math.floor(i.height/2);var C=E.left-D.offset.left-j;var H=z.width-E.left-t.width-D.offset.left-j;var B=C>=D.width;var h=H>=D.width;var l=!h&&B?"e":"w";var o=E.top+A-u;var q=k.height-o-i.height;j=Math.min(j,o-n.arrowMargin);j=Math.min(j,q-n.arrowMargin);var g=E.top+A;var x=Math.max(g-j,0);var F=Math.max(k.height-g-j,0);var y=v-D.offset.top>x;var m=v+D.offset.top>F;var w;var s;if(y){w={top:k.scrollTop+j,left:l==="w"?t.left+t.width+D.offset.left:t.left-D.width-D.offset.left};s={top:(t.top+A)-(w.top+u)}}else{if(m){w={top:k.scrollTop+k.height-D.height-j,left:l==="w"?t.left+t.width+D.offset.left:t.left-D.width-D.offset.left};s={top:(t.top+A)-(w.top+u)}}else{w={top:t.top+A-v+D.offset.top,left:l==="w"?t.left+t.width+D.offset.left:t.left-D.width-D.offset.left};s={top:v-u+i.offset.top}}}return{gravity:l,popupCss:w,arrowCss:s}}function a(g,o,z,s){var x=AJS.$.isFunction(s.offsetX)?s.offsetX(g,o,z,s):s.offsetX;var v=AJS.$.isFunction(s.offsetY)?s.offsetY(g,o,z,s):s.offsetY;var m=AJS.$.isFunction(s.arrowOffsetX)?s.arrowOffsetX(g,o,z,s):s.arrowOffsetX;var l=AJS.$.isFunction(s.arrowOffsetY)?s.arrowOffsetY(g,o,z,s):s.arrowOffsetY;var f=c(window);var p=c(o.target);var y=c(g);var j=c(g.find(".aui-inline-dialog-arrow"));var i=p.left+p.width/2;var u=(window.pageYOffset||document.documentElement.scrollTop)+f.height;var k=10;y.top=p.top+p.height+~~v;y.left=p.left+~~x;var r=f.width-(y.left+y.width+k);j.left=i-y.left+~~m;j.top=-(j.height/2);var n=p.top>y.height;var h=(y.top+y.height)<u;var q=(!h&&n)||(n&&s.gravity==="s");if(q){y.top=p.top-y.height-(j.height/2);j.top=y.height}if(s.isRelativeToMouse){if(r<0){y.right=k;y.left="auto";j.left=z.x-(f.width-y.width)}else{y.left=z.x-20;j.left=z.x-y.left}}else{if(r<0){y.right=k;y.left="auto";var w=f.width-y.right;var t=w-y.width;j.right="auto";j.left=i-t-j.width/2}else{if(y.width<=p.width/2){j.left=y.width/2;y.left=i-y.width/2}}}return{gravity:q?"s":"n",displayAbove:q,popupCss:{left:y.left,top:y.top,right:y.right},arrowCss:{left:j.left,top:j.top,right:j.right}}}AJS.CustomInlineDialog.opts={onTop:false,responseHandler:function(g,f,h){return g},closeOthers:true,isRelativeToMouse:false,addActiveClass:true,onHover:false,useLiveEvents:false,noBind:false,fadeTime:100,persistent:false,hideDelay:10000,showDelay:0,width:300,offsetX:0,offsetY:10,arrowOffsetX:0,arrowOffsetY:0,container:"body",cacheContent:true,displayShadow:true,autoWidth:false,gravity:"n",closeOnTriggerClick:false,preHideCallback:function(){return true},hideCallback:function(){},initCallback:function(){},upfrontCallback:function(){},calculatePositions:function(f,i,j,h){h=h||{};var g=h.gravity==="w"?e:a;return g(f,i,j,h)},getArrowPath:function(f){if(f.gravity==="s"){return"M0,8L8,16,16,8"}else{return"M0,8L8,0,16,8"}},getArrowAttributes:function(){return{fill:"#fff",stroke:"#ccc"}}}})(AJS.$);;
;
/* module-key = 'bamboo.web.resources.common:widget-dialog', location = '/widget/dialog/dialog.js' */
define('widget/dialog', [
    'jquery',
    'underscore',
    'brace',
    'util/events'
], function($, _, Brace, Events) {

    'use strict';

    var Dialog = Brace.View.extend({

        mixins: [
            Events.EventBusMixin
        ],

        /**
         * Combines default settings with provided options
         * and checks if trigger element was registered.
         */
        initialize: function(options) {
            this.settings = $.extend({
                templateContent: bamboo.widget.dialog.content,
                keypressListener: _.bind(this.onKeyPress, this),
                height: 400,
                width: 800,
                buttons: [{
                    id: 'cancel',
                    label: "Close",
                    type: 'link'
                }]
            }, options || {});

            if (this.settings.$triggerEl) {
                this.settings.$triggerEl.on('click', _.bind(function(event) {
                    event.preventDefault();
                    this.createInstance();
                }, this));
            } else {
                this.createInstance();
            }
        },

        /**
         * Create Dialog and proxy events
         * through application eventbus.
         */
        createInstance: function() {
            this.dialog = new AJS.Dialog(this.settings);
            this.proxyEvents('dialog',
                ['show.dialog', 'hide.dialog', 'remove.dialog'],
                AJS, 'bind'
            );

            this.onCreateInstance();

            // hack to remove existing css class from button (in case we are providing own)
            _.each(this.dialog.getPage(0).button, function(element) {
                if (element.item.attr('class') !== 'button-panel-button') {
                    element.item.removeClass('button-panel-button');
                }
            });

            this.dialog.show();
        },

        /**
         * Main callback which configures
         * dialog (buttons & content).
         */
        onCreateInstance: function() {
            this.$dialogContent = $(this.settings.templateContent({
                content: bamboo.widget.dialog.loading()
            }));

            this.dialog.addPanel('', this.$dialogContent);

            if (this.settings.header) {
                this.dialog.addHeader(this.settings.header);
            } else if (this.settings.$triggerEl) {
                this.dialog.addHeader(this.settings.$triggerEl.attr('title'));
            }

            // process button configuration
            if (this.settings.buttons) {
                _.each(this.settings.buttons, _.bind(function(button) {
                    var handler = this.dialog.addButton;
                    var buttonHandler = this.onButtonClick;

                    if (button.type === 'link') {
                        handler = this.dialog.addLink;
                    }

                    if (button.callback) {
                        buttonHandler = function() {
                            button.callback.apply(this, arguments);
                            this.onButtonClick.apply(this, arguments);
                        };
                    }

                    var buttonParams = (button.params) ? [button.id, button.params] : [button.id];

                    handler.apply(this.dialog, [
                        button.label, _.bind(function() {
                            _.bind(buttonHandler, this).apply(this, buttonParams);
                        }, this), button.cssClass
                    ]);
                }, this));
            }

            // clear existing content
            this.$dialogContent.empty();

            // html provided as a string
            if (_.isString(this.settings.content)) {
                this.$dialogContent.append(this.settings.content);
            } else if (_.isObject(this.settings.content)) {
                // jquery selector provided
                this.$dialogContent.append(this.settings.content.removeClass('hidden'));
            } else if (this.settings.$triggerEl) {
                // load content using ajax request
                $.ajax({
                    url: this.settings.$triggerEl.attr('href'),
                    data: {
                        'bamboo.successReturnMode': 'json',
                        decorator: 'nothing'
                    },
                    cache: false
                }).done(_.bind(this.onContentLoaded, this));
            }
        },

        /**
         * Default callback when
         * content is loaded through ajax.
         */
        onContentLoaded: function(response) {
            this.$dialogContent.html(response);
        },

        /**
         * Default button callback
         * which process cancel button.
         */
        onButtonClick: function(id) {
            if (id === 'cancel') {
                this.dialog.remove();
            }
        },

        /**
         * Default Dialog keypress callback which
         * closes current dialog when user press escape.
         */
        onKeyPress: function(event) {
            if (event.which === 27) {
                this.dialog.remove();
            }
        }

    });

    return Dialog;

});

/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('Bamboo.Widget.Dialog', null, require('widget/dialog'));
}
;
;
/* module-key = 'bamboo.web.resources.common:widget-dialog', location = '/widget/dialog/dialog.soy' */
// This file was automatically generated from dialog.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.dialog.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.dialog == 'undefined') { bamboo.widget.dialog = {}; }


bamboo.widget.dialog.loading = function(opt_data, opt_ignored) {
  return '<span class="icon icon-loading aui-dialog-content-loading"></span>';
};
if (goog.DEBUG) {
  bamboo.widget.dialog.loading.soyTemplateName = 'bamboo.widget.dialog.loading';
}


bamboo.widget.dialog.content = function(opt_data, opt_ignored) {
  return '<div>' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  bamboo.widget.dialog.content.soyTemplateName = 'bamboo.widget.dialog.content';
}
;
;
/* module-key = 'bamboo.web.resources.common:widget-dialog-error', location = '/widget/dialog-error/dialog-error.js' */
define('widget/dialog-error', [
    'jquery',
    'underscore',
    'widget/dialog',
    'exports'
], function(
    $,
    _,
    Dialog,
    exports
) {

    'use strict';

    /**
     * Dialog error view.
     */
    var DialogError = Dialog.extend({

        defaultSettings: {
            id: 'error-dialog',
            height: 270,
            width: 600,
            header: "An unexpected error has occurred",
            buttons: [
                {
                    id: 'reload',
                    label: "Reload page",
                    cssClass: 'aui-button aui-button-primary'
                },
                {
                    id: 'cancel',
                    label: "Cancel",
                    type: 'link'
                }
            ]
        },

        /**
         * Applies default dialog settings.
         */
        initialize: function(options) {
            var settings = options || {};

            if (!settings.content) {
                settings.content = "Please try reloading the page.";
            }

            Dialog.prototype.initialize.call(this,
                _.defaults(settings, this.defaultSettings)
            );
        },

        /**
         * Catch reload button clicked
         * and trigger current page reload.
         */
        onButtonClick: function(id) {
            Dialog.prototype.onButtonClick.apply(this, arguments);

            if (id === 'reload') {
                var panel = this.dialog.getPage(0).buttonpanel;

                panel.prepend(aui.icons.icon({
                    size: 'small',
                    icon: 'wait'
                }));

                panel.find(':button').attr('disabled', true);

                _.delay(function() {
                    window.location.reload();
                }, 500);
            }
        }

    });

    exports.Dialog = DialogError;
    exports.callback = function(content) {
        var currentDialog = AJS.popup.current;

        if (currentDialog) {
            currentDialog.hide();
            currentDialog.remove();
        }

        AJS.undim();

        return new DialogError({
            content: content
        });
    };

});
;
;
/* module-key = 'bamboo.web.resources.common:util-errors', location = '/util/errors/errors.soy' */
// This file was automatically generated from errors.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.util.errors.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.util == 'undefined') { bamboo.util = {}; }
if (typeof bamboo.util.errors == 'undefined') { bamboo.util.errors = {}; }


bamboo.util.errors.message = function(opt_data, opt_ignored) {
  return ((opt_data.content) ? aui.message.warning({closeable: 'true', content: '<p>' + soy.$$escapeHtml(opt_data.content) + '</p>'}) : '') + '<p>' + soy.$$escapeHtml("Please try reloading the page.") + '</p>';
};
if (goog.DEBUG) {
  bamboo.util.errors.message.soyTemplateName = 'bamboo.util.errors.message';
}
;
;
/* module-key = 'bamboo.web.resources.common:util-errors', location = '/util/errors/errors.js' */
define('util/errors', [
    'jquery',
    'widget/dialog-error'
], function(
    $,
    DialogError
) {

    'use strict';

    function userAborted(xhr) {
        return !xhr.getAllResponseHeaders();
    }

    var template = bamboo.util.errors;

    var handler = function(xhr) {
        if (!userAborted(xhr)) {
            var content = $.parseJSON(xhr.responseText || xhr.data);

            if (content) {
                if (content.message) {
                    content = content.message;
                } else if (content.errors) {
                    content = $.trim(content.errors.join(' '));
                }
            }

            DialogError.callback.call(
                null, template.message({
                    content: content || false
                })
            );
        }
    };

    return handler;

});

/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('Bamboo.Util.ErrorHandler', null, require('util/errors'));
}
;
;
/* module-key = 'bamboo.web.resources.common:util-ajax', location = '/util/ajax/ajax.js' */
define('util/ajax', [
    'jquery',
    'underscore',
    'backbone',
    'util/errors'
], function(
    $,
    _,
    Backbone,
    errors
) {

    'use strict';

    var defaultOptions = {
        contentType: 'application/json',
        dataType: 'json',
        async: true,
        cache: false
    };

    var ajax = function() {
        var params = arguments[0] || {};

        if (_.isString(params)) {
            params = {
                url: params
            };
        }

        if (!params.error) {
            params.error = errors;
        }

        return $.ajax(
            _.defaults(params, defaultOptions)
        );
    };

    return ajax;

});

/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('Bamboo.Util.Ajax', null, require('util/ajax'));
}
;
;
/* module-key = 'bamboo.web.resources.common:util-ajax-form', location = '/util/ajax-form/ajax-form.js' */
define('util/ajax-form', [
    'jquery',
    'underscore',
    'util/ajax',
    'util/errors'
], function(
    $,
    _,
    ajax,
    errors
) {

    'use strict';

    /**
     * Defaults for ajax settings.
     */
    var defaultOptions = {
        contentType: 'application/json',
        processData: false,
        dataType: 'json',
        type: 'POST',
        async: true
    };

    /**
     * Form fields which are ignored,
     * by default only CSRF tokens.
     */
    var defaultIgnoreFields = [
        'atl_token',
        'atl_token_source'
    ];

    /**
     * Wraps the passed in constructor so it
     * works with or without the new keyword.
     */
    function wrapperCtor(type) {
        var F = function() {};

        return function ctor() {
            var _this = this;

            if (!(this instanceof ctor)) {
                F.prototype = ctor.prototype;
                _this = new F();
            }

            type.apply(_this, arguments);
            return _this;
        };
    }

    /**
     * Injects AUI error messages
     * (form and field level).
     */
    function injectErrors($form, data) {
        var message = function(content) {
            return $('<div/>').addClass('error').text(content);
        };

        $form.find('.error').remove();

        // check for form errors
        if (data.errors.length) {
            $form.prepend(aui.message.error({
                content: data.errors.join('\n')
            }));
        }

        // append field errors
        _.each(_.keys(data.fieldErrors), function(name) {
            var $element = $form.find(
                ':input[name="' + name + '"]'
            );

            if ($element.length) {
                var messageBody = message(data.fieldErrors[name].join('\n'));
                var $description = $element.siblings('.description');

                // inject error after all help icons & buttons, just before description
                if ($description.length) {
                    $description.before(messageBody);
                } else {
                    $element.parent().append(messageBody);
                }
            }
        });
    }

    /**
     * Triggers success event
     * with returned JSON object.
    */
    function successHandler(data) {
        this.$el.trigger('success', data);
    }

    /**
     * Error default error handler, if there is
     * a user defined error listener then skip default behaviour.
     */
    function errorHandler(xhr) {
        var data = xhr.responseJSON;

        if (xhr.responseJSON === undefined) {
            data = $.parseJSON(xhr.responseText);
        }

        var wasHandled = this.$el.triggerHandler('error', [
            data, xhr.status
        ]);

        // error handling is not triggered if
        // handler is defined and returns true
        if (!wasHandled) {
            switch (xhr.status) {
                // form error
                case 400:
                    injectErrors(this.$el, data);
                    break;
                // unexpected error
                default:
                    errors.call(null, xhr);
            }
        }
    }

    /**
     * Main constructor, sets $el, defines defaults settings
     * and initialize request callbacks.
     */
    var AjaxForm = wrapperCtor(function(selector, options) {
        var $form = $(selector);

        if (!$form.is('form')) {
            $form = $form.find('form:first');
        }

        this.$el = $form;
        options = options || {};

        // try using form target
        if (options.url === undefined) {
            var target = $form.attr('target');

            if (target) {
                options.url = target;
            }
        }

        // try using form action
        if (options.type === undefined) {
            var action = $form.attr('action');

            if (action) {
                options.type = action;
            }
        }

        options = _.defaults(
            options, defaultOptions
        );

        // set ignore fields
        this.ignoreFields = _.unique(
            (options.ignoreFields || []).concat(defaultIgnoreFields)
        );

        // override serialize method
        if (options.serialize) {
            this.serialize = options.serialize;
        }

        this.settings = _.extend(options, {
            success: _.bind(successHandler, this),
            error: _.bind(errorHandler, this)
        });

        // exposing a helper method for injecting errors to a form
        this.injectErrors = _.bind(injectErrors, this, this.$el);
    });

    /**
     * Creates request proxy, bind form submission and
     * also prevents duplicate form submission.
     */
    AjaxForm.prototype.bind = function(settings) {
        this.settings = _.extend(
            this.settings, settings || {}
        );

        // unbind any previous binds
        this.$el.unbind('submit')
            .find(':input').unbind('keydown');

        this.request = _.bind(function(payload) {
            return ajax(_.extend(
                { data: JSON.stringify(payload) },
                this.settings
            ));
        }, this);

        // bind enter key to submit the form
        this.$el.find(':input').keydown(_.bind(function(event) {
            if (event.keyCode === 13) {
                this.$el.trigger('submit');
            }
        }, this));

        // defines a default submit callback
        this.$el.on('submit', _.bind(function(event) {
            var buttons = this.$el.find(
                'button[type=submit], input[type=submit]'
            );

            event.preventDefault();
            buttons.attr('disabled', true);

            var checkboxAsBoolean = !!(
                this.settings && this.settings.checkboxAsBoolean
            );

            this.request(this.serialize(checkboxAsBoolean))
                .always(function() {
                    buttons.attr('disabled', false);
                });
        }, this));

        return this;
    };

    /**
     * Serializes a form into an
     * (more useful) object.
     */
    AjaxForm.prototype.serialize = function(checkboxAsBoolean) {
        var data = {};

        _.each(this.$el.serializeArray(), _.bind(function(item) {
            var name = item.name;
            var value = item.value;

            // check ignore list
            if (_.indexOf(this.ignoreFields, name) > -1) {
                return;
            }

            if (data[name] === undefined) {
                data[name] = value;
            } else if (_.isArray(data[name])) {
                data[name] = data[name].concat(value);
            } else {
                data[name] = [data[name], value];
            }
        }, this));

        // serialize checkbox as boolean and ignore their provided value
        if (checkboxAsBoolean) {
            _.each(this.$el.find('input[type=checkbox]'), function(item) {
                var element = $(item);

                data[element.attr('name')] = !!(
                    element.is(':checked')
                );
            });
        }

        return this.$el.triggerHandler('serialize', [this, data]) || data;
    };

    /**
     * Proxy to register form events.
     */
    AjaxForm.prototype.on = function(event, callback) {
        this.$el.on(event, callback);

        return this;
    };

    return AjaxForm;

});
;
;
/* module-key = 'bamboo.web.resources.common:util-error-collection', location = '/util/error-collection/error-collection.js' */
define('util/error-collection', [
    'jquery',
    'underscore'
], function(
    $,
    _
) {
    'use strict';

    /**
     * Utility class for holding field errors and error messages.
     *
     * The format of this class corresponds to the typical format of response returned by Bamboo REST resources when
     * validation errors occur.
     *
     * Instances of this class can be used e.g. within AjaxForm to inject errors to a HTML form.
     */
    var ErrorCollection = function() {
        this.errors = [];
        this.fieldErrors = {};
    };

    ErrorCollection.prototype.hasErrors = function() {
        return !$.isEmptyObject(this.errors) || !$.isEmptyObject(this.fieldErrors);
    };

    ErrorCollection.prototype.addErrorMessage = function(message) {
        this.errors.push(message);
    };

    ErrorCollection.prototype.addFieldError = function(fieldName, message)
    {
        if (!this.fieldErrors[fieldName]) {
            this.fieldErrors[fieldName] = [];
        }
        this.fieldErrors[fieldName].push(message);
    };

    return ErrorCollection;
});
;
;
/* module-key = 'bamboo.web.resources.common:util-preferences', location = '/util/preferences/preferences.js' */
define('util/preferences', [
    'jquery',
    'underscore'
], function(
    $,
    _
) {

    'use strict';

    var PreferencesManager = {

        fetchValues: function() {
            var path = [
                AJS.contextPath(),
                'rest/pref/latest/user/?expand=preferences.preference'
            ].join('/');

            this.data = {};

            $.getJSON(path, _.bind(function(results) {
                if (results && results.preferences && results.preferences.preference) {
                    _.each(results.preferences.preference, _.bind(function(item) {
                        this.data[item.key] = item.value;
                    }, this));
                }
            }, this));
        },

        setValue: function(key, value) {
            if (_.isUndefined(value)) {
                value = true;
            }

            this.data[key] = JSON.stringify(value);

            var item = {};
            item[key] = this.data[key];

            $.post(
                AJS.contextPath() + '/rest/pref/latest/user',
                item
            );
        },

        getValue: function(key) {
            var value = this.data[key];

            return (_.isUndefined(value)) ?
                null : JSON.parse(value);
        },

        getBoolean: function(key) {
            var value = this.getValue(key);

            return value === 'false' ? false : !!value;
        }

    };

    PreferencesManager.fetchValues();

    return PreferencesManager;
});

/**
 * Export functionality onto Bamboo prototype.
 * To be removed in 6.0
 * @deprecated
 */
if (AJS.namespace) {
    AJS.namespace('Bamboo.PreferencesManager', null, require('util/preferences'));
}
;
;
/* module-key = 'bamboo.web.resources.common:util-options', location = '/util/options/options.js' */
define('util/options', [], function() {

    'use strict';

    /**
     * Global shared options should be put here,
     * for now it's a simple Object literal,
     * if required change Singleton/Mixin in the future.
     */
    return {
        animationSpeed: 200,
        spinner: {
            color: '#fff',
            length: 20,
            lines: 12,
            radius: 30,
            speed: 1.5,
            trail: 60,
            width: 10
        }
    };

});
;
;
/* module-key = 'bamboo.web.resources.common:util-uri', location = '/util/uri/uri-utils.js' */
define('util/uri-utils', [
    'exports'
], function(
    exports
) {

    'use strict';

    function queryToObject(str) {
        // TODO: Add support for parametrised arrays (param[]=1,2)
        return (str || document.location.search)
            .replace(/(^\?)/, '')
            .split('&')
            .reduce(function(result, entryString) {
                var entry = entryString.split('=');
                result[entry[0]] = decodeURIComponent(entry[1]);
                return result;
            }, {});
    }

    exports.queryToObject = queryToObject;

});
;
;
/* module-key = 'bamboo.web.resources.common:util-router', location = '/util/router/router.js' */
define('util/router', [
    'underscore',
    'backbone'
], function(
    _,
    Backbone
) {

    'use strict';

    _.extend(Backbone.History.prototype, {

        routeStripper: /^[#\/]|\s+$/g,
        trailingSlash: /\/$/,

        getFragment: function(fragment, forcePushState) {
            if (!fragment) {
                if (this._hasPushState || !this._wantsHashChange || forcePushState) {
                    fragment = this.location.pathname;

                    var root = this.root.replace(this.trailingSlash, '');
                    var search = this.location.search;

                    if (!fragment.indexOf(root)) {
                        fragment = fragment.substr(root.length);
                    }

                    if (search && this._hasPushState) {
                        fragment += search;
                    }
                } else {
                    fragment = this.getHash();
                }
            }

            return fragment.replace(this.routeStripper, '');
        }
    });

    var Router = Backbone.Router.extend({

        navigate: function(route, options) {
            var routeOption = {
                trigger: true
            };

            _.extend(routeOption, options);
            delete routeOption.params;

            Backbone.Router.prototype.navigate(
                route, routeOption
            );
        }

    });

    return Router;

});
;
;
/* module-key = 'bamboo.web.resources.common:util-dark-features', location = '/util/dark-features/dark-features.js' */
define('util/dark-features', [], function() {
    'use strict';

    var enabledFeatures = WRM.data.claim('bamboo.web.resources.common:util-dark-features.enabled-dark-features');

    return {
        isEnabled: function(darkFeature) {
            return enabledFeatures.indexOf(darkFeature) > -1;
        }
    };
});

/**
 * A wrapper for 'util/dark-features' module, required by some plugins.
 */
AJS.DarkFeatures = require('util/dark-features');
;
;
/* module-key = 'bamboo.web.resources.common:widget-dialog-form', location = '/widget/dialog-form/dialog-form.js' */
define('widget/dialog-form', [
    'jquery',
    'underscore',
    'widget/dialog',
    'util/ajax-form'
], function($, _, Dialog, AjaxForm) {

    'use strict';

    /**
     * Dialog form wrapper view.
     */
    var dialogForm = Dialog.extend({

        defaultSettings: {
            buttons: [{
                id: 'save',
                label: "Save",
                cssClass: 'aui-button aui-button-primary'
            }, {
                id: 'cancel',
                label: "Cancel",
                type: 'link'
            }]
        },

        formSettings: {
            checkboxAsBoolean: true
        },

        /**
         * Applies default dialog settings.
         */
        initialize: function(options) {
            options = options || {};

            if (options.form) {
                this.formSettings = _.defaults(
                    options.form, this.formSettings
                );
                delete options.form;
            }

            Dialog.prototype.initialize.call(this,
                _.defaults(options || {}, this.defaultSettings)
            );
        },

        /**
         * Override onCreateInstance, to execute
         * custom logic after dialog is created.
         */
        onCreateInstance: function() {
            Dialog.prototype.onCreateInstance.apply(this, arguments);

            this.form = new AjaxForm(this.dialog.getPage(0).body);

            // bind embedded form
            if (!this.formSettings.noBind) {
                this.form.bind(this.formSettings);
            }

            // events are bind at the end
            // (form.bind removes any previous defined)
            this.form
                .on('error', _.bind(this.onFormError, this))
                .on('submit', _.bind(this.onFormSubmit, this))
                .on('success', _.bind(this.onFormSuccess, this));
        },

        /**
         * Catch save button clicked
         * and trigger form submission.
         */
        onButtonClick: function(id) {
            Dialog.prototype.onButtonClick.apply(this, arguments);

            if (id === 'save') {
                this.form.$el.trigger('submit');
            }
        },

        /**
         * On success close current dialog.
         */
        onFormSuccess: function() {
            this.dialog.hide();
            this.dialog.remove();
        },

        /**
         * On submit show loading icon
         * and disable submit button.
         */
        onFormSubmit: function() {
            var panel = this.dialog.getPage(0).buttonpanel;

            panel.prepend(aui.icons.icon({
                size: 'small',
                icon: 'wait'
            }));

            panel.find(':button').attr('disabled', true);
        },

        /**
         * Removes loading icon
         * and enables submit button.
         */
        onFormError: function() {
            var panel = this.dialog.getPage(0).buttonpanel;

            panel.find('.aui-icon-wait').remove();
            panel.find(':button').removeAttr('disabled');
        }

    });

    return dialogForm;

});
;
;
/* module-key = 'bamboo.web.resources.common:widget-dialog-form', location = '/widget/dialog-form/dialog-form.soy' */
// This file was automatically generated from dialog-form.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.dialog.form.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.dialog == 'undefined') { bamboo.widget.dialog = {}; }
if (typeof bamboo.widget.dialog.form == 'undefined') { bamboo.widget.dialog.form = {}; }


bamboo.widget.dialog.form.content = function(opt_data, opt_ignored) {
  return '<div class="aui-dialog-content">' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  bamboo.widget.dialog.form.content.soyTemplateName = 'bamboo.widget.dialog.form.content';
}
;
;
/* module-key = 'bamboo.web.resources.common:widget-dialog-form-deletion', location = '/widget/dialog-form-deletion/dialog-form-deletion.soy' */
// This file was automatically generated from dialog-form-deletion.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.dialog.form.deletion.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.dialog == 'undefined') { bamboo.widget.dialog = {}; }
if (typeof bamboo.widget.dialog.form == 'undefined') { bamboo.widget.dialog.form = {}; }
if (typeof bamboo.widget.dialog.form.deletion == 'undefined') { bamboo.widget.dialog.form.deletion = {}; }


bamboo.widget.dialog.form.deletion.loading = function(opt_data, opt_ignored) {
  return '<form><div class="aui-message aui-message-generic">' + soy.$$escapeHtml("Checking artifact dependencies ...") + ' <span class="icon icon-loading aui-dialog-content-loading"></span></div></form>';
};
if (goog.DEBUG) {
  bamboo.widget.dialog.form.deletion.loading.soyTemplateName = 'bamboo.widget.dialog.form.deletion.loading';
}


bamboo.widget.dialog.form.deletion.invalidToken = function(opt_data, opt_ignored) {
  return '' + aui.message.warning({content: '<p>' + soy.$$escapeHtml("Artifact dependencies have changed, please try again.") + '</p>'});
};
if (goog.DEBUG) {
  bamboo.widget.dialog.form.deletion.invalidToken.soyTemplateName = 'bamboo.widget.dialog.form.deletion.invalidToken';
}
;
;
/* module-key = 'bamboo.web.resources.common:widget-dialog-form-deletion', location = '/widget/dialog-form-deletion/dialog-form-deletion.js' */
define('widget/dialog-form-deletion', [
    'jquery',
    'underscore',
    'widget/dialog-form',
    'util/ajax'
], function(
    $,
    _,
    DialogForm,
    ajax
) {

    'use strict';

    var deleteDialog = DialogForm.extend({

        /**
         * API url root prefix.
         */
        urlRoot: AJS.contextPath() + '/rest/api/latest/',

        defaultSettings: {
            buttons: [{
                id: 'confirm',
                label: "Confirm",
                cssClass: 'aui-button aui-button-primary'
            }, {
                id: 'cancel',
                label: "Cancel",
                type: 'link'
            }]
        },

        /**
         * Initialize form & dialog settings
         * and fetches delete warnings.
         */
        initialize: function(options) {
            var settings = options || {};

            /**
             * Local template used only for DeleteFormDialog.
             */
            this.templateDelete = bamboo.widget.dialog.form.deletion;

            settings.content = this.templateDelete.loading();
            settings.height = 320;
            settings.form = {
                type: 'DELETE',
                noBind: true
            };

            this.url = this.urlRoot + settings.resourceUrl;
            this.formTemplateData = options.templateData || {};
            this.formTemplate = options.template;

            DialogForm.prototype.initialize.call(this, settings);

            this.dialogPage = this.dialog.getPage(0);
            this.fetchWarnings();
        },

        /**
         * Process confirm button, if we are in
         * "refetch" mode then just refetch delete warnings.
         */
        onButtonClick: function(id) {
            DialogForm.prototype.onButtonClick.apply(this, arguments);

            if (id === 'confirm') {
                if (this.refetchToken) {
                    this.form.$el.html(this.templateDelete.loading());
                    this.fetchWarnings();
                } else if (!!this.warningData.confirmationToken) {
                    this.form.bind(_.defaults({
                        url: this.url + '?confirmationToken=' + this.warningData.confirmationToken
                    }, this.formSettings));

                    this.form.$el.trigger('submit');
                }
            }
        },

        /**
         * Process warning response, renders output
         * and check if resource is running.
         */
        onWarningLoaded: function(data) {
            var submitButton = this.dialogPage.button[0];

            // undo button changes (retry > confirm)
            if (this.refetchToken) {
                submitButton.item.text(submitButton.originalText);
                submitButton.originalText = null;
                this.refetchToken = false;
            }

            submitButton.item.show().focus();
            this.warningData = data;

            this.form.$el.html(this.formTemplate({
                isRunning: this.warningData.running,
                jobs: this.getConsumerJobs(this.warningData.artifactSubscriptions),
                data: this.formTemplateData
            }));

            if (!this.warningData.running) {
                this.dialogPage.button[0].item.removeAttr('disabled');
            } else {
                // resource is running,
                // hide all buttons and add close button
                _.each(this.dialogPage.button, function(button) {
                    button.item.hide();
                });

                this.dialog.addButton("Close", function(dialog) {
                    dialog.remove();
                });
            }
        },

        /**
         * If response code is 409 (conflict - resource has changed)
         * then switch back to re-fetch mode.
         */
        onFormError: function(event, data, statusCode) {
            DialogForm.prototype.onFormError.apply(this, arguments);

            if (statusCode === 409) {
                var submitButton = this.dialogPage.button[0];

                submitButton.originalText = submitButton.item.text();
                submitButton.item.text("Try again");

                this.form.$el.html(this.templateDelete.invalidToken());
                this.refetchToken = true;
            }
        },

        /**
         * Utility functionto re-fetch delete warnings.
         */
        fetchWarnings: function() {
            this.dialogPage.button[0].item.hide();

            ajax(this.url + '/deletionWarnings?expand=stage,plan,project')
                .done(_.bind(this.onWarningLoaded, this));
        },

        /**
         * Tracks jobs IDs and only return unique consumer jobs.
         */
        getConsumerJobs: function(artifactSubscriptions) {
            var consumerJobs = [];
            var consumerJobsIds = [];

            _.each(artifactSubscriptions, function(artifact) {
                _.each(artifact.consumerJobs, function(job) {
                    if (_.indexOf(consumerJobsIds, job.id) === -1) {
                        consumerJobs.push(job);
                    }
                });
            });

            return consumerJobs;
        }

    });

    return deleteDialog;

});
;
;
/* module-key = 'bamboo.web.resources.common:widget-quicksearch', location = '/widget/quicksearch/quicksearch-view-results.js' */
define('widget/quicksearch-view-results', [
    'jquery',
    'underscore',
    'widget/quicksearch-collection-results',
    'widget/quicksearch-view-results-item'
], function(
    $,
    _,
    QuickSearchResultsCollection,
    QuickSearchResultsItemView
) {

    'use strict';

    var QuickSearchResultsView = Backbone.View.extend({

        initialize: function() {
            this.template = bamboo.widget.quicksearch;

            this.initialElements();
            this.registerEvents();
        },

        initialElements: function() {
            this.$noMatches = $(this.template.nomatches());
            this.$items = this.$el;
        },

        registerEvents: function() {
            this.listenTo(this.collection, 'add', this.onChange);
            this.listenTo(this, 'select', this.onSelect);
            this.listenTo(this, 'move', this.onMove);
            this.listenTo(this, 'hide', this.onHide);
        },

        /**
         * We want to search for active row
         * and execute link (a href).
         */
        onSelect: function() {
            var $active = this.$items.find('li.active');

            if ($active.length) {
                this.$el.addClass('hidden');
                window.location.href = $active.find('a').attr('href');
            }
        },

        /**
         * Generates items output, also handles different types and
         * updates container in one go (single DOM operation).
         */
        onChange: function(model) {
            var results = model.get('searchResults');
            var container = document.createDocumentFragment();

            this.$items.find('li').remove();
            this.$el.toggleClass('hidden', false);

            var lastType = null;

            _.each(results, _.bind(function(item) {
                if (lastType !== item.type) {
                    item.newType = (lastType !== null);
                    lastType = item.type;
                }

                var view = new QuickSearchResultsItemView(item);
                container.appendChild(view.render().get(0));
            }, this));

            $(container.childNodes[0]).addClass('active');

            if (!results.length) {
                container.appendChild(this.$noMatches.get(0));
            }

            this.$items.append(container);
        },

        /**
         * Based on passed direction (up or down)
         * removes & adds active css class.
         */
        onMove: function(down) {
            var noResults = this.$items.find('li.no-results').length;
            var $element;

            if (!noResults) {
                if (down) {
                    $element = this.$items.find('li.active')
                        .removeClass('active').next();

                    if (!$element.length) {
                        $element = this.$items.find('li:first');
                    }
                } else {
                    $element = this.$items.find('li.active')
                        .removeClass('active').prev();

                    if (!$element.length) {
                        $element = this.$items.find('li:last');
                    }
                }

                if ($element && $element.length) {
                    $element.addClass('active');
                }
            }
        },

        /**
         * Hides results panel (current view)
         * and removes active element.
         */
        onHide: function() {
            this.$el.addClass('hidden');
            this.$items.find('li.active').removeClass('active');
        }

    });

    return QuickSearchResultsView;

    // }(_, AJS, Backbone));
});
;
;
/* module-key = 'bamboo.web.resources.common:widget-quicksearch', location = '/widget/quicksearch/quicksearch-view-results-item.js' */
define('widget/quicksearch-view-results-item', [
    'backbone'
], function(
    Backbone
) {

    'use strict';

    var QuickSearchResultsItemView = Backbone.View.extend({

        initialize: function(options) {
            this.options = options;
            this.template = bamboo.widget.quicksearch;
        },

        render: function() {
            var params = {
                content: this.template[this.options.type.toLowerCase()]({
                    id: this.options.id,
                    entity: this.options.entity
                })
            };

            if (this.options.newType) {
                params.cssClass = 'new-type';
            }

            this.setElement(this.template.row(params));

            return this.$el;
        }

    });

    return QuickSearchResultsItemView;
});
;
;
/* module-key = 'bamboo.web.resources.common:widget-quicksearch', location = '/widget/quicksearch/quicksearch.soy' */
// This file was automatically generated from quicksearch.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.quicksearch.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.quicksearch == 'undefined') { bamboo.widget.quicksearch = {}; }


bamboo.widget.quicksearch.row = function(opt_data, opt_ignored) {
  return '<li ' + ((opt_data.cssClass) ? 'class="' + soy.$$escapeHtml(opt_data.cssClass) + '"' : '') + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</li>';
};
if (goog.DEBUG) {
  bamboo.widget.quicksearch.row.soyTemplateName = 'bamboo.widget.quicksearch.row';
}


bamboo.widget.quicksearch.nomatches = function(opt_data, opt_ignored) {
  return '' + bamboo.widget.quicksearch.row({content: '' + soy.$$escapeHtml("No matches found"), cssClass: 'no-results'});
};
if (goog.DEBUG) {
  bamboo.widget.quicksearch.nomatches.soyTemplateName = 'bamboo.widget.quicksearch.nomatches';
}


bamboo.widget.quicksearch.chain = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.entity.key) + '" tabindex="-1" class="entity chain">' + widget.icons.fontIcon({type: 'build'}) + '<span class="title"><span class="single plan-name">' + soy.$$escapeHtml(opt_data.entity.planName) + '</span></span><span class="subtitle project-name">' + soy.$$escapeHtml(opt_data.entity.projectName) + '</span></a>';
};
if (goog.DEBUG) {
  bamboo.widget.quicksearch.chain.soyTemplateName = 'bamboo.widget.quicksearch.chain';
}


bamboo.widget.quicksearch.branch = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.entity.key) + '" tabindex="-1" class="entity branch">' + widget.icons.fontIcon({type: 'devtools-branch'}) + '<span class="title"><span class="plan-name">' + soy.$$escapeHtml(opt_data.entity.planName) + '</span><span class="branch"><span class="divider"></span>' + soy.$$escapeHtml(opt_data.entity.branchName) + '</span></span><span class="subtitle project-name">' + soy.$$escapeHtml(opt_data.entity.projectName) + '</span></a>';
};
if (goog.DEBUG) {
  bamboo.widget.quicksearch.branch.soyTemplateName = 'bamboo.widget.quicksearch.branch';
}


bamboo.widget.quicksearch.deploymentproject = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml("") + '/deploy/viewDeploymentProjectEnvironments.action?id=' + soy.$$escapeHtml(opt_data.id) + '" tabindex="-1" class="entity deployment-project">' + widget.icons.fontIcon({type: 'deploy'}) + '<span class="title"><span class="single deployment-project-name">' + soy.$$escapeHtml(opt_data.entity.projectName) + '</span></span></a>';
};
if (goog.DEBUG) {
  bamboo.widget.quicksearch.deploymentproject.soyTemplateName = 'bamboo.widget.quicksearch.deploymentproject';
}
;
;
/* module-key = 'bamboo.web.resources.common:widget-quicksearch', location = '/widget/quicksearch/quicksearch-view-input.js' */
define('widget/quicksearch-view-input', [
    'jquery',
    'underscore',
    'backbone'
], function(
    $,
    _,
    Backbone
) {

    'use strict';

    var QuickSearchInputView = Backbone.View.extend({

        /**
         * Mapping for different
         * key presses to custom events.
         */
        keys: {
            13: function() { return ['select']; },      // enter
            27: function() { return ['hide', true]; },  // escape
            38: function() { return ['move', false]; }, // arrow-up
            40: function() { return ['move', true]; }   // arrow-down
        },

        /**
         * 'blur' is used to deactivate quicksearch control,
         * 'keypup' is throttled to 250ms which fetches new results
         *  and 'keydown' checks mapping definition.
         */
        initialize: function() {
            this.$el.on('keydown', _.bind(this.onKeyPress, this));

            this.$el.on('keyup', _.debounce(
                _.bind(this.onKeyUp, this), 250
            ));

            // clicking anywhere outside parent element
            // (#quicksearch) will trigger hide event
            var container = this.$el.parent();

            $(document.body).on('click', _.bind(function(event) {
                if (!$(event.target).closest(container).length) {
                    this.trigger.call(this, 'hide');
                }
            }, this));
        },

        /**
         * If mapping is found we stop event propagation
         * and execute custom handler.
         */
        onKeyPress: function(event) {
            var mapping = this.keys[event.keyCode];

            if (mapping) {
                this.trigger.apply(this, mapping());

                event.stopPropagation();
                event.preventDefault();
            }
        },

        /**
         * If input is currently empty (text was removed),
         * we hide results panel.
         */
        onKeyUp: function(event) {
            var mapping = this.keys[event.keyCode];

            if (!mapping) {
                var term = $.trim(this.$el.val());

                (term.length) ? this.trigger('change', term) :
                    this.trigger('hide');
            }
        }

    });

    return QuickSearchInputView;
});
;
;
/* module-key = 'bamboo.web.resources.common:widget-quicksearch', location = '/widget/quicksearch/quicksearch.js' */
define('widget/quicksearch', [
    'jquery',
    'underscore',
    'backbone',
    'widget/quicksearch-collection-results',
    'widget/quicksearch-view-input',
    'widget/quicksearch-view-results'
], function(
    $,
    _,
    Backbone,
    QuickSearchResultsCollection,
    QuickSearchInputView,
    QuickSearchResultsView
) {

    'use strict';

    var QuickSearch = Backbone.View.extend({

        initialize: function() {
            this.collection = new QuickSearchResultsCollection();

            this.includeView();
            this.registerEvents();
        },

        /**
         * Initialize needed subviews and
         * binds '/' shortcut to focus input field.
         */
        includeView: function() {
            this.input = new QuickSearchInputView({
                el: this.$el.find('.term')
            });

            this.results = new QuickSearchResultsView({
                el: this.$el.find('.results'),
                collection: this.collection
            });

            AJS.whenIType('/').execute(_.bind(this.onHide, this));
        },

        registerEvents: function() {
            this.listenTo(this.input, 'select', this.onSelect);
            this.listenTo(this.input, 'change', this.onChange);
            this.listenTo(this.input, 'move', this.onMove);
            this.listenTo(this.input, 'hide', this.onHide);
        },

        onSelect: function() {
            this.results.trigger('select');
        },

        /**
         * We always check if there is any
         * previous request in progress and abort it.
         */
        onChange: function(term) {
            if (this.requestInProgress) {
                if (this.requestInProgress.readyState > 0 && this.requestInProgress.readyState < 4) {
                    this.requestInProgress.abort();
                }
            }

            this.requestInProgress = this.collection.fetch({
                data: $.param({ searchTerm: term })
            });
        },

        onMove: function(direction) {
            this.results.trigger('move', direction);
            this.results.$el.focus();
        },

        onHide: function(focus) {
            this.results.trigger('hide');

            if (focus) {
                this.input.$el.focus();
            }
        }

    });

    return QuickSearch;
});
;
;
/* module-key = 'bamboo.web.resources.common:widget-quicksearch', location = '/widget/quicksearch/quicksearch-collection-results.js' */
define('widget/quicksearch-collection-results', [
    'backbone'
], function(
    Backbone
) {

    'use strict';

    var QuickSearchResultsCollection = Backbone.Collection.extend({

        url: AJS.contextPath() + '/rest/api/latest/quicksearch'

    });

    return QuickSearchResultsCollection;
});
;
;
/* module-key = 'bamboo.web.resources.common:widget-bulk-selection-links', location = '/widget/bulk-selection-links/bulk-selection-links.soy' */
// This file was automatically generated from bulk-selection-links.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.bulk.selection.links.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.bulk == 'undefined') { bamboo.widget.bulk = {}; }
if (typeof bamboo.widget.bulk.selection == 'undefined') { bamboo.widget.bulk.selection = {}; }
if (typeof bamboo.widget.bulk.selection.links == 'undefined') { bamboo.widget.bulk.selection.links = {}; }


bamboo.widget.bulk.selection.links.displayLinks = function(opt_data, opt_ignored) {
  return '<span class="bulk-select-links">' + soy.$$escapeHtml("Select") + ': <span tabindex="0" role="link" class="bulk-select-link bulk-select-link-all">' + soy.$$escapeHtml("All") + '</span>, <span tabindex="0" role="link" class="bulk-select-link bulk-select-link-none">' + soy.$$escapeHtml("None") + '</span></span>';
};
if (goog.DEBUG) {
  bamboo.widget.bulk.selection.links.displayLinks.soyTemplateName = 'bamboo.widget.bulk.selection.links.displayLinks';
}
;
;
/* module-key = 'bamboo.web.resources.common:widget-bulk-selection-links', location = '/widget/bulk-selection-links/bulk-selection-links.js' */
define('widget/bulk-selection-links', [
    'jquery',
    'underscore'
], function(
    $,
    _
) {

    'use strict';

    /**
     * Displays links that allow bulk selection and un-selection of checkboxes.
     *
     * Links are appended to $el and allow selection of all and none checkboxes that have a specific CSS class.
     * All checkboxes must exist within one form.
     *
     * Configuration options:
     * - checkboxClass - CSS class that a checkbox must have in order to be updated by select all/none links
     */
    var BulkSelectionLinks = Backbone.View.extend({

        defaults: {
            checkboxClass: null
        },

        events: {
            'click .bulk-select-link-all': 'selectAll',
            'click .bulk-select-link-none': 'selectNone'
        },

        template: bamboo.widget.bulk.selection.links.displayLinks,

        initialize: function(options) {
            this.options = _.defaults(options, this.defaults);
            this.$form = this.$el.closest('form');
            this.selector = _.template('input:checkbox.<%= checkboxClass %>')(this.options);
            this.render();
        },

        render: function() {
            this.$el.empty().append(this.template());
        },

        selectAll: function() {
            this.$form.find(this.selector).attr('checked', 'checked');
        },

        selectNone: function() {
            this.$form.find(this.selector).removeAttr('checked');
        }
    });

    return BulkSelectionLinks;
});
;
;
/* module-key = 'bamboo.web.resources.common:widget-async-link', location = '/widget/async-link/async-link.js' */
define('widget/async-link', [
    'underscore',
    'backbone',
    'util/ajax'
], function(
    _,
    Backbone,
    ajax
) {

    'use strict';

    /**
     * Causes a link on page to trigger an AJAX request instead of executing it's standard behavior.
     *
     * If the request is successful, the browser will be redirected to the provided return URL. If the request fails,
     * standard AJAX error handling will occur.
     *
     * If the confirmation message is provided, user will be prompted to confirm the action before it is executed.
     */
    return Backbone.View.extend({

        defaults: {
            el: null,
            url: null,

            type: 'POST',
            confirmationMessage: '',
            returnUrl: ''
        },

        events: {
            click: 'onClick'
        },

        initialize: function(options) {
            this.settings = _.defaults(options || {}, this.defaults);
        },

        onClick: function(e) {
            e.preventDefault();

            if (!this.settings.confirmationMessage || confirm(this.settings.confirmationMessage)) {
                ajax({
                    url: this.settings.url,
                    type: this.settings.type
                }).then(function() {
                    if (this.settings.returnUrl) {
                        window.location.href = this.settings.returnUrl;
                    }
                }.bind(this));
            }
        }

    });
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-build-autocomplete', location = '/feature/build-autocomplete/build-autocomplete.soy' */
// This file was automatically generated from build-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.build.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.build == 'undefined') { bamboo.feature.build = {}; }
if (typeof bamboo.feature.build.autocomplete == 'undefined') { bamboo.feature.build.autocomplete = {}; }


bamboo.feature.build.autocomplete.result = function(opt_data, opt_ignored) {
  return ' ' + widget.buildresult.resultStatus(opt_data) + ' <span class="info">' + soy.$$escapeHtml(opt_data.resultSummary.buildRelativeTime) + '</span>';
};
if (goog.DEBUG) {
  bamboo.feature.build.autocomplete.result.soyTemplateName = 'bamboo.feature.build.autocomplete.result';
}


bamboo.feature.build.autocomplete.selection = function(opt_data, opt_ignored) {
  return widget.buildresult.resultStatus(opt_data) + ' ' + soy.$$escapeHtml(opt_data.resultSummary.buildRelativeTime);
};
if (goog.DEBUG) {
  bamboo.feature.build.autocomplete.selection.soyTemplateName = 'bamboo.feature.build.autocomplete.selection';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-build-autocomplete', location = '/feature/build-autocomplete/build-autocomplete.js' */
define('feature/build-autocomplete', [
    'jquery',
    'underscore',
    'widget/autocomplete-ajax',
    'util/events',
    'util/ajax'
], function(
    $,
    _,
    AutocompleteAjax,
    events,
    ajax
) {

    'use strict';

    var BuildAutocomplete = AutocompleteAjax.extend({

        mixins: [events.EventBusMixin],

        initialize: function(options) {
            options = $.extend({
                // disable/hide search input
                minimumResultsForSearch: -1
            }, options || {});

            this.params = options.params || {};

            if (options.params) {
                delete options.params;
            }

            var dataCallback = _.bind(function(term, page) {
                return $.extend({
                    searchTerm: term,
                    'start-index': Math.max(
                        (page - 1) * this.params['max-results'], 0
                    )
                }, this.params);
            }, this);

            var settings = {
                minimumInputLength: 0,
                ajax: {
                    url: AJS.contextPath() + '/rest/api/latest/deploy/preview/possibleResults',
                    dataType: 'json',
                    data: dataCallback,
                    results: _.bind(function(data, page) {
                        return this.processData({
                            results: data,
                            more: data ? data.length >= this.params['max-results'] : false
                        });
                    }, this)
                },
                id: function(object) {
                    return object.planResultKey.key;
                }
            };

            AutocompleteAjax.prototype.initialize.apply(
                this, [$.extend(settings, options || {})]
            );
        },

        onRegisterEvents: function() {
            this.proxyEvents(
                'build', ['change'], this.$el
            );

            var events = ['branch:change'];

            if (!this.$el.val()) {
                events.push('branch:change:initial');
            }

            this.onEvent(events, this.onMasterChange);
            this.onEvent('build:hide', this.onHide);
            this.onEvent('build:show', this.onShow);
        },

        onInitSelection: function(element, callback) {
            $(document).ready(_.bind(function() {
                var key = $(element).val();

                if (_.isString(key) && key.length) {
                    this.$el.auiSelect2('data', this.settings.initialValue);
                    this.processData({ results: [this.settings.initialValue] });

                    this.params.planKey = this.settings.initialValue
                        .planResultKey.entityKey.key;

                    this.triggerEvent('build:change:initial');
                    callback(this.settings.initialValue);
                }
            }, this));
        },

        onLoadAndProcess: function(element, callback) {
            var settings = _.defaults({
                data: this.settings.ajax.data('', 1)
            }, this.settings.ajax);

            ajax(settings)
                .done(_.bind(function(data) {
                    if (_.isEmpty(data)) {
                        this.$el.val(null);
                        this.$el.auiSelect2('data', null);
                        this.params.planKey = null;
                    } else {
                        var selected = data[0];

                        this.$el.val(this.settings.id(selected));
                        this.$el.auiSelect2('data', selected);

                        this.processData({
                            results: data,
                            more: data ? data.length >= this.params['max-results'] : false
                        });

                        this.params.planKey = selected
                            .planResultKey.entityKey.key;

                        if (callback) {
                            callback(selected);
                        }
                    }

                    this.triggerEvent('build:change');
                    this.triggerEvent('deploy:release:warning');
                }, this));
        },

        onFormatResult: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.feature.build.autocomplete.result({
                    resultSummary: item
                });
            }
        },

        onFormatSelection: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.feature.build.autocomplete.selection({
                    resultSummary: item
                });
            }
        },

        onMasterChange: function(instance) {
            if (
                !this.settings.masterPickerId ||
                instance.$el.attr('id') !== this.settings.masterPickerId
            ) {
                return;
            }

            this.clearValue();
            var value = instance.getSelectedData();

            if (value) {
                this.params.planKey = value.searchEntity.key;
                this.onLoadAndProcess();
                this.enable();
            } else {
                this.disable();
            }
        },

        onHide: function(instance, container) {
            if (!container || container.find(this.$el).length) {
                this.$el.parents('.field-group:first').hide();
            }
        },

        onShow: function(instance, container) {
            if (!container || container.find(this.$el).length) {
                this.$el.parents('.field-group:first').show();
            }
        }

    });

    return BuildAutocomplete;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-branch-label', location = '/feature/branch-label/branch-label.js' */
define('feature/branch-label', [
    'jquery',
    'backbone',
    'brace',
    'util/events'
], function(
    $,
    Backbone,
    Brace,
    events
) {

    'use strict';

    var BranchLabel = Brace.View.extend({

        mixins: [events.EventBusMixin],

        initialize: function() {
            this.onEvent('plan:selected', this.onPlanChange);
        },

        onPlanChange: function(instance, model) {
            if (model instanceof Backbone.Model) {
                this.$el.html(bamboo.widget.deployment.version.branch({
                    planBranchName: model.get('branchName'),
                    label: "Currently"
                }));
            }
        }

    });

    return BranchLabel;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-branch-autocomplete', location = '/feature/branch-autocomplete/branch-autocomplete.js' */
define('feature/branch-autocomplete', [
    'jquery',
    'underscore',
    'backbone',
    'widget/autocomplete-ajax',
    'util/ajax',
    'util/events'
], function(
    $,
    _,
    Backbone,
    AutocompleteAjax,
    ajax,
    events
) {

    'use strict';

    var BranchAutocomplete = AutocompleteAjax.extend({

        mixins: [events.EventBusMixin],

        initialize: function(options) {
            options = $.extend({
                placeholder: "Search for a branch ..."
            }, options || {});

            this.params = $.extend({
                includeMasterBranch: false
            }, options.params || {});

            if (options.params) {
                delete options.params;
            }

            var dataCallback = _.bind(function(term, page) {
                return $.extend({
                    searchTerm: term,
                    'start-index': Math.max(
                        (page - 1) * this.params['max-results'], 0
                    )
                }, this.params);
            }, this);

            var settings = {
                minimumInputLength: 0,
                ajax: {
                    url: AJS.contextPath() + '/rest/api/latest/search/branches',
                    dataType: 'json',
                    data: dataCallback,
                    results: _.bind(function(data, page) {
                        return this.processData({
                            results: data.searchResults,
                            more: data.size ? data.size > (page * this.params['max-results']) : false
                        });
                    }, this)
                }
            };

            AutocompleteAjax.prototype.initialize.apply(
                this, [$.extend(settings, options || {})]
            );
        },

        onRegisterEvents: function() {
            this.onEvent('plan:selected', this.onMasterChange);
            this.proxyEvents('branch', ['change'], this.$el);
        },

        onInitSelection: function(element, callback) {
            $(document).ready(_.bind(function() {
                var key = $(element).val();

                if (_.isString(key) && key.length) {
                    ajax({
                        url: this.settings.ajax.url,
                        dataType: this.settings.ajax.dataType,
                        data: {
                            includeMasterBranch: true,
                            masterPlanKey: key,
                            'start-index': 0,
                            'max-results': 1
                        }
                    })
                    .done(_.bind(function(data) {
                        var selected = data.searchResults[0];

                        this.$el.auiSelect2('data', selected);
                        this.processData({ results: data.searchResults });

                        this.triggerEvent('branch:change:initial');
                        callback(selected);
                    }, this));
                }
            }, this));
        },

        onFormatResult: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.feature.branch.autocomplete.result({
                    label: item.searchEntity.branchName
                });
            }
        },

        onFormatSelection: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.feature.branch.autocomplete.result({
                    label: item.searchEntity.branchName
                });
            }
        },

        onMasterChange: function(instance, model) {
            if (
                this.settings.masterPickerId &&
                instance.$el.attr('id') !== this.settings.masterPickerId
            ) {
                return;
            }

            this.clearValue();

            if (!(model instanceof Backbone.Model)) {
                this.triggerEvent('branch:empty');
            } else {
                var value = $.trim(model.get('key'));

                if (value.length) {
                    this.params.masterPlanKey = value;
                }
            }
        }

    });

    return BranchAutocomplete;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-branch-autocomplete', location = '/feature/branch-autocomplete/branch-autocomplete.soy' */
// This file was automatically generated from branch-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.branch.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.branch == 'undefined') { bamboo.feature.branch = {}; }
if (typeof bamboo.feature.branch.autocomplete == 'undefined') { bamboo.feature.branch.autocomplete = {}; }


bamboo.feature.branch.autocomplete.result = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-devtools-branch"></span>  ' + soy.$$escapeHtml(opt_data.label);
};
if (goog.DEBUG) {
  bamboo.feature.branch.autocomplete.result.soyTemplateName = 'bamboo.feature.branch.autocomplete.result';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-stage-autocomplete', location = '/feature/stage-autocomplete/stage-autocomplete.js' */
define('feature/stage-autocomplete', [
    'jquery',
    'underscore',
    'backbone',
    'widget/autocomplete-ajax',
    'util/ajax',
    'util/events'
], function(
    $,
    _,
    Backbone,
    AutocompleteAjax,
    ajax,
    events
) {

    'use strict';

    var StageAutocomplete = AutocompleteAjax.extend({

        mixins: [events.EventBusMixin],

        initialize: function(options) {
            options = $.extend({
                placeholder: "deployment.project.plan.stage.placeholder"
            }, options || {});

            options = options || {};

            this.params = options.params || {};

            if (options.params) {
                delete options.params;
            }

            var dataCallback = _.bind(function(term, page) {
                return $.extend({
                    searchTerm: term,
                    'start-index': Math.max(
                        (page - 1) * this.params['max-results'], 0
                    )
                }, this.params);
            }, this);

            var settings = {
                minimumInputLength: 0,
                ajax: {
                    url: AJS.contextPath() + '/rest/api/latest/search/stages/' + this.params.masterPlanKey,
                    dataType: 'json',
                    data: dataCallback,
                    results: _.bind(this.onAjaxResult, this)
                }
            };

            AutocompleteAjax.prototype.initialize.apply(
                this, [$.extend(settings, options || {})]
            );
        },

        onAjaxResult: function(data, page) {
            return this.processData({
                results: data.searchResults,
                more: data.size ? data.size > (page * this.params['max-results']) : false
            });
        },

        onRegisterEvents: function() {
            this.proxyEvents('stage', ['change'], this.$el);
        },

        onInitSelection: function(element, callback) {
            $(document).ready(_.bind(function() {
                var key = $(element).val();
                if (_.isString(key) && key.length) {
                    ajax({
                        url: this.settings.ajax.url,
                        dataType: this.settings.ajax.dataType,
                        data: {
                            stageId: key,
                            'start-index': 0,
                            'max-results': 1
                        }
                    })
                    .done(_.bind(function(data) {
                        var selected = data.searchResults[0];

                        this.$el.auiSelect2('data', selected);
                        this.processData({ results: data.searchResults });

                        this.triggerEvent('stage:change:initial');
                        callback(selected);
                    }, this));
                }
            }, this));
        },

        onFormatResult: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.feature.stage.autocomplete.result({
                    label: item.searchEntity.name
                });
            }
        },

        onFormatSelection: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.feature.stage.autocomplete.result({
                    label: item.searchEntity.name
                });
            }
        }

    });

    return StageAutocomplete;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-stage-autocomplete', location = '/feature/stage-autocomplete/stage-autocomplete.soy' */
// This file was automatically generated from stage-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.stage.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.stage == 'undefined') { bamboo.feature.stage = {}; }
if (typeof bamboo.feature.stage.autocomplete == 'undefined') { bamboo.feature.stage.autocomplete = {}; }


bamboo.feature.stage.autocomplete.result = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml(opt_data.label);
};
if (goog.DEBUG) {
  bamboo.feature.stage.autocomplete.result.soyTemplateName = 'bamboo.feature.stage.autocomplete.result';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-deployment-tasksdialog', location = '/feature/deployment-tasksdialog/deployment-tasksdialog.js' */
define('feature/deployment-tasksdialog', [
    'jquery',
    'widget/dialog'
], function(
    $,
    Dialog
) {

    'use strict';

    var TasksDialog = Dialog.extend({
        initialize: function(options) {
            var buttonArray = [];
            if (options.editTasksRedirect) {
                buttonArray.push({
                    id: 'editTasks',
                    label: "Edit tasks",
                    type: 'button'
                });
            }
            buttonArray.push({
                id: 'cancel',
                label: "Close",
                type: 'button'
            });
            var settings = $.extend({
                buttons: buttonArray,
                header: "Deployment tasks to run",
                $triggerEl: $('#view-tasks'),
                width: 500,
                height: 300
            }, options || {});

            this.constructor.__super__.initialize.apply(this, [settings]);
        },

        onButtonClick: function(id) {
            if (id === 'editTasks') {
                window.location = this.settings.editTasksRedirect;
            } else if (id === 'cancel') {
                this.dialog.remove();
            }
        }
    });

    return TasksDialog;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-job-autocomplete', location = '/feature/job-autocomplete/job-autocomplete.soy' */
// This file was automatically generated from job-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.job.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.job == 'undefined') { bamboo.feature.job = {}; }
if (typeof bamboo.feature.job.autocomplete == 'undefined') { bamboo.feature.job.autocomplete = {}; }


bamboo.feature.job.autocomplete.result = function(opt_data, opt_ignored) {
  return '' + ((opt_data.item.searchEntity.groupName) ? soy.$$escapeHtml(opt_data.item.searchEntity.groupName) : soy.$$escapeHtml(opt_data.item.searchEntity.jobName));
};
if (goog.DEBUG) {
  bamboo.feature.job.autocomplete.result.soyTemplateName = 'bamboo.feature.job.autocomplete.result';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-job-autocomplete', location = '/feature/job-autocomplete/job-autocomplete.js' */
define('feature/job-autocomplete', [
    'jquery',
    'underscore',
    'widget/autocomplete-ajax',
    'util/events'
], function(
    $,
    _,
    AutocompleteAjax,
    events
) {

    'use strict';

    var JobAutocomplete = AutocompleteAjax.extend({

        template: bamboo.feature.job.autocomplete,

        mixins: [
            events.EventBusMixin
        ],

        initialize: function(options) {
            options = options || {};

            this.params = options.params || {};
            this.lastGroup = null;

            if (options.params) {
                delete options.params;
            }

            var dataCallback = _.bind(function(term, page) {
                return _.extend({
                    searchTerm: term,
                    'start-index': Math.max(
                        (page - 1) * this.params['max-results'], 0
                    )
                }, this.params);
            }, this);

            var settings = {
                minimumInputLength: 0,
                ajax: {
                    url: _.bind(this.onAjaxUrl, this),
                    results: _.bind(this.onAjaxResults, this),
                    data: dataCallback,
                    dataType: 'json'
                }
            };

            AutocompleteAjax.prototype.initialize.apply(
                this, [$.extend(settings, options || {})]
            );
        },

        /**
         * Only return a URL if plan is provided.
         */
        onAjaxUrl: function() {
            if (this.query && this.query.plan) {
                return AJS.contextPath() + '/rest/api/latest/search/jobs/' + this.query.plan;
            }

            this.disable().clearValue();
        },

        /**
         * Unset lastGroup if we're on first page,
         * then process groups.
         */
        onAjaxResults: function(data, page) {
            var results = [];

            if (page === 1) {
                this.lastGroup = null;
            }

            _.each(data.searchResults, _.bind(function(item) {
                if (this.lastGroup !== item.searchEntity.stageName) {
                    this.lastGroup = item.searchEntity.stageName;

                    var group = {
                        isGroup: true,
                        searchEntity: {
                            groupName: this.lastGroup
                        }
                    };

                    results.push(group);
                }

                results.push(item);
            }, this));

            return this.processData({
                results: results,
                more: data.size ? data.size > (page * this.params['max-results']) : false
            });
        },

        onFormatResult: function(item) {
            if (!_.isEmpty(item)) {
                return this.template.result({ item: item });
            }
        },

        onFormatSelection: function(item) {
            if (!_.isEmpty(item)) {
                return this.template.result({ item: item });
            }
        }

    });

    return JobAutocomplete;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-plan-autocomplete', location = '/feature/plan-autocomplete/plan-autocomplete.soy' */
// This file was automatically generated from plan-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.plan.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.plan == 'undefined') { bamboo.feature.plan = {}; }
if (typeof bamboo.feature.plan.autocomplete == 'undefined') { bamboo.feature.plan.autocomplete = {}; }


bamboo.feature.plan.autocomplete.result = function(opt_data, opt_ignored) {
  return '' + ((opt_data.item.searchEntity.groupName) ? soy.$$escapeHtml(opt_data.item.searchEntity.groupName) : soy.$$escapeHtml(opt_data.item.searchEntity.planName));
};
if (goog.DEBUG) {
  bamboo.feature.plan.autocomplete.result.soyTemplateName = 'bamboo.feature.plan.autocomplete.result';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-plan-autocomplete', location = '/feature/plan-autocomplete/plan-autocomplete.js' */
define('feature/plan-autocomplete', [
    'jquery',
    'underscore',
    'widget/autocomplete-ajax',
    'util/events'
], function(
    $,
    _,
    AutocompleteAjax,
    events
) {

    'use strict';

    var PlanAutocomplete = AutocompleteAjax.extend({

        template: bamboo.feature.plan.autocomplete,

        mixins: [
            events.EventBusMixin
        ],

        initialize: function(options) {
            options = options || {};

            this.params = options.params || {};
            this.lastGroup = null;

            if (options.params) {
                delete options.params;
            }

            var dataCallback = _.bind(function(term, page) {
                return _.extend({
                    searchTerm: term,
                    'start-index': Math.max(
                        (page - 1) * this.params['max-results'], 0
                    )
                }, this.params);
            }, this);

            var settings = {
                minimumInputLength: 0,
                ajax: {
                    url: AJS.contextPath() + '/rest/api/latest/search/plans',
                    results: _.bind(this.onAjaxResults, this),
                    data: dataCallback,
                    dataType: 'json'
                }
            };

            AutocompleteAjax.prototype.initialize.apply(
                this, [$.extend(settings, options || {})]
            );
        },

        /**
         * Unset lastGroup if we're on first page,
         * then process groups.
         */
        onAjaxResults: function(data, page) {
            var results = [];

            if (page === 1) {
                this.lastGroup = null;
            }

            _.each(data.searchResults, _.bind(function(item) {
                if (this.lastGroup !== item.searchEntity.projectName) {
                    this.lastGroup = item.searchEntity.projectName;

                    var group = {
                        isGroup: true,
                        searchEntity: {
                            groupName: this.lastGroup
                        }
                    };

                    results.push(group);
                }

                results.push(item);
            }, this));

            return this.processData({
                results: results,
                more: data.size ? data.size > (page * this.params['max-results']) : false
            });
        },

        onFormatResult: function(item) {
            if (!_.isEmpty(item)) {
                return this.template.result({ item: item });
            }
        },

        onFormatSelection: function(item) {
            if (!_.isEmpty(item)) {
                return this.template.result({ item: item });
            }
        }

    });

    return PlanAutocomplete;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-dialog-storage-soft-limit-warning', location = '/feature/dialog-storage-soft-limit-warning/dialog-storage-soft-limit-warning.soy' */
// This file was automatically generated from dialog-storage-soft-limit-warning.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.dialog.storage.soft.limit.warning.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.dialog == 'undefined') { bamboo.feature.dialog = {}; }
if (typeof bamboo.feature.dialog.storage == 'undefined') { bamboo.feature.dialog.storage = {}; }
if (typeof bamboo.feature.dialog.storage.soft == 'undefined') { bamboo.feature.dialog.storage.soft = {}; }
if (typeof bamboo.feature.dialog.storage.soft.limit == 'undefined') { bamboo.feature.dialog.storage.soft.limit = {}; }
if (typeof bamboo.feature.dialog.storage.soft.limit.warning == 'undefined') { bamboo.feature.dialog.storage.soft.limit.warning = {}; }


bamboo.feature.dialog.storage.soft.limit.warning.content = function(opt_data, opt_ignored) {
  var output = '';
  var storagePolicyUrl__soy3 = "https://confluence.atlassian.com/display/Cloud/Atlassian+Cloud+Storage+Policy";
  output += aui.message.warning({content: '' + soy.$$escapeHtml("Careful, you\x27re about to run out of storage.")}) + '<p>' + soy.$$escapeHtml("Need more than the storage provided on your Atlassian Cloud account? You can use your AWS account for storing artifacts on your own Amazon S3 instance.") + '</p><p>' + soy.$$filterNoAutoescape(AJS.format("Read more about the \x3ca href\x3d\x22{0}\x22\x3eAtlassian Cloud storage policy\x3c/a\x3e.",storagePolicyUrl__soy3)) + '</p>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.dialog.storage.soft.limit.warning.content.soyTemplateName = 'bamboo.feature.dialog.storage.soft.limit.warning.content';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-dialog-storage-soft-limit-warning', location = '/feature/dialog-storage-soft-limit-warning/dialog-storage-soft-limit-warning.js' */
define('feature/dialog-storage-soft-limit-warning', [
    'jquery',
    'underscore',
    'widget/dialog'
], function(
    $,
    _,
    Dialog
) {
    'use strict';

    var DEFAULT_INTERVAL = 1;

    /**
     * A warning dialog to be displayed when the disk space taken by artifacts exceeded the allowed soft limit.
     * The dialog will only be displayed once per specified time interval for the user.
     *
     * Configuration options:
     * - username (required) - name of the currently logged in user
     * - interval            - interval in days that has to pass between displaying the warning again to the same user;
     *                         default interval is 1 day
     */
    var DialogStorageSoftLimitWarning = Dialog.extend({

        defaultSettings: {
            height: 300,
            width: 600,
            header: "Storage almost full",
            buttons: [
                {
                    id: 'configure',
                    label: "Configure artifact storage",
                    cssClass: 'aui-button aui-button-primary'
                }, {
                    id: 'cancel',
                    label: "Remind me later",
                    type: 'link'
                }
            ]
        },

        initialize: function(options) {
            var settings = options || {};

            this.interval = settings.interval || DEFAULT_INTERVAL;
            this.currentTimestamp = new Date().getTime();
            this.cookieName = 'storage.soft.limit.warning.' + settings.username;

            var intervalMillis = +(this.interval * 24 * 60 * 60 * 1000);
            var lastWarningTimestamp = AJS.Cookie.read(this.cookieName);

            this.isTimeToDisplay =
                (!lastWarningTimestamp || (lastWarningTimestamp < this.currentTimestamp - intervalMillis));

            this.defaultSettings.content = bamboo.feature.dialog.storage.soft.limit.warning.content({});
            Dialog.prototype.initialize.call(this,
                _.defaults(settings, this.defaultSettings)
            );
        },

        createInstance: function() {
            if (this.isTimeToDisplay) {
                AJS.Cookie.save(this.cookieName, this.currentTimestamp, this.interval);
                Dialog.prototype.createInstance.call(this);
            }
        },

        onButtonClick: function(id) {
            Dialog.prototype.onButtonClick.apply(this, arguments);

            if (id === 'configure') {
                var panel = this.dialog.getPage(0).buttonpanel;

                panel.prepend(aui.icons.icon({
                    size: 'small',
                    icon: 'wait'
                }));

                panel.find(':button').attr('disabled', true);

                _.delay(_.bind(function() {
                    window.location.href = AJS.contextPath() + '/admin/configureArtifactStorage.action';
                }, this), 500);
            }
        }
    });

    return DialogStorageSoftLimitWarning;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-dialog-storage-hard-limit-warning', location = '/feature/dialog-storage-hard-limit-warning/dialog-storage-hard-limit-warning.soy' */
// This file was automatically generated from dialog-storage-hard-limit-warning.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.dialog.storage.hard.limit.warning.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.dialog == 'undefined') { bamboo.feature.dialog = {}; }
if (typeof bamboo.feature.dialog.storage == 'undefined') { bamboo.feature.dialog.storage = {}; }
if (typeof bamboo.feature.dialog.storage.hard == 'undefined') { bamboo.feature.dialog.storage.hard = {}; }
if (typeof bamboo.feature.dialog.storage.hard.limit == 'undefined') { bamboo.feature.dialog.storage.hard.limit = {}; }
if (typeof bamboo.feature.dialog.storage.hard.limit.warning == 'undefined') { bamboo.feature.dialog.storage.hard.limit.warning = {}; }


bamboo.feature.dialog.storage.hard.limit.warning.content = function(opt_data, opt_ignored) {
  var output = '';
  var storagePolicyUrl__soy3 = "https://confluence.atlassian.com/display/Cloud/Atlassian+Cloud+Storage+Policy";
  var header__soy4 = '' + soy.$$filterNoAutoescape("You\x27ve exceeded the Atlassian Cloud storage limit. Unfortunately your builds have been disabled until you configure S3 storage for artifacts.");
  output += aui.message.warning({content: '' + soy.$$escapeHtml(header__soy4)}) + '<p>' + soy.$$escapeHtml("You can configure Bamboo\x27s artifact storage to use your own Amazon S3 account for increased storage capacity. Doing so will immediately re-enable builds.") + '</p><p>' + soy.$$filterNoAutoescape(AJS.format("Read more about the \x3ca href\x3d\x22{0}\x22\x3eAtlassian Cloud storage policy\x3c/a\x3e.",storagePolicyUrl__soy3)) + '</p>';
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.dialog.storage.hard.limit.warning.content.soyTemplateName = 'bamboo.feature.dialog.storage.hard.limit.warning.content';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-dialog-storage-hard-limit-warning', location = '/feature/dialog-storage-hard-limit-warning/dialog-storage-hard-limit-warning.js' */
define('feature/dialog-storage-hard-limit-warning', [
    'jquery',
    'underscore',
    'widget/dialog'
], function(
    $,
    _,
    Dialog
) {
    'use strict';

    var COOKIE_NAME = 'storage.hard.limit.warning.displayed';

    /**
     * A warning dialog to be displayed when the disk space taken by artifacts exceeded the allowed hard limit.
     * The dialog will be displayed once per user login.
     *
     * Configuration options:
     * - userLoggedIn (required) - true, if a user is currently logged in
     */
    var DialogStorageHardLimitWarning = Dialog.extend({

        defaultSettings: {
            height: 320,
            width: 600,
            header: "Storage full and builds disabled",
            buttons: [
                {
                    id: 'configure',
                    label: "Configure artifact storage",
                    cssClass: 'aui-button aui-button-primary'
                }, {
                    id: 'cancel',
                    label: "Remind me later",
                    type: 'link'
                }
            ]
        },

        initialize: function(options) {
            var settings = options || {};

            var warningDisplayed = AJS.Cookie.read(COOKIE_NAME);
            var shouldClearCookie = !settings.userLoggedIn && warningDisplayed;
            this.shouldDisplay = settings.userLoggedIn && !warningDisplayed;

            if (this.shouldDisplay) {
                AJS.Cookie.save(COOKIE_NAME, true);
            } else if (shouldClearCookie) {
                AJS.Cookie.erase(COOKIE_NAME);
            }

            this.defaultSettings.content = bamboo.feature.dialog.storage.hard.limit.warning.content({});
            Dialog.prototype.initialize.call(this,
                _.defaults(settings, this.defaultSettings)
            );
        },

        createInstance: function() {
            if (this.shouldDisplay) {
                Dialog.prototype.createInstance.call(this);
            }
        },

        onButtonClick: function(id) {
            Dialog.prototype.onButtonClick.apply(this, arguments);

            if (id === 'configure') {
                var panel = this.dialog.getPage(0).buttonpanel;

                panel.prepend(aui.icons.icon({
                    size: 'small',
                    icon: 'wait'
                }));

                panel.find(':button').attr('disabled', true);

                _.delay(_.bind(function() {
                    window.location.href = AJS.contextPath() + '/admin/configureArtifactStorage.action';
                }, this), 500);
            }
        }
    });

    return DialogStorageHardLimitWarning;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-quick-filters', location = '/feature/quick-filters/quick-filters.soy' */
// This file was automatically generated from quick-filters.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.quick.filters.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.quick == 'undefined') { bamboo.feature.quick = {}; }
if (typeof bamboo.feature.quick.filters == 'undefined') { bamboo.feature.quick.filters = {}; }


bamboo.feature.quick.filters.dashboardFilter = function(opt_data, opt_ignored) {
  return '<button data-filter-id="' + soy.$$escapeHtml(opt_data.filterId) + '" class="aui-button quick-filter ' + ((opt_data.active) ? 'active' : '') + '">' + soy.$$escapeHtml(opt_data.name) + '</button>';
};
if (goog.DEBUG) {
  bamboo.feature.quick.filters.dashboardFilter.soyTemplateName = 'bamboo.feature.quick.filters.dashboardFilter';
}


bamboo.feature.quick.filters.notFoundError = function(opt_data, opt_ignored) {
  return '' + bamboo.util.errors.message({content: AJS.format("Quick filter \x27\x27{0}\x27\x27 not found. It might have been removed.",opt_data.name)});
};
if (goog.DEBUG) {
  bamboo.feature.quick.filters.notFoundError.soyTemplateName = 'bamboo.feature.quick.filters.notFoundError';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-quick-filters', location = '/feature/quick-filters/quick-filters.js' */
define('feature/quick-filters', [
    'jquery',
    'underscore',
    'util/ajax',
    'util/errors',
    'widget/dialog-error'
], function(
    $,
    _,
    ajax,
    errors,
    DialogError
) {

    'use strict';

    var filtersUrl = AJS.contextPath() + '/rest/api/latest/quickFilter';
    var activateUrl = _.template(filtersUrl + '/<%= filterId %>/activate');
    var deactivateUrl = _.template(filtersUrl + '/<%= filterId %>/deactivate');
    var deactivateAllUrl = filtersUrl + '/deactivate';
    var toggleUrl = AJS.contextPath() + '/ajax/toggleQuickFilter.action';

    /**
     * Quick filters feature for Bamboo Dashboard.
     *
     * Required parameters:
     * - el             - jQuery selector for the container for quick filters
     * - iconContainer  - jQuery selector for an element that will hold status icon (e.g. wait icon)
     * - dashboard      - jQuery selector for the Bamboo Dashboard
     * - personalFilter - a hash containing two jQuery selectors: for personal filter toggle button ('toggle') and for
     *                    personal filter edit button ('edit')
     */
    var QuickFilters = Backbone.View.extend({

        initialize: function(options) {
            var settings = options || {};

            this.dashboard = settings.dashboard;
            this.$iconContainer = $(settings.iconContainer);
            this.$projectFilterToggle = $(settings.projectFilter.toggle);
            this.$projectFilterEdit = $(settings.projectFilter.edit);
            this.template = bamboo.feature.quick.filters;

            var anyQuickFiltersActive = this.$el.find('.quick-filter.active').length > 0;
            if (anyQuickFiltersActive) {
                this.deactivateProjectFilter();
                this.refreshDashboard();
            }

            this.registerEvents();
        },

        registerEvents: function() {
            this.$el.on('click', '.quick-filter', this.onQuickFilterToggled.bind(this));
            this.$projectFilterToggle.on('click', this.onProjectFilterToggled.bind(this, 'toggle'));
            this.$projectFilterEdit.on('click', this.onProjectFilterToggled.bind(this, 'edit'));
            // we attach event listener on document level because the triggering elements will be
            // detached and attached dynamically as page refreshes asynchronously
            $(document).on('click', '.quick-filters-disable-all', this.onDisableAllQuickFiltersClicked.bind(this));
        },

        onQuickFilterToggled: function(event) {
            event.preventDefault();

            this.cancelRequest(this.toggleRequest);
            this.cancelRequest(this.dashboardRequest);
            this.displayLoadingIcon();

            // deactivate standard project filter when any quick filter is clicked
            this.deactivateProjectFilter();

            var $filter = $(event.target);
            var filterId = $filter.attr('data-filter-id');
            var deactivating = $filter.hasClass('active');
            var url = deactivating ? deactivateUrl : activateUrl;
            var totalActive = this.$el.find('.quick-filter.active').length;

            this.triggerAnalyticsEventOnToggle(!deactivating, deactivating ? totalActive - 1 : totalActive + 1);
            $filter.toggleClass('active');
            this.toggleRequest = ajax({
                type: 'PUT',
                url: url({ filterId: filterId }),
                error: _.bind(this.onQuickFilterToggledError, this, $filter)
            });

            this.refreshDashboard();
        },

        onQuickFilterToggledError: function($filter, xhr) {
            this.hideLoadingIcon();

            if (xhr.status === 404) {
                var filterName = $filter.text();
                new DialogError.Dialog({
                    content: this.template.notFoundError({ name: filterName })
                });
            } else {
                errors.call(null, xhr);
            }
        },

        onProjectFilterToggled: function(buttonPressed) {
            this.cancelRequest(this.toggleRequest);
            this.cancelRequest(this.dashboardRequest);
            this.hideLoadingIcon();

            // deactivate all quick filters when standard project filters is clicked
            this.triggerAnalyticsEventOnDisableAll('PERSONAL_FILTER_ENABLED');
            this.disableAllQuickFilters();
            if (buttonPressed === 'edit' || this.$projectFilterToggle.hasClass('edit-project-filter')) {
                // since we'll enter filter edit mode we should refresh plans
                // (as user can cancel edit mode, but we have already deactivated all quick filters)
                this.refreshDashboard();
            }
        },

        onDisableAllQuickFiltersClicked: function(event) {
            event.preventDefault();

            this.cancelRequest(this.toggleRequest);
            this.cancelRequest(this.dashboardRequest);
            this.displayLoadingIcon();

            this.triggerAnalyticsEventOnDisableAll('DISABLE_ALL_BUTTON_CLICKED');
            this.disableAllQuickFilters();
            this.refreshDashboard();
        },

        disableAllQuickFilters: function() {
            this.$el.find('.quick-filter.active').removeClass('active');
            return ajax({
                type: 'PUT',
                url: deactivateAllUrl
            });
        },

        deactivateProjectFilter: function() {
            if (this.$projectFilterToggle.attr('aria-pressed') === 'true') {
                this.$projectFilterToggle.attr('aria-pressed', 'false');
                this.$projectFilterToggle.html(
                    widget.icons.icon({ type: 'filter' }) + '&nbsp;' + "Personal filter is off"
                );
                ajax({
                    type: 'POST',
                    url: AJS.contextPath() + '/toggleDashboardFilterInline.action',
                    dataType: 'html',
                    contentType: 'application/x-www-form-urlencoded',
                    data: { filterEnabled: false }
                });
            }
        },

        refreshDashboard: function() {
            this.cancelRequest(this.dashboardRequest);
            this.displayLoadingIcon();

            var $activeFilters = this.$el.find('.quick-filter.active');
            var filterIds = $activeFilters.toArray()
                .map(function(element) {
                    return $(element).attr('data-filter-id');
                });

            this.dashboardRequest = ajax({
                type: 'POST',
                url: toggleUrl,
                dataType: 'html',
                contentType: 'application/x-www-form-urlencoded',
                data: { filterIds: filterIds }
            });

            return this.dashboardRequest.then(
                function(response) {
                    $(this.dashboard).replaceWith(response);
                }.bind(this)
            ).always(
                this.hideLoadingIcon.bind(this)
            );
        },

        cancelRequest: function(request) {
            if (request && request.readyState !== 4) {
                request.abort();
            }
        },

        displayLoadingIcon: function() {
            var $icon = this.$iconContainer.find('.aui-icon-wait');
            if (!$icon.length) {
                this.$iconContainer.append(aui.icons.icon({
                    size: 'small',
                    icon: 'wait'
                }));
            }
        },

        hideLoadingIcon: function() {
            var $icon = this.$iconContainer.find('.aui-icon-wait');
            if ($icon.length) {
                $icon.remove();
            }
        },

        triggerAnalyticsEventOnToggle: function(enabling, totalActive) {
            AJS.trigger('analyticsEvent', {
                name: 'bamboo.quick.filter.toggled',
                data: {
                    enabling: enabling,
                    totalActive: totalActive
                }
            });
        },

        triggerAnalyticsEventOnDisableAll: function(reason) {
            AJS.trigger('analyticsEvent', {
                name: 'bamboo.quick.filters.all.disabled',
                data: {
                    reason: reason
                }
            });
        }
    });

    return QuickFilters;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-repository-connect', location = '/feature/repository-connect/repository-connect.soy' */
// This file was automatically generated from repository-connect.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.repository.connect.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.repository == 'undefined') { bamboo.feature.repository = {}; }
if (typeof bamboo.feature.repository.connect == 'undefined') { bamboo.feature.repository.connect = {}; }


bamboo.feature.repository.connect.result = function(opt_data, opt_ignored) {
  return '<div class="connection-result ' + soy.$$escapeHtml(opt_data.resultClass) + '"><div class="connection-result-icon"><span class="aui-icon aui-icon-small ' + soy.$$escapeHtml(opt_data.iconClass) + '"></span></div><div class="connection-result-message">' + soy.$$filterNoAutoescape(opt_data.content) + '</div></div>';
};
if (goog.DEBUG) {
  bamboo.feature.repository.connect.result.soyTemplateName = 'bamboo.feature.repository.connect.result';
}


bamboo.feature.repository.connect.success = function(opt_data, opt_ignored) {
  return '' + bamboo.feature.repository.connect.result({resultClass: 'connection-result-success', iconClass: 'aui-icon-success', content: '<p>' + soy.$$escapeHtml("Connection successful") + '</p>'});
};
if (goog.DEBUG) {
  bamboo.feature.repository.connect.success.soyTemplateName = 'bamboo.feature.repository.connect.success';
}


bamboo.feature.repository.connect.errors = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var param22 = '<p>' + soy.$$escapeHtml("We couldn\x27t connect to the repository.") + ' ' + ((opt_data.message) ? soy.$$escapeHtml(opt_data.message) : (opt_data.messages && opt_data.messages.length) ? soy.$$escapeHtml("Here\x27s what we got back:") : '') + '</p>';
  if (opt_data.messages && opt_data.messages.length) {
    param22 += '<div class="connection-result-error-message command-output">';
    var messageList35 = opt_data.messages;
    var messageListLen35 = messageList35.length;
    for (var messageIndex35 = 0; messageIndex35 < messageListLen35; messageIndex35++) {
      var messageData35 = messageList35[messageIndex35];
      param22 += '<pre>' + soy.$$changeNewlineToBr(soy.$$escapeHtml(messageData35)) + '</pre>';
    }
    param22 += '</div>';
  }
  var output = '' + bamboo.feature.repository.connect.result({resultClass: 'connection-result-error', iconClass: 'aui-icon-warning', content: param22});
  return output;
};
if (goog.DEBUG) {
  bamboo.feature.repository.connect.errors.soyTemplateName = 'bamboo.feature.repository.connect.errors';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-repository-connect', location = '/feature/repository-connect/repository-connect.js' */
define('feature/repository-connect', [
    'jquery',
    'underscore',
    'util/ajax',
    'util/ajax-form',
    'util/errors'
], function(
    $,
    _,
    ajax,
    AjaxForm,
    errors
) {

    'use strict';

    var RepositoryConnect = Backbone.View.extend({

        defaults: {
            timeout: 60 // test connection timeout in seconds
        },

        initialize: function(options) {
            this.options = _.defaults(options, this.defaults);

            this.templateNamespace = bamboo.feature.repository.connect;
            this.url = AJS.contextPath() + '/rest/api/latest/repository/testConnection';

            this.$button = this.$el;
            this.$container = this.$button.parent();
            this.$form = this.$button.closest('form');
            this.ajaxForm = new AjaxForm(this.$form);

            this.registerEvents();
        },

        registerEvents: function() {
            this.$button.on('click', _.bind(this.testConnection, this));
        },

        triggerAnalyticsEvent: function(repositoryKey) {
            AJS.trigger('analyticsEvent', {
                name: 'bamboo.repository.connection.test',
                data: {
                    repositoryKey: repositoryKey
                }
            });
        },

        testConnection: function(e) {
            e.preventDefault();

            this.$form.find('.error, .connection-result').remove();
            this.$button.attr('disabled', true);
            this.$button.siblings().remove();
            this.$container.append(aui.icons.icon({ size: 'small', icon: 'wait' }));

            var formData = this.ajaxForm.serialize();
            this.triggerAnalyticsEvent(formData.selectedRepository);

            ajax({
                url: this.url,
                type: 'PUT',
                data: JSON.stringify(formData),
                success: _.bind(this.handleSuccess, this),
                error: _.bind(this.handleError, this),
                timeout: this.options.timeout * 1000 // convert to milliseconds
            });
        },

        // executed when form validation was successful
        handleSuccess: function(xhr) {
            this.$button.attr('disabled', false);
            this.$button.siblings().remove();

            var connectionErrors = xhr.connectionErrors;
            if (connectionErrors && connectionErrors.length) {
                this.displayErrors(connectionErrors);
            } else {
                this.displaySuccess();
            }
        },

        // executed when there were form validation errors
        handleError: function(xhr, status) {
            this.$button.attr('disabled', false);
            this.$button.siblings().remove();

            if (status === 'timeout') {
                this.displayError(AJS.format("Timed out after {0} seconds.", this.options.timeout));
            } else {
                switch (xhr.status) {
                    case 400:
                        this.ajaxForm.settings.error(xhr); // inject errors on page
                        this.displayError("The details you provided were invalid.");
                        break;
                    case 401:
                        var responseMsg = xhr.responseJSON ? xhr.responseJSON.message : null;
                        var genericUnauthorizedMsg = "The request was unauthorised. Please reload the page and try again.";
                        this.displayError(responseMsg || genericUnauthorizedMsg);
                        break;
                    default:
                        errors.call(null, xhr);
                }
            }
        },

        displaySuccess: function() {
            var result = this.templateNamespace.success();
            this.$container.append(result);
        },

        displayError: function(message) {
            var result = this.templateNamespace.errors({ message: message });
            this.$container.append(result);
        },

        displayErrors: function(messages) {
            var result = this.templateNamespace.errors({ messages: messages });
            this.$container.append(result);
        }
    });

    return RepositoryConnect;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-repository-overrides', location = '/feature/repository-overrides/repository-overrides.js' */
define('feature/repository-overrides', [
    'backbone',
    'jquery',
    'marionette',
    'util/events'
], function(
    Backbone,
    $,
    Marionette,
    events)
{
    'use strict';

    /**
     * View for toggling repository configuration overrides, e.g. for plan branches. Toggles configuration between
     * keeping inherited data from root repository or enabling overridden config.
     *
     * Params:
     * - el - container of all UI elements
     * - selectors:
     *     - overrideToggle - toggle button
     *     - overrideRepositoryLocation - hidden input element to store information whether the root repository
     *       configuration is overridden or inherited
     *     - serverConfiguration - container for overridden server configuration
     *     - inheritedConfiguration - container for inherited server configuration
     */
    return Marionette.ItemView.extend({
        template: false,

        ui: function() {
            var selectors = this.getOption('selectors');
            return {
                overrideToggle: selectors.overrideToggle,
                overrideRepositoryLocation: selectors.overrideRepositoryLocation,
                serverConfiguration: selectors.serverConfiguration,
                inheritedConfiguration: selectors.inheritedConfiguration
            };
        },

        events: {
            'click @ui.overrideToggle': 'onOverrideToggleClick'
        },

        onRender: function() {
            this.ui.inheritedConfiguration.find(':input').prop('disabled', true);
            var overrideInitiallyEnabled = this.ui.overrideRepositoryLocation.val() === 'true';
            if (overrideInitiallyEnabled) {
                this.ui.overrideToggle.addClass('on');
            }
            this.showHideControls(overrideInitiallyEnabled);
        },

        onOverrideToggleClick: function() {
            this.ui.overrideToggle.toggleClass('on');
            var overrideEnabled = this.ui.overrideToggle.hasClass('on');
            this.ui.overrideRepositoryLocation.val(overrideEnabled);
            this.showHideControls(overrideEnabled);
            if (!overrideEnabled) {
                events.EventBus.trigger('repository:server:reset');
            }
            events.EventBus.trigger('repository:server:toggle-override');
        },

        showHideControls: function(overrideEnabled) {
            this.ui.serverConfiguration.toggle(overrideEnabled);
            this.ui.inheritedConfiguration.toggle(!overrideEnabled);
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/entity/trusted-keys-collection.js' */
define('feature/trusted-keys/entity/trusted-keys-collection', [
    'backbone',
    'feature/trusted-keys/entity/trusted-keys-model'
], function(Backbone,
            TrustedKeyModel) {
    'use strict';

    var TrustedKeysCollection = Backbone.Collection.extend({

        model: TrustedKeyModel,

        url: AJS.contextPath() + '/rest/admin/latest/security/trustedKey',

        comparator: 'id'
    });

    return TrustedKeysCollection;
});
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/trusted-keys-add-view.js' */
define('feature/trusted-keys/trusted-keys-add-view', [
    'jquery',
    'marionette',
    'feature/trusted-keys/entity/trusted-keys-model',
    'aui/flag'
], function(
    $,
    Marionette,
    TrustedKeysModel,
    Flag
) {

    'use strict';

    var getErrorMessages = function(response) {
        var errorMessages = [];
        if (response && response.responseJSON && response.responseJSON.errors) {
            errorMessages = response.responseJSON.errors;
        }
        return errorMessages;
    };

    /**
     * Form for TrustedKeyModel
     *
     * Configuration options:
     * - collection (required) - TrustedKeysCollection
     */
    return Marionette.ItemView.extend({
        settings: null,
        template: bamboo.feature.trustedKeys.createTrustedKeyForm,
        ui: {
            key: '#key',
            host: '#host',
            errors: '.control-form-error'
        },

        initialize: function(options) {
            this.settings = options || {};
        },

        /**
         * Save new trusted key to server side. If validation is successful it calls options.success
         * @param options - {success: function}
         */
        save: function(options) {
            this.hideErrors();
            var data = new TrustedKeysModel();
            data.set('key', this.ui.key.val());
            data.set('host', this.ui.host.val());
            var errors = data.validate(data.attributes);
            if (errors) { //show validation messages
                errors.forEach(function(error) {
                    var $validationMessage = $('[data-field-name="' + error.name + '"]');
                    $validationMessage.html = error.message;
                    $validationMessage.show();
                });
                if (options.error) {
                    options.error();
                }

            } else { //save item to server
                var collection = this.settings.collection;
                collection.create(data, {
                    wait: true,
                    success: function() {
                        if (options.success) {
                            options.success();
                        }
                        new Flag({
                            type: 'success',
                            close: 'auto',
                            body: "Trusted key has been added"
                        });
                    }, error: function(collection, response) {
                        if (response.status === 409) {
                            // treat it as success - we didn't add new key,
                            // but the key we wanted to have is already there
                            if (options.success) {
                                options.success();
                            }
                            new Flag({
                                type: 'success',
                                close: 'auto',
                                body: "A trusted key with given host and SSH key already exists."
                            });
                        } else {
                            if (options.error) {
                                options.error();
                            }
                            var responseErrors = getErrorMessages(response);
                            var errorMessage = responseErrors.length ?
                                               responseErrors.join(' ') :
                                               "View the server logs for the details.";
                            new Flag({
                                type: 'error',
                                close: 'manual',
                                body: "The trusted key can\u0027t be added." + ' ' + errorMessage
                            });
                        }
                    }
                });
            }
        },

        hideErrors: function() {
            this.ui.errors.hide();
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/trusted-keys-add-dialog.js' */
define('feature/trusted-keys/trusted-keys-add-dialog', [
    'underscore',
    'marionette',
    'widget/dialog',
    'feature/trusted-keys/trusted-keys-add-view'
], function(_,
            Marionette,
            Dialog,
            TrustedKeysAddView) {
    'use strict';
    /**
     * Dialog to add Trusted key
     *
     * Configuration options:
     * - collection (required) - TrustedKeysCollection
     */
    return Dialog.extend({
        defaultSettings: {
            height: 350,
            width: 800,
            id: 'dialog-add-trusted-key',
            header: "Add trusted key",
            collection: null,
            buttons: [{
                id: 'dialog-save-trusted-key',
                label: "Add",
                cssClass: 'aui-button aui-button-primary'
            }, {
                id: 'cancel',
                label: "Close",
                type: 'link'
            }]
        },
        /**
         * Initialize dialog settings.
         */
        initialize: function(options) {
            var settings = options || {};
            settings.content = bamboo.feature.trustedKeys.addDialog();
            AJS.bind('show.dialog', _.bind(this.onDialogShow, this));
            AJS.bind('remove.dialog', _.bind(this.onDialogHide, this));

            Dialog.prototype.initialize.call(this,
                _.defaults(settings, this.defaultSettings)
            );
        },

        onDialogShow: function(evt, obj) {
            if (!obj.dialog || obj.dialog !== this.dialog) {
                return;
            }

            this.region = new Marionette.Region({el: '.dialog-add-trusted-key__content'});
            this.region.show(new TrustedKeysAddView({collection: this.collection}));
            this.dialog.updateHeight();
        },

        onDialogHide: function() {
            if (this.region) {
                this.region.empty();
            }
        },

        /**
         * Process confirm button
         */
        onButtonClick: function(id) {
            Dialog.prototype.onButtonClick.apply(this, arguments);

            if (id === 'dialog-save-trusted-key') {
                var trustedKeysAddView = this.region.currentView;
                //delegate saving to view
                trustedKeysAddView.save({
                    success: _.bind(function() {
                        this.dialog.remove();
                    }, this),
                    error: _.bind(function() {
                        //update height to avoid scrolls when validation error is shown
                        this.dialog.updateHeight();
                    }, this)
                });
            }
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/trusted-keys-inline-add.js' */
define('feature/trusted-keys/trusted-keys-inline-add', [
    'underscore',
    'marionette',
    'feature/trusted-keys/entity/trusted-keys-collection',
    'jquery',
    'aui/flag'
], function(
    _,
    Marionette,
    TrustedKeysCollection,
    $,
    Flag
) {

    'use strict';

    var getErrorMessages = function(response) {
        var errorMessages = [];
        if (response && response.responseJSON && response.responseJSON.errors) {
            errorMessages = response.responseJSON.errors;
        }
        return errorMessages;
    };

    /**
     * Component which allows user to add new trusted keys by click on link.
     * @param anchor, mandatory - relative element which is used to add link at error message footer
     * @param linkId, mandatory - id of the link which is created for user
     * @param host, mandatory - name of the host to be added
     * @param key, mandatory - key of the host to be added
     */
    return Marionette.ItemView.extend({
        settings: {},

        initialize: function(options) {
            this.settings = options || {};
            var $link = $(bamboo.feature.trustedKeys.addTrustedKeyInline({linkId: this.settings.linkId}));
            $link.on('click', _.bind(this.addClickHandler, this));
            var $anchor = $(this.settings.anchor);
            $($link).insertBefore($anchor);
        },

        addClickHandler: function(event) {
            event.preventDefault();
            event.stopPropagation();

            var collection = new TrustedKeysCollection();
            var data = {
                host: this.settings.host,
                key: this.settings.key
            };
            collection.create(data, {
                wait: true,
                success: function() {
                    $(event.target).off('click'); //disable this button on success
                    new Flag({
                        type: 'success',
                        close: 'auto',
                        body: "Trusted key has been added"
                    });
                }, error: function(collection, response) {
                    if (response.status === 409) {
                        // treat it as success - we didn't add new key,
                        // but the key we wanted to have is already there
                        $(event.target).off('click'); //disable this button on success
                        new Flag({
                            type: 'success',
                            close: 'auto',
                            body: "A trusted key with given host and SSH key already exists."
                        });
                    } else {
                        var responseErrors = getErrorMessages(response);
                        var errorMessage = responseErrors.length ?
                                           responseErrors.join(' ') :
                                           "View the server logs for the details.";
                        new Flag({
                            type: 'error',
                            close: 'manual',
                            body: "The trusted key can\u0027t be added." + ' ' + errorMessage
                        });
                    }
                }
            });
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/trusted-keys-confirm-delete-dialog.js' */
define('feature/trusted-keys/trusted-keys-confirm-delete-dialog', [
    'jquery',
    'marionette',
    'widget/dialog',
    'aui/flag'
], function($,
            Marionette,
            Dialog,
            Flag) {
    'use strict';
    /**
     * Confirmation dialog for Trusted key removal
     *
     * Configuration options:
     * - model (required) - TrustedKeysModel
     */
    return Dialog.extend({
        defaultSettings: {
            height: 200,
            width: 400,
            id: 'dialog-confirm-delete-trusted-key',
            model: null,
            header: "Delete trusted key",
            buttons: [{
                id: 'dialog-confirm-delete-trusted-key-confirm',
                label: "Delete",
                cssClass: 'aui-button aui-button-primary'
            }, {
                id: 'cancel',
                label: "Cancel",
                type: 'link'
            }]
        },
        /**
         * Initialize dialog settings.
         */
        initialize: function(options) {
            var settings = options || {};
            settings.content = bamboo.feature.trustedKeys.confirmDeleteTrustedKey({
                host: settings.model.get('host')
            });

            Dialog.prototype.initialize.call(this,
                _.defaults(settings, this.defaultSettings)
            );
        },

        /**
         * Process confirm button
         */
        onButtonClick: function(id) {
            Dialog.prototype.onButtonClick.apply(this, arguments);

            if (id === 'dialog-confirm-delete-trusted-key-confirm') {
                this.model.destroy({
                    wait: true,
                    success: _.bind(this.onDeleteSuccess, this),
                    error: _.bind(this.onDeleteError, this)
                });
                this.dialog.remove();
            }
        },
        onDeleteSuccess: function() {
            new Flag({
                type: 'success',
                close: 'auto',
                body: "Trusted key was removed"
            });
        },
        onDeleteError: function() {
            new Flag({
                type: 'error',
                close: 'manual',
                body: "The trusted key can\u0027t be removed. View the server logs for the details."
            });
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/trusted-keys-app.js' */
define('feature/trusted-keys/trusted-keys-app', [
    'jquery',
    'feature/trusted-keys/trusted-keys-list-view',
    'feature/trusted-keys/entity/trusted-keys-collection',
    'feature/trusted-keys/trusted-keys-add-dialog',
    'marionette',
    'aui/flag'
], function($,
            TrustedKeysListView,
            TrustedKeysCollection,
            TrustedKeysAddDialog,
            Marionette,
            Flag) {
    'use strict';

    return Marionette.Application.extend({
        collection: null,
        el: null,
        addBtn: null,

        initialize: function(options) {
            var settings = options || {};
            this.el = settings.el;
            this.addBtn = settings.addBtn;
        },

        onStart: function() {
            this.addRegions({
                main: this.el
            });
            this.collection = new TrustedKeysCollection();
            this.collection.fetch({error: _.bind(this.onFetchErrorHandler, this)});
            var items = this.collection;
            this.getRegion('main').show(new TrustedKeysListView({collection: items}));
            $(this.addBtn).on('click', _.bind(function() {
                new TrustedKeysAddDialog({collection: this.collection});
            }, this));
        },
        onFetchErrorHandler: function(collection, response, options) {
            new Flag({
                type: 'error',
                close: 'manual',
                body: "The trusted key can\u0027t be read from the server."
            });
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/entity/trusted-keys-model.js' */
define('feature/trusted-keys/entity/trusted-keys-model', [
    'backbone'
], function(Backbone) {
    'use strict';

    return Backbone.Model.extend({
        idAttribute: 'id',
        defaults: {
            id: null,
            host: '',
            key: ''
        },
        validate: function(attrs) {
            var errors = [];
            if (!attrs.host) {
                errors.push({name: 'host', message: "This field is required"});
            }
            if (!attrs.key) {
                errors.push({name: 'key', message: "This field is required"});
            }

            return errors.length > 0 ? errors : false;
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/trusted-keys.soy' */
// This file was automatically generated from trusted-keys.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.trustedKeys.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.trustedKeys == 'undefined') { bamboo.feature.trustedKeys = {}; }


bamboo.feature.trustedKeys.view = function(opt_data, opt_ignored) {
  return '<div class="trusted_keys"><table id="trusted-keys" class="aui"><thead><tr><th id="trusted-keys-host" class="trusted-keys-host-col">' + soy.$$escapeHtml("Host") + '</th><th id="trusted-keys-key" class="trusted-keys-key-col">' + soy.$$escapeHtml("SSH key") + '</th><th id="trusted-keys-action" class="trusted-keys-action"></th></tr></thead><tbody></tbody></table></div>';
};
if (goog.DEBUG) {
  bamboo.feature.trustedKeys.view.soyTemplateName = 'bamboo.feature.trustedKeys.view';
}


bamboo.feature.trustedKeys.trustedKeyRow = function(opt_data, opt_ignored) {
  return '<td class="trusted-keys-host-col" title="' + soy.$$escapeHtml(opt_data.host) + '"><span>' + soy.$$escapeHtml(opt_data.host) + '</span></td><td class="trusted-keys-key-col" title="' + soy.$$escapeHtml(opt_data.key) + '"><span>' + soy.$$escapeHtml(opt_data.key) + '</span></td><td class="trusted-keys-action"><a id="delete-trusted-key-' + soy.$$escapeHtml(opt_data.id) + '" data-id="' + soy.$$escapeHtml(opt_data.id) + '" href="" class="delete delete-trusted-key" title="' + soy.$$escapeHtml("Revoke access for this key") + '">' + soy.$$escapeHtml("Delete") + '</a></td>';
};
if (goog.DEBUG) {
  bamboo.feature.trustedKeys.trustedKeyRow.soyTemplateName = 'bamboo.feature.trustedKeys.trustedKeyRow';
}


bamboo.feature.trustedKeys.confirmDeleteTrustedKey = function(opt_data, opt_ignored) {
  return '<div >' + soy.$$escapeHtml(soydata.VERY_UNSAFE.ordainSanitizedHtml(AJS.format("Do you want to remove the trusted key for \x3cstrong\x3e\x27\x27{0}\x27\x27\x3c/strong\x3e?",typeof (opt_data.host) === 'number' ? opt_data.host : soy.$$escapeHtml(opt_data.host)))) + '</div>';
};
if (goog.DEBUG) {
  bamboo.feature.trustedKeys.confirmDeleteTrustedKey.soyTemplateName = 'bamboo.feature.trustedKeys.confirmDeleteTrustedKey';
}


bamboo.feature.trustedKeys.addDialog = function(opt_data, opt_ignored) {
  return '<div class="dialog-add-trusted-key__content"></div>';
};
if (goog.DEBUG) {
  bamboo.feature.trustedKeys.addDialog.soyTemplateName = 'bamboo.feature.trustedKeys.addDialog';
}


bamboo.feature.trustedKeys.createTrustedKeyForm = function(opt_data, opt_ignored) {
  return '<div class="aui-group"><form class="aui"><fieldset class="trusted-keys-fieldset group"><div id="fieldArea_host" class="field-group required"><label for="host">' + soy.$$escapeHtml("Host") + '<span class="aui-icon icon-required"> required</span></label><input name="host" id="host" class="text long-field" /><div class="error control-form-error" data-field-name="host" style="display:none">' + soy.$$escapeHtml("This field is required") + '</div></div><div id="fieldArea_key" class="field-group required"><label for="key">' + soy.$$escapeHtml("SSH key") + '<span class="aui-icon icon-required"> required</span></label><textarea spellcheck="false" name="key" id="key" class="textarea long-field" rows="5"></textarea><div class="error control-form-error" data-field-name="key" style="display:none">' + soy.$$escapeHtml("This field is required") + '</div></div></fieldset></form></div>';
};
if (goog.DEBUG) {
  bamboo.feature.trustedKeys.createTrustedKeyForm.soyTemplateName = 'bamboo.feature.trustedKeys.createTrustedKeyForm';
}


bamboo.feature.trustedKeys.addTrustedKeyInline = function(opt_data, opt_ignored) {
  return '<a href="#" id="' + soy.$$escapeHtml(opt_data.linkId) + '">' + soy.$$escapeHtml("Add to trusted keys") + '</a>';
};
if (goog.DEBUG) {
  bamboo.feature.trustedKeys.addTrustedKeyInline.soyTemplateName = 'bamboo.feature.trustedKeys.addTrustedKeyInline';
}
;
;
/* module-key = 'bamboo.web.resources.common:trusted-keys', location = '/feature/trusted-keys/trusted-keys-list-view.js' */
define('feature/trusted-keys/trusted-keys-list-view', [
    'marionette',
    'feature/trusted-keys/trusted-keys-confirm-delete-dialog'
], function(Marionette,
            TrustedKeyConfirmDeleteDialog) {
    'use strict';
    /**
     * View to display elements of TrustedKeyCollection
     *
     * Configuration options:
     * - collection (required) - TrustedKeyCollection
     */
    return Marionette.CompositeView.extend({

        template: function() {
            return bamboo.feature.trustedKeys.view();
        },
        childViewContainer: 'tbody',

        childView: Marionette.ItemView.extend({
            template: bamboo.feature.trustedKeys.trustedKeyRow,
            tagName: 'tr',
            ui: {
                deleteBtn: '.delete-trusted-key'
            },
            events: {
                'click @ui.deleteBtn': 'warnBeforeDelete'
            },

            warnBeforeDelete: function(event) {
                event.preventDefault();
                new TrustedKeyConfirmDeleteDialog({model: this.model});
            }
        })
    });
});
;
;
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api', location = 'browser-metrics.js' */
(function(){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   2.0.0
 */
var j,z,e,r,p,x,H,I,u,q,J,M,L,s,i,f,m,F,v,n,O,D,R,l,N,C,y,A,h,g,E,o,d,w,c,T,K,a,G,b,P,Q,t,S;(function(){function aO(a6){return typeof a6==="function"||typeof a6==="object"&&a6!==null}function am(a6){return typeof a6==="function"}function a4(a6){return typeof a6==="object"&&a6!==null}var a1;if(!Array.isArray){a1=function(a6){return Object.prototype.toString.call(a6)==="[object Array]"}}else{a1=Array.isArray}var aG=a1;var ar=Date.now||function(){return new Date().getTime()};function av(){}var Z=Object.create||function(a6){if(arguments.length>1){throw new Error("Second argument not supported")}if(typeof a6!=="object"){throw new TypeError("Argument must be an object")}av.prototype=a6;return new av()};var aZ=0;var ai=function aM(a7,a6){aY[aZ]=a7;aY[aZ+1]=a6;aZ+=2;if(aZ===2){W()}};var aF=typeof window!=="undefined"?window:{};var ap=aF.MutationObserver||aF.WebKitMutationObserver;var ah=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function aJ(){return function(){process.nextTick(a0)}}function aU(){var a8=0;var a6=new ap(a0);var a7=document.createTextNode("");a6.observe(a7,{characterData:true});return function(){a7.data=a8=++a8%2}}function aK(){var a6=new MessageChannel();a6.port1.onmessage=a0;return function(){a6.port2.postMessage(0)}}function aQ(){return function(){setTimeout(a0,1)}}var aY=new Array(1000);function a0(){for(var a7=0;a7<aZ;a7+=2){var a8=aY[a7];var a6=aY[a7+1];a8(a6);aY[a7]=undefined;aY[a7+1]=undefined}aZ=0}var W;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){W=aJ()}else{if(ap){W=aU()}else{if(ah){W=aK()}else{W=aQ()}}}function ak(){}var aw=void 0;var aR=1;var ax=2;var aX=new a3();function aV(){return new TypeError("You cannot resolve a promise with itself")}function aE(){return new TypeError("A promises callback cannot return that same promise.")}function aN(a7){try{return a7.then}catch(a6){aX.error=a6;return aX}}function Y(ba,a8,a7,a6){try{ba.call(a8,a7,a6)}catch(a9){return a9}}function aP(a8,a6,a7){ai(function(bb){var ba=false;var a9=Y(a7,a6,function(bc){if(ba){return}ba=true;if(a6!==bc){af(bb,bc)}else{ae(bb,bc)}},function(bc){if(ba){return}ba=true;aD(bb,bc)},"Settle: "+(bb._label||" unknown promise"));if(!ba&&a9){ba=true;aD(bb,a9)}},a8)}function aa(a7,a6){if(a6._state===aR){ae(a7,a6._result)}else{if(a7._state===ax){aD(a7,a6._result)}else{a5(a6,undefined,function(a8){af(a7,a8)},function(a8){aD(a7,a8)})}}}function ab(a8,a6){if(a6.constructor===a8.constructor){aa(a8,a6)}else{var a7=aN(a6);if(a7===aX){aD(a8,aX.error)}else{if(a7===undefined){ae(a8,a6)}else{if(am(a7)){aP(a8,a6,a7)}else{ae(a8,a6)}}}}}function af(a7,a6){if(a7===a6){aD(a7,aV())}else{if(aO(a6)){ab(a7,a6)}else{ae(a7,a6)}}}function aI(a6){if(a6._onerror){a6._onerror(a6._result)}ad(a6)}function ae(a7,a6){if(a7._state!==aw){return}a7._result=a6;a7._state=aR;if(a7._subscribers.length===0){}else{ai(ad,a7)}}function aD(a7,a6){if(a7._state!==aw){return}a7._state=ax;a7._result=a6;ai(aI,a7)}function a5(a6,bb,ba,a9){var a8=a6._subscribers;var a7=a8.length;a6._onerror=null;a8[a7]=bb;a8[a7+aR]=ba;a8[a7+ax]=a9;if(a7===0&&a6._state){ai(ad,a6)}}function ad(ba){var a9=ba._subscribers;var a6=ba._state;if(a9.length===0){return}var bc,bb,a8=ba._result;for(var a7=0;a7<a9.length;a7+=3){bc=a9[a7];bb=a9[a7+a6];if(bc){aT(a6,bc,bb,a8)}else{bb(a8)}}ba._subscribers.length=0}function a3(){this.error=null}var al=new a3();function aC(a8,a6){try{return a8(a6)}catch(a7){al.error=a7;return al}}function aT(bc,be,bb,a8){var a6=am(bb),ba,a9,bd,a7;if(a6){ba=aC(bb,a8);if(ba===al){a7=true;a9=ba.error;ba=null}else{bd=true}if(be===ba){aD(be,aE());return}}else{ba=a8;bd=true}if(be._state!==aw){}else{if(a6&&bd){af(be,ba)}else{if(a7){aD(be,a9)}else{if(bc===aR){ae(be,ba)}else{if(bc===ax){aD(be,ba)}}}}}}function ac(ba,a9){try{a9(function a6(bb){af(ba,bb)},function a8(bb){aD(ba,bb)})}catch(a7){aD(ba,a7)}}function a2(a8,a6,a7){if(a8===aR){return{state:"fulfilled",value:a7}}else{return{state:"rejected",reason:a7}}}function aW(a8,a6,a9,a7){this._instanceConstructor=a8;this.promise=new a8(ak,a7);this._abortOnReject=a9;if(this._validateInput(a6)){this._input=a6;this.length=a6.length;this._remaining=a6.length;this._init();if(this.length===0){ae(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){ae(this.promise,this._result)}}}else{aD(this.promise,this._validationError())}}aW.prototype._validateInput=function(a6){return aG(a6)};aW.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")};aW.prototype._init=function(){this._result=new Array(this.length)};var aH=aW;aW.prototype._enumerate=function(){var a8=this.length;var a9=this.promise;var a6=this._input;for(var a7=0;a9._state===aw&&a7<a8;a7++){this._eachEntry(a6[a7],a7)}};aW.prototype._eachEntry=function(a7,a6){var a8=this._instanceConstructor;if(a4(a7)){if(a7.constructor===a8&&a7._state!==aw){a7._onerror=null;this._settledAt(a7._state,a6,a7._result)}else{this._willSettleAt(a8.resolve(a7),a6)}}else{this._remaining--;this._result[a6]=this._makeResult(aR,a6,a7)}};aW.prototype._settledAt=function(a8,a6,a7){var a9=this.promise;if(a9._state===aw){this._remaining--;if(this._abortOnReject&&a8===ax){aD(a9,a7)}else{this._result[a6]=this._makeResult(a8,a6,a7)}}if(this._remaining===0){ae(a9,this._result)}};aW.prototype._makeResult=function(a8,a6,a7){return a7};aW.prototype._willSettleAt=function(a7,a6){var a8=this;a5(a7,undefined,function(a9){a8._settledAt(aR,a6,a9)},function(a9){a8._settledAt(ax,a6,a9)})};var at=function aq(a6,a7){return new aH(this,a6,true,a7).promise};var ay=function ag(a6,a7){var bd=this;var bc=new bd(ak,a7);if(!aG(a6)){aD(bc,new TypeError("You must pass an array to race."));return bc}var a9=a6.length;function bb(be){af(bc,be)}function ba(be){aD(bc,be)}for(var a8=0;bc._state===aw&&a8<a9;a8++){a5(bd.resolve(a6[a8]),undefined,bb,ba)}return bc};var ao=function au(a7,a6){var a9=this;if(a7&&typeof a7==="object"&&a7.constructor===a9){return a7}var a8=new a9(ak,a6);af(a8,a7);return a8};var V=function aA(a7,a6){var a9=this;var a8=new a9(ak,a6);aD(a8,a7);return a8};var aB=0;function aS(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function aj(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var aL=X;function X(a7,a6){this._id=aB++;this._label=a6;this._state=undefined;this._result=undefined;this._subscribers=[];if(ak!==a7){if(!am(a7)){aS()}if(!(this instanceof X)){aj()}ac(this,a7)}}X.all=at;X.race=ay;X.resolve=ao;X.reject=V;X.prototype={constructor:X,then:function(bb,ba,a7){var a8=this;var a9=a8._state;if(a9===aR&&!bb||a9===ax&&!ba){return this}a8._onerror=null;var bd=new this.constructor(ak,a7);var a6=a8._result;if(a9){var bc=arguments[a9-1];ai(function(){aT(a9,bd,bc,a6)})}else{a5(a8,bd,bb,ba)}return bd},"catch":function(a7,a6){return this.then(null,a7,a6)}};var an=function U(){var a7;if(typeof global!=="undefined"){a7=global}else{if(typeof window!=="undefined"&&window.document){a7=window}else{a7=self}}var a6="Promise" in a7&&"resolve" in a7.Promise&&"reject" in a7.Promise&&"all" in a7.Promise&&"race" in a7.Promise&&function(){var a8;new a7.Promise(function(a9){a8=a9});return am(a8)}();if(!a6){a7.Promise=aL}};var az={Promise:aL,polyfill:an};if(true){j=function(){return az}()}else{if(typeof module!=="undefined"&&module.exports){module.exports=az}else{if(typeof this!=="undefined"){this["ES6Promise"]=az}}}}.call(this));z=function(V){var U=V.Promise;return U}(j);e=function(){return window}();r=function(W){var V=W.HTMLElement.prototype;var U=V.matches||V.msMatchesSelector||V.webkitMatchesSelector||V.mozMatchesSelector||V.oMatchesSelector;return U}(e);p=function k(U){var V=false;return function(){if(!V){V=true;setTimeout(function(){V=false;U()},1)}}};x=function(U,X){function W(aa){this.callback=aa;this.elements=[]}W.prototype={observe:function(ah,ap){function ab(aq){ao.push(aq);aa()}function an(at){var ar=at.target;if(!ar){return}var aq=ar.parentNode;if(!ai(aq)){return}if(am&&Z(am,ar)){return}if(!ak||ak.target!==aq){aj.push(ak=Y(aq))}if(aq){if(!ak.addedNodes){ak.addedNodes=[]}ak.addedNodes.push(ar)}else{if(!ak.removedNodes){ak.removedNodes=[]}ak.removedNodes.push(ar)}am=ar}function ag(aq){return ap.attributes&&(ap.subtree||aq===ah)}function ai(aq){return ap.childList&&(ap.subtree||aq===ah)}var ae=this;var am;var ak;var ao=[];var aj=[];var aa=U(function(){var aq=ao.length;for(var ar=0;ar<aq;ar++){an(ao[ar])}ae.callback(aj);ao=[];aj=[];am=undefined;ak=undefined});var al={};var ad=[];var af=U(function(){var aq=ad.length;ae.callback(ad);ad.splice(0,aq)});var ac={target:ah,options:ap,insertHandler:ab,removeHandler:ab,attributeHandler:function(aw){var au=aw.target;if(!ag(au)){return}var ar=aw.attrName;var at=aw.prevValue;var av=aw.newValue;var aq=Y(au,"attributes");aq.attributeName=ar;if(ap.attributeOldValue){aq.oldValue=al[ar]||at||null}ad.push(aq);if(ap.attributeOldValue){al[ar]=av}af()}};this.elements.push(ac);if(ap.childList){ah.addEventListener("DOMNodeInserted",ac.insertHandler);ah.addEventListener("DOMNodeRemoved",ac.removeHandler)}if(ap.attributes){ah.addEventListener("DOMAttrModified",ac.attributeHandler)}return this},disconnect:function(){this.elements.forEach(function(aa){aa.target.removeEventListener("DOMNodeInserted",aa.insertHandler);aa.target.removeEventListener("DOMNodeRemoved",aa.removeHandler);aa.target.removeEventListener("DOMAttrModified",aa.attributeHandler)});this.elements=[];return this}};function Y(ab,aa){return{addedNodes:null,attributeName:null,attributeNamespace:null,nextSibling:null,oldValue:null,previousSibling:null,removedNodes:null,target:ab,type:aa||"childList"}}var V=X.HTMLElement.prototype.contains;function Z(aa,ab){if(aa.nodeType!==1){return false}return aa.contains?aa.contains(ab):V.call(aa,ab)}return W}(p,e);H=function(V,U){return U.MutationObserver||U.WebkitMutationObserver||U.MozMutationObserver||V}(x,e);I=function(){function U(){this._items={};this.length=0}U.prototype.add=function(W,V){if(!this._items.hasOwnProperty(W)){this.length++;this._items[W]=[]}this._items[W].push(V)};U.prototype.remove=function(Y,W){var V,X=false;if(this._items.hasOwnProperty(Y)){if(arguments.length===1){delete this._items[Y];X=true}else{V=this._items[Y].indexOf(W);if(V>-1){this._items[Y].splice(V,1);if(this._items[Y].length===0){delete this._items[Y]}X=true}}}return X};U.prototype.get=function(V){if(this._items.hasOwnProperty(V)){return this._items[V]}return[]};U.prototype.forEach=function(W){var V=this._items;Object.keys(V).forEach(function(X){W(V[X],X)})};return U}();u=function(ad,ae,W,Y,aa){var ac,X=false,Z;Z=new Y();function V(af,ag){if(!X){ac.observe(aa.document,{attributes:true,childList:true,subtree:true});X=true}Z.add(af,ag)}function ab(af,ag){Z.remove.apply(Z,arguments);if(Z.length===0){ac.disconnect();X=false}}ac=new W(function(af){af.forEach(function(ah){var ag=ah.type==="childList"&&ah.addedNodes&&ah.addedNodes.length>0;var ai=ah.type==="attributes";if(!ag&&!ai){return}Z.forEach(function(ak,aj){if(ah.target.querySelector(aj)||ae.call(ah.target,aj)){ak.forEach(function(al){al()});ab(aj)}})})});function U(ag){var ah;if(!ag.forEach){ag=[ag]}var af=new ad(function(al,ak){var am=[];var ai=[];ag.forEach(function(an){var ap;var ao;if(!aa.document.querySelector(an)){ap=new ad(function(aq){V(an,aq);ao=function(){ab(an,aq)}});am.push(ap);ai.push(ao)}});function aj(){ai.forEach(function(an){an()})}ad.all(am).then(aj).then(al,ak);ah=function(){aj();ak()}});af.dismiss=ah;return af}return U}(z,r,H,I,e);q=function(ad,ae,V,X,aa){var ac,W=false,Z;Z=new X();function U(af,ag){if(!W){ac.observe(aa.document,{childList:true,subtree:true});W=true}Z.add(af,ag)}function ab(af,ag){Z.remove.apply(Z,arguments);if(Z.length===0){ac.disconnect();W=false}}ac=new V(function(af){af.forEach(function(ag){var ah=ag.type==="childList"&&ag.removedNodes&&ag.removedNodes.length>0;if(ah){Z.forEach(function(al,ai){var am;for(var ak=0;ak<ag.removedNodes.length;ak++){am=ag.removedNodes[ak];if(am.querySelector&&(am.querySelector(ai)||ae.call(am,ai))){for(var aj=0;aj<al.length;aj++){al[aj]()}ab(ai)}}})}})});function Y(ag){var ah;if(!ag.forEach){ag=[ag]}var af=new ad(function(al,ak){var am=[];var ai=[];ag.forEach(function(an){var ap;var ao;if(aa.document.querySelector(an)){ap=new ad(function(aq){U(an,aq);ao=function(){ab(an,aq)}});am.push(ap);ai.push(ao)}});function aj(){ai.forEach(function(an){an()})}ad.all(am).then(aj).then(al,ak);ah=function(){aj();ak()}});af.dismiss=ah;return af}return Y}(z,r,H,I,e);J=function(){var V={};var W={};var U=function(X,Z,Y){if(!W.hasOwnProperty(X)){W[X]=[]}if(Z){W[X].push({callback:Z,once:Y})}};V.on=function(X,Y){U(X,Y,false)};V.one=function(X,Y){U(X,Y,true)};V.trigger=function(X,Y){var Z=[];(W[X]||[]).forEach(function(aa){aa.callback.apply(undefined,[Y]);if(!aa.once){Z.push(aa)}});if(Z.length===0){delete W[X]}else{W[X]=Z}};return V}();M=function(U){return function V(){return U.performance&&U.performance.navigation&&U.performance.timing&&typeof U.performance.timing.navigationStart!=="undefined"}}(e);L=function(V){function U(X,W){return new V(function(Z){var aa;function Y(){var ab=X();if(ab!==undefined){clearInterval(aa);Z(ab)}}aa=setInterval(Y,W);Y()})}return U}(z);s=function(Y,ab,Z,W){var X=["unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];function U(){var ac=Y.performance.timing.loadEventEnd>0;var ad={};if(ac){X.forEach(function ae(af){var ag=Y.performance.timing[af];var ah=ag>0;if(ah){ad[af]=ag-Y.performance.timing.navigationStart}});return ad}}var aa;function V(){if(!ab()){return Z.reject("The navigation timing API is required to produce a report for this navigation.")}if(typeof aa==="undefined"){aa=W(U,250)}return aa}return V}(e,M,z,L);i=function(W,V,X){function U(Y){return V().then(function(){var Z=Y.isInitial?W.performance.timing.navigationStart:Y.start;return{readyForUser:Math.round(Y.end-Z)}})}return U}(e,s,z);f=function(V){return function U(W){return V(W).then(function(X){var Y;var aa=W.threshold;var Z=W.threshold*4;if(X.readyForUser<aa){Y=1}else{if(X.readyForUser<Z){Y=0.5}else{Y=0}}return{apdex:Y}})}}(i);m=function(Y,X,ab){function aa(ac){if(!ac.isInitial){return{}}return W().then(function(ad){return{firstPaint:Math.round(ad)}},function(){return{}})}function U(){return Y.chrome&&Y.chrome.loadTimes}function Z(){return typeof Y.performance.timing.msFirstPaint!=="undefined"}function V(){if(U()&&Y.chrome.loadTimes().firstPaintTime>0){return Y.chrome.loadTimes().firstPaintTime*1000-Y.performance.timing.navigationStart}else{if(Z()&&Y.performance.timing.msFirstPaint>0){return Y.performance.timing.msFirstPaint-Y.performance.timing.navigationStart}}}function W(){if(U()||Z()){return X(V,250)}else{return ab.reject("The browser does not have a first paint metric")}}return aa}(e,L,z);F=function B(U){return{isInitial:U.isInitial}};v=function(W,X){var Y="browser-metrics-journey";function V(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(ab){var aa=W.Math.random()*16|0;var Z=ab==="x"?aa:aa&3|8;return Z.toString(16)})}function U(){if(typeof W.sessionStorage==="undefined"){return X.reject("sessionStorage is required to produce a report for this navigation.")}if(W.sessionStorage.getItem(Y)===null){W.sessionStorage.setItem(Y,V())}return X.resolve({journeyId:W.sessionStorage.getItem(Y)})}return U}(e,z);n=function(){function U(V){return{key:V.key}}return U}();O=function(V,W){function U(Y){var X={};if(Y.isInitial&&W()){X.navigationType=V.performance.navigation.type}return X}return U}(e,M);D=function(V,X,W){function U(Z){var Y={};if(Z.isInitial){if(!X()){return W.reject("The navigation timing API is required to produce a report for this navigation.")}if(typeof V.performance.navigation.redirectCount!=="undefined"){Y.redirectCount=V.performance.navigation.redirectCount}}return W.resolve(Y)}return U}(e,M,z);R=function(U){function V(X){var W=U.document.createElement("a");W.href=X;return W.href}return V}(e);l=function(Y,V,X){function U(){var Z=X.document.querySelectorAll("script[src][async]");return Array.prototype.map.call(Z,function(aa){return Y(aa.src)})}function W(){var Z=U();function aa(ad){return X.performance.getEntriesByType("resource").filter(function ae(af){return af.initiatorType==="link"||af.initiatorType==="script"}).filter(function ac(af){return af.responseEnd<ad.domContentLoadedEventStart}).filter(function ab(af){return af.initiatorType!=="script"||Z.indexOf(af.name)===-1})}return V().then(aa)}return W}(R,s,e);N=function(V,U){function W(Y){if(!Y.isInitial){return{}}return U().then(function X(ad){var ac=ad.map(function Z(ae){return ae.responseEnd}).map(function ab(ae){return Math.round(ae)}).reduce(function aa(af,ae){return Math.max(af,ae)},0);return{resourceLoadedEnd:ac}})}return W}(z,l);C=function(X,U,V){function W(){function Y(aa){return V.performance.getEntriesByType("resource").filter(function ac(ad){return ad.initiatorType!=="img"}).filter(function ab(ad){return ad.startTime<aa.domContentLoadedEventEnd}).filter(function Z(ad){return ad.name.indexOf("https://ace.atlassian.com")===-1})}return U().then(Y)}return W}(R,s,e);
/*!
 * resourcetiming-compression.js
 *
 * Compresses ResourceTiming data.
 *
 * Based on https://github.com/nicjansma/resourcetiming-compression.js
 *
 */
y=function(){var U={};U.INITIATOR_TYPES={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5};U.convertToTrie=function(Z){var aa={},V,Y,ac,ab,W,ad,X;for(V in Z){if(!Z.hasOwnProperty(V)){continue}ac=Z[V];ab=V.split("");ad=aa;for(Y=0;Y<ab.length;Y++){W=ab[Y];X=ad[W];if(typeof X==="undefined"){ad=ad[W]=Y===ab.length-1?ac:{}}else{if(typeof X==="string"){ad=ad[W]={"|":X}}else{if(Y===ab.length-1){ad[W]["|"]=ac}else{ad=ad[W]}}}}}return aa};U.optimizeTrie=function(aa,Z){var X=0,Y,W,V;for(Y in aa){if(typeof aa[Y]==="object"){W=this.optimizeTrie(aa[Y],false);if(W){delete aa[Y];Y=Y+W.name;aa[Y]=W.value}}X++}if(X===1){if(Z){V={};V[Y]=aa[Y];return V}else{return{name:Y,value:aa[Y]}}}else{if(Z){return aa}else{return false}}};U.trimTiming=function(W,V){if(typeof W!=="number"||typeof V!=="number"||W===0){return null}var X=Math.round(W-V);return X===0?null:X};U.toBase36=function(V){return typeof V==="number"?V.toString(36):""};U.compressResourceData=function(W){var V=this.INITIATOR_TYPES[W.initiatorType];if(typeof V==="undefined"){V=0}return V+[this.trimTiming(W.startTime,0),this.trimTiming(W.responseEnd,W.startTime),this.trimTiming(W.responseStart,W.startTime),this.trimTiming(W.requestStart,W.startTime),this.trimTiming(W.connectEnd,W.startTime),this.trimTiming(W.secureConnectionStart,W.startTime),this.trimTiming(W.connectStart,W.startTime),this.trimTiming(W.domainLookupEnd,W.startTime),this.trimTiming(W.domainLookupStart,W.startTime),this.trimTiming(W.redirectEnd,W.startTime),this.trimTiming(W.redirectStart,W.startTime)].map(this.toBase36).join(",").replace(/,+$/,"")};U.getResourceTiming=function(aa){var X,Z,W={},V,Y;if(!aa||!aa.length){return[]}for(X=0;X<aa.length;X++){Z=aa[X];if(Z.name.indexOf("about:")===0||Z.name.indexOf("javascript:")===0){continue}Y=this.compressResourceData(Z);V=Z.name;if(W[V]!==undefined){W[V]+="|"+Y}else{W[V]=Y}}return this.optimizeTrie(this.convertToTrie(W),true)};return U}();A=function(V,W,Y,X){function U(aa){if(!aa.isInitial){return{}}return Y().then(function Z(ab){return{resourceTimings:JSON.stringify(X.getResourceTiming(ab))}})}return U}(e,z,C,y);h=function(){function U(V){return{threshold:V.threshold}}return U}();g=function(U){function V(W){if(!W.isInitial){return{}}return U()}return V}(s);E=function(U){function V(){return{userAgent:U.navigator.userAgent}}return V}(e);o=function(ac,af,ad,Z,W,ae,ag,V,Y,ah,ab,X,aa){var U=[ac,af,ad,Z,W,ae,ag,V,Y,ah,ab,X,aa];return{get:function(){return U.concat()},add:function(ai){U.push(ai)}}}(f,m,F,v,n,O,i,D,N,A,h,g,E);d=function(){var U=Object.prototype.hasOwnProperty;function V(){var Z={};var Y,aa;for(var W=0,X=arguments.length;W<X;W++){Y=arguments[W];for(aa in Y){if(U.call(Y,aa)){Z[aa]=Y[aa]}}}return Z}return V}();w=function(V){var U=V.document.readyState!=="loading";if(!U){V.document.addEventListener("DOMContentLoaded",function(){V.setTimeout(function(){U=true},0)})}function W(){return U}return W}(e);c=function(V,Z,ae,ac,U,ad,X){var ab={};function aa(ag,af){if(!Array.isArray(ag)){ag=[ag]}return ag.map(function(ah){if(typeof ah==="string"){ah={selector:ah}}return ad(af,ah)})}function Y(ag){var af;af=ag.map(function(ai){var ah;if(ai.requireUpdate){ah=new Z(ai.selector);ae.one("start",function(){ah.dismiss()})}else{ah=ac.resolve()}return ah.then(function(){var aj=new V(ai.selector);ae.one("start",function(){aj.dismiss()});return aj})});return ac.all(af)}ab.start=function(ag){var ai;var ah="isInitial" in ag?ag.isInitial:X()===false;var af="threshold" in ag?ag.threshold:1000;ae.trigger("start",{key:ag.key,isInitial:ah,threshold:af});if(ag.ready){ai=aa(ag.ready,{requireUpdate:!ah});Y(ai).then(function(){ab.end({key:ag.key})})}};ab.end=function(af){ae.trigger("end",{key:af.key})};ab.addReporter=function W(af){U.add(af)};return ab}(u,q,J,z,o,d,w);T=function(U){return U.AJS||(U.AJS={})}(e);K=function(U){U.EventQueue=U.EventQueue||[];function V(W,X){U.EventQueue.push({name:W,properties:X})}return V}(T);a=function(V){function U(W){(V.console.error||V.console.log).call(V.console,W.stack||W)}return U}(e);G=function(ac,Y,Z,X,aa,U){function V(ad){return Y.all([ad]).then(function(ae){return ae[0]})}function ab(ad){return V(ad).then(null,function(){return{}})}function W(af){var ag=U.get().map(function ae(ai){var ah;try{ah=ai(af)}catch(aj){aa(aj);ah={}}return ab(ah)});return Y.all(ag).then(function ad(ah){return Z.apply(undefined,ah)})}return W}(L,z,d,e,a,o);b=function(V){var U;if(V.performance&&V.performance.now){U=function(){return V.performance.timing.navigationStart+V.performance.now()}}else{U=V.Date.now.bind(V.Date)}return U}(e);P=function(Y,V,W){function U(Z){if(!(this instanceof U)){return new U(Z)}this.isInitial="isInitial" in Z?Z.isInitial:false;this.start=W();this.end=null;this.key=Z.key;this.threshold=Z.threshold}function X(Z){var aa;Z.on("start",function(ab){aa=new U(ab)});Z.on("end",function(ab){if(aa&&aa.key===ab.key){aa.end=W();V(aa).then(function(ac){Y("browser.metrics.navigation",ac)});aa=null}})}return X}(K,G,b);Q=function(U){return U.WRM||(U.WRM={})}(e);t=function(U){var Z="com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api.feature-data-provider",V;function Y(aa){return !!(aa&&aa.constructor&&aa.call&&aa.apply)}function X(aa,ab){if(U&&U.data&&U.data.claim&&Y(U.data.claim)){return U.data.claim(aa)}else{if(U&&U.data&&Y(U.data)){return U.data(aa)}else{return ab}}}function W(){if(V===undefined){V=X(Z,true)}return V}return W}(Q);S=function(X,W,U,V){if(!V()){return{start:function(){},end:function(){}}}W(U);return X}(c,P,J,t);window["browser-metrics"]=S;if(window.define){window.define("internal/browser-metrics",[],function(){return S})}}());;
;
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api', location = 'main.js' */
define("internal/browser-metrics-plugin/lib/window",["require","exports"],function(b,a){return window});define("internal/browser-metrics-plugin/lib/jquery",["require","exports","./window"],function(b,a,c){var d;try{d=c.require("jquery")}catch(f){d=c.jQuery}return d});define("internal/browser-metrics-plugin/reporters/experiments",["require","exports","../lib/jquery","../lib/window"],function(a,d,f,i){var h=i.AJS.contextPath()+"/experimental/main.js";function c(){return Array.prototype.slice.call(i.document.getElementsByTagName("script"))}function j(){return(i.GROW&&i.GROW.experimentId)||[]}function e(){var m=f.Deferred();f(function n(){var o=c().some(function p(q){return q.getAttribute("src")===h});m.resolve(o)});return m.promise()}var g=e().pipe(function l(n){var m={};if(n){m.experiments=JSON.stringify(j())}return m});var b=function k(){return g};return b});define("internal/browser-metrics-plugin/lib/wrm",["require","exports","./window"],function(b,a,d){var c=d.WRM;return c});define("internal/browser-metrics-plugin/reporters/rack",["require","exports","../lib/wrm"],function(f,e,d){var g=false;var h;function c(){if(g===false){h=d.data.claim("com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api.rack-data-provider");g=true}return typeof h==="undefined"?"":h}var b=function a(){return{rack:c()}};return b});define("internal/browser-metrics-plugin/main",["require","exports","./reporters/experiments","./reporters/rack","internal/browser-metrics"],function(d,b,c,a,e){e.addReporter(c);e.addReporter(a)});require(["internal/browser-metrics-plugin/main"]);;
;
/* module-key = 'com.atlassian.bamboo.plugins.bamboo-plugin-browser-metrics:bamboo-browser-metrics-js', location = '/javascript/bamboo-browser-metrics.js' */
define("internal/bamboo-browser-metrics",["internal/browser-metrics","jquery"],function(b,c){var a=function(){var d="bamboo."+this.apdexKey();var e=this.apdexReady();if(d!=="default"&&e!=="default"){b.start({key:d,isInitial:true,ready:e})}};a.prototype.apdexKey=function(){var d=c('meta[name="apdex-key"]');return d&&d.attr("content")||"default"};a.prototype.apdexReady=function(){var d=c('meta[name="apdex-ready"]');return d&&d.attr("content")||"default"};return a});;
;
/* module-key = 'com.atlassian.bamboo.plugins.bamboo-artifact-downloader-plugin:artifactdownloaderjs', location = 'js/artifact.js' */
(function(b,a){a.ArtifactDownloaderConfiguration=(function(){var f={planSelector:null,planKey:null,addArtifactSelector:null,removeArtifactSelector:null,artifactListSelector:null,templates:{artifactListItem:null},i18n:{allArtifacts:null,individualArtifacts:null}};var m;var i;var g=function(){var o=+i.data("nextTransferId")+1;i.data("nextTransferId",o);b(AJS.template.load(m.templates.artifactListItem).fill({index:o}).toString()).appendTo(i).find(m.selectedArtifactSelector).end().slideDown();l(o).done(function(){a.DynamicFieldParameters.syncFieldShowHide(i)});if(o===0){var n=b('[data-artifact-id="0"]',i);b(m.removeArtifactSelector,n).remove()}};var e=function(n,o){if(o instanceof Backbone.Model){var p=o.get("key");if(m.planKey===p){return}m.planKey=p;c();g();if(m.planKey!==""){b(m.addArtifactSelector).show()}}};var l=function(o){var p;b(m.artifactListSelector).find("li").each(function(){var q=b(this).attr("data-artifact-id");if(+q===o){p=b(this);return false}});p.find("input").val("");var n=p.find("select");n.find("optgroup").remove();return h().then(function(q){d(n,q)})};var h=function(){var n=b.Deferred();j().then(function(p){var s=p.artifacts.size;var o=p.artifacts["max-result"];if(s>o){var q=[];for(var r=1;r<Math.ceil(s/o);r++){q.push(j(r*o,o))}b.when.apply(b,q).done(function(){var t=p.artifacts.artifact;(q.length===1?[arguments]:_.toArray(arguments)).forEach(function(u){t=t.concat(u[0].artifacts.artifact)});n.resolve(t)})}else{n.resolve(p.artifacts.artifact)}}).fail(function(p,q,o){console.log("couldn't retrieve artifacts: "+q)});return n};var j=function(o,n){return b.ajax({url:AJS.contextPath()+"/rest/api/latest/plan/"+m.planKey+"/artifact",dataType:"json",data:_.extend({"start-index":o||0},n?{"max-results":n}:{})})};var d=function(n,q){var p=b("<optgroup/>").attr("label",m.i18n.individualArtifacts);for(var r=0,t=q.length;r<t;r++){var o=q[r];var s=b("<option/>").attr("value",o.id).text(o.name);p.append(s)}n.append(p)};var k=function(n){n.preventDefault();b(this).closest("li").slideUp(function(){b(this).remove()})};var c=function(){b(m.artifactListSelector).find("li").remove()};return{init:function(n){m=b.extend(true,f,n);b(function(){m.planKey=b(m.planSelector).val();i=b(m.artifactListSelector).on("click",m.removeArtifactSelector,k);require("util/events").EventBus.on("plan:selected",e);b(m.addArtifactSelector).click(g);if(m.planKey===""){b(m.addArtifactSelector).hide()}})}}}())}(jQuery,window.BAMBOO=(window.BAMBOO||{})));;
;
/* module-key = 'com.atlassian.support.stp:stp-license-status-resources', location = 'js/stp-licenseStatus.js' */
(function(b){var a={destroyBanner:function(){AJS.$("#stp-licenseStatus-banner").slideUp(function(){AJS.$("#stp-licenseStatus-banner").remove();AJS.trigger("stp-licenseStatus-banner:destroyed")})},remindMeNever:function(c){c.preventDefault();AJS.$.ajax({type:"POST",async:true,headers:{"X-Atlassian-Token":"no-check"},url:AJS.contextPath()+"/rest/stp/1.0/license/remindMeNever"});a.destroyBanner()},remindMeLater:function(){AJS.$.ajax({type:"POST",async:true,headers:{"X-Atlassian-Token":"no-check"},url:AJS.contextPath()+"/rest/stp/1.0/license/remindMeLater"});a.destroyBanner()},createBanner:function(d,f){var c="\n<div id='stp-licenseStatus-banner' class='aui-message warning'>\n";var g="https://www.atlassian.com/purchase/renew?utm_source=STP&utm_medium=renewals_reminder&utm_campaign=renewals_reminder";if(d===0){c+=AJS.format("Your {0} maintenance expires today. For continued access to support and updates, {1}renew your maintenance{2}. {3}Remind me later{4} or {5}never remind me again{6}.",f,"<a id='stp-licenseStatus-renewNow' target='_blank' href=\""+g+'">',"</a>","<a id='stp-licenseStatus-remindMeLater' href='#'>","</a>","<a id='stp-licenseStatus-remindMeNever' href='#'>","</a>");c+="<span class ='aui-icon icon-warning'></span>\n</div>"}else{c+=AJS.format("Your {0} maintenance expires in {1} days. For continued access to support and updates, {2}renew your maintenance{3}. {4}Remind me later{5} or {6}never remind me again{7}.",f,d,"<a id='stp-licenseStatus-renewNow' target='_blank' href=\""+g+'">',"</a>","<a id='stp-licenseStatus-remindMeLater' href='#'>","</a>","<a id='stp-licenseStatus-remindMeNever' href='#'>","</a>");c+="<span class ='aui-icon icon-warning'></span>\n</div>"}var e=b("#stp-licenseStatus-banner-container");if(e.length===0){e=b(document.body)}e.prepend(c);AJS.$("#stp-licenseStatus-remindMeNever").click(a.remindMeNever);AJS.$("#stp-licenseStatus-remindMeLater").click(function(h){h.preventDefault();a.remindMeLater()});AJS.$("#stp-licenseStatus-renewNow").click(function(h){a.remindMeLater()});AJS.trigger("stp-licenseStatus-banner:created")}};AJS.$(document).ready(function(){var i=AJS.$("meta[name='stp-license-days-to-expiry']");var c=AJS.$("meta[name='stp-license-is-admin']");var f=AJS.$("meta[name='stp-license-should-keep-banner-hidden']");var h=AJS.$("meta[name='stp-license-product-name']");var g={};var k=b.Deferred();var d=i.length&&c.length&&f.length&&h.length;if(d){var l=i.attr("content")||-1;g.daysToExpiry=parseInt(l);g.shouldKeepBannerHidden=f.attr("content")==="true";g.isAdmin=c.attr("content")==="true";g.productName=h.attr("content");k.resolve(g)}else{b.ajax({type:"GET",dataType:"json",async:true,url:AJS.contextPath()+"/rest/stp/1.0/license/status",headers:{"X-Atlassian-Token":"no-check"},statusCode:{200:function(m){k.resolve(b.extend(m,{viaRest:true}))},204:function(){k.reject("204. No reason to display banner.")}},error:function(){k.reject("Error returned from call to license/status")}})}k.done(function j(n){var m=l<30&&l>=0;if(n.viaRest||(n.isAdmin&&m&&!n.shouldKeepBannerHidden)){b("#stp-licenseStatus-banner").length||a.createBanner(n.daysToExpiry,n.productName)}}).fail(function e(m){console.log("Not displaying license banner: "+m)})})})(AJS.$);;
;
/* module-key = 'com.atlassian.bamboo.brokenbuildtracker:trackingjs', location = 'js/tracking.js' */
BAMBOO.BrokenBuildTracking=(function(c){var b={},a,d={containerSelector:null,buildKey:null,buildNumber:null,refreshUrl:null},e={add:function(){c(a.containerSelector).addClass("loading")},remove:function(){c(a.containerSelector).removeClass("loading")}};b.init=function(f){a=c.extend(true,d,f);c(document).delegate(".take-responsibility, .remove-responsibility","click",function(g){g.preventDefault();e.add();c.post(this.href,{"bamboo.successReturnMode":"json"}).always(b.refresh)})};b.refresh=function(){e.add();c.get(a.refreshUrl,{buildKey:a.buildKey,buildNumber:a.buildNumber}).done(function(f){var g=c(f).filter(a.containerSelector);c(a.containerSelector).replaceWith(g)}).always(e.remove)};return b})(AJS.$);;
;
/* module-key = 'bamboo.web.resources:widget-autocomplete-static', location = '/widget/autocomplete/autocomplete-static.js' */
define('widget/autocomplete-static', [
    'jquery',
    'underscore',
    'widget/autocomplete'
], function(
    $,
    _,
    Autocomplete
) {

    'use strict';

    var AutocompleteStatic = Autocomplete.extend({

        initialize: function(options) {
            var settings = $.extend({
                data: [],
                query: function(query) {
                    var pageSize = options.pageSize || 10;
                    var results = _.filter(this.data, function(e) {
                        return (query.text === '' ||
                            e.text.toUpperCase().indexOf(
                                query.term.toUpperCase()
                            ) >= 0
                        );
                    });

                    query.callback({
                        results: results.slice(Math.max(query.page - 1, 0) * pageSize, query.page * pageSize),
                        more: results.length >= query.page * pageSize
                    });

                    results = null;
                    pageSize = null;
                }
            }, options || {});

            if (_.isFunction(this.onFormatSelection)) {
                settings.formatSelection = _.bind(this.onFormatSelection, this);
            }

            if (_.isFunction(this.onFormatResult)) {
                settings.formatResult = _.bind(this.onFormatResult, this);
            }

            Autocomplete.prototype.initialize.apply(
                this, [settings]
            );
        }

    });

    return AutocompleteStatic;
});
;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/repository-form.soy' */
// This file was automatically generated from repository-form.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.plugins.stash.repository.form.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.plugins == 'undefined') { bamboo.plugins = {}; }
if (typeof bamboo.plugins.stash == 'undefined') { bamboo.plugins.stash = {}; }
if (typeof bamboo.plugins.stash.repository == 'undefined') { bamboo.plugins.stash.repository = {}; }
if (typeof bamboo.plugins.stash.repository.form == 'undefined') { bamboo.plugins.stash.repository.form = {}; }


bamboo.plugins.stash.repository.form.userHasRepositoryAdminPermissionsDescription = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml("A new public key for the selected repository will be stored as a repository access key.");
};
if (goog.DEBUG) {
  bamboo.plugins.stash.repository.form.userHasRepositoryAdminPermissionsDescription.soyTemplateName = 'bamboo.plugins.stash.repository.form.userHasRepositoryAdminPermissionsDescription';
}


bamboo.plugins.stash.repository.form.userHasRepositoryReadPermissionsDescription = function(opt_data, opt_ignored) {
  return aui.icons.icon({useIconFont: true, size: 'small', icon: 'warning'}) + '<span>' + soy.$$escapeHtml("A new public key for the selected repository will be stored in your Bitbucket Server user profile because you don\x27t have administrative permissions.") + '</span>';
};
if (goog.DEBUG) {
  bamboo.plugins.stash.repository.form.userHasRepositoryReadPermissionsDescription.soyTemplateName = 'bamboo.plugins.stash.repository.form.userHasRepositoryReadPermissionsDescription';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/server-autocomplete.soy' */
// This file was automatically generated from server-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.plugins.stash.server.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.plugins == 'undefined') { bamboo.plugins = {}; }
if (typeof bamboo.plugins.stash == 'undefined') { bamboo.plugins.stash = {}; }
if (typeof bamboo.plugins.stash.server == 'undefined') { bamboo.plugins.stash.server = {}; }
if (typeof bamboo.plugins.stash.server.autocomplete == 'undefined') { bamboo.plugins.stash.server.autocomplete = {}; }


bamboo.plugins.stash.server.autocomplete.row = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml(opt_data.item.name);
};
if (goog.DEBUG) {
  bamboo.plugins.stash.server.autocomplete.row.soyTemplateName = 'bamboo.plugins.stash.server.autocomplete.row';
}


bamboo.plugins.stash.server.autocomplete.serverEmpty = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div id="stash-server-empty">' + aui.message.info({titleContent: "Bitbucket Server application link required", content: '' + ((opt_data.appLinkRemoved) ? '<p>' + ((opt_data.hasGlobalAdminPermission) ? soy.$$escapeHtml("Your application link to this Bitbucket Server instance has been removed. You will need to link it again to be able to use the available repositories and branches.") : soy.$$escapeHtml("Your application link to this Bitbucket Server instance has been removed. Please contact your Bamboo administrator to link it again to use the available repositories and branches.")) + '</p>' : '<p>' + ((opt_data.hasGlobalAdminPermission) ? soy.$$escapeHtml("On first use, Bamboo needs to establish an application link to a Bitbucket Server instance. It will then be able to display all available repositories and branches. This has to be done only once per Bitbucket Server instance.") : soy.$$escapeHtml("On first use, Bamboo needs to establish an application link to a Bitbucket Server instance. It will then be able to display all available repositories and branches. Please contact your Bamboo administrator to establish a link to Bitbucket Server.")) + '</p>') + ((opt_data.hasGlobalAdminPermission) ? '<button class="aui-button" type="button" id="start-create-applink" onclick="window.open(\'' + soy.$$escapeHtml("") + '/plugins/servlet/applinks/listApplicationLinks\')" >' + soy.$$escapeHtml("Link Bamboo to Bitbucket Server") + '</button>' : '')}) + '</div>';
};
if (goog.DEBUG) {
  bamboo.plugins.stash.server.autocomplete.serverEmpty.soyTemplateName = 'bamboo.plugins.stash.server.autocomplete.serverEmpty';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/branch-autocomplete.soy' */
// This file was automatically generated from branch-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.plugins.stash.branch.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.plugins == 'undefined') { bamboo.plugins = {}; }
if (typeof bamboo.plugins.stash == 'undefined') { bamboo.plugins.stash = {}; }
if (typeof bamboo.plugins.stash.branch == 'undefined') { bamboo.plugins.stash.branch = {}; }
if (typeof bamboo.plugins.stash.branch.autocomplete == 'undefined') { bamboo.plugins.stash.branch.autocomplete = {}; }


bamboo.plugins.stash.branch.autocomplete.row = function(opt_data, opt_ignored) {
  return aui.icons.icon({icon: 'devtools-branch', useIconFont: true}) + ' ' + soy.$$escapeHtml(opt_data.item.displayId);
};
if (goog.DEBUG) {
  bamboo.plugins.stash.branch.autocomplete.row.soyTemplateName = 'bamboo.plugins.stash.branch.autocomplete.row';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/repository-autocomplete.soy' */
// This file was automatically generated from repository-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.plugins.stash.repository.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.plugins == 'undefined') { bamboo.plugins = {}; }
if (typeof bamboo.plugins.stash == 'undefined') { bamboo.plugins.stash = {}; }
if (typeof bamboo.plugins.stash.repository == 'undefined') { bamboo.plugins.stash.repository = {}; }
if (typeof bamboo.plugins.stash.repository.autocomplete == 'undefined') { bamboo.plugins.stash.repository.autocomplete = {}; }


bamboo.plugins.stash.repository.autocomplete.row = function(opt_data, opt_ignored) {
  return soy.$$escapeHtml(opt_data.item.project.name) + ' / ' + soy.$$escapeHtml(opt_data.item.name);
};
if (goog.DEBUG) {
  bamboo.plugins.stash.repository.autocomplete.row.soyTemplateName = 'bamboo.plugins.stash.repository.autocomplete.row';
}


bamboo.plugins.stash.repository.autocomplete.oauthError = function(opt_data, opt_ignored) {
  return '' + aui.message.info({titleContent: '' + soy.$$escapeHtml(AJS.format("{0} - approval required",opt_data.instanceName)), content: '<p><p>' + soy.$$escapeHtml("Bamboo requires your approval before it can display repositories and branches, and automatically set up authentication.") + '</p><br/><a class="oauth-approve" href="' + soy.$$escapeHtml(opt_data.redirectUrl) + '" target="_blank">' + soy.$$escapeHtml("Login \x26 approve") + '</a></p>'});
};
if (goog.DEBUG) {
  bamboo.plugins.stash.repository.autocomplete.oauthError.soyTemplateName = 'bamboo.plugins.stash.repository.autocomplete.oauthError';
}


bamboo.plugins.stash.repository.autocomplete.unauthorizedError = function(opt_data, opt_ignored) {
  var param20 = '<p>';
  switch (opt_data.requestStatus) {
    case 401:
      param20 += soy.$$escapeHtml("You don\x27t have permission to see this repository. Bamboo can still access this repository at build time, but simply can\x27t show you any details. Bamboo will continue to work without problems.");
      break;
    case 404:
      param20 += soy.$$escapeHtml("Your repository was renamed or deleted. This will make it impossible for Bamboo to work with this repository. Please adjust your configuration as soon as possible.");
      break;
  }
  param20 += '</p>';
  var output = '' + aui.message.error({titleContent: "Repository could not be found", content: param20});
  return output;
};
if (goog.DEBUG) {
  bamboo.plugins.stash.repository.autocomplete.unauthorizedError.soyTemplateName = 'bamboo.plugins.stash.repository.autocomplete.unauthorizedError';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/repository-form.js' */
define("plugin-stash/repository-form",["jquery","underscore","brace","util/events","util/elements"],function(f,a,c,b,e){var d=c.View.extend({mixins:[b.EventBusMixin,e],elements:{serverKey:'input[name="repository.stash.server"]',projectKey:'input[name="repository.stash.projectKey"]',repositoryUrl:'input[name="repository.stash.repositoryUrl"]',repositorySlug:'input[name="repository.stash.repositorySlug"]',isAdmin:'input[name="repository.stash.temporary.isAdmin"]',repositoryMessages:"#repository-stash-messages"},initialData:{serverKey:"",projectKey:"",repositoryUrl:"",repositorySlug:"",isAdmin:""},initialize:function(g){this.params=g.params||{};if(g.elements){this.elements=g.elements}if(g.params.initialData){this.initialData=g.params.initialData}this.$repositoryDisplayName=f("#repository-display-name");this.$repositoryAccessPoint=f("#repository-access-option");this.onEvent("unbind",this.onUnbind);this.onEvent("repository:selector:change",a.bind(function(h,j,i){this.updateWebRepository(i);if(i===this.params.namespace&&j==="NEW"){this.triggerEvent("stash:server:init")}},this));this.onEvent("repository:server:reset",this.onServerReset);this.onEvent("stash:repository:update",this.onRepositoryUpdate);this.onEvent("stash:repository:init",a.bind(function(h,i){this.onRepositoryUpdate(h,i,true)},this));this.onEvent("stash:server:update",this.onServerUpdate);this.onEvent("stash:server:error:empty",this.onServerEmpty);this.onEvent("stash:server:error:permissions",this.onServerPermissions);this.onEvent("stash:errors:show",this.onShowFieldErrors);this.onEvent("stash:errors:clear",this.onClearFieldErrors);this.triggerEvent("stash:form:config",this.getConfig());if(f("#selectedRepository").val()===this.params.namespace){this.updateWebRepository(this.params.namespace);this.triggerEvent("stash:server:init")}},onUnbind:function(){this.undelegateEvents();this.clearElementsCache();this.$el.removeData().unbind();this.offEventNamespace("repository");this.offEventNamespace("stash")},onServerUpdate:function(g,h){if(h&&h.id&&h.id!==this.getElement("serverKey").val()){this.getElement("serverKey").val(h.id);this.getElement("projectKey").val("");this.getElement("repositoryUrl").val("");this.getElement("repositorySlug").val("");this.getElement("isAdmin").val("")}this.triggerEvent("stash:form:config",this.getConfig());this.triggerEvent("stash:server:change",h)},onServerReset:function(){if(this.initialData&&this.initialData.serverKey){var h=this.getElement("serverKey").val(),i=this.getElement("projectKey").val(),g=this.getElement("repositorySlug").val();this.getElement("serverKey").val(this.initialData.serverKey);this.getElement("projectKey").val(this.initialData.projectKey);this.getElement("repositoryUrl").val(this.initialData.repositoryUrl);this.getElement("repositorySlug").val(this.initialData.repositorySlug);this.getElement("isAdmin").val(this.initialData.isAdmin);this.triggerEvent("stash:form:config",this.getConfig());if(h!==this.initialData.serverKey||i!==this.initialData.projectKey||g!==this.initialData.repositorySlug){this.triggerEvent("stash:server:change",{id:this.initialData.serverKey,project:{key:this.initialData.projectKey},sshCloneUrl:this.initialData.repositoryUrl,slug:this.initialData.repositorySlug,permission:this.initialData.isAdmin?"ADMIN":""})}}},onRepositoryUpdate:function(g,i,j){if(i&&i.id){this.getElement("projectKey").val(i.id?i.project.key:"");this.getElement("repositoryUrl").val(i.id?i.sshCloneUrl:"");this.getElement("repositorySlug").val(i.id?i.slug:"");this.getElement("isAdmin").val(i.id?i.permission==="ADMIN":"");var h=i.permission==="ADMIN"?bamboo.plugins.stash.repository.form.userHasRepositoryAdminPermissionsDescription():bamboo.plugins.stash.repository.form.userHasRepositoryReadPermissionsDescription();this.triggerEvent("stash:repository:description:set",h)}this.triggerEvent("stash:form:config",this.getConfig());this.triggerEvent("stash:repository:change",i,!!j)},onServerEmpty:function(g,h){if(a.isUndefined(h)){h=true}this.toggleContainer(this.$repositoryDisplayName,!h)},onServerPermissions:function(g,h){if(a.isUndefined(h)){h=true}if(this.$repositoryAccessPoint.length){this.toggleContainer(this.$repositoryAccessPoint,!h)}},onClearFieldErrors:function(){this.$el.find(".error").remove()},onShowFieldErrors:function(g,h,i){if(a.isString(h)){h=this.getElement(h)}h.parent().find(".error").remove();BAMBOO.addFieldErrors(h.closest("form"),h.attr("name"),i,true)},updateWebRepository:function(g){var h=this.$el.parents("form:first");if(h.length){var i=h.find('input[name="repositoryType"]');if(i.length&&g!==this.params.namespace){i.val("")}else{if(+h.find('input[name="repositoryId"]').val()===0||i.val()!==g){h.find("#selectedWebRepositoryViewer").val(this.params.viewer).change()}}}},getConfig:function(){return{serverKey:this.getElement("serverKey").val(),projectKey:this.getElement("projectKey").val(),repositorySlug:this.getElement("repositorySlug").val(),repositoryUrl:this.getElement("repositoryUrl").val()}}});return d});;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/repository-view.soy' */
// This file was automatically generated from repository-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.plugins.stash.repository.view.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.plugins == 'undefined') { bamboo.plugins = {}; }
if (typeof bamboo.plugins.stash == 'undefined') { bamboo.plugins.stash = {}; }
if (typeof bamboo.plugins.stash.repository == 'undefined') { bamboo.plugins.stash.repository = {}; }
if (typeof bamboo.plugins.stash.repository.view == 'undefined') { bamboo.plugins.stash.repository.view = {}; }


bamboo.plugins.stash.repository.view.error = function(opt_data, opt_ignored) {
  return '<div class="error control-form-error">' + soy.$$escapeHtml(opt_data.message) + '</div>';
};
if (goog.DEBUG) {
  bamboo.plugins.stash.repository.view.error.soyTemplateName = 'bamboo.plugins.stash.repository.view.error';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/branch-autocomplete.js' */
define("plugin-stash/branch-autocomplete",["jquery","underscore","widget/autocomplete-ajax","util/events","util/elements"],function(f,b,a,d,e){var c=a.extend({mixins:[d.EventBusMixin,e],initialize:function(g){this.params=f.extend({url:AJS.contextPath()+"/rest/stash/latest/projects/repositories/branches",urlSingle:AJS.contextPath()+"/rest/stash/latest/projects/repositories/branch",urlDefault:AJS.contextPath()+"/rest/stash/latest/projects/repositories/branches/default"},g.params||{});this.query=f.extend({limit:10},g.query||{});var i=b.bind(function(k,m,j){var l=f.extend({start:Math.max((m-1),0),query:k},this.query);if(!j&&(m-1)>0&&this.data.nextPage){l.start=this.data.nextPage}return l},this);var h={minimumInputLength:0,ajax:{url:this.params.url,dataType:"json",data:i,params:{error:f.noop},results:b.bind(function(k,j){return this.processData({results:k.values,nextPage:k.nextPageStart||0,more:!k.lastPage})},this)},id:function(j){return j.displayId}};this.onEvent("unbind",this.onUnbind);this.onEvent("stash:repository:change",this.onRepositoryChange);this.onEvent("stash:server:error:empty",this.onServerEmpty);this.onEvent("stash:server:change",this.onServerChange);this.onEvent("stash:form:config",this.onFormConfig);this.$fieldGroup=this.$el.parents(".field-group:first");a.prototype.initialize.apply(this,[f.extend(h,this.params)]);this.disable()},onUnbind:function(){this.undelegateEvents();this.$el.removeData().unbind();this.offEventNamespace("stash");f(window).off("applinks.auth.completion")},onFormConfig:function(g,h){this.config=h},onServerEmpty:function(g,h){if(b.isUndefined(h)){h=true}else{if(h){this.clearValue().$el.val("")}}this.toggleContainer(this.$fieldGroup,!h)},onServerChange:function(g,h){if(h.id){this.query.serverKey=h.id}this.clearQueryCache().clearValue().disable().toggleContainer(this.$fieldGroup.parent(),false)},onRepositoryChange:function(g,h,k){this.$fieldGroup.show();this.$fieldGroup.find(".field-value").show();this.$fieldGroup.find(".aui-message").remove();this.clearQueryCache().disable();if(h&&h.id){this.query.projectKey=h.project.key;this.query.repositorySlug=h.slug}this.query=b.omit(b.defaults(this.query,this.config),"branch");if(k!==true){this.$el.val("")}if(this.query.projectKey&&this.query.repositorySlug&&this.query.serverKey){var i=this.$el.val();var j=b.bind(function(l){this.triggerEvent("stash:branch:change",l);this.$el.auiSelect2("data",l);this.removeLoadingIcon().enable()},this);this.toggleContainer(this.$fieldGroup.parent(),true).promise().done(b.bind(function(){this.addLoadingIcon()},this));if(!i.length){this.getRemoteData(this.params.urlDefault,{dataType:this.settings.ajax.dataType,data:this.settings.ajax.data("",1,false)}).done(j)}else{this.config.branch=i;this.getRemoteData(this.params.urlSingle,{dataType:this.settings.ajax.dataType,data:this.config}).done(j)}}},onRegisterEvents:function(){this.$el.on("change",b.bind(function(g){if(g.val.length>0){this.triggerEvent("stash:errors:clear");this.triggerEvent("stash:branch:change",g.added)}},this))},onFormatResult:function(g){if(!b.isEmpty(g)){return bamboo.plugins.stash.branch.autocomplete.row({item:g})}},onFormatSelection:function(g){if(!b.isEmpty(g)){return bamboo.plugins.stash.branch.autocomplete.row({item:g})}},onRemoteError:function(h){console.log("On remote error");var i=[];this.$fieldGroup.show();this.$el.auiSelect2("close");this.removeLoadingIcon().clearValue().enable().$el.val("");if(h.responseText){var g=JSON.parse(h.responseText);if(g.authenticationInstanceName){this.$fieldGroup.find(".field-value").hide();this.$fieldGroup.append(bamboo.plugins.stash.repository.autocomplete.oauthError({instanceName:g.authenticationInstanceName,redirectUrl:g.authenticationRedirectUrl}));f(window).on("applinks.auth.completion",b.bind(function(j,l,k){if(k){f(window).off("applinks.auth.completion");this.triggerEvent("stash:repository:change")}},this));return}if(g.errors){i=g.errors}}if(!i.length){i.push("Failed to load data from Bitbucket Server.")}this.triggerEvent("stash:errors:show",this.$el,i)},getRemoteData:function(g,h){this.$el.removeClass("ajax-completed");return f.ajax(g,b.defaults({type:"GET",dataType:"json"},h)).fail(b.bind(this.onRemoteError,this)).complete(b.bind(function(){this.$el.data("ajax-completed",(new Date()).getTime())},this))}});return c});;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/server-autocomplete.js' */
define("plugin-stash/server-autocomplete",["jquery","underscore","widget/autocomplete-static","util/events"],function(e,c,b,d){var a=b.extend({mixins:[d.EventBusMixin],initialize:function(f){this.params=e.extend({serverPollingTimeout:3000,minimumResultsForSearch:-1,url:AJS.contextPath()+"/rest/stash/latest/servers/"},f.params||{});this.onEvent("unbind",this.onUnbind);this.onEvent("stash:server:init",this.onServerInit);this.onEvent("stash:server:loaded",this.onServerLoaded);this.$fieldGroup=this.$el.parents(".field-group:first");this.serverPolling=null;b.prototype.initialize.apply(this,[this.params]);this.initConfig()},onUnbind:function(){this.undelegateEvents();this.$el.removeData().unbind();this.offEventNamespace("stash");if(this.serverPolling){this.serverPolling=null}},onServerInit:function(){this.initConfig({placeholder:this.settings.loadingPlaceholder}).clearValue().disable();this.getRemoteData(this.params.url).done(c.bind(function(f){this.triggerEvent("stash:server:loaded",(f&&f.servers)?f.servers:[])},this))},onServerLoaded:function(f,h){if(h&&h.length){if(this.serverPolling){this.serverPolling=null;this.triggerEvent("stash:server:error:empty",false);this.$fieldGroup.find(".field-value").show();this.$fieldGroup.find("#stash-server-empty").remove()}this.initConfig({data:h,placeholder:this.settings.placeholder});var g=this.$el.data("initial");var i=null;if(g&&g.length){i=c.find(h,function(j){return j.id===g})}if(!i&&g){if(!this.$fieldGroup.find("#stash-server-empty").length){this.triggerEvent("stash:server:error:empty",true);this.$fieldGroup.append(bamboo.plugins.stash.server.autocomplete.serverEmpty({hasGlobalAdminPermission:this.params.hasGlobalAdminPermission,appLinkRemoved:true}))}}else{if(!i&&h.length===1){i=h[h.length-1]}if(i){this.triggerEvent("stash:server:error:empty",false);this.triggerEvent("stash:server:update",i)}this.$el.removeData("initial").auiSelect2("data",i)}this.enable()}else{if(this.$fieldGroup.is(":visible")){if(!this.$fieldGroup.find("#stash-server-empty").length){this.$fieldGroup.find(".field-value").hide();this.$fieldGroup.append(bamboo.plugins.stash.server.autocomplete.serverEmpty({hasGlobalAdminPermission:this.params.hasGlobalAdminPermission,appLinkRemoved:!!this.$el.data("initial")})).append(this.$fieldGroup.find(".error.control-form-error"))}this.serverPolling=true;this.triggerEvent("stash:server:error:empty");this.triggerEvent("stash:server:error:permissions");setTimeout(c.bind(function(){this.triggerEvent("stash:server:init")},this),this.params.serverPollingTimeout)}}},onInitSelection:function(f,g){f.data("initial",f.val())},onRegisterEvents:function(){this.$el.on("change",c.bind(function(f){if(f.val.length>0){this.$fieldGroup.find(".field-value").show();this.$fieldGroup.find("#stash-server-empty").remove();this.triggerEvent("stash:server:update",f.added);this.triggerEvent("stash:server:error:empty",false);this.triggerEvent("stash:errors:clear")}},this))},onFormatResult:function(f){if(!c.isEmpty(f)){return bamboo.plugins.stash.server.autocomplete.row({item:f})}},onFormatSelection:function(f){if(!c.isEmpty(f)){return bamboo.plugins.stash.server.autocomplete.row({item:f})}},onRemoteError:function(g){var h=[];this.$el.auiSelect2("close");this.clearValue().$el.val("");if(g.responseText){var f=JSON.parse(g.responseText);if(f.errors){h=f.errors}}if(!h.length){h.push("Failed to load data from Bitbucket Server.")}this.triggerEvent("stash:errors:show",this.$el,h)},getRemoteData:function(f){this.$el.removeClass("ajax-completed");return e.ajax({url:f,type:"GET",dataType:"json"}).fail(c.bind(this.onRemoteError,this)).complete(c.bind(function(){this.$el.data("ajax-completed",(new Date()).getTime())},this))}});return a});;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/repository-autocomplete.js' */
define("plugin-stash/repository-autocomplete",["jquery","underscore","widget/autocomplete-ajax","widget/help-dialog","util/events","util/elements","util/ajax"],function(h,c,b,e,d,g,f){var a=b.extend({mixins:[d.EventBusMixin,g],initialize:function(i){this.params=h.extend({url:AJS.contextPath()+"/rest/stash/latest/projects/repositories",urlSingle:AJS.contextPath()+"/rest/stash/latest/projects/repository"},i.params||{});this.query=h.extend({limit:10},i.query||{});var k=c.bind(function(m,o,l){var n=h.extend({start:Math.max((o-1),0),query:m},this.query);if(!l&&(o-1)>0&&this.data.nextPage){n.start=this.data.nextPage}return n},this);var j={minimumInputLength:0,ajax:{url:this.params.url,dataType:"json",data:k,params:{error:h.noop},results:c.bind(function(m,l){return this.processData({results:m.values,nextPage:m.nextPageStart||0,more:!m.lastPage})},this)}};this.onEvent("unbind",this.onUnbind);this.onEvent("stash:repository:description:set",this.onDescriptionSet);this.onEvent("stash:server:error:empty",this.onServerEmpty);this.onEvent("stash:server:change",this.onServerChange);this.onEvent("stash:form:config",this.onFormConfig);this.$fieldGroup=this.$el.parents(".field-group:first");b.prototype.initialize.apply(this,[h.extend(j,this.params)]);this.addDescriptionField();this.linkHelpDialog(this.params.helpDialogEl);this.disable()},onUnbind:function(){this.undelegateEvents();this.$el.removeData().unbind();this.offEventNamespace("stash");h(window).off("applinks.auth.completion")},onFormConfig:function(i,j){this.config=j},onServerEmpty:function(i,j){if(c.isUndefined(j)){j=true}else{if(j){this.clearValue();this.$el.val("")}}this.toggleContainer(this.$fieldGroup,!j)},onServerChange:function(i,j){this.$fieldGroup.show();this.$fieldGroup.find(".field-value").show();this.clearRepositoryErrorMessages();this.$fieldGroup.find(".aui-message").remove();this.clearQueryCache().disable();if(j.id){this.query.serverKey=j.id;this.triggerEvent("stash:server:error:permissions",false);this.toggleContainer(this.$fieldGroup.parent(),true).promise().done(c.bind(function(){this.addLoadingIcon()},this));if(this.$el.val().length){this.getRemoteData(this.params.urlSingle,{dataType:this.settings.ajax.dataType,data:this.config}).then(c.bind(function(k){return this.appendPermissions(k,j.id)},this)).done(c.bind(function(k){this.triggerEvent("stash:repository:init",k);this.$el.auiSelect2("data",k)},this)).always(c.bind(function(){this.removeLoadingIcon().enable()},this))}else{this.config.serverKey=j.id;this.getRemoteData(this.params.url,{dataType:this.settings.ajax.dataType,data:this.config}).done(c.bind(function(k){if(k.values&&k.values.length){this.addQueryCache(this.settings.ajax.data("",1,true),{results:k.values||[],nextPage:k.nextPageStart||0,more:!k.lastPage});this.removeLoadingIcon().enable()}else{this.removeLoadingIcon().triggerEvent("stash:errors:show",this.$el,["Selected server has no repositories."])}},this))}}else{this.clearValue()}},onRegisterEvents:function(){this.$el.on("change",c.bind(this.onRepositoryChange,this))},onRepositoryChange:function(j){if(j.val.length>0){this.triggerEvent("stash:errors:clear");var i=j.added;if(i&&i.id){this.addLoadingIcon();this.clearRepositoryErrorMessages();this.appendPermissions(i,this.config.serverKey).done(c.bind(this.triggerEvent,this,"stash:repository:update")).always(c.bind(this.removeLoadingIcon,this))}else{this.triggerEvent("stash:repository:update",updateData)}}},onFormatResult:function(i){if(!c.isEmpty(i)){return bamboo.plugins.stash.repository.autocomplete.row({item:i})}},onFormatSelection:function(i){if(!c.isEmpty(i)){return bamboo.plugins.stash.repository.autocomplete.row({item:i})}},onRemoteError:function(k){var l=[];this.$fieldGroup.show();this.$el.auiSelect2("close");var i=this.$el.val();this.removeLoadingIcon().clearValue().enable().$el.val("");if(k.responseText){var j=JSON.parse(k.responseText);if(j.serverErrorMessage){this.$fieldGroup.hide();this.triggerEvent("stash:errors:show","serverKey",[j.serverErrorMessage]);return}if(j.authenticationInstanceName){this.triggerEvent("stash:server:error:permissions");this.$fieldGroup.find(".field-value").hide();this.$fieldGroup.append(bamboo.plugins.stash.repository.autocomplete.oauthError({instanceName:j.authenticationInstanceName,redirectUrl:j.authenticationRedirectUrl})).append(this.$fieldGroup.find(".error.control-form-error"));h(window).on("applinks.auth.completion",c.bind(function(m,o,n){if(n){h(window).off("applinks.auth.completion");this.$el.val(i);this.triggerEvent("stash:server:change",{id:this.config.serverKey})}},this));return}if(j.remoteRequestStatus&&c.contains([401,404],j.remoteRequestStatus)){this.$fieldGroup.parent().append(bamboo.plugins.stash.repository.autocomplete.unauthorizedError({requestStatus:j.remoteRequestStatus}));return}if(j.errors){l=j.errors}}if(!l.length){l.push("Failed to load data from Bitbucket Server.")}this.triggerEvent("stash:errors:show",this.$el,l)},getRemoteData:function(i,j){this.$el.removeClass("ajax-completed");return h.ajax(i,c.defaults({type:"GET",dataType:"json"},j)).fail(c.bind(this.onRemoteError,this)).complete(c.bind(function(){this.$el.data("ajax-completed",(new Date()).getTime());this.$el.addClass("ajax-completed")},this))},clearRepositoryErrorMessages:function(){this.$fieldGroup.find(".aui-message").remove()},linkHelpDialog:function(j){var i=h(document.createElement("span")).attr("id",this.$el.attr("id")+"-help-dialog-trigger").addClass("aui-icon aui-icon-small aui-iconfont-help");this.$el.siblings(".select2-container:first").append(i);new e({el:i,content:j});return this},addDescriptionField:function(){var i=h(document.createElement("div")).addClass("description");this.$el.parent(".field-value").after(i);return this},onDescriptionSet:function(i,j){this.$el.parent(".field-value").siblings(".description").html(j)},appendPermissions:function(j,i){return f({url:AJS.contextPath()+"/rest/stash/latest/projects/repositories/permission",type:"GET",data:{serverKey:i,projectKey:j.project.key,repositorySlug:j.slug}}).then(function(k){return c.extend(j,{permission:k.permissionLevel})})}});return a});;
;
/* module-key = 'com.atlassian.bamboo.plugins.stash.atlassian-bamboo-plugin-stash:stash', location = '/javascript/repository-view.js' */
define("plugin-stash/repository-view",["jquery","underscore","brace","util/events","util/elements"],function(f,b,d,c,e){var a=d.View.extend({mixins:[c.EventBusMixin,e],elements:{serverKey:'input[name="repository.stash.readonly.serverKey"]',projectKey:'input[name="repository.stash.readonly.projectKey"]',repositorySlug:'input[name="repository.stash.readonly.repositorySlug"]',repositoryUrl:'input[name="repository.stash.readonly.repositoryUrl"]'},initialize:function(g){this.params=f.extend({url:AJS.contextPath()+"/rest/stash/latest/projects/repository"},g.params||{});if(g.elements){this.elements=g.elements}this.$container=this.$el.parents(".repository:first");this.onEvent("unbind",this.onUnbind);this.onEvent("repository:selector:change",b.bind(function(h,j,i){if(i&&i.length&&j==="LINKED"){if(+i===this.$container.data("key")){this.$el.hide();this.$container.show();this.onReadonlyInit()}}},this));this.onReadonlyInit()},onUnbind:function(){this.undelegateEvents();this.clearElementsCache();this.$el.removeData().unbind();this.offEvent("repository:selector:change")},onReadonlyInit:function(){this.clearElementsCache();this.$el.parent().find(".aui-message").remove();this.$container.find(".field-group:first").append(f(document.createElement("span")).addClass("aui-icon aui-icon-wait"));this.getRemoteData(this.params.url,{data:this.getConfig()}).done(b.bind(this.onRepositoryLoaded,this)).always(b.bind(function(){this.$container.find(".aui-icon.aui-icon-wait").fadeOut(function(){f(this).remove()})},this))},onRepositoryLoaded:function(g){this.$el.find(".stash-repository > option").text(bamboo.plugins.stash.repository.autocomplete.row({item:g}));this.$el.slideDown()},onRemoteError:function(i){if(i.responseText){var g=JSON.parse(i.responseText,{errors:["Failed to load data from Bitbucket Server."]});if(g.authenticationInstanceName){this.$el.hide().parent().append(bamboo.plugins.stash.repository.autocomplete.oauthError({instanceName:g.authenticationInstanceName,redirectUrl:g.authenticationRedirectUrl}));f(window).on("applinks.auth.completion",b.bind(function(j,l,k){if(k){f(window).off("applinks.auth.completion");this.onReadonlyInit()}},this));return}if(g.remoteRequestStatus&&b.contains([401,404],g.remoteRequestStatus)){this.$el.hide().parent().append(bamboo.plugins.stash.repository.autocomplete.unauthorizedError({requestStatus:g.remoteRequestStatus}));return}if(g.errors){this.$container.find(".error").remove();this.$el.slideDown();var h=this.$container.find(".stash-repository").parent();b.each(g.errors,b.bind(function(j){h.append(bamboo.plugins.stash.repository.view.error({message:j}))},this))}}},getRemoteData:function(g,h){return f.ajax(g,b.defaults({type:"GET",dataType:"json"},h)).fail(b.bind(this.onRemoteError,this))},getConfig:function(){return{serverKey:this.getElement("serverKey").val(),projectKey:this.getElement("projectKey").val(),repositorySlug:this.getElement("repositorySlug").val(),repositoryUrl:this.getElement("repositoryUrl").val()}}});return a});;
;
/* module-key = 'bamboo.web.resources:widget-repository-type', location = '/widget/repository/repository-selector-new.js' */
define('widget/repository-selector-new', [
    'jquery',
    'underscore',
    'brace',
    'util/events'
], function(
    $,
    _,
    Brace,
    events
) {

    'use strict';

    var RepositorySelectorNew = Brace.View.extend({

        mixins: [
            events.EventBusMixin
        ],

        initialize: function(options) {
            var settings = options || [];
            this.$selectedRepository = $('#selectedRepository');

            this.$el.find('li.option').on('click', _.bind(this.onSelectRepository, this));
            this.$el.find('li').tooltip({ gravity: 's' });

            this.$trigger = this.$el.find('a.aui-dropdown2-trigger');

            this.$forms = $('#repository-forms');
            this.$dropdown = $('#repository-other-dropdown');
            this.$staticElements = $('#repository-display-name');
            var $accessOptions = $('#repository-access-option');
            if ($accessOptions.length) {
                this.$staticElements = this.$staticElements.add($accessOptions);
            }

            this.onEvent('repository:selector:form', this.onFormChanged);
            this.selectByKey(this.getSelectedKey());
        },

        onFormChanged: function(instance, type) {
            if (type === 'NEW') {
                this.selectByKey(this.getSelectedKey());
            }
        },

        onSelectRepository: function(event) {
            event.preventDefault();

            var $element = $(event.target).parents('li:first');
            var key = $element.data('key');
            var isNullRepository = (key === 'nullRepository');

            //update text in dropdown trigger
            this.$trigger.text($element.text());

            if (isNullRepository) {
                this.$staticElements.hide();
            }
            else if (!this.$staticElements.toArray().every(function(element) {
                    return $(element).is(':visible');
                })) {
                this.$staticElements.show();
            }

            this.$selectedRepository.val(key);
            this.$selectedRepository.trigger('change');

            var id = ['repository', key].join('-');
            var $container = $('div[id="' + id + '"]');
            var $selected = this.$forms.find('.repository:visible').not($container);

            if ($selected && $selected.length) {
                $selected.hide();
            }

            this.$el.find('li.selected').removeClass('selected');
            $element.addClass('selected');
            $container.show();

            if (this.$dropdown.find($element).length) {
                this.$el.find('a[aria-controls="' + this.$dropdown.attr('id') + '"]')
                    .parents('li').addClass('selected');
            }

            AJS.layer(this.$dropdown).hide();
        },

        getSelectedKey: function() {
            var selectedKey = this.$selectedRepository.val();
            if (/^\d+$/.test(selectedKey)) { //test if selected repository is a number
                selectedKey = '';
            }

            if (!selectedKey.length) {
                var $elements = this.$el.find('li.option.selected')
                    .add(this.$dropdown.find('li.option.selected'));

                var key = $elements.first().data('key');

                if (key && key.length) {
                    selectedKey = key;
                }
            }

            return selectedKey;
        },

        selectByKey: function(key) {
            if (key && key.length) {
                var keySelector = 'li[data-key="' + key + '"] a';
                var $items = this.$el.find(keySelector).add(this.$dropdown.find(keySelector));

                if ($items.length) {
                    $items.trigger('click');
                }
            }
            else {
                this.$selectedRepository.val('');
                this.$selectedRepository.trigger('change');
            }
        }

    });

    return RepositorySelectorNew;
});
;
;
/* module-key = 'bamboo.web.resources:widget-repository-type', location = '/widget/repository/repository-selector-linked.js' */
define('widget/repository-selector-linked', [
    'jquery',
    'underscore',
    'brace',
    'util/events'
], function(
    $,
    _,
    Brace,
    events
) {

    'use strict';

    var RepositorySelectorLinked = Brace.View.extend({

        mixins: [
            events.EventBusMixin
        ],

        initialize: function(options) {
            this.params = options.params || {};

            this.$selectedRepository = $('#selectedRepository');
            this.$select = this.$el.find('select:first');
            this.$select.auiSelect2({
                // by default select2 defines formatResult which does matching/highlighting
                formatResult: function(item) {
                    return item.text;
                }
            });

            this.$select.on('change', _.bind(function(event) {
                if (event.val.length > 0 && event.added) {
                    this.onSelectRepository(event.added.id);
                }
            }, this));

            this.onEvent('repository:selector:form',
                this.onFormChanged
            );
        },

        onFormChanged: function(instance, type) {
            if (type === 'LINKED') {
                this.onSelectRepository(this.getSelectedKey());
            }
        },

        onSelectRepository: function(key) {
            var $container = $(['#repository-shared', key].join('-'));

            if ($container.length && !$container.is(':visible')) {
                var repositories = this.$el.find('.repository:visible');

                if (!repositories.length) {
                    $container.delay(400).slideDown();
                }
                else {
                    repositories.slideUp();
                    $container.slideDown();
                }
            }

            this.$selectedRepository.val(key);
            this.$selectedRepository.trigger('change');
        },

        getSelectedKey: function() {
            return this.$select.val();
        }

    });
    return RepositorySelectorLinked;
});
;
;
/* module-key = 'bamboo.web.resources:widget-repository-type', location = '/widget/repository/repository-selector.js' */
define('widget/repository-selector', [
    'jquery',
    'underscore',
    'brace',
    'util/events'
], function(
    $,
    _,
    Brace,
    events
) {

    'use strict';

    var RepositorySelector = Brace.View.extend({

        mixins: [
            events.EventBusMixin
        ],

        initialize: function() {
            this.$selectedRepository = $('#selectedRepository');
            this.$selectedRepository.on('change', _.bind(function() {
                this.triggerEvent('repository:selector:change',
                    this.$el.find('input:radio[name="repositoryTypeOption"]:checked').val(),
                    this.$selectedRepository.val()
                );

                if (this.$selectedRepository.val().length) {
                    this.$el.find('.radio > .error').remove();
                }
            }, this));

            var callback = _.bind(function(input) {
                if (input.length) {
                    this.triggerEvent('repository:selector:form', input.val());
                }
            }, this);

            $(document).on('change',
                'form input:radio[name="repositoryTypeOption"]', function(event) {
                    callback($(event.target));
                }
            );

            var $typeOption = this.$el.find(
                'input:radio[name="repositoryTypeOption"]:checked'
            );

            if ($typeOption.length) {
                callback($typeOption);
            }
        }

    });

    return RepositorySelector;
});
;
;
/* module-key = 'bamboo.web.resources:lib-jquery-keygen', location = '/bower/jquery-keygen/jquery.keygen.js' */
(function (exp, $) {
    exp.KeyGenerator = function () {
        // These words will not be used in key generation for acronyms.
        var IGNORED_WORDS = ["THE", "A", "AN", "AS", "AND", "OF", "OR"],
            // The (non-ascii) characters used as keys will be replaced with their (ascii) value.
            CHARACTER_MAP = {},

            getTotalLength = function (words) {
                return words.join("").length;
            },

            removeIgnoredWords = function (words) {
                return $.grep(words, function (word, index) {
                    return $.inArray(word, IGNORED_WORDS) === -1;
                });
            },

            createAcronym = function (words) {
                var result = "";
                $.each(words, function (i, word) {
                    result += word.charAt(0);
                });
                return result;
            },

            getFirstSyllable = function (word) {
                // Best guess at getting the first syllable
                // Returns the substring up to and including the first consonant to appear after a vowel
                var pastVowel = false;
                var i;
                for (i = 0; i < word.length; i++) {
                    if (isVowelOrY(word[i])) {
                        pastVowel = true;
                    } else {
                        if (pastVowel) {
                            return word.substring(0, i + 1);
                        }
                    }
                }
                return word;
            },

            isVowelOrY = function (c) {
                return c && c.length === 1 && c.search("[AEIOUY]") !== -1;
            };

        CHARACTER_MAP[199] = "C"; // 
        CHARACTER_MAP[231] = "c"; // ?
        CHARACTER_MAP[252] = "u"; // 
        CHARACTER_MAP[251] = "u"; // ?
        CHARACTER_MAP[250] = "u"; // 
        CHARACTER_MAP[249] = "u"; // ?
        CHARACTER_MAP[233] = "e"; // ?
        CHARACTER_MAP[234] = "e"; // ?
        CHARACTER_MAP[235] = "e"; // 
        CHARACTER_MAP[232] = "e"; // ?
        CHARACTER_MAP[226] = "a"; // 
        CHARACTER_MAP[228] = "a"; // ?
        CHARACTER_MAP[224] = "a"; // 
        CHARACTER_MAP[229] = "a"; // 
        CHARACTER_MAP[225] = "a"; // 
        CHARACTER_MAP[239] = "i"; // 
        CHARACTER_MAP[238] = "i"; // 
        CHARACTER_MAP[236] = "i"; // 
        CHARACTER_MAP[237] = "i"; // 
        CHARACTER_MAP[196] = "A"; // 
        CHARACTER_MAP[197] = "A"; // ?
        CHARACTER_MAP[201] = "E"; // 
        CHARACTER_MAP[230] = "ae"; // ?
        CHARACTER_MAP[198] = "Ae"; // 
        CHARACTER_MAP[244] = "o"; // 
        CHARACTER_MAP[246] = "o"; // ?
        CHARACTER_MAP[242] = "o"; // 
        CHARACTER_MAP[243] = "o"; // 
        CHARACTER_MAP[220] = "U"; // 
        CHARACTER_MAP[255] = "Y"; // 
        CHARACTER_MAP[214] = "O"; // 
        CHARACTER_MAP[241] = "n"; // 
        CHARACTER_MAP[209] = "N"; // 

        return {
            generateKey: function (name, options) {
                options = $.extend({}, options);

                var desiredKeyLength = (typeof options.desiredKeyLength == 'number') ? options.desiredKeyLength : 4,
                    maxKeyLength = (typeof options.maxKeyLength == 'number') ? options.maxKeyLength : Infinity,
                    charBlacklistRegex = (typeof options.charBlacklistRegex != 'undefined'? options.charBlacklistRegex : /[^a-zA-Z0-9]/g);

                name = $.trim(name);
                if (!name) {
                    return "";
                }

                // Brute-force chunk-by-chunk substitution and filtering.
                var filtered = [];
                for (var i = 0, ii = name.length; i < ii; i++) {
                    var sub = CHARACTER_MAP[name.charCodeAt(i)];
                    filtered.push(sub ? sub : name[i]);
                }

                name = filtered.join('');

                // Split into words
                var words = [];
                $.each(name.split(/\s+/), function (i, word) {
                    if (word) {
                        // Remove blacklisted characters
                        word = word.replace(charBlacklistRegex, "");
                        // uppercase the word (NOTE: JavaScript attempts to convert characters like ? in to SS)
                        word = word.toUpperCase();
                        // add the word, should it be worthy.
                        word.length && words.push(word);
                    }
                });

                // Remove ignored words
                if (desiredKeyLength && getTotalLength(words) > desiredKeyLength) {
                    words = removeIgnoredWords(words);
                }

                var key;

                if (words.length == 0) {
                    // No words were worthy!
                    key = "";
                } else if (words.length == 1) {
                    // If we have one word, and it is longer than a desired key, get the first syllable

                    var word = words[0],
                        firstSyllable = getFirstSyllable(word);

                    if (maxKeyLength < word.length || // must use the smaller one
                        Math.abs(word.length - desiredKeyLength) >= Math.abs(firstSyllable.length - desiredKeyLength)) { // should use the smaller one because it's closer to desired length.
                        key = firstSyllable;
                    } else {
                        key = word;
                    }
                } else {
                    var totalLength = getTotalLength(words),
                        acronym = createAcronym(words);
                    if (maxKeyLength < totalLength  || // must use the smaller one
                        Math.abs(totalLength - desiredKeyLength) >= Math.abs(acronym.length - desiredKeyLength)) { // should use the smaller one because it's closer to desired length.
                        key = acronym;
                    } else {
                        // The words are short enough to use as a key
                        key = words.join('');
                    }
                }

                // Limit the length of the key
                if (maxKeyLength && key.length > maxKeyLength) {
                    key = key.substr(0, maxKeyLength);
                }

                return key;
            }
        };
    };

    var keyGenerator = exp.KeyGenerator();

    $.fn.generateFrom = function ($nameElement, options) {
        var defaultOptions = {
                desiredKeyLength: 4,
                maxKeyLength: 10,
                maxNameLength: 30,
                timeoutMS: 100,
                charBlacklistRegex: /[^a-zA-Z0-9]/g, // Remove whitespace and punctuation characters (i.e. anything not A-Z or 0-9)
                uppercase: true,
                validationCallback: function () {
                },
                errorCallback: function () {
                }
            },

            $keyElement = $(this).first(),

            $nameElement = $nameElement.first(),

            options = $.extend({}, defaultOptions, options);

        (function () {
            var shouldUpdateKey = function () {
                    return $keyElement.data("autosuggest") !== false;
                },

                setKeyEdited = function (key) {
                    if (key) {
                        // If the key is manually edited, do not suggest automatically generated keys anymore
                        if ($keyElement.data("lastGeneratedValue") !== key) {
                            $keyElement.data("autosuggest", false);
                        }
                    } else {
                        // If the user deletes the entire key field, turn suggest back on.
                        $keyElement.data("autosuggest", true);
                    }
                },

                updateKey = function (key) {
                    var oldKey = $keyElement.val();
                    $keyElement.data("lastGeneratedValue", key);
                    $keyElement.val(key);
                    return oldKey != key;
                },

                onNameTimeout = function () {
                    setKeyEdited($keyElement.val());
                    autofillKeyIfNeeded();
                },

                bindNameHook = function (e) {
                    bindHook(e, onNameTimeout);
                },

                bindHook = function (e, func) {
                    var el = $(e.target), hook;
                    hook = function () {
                        unbindHook(e);
                        func();
                        if (el.is(":visible")) {
                            el.data("checkHook", setTimeout(hook, options.timeoutMS));
                        }
                    };
                    if (!el.data("checkHook")) {
                        el.data("checkHook", setTimeout(hook, 0));
                    }
                },

                unbindHook = function (e) {
                    var el = $(e.target);
                    clearTimeout(el.data("checkHook"));
                    el.removeData("checkHook");
                },

                autofillKeyIfNeeded = function () {
                    if (shouldUpdateKey()) {
                        var key = keyGenerator.generateKey($nameElement.val(), {
                            desiredKeyLength: options.desiredKeyLength,
                            maxKeyLength: options.maxKeyLength,
                            charBlacklistRegex: options.charBlacklistRegex
                        });
                        if (updateKey(key)) {
                            options.validationCallback();
                        }
                    }
                };

            // Input restrictions
            $nameElement.attr("maxlength", options.maxNameLength);
            $keyElement.attr("maxlength", options.maxKeyLength);
            if (options.uppercase) {
                $keyElement.css("text-transform", "uppercase");
            }

            // Poll the name field for updates
            if (document.activeElement && document.activeElement === $nameElement[0]) {
                bindNameHook({ target: $nameElement[0] });
            }
            $nameElement.focus(bindNameHook);
            $nameElement.blur(unbindHook);

        })();

        return this;
    };
})(window, jQuery);
;
;
/* module-key = 'bamboo.web.resources:plan-dependency-config', location = '/widget/autocomplete-controls/bamboo/plandependencies/plan-dependency.js' */
define('widget/dependent-plan-select', [
    'jquery',
    'underscore',
    'brace',
    'backbone',
    'widget/plan-single-select',
    'widget/selected-list',
    'util/events'
], function(
    $,
    _,
    Brace,
    Backbone,
    PlanSingleSelect,
    SelectedList,
    events
) {

    'use strict';

    var DependentPlanSelect = Brace.View.extend({
        mixins: [events.EventBusMixin],
        initialize: function(options) {
            this.planSelect = new PlanSingleSelect({
                el: this.$el,
                bootstrap: options.bootstrap || [],
                maxResults: 10
            });

            this.selectedPlans = new SelectedList({
                el: options.selectedPlansEl,
                bootstrap: options.bootstrap || [],
                itemTemplate: bamboo.widget.autocomplete.planDependency.item
            });

            this.onEvent('plan:selected', this.handleSelection);
        },
        // using global event-bus event handling (first argument is an instance)
        handleSelection: function(instance, model) {
            if (model instanceof Backbone.Model) {
                this.selectedPlans.addItem(model);
                this.planSelect.singleSelect.setValue('');
            }
        }
    });

    return DependentPlanSelect;
});
;
;
/* module-key = 'bamboo.web.resources:plan-dependency-config', location = '/widget/autocomplete-controls/bamboo/plandependencies/plan-dependency.soy' */
// This file was automatically generated from plan-dependency.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.widget.autocomplete.planDependency.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.widget == 'undefined') { bamboo.widget = {}; }
if (typeof bamboo.widget.autocomplete == 'undefined') { bamboo.widget.autocomplete = {}; }
if (typeof bamboo.widget.autocomplete.planDependency == 'undefined') { bamboo.widget.autocomplete.planDependency = {}; }


bamboo.widget.autocomplete.planDependency.list = function(opt_data, opt_ignored) {
  var output = '<ul class="' + soy.$$escapeHtml(opt_data.dependencies.length == 0 ? 'empty' : '') + aui.renderExtraClasses(opt_data) + '">';
  var dependencyList7 = opt_data.dependencies;
  var dependencyListLen7 = dependencyList7.length;
  for (var dependencyIndex7 = 0; dependencyIndex7 < dependencyListLen7; dependencyIndex7++) {
    var dependencyData7 = dependencyList7[dependencyIndex7];
    var plan__soy8 = opt_data.isParent ? dependencyData7.childPlan : dependencyData7.parentPlan;
    output += '<li data-id="' + soy.$$escapeHtml(plan__soy8.key) + '">' + bamboo.widget.autocomplete.planDependency.item({id: plan__soy8.key, projectName: plan__soy8.project.name, planName: plan__soy8.buildName, isEditable: dependencyData7.editable, isReadOnly: opt_data.isReadOnly}) + '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.planDependency.list.soyTemplateName = 'bamboo.widget.autocomplete.planDependency.list';
}


bamboo.widget.autocomplete.planDependency.item = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml("" + '/chain/admin/config/editChainDependencies.action?buildKey=' + opt_data.id) + '">' + soy.$$escapeHtml(opt_data.projectName) + ((opt_data.planName) ? ' &rsaquo; ' + soy.$$escapeHtml(opt_data.planName) : '') + '</a>' + ((! (opt_data.isEditable == false)) ? (! opt_data.isReadOnly) ? '<a class="remove"></a><input type="hidden" name="childPlanKeys" value="' + soy.$$escapeHtml(opt_data.id) + '" />' : '' : widget.lozenges.lozenge({text: "Generated", subtle: true, extraClasses: 'dependencies-generated'}));
};
if (goog.DEBUG) {
  bamboo.widget.autocomplete.planDependency.item.soyTemplateName = 'bamboo.widget.autocomplete.planDependency.item';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.atlassian-bamboo-plugin-git:github', location = 'javascript/github.js' */
(function(c,b){b.GITHUB={};function a(e){var f={repositoryKey:null,repositoryId:0,selectors:{repositoryType:null,username:null,password:null,loadRepositoriesButton:null,repository:null,branch:null}},d=c.extend(true,f,e);this.repositoryKey=d.repositoryKey;this.repositoryId=d.repositoryId;this._jqXHRRepository=null;this._jqXHRBranch=null;this.$repositoryType=c(d.selectors.repositoryType);this.$username=c(d.selectors.username);this.$password=c(d.selectors.password);this.$loadRepositoriesButton=c(d.selectors.loadRepositoriesButton);this.$repository=c(d.selectors.repository);this.$branch=c(d.selectors.branch);this._$fieldset=this.$username.closest("fieldset")}a.prototype={init:function(){this.$repository.select2({enable:false,width:"copy"});this.$loadRepositoriesButton.click(_.bind(this.loadRepositoriesClick,this));this.$repository.change(_.bind(this.repositoryChange,this));if(this.$repositoryType.val()===this.repositoryKey&&(this.repositoryId||(this.$username.val()&&this.$password.val()))){this.loadRepositories();if(this.$repository.val()!==null){this.loadBranches()}}},loadRepositoriesClick:function(){this.clearFieldErrors();this.$repository.prop("disabled",true);this.$branch.prop("disabled",true);if(this._jqXHRBranch){this._jqXHRBranch.abort()}this.loadRepositories().done(_.bind(function(e){var d=e.repositories;if(e.status==="OK"&&d&&d.length){this.$repository.focus();if(!this.$branch.children().length){this.$branch.append(this.generateBranchOption(this.defaultBranch()))}this.$repository.val(this.$repository.find("option:first").val());this.loadBranches()}},this))},repositoryChange:function(){this.clearFieldErrors();this.$branch.prop("disabled",true).empty().append(this.generateBranchOption(this.defaultBranch()));this.loadBranches()},loadRepositories:function(){var f=this.$repository,j=c("<optgroup />").attr("label","Loading Repositories...").appendTo(f),h=f.val(),e=this.generateRepositoryOption,i=_.bind(function(m,o,n){var k=document.createDocumentFragment(),l=m.repositories;if(m.status==="OK"&&l&&l.length){c.each(l,function(){k.appendChild(e(this).get(0))});f.empty().prop("disabled",false).get(0).appendChild(k);f.val(h)}else{d(n)}},this),g=_.bind(function(){j.remove();this.$loadRepositoriesButton.prop("disabled",false)},this),d=_.bind(function(m){var k,o=[],l;if(m.statusText!="abort"){try{k=c.parseJSON(m.responseText);o=k.errors||[];l=k.repositories}catch(n){}if(l&&!l.length){o.push("No repositories found for user {0}.".replace("{0}",this.$username.val()))}if(!o.length){o.push("Failed to load data from GitHub."+"["+m.status+" "+m.statusText+"]")}this.addFieldErrors(this.$repository,o)}},this);this.$loadRepositoriesButton.prop("disabled",true);return this.getRepositoryList().done(i).fail(d).always(g)},generateRepositoryOption:function(d){return c("<option/>",{text:d.full_name,val:d.full_name,data:d})},loadBranches:function(){var h=this.$branch,k=c("<optgroup />").attr("label","Loading Branches...").appendTo(h),i=h.closest(".field-group"),g=h.val(),f=this.generateBranchOption,j=_.bind(function(n,p,o){var m=c(),l=n.branches;if(n.status==="OK"&&l){c.each(l,function(){m=m.add(f(this["name"]))});h.empty().append(m).prop("disabled",false).val(g);if(g&&h.val()!=g){h.val(this.defaultBranch())}}else{d(o)}},this),e=_.bind(function(){k.remove()},this),d=_.bind(function(m){var l,o=[];if(m.statusText!="abort"){try{l=c.parseJSON(m.responseText);o=l.errors||[]}catch(n){}if(!o.length){o.push("Failed to load data from GitHub."+"["+m.status+" "+m.statusText+"]")}this.addFieldErrors(this.$branch,o)}},this);if(i.hasClass("hidden")){i.hide().removeClass("hidden").slideDown()}return this.getBranchList(this.$repository.val()).done(j).fail(d).always(e)},generateBranchOption:function(d){return c("<option/>",{text:d})},defaultBranch:function(){return"master"},getJsonResponse:function(d,h,f,e){var i=e.closest(".field-group"),g="loading";if(f){f.abort()}i.addClass(g);return c.ajax({type:"POST",url:d,data:JSON.stringify(h),contentType:"application/json",processData:false,dataType:"json"}).always(function(){i.removeClass(g)})},getRepositoryList:function(){var d=AJS.contextPath()+"/rest/git/latest/gh/repositories/"+this.$username.val()+"/";return this._jqXHRRepository=this.getJsonResponse(d,{password:this.$password.val(),repositoryId:this.repositoryId},this._jqXHRRepository,this.$repository)},getBranchList:function(e){var d=AJS.contextPath()+"/rest/git/latest/gh/repositories/"+e+"/branches/";return this._jqXHRBranch=this.getJsonResponse(d,{username:this.$username.val(),password:this.$password.val(),repository:e,repositoryId:this.repositoryId},this._jqXHRBranch,this.$branch)},addFieldErrors:function(d,e){b.addFieldErrors(d.closest("form"),d.attr("name"),e,true)},clearFieldErrors:function(){this._$fieldset.find(".error").slideUp(function(){c(this).remove()})}};b.GITHUB.RepositoryForm=a}(jQuery,window.BAMBOO=(window.BAMBOO||{})));;
;
/* module-key = 'com.atlassian.auiplugin:aui-restfultable', location = 'js/experimental-events/events.js' */
(function(c){AJS.triggerEvt=function(a,b){c(AJS).trigger(a,b)};AJS.bindEvt=function(a,b){c(AJS).bind(a,b)};AJS.triggerEvtForInst=function(a,b,d){c(b).trigger(a,d);AJS.triggerEvt(a,d);b.id&&AJS.triggerEvt(b.id+"_"+a,d)}})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:aui-restfultable', location = 'js-vendor/jquery/serializetoobject.js' */
jQuery.fn.serializeObject=function(){var a={};this.find(":input:not(:button):not(:submit):not(:radio):not('select[multiple]')").each(function(){""!==this.name&&(null===this.value&&(this.value=""),a[this.name]=this.value.match(/^(tru|fals)e$/i)?"true"==this.value.toLowerCase():this.value)});this.find("input:radio:checked").each(function(){a[this.name]=this.value});this.find("select[multiple]").each(function(){var c=jQuery(this),b=c.val();a[this.name]=c.data("aui-ss")?b?b[0]:"":null!==b?b:[]});return a};;
;
/* module-key = 'com.atlassian.auiplugin:aui-restfultable', location = 'js/experimental-restfultable/restfultable.js' */
(function(e){AJS.RestfulTable=Backbone.View.extend({initialize:function(a){var b=this;b.options=e.extend(!0,b._getDefaultOptions(a),a);b.id=this.options.id;b._event=AJS.RestfulTable.Events;b.classNames=AJS.RestfulTable.ClassNames;b.dataKeys=AJS.RestfulTable.DataKeys;this.$table=e(a.el).addClass(this.classNames.RESTFUL_TABLE).addClass(this.classNames.ALLOW_HOVER).addClass("aui").addClass(b.classNames.LOADING);this.$table.wrapAll("<form class='aui' action='#' />");this.$thead=e("<thead/>");this.$theadRow=
e("<tr />").appendTo(this.$thead);this.$tbody=e("<tbody/>");if(!this.$table.length)throw Error("AJS.RestfulTable: Init failed! The table you have specified ["+this.$table.selector+"] cannot be found.");if(!this.options.columns)throw Error("AJS.RestfulTable: Init failed! You haven't provided any columns to render.");this.showGlobalLoading();this.options.columns.forEach(function(a){var d=e.isFunction(a.header)?a.header():a.header;"undefined"===typeof d&&(AJS.warn("You have not specified [header] for column ["+
a.id+"]. Using id for now..."),d=a.id);b.$theadRow.append("<th>"+d+"</th>")});b.$theadRow.append("<th></th><th></th>");this._models=this._createCollection();this._rowClass=this.options.views.row;this.editRows=[];this.$table.closest("form").submit(function(a){b.focusedRow&&b.focusedRow.trigger(b._event.SAVE);a.preventDefault()});this.options.allowReorder&&(this.$theadRow.prepend("<th />"),this.$tbody.sortable({handle:"."+this.classNames.DRAG_HANDLE,helper:function(a,d){var g=e("<div/>").attr("class",
d.attr("class")).addClass(b.classNames.MOVEABLE);d.children().each(function(){var b=e(this),a=parseInt(0+b.css("border-left-width"),10),c=parseInt(0+b.css("border-right-width"),10),a=b[0].clientWidth+a+c;g.append(e("<div/>").html(b.html()).attr("class",b.attr("class")).width(a))});g=e("<div class='aui-restfultable-readonly'/>").append(g);g.css({left:d.offset().left});g.appendTo(document.body);return g},start:function(a,d){var g=d.helper[0].clientHeight,f=d.placeholder.find("td");d.item.addClass(b.classNames.MOVEABLE).children().each(function(b){e(this).width(f.eq(b).width())});
var h='<td colspan="'+b.getColumnCount()+'">&nbsp;</td>';d.placeholder.html(h).css({height:g,visibility:"visible"});b.getRowFromElement(d.item[0]).trigger(b._event.MODAL)},stop:function(a,d){AJS.$(d.item[0]).is(":visible")&&(d.item.removeClass(b.classNames.MOVEABLE).children().attr("style",""),d.placeholder.removeClass(b.classNames.ROW),b.getRowFromElement(d.item[0]).trigger(b._event.MODELESS))},update:function(a,d){var e={row:b.getRowFromElement(d.item[0]),item:d.item,nextItem:d.item.next(),prevItem:d.item.prev()};
b.move(e)},axis:"y",delay:0,containment:"document",cursor:"move",scroll:!0,zIndex:8E3}),this.$tbody.bind("selectstart mousedown",function(a){return!e(a.target).is("."+b.classNames.DRAG_HANDLE)}));!1!==this.options.allowCreate&&(this._createRow=(new this.options.views.editRow({columns:this.options.columns,isCreateRow:!0,model:this.options.model.extend({url:function(){return b.options.resources.self}}),cancelAccessKey:this.options.cancelAccessKey,submitAccessKey:this.options.submitAccessKey,allowReorder:this.options.allowReorder,
fieldFocusSelector:this.options.fieldFocusSelector})).bind(this._event.CREATED,function(a){b.options.addPosition==void 0&&b.options.createPosition==="bottom"||b.options.addPosition==="bottom"?b.addRow(a):b.addRow(a,0)}).bind(this._event.VALIDATION_ERROR,function(){this.trigger(b._event.FOCUS)}).render({errors:{},values:{}}),this.$create=e('<tbody class="'+this.classNames.CREATE+'" />').append(this._createRow.el),this._applyFocusCoordinator(this._createRow),this._createRow.trigger(this._event.FOCUS));
this._models.bind("remove",function(a){b.getRows().forEach(function(d){if(d.model===a){d.hasFocus()&&b._createRow&&b._createRow.trigger(b._event.FOCUS);b.removeRow(d)}})});this.fetchInitialResources()},fetchInitialResources:function(){var a=this;e.isFunction(this.options.resources.all)?this.options.resources.all(function(b){a.populate(b)}):e.get(this.options.resources.all,function(b){a.populate(b)})},move:function(a){var b=this,c=function(a){return a.length?{after:b.getRowFromElement(a).model.url()}:
{position:"First"}};a.row&&(c=b.options.reverseOrder?c(a.nextItem):c(a.prevItem),e.ajax({url:a.row.model.url()+"/move",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(c),complete:function(){a.row.hideLoading()},success:function(a){AJS.triggerEvtForInst(b._event.REORDER_SUCCESS,b,[a])},error:function(a){var c=e.parseJSON(a.responseText||a.data);AJS.triggerEvtForInst(b._event.SERVER_ERROR,b,[c,a,this])}}),a.row.showLoading())},_createCollection:function(){var a=this;return new (this.options.Collection.extend({sort:function(b){b||
(b={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.tableRows=a.getRows();this.models=this.sortBy(this.comparator);this.tableRows=void 0;b.silent||this.trigger("refresh",this,b);return this},remove:function(b,c){this.tableRows=a.getRows();Backbone.Collection.prototype.remove.apply(this,arguments);this.tableRows=void 0;return this}}))([],{comparator:function(b){var c;(void 0!==this.tableRows?this.tableRows:a.getRows()).some(function(a,e){if(a.model.id===b.id)return c=
e,!0});return c}})},populate:function(a){this.options.reverseOrder&&a.reverse();this.hideGlobalLoading();a&&a.length?(this._models.reset([],{silent:!0}),this.renderRows(a),this.isEmpty()&&this.showNoEntriesMsg()):this.showNoEntriesMsg();this.$table.append(this.$thead);"bottom"===this.options.createPosition?this.$table.append(this.$tbody).append(this.$create):this.$table.append(this.$create).append(this.$tbody);this.$table.removeClass(this.classNames.LOADING).trigger(this._event.INITIALIZED,[this]);
AJS.triggerEvtForInst(this._event.INITIALIZED,this,[this]);this.options.autoFocus&&this.$table.find(":input:text:first").focus()},showGlobalLoading:function(){this.$loading||(this.$loading=e('<div class="aui-restfultable-init">'+AJS.RestfulTable.throbber()+'<span class="aui-restfultable-loading">'+this.options.loadingMsg+"</span></div>"));this.$loading.is(":visible")||this.$loading.insertAfter(this.$table);return this},hideGlobalLoading:function(){this.$loading&&this.$loading.remove();return this},
addRow:function(a,b){var c,d;if(!a.id)throw Error("AJS.RestfulTable.addRow: to add a row values object must contain an id. Maybe you are not returning it from your restend point?Recieved:"+JSON.stringify(a));d=new this.options.model(a);c=this._renderRow(d,b);this._models.add(d);this.removeNoEntriesMsg();AJS.triggerEvtForInst(this._event.ROW_ADDED,this,[c,this]);return this},removeRow:function(a){this._models.remove(a.model);a.remove();this.isEmpty()&&this.showNoEntriesMsg();AJS.triggerEvtForInst(this._event.ROW_REMOVED,
this,[a,this])},isEmpty:function(){return 0===this._models.length},getModels:function(){return this._models},getTable:function(){return this.$table},getTableBody:function(){return this.$tbody},getCreateRow:function(){return this._createRow},getColumnCount:function(){var a=2;this.allowReorder&&++a;return this.options.columns.length+a},getRowFromElement:function(a){return e(a).data(this.dataKeys.ROW_VIEW)},showNoEntriesMsg:function(){this.$noEntries&&this.$noEntries.remove();this.$noEntries=e("<tr>").addClass(this.classNames.NO_ENTRIES).append(e("<td>").attr("colspan",
this.getColumnCount()).text(this.options.noEntriesMsg)).appendTo(this.$tbody);return this},removeNoEntriesMsg:function(){this.$noEntries&&0<this._models.length&&this.$noEntries.remove();return this},getRows:function(){var a=this,b=[];this.$tbody.find("."+this.classNames.READ_ONLY).each(function(){var c=e(this).data(a.dataKeys.ROW_VIEW);c&&b.push(c)});return b},_renderRow:function(a,b){var c=this,d=this.$tbody.find("."+this.classNames.READ_ONLY),e,f;f=new this._rowClass({model:a,columns:this.options.columns,
allowEdit:this.options.allowEdit,allowDelete:this.options.allowDelete,allowReorder:this.options.allowReorder,deleteConfirmation:this.options.deleteConfirmation});this.removeNoEntriesMsg();f.bind(this._event.ROW_EDIT,function(a){AJS.triggerEvtForInst(this._event.EDIT_ROW,{},[this,c]);c.edit(this,a)});e=f.render().$el;-1!==b&&("number"===typeof b&&0!==d.length?e.insertBefore(d[b]):this.$tbody.append(e));e.data(this.dataKeys.ROW_VIEW,f);f.bind(this._event.MODAL,function(){c.$table.removeClass(c.classNames.ALLOW_HOVER);
c.$tbody.sortable("disable");c.getRows().forEach(function(a){c.isRowBeingEdited(a)||a.delegateEvents({})})});f.bind(this._event.MODELESS,function(){c.$table.addClass(c.classNames.ALLOW_HOVER);c.$tbody.sortable("enable");c.getRows().forEach(function(a){c.isRowBeingEdited(a)||a.delegateEvents()})});this._applyFocusCoordinator(f);this.trigger(this._event.ROW_INITIALIZED,f);return f},isRowBeingEdited:function(a){var b=!1;this.editRows.some(function(c){if(c.el===a.el)return b=!0});return b},_applyFocusCoordinator:function(a){var b=
this;a.hasFocusBound||(a.hasFocusBound=!0,a.bind(this._event.FOCUS,function(){b.focusedRow&&b.focusedRow!==a&&b.focusedRow.trigger(b._event.BLUR);b.focusedRow=a;a instanceof AJS.RestfulTable.Row&&b._createRow&&b._createRow.enable()}));return this},_removeEditRow:function(a){a=e.inArray(a,this.editRows);this.editRows.splice(a,1);return this},_shiftFocusAfterEdit:function(){0<this.editRows.length?this.editRows[this.editRows.length-1].trigger(this._event.FOCUS):this._createRow&&this._createRow.trigger(this._event.FOCUS);
return this},_saveEditRowOnBlur:function(){return 1>=this.editRows.length},dismissEditRows:function(){this.editRows.forEach(function(a){a.hasUpdates()||a.trigger(this._event.FINISHED_EDITING)},this)},edit:function(a,b){var c=this,d=new this.options.views.editRow({el:a.el,columns:this.options.columns,isUpdateMode:!0,allowReorder:this.options.allowReorder,fieldFocusSelector:this.options.fieldFocusSelector,model:a.model,cancelAccessKey:this.options.cancelAccessKey,submitAccessKey:this.options.submitAccessKey}),
e=a.model.toJSON();e.update=!0;d.render({errors:{},update:!0,values:e}).bind(c._event.UPDATED,function(b,d){c._removeEditRow(this);this.unbind();a.render().delegateEvents();a.trigger(c._event.UPDATED);!1!==d&&c._shiftFocusAfterEdit()}).bind(c._event.VALIDATION_ERROR,function(){this.trigger(c._event.FOCUS)}).bind(c._event.FINISHED_EDITING,function(){c._removeEditRow(this);a.render().delegateEvents();this.unbind()}).bind(c._event.CANCEL,function(){c._removeEditRow(this);this.unbind();a.render().delegateEvents();
c._shiftFocusAfterEdit()}).bind(c._event.BLUR,function(){c.dismissEditRows();c._saveEditRowOnBlur()&&this.trigger(c._event.SAVE,!1)});this._applyFocusCoordinator(d);d.trigger(c._event.FOCUS,b);c._createRow&&c._createRow.disable();this.editRows.push(d);return d},renderRows:function(a){var b=this._models.comparator,c=[];this._models.comparator=void 0;a=_.map(a,function(a){a=new this.options.model(a);c.push(this._renderRow(a,-1).el);return a},this);this._models.add(a,{silent:!0});this._models.comparator=
b;this.removeNoEntriesMsg();this.$tbody.append(c);return this},_getDefaultOptions:function(a){return{model:a.model||AJS.RestfulTable.EntryModel,allowEdit:!0,views:{editRow:AJS.RestfulTable.EditRow,row:AJS.RestfulTable.Row},Collection:Backbone.Collection.extend({url:a.resources.self,model:a.model||AJS.RestfulTable.EntryModel}),allowReorder:!1,fieldFocusSelector:function(a){return":input[name="+a+"], #"+a},loadingMsg:a.loadingMsg||"Loading"}}});AJS.RestfulTable.throbber=
function(){return'<span class="aui-restfultable-throbber"></span>'};AJS.RestfulTable.throbber=function(){return'<span class="aui-restfultable-throbber"></span>'};AJS.RestfulTable.DataKeys={ENABLED_SUBMIT:"enabledSubmit",ROW_VIEW:"RestfulTable_Row_View"};AJS.RestfulTable.ClassNames={NO_VALUE:"aui-restfultable-editable-no-value",NO_ENTRIES:"aui-restfultable-no-entires",RESTFUL_TABLE:"aui-restfultable",ROW:"aui-restfultable-row",READ_ONLY:"aui-restfultable-readonly",ACTIVE:"aui-restfultable-active",
ALLOW_HOVER:"aui-restfultable-allowhover",FOCUSED:"aui-restfultable-focused",MOVEABLE:"aui-restfultable-movable",DISABLED:"aui-restfultable-disabled",SUBMIT:"aui-restfultable-submit",CANCEL:"aui-restfultable-cancel",EDIT_ROW:"aui-restfultable-editrow",CREATE:"aui-restfultable-create",DRAG_HANDLE:"aui-restfultable-draghandle",ORDER:"aui-restfultable-order",EDITABLE:"aui-restfultable-editable",ERROR:"error",DELETE:"aui-restfultable-delete",LOADING:"loading"};AJS.RestfulTable.Events={REORDER_SUCCESS:"RestfulTable.reorderSuccess",
ROW_ADDED:"RestfulTable.rowAdded",ROW_REMOVED:"RestfulTable.rowRemoved",EDIT_ROW:"RestfulTable.switchedToEditMode",SERVER_ERROR:"RestfulTable.serverError",CREATED:"created",UPDATED:"updated",FOCUS:"focus",BLUR:"blur",SUBMIT:"submit",SAVE:"save",MODAL:"modal",MODELESS:"modeless",CANCEL:"cancel",CONTENT_REFRESHED:"contentRefreshed",RENDER:"render",FINISHED_EDITING:"finishedEditing",VALIDATION_ERROR:"validationError",SUBMIT_STARTED:"submitStarted",SUBMIT_FINISHED:"submitFinished",INITIALIZED:"initialized",
ROW_INITIALIZED:"rowInitialized",ROW_EDIT:"editRow"}})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:aui-restfultable', location = 'js/experimental-restfultable/restfultable.entrymodel.js' */
(function(f){AJS.RestfulTable.EntryModel=Backbone.Model.extend({sync:function(a,b,c){var d=this,e=c.error;c.error=function(b){d._serverErrorHandler(b,this);e&&e.apply(this,arguments)};return Backbone.sync.apply(Backbone,arguments)},save:function(a,b){var b=b||{},c=this,d,e=b.error,g=b.success;b.error=function(b,a){var d=f.parseJSON(a.responseText||a.data);e&&e.call(c,c,d,a)};this.isNew()?Backbone.Model.prototype.save.call(this,a,b):a&&(d=AJS.RestfulTable.EntryModel.extend({url:this.url()}),d=new d({id:this.id}),
d.save=Backbone.Model.prototype.save,b.success=function(b,a){c.clear().set(b.toJSON());g&&g.call(c,c,a)},d.save(a,b))},destroy:function(a){var a=a||{},b=this,c=this.url(),d;a.data&&(d=f.param(a.data));""!==d&&(c=c+"?"+d);f.ajax({url:c,type:"DELETE",dataType:"json",contentType:"application/json",success:function(d){b.collection&&b.collection.remove(b);a.success&&a.success.call(b,d)},error:function(d){b._serverErrorHandler(d,this);a.error&&a.error.call(b,d)}});return this},changedAttributes:function(a){var b=
{},c=this.toJSON();f.each(a,function(a,e){c[a]?c[a]&&c[a]!==e&&("object"===typeof e?_.isEqual(e,c[a])||(b[a]=e):b[a]=e):"string"===typeof e?""!==f.trim(e)&&(b[a]=e):f.isArray(e)?0!==e.length&&(b[a]=e):b[a]=e});if(!_.isEmpty(b))return this.addExpand(b),b},addExpand:function(){},_serverErrorHandler:function(a,b){var c;400!==a.status&&(c=f.parseJSON(a.responseText||a.data),AJS.triggerEvtForInst(AJS.RestfulTable.Events.SERVER_ERROR,this,[c,a,b]))},fetch:function(a){a=a||{};this.clear();Backbone.Model.prototype.fetch.call(this,
a)}})})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:aui-restfultable', location = 'js/experimental-restfultable/restfultable.editrow.js' */
(function(c){AJS.RestfulTable.EditRow=Backbone.View.extend({tagName:"tr",events:{focusin:"_focus",click:"_focus",keyup:"_handleKeyUpEvent"},initialize:function(a){this.$el=c(this.el);this._event=AJS.RestfulTable.Events;this.classNames=AJS.RestfulTable.ClassNames;this.dataKeys=AJS.RestfulTable.DataKeys;this.columns=a.columns;this.isCreateRow=a.isCreateRow;this.allowReorder=a.allowReorder;this.events["click ."+this.classNames.CANCEL]="_cancel";this.delegateEvents();a.isUpdateMode?this.isUpdateMode=
!0:(this._modelClass=a.model,this.model=new this._modelClass);this.fieldFocusSelector=a.fieldFocusSelector;this.bind(this._event.CANCEL,function(){this.disabled=true}).bind(this._event.SAVE,function(b){this.disabled||this.submit(b)}).bind(this._event.FOCUS,function(b){this.focus(b)}).bind(this._event.BLUR,function(){this.$el.removeClass(this.classNames.FOCUSED);this.disable()}).bind(this._event.SUBMIT_STARTED,function(){this._submitStarted()}).bind(this._event.SUBMIT_FINISHED,function(){this._submitFinished()})},
defaultColumnRenderer:function(a){if(!1!==a.allowEdit)return c("<input type='text' />").addClass("text").attr({name:a.name,value:a.value});if(a.value)return document.createTextNode(a.value)},renderDragHandle:function(){return'<span class="'+this.classNames.DRAG_HANDLE+'"></span></td>'},_handleKeyUpEvent:function(a){27===a.keyCode&&this.trigger(this._event.CANCEL)},_cancel:function(a){this.trigger(this._event.CANCEL);a.preventDefault();return this},_submitStarted:function(){this.submitting=!0;this.showLoading().disable().delegateEvents({});
return this},_submitFinished:function(){this.submitting=!1;this.hideLoading().enable().delegateEvents(this.events);return this},_focus:function(a){this.hasFocus()||this.trigger(this._event.FOCUS,a.target.name);return this},hasFocus:function(){return this.$el.hasClass(this.classNames.FOCUSED)},focus:function(a){this.enable();a?a=this.$el.find(this.fieldFocusSelector(a)):(a=this.$el.find(this.classNames.ERROR+":first"),a=0===a.length?this.$el.find(":input:text:first"):a.parent().find(":input"));this.$el.addClass(this.classNames.FOCUSED);
a.focus().trigger("select");return this},disable:function(){var a,b;c.browser.mozilla&&(b=this.$el.find(":submit"),b.length&&(a=c("<input type='submit' class='"+this.classNames.SUBMIT+"' />").addClass(b.attr("class")).val(b.val()).data(this.dataKeys.ENABLED_SUBMIT,b),b.replaceWith(a)));this.$el.addClass(this.classNames.DISABLED).find(":submit").attr("disabled","disabled");return this},enable:function(){var a,b;c.browser.mozilla&&(a=this.$el.find(this.classNames.SUBMIT),(b=a.data(this.dataKeys.ENABLED_SUBMIT))&&
a.length&&a.replaceWith(b));this.$el.removeClass(this.classNames.DISABLED).find(":submit").removeAttr("disabled");return this},showLoading:function(){this.$el.addClass(this.classNames.LOADING);return this},hideLoading:function(){this.$el.removeClass(this.classNames.LOADING);return this},hasUpdates:function(){return!!this.mapSubmitParams(this.serializeObject())},serializeObject:function(){return this.$el.serializeObject()},mapSubmitParams:function(a){return this.model.changedAttributes(a)},submit:function(a){var b=
this,f;document.activeElement!==window&&c(document.activeElement).blur();if(this.isUpdateMode){if(f=this.mapSubmitParams(this.serializeObject()),!f)return b.trigger(b._event.CANCEL)}else this.model.clear(),f=this.mapSubmitParams(this.serializeObject());this.trigger(this._event.SUBMIT_STARTED);this.model.save(f,{success:function(){b.isUpdateMode?b.trigger(b._event.UPDATED,b.model,a):(b.trigger(b._event.CREATED,b.model.toJSON()),b.model=new b._modelClass,b.render({errors:{},values:{}}),b.trigger(b._event.FOCUS));
b.trigger(b._event.SUBMIT_FINISHED)},error:function(a,c,f){400===f.status&&b.renderErrors(c.errors).trigger(b._event.VALIDATION_ERROR,c.errors);b.trigger(b._event.SUBMIT_FINISHED)},silent:!0});return this},renderError:function(a,b){return c("<div />").attr("data-field",a).addClass(this.classNames.ERROR).text(b)},renderErrors:function(a){var b=this;this.$("."+this.classNames.ERROR).remove();a&&c.each(a,function(a,c){b.$el.find("[name='"+a+"']").closest("td").append(b.renderError(a,c))});return this},
render:function(a){var b=this;this.$el.empty();this.allowReorder&&c('<td  class="'+this.classNames.ORDER+'" />').append(this.renderDragHandle()).appendTo(b.$el);c.each(this.columns,function(f,d){var e,g;e=a.values[d.id];var h=[{name:d.id,value:e,allowEdit:d.allowEdit},a.values,b.model];e&&b.$el.attr("data-"+d.id,e);e=b.isCreateRow&&d.createView?(new d.createView({model:b.model})).render(h[0]):d.editView?(new d.editView({model:b.model})).render(h[0]):b.defaultColumnRenderer.apply(b,h);g=c("<td />");
"object"===typeof e&&e.done?e.done(function(a){g.append(a)}):g.append(e);d.styleClass&&g.addClass(d.styleClass);g.appendTo(b.$el)});this.$el.append(this.renderOperations(a.update,a.values)).addClass(this.classNames.ROW+" "+this.classNames.EDIT_ROW);this.trigger(this._event.RENDER,this.$el,a.values);this.$el.trigger(this._event.CONTENT_REFRESHED,[this.$el]);return this},renderOperations:function(a){var b=c('<td class="aui-restfultable-operations" />');a?b.append(c('<input class="aui-button" type="submit" />').attr({accesskey:this.submitAccessKey,
value:"Update"})).append(c('<a class="aui-button aui-button-link" href="#" />').addClass(this.classNames.CANCEL).text("Cancel").attr({accesskey:this.cancelAccessKey})):b.append(c('<input class="aui-button" type="submit" />').attr({accesskey:this.submitAccessKey,value:"Add"}));return b.add(c('<td class="aui-restfultable-status" />').append(AJS.RestfulTable.throbber()))}})})(AJS.$);;
;
/* module-key = 'com.atlassian.auiplugin:aui-restfultable', location = 'js/experimental-restfultable/restfultable.customview.js' */
AJS.RestfulTable.CustomEditView=AJS.RestfulTable.CustomCreateView=AJS.RestfulTable.CustomReadView=Backbone.View;;
;
/* module-key = 'com.atlassian.auiplugin:aui-restfultable', location = 'js/experimental-restfultable/restfultable.row.js' */
(function(b){AJS.RestfulTable.Row=Backbone.View.extend({tagName:"tr",events:{"click .aui-restfultable-editable":"edit"},initialize:function(a){a=a||{};this._event=AJS.RestfulTable.Events;this.classNames=AJS.RestfulTable.ClassNames;this.dataKeys=AJS.RestfulTable.DataKeys;this.columns=a.columns;this.allowEdit=a.allowEdit;this.allowDelete=a.allowDelete;if(!this.events["click .aui-restfultable-editable"])throw Error("It appears you have overridden the events property. To add events you will need to usea work around. https://github.com/documentcloud/backbone/issues/244");
this.index=a.index||0;this.deleteConfirmation=a.deleteConfirmation;this.allowReorder=a.allowReorder;this.$el=b(this.el);this.bind(this._event.CANCEL,function(){this.disabled=!0}).bind(this._event.FOCUS,function(a){this.focus(a)}).bind(this._event.BLUR,function(){this.unfocus()}).bind(this._event.MODAL,function(){this.$el.addClass(this.classNames.ACTIVE)}).bind(this._event.MODELESS,function(){this.$el.removeClass(this.classNames.ACTIVE)})},renderDragHandle:function(){return'<span class="'+this.classNames.DRAG_HANDLE+
'"></span></td>'},defaultColumnRenderer:function(a){if(a.value)return document.createTextNode(a.value.toString())},sync:function(a){this.model.addExpand(a);var b=this;this.showLoading();this.model.save(a,{success:function(){b.hideLoading().render();b.trigger(b._event.UPDATED)},error:function(){b.hideLoading()}});return this},refresh:function(a,b){var e=this;this.showLoading();this.model.fetch({success:function(){e.hideLoading().render();a&&a.apply(this,arguments)},error:function(){e.hideLoading();
b&&b.apply(this,arguments)}});return this},hasFocus:function(){return this.$el.hasClass(this.classNames.FOCUSED)},focus:function(){b(this.el).addClass(this.classNames.FOCUSED);return this},unfocus:function(){b(this.el).removeClass(this.classNames.FOCUSED);return this},showLoading:function(){this.$el.addClass(this.classNames.LOADING);return this},hideLoading:function(){this.$el.removeClass(this.classNames.LOADING);return this},edit:function(a){a=b(a.target).is("."+this.classNames.EDITABLE)?b(a.target).attr("data-field-name"):
b(a.target).closest("."+this.classNames.EDITABLE).attr("data-field-name");this.trigger(this._event.ROW_EDIT,a);return this},renderOperations:function(){var a=this;if(!1!==this.allowDelete)return b("<a href='#' class='aui-button' />").addClass(this.classNames.DELETE).text("Delete").click(function(b){b.preventDefault();a.destroy()})},destroy:function(){if(this.deleteConfirmation){var a=AJS.popup(400,200,"delete-entity-"+this.model.get("id"));a.element.html(this.deleteConfirmation(this.model.toJSON()));
a.show();a.element.find(".cancel").click(function(){a.hide()});a.element.find("form").submit(_.bind(function(b){a.hide();this.model.destroy();b.preventDefault()},this))}else this.model.destroy()},render:function(){var a=this,h=this.model.toJSON(),e=b("<td class='aui-restfultable-operations' />").append(this.renderOperations({},h)),j=b("<td class='aui-restfultable-status' />").append(AJS.RestfulTable.throbber());this.$el.removeClass(this.classNames.DISABLED+" "+this.classNames.FOCUSED+" "+this.classNames.LOADING+
" "+this.classNames.EDIT_ROW).addClass(this.classNames.READ_ONLY).empty();this.allowReorder&&b('<td  class="'+this.classNames.ORDER+'" />').append(this.renderDragHandle()).appendTo(a.$el);this.$el.attr("data-id",this.model.id);b.each(this.columns,function(e,c){var d,f=b("<td />");d=h[c.id];var g=c.fieldName||c.id,i=[{name:g,value:d,allowEdit:c.allowEdit},h,a.model];d&&a.$el.attr("data-"+c.id,d);d=c.readView?(new c.readView({model:a.model})).render(i[0]):a.defaultColumnRenderer.apply(a,i);if(!1!==
a.allowEdit&&!1!==c.allowEdit){if(g=b("<span />").addClass(a.classNames.EDITABLE).append('<span class="aui-icon aui-icon-small aui-iconfont-edit"></span>').append(d).attr("data-field-name",g),f=b("<td />").append(g).appendTo(a.$el),!d||""==b.trim(d))f.addClass(a.classNames.NO_VALUE),g.html(b("<em />").text(this.emptyText||"Enter value"))}else f.append(d);c.styleClass&&f.addClass(c.styleClass);f.appendTo(a.$el)});this.$el.append(e).append(j).addClass(this.classNames.ROW+" "+this.classNames.READ_ONLY);
this.trigger(this._event.RENDER,this.$el,h);this.$el.trigger(this._event.CONTENT_REFRESHED,[this.$el]);return this}})})(AJS.$);;
;
/* module-key = 'bamboo.web.resources.common:util-restfultable', location = '/util/restfultable/bamboo-restfultable-model.js' */
define('util/restfultable/bamboo-restfultable-model', [
    'jquery'
], function($) {

    'use strict';
    /**
     * Custom model implementation, on form error (400) we change the responseText
     * so that response is always available under 'errors' object which is then used
     * by default error handler.
     */
    return AJS.RestfulTable.EntryModel.extend({
        save: function(attributes, options) {
            var errorHandler = options.error;

            options.error = _.bind(function(instance, data, xhr) {
                if (xhr.status === 400) {
                    // if there are any generic error rethrow them as SERVER_ERROR
                    if (data.errors && data.errors.length) {
                        this.trigger(AJS.RestfulTable.Events.SERVER_ERROR, xhr);
                    }

                    // hack to match response structure
                    // to component requirements (errors under 'errors' object)
                    data = {errors: data};
                    xhr.responseText = JSON.stringify({
                        errors: $.parseJSON(xhr.responseText || xhr.data)
                    });
                } else {
                    // otherwise trigger server error
                    // (XHR is passed in)
                    this.trigger(AJS.RestfulTable.Events.SERVER_ERROR, xhr);
                }

                // calls original error handler
                if (errorHandler) {
                    errorHandler.call(this, instance, data, xhr);
                }
            }, this);

            AJS.RestfulTable.EntryModel.prototype.save.apply(this, [attributes, options]);
        },
        /**
         * Requests should never be cached.
         */
        fetch: function(options) {
            options.cache = false;

            AJS.RestfulTable.EntryModel.prototype.fetch.call(this, options);
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:util-restfultable', location = '/util/restfultable/bamboo-restfultable.js' */
define('util/restfultable/bamboo-restfultable', [
    'underscore',
    'aui'
], function(
    _,
    AJS
) {

    'use strict';
    /**
     * Custom version of RestfulTable which has method to refresh table data.
     */
    return AJS.RestfulTable.extend({
        /**
         * Refresh table content: fetch collection from server and rerender rows.
         */
        refresh: function() {
            var _this = this;
            _this.getModels().fetch({
                success: function() {
                    _.forEach(_this.getRows(), function(row) {
                        row.render();
                    });
                }
            });
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-capabilities-autocomplete.js' */
define('feature/requirements-table/requirements-table-capabilities-autocomplete', [
    'jquery',
    'underscore',
    'aui',
    'widget/autocomplete-ajax'
], function(
    $,
    _,
    AJS,
    AutocompleteAjax
) {

    'use strict';

    return AutocompleteAjax.extend({

        initialize: function(options) {
            options = $.extend({
                placeholder: "Search for a capability"
            }, options || {});

            this.params = options.params || {};

            if (options.params) {
                delete options.params;
            }

            var dataCallback = _.bind(function(currentTerm, page) {
                this.lastTerm = currentTerm;

                var startIndex = Math.max(
                    (page - 1) * this.params['max-results'], 0
                );

                var request = {
                    searchTerm: currentTerm,
                    'start-index': startIndex
                };

                if (startIndex > 0) {
                    request.lastGroup = this.data.lastGroup;
                }

                return $.extend(request, this.params);
            }, this);

            var settings = {
                minimumInputLength: 0,
                ajax: {
                    url: AJS.contextPath() + '/rest/api/latest/capability/groupedListing',
                    dataType: 'json',
                    data: dataCallback,
                    results: _.bind(function(data, page) {
                        if (!data.hasExactMatch && this.lastTerm.length) {
                            var newCapability = [
                                {value: "New custom requirement", isGroup: true},
                                {key: $.trim(this.lastTerm), value: $.trim(this.lastTerm)}
                            ];

                            data.capabilities = newCapability.concat(
                                data.capabilities
                            );
                        }

                        return this.processData({
                            more: data ? data.size > (page * this.params['max-results']) : false,
                            results: data.capabilities,
                            lastGroup: data.lastGroup
                        });
                    }, this)
                },
                id: function(object) {
                    return object.key;
                }
            };

            AutocompleteAjax.prototype.initialize.apply(
                this, [$.extend(settings, options || {})]
            );
        },

        /**
         * If 'select' configuration is provided uses that for
         * initial value (and performs no initial requests).
         */
        onInitSelection: function(element, callback) {
            if (element.val().length && this.settings.selected) {
                callback(this.settings.selected);
            }
        },

        onFormatResult: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.feature.requirements.table.columnCapabilities({
                    item: item
                });
            }
        },

        onFormatSelection: function(item) {
            if (!_.isEmpty(item)) {
                return bamboo.feature.requirements.table.columnCapabilities({
                    item: item
                });
            }
        }

    });

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-match-value-edit-view.js' */
define('feature/requirements-table/requirements-table-match-value-edit-view', [
    'jquery',
    'aui',
    'feature/requirements-table/requirements-table-match-type-edit-view'
], function(
    $,
    AJS,
    TableMatchTypeEditView
) {

    'use strict';

    /**
     * Custom edit-column for 'matchValue'.
     * Listens for update on global model object and re-renders itself.
     */
    var TableMatchValueEditView = AJS.RestfulTable.CustomEditView.extend({

        render: function(self) {
            // using backbone component id (which is unique on the page) for input id
            var $input = soy.renderAsElement(bamboo.feature.requirements.table.columnMatchValueEdit, {
                id: this.cid + 'matchValue',
                value: self.value,
                name: self.name
            });

            this.listenTo(this.model, 'update:matchType',
                this.toggleInput, this
            );

            // if we are in create mode, then use first label
            // from 'Bamboo.Page.Requirements.TableMatchTypeEditVie'
            var initialValue = (!this.model.isNew()) ? this.model.get('matchType') :
                TableMatchTypeEditView.prototype.labels[0].val;

            $input = this.toggleInput(
                initialValue,
                $($input)
            );

            return $input;
        },

        /**
         * Uses selector if provided or gets one by ID (backbone view ID prefix - unique).
         * Does not store selector locally on view, so that it can easily be detached.
         */
        toggleInput: function(value, $input) {
            if (!!value) {
                if (!$input) {
                    $input = $('input[id="' + this.cid + 'matchValue"]');
                }

                $input
                    .toggleClass('hidden', (value === 'EXISTS'))
                    .parents('tr:first').find('.' + AJS.RestfulTable.ClassNames.ERROR).remove();

                (value === 'MATCHES') ?
                    $input.after(bamboo.feature.requirements.table.columnMatchRegex()) :
                    $input.parent().find('.description').remove();
            }

            return $input;
        }

    });

    return TableMatchValueEditView;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table.soy' */
// This file was automatically generated from requirements-table.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.feature.requirements.table.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.feature == 'undefined') { bamboo.feature = {}; }
if (typeof bamboo.feature.requirements == 'undefined') { bamboo.feature.requirements = {}; }
if (typeof bamboo.feature.requirements.table == 'undefined') { bamboo.feature.requirements.table = {}; }


bamboo.feature.requirements.table.columnOperations = function(opt_data, opt_ignored) {
  return '<span><a href="' + soy.$$escapeHtml("") + '/admin/agent/viewCapabilityKey.action?capabilityKey=' + soy.$$escapeHtml(opt_data.detailsKey) + '">' + soy.$$escapeHtml("Details") + '</a>' + ((opt_data.showDelete) ? ' | <a href="#" class="aui-restfultable-delete">' + soy.$$escapeHtml("Delete") + '</a>' : '') + '</span>';
};
if (goog.DEBUG) {
  bamboo.feature.requirements.table.columnOperations.soyTemplateName = 'bamboo.feature.requirements.table.columnOperations';
}


bamboo.feature.requirements.table.columnMatchRegex = function(opt_data, opt_ignored) {
  return '<div class="description">' + soy.$$filterNoAutoescape("A \x3ca href\x3d\x22http://docs.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html\x22 target\x3d\x22_blank\x22\x3eregular expression\x3c/a\x3e describing a pattern that the key must match.") + '</div>';
};
if (goog.DEBUG) {
  bamboo.feature.requirements.table.columnMatchRegex.soyTemplateName = 'bamboo.feature.requirements.table.columnMatchRegex';
}


bamboo.feature.requirements.table.columnNoAgents = function(opt_data, opt_ignored) {
  return '' + widget.lozenges.auilozenge({colour: 'current', text: "No agents", subtle: true, extraAttributes: 'title="' + "No available agent can build this job." + '"'});
};
if (goog.DEBUG) {
  bamboo.feature.requirements.table.columnNoAgents.soyTemplateName = 'bamboo.feature.requirements.table.columnNoAgents';
}


bamboo.feature.requirements.table.columnImagesAgents = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml(opt_data.text);
};
if (goog.DEBUG) {
  bamboo.feature.requirements.table.columnImagesAgents.soyTemplateName = 'bamboo.feature.requirements.table.columnImagesAgents';
}


bamboo.feature.requirements.table.columnCapabilityEdit = function(opt_data, opt_ignored) {
  return '<input type="text" class="capability-select text" value="' + ((opt_data.value) ? soy.$$escapeHtml(opt_data.value) : '') + '" name="' + soy.$$escapeHtml(opt_data.name) + '">';
};
if (goog.DEBUG) {
  bamboo.feature.requirements.table.columnCapabilityEdit.soyTemplateName = 'bamboo.feature.requirements.table.columnCapabilityEdit';
}


bamboo.feature.requirements.table.columnMatchValueEdit = function(opt_data, opt_ignored) {
  return '<input type="text" class="text" id="' + soy.$$escapeHtml(opt_data.id) + '" value="' + ((opt_data.value) ? soy.$$escapeHtml(opt_data.value) : '') + '" name="' + soy.$$escapeHtml(opt_data.name) + '">';
};
if (goog.DEBUG) {
  bamboo.feature.requirements.table.columnMatchValueEdit.soyTemplateName = 'bamboo.feature.requirements.table.columnMatchValueEdit';
}


bamboo.feature.requirements.table.columnCapabilities = function(opt_data, opt_ignored) {
  return '' + ((opt_data.item && opt_data.item.value) ? soy.$$escapeHtml(opt_data.item.value) : '');
};
if (goog.DEBUG) {
  bamboo.feature.requirements.table.columnCapabilities.soyTemplateName = 'bamboo.feature.requirements.table.columnCapabilities';
}


bamboo.feature.requirements.table.deleteConfirmaton = function(opt_data, opt_ignored) {
  return '' + aui.message.warning({titleContent: "Warning", content: '<p>' + soy.$$escapeHtml("You are about to delete the selected required capability. Are you sure you want to continue?") + '</p>'});
};
if (goog.DEBUG) {
  bamboo.feature.requirements.table.deleteConfirmaton.soyTemplateName = 'bamboo.feature.requirements.table.deleteConfirmaton';
}
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-object-by-string-view.js' */
define('feature/requirements-table/requirements-table-object-by-string-view', [
    'aui',
    'underscore'
], function(
    AJS,
    _
) {

    'use strict';

    /**
     * Custom table view-column. Add support for
     * referencing as 'readonlyData.ownerName' (dot notation).
     */
    var TableObjectByStringView = AJS.RestfulTable.CustomReadView.extend({

        render: function(self) {
            return this.getObjectByString(this.model.toJSON(), self.name);
        },

        getObjectByString: function(object, path) {
            return _.reduce(path.split('.'), function(o, x) {
                return o[x];
            }, object);
        }

    });

    return TableObjectByStringView;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-match-type-edit-view.js' */
define('feature/requirements-table/requirements-table-match-type-edit-view', [
    'jquery',
    'underscore',
    'aui'
], function(
    $,
    _,
    AJS
) {

    'use strict';

    return AJS.RestfulTable.CustomEditView.extend({

        labels: [
            { val: 'EXISTS', text: "exists" },
            { val: 'EQUALS', text: "equals" },
            { val: 'MATCHES', text: "matches" }
        ],

        render: function(self) {
            var $select = $(document.createElement('select'))
                .attr('name', self.name)
                .addClass('select');

            _.each(this.labels, function(item) {
                $select.append($(document.createElement('option'))
                    .attr('value', item.val)
                    .text(item.text)
                );
            });

            // sets initial value
            if (self.value) {
                $select.val(self.value);
            } else {
                $select.val(this.labels[0].val);
            }

            return $select;
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-images-agents-view.js' */
define('feature/requirements-table/requirements-table-images-agents-view', [
    'feature/requirements-table/requirements-table-object-by-string-view'
], function(
    TableObjectByStringView
) {

    'use strict';

    /**
     * Custom table view-column for 'images' and 'agents',
     * adds a custom link.
     */
    var TableImagesAgentsView = TableObjectByStringView.extend({

        render: function(self) {
            return soy.renderAsElement(bamboo.feature.requirements.table.columnImagesAgents, {
                text: this.getObjectByString(this.model.toJSON(), self.name),
                key: this.model.get('key')
            });
        }
    });

    return TableImagesAgentsView;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-capability-view.js' */
define('feature/requirements-table/requirements-table-capability-view', [
    'aui'
], function(
    AJS
) {

    'use strict';

    return AJS.RestfulTable.CustomEditView.extend({

        render: function() {
            var values = this.model.get('readonlyData');

            if (values && values.requirementLabel) {
                return values.requirementLabel;
            }
        }
    });
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table.js' */
define('feature/requirements-table/requirements-table', [
    'jquery',
    'underscore',
    'aui',
    'util/restfultable/bamboo-restfultable',
    'util/restfultable/bamboo-restfultable-model',
    'feature/requirements-table/requirements-table-row',
    'feature/requirements-table/requirements-table-edit-row'
], function(
    $,
    _,
    AJS,
    BambooRestfulTable,
    TableModel,
    TableRow,
    TableEditRow
) {

    'use strict';

    // Adding custom changed event to restful table
    AJS.RestfulTable.Events.CHANGED = 'changed';

    /**
     * Extends base RestfulTable class and defines
     * default configuration (for requirement page).
     */

    var Table = BambooRestfulTable.extend({

        defaults: {
            model: TableModel,
            noEntriesMsg: "No requirements specified for job. This job can be built by any agents.",
            deleteConfirmation: true,
            allowReorder: false,
            autoFocus: true,
            views: {
                row: TableRow,
                editRow: TableEditRow
            }
        },

        /**
         * Triggers custom event when table model has changed and adds handler for
         * when 'matchType' (select) changes it's value, which is added to table root
         * and then by event delegation catches event.
         */
        initialize: function(options) {
            this.defaults.el = this.$el;

            var defaults = _.defaults(options || {}, this.defaults);
            AJS.RestfulTable.prototype.initialize.apply(this, [
                defaults
            ]);

            var updateHandler = _.bind(function() {
                this.trigger(AJS.RestfulTable.Events.CHANGED);
            }, this);

            // table was initialized (rendered)
            this.$el.on(AJS.RestfulTable.Events.INITIALIZED, updateHandler);

            // row was removed, created or updated
            $(this).on(AJS.RestfulTable.Events.ROW_REMOVED, updateHandler);
            this.getCreateRow().on(AJS.RestfulTable.Events.CREATED, updateHandler);

            this.on(AJS.RestfulTable.Events.ROW_INITIALIZED, function(row) {
                row.on(AJS.RestfulTable.Events.UPDATED, updateHandler);
            });

            // looks for change event on select html element
            this.$el.on('change', 'select', _.bind(function(event) {
                var currentRowId = $(event.target).parents('tr:first').data('id');
                var model = (!!currentRowId) ? this.getModels().get(currentRowId) :
                    this.getCreateRow().model;

                model.trigger('update:matchType', $(event.target).val());

                // prevents the event from bubbling up the DOM tree
                event.stopPropagation();
                event.preventDefault();
            }, this));

            return this;
        }
    });

    return Table;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-match-type-view.js' */
define('feature/requirements-table/requirements-table-match-type-view', [
    'aui'
], function(
    AJS
) {

    'use strict';

    /**
     * Custom read-column for 'matchType'.
     * Renders as a label from available mapping.
     */
    var TableMatchTypeView = AJS.RestfulTable.CustomEditView.extend({

        labels: {
            EXISTS: "exists",
            EQUALS: "equals",
            MATCHES: "matches"
        },

        render: function(self) {
            return this.labels[self.value];
        }

    });

    return TableMatchTypeView;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-edit-row.js' */
define('feature/requirements-table/requirements-table-edit-row', [
    'jquery',
    'underscore',
    'aui',
    'feature/requirements-table/requirements-table-capabilities-autocomplete',
    'util/errors'
], function(
    $,
    _,
    AJS,
    CapabilitiesAutocomplete,
    errors
) {

    'use strict';

    /**
     * Custom table edit-row.
     */
    var TableEditRow = AJS.RestfulTable.EditRow.extend({

        initialize: function(options) {
            AJS.RestfulTable.EditRow.prototype.initialize.apply(this, arguments);

            // register SEVER_ERROR event and triggers generic error handler
            // (appends message to .aui-page-panel-content)
            this.model.on(AJS.RestfulTable.Events.SERVER_ERROR, function(xhr) {
                errors(xhr, xhr.status);
            });

            // if user changes focus in edit mode,
            // the behaviour should be the same as clicking cancel
            this.bind(AJS.RestfulTable.Events.BLUR, function() {
                if (!this.isCreateRow) {
                    this.trigger(this._event.CANCEL);
                }
            });

            // make sure that save action for
            // create row is always enabled
            this.bind(AJS.RestfulTable.Events.SAVE, function() {
                if (!this.isCreateRow) {
                    this.disabled = false;
                }
            });
        },

        renderOperations: function(update) {
            var $container = AJS.RestfulTable.EditRow.prototype.renderOperations.apply(this, arguments);

            // uses existing code, and adds
            // primary class to submit button
            if (!update) {
                $container
                    .find('input:submit')
                    .addClass('aui-button-primary');
            }

            return $container;
        },

        renderErrors: function(errors) {
            this.$el.find('.' + this.classNames.ERROR).remove();

            if (errors.fieldErrors) {
                _.each(_.keys(errors.fieldErrors), _.bind(function(name) {
                    // join field error into one string
                    var message = $.trim(errors.fieldErrors[name].join(' '));

                    if (message.length) {
                        this.$el.find('[name="' + name + '"]').closest('td')
                            .append(this.renderError(name, message));
                    }
                }, this));
            }

            return this;
        },

        render: function(renderData) {
            AJS.RestfulTable.EditRow.prototype.render.apply(this, arguments);

            var $keyInput = this.$el.find('input[name="key"]');

            if ($keyInput.length) {
                var values = this.model.toJSON();
                var selected = null;

                if (values.key && values.readonlyData.requirementLabel) {
                    selected = {
                        value: values.readonlyData.requirementLabel,
                        key: values.key
                    };
                }

                // add select2 widget for capabilities
                new CapabilitiesAutocomplete({
                    el: $keyInput,
                    selected: selected
                });
            }

            return this;
        }

    });

    return TableEditRow;
});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-row.js' */
define('feature/requirements-table/requirements-table-row', [
    'jquery',
    'underscore',
    'aui',
    'widget/dialog'
], function(
    $,
    _,
    AJS,
    Dialog
) {

    'use strict';

    /**
     * Custom table read-row.
     */
    var TableRow = AJS.RestfulTable.Row.extend({

        /**
         * Mark row as 'readonly' (adds a class) based
         * on 'operations.canEdit' attribute.
         */
        initialize: function(options) {
            AJS.RestfulTable.Row.prototype.initialize.apply(this, arguments);

            var values = this.model.toJSON();

            if (values.operations && !_.isUndefined(values.operations.canEdit)) {
                this.allowEdit = !!values.operations.canEdit;

                if (!this.allowEdit) {
                    this.$el.addClass('readonly');
                }
            }
        },

        /**
         * Custom rendering for 'operations' column,
         * prepend 'details' link (based on permissions).
         */
        renderOperations: function() {
            var values = this.model.toJSON();

            if (values.operations) {
                var showDelete = values.operations.canDelete && (this.allowDelete !== false);
                var $container = $(bamboo.feature.requirements.table.columnOperations({
                    showDelete: showDelete,
                    detailsKey: values.key
                }));

                if (showDelete) {
                    $container.find('.aui-restfultable-delete')
                        .click(_.bind(function(event) {
                            event.preventDefault();
                            this.destroy();
                        }, this));
                }

                return $container;
            }
        },

        /**
         * Extends existing code and hides 'matchValue' (next) column content
         * if 'matchType' column has 'EXISTS' value and adds 'no agents' lozenge
         * if images and agents are both zero
         */
        render: function() {
            var $container = AJS.RestfulTable.Row.prototype.render.call(this);

            for (var i = 0; this.columns.length > i; i++) {
                var config = this.columns[i];
                var column = null;

                // adds custom class to current row
                if (config.className) {
                    column = $container.$el.find('td:eq(' + i + ')');
                    column.addClass(config.className);
                }

                // matchValue is next column from matchType
                if (config.id === 'matchType' && this.model.get('matchType') === 'EXISTS') {
                    var columnMatchType = column ? column.next() :
                        $container.$el.find('td:eq(' + (i + 1) + ')');

                    columnMatchType.find('*').remove();
                }

                if (config.id === 'readonlyData.matchingAgents') {
                    var readonlyData = this.model.get('readonlyData');

                    // remove images column and changes agents to span across two columns
                    if (!readonlyData.matchingAgents && !readonlyData.matchingImages) {
                        var $agentsColumn = $container.$el.find('td:eq(' + i + ')');
                        var $imagesColumn = $agentsColumn.next();

                        var hasImages = (!$imagesColumn.hasClass('aui-restfultable-operations'));

                        if (hasImages) {
                            $agentsColumn.attr('colspan', 2);
                            $imagesColumn.remove();
                        }

                        $agentsColumn
                            .html(bamboo.feature.requirements.table.columnNoAgents())
                            .find('.aui-lozenge ').tooltip();
                    }
                }
            }

            return $container;
        },

        /**
         * Adds a custom confirmation dialog
         * when deleting a row.
         */
        destroy: function() {
            if (this.deleteConfirmation) {
                new Dialog({
                    header: "Delete a required capability",
                    content: bamboo.feature.requirements.table.deleteConfirmaton(),
                    height: 260,
                    width: 600,
                    buttons: [
                        {
                            id: 'confirm',
                            label: "Confirm",
                            cssClass: 'aui-button aui-button-primary requirement-delete-confirm-btn',
                            params: {
                                self: this
                            },
                            // params.self is set to current row
                            callback: function(id, params) {
                                params.self.model.destroy();
                                this.dialog.remove();
                            }
                        },
                        {
                            id: 'cancel',
                            label: "Cancel",
                            cssClass: 'requirement-delete-cancel-btn',
                            type: 'link'
                        }
                    ]
                });
            } else {
                this.model.destroy();
            }
        }

    });

    return TableRow;

});
;
;
/* module-key = 'bamboo.web.resources.common:feature-requirements-table', location = '/feature/requirements-table/requirements-table-capability-edit-view.js' */
define('feature/requirements-table/requirements-table-capability-edit-view', [
    'aui'
], function(
    AJS
) {

    'use strict';

    return AJS.RestfulTable.CustomEditView.extend({

        render: function(self) {
            return soy.renderAsElement(bamboo.feature.requirements.table.columnCapabilityEdit, {
                name: self.name,
                value: self.value
            });
        }

    });

});
;
;
/* module-key = 'bamboo.web.resources.common:page-requirements', location = '/page/requirements/requirements.js' */
define('page/requirements/requirements', [
    'jquery',
    'underscore',
    'aui',
    'backbone',
    'feature/requirements-table/requirements-table-capability-view',
    'feature/requirements-table/requirements-table-capability-edit-view',
    'feature/requirements-table/requirements-table-match-type-view',
    'feature/requirements-table/requirements-table-match-type-edit-view',
    'feature/requirements-table/requirements-table-match-value-edit-view',
    'feature/requirements-table/requirements-table-object-by-string-view',
    'feature/requirements-table/requirements-table-images-agents-view',
    'feature/requirements-table/requirements-table',
    'util/ajax'
], function(
    $,
    _,
    AJS,
    Backbone,
    TableCapabilityView,
    TableCapabilityEditView,
    TableMatchTypeView,
    TableMatchTypeEditView,
    TableMatchValueEditView,
    TableObjectByStringView,
    TableImagesAgentsView,
    Table,
    ajax
) {

    'use strict';

    var Requirements = Backbone.View.extend({

        buildTableConfig: function() {
            return {
                key: '',
                columns: [
                    {
                        id: 'key',
                        readView: TableCapabilityView,
                        editView: TableCapabilityEditView,
                        header: "Required capability",
                        className: 'row-capability'
                    },
                    {
                        id: 'matchType',
                        readView: TableMatchTypeView,
                        editView: TableMatchTypeEditView,
                        className: 'row-match-type',
                        header: ''
                    },
                    {
                        id: 'matchValue',
                        editView: TableMatchValueEditView,
                        className: 'row-match-value',
                        header: ''
                    },
                    {
                        id: 'readonlyData.ownerName',
                        readView: TableObjectByStringView,
                        header: "Required by task",
                        className: 'row-owner-name',
                        allowEdit: false
                    },
                    {
                        id: 'readonlyData.matchingAgents',
                        readView: TableImagesAgentsView,
                        header: "Agents",
                        className: 'row-matching-agents',
                        allowEdit: false
                    },
                    {
                        id: 'readonlyData.matchingImages',
                        readView: TableImagesAgentsView,
                        header: "Images",
                        className: 'row-matching-images',
                        allowEdit: false
                    }
                ]
            };
        },

        initialize: function(options) {
            this.settings = options;

            this.settings.urlPath = [
                AJS.contextPath(), 'rest/api/latest/config/job',
                this.settings.key, 'requirement'
            ].join('/');

            this.settings.url = _.bind(function(callback) {
                ajax(this.settings.urlPath).then(callback);
            }, this);

            var tableConfiguration = this.buildTableConfig();

            // remove images column?
            if (!!this.settings.hideImages) {
                tableConfiguration.columns.pop();
            }

            this.$el.html(bamboo.page.requirements.panel());
            this.$info = this.$el.find('.requirements-info');

            this.table = new Table($.extend(tableConfiguration, {
                el: this.$el.find('.requirements-table'),
                resources: {
                    all: this.settings.url,
                    self: this.settings.urlPath
                }
            }));

            // table data has changed (CRUD + initial event)
            this.listenTo(this.table,
                AJS.RestfulTable.Events.CHANGED,
                this.updateInfo, this
            );

            // tooltip - load content for any tooltip
            this.$el.on('click', '.jsTooltip', function(event) {
                event.preventDefault();

                var dialog = AJS.InlineDialog(
                    $(this), undefined,
                    $(this).data('tooltip'), {
                        offsetX: -60
                    }
                );

                _.defer(function() {
                    dialog.show();
                });
            });
        },

        updateInfo: function() {
            ajax(this.settings.urlPath + '/summary').then(_.bind(function(data) {
                this.$info.html(bamboo.page.requirements.info(_.defaults(
                    { planKey: this.settings.key }, data
                )));
            }, this));
        }

    });

    return Requirements;
});
;
;
/* module-key = 'bamboo.web.resources.common:page-requirements', location = '/page/requirements/requirements.soy' */
// This file was automatically generated from requirements.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.page.requirements.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.page == 'undefined') { bamboo.page = {}; }
if (typeof bamboo.page.requirements == 'undefined') { bamboo.page.requirements = {}; }


bamboo.page.requirements.panel = function(opt_data, opt_ignored) {
  return '<div class="requirements"><div class="requirements-info"></div><table class="requirements-table"></table></div>';
};
if (goog.DEBUG) {
  bamboo.page.requirements.panel.soyTemplateName = 'bamboo.page.requirements.panel';
}


bamboo.page.requirements.info = function(opt_data, opt_ignored) {
  return '<div class="description">' + ((opt_data.requirementsCount == 0) ? soy.$$escapeHtml("This job can be built by any agent because it has no requirements.") : (opt_data.requirementsCount == 1) ? soy.$$escapeHtml("This job can only be built by agents whose capabilities meet the 1 requirement below.") : soy.$$escapeHtml(AJS.format("This job can only be built by agents whose capabilities meet the {0} requirements below.",opt_data.requirementsCount))) + '</div>' + ((opt_data.matchingAgentsCount == 0 && ! opt_data.isElasticBambooEnabled || opt_data.matchingAgentsCount == 0 && opt_data.matchingImagesCount == 0) ? aui.message.warning({titleContent: "This job can not be built.", content: '' + ((opt_data.hasDedicatedExecutors == true) ? soy.$$escapeHtml(soydata.VERY_UNSAFE.ordainSanitizedHtml(AJS.format("None of the dedicated agents or dedicated elastic images meet this job\x27\x27s requirements. \x3ca href\x3d\x22{0}\x22\x3eSee Agents Summary\x3c/a\x3e",typeof ("" + '/agent/viewAgents.action?planKey=' + opt_data.planKey) === 'number' ? "" + '/agent/viewAgents.action?planKey=' + opt_data.planKey : soy.$$escapeHtml("" + '/agent/viewAgents.action?planKey=' + opt_data.planKey)))) : (opt_data.matchingAgentsCount == 0 && ! opt_data.isElasticBambooEnabled) ? soy.$$escapeHtml("No agents meet this job\x27s requirements.") : (opt_data.matchingAgentsCount == 0 && opt_data.matchingImagesCount == 0) ? soy.$$escapeHtml("No agents or elastic images meet this job\x27s requirements.") : '') + bamboo.page.requirements.configureLinks(opt_data)}) : (opt_data.onlineEnabledAgentsCount == 0 && ! opt_data.isElasticBambooEnabled || opt_data.matchingImagesCount == 0 && opt_data.onlineEnabledAgentsCount == 0) ? bamboo.page.requirements.content(opt_data) + aui.message.warning({titleContent: "All agents that meet the requirements of this job are currently offline or disabled.", content: '' + bamboo.page.requirements.configureLinks(opt_data)}) : bamboo.page.requirements.content(opt_data));
};
if (goog.DEBUG) {
  bamboo.page.requirements.info.soyTemplateName = 'bamboo.page.requirements.info';
}


bamboo.page.requirements.content = function(opt_data, opt_ignored) {
  return '<dl class="details-list"><dt> ' + soy.$$escapeHtml("Can build on") + '</dt><dd>' + ((opt_data.matchingAgentsCount > 0) ? '<a href="' + soy.$$escapeHtml("") + '/agent/viewAgents.action?planKey=' + soy.$$escapeHtml(opt_data.planKey) + '">' + ((opt_data.matchingAgentsCount == 1) ? soy.$$escapeHtml("1 agent") : soy.$$escapeHtml(AJS.format("{0} agents",opt_data.matchingAgentsCount))) + '</a>' + aui.icons.icon({icon: 'info', useIconFont: true, extraClasses: 'jsTooltip', extraAttributes: {'data-tooltip': "" + '/ajax/viewAgentsMatchingRequirementsForJob.action?planKey=' + opt_data.planKey}}) + ((opt_data.onlineEnabledAgentsCount != opt_data.matchingAgentsCount) ? ' ' + ((opt_data.onlineEnabledAgentsCount == 0) ? soy.$$escapeHtml("(none online)") : soy.$$escapeHtml(AJS.format("({0} online)",opt_data.onlineEnabledAgentsCount))) : '') : soy.$$escapeHtml("No agents")) + '</dd>' + ((opt_data.isElasticBambooEnabled) ? '<dd>' + ((opt_data.matchingImagesCount > 0) ? '<a href="' + soy.$$escapeHtml("") + '/agent/viewAgents.action?planKey=' + soy.$$escapeHtml(opt_data.planKey) + '">' + ((opt_data.matchingImagesCount == 1) ? soy.$$escapeHtml("1 elastic image") : soy.$$escapeHtml(AJS.format("{0} elastic images",opt_data.matchingImagesCount))) + '</a>' + aui.icons.icon({icon: 'info', useIconFont: true, extraClasses: 'jsTooltip', extraAttributes: {'data-tooltip': "" + '/ajax/viewImagesMatchingRequirementsForJob.action?planKey=' + opt_data.planKey}}) : soy.$$escapeHtml("No elastic images")) + '</dd>' : '') + '</dl>';
};
if (goog.DEBUG) {
  bamboo.page.requirements.content.soyTemplateName = 'bamboo.page.requirements.content';
}


bamboo.page.requirements.configureLinks = function(opt_data, opt_ignored) {
  return '' + ((opt_data.canConfigureAgents || opt_data.canConfigureImages) ? '<p>' + ((opt_data.canConfigureAgents) ? '<a href="' + soy.$$escapeHtml("") + '/admin/agent/configureAgents!doDefault.action">' + soy.$$escapeHtml("Configure agents") + '</a>' + ((opt_data.canConfigureImages) ? ' ' + soy.$$escapeHtml("or") + ' ' : '') : '') + ((opt_data.canConfigureImages) ? '<a href="' + soy.$$escapeHtml("") + '/admin/elastic/image/configuration/viewElasticImageConfigurations.action">' + soy.$$escapeHtml("Manage elastic images") + '</a>' : '') + '</p>' : '');
};
if (goog.DEBUG) {
  bamboo.page.requirements.configureLinks.soyTemplateName = 'bamboo.page.requirements.configureLinks';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.atlassian-bamboo-plugin-aws-codedeploy:aws-resources', location = '/aws/credentials/dialog-form-add-credentials.soy' */
// This file was automatically generated from dialog-form-add-credentials.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.plugins.aws.dialog.form.add.credentials.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.plugins == 'undefined') { bamboo.plugins = {}; }
if (typeof bamboo.plugins.aws == 'undefined') { bamboo.plugins.aws = {}; }
if (typeof bamboo.plugins.aws.dialog == 'undefined') { bamboo.plugins.aws.dialog = {}; }
if (typeof bamboo.plugins.aws.dialog.form == 'undefined') { bamboo.plugins.aws.dialog.form = {}; }
if (typeof bamboo.plugins.aws.dialog.form.add == 'undefined') { bamboo.plugins.aws.dialog.form.add = {}; }
if (typeof bamboo.plugins.aws.dialog.form.add.credentials == 'undefined') { bamboo.plugins.aws.dialog.form.add.credentials = {}; }


bamboo.plugins.aws.dialog.form.add.credentials.form = function(opt_data, opt_ignored) {
  return '' + aui.message.info({content: '<p>' + soy.$$escapeHtml("These credentials are availale for use by all Bamboo users.") + '</p>'}) + aui.form.form({action: "" + '/rest/aws/latest/credentials', method: 'POST', content: '' + aui.form.textField({labelContent: "Credential name", isRequired: true, name: 'name'}) + aui.form.textField({labelContent: "Access key ID", isRequired: true, name: 'accessKey'}) + aui.form.passwordField({labelContent: "Secret access key", isRequired: true, name: 'secretKey'})});
};
if (goog.DEBUG) {
  bamboo.plugins.aws.dialog.form.add.credentials.form.soyTemplateName = 'bamboo.plugins.aws.dialog.form.add.credentials.form';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.atlassian-bamboo-plugin-aws-codedeploy:aws-resources', location = '/aws/codedeploy/aws-autocomplete.soy' */
// This file was automatically generated from aws-autocomplete.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace bamboo.plugins.aws.autocomplete.
 */

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.plugins == 'undefined') { bamboo.plugins = {}; }
if (typeof bamboo.plugins.aws == 'undefined') { bamboo.plugins.aws = {}; }
if (typeof bamboo.plugins.aws.autocomplete == 'undefined') { bamboo.plugins.aws.autocomplete = {}; }


bamboo.plugins.aws.autocomplete.error = function(opt_data, opt_ignored) {
  return '<div class="error control-form-error ajax-error">' + soy.$$escapeHtml(opt_data.message) + '</div>';
};
if (goog.DEBUG) {
  bamboo.plugins.aws.autocomplete.error.soyTemplateName = 'bamboo.plugins.aws.autocomplete.error';
}
;
;
/* module-key = 'com.atlassian.bamboo.plugins.atlassian-bamboo-plugin-aws-codedeploy:aws-resources', location = '/aws/codedeploy/aws-autocomplete.js' */
define("codedeploy/aws-autocomplete",["jquery","underscore","util/ajax","widget/autocomplete","credentials/dialog-form-add-credentials"],function(f,b,e,d,a){var c=Backbone.View.extend({defaultSettings:{urlBuckets:b.template(AJS.contextPath()+"/rest/aws/latest/credentials/<%=credentialId%>/s3/buckets"),urlApplications:b.template(AJS.contextPath()+"/rest/aws/latest/credentials/<%=credentialId%>/regions/<%=region%>/codedeploy/applications"),urlDeploymentGroups:b.template(AJS.contextPath()+"/rest/aws/latest/credentials/<%=credentialId%>/regions/<%=region%>/codedeploy/applications/<%=application%>/deploymentGroups"),$credentialsEl:undefined,$regionEl:undefined,$bucketsEl:undefined,$applicationsEl:undefined,$deploymentGroupsEl:undefined},initialize:function(g){b.extend(this,this.defaultSettings,g);this.bucketsAutocomplete=this.createAutocomplete(this.$bucketsEl,"bucketsAutocomplete");this.applicationsAutocomplete=this.createAutocomplete(this.$applicationsEl,"applicationsAutocomplete");this.deploymentGroupsAutocomplete=this.createAutocomplete(this.$deploymentGroupsEl,"deploymentGroupsAutocomplete");this.attachEvents();this.populateAutocomplete()},createAutocomplete:function(h,g){return new d({el:h,formatResult:this.onAutocompleteFormat,formatSelection:this.onAutocompleteFormat,query:b.bind(this.onQuery,this,g)})},attachEvents:function(){f(this.$credentialsEl).add(this.$regionEl).change(b.bind(function(){[this.bucketsAutocomplete,this.applicationsAutocomplete,this.deploymentGroupsAutocomplete].forEach(function(g){g.clearValue();g.processData([])},this);this.populateAutocomplete()},this));this.$applicationsEl.change(b.bind(this.populateDeploymentGroups,this));this.$addCredentialsEl.click(b.bind(function(g){g.preventDefault();new a({$credentialsEl:this.$credentialsEl})},this))},onQuery:function(g,h){h.callback({results:b.filter(this[g].data,function(i){return h.text===""||i.text.toUpperCase().indexOf(h.term.toUpperCase())>=0})})},onAutocompleteFormat:function(g){return g.text},populateAutocomplete:function(){this.populateBuckets();this.populateApplications()},populateBuckets:function(){var g=this.$credentialsEl.val();if(!g){return}return this.fetchResults(this.bucketsAutocomplete,this.urlBuckets({credentialId:g}))},populateApplications:function(){var g=this.$credentialsEl.val();if(!g){return}return this.fetchResults(this.applicationsAutocomplete,this.urlApplications({credentialId:g,region:this.$regionEl.val()}))},populateDeploymentGroups:function(){var g=this.$applicationsEl.val();if(!g){return}return this.fetchResults(this.deploymentGroupsAutocomplete,this.urlDeploymentGroups({credentialId:this.$credentialsEl.val(),region:this.$regionEl.val(),application:g}))},fetchResults:function(h,g){h.$el.parent().find(".ajax-error, .aui-icon-wait").remove();h.addLoadingIcon();h.disable();return e({url:g,error:{}}).then(b.bind(this.onRequestSuccess,h)).fail(b.bind(this.onRequestError,h)).always(b.bind(this.onRequestEnd,h))},onRequestSuccess:function(j){var h=j.results.map(function(k){return{text:k.name,id:k.name}});var i=h[0];var g=this.$el.val();if(g){i=h.filter(function(k){return k.text===g},this)[0]||i}this.$el.auiSelect2("data",i);this.$el.trigger("change");this.processData(h)},onRequestError:function(g){if(g.responseJSON&&g.responseJSON.message){this.$el.after(f(bamboo.plugins.aws.autocomplete.error({message:g.responseJSON.message})))}this.clearValue();this.processData([])},onRequestEnd:function(){this.removeLoadingIcon();this.enable()}});return c});;
;
/* module-key = 'com.atlassian.bamboo.plugins.atlassian-bamboo-plugin-aws-codedeploy:aws-resources', location = '/aws/credentials/dialog-form-add-credentials.js' */
define("credentials/dialog-form-add-credentials",["jquery","underscore","widget/dialog-form","widget/dialog","util/ajax","util/ajax-form"],function(g,d,e,c,f,a){var b=e.extend({template:bamboo.plugins.aws.dialog.form.add.credentials,defaultSettings:{buttons:[{id:"save",label:"Save credentials",cssClass:"aui-button aui-button-primary"},{id:"cancel",label:"Cancel",type:"link"}],header:"Add Amazon Web Services credentials",width:550,height:400},initialize:function(h){var i=h||{};i.content=this.template.form();e.prototype.initialize.call(this,i)},onCreateInstance:function(){c.prototype.onCreateInstance.apply(this,arguments);var h=this.dialog.getPage(0).body.find("form");this.form=new a(h,{url:h.attr("action"),type:h.attr("method")});this.form.bind(this.formSettings);this.form.on("error",d.bind(this.onFormError,this)).on("submit",d.bind(this.onFormSubmit,this)).on("success",d.bind(this.onFormSuccess,this))},onFormSuccess:function(i,h){g(this.settings.$credentialsEl).append(g("<option />",{val:h.id,text:h.name})).val(h.id).trigger("change");e.prototype.onFormSuccess.call(this)}});return b});;
;
/* module-key = 'com.atlassian.bamboo.plugins.atlassian-bamboo-plugin-bitbucket:bitbucket', location = 'javascript/bitbucket.js' */
define("feature/bitbucket-repository-form",["jquery","underscore","util/ajax-form","util/events"],function(e,b,a,c){function d(g){var h={repositoryKey:null,repositoryId:0,selectors:{repositoryType:null,accessLevel:null,credentialsSource:null,sharedCredentialsId:null,username:null,password:null,owner:null,loadRepositoriesButton:null,repository:null,branch:null,bitbucketScm:null,detailedConfiguration:null,branchConfiguration:null},inheritedData:{repository:"",id:""}},f=e.extend(true,h,g);this.repositoryKey=f.repositoryKey;this.repositoryId=f.repositoryId;this._jqXHRRepository=null;this._jqXHRBranch=null;this.$repositoryType=e(f.selectors.repositoryType);this.$accessLevel=e(f.selectors.accessLevel);this.$credentialsSource=e(f.selectors.credentialsSource);this.$sharedCredentialsId=e(f.selectors.sharedCredentialsId);this.$username=e(f.selectors.username);this.$password=e(f.selectors.password);this.$owner=e(f.selectors.owner);this.$loadRepositoriesButton=e(f.selectors.loadRepositoriesButton);this.$repository=e(f.selectors.repository);this.$branch=e(f.selectors.branch);this.$bitbucketScm=e(f.selectors.bitbucketScm);this.$form=this.$username.closest("form");this.$overrideRepositoryLocation=e("#overrideRepositoryLocation");this.$detailedConfiguration=e(f.selectors.detailedConfiguration);this.$branchConfiguration=e(f.selectors.branchConfiguration);this.inheritedData=f.inheritedData;c.EventBus.on("repository:server:toggle-override",this.resetRepository.bind(this))}d.prototype={init:function(){this.$repository.select2({enable:false,width:"copy"});this.$loadRepositoriesButton.click(b.bind(this.loadRepositoriesClick,this));this.$repository.change(b.bind(this.repositoryChange,this));if(this.$repositoryType.val()==this.repositoryKey&&this.repositoryId){this.loadRepositories();if(this.$repository.val()!==null){this.loadBranches(true)}}},loadRepositoriesClick:function(){this.clearFieldErrors();this.$repository.prop("disabled",true);this.$branch.prop("disabled",true);if(this._jqXHRBranch){this._jqXHRBranch.abort()}this.loadRepositories().done(b.bind(function(g){var f=g.repositories;if(g.status==="OK"&&f&&f.length){this.$repository.focus();if(!this.$branch.children().length){this.$branch.append(this.generateBranchOption(this.defaultBranchForScm(this.$bitbucketScm.val())))}this.$branch.prop("disabled",false)}},this))},resetRepository:function(){var f=!this.$overrideRepositoryLocation||this.$overrideRepositoryLocation.val()==="true";if(this.inheritedData.repository&&this.inheritedData.repository!=this.$repository.val()){this.clearFieldErrors();this.setSelectedScm();this.$branch.prop("disabled",true).empty().append(this.generateBranchOption(this.defaultBranchForScm(this.$bitbucketScm.val())));this.loadBranches(f)}},repositoryChange:function(){this.clearFieldErrors();this.setSelectedScm();this.$branch.prop("disabled",true).empty().append(this.generateBranchOption(this.defaultBranchForScm(this.$bitbucketScm.val())));this.loadBranches(true)},setSelectedScm:function(){var f=this.$repository.children(":selected").data("scm");if(f){this.$bitbucketScm.val(f.toUpperCase());BAMBOO.DynamicFieldParameters.syncFieldShowHide(this.$bitbucketScm.parent(),true)}},loadRepositories:function(){var g=this.$repository,l=e("<optgroup />").attr("label","Loading Repositories...").appendTo(g),j=g.select2("val"),h=this.generateRepositoryOption,k=b.bind(function(o,s,r){var m=document.createDocumentFragment(),n=o.repositories;if(o.status==="OK"&&n&&n.length){e.each(n,function(){m.appendChild(h(this).get(0))});g.empty().prop("disabled",false).get(0).appendChild(m);var q=j&&n.some(function(t){return j===t.owner+"/"+t.slug});if(q){g.select2("val",j);this.setSelectedScm()}else{var p=n[0];g.select2("val",p.owner+"/"+p.slug);this.repositoryChange()}}else{f(r)}},this),i=b.bind(function(){l.remove();this.$loadRepositoriesButton.prop("disabled",false)},this),f=b.bind(function(p){var n,r=[],m={},o;if(p.statusText!="abort"){try{n=e.parseJSON(p.responseText);r=n.errors||[];m=n.fieldErrors||{};o=n.repositories}catch(q){}if(o&&!o.length){r.push("No repositories found.")}if(!r.length&&e.isEmptyObject(m)){r.push("Failed to load data from Bitbucket."+" ["+p.status+" "+p.statusText+"]")}this.addFieldErrors(this.$repository,r,m)}},this);this.$loadRepositoriesButton.prop("disabled",true);return this.getRepositoryList().done(k).fail(f).always(i)},generateRepositoryOption:function(f){return e("<option/>",{text:f.owner+"/"+f.slug+" ("+f.scm+")",val:f.owner+"/"+f.slug,data:f})},loadBranches:function(n){var j=this.$branch,m=e("<optgroup />").attr("label","Loading Branches...").appendTo(j),o=this.$detailedConfiguration,f=this.$branchConfiguration,k=j.val(),g=this.generateBranchOption,i=b.bind(function(r,t,s){var q=e(),p=r.branches;if(r.status=="OK"&&p){e.each(p,function(){q=q.add(g(this["branch"]))});j.empty().append(q).prop("disabled",false).val(k);if(k&&j.val()!=k){j.val(this.defaultBranchForScm(this.$bitbucketScm.val()))}}else{h(s)}},this),l=b.bind(function(){m.remove()},this),h=b.bind(function(r){var q,t=[],p={};if(r.statusText!="abort"){try{q=e.parseJSON(r.responseText);t=q.errors||[];p=q.fieldErrors||{}}catch(s){}if(!t.length&&e.isEmptyObject(p)){t.push("Failed to load data from Bitbucket."+" ["+r.status+" "+r.statusText+"]")}this.addFieldErrors(this.$branch,t,p)}},this);if(o.hasClass("hidden")){o.hide().removeClass("hidden").slideDown()}if(f&&f.hasClass("hidden")){f.hide().removeClass("hidden").slideDown()}return this.getBranchList(this.$repository.val(),n).done(i).fail(h).always(l)},generateBranchOption:function(f){return e("<option/>",{text:f})},defaultBranchForScm:function(f){if(f=="GIT"){return"master"}else{if(f=="HG"){return"default"}}return null},getJsonResponse:function(f,j,h,g){var k=g.closest(".field-group"),i="loading";if(h){h.abort()}k.addClass(i);return e.ajax({type:"POST",url:f,data:JSON.stringify(j),contentType:"application/json",processData:false,dataType:"json"}).always(function(){k.removeClass(i)})},getJsonAuthenticationParams:function(){var f={accessLevel:this.$accessLevel.val()};if(f.accessLevel==="PUBLIC"){f.username=this.$owner.val()}else{f.credentialsSource=this.getCredentialsSource();if(f.credentialsSource==="SHARED_CREDENTIALS"){f.sharedCredentialsId=this.$sharedCredentialsId.val()}else{f.username=this.$username.val();f.password=this.$password.val()}}return f},getCredentialsSource:function(){return this.$credentialsSource.filter(function(g,f){return e(f).is(":checked")}).val()},getRepositoryList:function(){var f=AJS.contextPath()+"/rest/hg/latest/bb/repositories/";var g=b.extend(this.getJsonAuthenticationParams(),{repositoryId:this.repositoryId});return this._jqXHRRepository=this.getJsonResponse(f,g,this._jqXHRRepository,this.$repository)},getBranchList:function(h,f){var g=AJS.contextPath()+"/rest/hg/latest/bb/repositories/"+(f?h:this.inheritedData.repository)+"/branches/";var i=f?b.extend(this.getJsonAuthenticationParams(),{repository:h,repositoryId:this.repositoryId}):{repository:this.inheritedData.repository,repositoryId:this.inheritedData.id};return this._jqXHRBranch=this.getJsonResponse(g,i,this._jqXHRBranch,this.$branch)},addFieldErrors:function(g,i,f){if(i&&i.length){var h=g.attr("name");f[h]=f[h]||[];i.forEach(function(j){f[h].push(j)})}new a(this.$form).injectErrors({errors:[],fieldErrors:f})},clearFieldErrors:function(){this.$form.find(".error").remove()}};return d});;
;
/* module-key = 'com.atlassian.bamboo.plugins.bamboo-docker-plugin:docker-resources', location = '/docker/docker.js' */
(function(b,a){a.DOCKER={};a.DOCKER.DockerTaskConfiguration=(function(){var f={pluginSelector:"#docker-plugin",portsSelector:null,volumesSelector:null,templates:{portsListItem:null,volumesListItem:null}},q,p=/^[0-9]{1,5}$/,n,d,l=function(){var x=n.children("tbody");var w=x.children(":first");var v=x.children(":last");var z=(x.children().length>1?(parseInt(v.attr("data-ports-id"),10)+1):0);var y=w.find('input[name="hostPort"]');var t=w.find('input[name="containerPort"]');var r="";var u="";y.parent().find(".error").remove();t.parent().find(".error").remove();var B=n.find("input").serializeArray().filter(function(C){return(C.name&&(C.name.indexOf("containerPort_")===0||C.name.indexOf("hostPort_")===0))});var s=B.some(function(C){return(C.name.indexOf("hostPort")===0&&y.val()===C.value)});var A=B.some(function(C){return(C.name.indexOf("containerPort")===0&&t.val()===C.value)});if(y.val()){if(!p.test(y.val())){r="Invalid port"}else{if(s){r="Port already defined"}}}if(!t.val()){u="You must specify a container port"}else{if(!p.test(t.val())){u="Invalid port"}else{if(A){u="Port already defined"}}}if(r||u){y.after(b('<div class="error control-form-error"/>').text(r));t.after(b('<div class="error control-form-error"/>').text(u));return}b(AJS.template.load(q.templates.portsListItem).fill({index:z,hostPort:y.val(),containerPort:t.val()}).toString()).hide().appendTo(x).end().slideDown();y.val("");t.val("");a.DynamicFieldParameters.syncFieldShowHide(x)},i=function(){b(this).closest("tr").slideUp(function(){b(this).remove()})},j=function(r){b(this).parents("tr").addClass("active")},m=function(r){b(this).parents("tr").removeClass("active")},o=function(s){n.find(".error.control-form-error").remove();var r=n.find("input").serializeArray().filter(function(t){return(t.name&&(t.name.indexOf("containerPort_")===0||t.name.indexOf("hostPort_")===0))});r.forEach(function(v){var t="";var u=r.some(function(w){return(w.name.indexOf("containerPort")===0&&v.name.indexOf("containerPort")===0&&w.value===v.value&&v.name!==w.name)||(w.name.indexOf("hostPort")===0&&v.name.indexOf("hostPort")===0&&w.value===v.value&&v.name!==w.name)});if(!v.value){if(v.name.indexOf("containerPort")===0){t="You must specify a container port"}}else{if(!p.test(v.value)){t="Invalid port"}else{if(u){t="Port already defined"}}}if(t){b("#"+v.name).closest("td").append(b("<div/>").addClass("error control-form-error").text(t));s.stopPropagation();s.preventDefault()}})},e=function(){var w=d.children("tbody");var u=w.children(":first");var v=w.children(":last");var t=(w.children().length>1?(parseInt(v.attr("data-volumes-id"),10)+1):0);var r=u.find('input[name="hostDirectory"]');var s=u.find('input[name="containerDataVolume"]');s.parent().find(".error").remove();if(!s.val()){return s.after(b('<div class="error control-form-error"/>').text("Container data volume must be specified"))}b(AJS.template.load(q.templates.volumesListItem).fill({index:t,hostDirectory:r.val(),containerDataVolume:s.val()}).toString()).hide().appendTo(w).end().slideDown();r.val("");s.val("");a.DynamicFieldParameters.syncFieldShowHide(w)},k=function(){b(this).closest("tr").slideUp(function(){b(this).remove()})},g=function(r){b(this).parents("tr").addClass("active")},h=function(r){b(this).parents("tr").removeClass("active")},c=function(r){if(!b(this).val()){b(this).parents("tr").addClass("error");b(this).after(b('<div class="error control-form-error"/>').text("Container data volume must be specified"))}else{b(this).parents("tr").removeClass("error");b(this).parent().find(".error").remove()}};return{init:function(r){q=b.extend(true,f,r);b(function(){n=b(q.portsSelector).on("focus",'input[type="text"]',j).on("blur",'input[type="text"]',m).on("input",q.portsSelector+'-host--edit input[type="text"]',o).on("input",q.portsSelector+'-container--edit input[type="text"]',o).on("click",q.portsSelector+"-actions--add",l).on("click",q.portsSelector+"-actions--remove",i);n.find(".error").parents("tr").addClass("error");b(q.pluginSelector).closest("form").submit(function(){return n.find(q.portsSelector+"-container--edit.error").length});d=b(q.volumesSelector).on("focus",'input[type="text"]',g).on("blur",'input[type="text"]',h).on("input",q.volumesSelector+'-container--edit input[type="text"]',c).on("click",q.volumesSelector+"-actions--add",e).on("click",q.volumesSelector+"-actions--remove",k);d.find(".error").parents("tr").addClass("error");b(q.pluginSelector).closest("form").submit(function(){return d.find(q.volumesSelector+"-container--edit.error").length})})}}}())}(jQuery,window.BAMBOO=(window.BAMBOO||{})));;